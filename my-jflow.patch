diff --git a/pom.xml b/pom.xml
index 4e39a36bce..77bdbb4629 100644
--- a/pom.xml
+++ b/pom.xml
@@ -13,7 +13,6 @@
 		<module>siga-rel</module>
 		<module>siga-cp</module>
 		<module>siga-sinc-lib</module>
-		<module>siga-cp-sinc</module>
 		<module>siga-ldap</module>
 		<module>siga-vraptor-module-old</module>
 		<module>siga-vraptor-module</module>
@@ -82,7 +81,6 @@
 				<artifactId>maven-war-plugin</artifactId>
 				<version>2.4</version>
 				<configuration>
-					<packagingExcludes>WEB-INF/lib/siga-ext-*.jar</packagingExcludes>
 				</configuration>
 			</plugin>
 		</plugins>
@@ -222,7 +220,6 @@
 				<groupId>siga</groupId>
 				<artifactId>siga-ext</artifactId>
 				<version>${siga.version}</version>
-				<scope>provided</scope>
 			</dependency>
 			<dependency>
 				<groupId>siga</groupId>
@@ -364,31 +361,19 @@
 			<dependency>
 				<groupId>net.sf.jasperreports</groupId>
 				<artifactId>jasperreports</artifactId>
-				<version>5.2.0</version>
-				<exclusions>
-					<exclusion>
-						<groupId>org.bouncycastle</groupId>
-						<artifactId>bcmail-jdk14</artifactId>
-					</exclusion>
-					<exclusion>
-						<groupId>org.bouncycastle</groupId>
-						<artifactId>bcprov-jdk14</artifactId>
-					</exclusion>	
-	              	<exclusion>
-		              	<groupId>eclipse</groupId>
-		               	<artifactId>*</artifactId>
-		            </exclusion>
+				<version>6.12.2</version>
+				<!--<exclusions>
             		<exclusion>
-						<groupId>commons-collections</groupId>
-						<artifactId>commons-collections</artifactId>
+						<groupId>com.lowagie</groupId>
+						<artifactId>itext</artifactId>
 					</exclusion>					
-				</exclusions>
+				</exclusions>-->
 			</dependency>
 
 			<dependency>
 				<groupId>ar.com.fdvs</groupId>
 				<artifactId>DynamicJasper</artifactId>
-				<version>5.0.0</version>
+				<version>5.3.0</version>
 			</dependency>
 			
 			<dependency>
@@ -406,7 +391,7 @@
 			<dependency>
 				<groupId>org.freemarker</groupId>
 				<artifactId>freemarker</artifactId>
-				<version>2.3.20</version>
+				<version>2.3.30</version>
 			</dependency>
 			<dependency>
 				<groupId>com.opensymphony</groupId>
@@ -641,6 +626,30 @@
 				<artifactId>bsh</artifactId>
 				<version>2.0b5</version>
 			</dependency>
+			
+			<dependency>
+				<groupId>br.jus.trf2.xjus</groupId>
+				<artifactId>x-jus-record-api</artifactId>
+				<version>1.0.0</version>
+				<exclusions>
+					<exclusion>
+						<groupId>com.crivano</groupId>
+						<artifactId>swaggerservlet</artifactId>
+					</exclusion>
+				</exclusions>
+			</dependency>
+			
+			<dependency>
+				<groupId>com.crivano</groupId>
+				<artifactId>swaggerservlet</artifactId>
+				<version>1.33.0</version>
+			</dependency>
+			
+			<dependency>
+	            <groupId>org.flywaydb</groupId>
+	            <artifactId>flyway-core</artifactId>
+	            <version>6.5.3</version>
+	        </dependency>
 		</dependencies>
 	</dependencyManagement>
 
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/AcaoVO.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/AcaoVO.java
new file mode 100644
index 0000000000..0e33855c3c
--- /dev/null
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/AcaoVO.java
@@ -0,0 +1,219 @@
+/*******************************************************************************
+ * Copyright (c) 2006 - 2011 SJRJ.
+ * 
+ *     This file is part of SIGA.
+ * 
+ *     SIGA is free software: you can redistribute it and/or modify
+ *     it under the terms of the GNU General Public License as published by
+ *     the Free Software Foundation, either version 3 of the License, or
+ *     (at your option) any later version.
+ * 
+ *     SIGA is distributed in the hope that it will be useful,
+ *     but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *     GNU General Public License for more details.
+ * 
+ *     You should have received a copy of the GNU General Public License
+ *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
+ ******************************************************************************/
+package br.gov.jfrj.siga.base;
+
+import java.util.Collections;
+import java.util.Comparator;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
+import java.util.TreeMap;
+
+public class AcaoVO {
+	private String icone;
+	private String nome;
+	private String nameSpace;
+	private String acao;
+	boolean pode;
+	private String msgConfirmacao;
+	private String pre;
+	private String pos;
+	private String classe;
+	private String modal;
+	private Map<String, String> params;
+	private String explicacao;
+	private boolean post;
+
+	public Map<String, String> getParams() {
+		return params;
+	}
+
+	public String getPre() {
+		return pre;
+	}
+
+	public String getPos() {
+		return pos;
+	}
+
+	public String getIcone() {
+		return icone;
+	}
+
+	public String getNome() {
+		return nome;
+	}
+
+	public String getNomeNbsp() {
+		return getNome().replace(" ", "&nbsp;");
+	}
+
+	public String getNameSpace() {
+		return nameSpace;
+	}
+
+	public String getAcao() {
+		return acao;
+	}
+
+	public boolean isPode() {
+		return pode;
+	}
+
+	public boolean isPopup() {
+		if (params == null)
+			return false;
+		return params.containsKey("popup");
+	}
+
+	public boolean isAjax() {
+		if (params == null)
+			return false;
+		return params.containsKey("ajax");
+	}
+
+	public String getMsgConfirmacao() {
+		return msgConfirmacao;
+	}
+
+	public String getClasse() {
+		return classe;
+	}
+
+	public void setClasse(String classe) {
+		this.classe = classe;
+	}
+
+	public AcaoVO(String icone, String nome, String nameSpace, String acao, boolean pode, String msgConfirmacao,
+			TreeMap<String, String> params, String pre, String pos, String classe, String modal) {
+		super();
+		this.icone = icone;
+		this.nome = nome;
+		this.nameSpace = nameSpace;
+		this.acao = acao;
+		this.pode = pode;
+		this.msgConfirmacao = msgConfirmacao;
+		this.params = params;
+		this.pre = pre;
+		this.pos = pos;
+		this.classe = classe;
+		this.modal = modal;
+	}
+
+	public AcaoVO(String icone, String nome, String nameSpace, String acao, boolean pode, String explicacao,
+			String msgConfirmacao, TreeMap<String, String> params, String pre, String pos, String classe,
+			String modal) {
+		this(icone, nome, nameSpace, acao, pode, msgConfirmacao, params, pre, pos, classe, modal);
+		this.explicacao = explicacao;
+	}
+
+	public AcaoVO() {
+		// TODO Auto-generated constructor stub
+	}
+
+	@Override
+	public String toString() {
+		return getPre() + " " + getNome() + " " + getPos() + " <" + getNameSpace() + " - " + getAcao() + "?"
+				+ getParams() + ">";
+	}
+
+	public static List<AcaoVO> ordena(List<AcaoVO> acoes, Comparator<AcaoVO> comparator) {
+		if (comparator != null)
+			Collections.sort(acoes, comparator);
+		return acoes;
+	}
+
+	public String getUrl() {
+		String resultUrl = "";
+		if (this.params != null) {
+			String valueOfParameterToAdd;
+			Map<String, String> parameters = this.params;
+			Set<String> parametersNames = this.params.keySet();
+			for (String nameOfParameterToAdd : parametersNames) {
+				valueOfParameterToAdd = parameters.get(nameOfParameterToAdd);
+				resultUrl = (nameOfParameterToAdd + "=" + valueOfParameterToAdd + "&").concat(resultUrl);
+			}
+			if (!parametersNames.isEmpty())
+				resultUrl = ("?").concat(resultUrl);
+		}
+		resultUrl = ((this.nameSpace != null ? this.nameSpace + "/" : "") + this.acao).concat(resultUrl);
+		return resultUrl;
+	}
+
+	public String getModal() {
+		return modal;
+	}
+
+	public void setModal(String modal) {
+		this.modal = modal;
+	}
+
+	public String getExplicacao() {
+		return explicacao;
+	}
+
+	public void setExplicacao(String explicacao) {
+		this.explicacao = explicacao;
+	}
+
+	public boolean isPost() {
+		return post;
+	}
+
+	public void setPost(boolean post) {
+		this.post = post;
+	}
+
+	public void setIcone(String icone) {
+		this.icone = icone;
+	}
+
+	public void setNome(String nome) {
+		this.nome = nome;
+	}
+
+	public void setNameSpace(String nameSpace) {
+		this.nameSpace = nameSpace;
+	}
+
+	public void setAcao(String acao) {
+		this.acao = acao;
+	}
+
+	public void setPode(boolean pode) {
+		this.pode = pode;
+	}
+
+	public void setMsgConfirmacao(String msgConfirmacao) {
+		this.msgConfirmacao = msgConfirmacao;
+	}
+
+	public void setPre(String pre) {
+		this.pre = pre;
+	}
+
+	public void setPos(String pos) {
+		this.pos = pos;
+	}
+
+	public void setParams(Map<String, String> params) {
+		this.params = params;
+	}
+
+}
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/Correio.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/Correio.java
index b05828216d..ec98dd397e 100644
--- a/siga-base/src/main/java/br/gov/jfrj/siga/base/Correio.java
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/Correio.java
@@ -143,7 +143,7 @@ public class Correio {
 		session.setDebug(debug);
 		// Cria mensagem e seta alguns valores que constituem
 		// os seus headers.
-		final Message msg = new MimeMessage(session);
+		final MimeMessage msg = new MimeMessage(session);
 
 		if (destinatarios.length == 1) {
 			if (!destinatarios[0].equals("null") && !destSet.contains(destinatarios[0]))
@@ -169,11 +169,11 @@ public class Correio {
 			msg.setRecipients(Message.RecipientType.TO, endereco);
 		}
 		msg.setFrom(new InternetAddress(remetente));
-		msg.setSubject(assunto);
+		msg.setSubject(assunto, "utf-8");
 
 		if (conteudoHTML == null) {
 			// msg.setText(conteudo);
-			msg.setSubject(assunto);
+			msg.setSubject(assunto, "utf-8");
 			msg.setContent(conteudo, "text/plain;charset=UTF-8");
 		} else {
 			Multipart mp = new MimeMultipart("alternative");
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/Texto.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/Texto.java
index a3de1dba3f..0071cedcbf 100644
--- a/siga-base/src/main/java/br/gov/jfrj/siga/base/Texto.java
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/Texto.java
@@ -207,7 +207,7 @@ public class Texto {
 		string.replaceAll("-+$", "").replaceAll("^-+", "");
 
 		if (underscore)
-			string.replaceAll("-", "_");
+			string = string.replaceAll("-", "_");
 
 		return (lowercase ? string.toLowerCase() : string);
 	}
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/VO.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/VO.java
new file mode 100644
index 0000000000..7d081b8619
--- /dev/null
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/VO.java
@@ -0,0 +1,78 @@
+/*******************************************************************************
+ * Copyright (c) 2006 - 2011 SJRJ.
+ * 
+ *     This file is part of SIGA.
+ * 
+ *     SIGA is free software: you can redistribute it and/or modify
+ *     it under the terms of the GNU General Public License as published by
+ *     the Free Software Foundation, either version 3 of the License, or
+ *     (at your option) any later version.
+ * 
+ *     SIGA is distributed in the hope that it will be useful,
+ *     but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *     GNU General Public License for more details.
+ * 
+ *     You should have received a copy of the GNU General Public License
+ *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
+ ******************************************************************************/
+package br.gov.jfrj.siga.base;
+
+import java.io.UnsupportedEncodingException;
+import java.util.ArrayList;
+import java.util.Comparator;
+import java.util.List;
+import java.util.TreeMap;
+
+import br.gov.jfrj.siga.base.util.Utils;
+
+public class VO {
+	List<AcaoVO> acoes = new ArrayList<AcaoVO>();
+
+	private class NomeAcaoVOComparator implements Comparator<AcaoVO> {
+
+		public int compare(AcaoVO o1, AcaoVO o2) {
+			return o1.getNome().replace("_", "").compareTo(o2.getNome().replace("_", ""));
+		}
+	}
+
+	public List<AcaoVO> getAcoes() {
+		return acoes;
+	}
+
+	public List<AcaoVO> getAcoesOrdenadasPorNome() {
+		return AcaoVO.ordena(getAcoes(), new NomeAcaoVOComparator());
+	}
+
+	public void setAcoes(List<AcaoVO> acoes) {
+		this.acoes = acoes;
+	}
+	
+	public void addAcao(AcaoVO acao) {
+		acoes.add(acao);
+	}
+
+	public void addAcao(String icone, String nome, String nameSpace, String action, boolean pode) {
+		addAcao(icone, nome, nameSpace, action, pode, null, null, null, null, null, null, null);
+	}
+
+	public void addAcao(String icone, String nome, String nameSpace, String action, boolean pode, String tooltip, 
+			String msgConfirmacao, String parametros, String pre, String pos, String classe, String modal) {
+		TreeMap<String, String> params = new TreeMap<String, String>();
+		if (parametros != null) {
+			if (parametros.startsWith("&"))
+				parametros = parametros.substring(1);
+			else
+				params.clear();
+			try {
+				Utils.mapFromUrlEncodedForm(params, parametros.getBytes("iso-8859-1"));
+			} catch (UnsupportedEncodingException e) {
+			}
+		}
+
+		if (pode) {
+			AcaoVO acao = new AcaoVO(icone, nome, nameSpace, action, pode, msgConfirmacao, params, pre, pos, classe, modal);
+			acoes.add(acao);
+		}
+	}
+}
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestExceptionLogger.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestExceptionLogger.java
index 02e5307c22..65340e860f 100644
--- a/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestExceptionLogger.java
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestExceptionLogger.java
@@ -81,7 +81,11 @@ public class RequestExceptionLogger {
 				requestInfo.append("\t");
 				requestInfo.append(name);
 				requestInfo.append(" : ");
-				requestInfo.append(httpReq.getParameter(name));
+				if (name.toLowerCase().contains("senha") || name.toLowerCase().contains("password")
+						|| name.toLowerCase().contains("pwd"))
+					requestInfo.append("[parâmetro suprimido]");
+				else
+					requestInfo.append(httpReq.getParameter(name));
 				requestInfo.append("\n");
 			}
 
@@ -89,6 +93,8 @@ public class RequestExceptionLogger {
 			Enumeration<String> attrs = httpReq.getAttributeNames();
 			while (attrs.hasMoreElements()) {
 				String name = attrs.nextElement();
+				if (name.startsWith("org.jboss.weld"))
+					continue;
 				requestInfo.append("\t");
 				requestInfo.append(name);
 				requestInfo.append(" : ");
@@ -114,7 +120,7 @@ public class RequestExceptionLogger {
 
 			requestInfo.append("Stack Trace:  \n\t");
 			requestInfo.append(simplificarStackTrace(exception));
-			
+
 			requestInfo.append("\n ------ Fim dos detalhes do erro -----\n\n");
 
 			Logger.getLogger(loggerName).error(requestInfo);
@@ -122,34 +128,59 @@ public class RequestExceptionLogger {
 
 	}
 
+	private static String[] packages = { "br.gov.jfrj.siga", "com.crivano" };
+
 	public static String simplificarStackTrace(Throwable t) {
 		if (t == null)
 			return null;
-		while (t.getCause() != null && t != t.getCause()) {
-			if (t.getClass().getSimpleName().equals("AplicacaoException"))
-				break;
+
+		while ((t.getClass().getSimpleName().equals("ServletException") || t.getClass().getSimpleName().equals("InterceptionException") || t.getClass().getSimpleName().equals("InvocationTargetException") || t.getClass().getSimpleName().equals("ProxyInvocationException")) && t.getCause() != null && t != t.getCause()) {
 			t = t.getCause();
 		}
+
+		//		while (t.getCause() != null && t != t.getCause()) {
+//			if (t.getClass().getSimpleName().equals("AplicacaoException"))
+//				break;
+//			t = t.getCause();
+//		}
+		
+//		StackSimplier ss = new StackSimplier();
+//		String s = ss.simplify(t);
+
+//		java.io.StringWriter sw = new java.io.StringWriter();
+//		java.io.PrintWriter pw = new java.io.PrintWriter(sw);
+//		t.printStackTrace(pw);
+//		String s = sw.toString();
+		
+		String s = simplifyStackTrace(t, packages);
+		return s;
+	}
+
+	public static String simplifyStackTrace(Throwable t, String[] pkgs) {
+		if (t == null)
+			return null;
 		java.io.StringWriter sw = new java.io.StringWriter();
 		java.io.PrintWriter pw = new java.io.PrintWriter(sw);
 		t.printStackTrace(pw);
 		String s = sw.toString();
-		String[] lines = s.split(System.getProperty("line.separator"));
-		for (int i = 0; i < lines.length; i++) {
-			if (lines[i].contains("br.com.caelum.vraptor.core.DefaultReflectionProvider.invoke")) {
-				for (int j = i - 1; j > 0; j--) {
-					if (lines[j].trim().startsWith("at br.") && !lines[j].contains("$Proxy$_$$_WeldClientProxy")) {
-						StringBuilder sb = new StringBuilder();
-						for (int k = 0; k <= j; k++) {
-							sb.append(lines[k]);
-							sb.append(System.getProperty("line.separator"));
-						}
-						s = sb.toString();
-						break;
+		if (true) {
+			StringBuilder sb = new StringBuilder();
+			String[] lines = s.split(System.getProperty("line.separator"));
+			for (int i = 0; i < lines.length; i++) {
+				String l = lines[i];
+				boolean isInPackages = false;
+				if (pkgs != null) {
+					for (String pkg : pkgs) {
+						isInPackages |= l.contains(pkg);
 					}
 				}
-				break;
+				if (!l.startsWith("\t") || (isInPackages && !l.contains("$$_Weld") && !l.contains(".invoke(")
+						&& !l.contains(".doFilter("))) {
+					sb.append(l);
+					sb.append(System.getProperty("line.separator"));
+				}
 			}
+			s = sb.toString();
 		}
 		return s;
 	}
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestLoggerFilter.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestLoggerFilter.java
index 71a519a130..6f7b859384 100644
--- a/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestLoggerFilter.java
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/log/RequestLoggerFilter.java
@@ -12,30 +12,37 @@ import javax.servlet.ServletResponse;
 import br.gov.jfrj.siga.base.AplicacaoException;
 
 public class RequestLoggerFilter implements Filter {
+	static ThreadLocal<ServletRequest> servletRequest = new ThreadLocal<>();
 
 	@Override
 	public void init(FilterConfig filterConfig) throws ServletException {
 		// TODO Auto-generated method stub
-
 	}
 
 	@Override
 	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
 			throws IOException, ServletException {
+		servletRequest.set(request);
 		long inicio = System.currentTimeMillis();
 		try {
 			chain.doFilter(request, response);
 		} catch (Exception e) {
 			if (isAplicacaoException(e))
 				throw e;
-			long duracao = System.currentTimeMillis() - inicio;
-			new RequestExceptionLogger(request, e, duracao, getLoggerName()).logar();
+			logException(request, inicio, e);
 			throw e;
 		}
 
 	}
 
-	private boolean isAplicacaoException(Throwable e) {
+	public static void logException(ServletRequest request, long inicio, Exception e) {
+		if (request == null)
+			request = servletRequest.get();
+		long duracao = System.currentTimeMillis() - inicio;
+		new RequestExceptionLogger(request, e, duracao, getLoggerName()).logar();
+	}
+
+	public static boolean isAplicacaoException(Throwable e) {
 		while (e != null) {
 			if (e instanceof AplicacaoException)
 				return true;
@@ -46,7 +53,7 @@ public class RequestLoggerFilter implements Filter {
 		return false;
 	}
 
-	protected String getLoggerName() {
+	public static String getLoggerName() {
 		return "br.gov.jfrj.siga.request.log";
 	}
 
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/util/StackSimplier.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/util/StackSimplier.java
new file mode 100644
index 0000000000..39752a02a1
--- /dev/null
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/util/StackSimplier.java
@@ -0,0 +1,125 @@
+package br.gov.jfrj.siga.base.util;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Collections;
+import java.util.List;
+import java.util.regex.Pattern;
+
+public class StackSimplier {
+	private boolean useDefaultExcludeClassPattern = true;
+	private static ClassNamePatternMatcher DEFAULT_EXCLUDE_MATCHER = new ClassNamePatternMatcher(
+			Arrays.asList("^sun", "^java", "^com.sun"));
+	private ClassNamePatternMatcher excludeMatcher;
+	private ClassNamePatternMatcher includeMatcher;
+
+	public String simplify(Throwable exception) {
+		StringBuilder buff = new StringBuilder();
+		buff.append(exception.getClass().getName()).append(": ").append(exception.getMessage())
+				.append(System.lineSeparator());
+		StackTraceElement[] traces = exception.getStackTrace();
+		filterAndAppend(buff, traces);
+
+		while (exception.getCause() != null) {
+			Throwable cause = exception.getCause();
+			buff.append("Caused by: ").append(cause.getClass().getName()).append(": ").append(cause.getMessage())
+					.append(System.lineSeparator());
+			filterAndAppend(buff, cause.getStackTrace());
+			exception = exception.getCause();
+		}
+		return buff.toString();
+	}
+
+	private void filterAndAppend(StringBuilder buff, StackTraceElement[] traces) {
+		boolean firstIncluded = false;
+		for (StackTraceElement stackTrace : traces) {
+			if (!firstIncluded) {
+				firstIncluded = true;
+				buff.append("\tat ").append(stackTrace).append("\n");
+			} else if (macthIncludeTrace(stackTrace)) {
+				buff.append("\tat ").append(stackTrace).append("\n");
+			}
+		}
+	}
+
+	private boolean macthIncludeTrace(StackTraceElement stackTrace) {
+		if (matchIncludeClass(stackTrace.getClassName())) {
+			return true;
+		}
+		if (matchExcludeClass(stackTrace.getClassName())) {
+			return false;
+		}
+		return true;
+	}
+
+	private boolean matchIncludeClass(String className) {
+		return includeMatcher != null && includeMatcher.match(className);
+	}
+
+	private boolean matchExcludeClass(String className) {
+		if (useDefaultExcludeClassPattern && DEFAULT_EXCLUDE_MATCHER.match(className))
+			return true;
+		if (excludeMatcher != null && excludeMatcher.match(className))
+			return true;
+		return false;
+	}
+
+	public void setUseDefaultExcludeClassPattern(boolean useDefaultExcludeClassPattern) {
+		this.useDefaultExcludeClassPattern = useDefaultExcludeClassPattern;
+	}
+
+	public void setExcludeClassPatterns(String... patterns) {
+		excludeMatcher = new ClassNamePatternMatcher(Arrays.asList(patterns));
+	}
+
+	public void setExcludeClassPatterns(List<String> patterns) {
+		excludeMatcher = new ClassNamePatternMatcher(patterns);
+	}
+
+	public boolean isUseDefaultExcludeClassPattern() {
+		return useDefaultExcludeClassPattern;
+	}
+
+	public void setIncludeClassPatterns(String... patterns) {
+		includeMatcher = new ClassNamePatternMatcher(Arrays.asList(patterns));
+	}
+
+	public void setIncludeClassPatterns(List<String> patterns) {
+		includeMatcher = new ClassNamePatternMatcher(patterns);
+	}
+
+	public List<String> getExcludePatterns() {
+		if (excludeMatcher == null)
+			return Collections.emptyList();
+		else
+			return Collections.unmodifiableList(excludeMatcher.patterns);
+	}
+
+	public List<String> getIncludePatterns() {
+		if (includeMatcher == null)
+			return Collections.emptyList();
+		else
+			return Collections.unmodifiableList(includeMatcher.patterns);
+	}
+
+	private static class ClassNamePatternMatcher {
+		private List<String> patterns;
+		private Pattern pattern;
+
+		public ClassNamePatternMatcher(List<String> patterns) {
+			this.patterns = new ArrayList<>(patterns);
+			StringBuilder sb = new StringBuilder();
+			for (String pat : patterns) {
+				if (sb.length() > 0)
+					sb.append("|");
+				sb.append(pat.replace(".", "\\."));
+
+			}
+			pattern = Pattern.compile(sb.toString());
+		}
+
+		boolean match(String className) {
+			return pattern.matcher(className).find();
+		}
+	}
+}
\ No newline at end of file
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/base/util/Utils.java b/siga-base/src/main/java/br/gov/jfrj/siga/base/util/Utils.java
new file mode 100644
index 0000000000..a1bb0d5e66
--- /dev/null
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/base/util/Utils.java
@@ -0,0 +1,38 @@
+package br.gov.jfrj.siga.base.util;
+
+import java.io.UnsupportedEncodingException;
+import java.net.URLDecoder;
+import java.util.Map;
+
+public class Utils {
+	/**
+	 * @param map
+	 * @param form
+	 */
+	public static void mapFromUrlEncodedForm(Map map, final byte[] form) {
+		if (form != null) {
+			final String as[] = new String(form).split("&");
+			for (final String s : as) {
+				final String param[] = s.split("=");
+				try {
+					if (param.length == 2) {
+						map.put(param[0], URLDecoder.decode(param[1], "iso-8859-1"));
+					}
+				} catch (final UnsupportedEncodingException e) {
+				}
+			}
+		}
+	}
+
+	public static String completarComZeros(int valor, int casas) {
+		String s = String.valueOf(valor);
+		while (s.length() < casas)
+			s = "0" + s;
+		return s;
+	}
+
+	public static boolean empty(String s) {
+		return s == null || s.trim().length() == 0;
+	}
+
+}
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/model/ContextoPersistencia.java b/siga-base/src/main/java/br/gov/jfrj/siga/model/ContextoPersistencia.java
index 8a3564b296..3d9ace7449 100644
--- a/siga-base/src/main/java/br/gov/jfrj/siga/model/ContextoPersistencia.java
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/model/ContextoPersistencia.java
@@ -3,6 +3,7 @@ package br.gov.jfrj.siga.model;
 import java.util.Date;
 
 import javax.persistence.EntityManager;
+import javax.persistence.EntityTransaction;
 
 public class ContextoPersistencia {
 
@@ -14,6 +15,11 @@ public class ContextoPersistencia {
 		emByThread.set(em);
 	}
 
+	static public EntityManager getEntityManager() {
+		EntityManager em = emByThread.get();
+		return em;
+	}
+
 	static public EntityManager em() {
 		EntityManager em = emByThread.get();
 		if (em == null)
@@ -22,9 +28,26 @@ public class ContextoPersistencia {
 	}
 
 	static public void flushTransaction() {
+		if (em().getTransaction() != null && em().getTransaction().isActive()) {
+			em().flush();
+			em().getTransaction().commit();
+			em().getTransaction().begin();
+		}
+	}
+	
+	public static void begin() {
+		EntityTransaction transaction = em().getTransaction();
+		if (transaction != null && !transaction.isActive()) {
+			transaction.begin();
+		}
+	}
+
+	public static void commit() {
+		EntityTransaction transaction = em().getTransaction();
 		em().flush();
-		em().getTransaction().commit();
-		em().getTransaction().begin();
+		if (transaction != null && transaction.isActive()) {
+			em().getTransaction().commit();
+		}
 	}
 
 	static public void setUserPrincipal(String userPrincipal) {
diff --git a/siga-base/src/main/java/br/gov/jfrj/siga/model/SelecaoGenerica.java b/siga-base/src/main/java/br/gov/jfrj/siga/model/SelecaoGenerica.java
new file mode 100644
index 0000000000..8f44f2a9fd
--- /dev/null
+++ b/siga-base/src/main/java/br/gov/jfrj/siga/model/SelecaoGenerica.java
@@ -0,0 +1,44 @@
+/*******************************************************************************
+ * Copyright (c) 2006 - 2011 SJRJ.
+ * 
+ *     This file is part of SIGA.
+ * 
+ *     SIGA is free software: you can redistribute it and/or modify
+ *     it under the terms of the GNU General Public License as published by
+ *     the Free Software Foundation, either version 3 of the License, or
+ *     (at your option) any later version.
+ * 
+ *     SIGA is distributed in the hope that it will be useful,
+ *     but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *     GNU General Public License for more details.
+ * 
+ *     You should have received a copy of the GNU General Public License
+ *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
+ ******************************************************************************/
+package br.gov.jfrj.siga.model;
+
+import br.gov.jfrj.siga.base.AplicacaoException;
+
+public class SelecaoGenerica extends Selecao {
+
+	@Override
+	public String getAcaoBusca() {
+		return null;
+	}
+
+	@Override
+	public boolean buscarPorId() throws AplicacaoException {
+		return false;
+	}
+
+	@Override
+	public Selecionavel buscarObjeto() throws AplicacaoException {
+		return null;
+	}
+
+	@Override
+	public boolean buscarPorSigla() throws AplicacaoException {
+		return false;
+	}
+}
diff --git a/siga-cp-sinc/.gitignore b/siga-cp-sinc/.gitignore
deleted file mode 100644
index 934e0e06ff..0000000000
--- a/siga-cp-sinc/.gitignore
+++ /dev/null
@@ -1,2 +0,0 @@
-/bin
-/target
diff --git a/siga-cp-sinc/COPYING b/siga-cp-sinc/COPYING
deleted file mode 100644
index 94a9ed024d..0000000000
--- a/siga-cp-sinc/COPYING
+++ /dev/null
@@ -1,674 +0,0 @@
-                    GNU GENERAL PUBLIC LICENSE
-                       Version 3, 29 June 2007
-
- Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/>
- Everyone is permitted to copy and distribute verbatim copies
- of this license document, but changing it is not allowed.
-
-                            Preamble
-
-  The GNU General Public License is a free, copyleft license for
-software and other kinds of works.
-
-  The licenses for most software and other practical works are designed
-to take away your freedom to share and change the works.  By contrast,
-the GNU General Public License is intended to guarantee your freedom to
-share and change all versions of a program--to make sure it remains free
-software for all its users.  We, the Free Software Foundation, use the
-GNU General Public License for most of our software; it applies also to
-any other work released this way by its authors.  You can apply it to
-your programs, too.
-
-  When we speak of free software, we are referring to freedom, not
-price.  Our General Public Licenses are designed to make sure that you
-have the freedom to distribute copies of free software (and charge for
-them if you wish), that you receive source code or can get it if you
-want it, that you can change the software or use pieces of it in new
-free programs, and that you know you can do these things.
-
-  To protect your rights, we need to prevent others from denying you
-these rights or asking you to surrender the rights.  Therefore, you have
-certain responsibilities if you distribute copies of the software, or if
-you modify it: responsibilities to respect the freedom of others.
-
-  For example, if you distribute copies of such a program, whether
-gratis or for a fee, you must pass on to the recipients the same
-freedoms that you received.  You must make sure that they, too, receive
-or can get the source code.  And you must show them these terms so they
-know their rights.
-
-  Developers that use the GNU GPL protect your rights with two steps:
-(1) assert copyright on the software, and (2) offer you this License
-giving you legal permission to copy, distribute and/or modify it.
-
-  For the developers' and authors' protection, the GPL clearly explains
-that there is no warranty for this free software.  For both users' and
-authors' sake, the GPL requires that modified versions be marked as
-changed, so that their problems will not be attributed erroneously to
-authors of previous versions.
-
-  Some devices are designed to deny users access to install or run
-modified versions of the software inside them, although the manufacturer
-can do so.  This is fundamentally incompatible with the aim of
-protecting users' freedom to change the software.  The systematic
-pattern of such abuse occurs in the area of products for individuals to
-use, which is precisely where it is most unacceptable.  Therefore, we
-have designed this version of the GPL to prohibit the practice for those
-products.  If such problems arise substantially in other domains, we
-stand ready to extend this provision to those domains in future versions
-of the GPL, as needed to protect the freedom of users.
-
-  Finally, every program is threatened constantly by software patents.
-States should not allow patents to restrict development and use of
-software on general-purpose computers, but in those that do, we wish to
-avoid the special danger that patents applied to a free program could
-make it effectively proprietary.  To prevent this, the GPL assures that
-patents cannot be used to render the program non-free.
-
-  The precise terms and conditions for copying, distribution and
-modification follow.
-
-                       TERMS AND CONDITIONS
-
-  0. Definitions.
-
-  "This License" refers to version 3 of the GNU General Public License.
-
-  "Copyright" also means copyright-like laws that apply to other kinds of
-works, such as semiconductor masks.
-
-  "The Program" refers to any copyrightable work licensed under this
-License.  Each licensee is addressed as "you".  "Licensees" and
-"recipients" may be individuals or organizations.
-
-  To "modify" a work means to copy from or adapt all or part of the work
-in a fashion requiring copyright permission, other than the making of an
-exact copy.  The resulting work is called a "modified version" of the
-earlier work or a work "based on" the earlier work.
-
-  A "covered work" means either the unmodified Program or a work based
-on the Program.
-
-  To "propagate" a work means to do anything with it that, without
-permission, would make you directly or secondarily liable for
-infringement under applicable copyright law, except executing it on a
-computer or modifying a private copy.  Propagation includes copying,
-distribution (with or without modification), making available to the
-public, and in some countries other activities as well.
-
-  To "convey" a work means any kind of propagation that enables other
-parties to make or receive copies.  Mere interaction with a user through
-a computer network, with no transfer of a copy, is not conveying.
-
-  An interactive user interface displays "Appropriate Legal Notices"
-to the extent that it includes a convenient and prominently visible
-feature that (1) displays an appropriate copyright notice, and (2)
-tells the user that there is no warranty for the work (except to the
-extent that warranties are provided), that licensees may convey the
-work under this License, and how to view a copy of this License.  If
-the interface presents a list of user commands or options, such as a
-menu, a prominent item in the list meets this criterion.
-
-  1. Source Code.
-
-  The "source code" for a work means the preferred form of the work
-for making modifications to it.  "Object code" means any non-source
-form of a work.
-
-  A "Standard Interface" means an interface that either is an official
-standard defined by a recognized standards body, or, in the case of
-interfaces specified for a particular programming language, one that
-is widely used among developers working in that language.
-
-  The "System Libraries" of an executable work include anything, other
-than the work as a whole, that (a) is included in the normal form of
-packaging a Major Component, but which is not part of that Major
-Component, and (b) serves only to enable use of the work with that
-Major Component, or to implement a Standard Interface for which an
-implementation is available to the public in source code form.  A
-"Major Component", in this context, means a major essential component
-(kernel, window system, and so on) of the specific operating system
-(if any) on which the executable work runs, or a compiler used to
-produce the work, or an object code interpreter used to run it.
-
-  The "Corresponding Source" for a work in object code form means all
-the source code needed to generate, install, and (for an executable
-work) run the object code and to modify the work, including scripts to
-control those activities.  However, it does not include the work's
-System Libraries, or general-purpose tools or generally available free
-programs which are used unmodified in performing those activities but
-which are not part of the work.  For example, Corresponding Source
-includes interface definition files associated with source files for
-the work, and the source code for shared libraries and dynamically
-linked subprograms that the work is specifically designed to require,
-such as by intimate data communication or control flow between those
-subprograms and other parts of the work.
-
-  The Corresponding Source need not include anything that users
-can regenerate automatically from other parts of the Corresponding
-Source.
-
-  The Corresponding Source for a work in source code form is that
-same work.
-
-  2. Basic Permissions.
-
-  All rights granted under this License are granted for the term of
-copyright on the Program, and are irrevocable provided the stated
-conditions are met.  This License explicitly affirms your unlimited
-permission to run the unmodified Program.  The output from running a
-covered work is covered by this License only if the output, given its
-content, constitutes a covered work.  This License acknowledges your
-rights of fair use or other equivalent, as provided by copyright law.
-
-  You may make, run and propagate covered works that you do not
-convey, without conditions so long as your license otherwise remains
-in force.  You may convey covered works to others for the sole purpose
-of having them make modifications exclusively for you, or provide you
-with facilities for running those works, provided that you comply with
-the terms of this License in conveying all material for which you do
-not control copyright.  Those thus making or running the covered works
-for you must do so exclusively on your behalf, under your direction
-and control, on terms that prohibit them from making any copies of
-your copyrighted material outside their relationship with you.
-
-  Conveying under any other circumstances is permitted solely under
-the conditions stated below.  Sublicensing is not allowed; section 10
-makes it unnecessary.
-
-  3. Protecting Users' Legal Rights From Anti-Circumvention Law.
-
-  No covered work shall be deemed part of an effective technological
-measure under any applicable law fulfilling obligations under article
-11 of the WIPO copyright treaty adopted on 20 December 1996, or
-similar laws prohibiting or restricting circumvention of such
-measures.
-
-  When you convey a covered work, you waive any legal power to forbid
-circumvention of technological measures to the extent such circumvention
-is effected by exercising rights under this License with respect to
-the covered work, and you disclaim any intention to limit operation or
-modification of the work as a means of enforcing, against the work's
-users, your or third parties' legal rights to forbid circumvention of
-technological measures.
-
-  4. Conveying Verbatim Copies.
-
-  You may convey verbatim copies of the Program's source code as you
-receive it, in any medium, provided that you conspicuously and
-appropriately publish on each copy an appropriate copyright notice;
-keep intact all notices stating that this License and any
-non-permissive terms added in accord with section 7 apply to the code;
-keep intact all notices of the absence of any warranty; and give all
-recipients a copy of this License along with the Program.
-
-  You may charge any price or no price for each copy that you convey,
-and you may offer support or warranty protection for a fee.
-
-  5. Conveying Modified Source Versions.
-
-  You may convey a work based on the Program, or the modifications to
-produce it from the Program, in the form of source code under the
-terms of section 4, provided that you also meet all of these conditions:
-
-    a) The work must carry prominent notices stating that you modified
-    it, and giving a relevant date.
-
-    b) The work must carry prominent notices stating that it is
-    released under this License and any conditions added under section
-    7.  This requirement modifies the requirement in section 4 to
-    "keep intact all notices".
-
-    c) You must license the entire work, as a whole, under this
-    License to anyone who comes into possession of a copy.  This
-    License will therefore apply, along with any applicable section 7
-    additional terms, to the whole of the work, and all its parts,
-    regardless of how they are packaged.  This License gives no
-    permission to license the work in any other way, but it does not
-    invalidate such permission if you have separately received it.
-
-    d) If the work has interactive user interfaces, each must display
-    Appropriate Legal Notices; however, if the Program has interactive
-    interfaces that do not display Appropriate Legal Notices, your
-    work need not make them do so.
-
-  A compilation of a covered work with other separate and independent
-works, which are not by their nature extensions of the covered work,
-and which are not combined with it such as to form a larger program,
-in or on a volume of a storage or distribution medium, is called an
-"aggregate" if the compilation and its resulting copyright are not
-used to limit the access or legal rights of the compilation's users
-beyond what the individual works permit.  Inclusion of a covered work
-in an aggregate does not cause this License to apply to the other
-parts of the aggregate.
-
-  6. Conveying Non-Source Forms.
-
-  You may convey a covered work in object code form under the terms
-of sections 4 and 5, provided that you also convey the
-machine-readable Corresponding Source under the terms of this License,
-in one of these ways:
-
-    a) Convey the object code in, or embodied in, a physical product
-    (including a physical distribution medium), accompanied by the
-    Corresponding Source fixed on a durable physical medium
-    customarily used for software interchange.
-
-    b) Convey the object code in, or embodied in, a physical product
-    (including a physical distribution medium), accompanied by a
-    written offer, valid for at least three years and valid for as
-    long as you offer spare parts or customer support for that product
-    model, to give anyone who possesses the object code either (1) a
-    copy of the Corresponding Source for all the software in the
-    product that is covered by this License, on a durable physical
-    medium customarily used for software interchange, for a price no
-    more than your reasonable cost of physically performing this
-    conveying of source, or (2) access to copy the
-    Corresponding Source from a network server at no charge.
-
-    c) Convey individual copies of the object code with a copy of the
-    written offer to provide the Corresponding Source.  This
-    alternative is allowed only occasionally and noncommercially, and
-    only if you received the object code with such an offer, in accord
-    with subsection 6b.
-
-    d) Convey the object code by offering access from a designated
-    place (gratis or for a charge), and offer equivalent access to the
-    Corresponding Source in the same way through the same place at no
-    further charge.  You need not require recipients to copy the
-    Corresponding Source along with the object code.  If the place to
-    copy the object code is a network server, the Corresponding Source
-    may be on a different server (operated by you or a third party)
-    that supports equivalent copying facilities, provided you maintain
-    clear directions next to the object code saying where to find the
-    Corresponding Source.  Regardless of what server hosts the
-    Corresponding Source, you remain obligated to ensure that it is
-    available for as long as needed to satisfy these requirements.
-
-    e) Convey the object code using peer-to-peer transmission, provided
-    you inform other peers where the object code and Corresponding
-    Source of the work are being offered to the general public at no
-    charge under subsection 6d.
-
-  A separable portion of the object code, whose source code is excluded
-from the Corresponding Source as a System Library, need not be
-included in conveying the object code work.
-
-  A "User Product" is either (1) a "consumer product", which means any
-tangible personal property which is normally used for personal, family,
-or household purposes, or (2) anything designed or sold for incorporation
-into a dwelling.  In determining whether a product is a consumer product,
-doubtful cases shall be resolved in favor of coverage.  For a particular
-product received by a particular user, "normally used" refers to a
-typical or common use of that class of product, regardless of the status
-of the particular user or of the way in which the particular user
-actually uses, or expects or is expected to use, the product.  A product
-is a consumer product regardless of whether the product has substantial
-commercial, industrial or non-consumer uses, unless such uses represent
-the only significant mode of use of the product.
-
-  "Installation Information" for a User Product means any methods,
-procedures, authorization keys, or other information required to install
-and execute modified versions of a covered work in that User Product from
-a modified version of its Corresponding Source.  The information must
-suffice to ensure that the continued functioning of the modified object
-code is in no case prevented or interfered with solely because
-modification has been made.
-
-  If you convey an object code work under this section in, or with, or
-specifically for use in, a User Product, and the conveying occurs as
-part of a transaction in which the right of possession and use of the
-User Product is transferred to the recipient in perpetuity or for a
-fixed term (regardless of how the transaction is characterized), the
-Corresponding Source conveyed under this section must be accompanied
-by the Installation Information.  But this requirement does not apply
-if neither you nor any third party retains the ability to install
-modified object code on the User Product (for example, the work has
-been installed in ROM).
-
-  The requirement to provide Installation Information does not include a
-requirement to continue to provide support service, warranty, or updates
-for a work that has been modified or installed by the recipient, or for
-the User Product in which it has been modified or installed.  Access to a
-network may be denied when the modification itself materially and
-adversely affects the operation of the network or violates the rules and
-protocols for communication across the network.
-
-  Corresponding Source conveyed, and Installation Information provided,
-in accord with this section must be in a format that is publicly
-documented (and with an implementation available to the public in
-source code form), and must require no special password or key for
-unpacking, reading or copying.
-
-  7. Additional Terms.
-
-  "Additional permissions" are terms that supplement the terms of this
-License by making exceptions from one or more of its conditions.
-Additional permissions that are applicable to the entire Program shall
-be treated as though they were included in this License, to the extent
-that they are valid under applicable law.  If additional permissions
-apply only to part of the Program, that part may be used separately
-under those permissions, but the entire Program remains governed by
-this License without regard to the additional permissions.
-
-  When you convey a copy of a covered work, you may at your option
-remove any additional permissions from that copy, or from any part of
-it.  (Additional permissions may be written to require their own
-removal in certain cases when you modify the work.)  You may place
-additional permissions on material, added by you to a covered work,
-for which you have or can give appropriate copyright permission.
-
-  Notwithstanding any other provision of this License, for material you
-add to a covered work, you may (if authorized by the copyright holders of
-that material) supplement the terms of this License with terms:
-
-    a) Disclaiming warranty or limiting liability differently from the
-    terms of sections 15 and 16 of this License; or
-
-    b) Requiring preservation of specified reasonable legal notices or
-    author attributions in that material or in the Appropriate Legal
-    Notices displayed by works containing it; or
-
-    c) Prohibiting misrepresentation of the origin of that material, or
-    requiring that modified versions of such material be marked in
-    reasonable ways as different from the original version; or
-
-    d) Limiting the use for publicity purposes of names of licensors or
-    authors of the material; or
-
-    e) Declining to grant rights under trademark law for use of some
-    trade names, trademarks, or service marks; or
-
-    f) Requiring indemnification of licensors and authors of that
-    material by anyone who conveys the material (or modified versions of
-    it) with contractual assumptions of liability to the recipient, for
-    any liability that these contractual assumptions directly impose on
-    those licensors and authors.
-
-  All other non-permissive additional terms are considered "further
-restrictions" within the meaning of section 10.  If the Program as you
-received it, or any part of it, contains a notice stating that it is
-governed by this License along with a term that is a further
-restriction, you may remove that term.  If a license document contains
-a further restriction but permits relicensing or conveying under this
-License, you may add to a covered work material governed by the terms
-of that license document, provided that the further restriction does
-not survive such relicensing or conveying.
-
-  If you add terms to a covered work in accord with this section, you
-must place, in the relevant source files, a statement of the
-additional terms that apply to those files, or a notice indicating
-where to find the applicable terms.
-
-  Additional terms, permissive or non-permissive, may be stated in the
-form of a separately written license, or stated as exceptions;
-the above requirements apply either way.
-
-  8. Termination.
-
-  You may not propagate or modify a covered work except as expressly
-provided under this License.  Any attempt otherwise to propagate or
-modify it is void, and will automatically terminate your rights under
-this License (including any patent licenses granted under the third
-paragraph of section 11).
-
-  However, if you cease all violation of this License, then your
-license from a particular copyright holder is reinstated (a)
-provisionally, unless and until the copyright holder explicitly and
-finally terminates your license, and (b) permanently, if the copyright
-holder fails to notify you of the violation by some reasonable means
-prior to 60 days after the cessation.
-
-  Moreover, your license from a particular copyright holder is
-reinstated permanently if the copyright holder notifies you of the
-violation by some reasonable means, this is the first time you have
-received notice of violation of this License (for any work) from that
-copyright holder, and you cure the violation prior to 30 days after
-your receipt of the notice.
-
-  Termination of your rights under this section does not terminate the
-licenses of parties who have received copies or rights from you under
-this License.  If your rights have been terminated and not permanently
-reinstated, you do not qualify to receive new licenses for the same
-material under section 10.
-
-  9. Acceptance Not Required for Having Copies.
-
-  You are not required to accept this License in order to receive or
-run a copy of the Program.  Ancillary propagation of a covered work
-occurring solely as a consequence of using peer-to-peer transmission
-to receive a copy likewise does not require acceptance.  However,
-nothing other than this License grants you permission to propagate or
-modify any covered work.  These actions infringe copyright if you do
-not accept this License.  Therefore, by modifying or propagating a
-covered work, you indicate your acceptance of this License to do so.
-
-  10. Automatic Licensing of Downstream Recipients.
-
-  Each time you convey a covered work, the recipient automatically
-receives a license from the original licensors, to run, modify and
-propagate that work, subject to this License.  You are not responsible
-for enforcing compliance by third parties with this License.
-
-  An "entity transaction" is a transaction transferring control of an
-organization, or substantially all assets of one, or subdividing an
-organization, or merging organizations.  If propagation of a covered
-work results from an entity transaction, each party to that
-transaction who receives a copy of the work also receives whatever
-licenses to the work the party's predecessor in interest had or could
-give under the previous paragraph, plus a right to possession of the
-Corresponding Source of the work from the predecessor in interest, if
-the predecessor has it or can get it with reasonable efforts.
-
-  You may not impose any further restrictions on the exercise of the
-rights granted or affirmed under this License.  For example, you may
-not impose a license fee, royalty, or other charge for exercise of
-rights granted under this License, and you may not initiate litigation
-(including a cross-claim or counterclaim in a lawsuit) alleging that
-any patent claim is infringed by making, using, selling, offering for
-sale, or importing the Program or any portion of it.
-
-  11. Patents.
-
-  A "contributor" is a copyright holder who authorizes use under this
-License of the Program or a work on which the Program is based.  The
-work thus licensed is called the contributor's "contributor version".
-
-  A contributor's "essential patent claims" are all patent claims
-owned or controlled by the contributor, whether already acquired or
-hereafter acquired, that would be infringed by some manner, permitted
-by this License, of making, using, or selling its contributor version,
-but do not include claims that would be infringed only as a
-consequence of further modification of the contributor version.  For
-purposes of this definition, "control" includes the right to grant
-patent sublicenses in a manner consistent with the requirements of
-this License.
-
-  Each contributor grants you a non-exclusive, worldwide, royalty-free
-patent license under the contributor's essential patent claims, to
-make, use, sell, offer for sale, import and otherwise run, modify and
-propagate the contents of its contributor version.
-
-  In the following three paragraphs, a "patent license" is any express
-agreement or commitment, however denominated, not to enforce a patent
-(such as an express permission to practice a patent or covenant not to
-sue for patent infringement).  To "grant" such a patent license to a
-party means to make such an agreement or commitment not to enforce a
-patent against the party.
-
-  If you convey a covered work, knowingly relying on a patent license,
-and the Corresponding Source of the work is not available for anyone
-to copy, free of charge and under the terms of this License, through a
-publicly available network server or other readily accessible means,
-then you must either (1) cause the Corresponding Source to be so
-available, or (2) arrange to deprive yourself of the benefit of the
-patent license for this particular work, or (3) arrange, in a manner
-consistent with the requirements of this License, to extend the patent
-license to downstream recipients.  "Knowingly relying" means you have
-actual knowledge that, but for the patent license, your conveying the
-covered work in a country, or your recipient's use of the covered work
-in a country, would infringe one or more identifiable patents in that
-country that you have reason to believe are valid.
-
-  If, pursuant to or in connection with a single transaction or
-arrangement, you convey, or propagate by procuring conveyance of, a
-covered work, and grant a patent license to some of the parties
-receiving the covered work authorizing them to use, propagate, modify
-or convey a specific copy of the covered work, then the patent license
-you grant is automatically extended to all recipients of the covered
-work and works based on it.
-
-  A patent license is "discriminatory" if it does not include within
-the scope of its coverage, prohibits the exercise of, or is
-conditioned on the non-exercise of one or more of the rights that are
-specifically granted under this License.  You may not convey a covered
-work if you are a party to an arrangement with a third party that is
-in the business of distributing software, under which you make payment
-to the third party based on the extent of your activity of conveying
-the work, and under which the third party grants, to any of the
-parties who would receive the covered work from you, a discriminatory
-patent license (a) in connection with copies of the covered work
-conveyed by you (or copies made from those copies), or (b) primarily
-for and in connection with specific products or compilations that
-contain the covered work, unless you entered into that arrangement,
-or that patent license was granted, prior to 28 March 2007.
-
-  Nothing in this License shall be construed as excluding or limiting
-any implied license or other defenses to infringement that may
-otherwise be available to you under applicable patent law.
-
-  12. No Surrender of Others' Freedom.
-
-  If conditions are imposed on you (whether by court order, agreement or
-otherwise) that contradict the conditions of this License, they do not
-excuse you from the conditions of this License.  If you cannot convey a
-covered work so as to satisfy simultaneously your obligations under this
-License and any other pertinent obligations, then as a consequence you may
-not convey it at all.  For example, if you agree to terms that obligate you
-to collect a royalty for further conveying from those to whom you convey
-the Program, the only way you could satisfy both those terms and this
-License would be to refrain entirely from conveying the Program.
-
-  13. Use with the GNU Affero General Public License.
-
-  Notwithstanding any other provision of this License, you have
-permission to link or combine any covered work with a work licensed
-under version 3 of the GNU Affero General Public License into a single
-combined work, and to convey the resulting work.  The terms of this
-License will continue to apply to the part which is the covered work,
-but the special requirements of the GNU Affero General Public License,
-section 13, concerning interaction through a network will apply to the
-combination as such.
-
-  14. Revised Versions of this License.
-
-  The Free Software Foundation may publish revised and/or new versions of
-the GNU General Public License from time to time.  Such new versions will
-be similar in spirit to the present version, but may differ in detail to
-address new problems or concerns.
-
-  Each version is given a distinguishing version number.  If the
-Program specifies that a certain numbered version of the GNU General
-Public License "or any later version" applies to it, you have the
-option of following the terms and conditions either of that numbered
-version or of any later version published by the Free Software
-Foundation.  If the Program does not specify a version number of the
-GNU General Public License, you may choose any version ever published
-by the Free Software Foundation.
-
-  If the Program specifies that a proxy can decide which future
-versions of the GNU General Public License can be used, that proxy's
-public statement of acceptance of a version permanently authorizes you
-to choose that version for the Program.
-
-  Later license versions may give you additional or different
-permissions.  However, no additional obligations are imposed on any
-author or copyright holder as a result of your choosing to follow a
-later version.
-
-  15. Disclaimer of Warranty.
-
-  THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
-APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
-HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
-OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
-THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
-IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
-ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
-
-  16. Limitation of Liability.
-
-  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
-WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
-THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
-GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
-USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
-DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
-PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
-EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
-SUCH DAMAGES.
-
-  17. Interpretation of Sections 15 and 16.
-
-  If the disclaimer of warranty and limitation of liability provided
-above cannot be given local legal effect according to their terms,
-reviewing courts shall apply local law that most closely approximates
-an absolute waiver of all civil liability in connection with the
-Program, unless a warranty or assumption of liability accompanies a
-copy of the Program in return for a fee.
-
-                     END OF TERMS AND CONDITIONS
-
-            How to Apply These Terms to Your New Programs
-
-  If you develop a new program, and you want it to be of the greatest
-possible use to the public, the best way to achieve this is to make it
-free software which everyone can redistribute and change under these terms.
-
-  To do so, attach the following notices to the program.  It is safest
-to attach them to the start of each source file to most effectively
-state the exclusion of warranty; and each file should have at least
-the "copyright" line and a pointer to where the full notice is found.
-
-    <one line to give the program's name and a brief idea of what it does.>
-    Copyright (C) <year>  <name of author>
-
-    This program is free software: you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-
-Also add information on how to contact you by electronic and paper mail.
-
-  If the program does terminal interaction, make it output a short
-notice like this when it starts in an interactive mode:
-
-    <program>  Copyright (C) <year>  <name of author>
-    This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
-    This is free software, and you are welcome to redistribute it
-    under certain conditions; type `show c' for details.
-
-The hypothetical commands `show w' and `show c' should show the appropriate
-parts of the General Public License.  Of course, your program's commands
-might be different; for a GUI interface, you would use an "about box".
-
-  You should also get your employer (if you work as a programmer) or school,
-if any, to sign a "copyright disclaimer" for the program, if necessary.
-For more information on this, and how to apply and follow the GNU GPL, see
-<http://www.gnu.org/licenses/>.
-
-  The GNU General Public License does not permit incorporating your program
-into proprietary programs.  If your program is a subroutine library, you
-may consider it more useful to permit linking proprietary applications with
-the library.  If this is what you want to do, use the GNU Lesser General
-Public License instead of this License.  But first, please read
-<http://www.gnu.org/philosophy/why-not-lgpl.html>.
diff --git a/siga-cp-sinc/certificado/SSLCertScanner.exe b/siga-cp-sinc/certificado/SSLCertScanner.exe
deleted file mode 100644
index eab9094b68..0000000000
Binary files a/siga-cp-sinc/certificado/SSLCertScanner.exe and /dev/null differ
diff --git a/siga-cp-sinc/certificado/certmgr.exe b/siga-cp-sinc/certificado/certmgr.exe
deleted file mode 100644
index 850a644f1f..0000000000
Binary files a/siga-cp-sinc/certificado/certmgr.exe and /dev/null differ
diff --git a/siga-cp-sinc/certificado/criar autoridade certificadora.bat b/siga-cp-sinc/certificado/criar autoridade certificadora.bat
deleted file mode 100644
index c397955b01..0000000000
--- a/siga-cp-sinc/certificado/criar autoridade certificadora.bat	
+++ /dev/null
@@ -1 +0,0 @@
-makecert -pe -n "CN=Autoridade Raiz de Desenvolvimento e Teste da SJRJ" -ss my -sr LocalMachine -a sha1 -sky signature -r "Autoridade Raiz de Desenvolvimento e Teste da SJRJ.cer"
\ No newline at end of file
diff --git a/siga-cp-sinc/certificado/criar certificado maquina.bat b/siga-cp-sinc/certificado/criar certificado maquina.bat
deleted file mode 100644
index 867325b29c..0000000000
--- a/siga-cp-sinc/certificado/criar certificado maquina.bat	
+++ /dev/null
@@ -1 +0,0 @@
-makecert -pe -n "CN=csis-11.corp.jfrj.gov.br" -ss my -sr LocalMachine -a sha1 -sky exchange -eku 1.3.6.1.5.5.7.3.1 -in "Autoridade Raiz de Desenvolvimento e Teste da SJRJ" -is MY -ir LocalMachine -sp "Microsoft RSA SChannel Cryptographic Provider" -sy 12 "Servidor de Desenvolvimento e Teste CSIS-11.cer"
\ No newline at end of file
diff --git a/siga-cp-sinc/certificado/importar certificado.bat b/siga-cp-sinc/certificado/importar certificado.bat
deleted file mode 100644
index 2cc4820ad7..0000000000
--- a/siga-cp-sinc/certificado/importar certificado.bat	
+++ /dev/null
@@ -1 +0,0 @@
-keytool -import -alias _____autoridade_raiz -keystore <caminho para o arquivo que contém os certificados do java> -file <caminho para o certificado da autoridade criada anteriormente>
\ No newline at end of file
diff --git a/siga-cp-sinc/certificado/makecert.exe b/siga-cp-sinc/certificado/makecert.exe
deleted file mode 100644
index 4ec330a14a..0000000000
Binary files a/siga-cp-sinc/certificado/makecert.exe and /dev/null differ
diff --git a/siga-cp-sinc/certificado/makecert.txt b/siga-cp-sinc/certificado/makecert.txt
deleted file mode 100644
index 0fea2bd508..0000000000
--- a/siga-cp-sinc/certificado/makecert.txt
+++ /dev/null
@@ -1,19 +0,0 @@
-1 - Execute o no DOS o comando:
-makecert -pe -sk MY -n "CN=Fulano de Tal,OU=MPS Curitiba,O=MPS Informatica,C=BR" -m 3 -ss MY -r
-(Não esqueça de ir no diretorio I:\Justica2\JFRJ\Processo Eletronico\Certificados para executar 
-o comando)
-CN: commom name
-OU: organization unit
-O: organization
-C: country
-
--m: meses de validade
--ss: system store
--r: auto-registrado
-
-2 - Execute o certmgr.exe (I:\Justica2\JFRJ\Processo Eletronico\Certificados)
-3 - Na tab Pessoal selecione o seu certificado e precione Exportar
-4 - Marque a opção "Sim, exportar a chave particular"
-5 - Digite a senha e confirme
-6 - Escolha um diretório e um nome para o arquivo que será gerado
-7 - Va no modulo TabCad e importe o arquivo gerado para o banco (Menu Usuario -> Cadastro de Certificado)
\ No newline at end of file
diff --git a/siga-cp-sinc/certificado/my b/siga-cp-sinc/certificado/my
deleted file mode 100644
index ccf58e9ad2..0000000000
Binary files a/siga-cp-sinc/certificado/my and /dev/null differ
diff --git a/siga-cp-sinc/pom.xml b/siga-cp-sinc/pom.xml
deleted file mode 100644
index 2523769437..0000000000
--- a/siga-cp-sinc/pom.xml
+++ /dev/null
@@ -1,88 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
-
-	<parent>
-		<groupId>siga</groupId>
-		<artifactId>siga-doc</artifactId>
-		<version>1.2-SNAPSHOT</version>
-	</parent>
-
-	<modelVersion>4.0.0</modelVersion>
-
-	<artifactId>siga-cp-sinc</artifactId>
-
-	<build>
-		<plugins>
-			<plugin>
-				<groupId>org.apache.maven.plugins</groupId>
-				<artifactId>maven-jar-plugin</artifactId>
-				<configuration>
-					<archive>
-						<manifest>
-							<mainClass>br.gov.jfrj.importar.SigaCpSinc</mainClass>
-						</manifest>
-					</archive>
-				</configuration>
-			</plugin>
-			<plugin>
-				<groupId>com.jolira</groupId>
-				<artifactId>onejar-maven-plugin</artifactId>
-				<executions>
-					<execution>
-						<configuration>
-							<!-- Optional, default is false -->
-							<attachToBuild>true</attachToBuild>
-						</configuration>
-						<goals>
-							<goal>one-jar</goal>
-						</goals>
-					</execution>
-				</executions>
-			</plugin>
-		</plugins>
-	</build>
-
-	<dependencies>
-		<dependency>
-			<groupId>siga</groupId>
-			<artifactId>siga-sinc-lib</artifactId>
-		</dependency>
-		<dependency>
-			<groupId>siga</groupId>
-			<artifactId>siga-cp</artifactId>
-		</dependency>
-
-		<dependency>
-			<groupId>net.sf.kxml</groupId>
-			<artifactId>kxml2</artifactId>
-		</dependency>
-
-		<dependency>
-			<groupId>com.oracle</groupId>
-			<artifactId>ojdbc6</artifactId>
-			<version>11.2.0.3.0</version>
-			<scope>compile</scope>
-		</dependency>
-		<dependency>
-			<groupId>org.hibernate</groupId>
-			<artifactId>hibernate-core</artifactId>
-			<scope>compile</scope>
-		</dependency>
-
-		<dependency>
-			<groupId>org.jboss.as</groupId>
-			<artifactId>jboss-as-jpa-hibernate4</artifactId>
-			<version>7.2.0.Final</version>
-		</dependency>
-		
-		<dependency>
-			<groupId>javax.mail</groupId>
-			<artifactId>mail</artifactId>
-			<version>1.4.2</version>
-			<scope>compile</scope>
-		</dependency>
-		
-	</dependencies>
-
-</project>
\ No newline at end of file
diff --git a/siga-cp-sinc/src/main/java/br/gov/jfrj/importar/SincLogHandler.java b/siga-cp-sinc/src/main/java/br/gov/jfrj/importar/SincLogHandler.java
deleted file mode 100644
index 5871691017..0000000000
--- a/siga-cp-sinc/src/main/java/br/gov/jfrj/importar/SincLogHandler.java
+++ /dev/null
@@ -1,82 +0,0 @@
-package br.gov.jfrj.importar;
-
-import java.util.logging.Handler;
-import java.util.logging.LogRecord;
-
-import br.gov.jfrj.siga.base.Correio;
-import br.gov.jfrj.siga.base.SigaBaseProperties;
-
-/**
- * Tratador de logs de sincronismo que envia e-mail com relatório das operações
- * @author kpf
- *
- */
-public class SincLogHandler extends Handler {
-
-	private StringBuffer sb = new StringBuffer();
-	private String[] destinatariosEmail;
-	private String assunto = "Log de Importação";
-	
-	public SincLogHandler(){
-		
-	}
-	
-	public SincLogHandler(String[] destinatariosEmail, String Assunto) {
-		 this.destinatariosEmail = destinatariosEmail;
-	}
-
-	@Override
-	public void publish(LogRecord record) {
-		sb.append(record.getMessage());
-		sb.append("\n");
-	}
-
-	@Override
-	public void flush() {
-		// TODO Auto-generated method stub
-
-	}
-
-	@Override
-	public void close() throws SecurityException {
-		try {
-			enviarEmail();
-		} catch (Exception e) {
-			throw new RuntimeException("Não foi possível enviar o e-mail!");
-		}
-	}
-	
-	public void enviarEmail() throws Exception {
-		sb.append("Enviando e-mails para: ");
-		
-		for (String d : destinatariosEmail) {
-			sb.append(d);
-			sb.append(",\n");
-		}
-		
-		if (destinatariosEmail.length > 1){
-			sb.deleteCharAt(sb.lastIndexOf(","));
-		}
-		
-		Correio.enviar(
-				SigaBaseProperties.getString("servidor.smtp.usuario.remetente"),
-				getDestinatariosEmail(), getAssunto(), sb.toString(), null);
-	}
-
-	public String[] getDestinatariosEmail() {
-		return destinatariosEmail;
-	}
-
-	public void setDestinatariosEmail(String[] destinatariosEmail) {
-		this.destinatariosEmail = destinatariosEmail;
-	}
-
-	public String getAssunto() {
-		return assunto;
-	}
-
-	public void setAssunto(String assunto) {
-		this.assunto = assunto;
-	}
-
-}
diff --git a/siga-cp-sinc/src/main/java/br/gov/jfrj/siga/util/ImportarXmlProperties.java b/siga-cp-sinc/src/main/java/br/gov/jfrj/siga/util/ImportarXmlProperties.java
deleted file mode 100644
index f197be4872..0000000000
--- a/siga-cp-sinc/src/main/java/br/gov/jfrj/siga/util/ImportarXmlProperties.java
+++ /dev/null
@@ -1,79 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-/* 
- * Criado em  19/09/2005
- *
- *  To change the template for this generated file go to
- * Window - Preferences - Java - Code Style - Code Templates
- */
-package br.gov.jfrj.siga.util;
-
-import java.util.List;
-
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.base.SigaBaseProperties;
-
-public class ImportarXmlProperties extends SigaBaseProperties {
-	/*
-	 * 
-	 * Antes a classe se chamava Mensagens (foi renomeada - refactor)
-	 * 
-	 * Atenção: foi renomeada antes do código abaixo ser comentado
-	 */
-	/*
-	 * private static final String BUNDLE_NAME = "application";
-	 * 
-	 * private static final ResourceBundle RESOURCE_BUNDLE = ResourceBundle
-	 * .getBundle(ImportarXmlProperties.BUNDLE_NAME);
-	 * 
-	 * public static String getString(final String key) {
-	 * 
-	 * try { return ImportarXmlProperties.RESOURCE_BUNDLE.getString(key); }
-	 * catch (final MissingResourceException e) { return '!' + key + '!'; } }
-	 */
-	private ImportarXmlProperties() {
-		// construtor privado
-	}
-
-	@Override
-	public String getPrefixoModulo() {
-		return "siga.cp.sinc.xml";
-	}
-
-	private static SigaBaseProperties instance = new ImportarXmlProperties();
-
-	public static String getString(final String key) {
-		try {
-			return instance.obterPropriedade(key);
-		} catch (Exception e) {
-			e.printStackTrace();
-			return "";
-		}
-	}
-
-	public static List<String> getDiretorios() throws AplicacaoException {
-		try {
-			return instance.obterPropriedadeLista("diretorios");
-		} catch (Exception e) {
-			throw new AplicacaoException(
-					"Não foi possível encontrar servidores de e-mail no arquivo siga.properties. Ex: servidor.smtp.0 = nome_servidor_email");
-		}
-	}
-
-}
diff --git a/siga-cp-sinc/src/main/resources/manifest b/siga-cp-sinc/src/main/resources/manifest
deleted file mode 100644
index a6d7dd1b88..0000000000
--- a/siga-cp-sinc/src/main/resources/manifest
+++ /dev/null
@@ -1,3 +0,0 @@
-Manifest-Version: 1.0
-Main-Class: br.gov.jfrj.importar.GeraXml
-Class-Path: kxml2.jar Tidy.jar activation.jar antlr-2.7.5H3.jar asm.jar asm-attrs.jar bcprov-jdk15-131.jar c3p0-0.8.5.2.jar cglib-2.1.jar commons-beanutils.jar commons-collections.jar commons-collections-2.1.1.jar commons-digester.jar commons-fileupload.jar commons-logging.jar commons-validator.jar dom4j-1.6.jar ehcache-1.1.jar hibernate3.jar itext-1.3.jar jakarta-oro.jar jdbc2_0-stdext.jar jstl.jar jta.jar log4j-1.2.9.jar mail.jar standard.jar struts.jar xerces-2.6.2.jar xml-apis.jar ojdbc14.jar
diff --git a/siga-cp-sinc/src/manifest b/siga-cp-sinc/src/manifest
deleted file mode 100644
index a6d7dd1b88..0000000000
--- a/siga-cp-sinc/src/manifest
+++ /dev/null
@@ -1,3 +0,0 @@
-Manifest-Version: 1.0
-Main-Class: br.gov.jfrj.importar.GeraXml
-Class-Path: kxml2.jar Tidy.jar activation.jar antlr-2.7.5H3.jar asm.jar asm-attrs.jar bcprov-jdk15-131.jar c3p0-0.8.5.2.jar cglib-2.1.jar commons-beanutils.jar commons-collections.jar commons-collections-2.1.1.jar commons-digester.jar commons-fileupload.jar commons-logging.jar commons-validator.jar dom4j-1.6.jar ehcache-1.1.jar hibernate3.jar itext-1.3.jar jakarta-oro.jar jdbc2_0-stdext.jar jstl.jar jta.jar log4j-1.2.9.jar mail.jar standard.jar struts.jar xerces-2.6.2.jar xml-apis.jar ojdbc14.jar
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/ImportarXmlTest.java b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/ImportarXmlTest.java
deleted file mode 100644
index dbcbadb231..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/ImportarXmlTest.java
+++ /dev/null
@@ -1,102 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.xml.test;
-
-import java.io.InputStream;
-import java.util.Date;
-
-import org.hibernate.cfg.AnnotationConfiguration;
-
-import junit.framework.TestCase;
-import br.gov.jfrj.importar.SigaCpSinc;
-import br.gov.jfrj.siga.cp.bl.CpAmbienteEnumBL;
-import br.gov.jfrj.siga.dp.dao.CpDao;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
-
-public class ImportarXmlTest extends TestCase {
-	public static void testImportarXml() throws Exception {
-		// TODO: executar em homologação e produção : alter table
-		// corporativo.DP_PESSOA modify (SIGLA_PESSOA varchar2(20))
-		// IMPLANTACAO
-		// testImportarXml("implanta.xml");
-		// Teste SJRJ
-		testImportarXml("exp.xml");
-
-		// Teste com ORGAO e PAPEL
-		/*
-		 * testImportarXml("SigaCpSinc1.xml");
-		 * testImportarXml("SigaCpSinc2.xml");
-		 * testImportarXml("SigaCpSinc3.xml");
-		 * testImportarXml("SigaCpSinc4.xml");
-		 */
-
-		// Testes de duplicidade
-		// testImportarXml("SigaCpSincDup.xml");
-
-		// Teste ANS
-		// testImportarXml("siga_ans.xml");
-
-		// Teste TJ-PA
-		// testImportarXml("siga_tjpa.xml");
-
-		// Teste do exemplo do Roteiro
-		// testImportarXml("exemplo-roteiro.xml");
-		//
-		assertTrue(true);
-	}
-
-	public static void testImportarXml(String nomeArquivo) throws Exception {
-		if (nomeArquivo == null)
-			return;
-		// SigaCpSinc.processarTesteXML();
-		AnnotationConfiguration cfg;
-		// desenvolvimento
-		/*
-		 * cfg = CpDao.criarHibernateCfg("jdbc:oracle:thin:@servidor:1521:instancia",
-		 * "usuario", "senha");
-		 */
-		cfg = CpDao.criarHibernateCfg(CpAmbienteEnumBL.DESENVOLVIMENTO);
-		// cfg = CpDao.criarHibernateCfg(CpAmbienteEnumBL.HOMOLOGACAO);
-		HibernateUtil.configurarHibernate(cfg, "");
-
-		SigaCpSinc geraXml = new SigaCpSinc();
-
-		Date dt = new Date();
-		geraXml.log("--- Processando Teste " + dt + "--- ");
-		geraXml.log("--- Executando: CpDaoTest>>processarTesteXML()");
-		try {
-			geraXml.log("Importando: XML");
-			InputStream in = Class.forName(
-					"br.gov.jfrj.xml.test.ImportarXmlTest")
-					.getResourceAsStream(nomeArquivo);
-			geraXml.importarXml(in);
-			geraXml.log("Importando: BD");
-			geraXml.importarTabela();
-			geraXml.log("Gravando alterações");
-			geraXml.gravar(dt);
-
-		} catch (Exception e) {
-			e.printStackTrace();
-			geraXml.log(e.getMessage());
-		}
-		geraXml.log(" ---- Fim do Processamento --- ");
-		geraXml.logEnd();
-
-	}
-}
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc1.xml b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc1.xml
deleted file mode 100644
index c720fe65de..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc1.xml
+++ /dev/null
@@ -1,72 +0,0 @@
-<?xml version="1.0" encoding="ISO-8859-1"?>
-<base orgaoUsuario="TT" dataHora="01/02/2011 12:00:00" versao="2">  
-  <cargos>
-    <cargo 	id="9999" 
-			nome="CARGO DE TESTE"
-			sigla="CARGOTESTE"/>
-  </cargos>
-  <funcoes>
-    <funcao id="9999" 
-			nome="FUNCAO CONFIANCA DE TESTE"
-			sigla="FUNCAOTESTE"/>
-  </funcoes>
-  <orgaos>
-	<orgao 	id="999999999999"
-			nome="ORGAO DE TESTE INICIAL"
-			sigla="ORGAOTESTE"
-			/>
-  </orgaos>	
-  <lotacoes>
-    <lotacao id="999999999999" 
-			nome="LOTACAO DE TESTE" 
-			sigla="LOTACAOTESTE" 
-			idPai=""
-			tipoLotacao="Unidade Judicial"
-			/>
-  </lotacoes>
-  
-  <pessoas>
-    <pessoa id="99999999999"  
-			cpf="11111111111" 
-			nome="PESSOA DE TESTE"  
-			sexo="M" 
-			dtNascimento="26121962" 
-			nacionalidade="BRASILEIRA" 
-			rua="RUA DE TESTE" 
-			bairro="BAIRRO DE TESTE" 
-			cidade="RIO DE JANEIRO" 
-			uf="RJ" 
-			cep="20000000" 
-			telefone="2222222" 
-			naturalidade="RIO DE JANEIRO"
-			tipoSanguineo="B+" 
-			grauInstrucao="POS-GRADUADO" 
-			matricula="99999" 
-			dtInicioExercicio="01012011" 
-			atoNomeacao="123"
-			dtNomeacao="01012010" 
-			dtAtoPublicacao="01022010" 
-			dtPosse="02022010" 
-			cargo="9999"
-			padraoReferencia="C-NS-15" 
-			situacao="1" 
-			lotacao="999999999999" 
-			rg="06895900" 
-			rgOrgao="IFP"  
-			rgUf="RJ" 
-			rgDtExp="01012020" 
-			estCivil="1" 
-			sigla="TTT" 
-			email="AYM@jfrj.gov.br" 
-			funcaoConfianca="9999"
-			tipo="Servidor">
-			>
-			<papel 	id="99999999999001"    
-					tipo="Principal" 
-					cargo="9999" 
-					funcaoConfianca="9999" 
-					lotacao="999999999999"
-					/>
-	</pessoa>
-   </pessoas>
-</base>
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc2.xml b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc2.xml
deleted file mode 100644
index d27f99697a..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc2.xml
+++ /dev/null
@@ -1,135 +0,0 @@
-<?xml version="1.0" encoding="ISO-8859-1"?>
-<base orgaoUsuario="TT" dataHora="01/02/2011 12:00:00" versao="2">  
-  <cargos>
-    <cargo 	id="9999" 
-			nome="CARGO DE TESTE"
-			sigla="CARGOTESTE"/>
-  <cargo 	id="9998" 
-			nome="CARGO DE TESTE 2"
-			sigla="CARGOTESTE2"/>
-  </cargos>
-  <funcoes>
-    <funcao id="9999" 
-			nome="FUNCAO CONFIANCA DE TESTE"
-			sigla="FUNCAOTESTE"/>
-	<funcao id="9998" 
-			nome="FUNCAO CONFIANCA DE TESTE 2"
-			sigla="FUNCAOTESTE2"/>
-  </funcoes>
-  <orgaos>
-	<orgao 	id="999999999999"
-			nome="ORGAO DE TESTE"
-			sigla="ORGAOTESTE"
-			/>
-			<orgao 	id="999999999998"
-			nome="ORGAO DE TESTE 2I"
-			sigla="ORGAOTESTE2"
-			/>
-  </orgaos>	
-  <lotacoes>
-    <lotacao id="999999999999" 
-			nome="LOTACAO DE TESTE DESCRICAO ALTERADA" 
-			sigla="LOTACAOTESTEALT" 
-			idPai=""
-			tipoLotacao="Unidade Judicial"
-			/>
-			<lotacao id="999999999998" 
-			nome="LOTACAO DE TESTE 2" 
-			sigla="LOTACAOTESTE2" 
-			idPai=""
-			tipoLotacao="Unidade da Administra��o"
-			/>
-  </lotacoes>
-  <pessoas>
-    <pessoa id="99999999999"  
-			cpf="11111111111" 
-			nome="PESSOA DE TESTE"  
-			sexo="M" 
-			dtNascimento="26121962" 
-			nacionalidade="BRASILEIRA" 
-			rua="RUA DE TESTE" 
-			bairro="BAIRRO DE TESTE" 
-			cidade="RIO DE JANEIRO" 
-			uf="RJ" 
-			cep="20000000" 
-			telefone="2222222" 
-			naturalidade="RIO DE JANEIRO"
-			tipoSanguineo="B+" 
-			grauInstrucao="POS-GRADUADO" 
-			matricula="99999" 
-			dtInicioExercicio="01012011" 
-			atoNomeacao="123"
-			dtNomeacao="01012010" 
-			dtAtoPublicacao="01022010" 
-			dtPosse="02022010" 
-			cargo="9999"
-			padraoReferencia="C-NS-15" 
-			situacao="1" 
-			lotacao="999999999999" 
-			rg="06895900" 
-			rgOrgao="IFP"  
-			rgUf="RJ" 
-			rgDtExp="01012020" 
-			estCivil="1" 
-			sigla="TTT" 
-			email="TTT@jfrj.gov.br" 
-			funcaoConfianca="9999"
-			tipo="Servidor">
-			>
-			<papel 	id="99999999999001"    
-					tipo="Principal" 
-					cargo="9999" 
-					funcaoConfianca="9999" 
-					lotacao="999999999999"
-					/>
-					<papel 	id="99999999999002"    
-					tipo="Funcional" 
-					cargo="9999" 
-					funcaoConfianca="9998" 
-					lotacao="999999999999"
-					/>
-	</pessoa>
-	<pessoa id="99999999998"  
-			cpf="22222222222" 
-			nome="PESSOA DE TESTE 2"  
-			sexo="M" 
-			dtNascimento="26121962" 
-			nacionalidade="BRASILEIRA" 
-			rua="RUA DE TESTE" 
-			bairro="BAIRRO DE TESTE" 
-			cidade="RIO DE JANEIRO" 
-			uf="RJ" 
-			cep="20000000" 
-			telefone="2222223" 
-			naturalidade="RIO DE JANEIRO"
-			tipoSanguineo="AB+" 
-			grauInstrucao="POS-GRADUADO" 
-			matricula="99998" 
-			dtInicioExercicio="01012011" 
-			atoNomeacao="345"
-			dtNomeacao="01012010" 
-			dtAtoPublicacao="02022010" 
-			dtPosse="03022010" 
-			cargo="9999"
-			padraoReferencia="C-NS-10" 
-			situacao="1" 
-			lotacao="999999999998" 
-			rg="06895901" 
-			rgOrgao="IFP"  
-			rgUf="RJ" 
-			rgDtExp="01012020" 
-			estCivil="1" 
-			sigla="TT2" 
-			email="TT2@jfrj.gov.br" 
-			funcaoConfianca="9999"
-			tipo="Magistrado">
-			>
-			<papel 	id="99999999998001"    
-					tipo="Principal" 
-					cargo="9999" 
-					funcaoConfianca="9999" 
-					lotacao="999999999999"
-					/>
-	</pessoa>
-   </pessoas>
-</base>
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc3.xml b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc3.xml
deleted file mode 100644
index 1fd2a9b39c..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc3.xml
+++ /dev/null
@@ -1,136 +0,0 @@
-<?xml version="1.0" encoding="ISO-8859-1"?>
-<base orgaoUsuario="TT" dataHora="01/02/2011 12:00:00" versao="2">  
-  <cargos>
-    <cargo 	id="9999" 
-			nome="CARGO DE TESTE ALTERADO"
-			sigla="CARGOTESTE"/>
-  <cargo 	id="9998" 
-			nome="CARGO DE TESTE 2T"
-			sigla="CARGOTESTE2"/>
-  </cargos>
-  <funcoes>
-    <funcao id="9999" 
-			nome="FUNCAO CONFIANCA DE TESTEALTERADA"
-			sigla="FUNCAOTESTE"/>
-	<funcao id="9998" 
-			nome="FUNCAO CONFIANCA DE TESTE 2T"
-			sigla="FUNCAOTESTE2"/>
-  </funcoes>
-  <orgaos>
-	<orgao 	id="999999999999"
-			nome="ORGAO DE TESTE ALTERADO 2E"
-			sigla="ORGAOTESTE"
-			/>
-			<orgao 	id="999999999998"
-			nome="ORGAO DE TESTE 2T"
-			sigla="ORGAOTESTE2"
-			/>
-  </orgaos>	
-  <lotacoes>
-    <lotacao id="999999999999" 
-			nome="LOTACAO DE TESTE DESCRICAO ALTERADA 2T" 
-			sigla="LOTACAOTESTEALT" 
-			idPai=""
-			tipoLotacao="Unidade Judicial"
-			/>
-			<lotacao id="999999999998" 
-			nome="LOTACAO DE TESTE 2" 
-			sigla="LOTACAOTESTE2" 
-			idPai=""
-			tipoLotacao="Unidade da Administra��o"
-			/>
-  </lotacoes>
-  
-  <pessoas>
-    <pessoa id="99999999999"  
-			cpf="11111111111" 
-			nome="PESSOA DE TESTE ALTERADA"  
-			sexo="M" 
-			dtNascimento="26121962" 
-			nacionalidade="BRASILEIRA" 
-			rua="RUA DE TESTE" 
-			bairro="BAIRRO DE TESTE" 
-			cidade="RIO DE JANEIRO" 
-			uf="RJ" 
-			cep="20000000" 
-			telefone="2222222" 
-			naturalidade="RIO DE JANEIRO"
-			tipoSanguineo="B+" 
-			grauInstrucao="POS-GRADUADO" 
-			matricula="99999" 
-			dtInicioExercicio="01012011" 
-			atoNomeacao="123"
-			dtNomeacao="01012010" 
-			dtAtoPublicacao="01022010" 
-			dtPosse="02022010" 
-			cargo="9999"
-			padraoReferencia="C-NS-15" 
-			situacao="1" 
-			lotacao="999999999999" 
-			rg="06895900" 
-			rgOrgao="IFP"  
-			rgUf="RJ" 
-			rgDtExp="01012020" 
-			estCivil="1" 
-			sigla="TTT" 
-			email="TTT@jfrj.gov.br" 
-			funcaoConfianca="9999"
-			tipo="Servidor">
-			>
-			<papel 	id="99999999999001"    
-					tipo="Principal" 
-					cargo="9998" 
-					funcaoConfianca="9999" 
-					lotacao="999999999999"
-					/>
-					<papel 	id="99999999999002"    
-					tipo="Funcional" 
-					cargo="9999" 
-					funcaoConfianca="9998" 
-					lotacao="999999999999"
-					/>
-	</pessoa>
-	<pessoa id="99999999998"  
-			cpf="22222222222" 
-			nome="PESSOA DE TESTE 2T"  
-			sexo="M" 
-			dtNascimento="26121962" 
-			nacionalidade="BRASILEIRA" 
-			rua="RUA DE TESTE" 
-			bairro="BAIRRO DE TESTE" 
-			cidade="RIO DE JANEIRO" 
-			uf="RJ" 
-			cep="20000000" 
-			telefone="2222223" 
-			naturalidade="RIO DE JANEIRO"
-			tipoSanguineo="AB+" 
-			grauInstrucao="POS-GRADUADO" 
-			matricula="99998" 
-			dtInicioExercicio="01012011" 
-			atoNomeacao="345"
-			dtNomeacao="01012010" 
-			dtAtoPublicacao="02022010" 
-			dtPosse="03022010" 
-			cargo="9999"
-			padraoReferencia="C-NS-10" 
-			situacao="1" 
-			lotacao="999999999998" 
-			rg="06895901" 
-			rgOrgao="IFP"  
-			rgUf="RJ" 
-			rgDtExp="01012020" 
-			estCivil="1" 
-			sigla="TT2" 
-			email="TT2@jfrj.gov.br" 
-			funcaoConfianca="9999"
-			tipo="Magistrado">
-			>
-			<papel 	id="99999999998001"    
-					tipo="Principal" 
-					cargo="9998" 
-					funcaoConfianca="9998" 
-					lotacao="999999999999"
-					/>
-	</pessoa>
-   </pessoas>
-</base>
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc4.xml b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc4.xml
deleted file mode 100644
index ec779ae9be..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSinc4.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0" encoding="ISO-8859-1"?>
-<base orgaoUsuario="TT" dataHora="01/02/2011 12:00:00" versao="2">  
-  <cargos>
-  </cargos>
-  <funcoes>
-  </funcoes>
-  <orgaos>
-  </orgaos>	
-  <lotacoes>
-  </lotacoes>
-  <pessoas>
-   </pessoas>
-</base>
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSincDup.xml b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSincDup.xml
deleted file mode 100644
index 82f6692854..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/SigaCpSincDup.xml
+++ /dev/null
@@ -1,148 +0,0 @@
-<?xml version="1.0" encoding="ISO-8859-1"?>
-<base orgaoUsuario="TT" dataHora="01/02/2011 12:00:00" versao="2">  
-  <cargos>
-    <cargo 	id="9999" 
-			nome="CARGO DE TESTE"
-			sigla="CARGOTESTE"/>
-	<!-- <cargo 	id="99998" 
-			nome="CARGO DE TESTE"
-			sigla="CARGOTESTE"/> -->
-	<!--  <cargo 	id="9999" 
-			nome="CARGO DE TESTE"
-			sigla="CARGODUP"/>  -->
-  </cargos>
-  <funcoes>
-   <funcao id="9999" 
-			nome="FUNCAO CONFIANCA DE TESTE"
-			sigla="FUNCAOTESTE"/>
-	<!-- <funcao id="9998" 
-			nome="FUNCAO CONFIANCA DE TESTE"
-			sigla="FUNCAOTESTE"/>   -->
-	<!-- <funcao id="9999" 
-			nome="FUNCAO CONFIANCA DE TESTE DUP"
-			sigla="FUNCAODUP"/>  -->
-  </funcoes>
-  <orgaos>
-	<orgao 	id="999999999999"
-			nome="ORGAO DE TESTE INICIAL"
-			sigla="ORGAOTESTE"
-			/>
-		<!-- <orgao 	id="999999999998"
-			nome="ORGAO DE TESTE INICIAL"
-			sigla="ORGAOTESTE"
-			/>   -->
-	<!-- <orgao 	id="999999999999"
-			nome="ORGAO DE TESTE INICIAL"
-			sigla="ORGAODUP"
-			/>   -->
-  </orgaos>	
-  <lotacoes>
-    <lotacao id="999999999999" 
-			nome="LOTACAO DE TESTE" 
-			sigla="LOTACAOTESTE" 
-			idPai=""
-			tipoLotacao="Unidade Judicial"
-			/>
-	<!-- <lotacao id="999999999998" 
-			nome="LOTACAO DE TESTE" 
-			sigla="LOTACAOTESTE" 
-			idPai=""
-			tipoLotacao="Vara Federal"
-			/> -->
-			
-			<!-- <lotacao id="999999999999" 
-			nome="LOTACAO DE TESTE" 
-			sigla="LOTACAODUP" 
-			idPai=""
-			tipoLotacao="Unidade da Administra��o"
-			/>  -->
-  </lotacoes>
-  
-  <pessoas>
-    <pessoa id="99999999998"  
-			cpf="11111111112" 
-			nome="PESSOA DE TESTE"  
-			sexo="M" 
-			dtNascimento="26121962" 
-			nacionalidade="BRASILEIRA" 
-			rua="RUA DE TESTE" 
-			bairro="BAIRRO DE TESTE" 
-			cidade="RIO DE JANEIRO" 
-			uf="RJ" 
-			cep="20000000" 
-			telefone="2222222" 
-			naturalidade="RIO DE JANEIRO"
-			tipoSanguineo="B+" 
-			grauInstrucao="POS-GRADUADO" 
-			matricula="99999" 
-			dtInicioExercicio="01012011" 
-			atoNomeacao="123"
-			dtNomeacao="01012010" 
-			dtAtoPublicacao="01022010" 
-			dtPosse="02022010" 
-			cargo="9999"
-			padraoReferencia="C-NS-15" 
-			situacao="1" 
-			lotacao="999999999999" 
-			rg="06895900" 
-			rgOrgao="IFP"  
-			rgUf="RJ" 
-			rgDtExp="01012020" 
-			estCivil="1" 
-			sigla="TTX" 
-			email="AYM@jfrj.gov.br" 
-			funcaoConfianca="9999"
-			tipo="Servidor">
-			>
-			<papel 	id="99999999999001"    
-					tipo="Principal" 
-					cargo="9999" 
-					funcaoConfianca="9999" 
-					lotacao="999999999999"
-					/>
-	</pessoa>
-	 <pessoa id="99999999999"  
-			cpf="11111111111" 
-			nome="PESSOA DE TESTE"  
-			sexo="M" 
-			dtNascimento="26121962" 
-			nacionalidade="BRASILEIRA" 
-			rua="RUA DE TESTE" 
-			bairro="BAIRRO DE TESTE" 
-			cidade="RIO DE JANEIRO" 
-			uf="RJ" 
-			cep="20000000" 
-			telefone="2222222" 
-			naturalidade="RIO DE JANEIRO"
-			tipoSanguineo="B+" 
-			grauInstrucao="POS-GRADUADO" 
-			matricula="99999" 
-			dtInicioExercicio="01012011" 
-			atoNomeacao="123"
-			dtNomeacao="01012010" 
-			dtAtoPublicacao="01022010" 
-			dtPosse="02022010" 
-			cargo="9999"
-			padraoReferencia="C-NS-15" 
-			situacao="1" 
-			lotacao="999999999999" 
-			rg="06895900" 
-			rgOrgao="IFP"  
-			rgUf="RJ" 
-			rgDtExp="01012020" 
-			estCivil="1" 
-			sigla="TTT" 
-			email="AYM@jfrj.gov.br" 
-			funcaoConfianca="9999"
-			tipo="Servidor">
-			>
-			<papel 	id="99999999999001"    
-					tipo="Principal" 
-					cargo="9999" 
-					funcaoConfianca="9999" 
-					lotacao="999999999999"
-					/>
-	</pessoa>
-   </pessoas>
-</base>
-
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/exemplo-roteiro.xml b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/exemplo-roteiro.xml
deleted file mode 100644
index a8cf001e22..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/exemplo-roteiro.xml
+++ /dev/null
@@ -1,74 +0,0 @@
-<?xml version="1.0" encoding="ISO-8859-1" ?> 
-- <base orgaoUsuario="TT" dataHora="08/02/2011 14:34:22" versao="2" aditionalEmails="aym@jfrj.jus.br" >
-	- <cargos>
-		  <cargo id="7" nome="JUIZ FEDERAL" sigla="JFD"  /> 
-		  <cargo id="8" nome="JUIZ SUBSTITUTO - 2" sigla="JSB"   /> 
-		  <cargo id="10" nome="T�CNICO JUDICI�RIO" sigla="TJD"  /> 
-		  <cargo id="14" nome="OFICIAL DE JUSTI�A AVALIADOR" sigla="OJA"  /> 
-		  <cargo id="16" nome="TAQUIGRAFO JUDICIARIO" sigla="TQJ"  /> 
-		  <cargo id="46" nome="ENGENHEIRO" sigla="ENG"  /> 
-		  <cargo id="64" nome="ANALISTA DE SISTEMAS" sigla="ANL"  />  
-		  <cargo id="2131" nome="ANALISTA JUDICIARIO/INFORMATICA" sigla="AJI"  /> 
-		  <cargo id="2132" nome="TECNICO JUDICIARIO/INFORMATICA" sigla="TJI"  /> 
-	  </cargos>
-	- <funcoes>
-		  <funcao id="1" nome="DIRETOR GERAL" sigla="DGG"  /> 
-		  <funcao id="5" nome="DIRETOR DE SECRETARIA - 2" sigla="DSC"   /> 
-		  <funcao id="10" nome="DIRETOR DE SUBSECRETARIA" sigla="DSS"  /> 
-		  <funcao id="65" nome="SUPERVISOR" sigla="SUP"  /> 
-		  <funcao id="70" nome="SUPERVISOR ASSISTENTE" sigla="SPA"   /> 
-		  <funcao id="75" nome="ASSISTENTE DE INFORMATICA" sigla="ASI"  /> 
-		  <funcao id="80" nome="ASSISTENTE DATIL�GRAFO" sigla="DTL"  /> 
-		  <funcao id="85" nome="SECRET�RIO" sigla="SEC"  /> 
-		  <funcao id="90" nome="AUXILIAR ESPECIALIZADO" sigla="AUE"   /> 
-		  <funcao id="95" nome="AUXILIAR" sigla="AUX"  /> 
-		  <funcao id="105" nome="OPERADOR XEROX E TELEX" sigla="OXT"   /> 
-		  <funcao id="106" nome="OPERADOR DE V�DEO" sigla="OVD"  /> 
-		  <funcao id="110" nome="EXECUTANTE DE MANDADOS" sigla="EMD"   /> 
-	  </funcoes>
-	-	<orgaos>
-			<orgao id="316" nome="FUNDACAO GETULIO VARGAS" sigla="FGV"   /> 
-			<orgao id="278" nome="BOLSA DE VALORES DE SAO PAULO" sigla="BOVESPA"   /> 
-		</orgaos>
-	- <lotacoes>
-		  <lotacao id="0" nome="SE��O JUDICI�RIA da GUANABARA" idPai="" sigla="SJGN" tipoLotacao="Unidade Judicial" />
-		  <lotacao id="1040000000000" nome="DIR. DE INFORMATICA" sigla="DIINFO" idPai="0" tipoLotacao="Unidade da Administra��o"/> 
-		  <lotacao id="1380000000000" nome="GER�NCIA DE RISCOS" sigla="GERISC"  idPai="1040000000000" idPai="1040000000000" tipoLotacao="Unidade da Administra��o"/> 
-		  <lotacao id="1390000000000" nome="VARA FEDERAL VXIIM" sigla="VFXIIM"  idPai="0" tipoLotacao="Unidade Judicial" /> 
-		  <lotacao id="1400000000000" nome="VARA FEDERAL MXXVII" sigla="VFXXVI" idPai="0" tipoLotacao="Unidade Judicial"/> 
-		  <lotacao id="1410000000000" nome="VARA FEDERAL VLMXXI" sigla="VFLMXX" idPai="0" tipoLotacao="Unidade Judicial"/> 
-	  </lotacoes>
-	- <pessoas>
-	  	<pessoa id="11111111111" cpf="11111111111" nome="JOSE JORGE DA SILVA PEREIRA" dtNascimento="17031965" nacionalidade="BRASILEIRA"  rua="Av. Rio Branco 1/ ap.10017" bairro="CENTRO" cidade="RIO DE JANEIRO" uf="RJ" cep="20000000" telefone="333-2212" naturalidade="RIO DE JANEIRO" tipoSanguineo="O+" grauInstrucao="SUPERIOR COMPLETO" matricula="60022" dtInicioExercicio="07011971" atoNomeacao="000" dtNomeacao="07011971" dtAtoPublicacao="" dtPosse="07011971" cargo="10" padraoReferencia="C-NS-15" situacao="1" lotacao="1380000000000" rg="765412334" rgOrgao="CAER" rgUf="RJ" rgDtExp="01012020"  sigla="XWM" email="josejo@jfrj.gov.br" funcaoConfianca="75" tipo="Servidor">
-			<papel  id="3128"    
-				 tipo="Principal" 
-				 cargo="10" 
-				 funcaoConfianca="75" 
-				lotacao="1380000000000"
-				/>
-	  	</pessoa>
-		<pessoa id="22222222222" cpf="22222222222" nome="CARLOS JOSE MANOEL" sexo="M" dtNascimento="02111966"  nacionalidade="BRASILEIRA" rua="Av. Presidente Vargas" bairro="CENTRO" cidade="RIO DE JANEIRO" uf="RJ" cep="20000000" telefone="222-2222" naturalidade="" tipoSanguineo="O+" grauInstrucao="SUPERIOR COMPLETO" matricula="64262" dtInicioExercicio="14121972" atoNomeacao="000" dtNomeacao="14121972" dtAtoPublicacao="" dtPosse="14121972" cargo="46" padraoReferencia="C-NS-15" situacao="1" lotacao="1410000000000" rg="0120123456" rgOrgao="IFP" rgUf="RJ" rgDtExp="01021982" estCivil="1" sigla="CJM" email="mano@jfrj.gov.br" funcaoConfianca="90" tipo="Magistrado">  
-			<papel  id="3129"    
-				tipo="Principal" 
-				cargo="46"
-				funcaoConfianca="90" 
-				lotacao="1380000000000"
-				/>
-			<papel  id="3131"    
-				tipo="Funcional" 
-	 			cargo="46"
-				funcaoConfianca="75" 
-				lotacao="1400000000000"
-				/>
-		</pessoa>
-	   <pessoa id="33333333333" cpf="33333333333" nome="SILVIA AUREA PLATINA" sexo="F" dtNascimento="28041966" nacionalidade="BRASILEIRA" rua="Av. Sete de Setembro 3728/ ap.107" bairro="CENTRO" cidade="RIO DE JANEIRO" uf="RJ" cep="20000000" telefone="321-1212" naturalidade="RIO DE JANEIRO" tipoSanguineo="O+" grauInstrucao="SUPERIOR COMPLETO" matricula="56708" dtInicioExercicio="22051978" atoNomeacao="000" dtNomeacao="04051978" dtAtoPublicacao="" dtPosse="22051978" cargo="64" padraoReferencia="C-NS-15" situacao="1" lotacao="1400000000000" rg="013456376" rgOrgao="IFP" rgUf="RJ" sigla="SAP" email="laplata@jfrj.gov.br" funcaoConfianca="" tipo="Servidor"> 
-			<papel  id="3130"    
-				tipo="Principal" 
-	 			cargo="64"
-				funcaoConfianca="" 
-				lotacao="1400000000000"
-				/>
-		</pessoa>
-	  </pessoas>
-</base>
-
diff --git a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/implanta.xml b/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/implanta.xml
deleted file mode 100644
index fe13798c53..0000000000
--- a/siga-cp-sinc/src/test/br/gov/jfrj/xml/test/implanta.xml
+++ /dev/null
@@ -1,26 +0,0 @@
-<?xml version="1.0" encoding="ISO-8859-1" ?> 
-- <base orgaoUsuario="IP" dataHora="08/02/2011 14:34:22" versao="2" aditionalEmails="aym@jfrj.jus.br" >
-	- <cargos>
-		  <cargo id="1" nome="CARGO DE IMPLANTACAO" sigla="CARGOIMPL"  /> 
-	  </cargos>
-	- <funcoes>
-		  <funcao id="1" nome="FUNCAO DE IMPLANTACAO" sigla="FUNCIMPL"   /> 
-	  </funcoes>
-	-	<orgaos>
-			<orgao id="1" nome="ORGAO DE IMPLANTACAO" sigla="ORGIMPL"    />  
-		</orgaos>
-	- <lotacoes>
-		  <lotacao id="1000000000000" nome="LOTACAO DE IMPLANTACAO" sigla="DIINFO" idPai="" tipoLotacao="Unidade da Administra��o"/> 
-	  </lotacoes>
-	- <pessoas>
-	  	<pessoa id="11111111111" cpf="11111111111" nome="PESSOA DE IMPLANTACAO" dtNascimento="17031965" nacionalidade="BRASILEIRA"  rua="Av. Rio Branco 1/ ap.10017" bairro="CENTRO" cidade="RIO DE JANEIRO" uf="RJ" cep="20000000" telefone="333-2212" naturalidade="RIO DE JANEIRO" tipoSanguineo="O-" grauInstrucao="SUPERIOR COMPLETO" matricula="60022" dtInicioExercicio="07011971" atoNomeacao="000" dtNomeacao="07011971" dtAtoPublicacao="" dtPosse="07011971" cargo="1" padraoReferencia="C-NS-15" situacao="1" lotacao="1000000000000" rg="765412334" rgOrgao="CAER" rgUf="RJ" rgDtExp="01012020"  sigla="IMPL" email="impl@xxx.yyy.br" funcaoConfianca="1" tipo="Servidor">
-			<papel  id="11111111111"    
-				 tipo="Principal" 
-				 cargo="1" 
-				 funcaoConfianca="1" 
-				lotacao="1000000000000"
-				/>
-	  	</pessoa>
-	  </pessoas>
-</base>
-
diff --git a/siga-cp/pom.xml b/siga-cp/pom.xml
index 84e8e21fc1..4741f49228 100644
--- a/siga-cp/pom.xml
+++ b/siga-cp/pom.xml
@@ -1,5 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
 	<parent>
 		<artifactId>siga-doc</artifactId>
@@ -11,30 +12,6 @@
 
 	<artifactId>siga-cp</artifactId>
 
-	<build>
-		<plugins>
-			<plugin>
-				<groupId>org.codehaus.mojo</groupId>
-				<artifactId>build-helper-maven-plugin</artifactId>
-				<version>1.9</version>
-				<executions>
-					<execution>
-						<id>add-source</id>
-						<phase>generate-sources</phase>
-						<goals>
-							<goal>add-source</goal>
-						</goals>
-						<configuration>
-							<sources>
-								<source>src/main/app</source>
-							</sources>
-						</configuration>
-					</execution>
-				</executions>
-			</plugin>
-		</plugins>
-	</build>
-
 	<dependencies>
 
 		<dependency>
@@ -63,39 +40,44 @@
 			<groupId>net.sf.jasperreports</groupId>
 			<artifactId>jasperreports</artifactId>
 		</dependency>
-		
+
 		<dependency>
-		    <groupId>org.apache.commons</groupId>
-		    <artifactId>commons-collections4</artifactId>
-		    <version>4.1</version>
+			<groupId>org.apache.commons</groupId>
+			<artifactId>commons-collections4</artifactId>
+			<version>4.1</version>
 		</dependency>
-	
+
 		<dependency>
-		    <groupId>org.apache.poi</groupId>
-		    <artifactId>poi</artifactId>
+			<groupId>org.apache.poi</groupId>
+			<artifactId>poi</artifactId>
 		</dependency>
-		
+
 		<dependency>
-		    <groupId>org.apache.poi</groupId>
-		    <artifactId>poi-ooxml-schemas</artifactId>
-		    <version>3.12</version>
+			<groupId>org.apache.poi</groupId>
+			<artifactId>poi-ooxml-schemas</artifactId>
+			<version>3.12</version>
 		</dependency>
-		
+
 		<dependency>
-		    <groupId>org.apache.poi</groupId>
-		    <artifactId>poi-ooxml</artifactId>
-		    <version>3.12</version>
+			<groupId>org.apache.poi</groupId>
+			<artifactId>poi-ooxml</artifactId>
+			<version>3.12</version>
 		</dependency>
-		
+
 		<dependency>
 			<groupId>commons-fileupload</groupId>
 			<artifactId>commons-fileupload</artifactId>
 		</dependency>
-		
+
 		<dependency>
-		    <groupId>org.apache.xmlbeans</groupId>
-		    <artifactId>xmlbeans</artifactId>
-		    <version>3.0.2</version>
+			<groupId>org.apache.xmlbeans</groupId>
+			<artifactId>xmlbeans</artifactId>
+			<version>3.0.2</version>
+		</dependency>
+
+		<dependency>
+			<groupId>net.sf.kxml</groupId>
+			<artifactId>kxml2</artifactId>
 		</dependency>
 
 		<!-- Siga -->
@@ -115,14 +97,19 @@
 			<groupId>siga</groupId>
 			<artifactId>siga-rel</artifactId>
 		</dependency>
+
+		<dependency>
+			<groupId>org.mvel</groupId>
+			<artifactId>mvel2</artifactId>
+		</dependency>
 		
 		<dependency>
-            <groupId>org.mvel</groupId>
-            <artifactId>mvel2</artifactId>
+            <groupId>org.flywaydb</groupId>
+            <artifactId>flyway-core</artifactId>
         </dependency>
 	</dependencies>
-	
-	
+
+
 	<profiles>
 
 		<profile>
@@ -170,20 +157,20 @@
 					</plugin>
 
 					<plugin>
-						<!-- Para usar com boot2docker (1.3+) desative o TLS ou use certificados	-->
-						
-						<!-- A. Desative o TLS														-->
-						
-						<!-- 1. Edite o arquivo de profile: sudo vi /var/lib/boot2docker/profile 	-->
-						<!-- 2. Inclua a seguinte variavel no arquivo de profile: DOCKER_TLS=no 	-->
-						<!-- 3. Salve o arquivo e digit sudo reboot 								-->
-						
-						<!-- B. Utilize certificados												-->
-						
-						<!-- 1. docker.certPath=c:\Users\[usuario]\.boot2docker\certs\boot2docker-vm-->
-						<!-- ou																	 	-->
-						<!-- 2. Coloque <certPath></certPath no pom.xml>							-->
-						
+						<!-- Para usar com boot2docker (1.3+) desative o TLS ou use certificados -->
+
+						<!-- A. Desative o TLS -->
+
+						<!-- 1. Edite o arquivo de profile: sudo vi /var/lib/boot2docker/profile -->
+						<!-- 2. Inclua a seguinte variavel no arquivo de profile: DOCKER_TLS=no -->
+						<!-- 3. Salve o arquivo e digit sudo reboot -->
+
+						<!-- B. Utilize certificados -->
+
+						<!-- 1. docker.certPath=c:\Users\[usuario]\.boot2docker\certs\boot2docker-vm -->
+						<!-- ou -->
+						<!-- 2. Coloque <certPath></certPath no pom.xml> -->
+
 						<groupId>org.jolokia</groupId>
 						<artifactId>docker-maven-plugin</artifactId>
 						<version>0.10.5</version>
@@ -302,7 +289,7 @@
 							<sqlMigrationPrefix>CORPORATIVO_UTF8_V</sqlMigrationPrefix>
 							<placeholderPrefix>flyway${</placeholderPrefix>
 							<locations>
-								<location>filesystem:src\main\resources</location>
+								<location>filesystem:src\main\resources\db\migration</location>
 							</locations>
 						</configuration>
 						<executions>
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/acesso/ConfiguracaoAcesso.java b/siga-cp/src/main/java/br/gov/jfrj/siga/acesso/ConfiguracaoAcesso.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/acesso/ConfiguracaoAcesso.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/acesso/ConfiguracaoAcesso.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/acesso/ConheceUsuario.java b/siga-cp/src/main/java/br/gov/jfrj/siga/acesso/ConheceUsuario.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/acesso/ConheceUsuario.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/acesso/ConheceUsuario.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/acesso/ConheceUsuarioSupport.java b/siga-cp/src/main/java/br/gov/jfrj/siga/acesso/ConheceUsuarioSupport.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/acesso/ConheceUsuarioSupport.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/acesso/ConheceUsuarioSupport.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/acesso/UsuarioAutenticado.java b/siga-cp/src/main/java/br/gov/jfrj/siga/acesso/UsuarioAutenticado.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/acesso/UsuarioAutenticado.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/acesso/UsuarioAutenticado.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpComplexo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpComplexo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpComplexo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpComplexo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpConfiguracao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpConfiguracao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpConfiguracao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpConfiguracao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpGrupo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpGrupo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpGrupo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpGrupo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpIdentidade.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpIdentidade.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpIdentidade.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpIdentidade.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpModelo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpModelo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpModelo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpModelo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpPapel.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpPapel.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpPapel.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpPapel.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpServico.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpServico.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpServico.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpServico.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpSituacaoConfiguracao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpSituacaoConfiguracao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpSituacaoConfiguracao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpSituacaoConfiguracao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoConfiguracao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoConfiguracao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoConfiguracao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoConfiguracao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoGrupo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoGrupo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoGrupo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoGrupo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoIdentidade.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoIdentidade.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoIdentidade.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoIdentidade.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoPapel.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoPapel.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoPapel.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoPapel.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoServico.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoServico.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpTipoServico.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpTipoServico.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpUnidadeMedida.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpUnidadeMedida.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/AbstractCpUnidadeMedida.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/AbstractCpUnidadeMedida.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpArquivo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpArquivo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpArquivo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpArquivo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpArquivoBlob.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpArquivoBlob.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpArquivoBlob.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpArquivoBlob.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpComplexo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpComplexo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpComplexo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpComplexo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpConfiguracao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpConfiguracao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpConfiguracao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpConfiguracao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpConvertableEntity.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpConvertableEntity.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpConvertableEntity.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpConvertableEntity.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpGrupo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpGrupo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpGrupo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpGrupo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpGrupoDeEmail.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpGrupoDeEmail.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpGrupoDeEmail.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpGrupoDeEmail.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpIdentidade.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpIdentidade.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpIdentidade.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpIdentidade.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpModelo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpModelo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpModelo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpModelo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpPapel.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpPapel.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpPapel.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpPapel.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpPerfil.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpPerfil.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpPerfil.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpPerfil.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpPerfilJEE.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpPerfilJEE.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpPerfilJEE.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpPerfilJEE.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpServico.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpServico.java
similarity index 93%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpServico.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpServico.java
index b6ee1e03ee..ff5bff31a2 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpServico.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpServico.java
@@ -18,10 +18,7 @@
  ******************************************************************************/
 package br.gov.jfrj.siga.cp;
 
-import javax.persistence.Cacheable;
 import javax.persistence.Entity;
-import javax.persistence.NamedQueries;
-import javax.persistence.NamedQuery;
 import javax.persistence.Table;
 
 import org.hibernate.annotations.Cache;
@@ -35,8 +32,8 @@ import br.gov.jfrj.siga.model.Selecionavel;
 @Entity
 @Table(name = "corporativo.cp_servico")
 @Immutable
-@Cacheable
-@Cache(region = CpDao.CACHE_HOURS, usage = CacheConcurrencyStrategy.READ_ONLY)
+// @Cacheable
+@Cache(region = CpDao.CACHE_CORPORATIVO, usage = CacheConcurrencyStrategy.TRANSACTIONAL)
 public class CpServico extends AbstractCpServico implements Selecionavel {
 
 	/**
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpSituacaoConfiguracao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpSituacaoConfiguracao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpSituacaoConfiguracao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpSituacaoConfiguracao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoConfiguracao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoConfiguracao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoConfiguracao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoConfiguracao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoGrupo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoGrupo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoGrupo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoGrupo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoIdentidade.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoIdentidade.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoIdentidade.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoIdentidade.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoPapel.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoPapel.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoPapel.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoPapel.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoServico.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoServico.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpTipoServico.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpTipoServico.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpUnidadeMedida.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpUnidadeMedida.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/CpUnidadeMedida.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/CpUnidadeMedida.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/Cp.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/Cp.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/Cp.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/Cp.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpAmbienteEnumBL.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpAmbienteEnumBL.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpAmbienteEnumBL.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpAmbienteEnumBL.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpBL.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpBL.java
similarity index 99%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpBL.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpBL.java
index be1e164d85..19b5b12b6a 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpBL.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpBL.java
@@ -194,6 +194,7 @@ public class CpBL {
 
 			if (confOld != null) {
 				confOld.setHisDtFim(dt);
+				confOld = dao().carregar(confOld);
 				dao().gravarComHistorico(confOld, identidadeCadastrante);
 			}
 			dao().gravarComHistorico(conf, identidadeCadastrante);
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpCompetenciaBL.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpCompetenciaBL.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpCompetenciaBL.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpCompetenciaBL.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpConfiguracaoBL.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpConfiguracaoBL.java
similarity index 98%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpConfiguracaoBL.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpConfiguracaoBL.java
index 509ec6fddf..b57eee4ad6 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpConfiguracaoBL.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpConfiguracaoBL.java
@@ -54,6 +54,7 @@ import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.dp.dao.CpGrupoDaoFiltro;
+import br.gov.jfrj.siga.model.ContextoPersistencia;
 import br.gov.jfrj.siga.model.dao.ModeloDao;
 
 /**
@@ -696,14 +697,6 @@ public class CpConfiguracaoBL {
 			CpServico cpServico, CpIdentidade cpIdentidade, CpGrupo cpGrupo,
 			CpTipoLotacao cpTpLotacao, long idTpConf) throws Exception {
 		try {
-			if (isUsuarioRoot(dpPessoa)){
-				return true;
-			}
-			
-			if (cpIdentidade !=null && isUsuarioRoot(cpIdentidade.getDpPessoa())){
-				return true;
-			}
-			
 			CpConfiguracao cfgFiltro = createNewConfiguracao();
 	
 			cfgFiltro.setCargo(cargo);
@@ -746,17 +739,6 @@ public class CpConfiguracaoBL {
 	}
 
 	
-	protected boolean isUsuarioRoot(DpPessoa dpPessoa) {
-		// if (true) return false;
-		return dpPessoa != null
-				&& dpPessoa.getIdInicial().equals(ID_USUARIO_ROOT)
-				&& dpPessoa.getMatricula().equals(MATRICULA_USUARIO_ROOT)
-				&& dpPessoa.getCpfPessoa().equals(CPF_ROOT)
-				&& dpPessoa.getDataFim() == null
-				&& dpPessoa.getOrgaoUsuario().getSigla().equals(SIGLA_ORGAO_ROOT)
-				&& dpPessoa.getOrgaoUsuario().getId().equals(ID_ORGAO_ROOT);
-	}
-
 	/**
 	 * 
 	 * Usado para se verificar se uma pessoa pode realizar uma determinada
@@ -897,7 +879,9 @@ public class CpConfiguracaoBL {
 						srv.setDscServico(sDesc);
 						srv.setCpServicoPai(srvPai);
 						srv.setCpTipoServico(tpsrv);
+						ContextoPersistencia.begin();
 						dao().acrescentarServico(srv);
+						ContextoPersistencia.commit();
 					}
 					srvPai = srvRecuperado;
 				}
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpConfiguracaoComparator.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpConfiguracaoComparator.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpConfiguracaoComparator.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpConfiguracaoComparator.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpPropriedadeBL.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpPropriedadeBL.java
similarity index 97%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpPropriedadeBL.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpPropriedadeBL.java
index 343f6c499d..af3200a6e1 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/CpPropriedadeBL.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/CpPropriedadeBL.java
@@ -80,6 +80,9 @@ public class CpPropriedadeBL extends ModeloPropriedade {
 	public String xjusPassword  ( ) throws Exception {
 		return this.obterPropriedade("xjus.password");
 	}
	 !!!!!!
+	public String sincPassword  ( ) throws Exception {
+		return this.obterPropriedade("siga.sinc.password");
+	}
 	public String timestampUrl  ( ) throws Exception {
 		return this.obterPropriedade("timestamp.url");
 	}
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/SituacaoFuncionalEnum.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/SituacaoFuncionalEnum.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/bl/SituacaoFuncionalEnum.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/bl/SituacaoFuncionalEnum.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoCargo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoCargo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoCargo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoCargo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoEmail.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoEmail.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoEmail.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoEmail.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFabrica.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFabrica.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFabrica.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFabrica.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFormula.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFormula.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFormula.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFormula.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFuncao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFuncao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFuncao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoFuncao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoLotacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoLotacao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoLotacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoLotacao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoPessoa.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoPessoa.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoPessoa.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoPessoa.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoTransacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoTransacao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoTransacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/ConfiguracaoGrupoTransacao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/TipoConfiguracaoGrupoEnum.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/TipoConfiguracaoGrupoEnum.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/grupo/TipoConfiguracaoGrupoEnum.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/grupo/TipoConfiguracaoGrupoEnum.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/CpGrupoDeEmailSelecao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/CpGrupoDeEmailSelecao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/CpGrupoDeEmailSelecao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/CpGrupoDeEmailSelecao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/CpOrgaoSelecao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/CpOrgaoSelecao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/CpOrgaoSelecao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/CpOrgaoSelecao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/CpPerfilSelecao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/CpPerfilSelecao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/CpPerfilSelecao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/CpPerfilSelecao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpCargoSelecao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpCargoSelecao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpCargoSelecao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpCargoSelecao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpFuncaoConfiancaSelecao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpFuncaoConfiancaSelecao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpFuncaoConfiancaSelecao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpFuncaoConfiancaSelecao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpLotacaoSelecao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpLotacaoSelecao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpLotacaoSelecao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpLotacaoSelecao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpPessoaSelecao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpPessoaSelecao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/DpPessoaSelecao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/DpPessoaSelecao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/HistoricoAuditavel.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/HistoricoAuditavel.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/HistoricoAuditavel.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/HistoricoAuditavel.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/HistoricoAuditavelSuporte.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/HistoricoAuditavelSuporte.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/HistoricoAuditavelSuporte.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/HistoricoAuditavelSuporte.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/HistoricoSuporte.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/HistoricoSuporte.java
similarity index 97%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/HistoricoSuporte.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/HistoricoSuporte.java
index 08adfb53bd..463094f5a6 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/model/HistoricoSuporte.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/model/HistoricoSuporte.java
@@ -22,6 +22,8 @@ import java.util.Date;
 
 import javax.persistence.Column;
 import javax.persistence.MappedSuperclass;
+import javax.persistence.Temporal;
+import javax.persistence.TemporalType;
 import javax.persistence.Transient;
 import javax.persistence.TypedQuery;
 import javax.persistence.criteria.CriteriaBuilder;
@@ -43,10 +45,12 @@ public abstract class HistoricoSuporte extends Objeto implements Historico, Asse
 	@Desconsiderar
 	private Long hisIdIni;
 
+	@Temporal(TemporalType.TIMESTAMP)
 	@Column(name = "HIS_DT_INI")
 	@Desconsiderar
 	private Date hisDtIni;
 
+	@Temporal(TemporalType.TIMESTAMP)
 	@Column(name = "HIS_DT_FIM")
 	@Desconsiderar
 	private Date hisDtFim;
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/util/Blob.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/Blob.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/util/Blob.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/Blob.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/util/Excel.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/Excel.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/util/Excel.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/Excel.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/cp/util/MatriculaUtils.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/MatriculaUtils.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/cp/util/MatriculaUtils.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/MatriculaUtils.java
diff --git a/siga-cp-sinc/src/main/java/br/gov/jfrj/importar/SigaCpSinc.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/SigaCpSinc.java
similarity index 54%
rename from siga-cp-sinc/src/main/java/br/gov/jfrj/importar/SigaCpSinc.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/SigaCpSinc.java
index 4c6c68d32c..34e83c9689 100644
--- a/siga-cp-sinc/src/main/java/br/gov/jfrj/importar/SigaCpSinc.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/SigaCpSinc.java
@@ -16,37 +16,20 @@
  *     You should have received a copy of the GNU General Public License
  *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
  ******************************************************************************/
-package br.gov.jfrj.importar;
+package br.gov.jfrj.siga.cp.util;
 
 import java.io.FileNotFoundException;
 import java.io.IOException;
 import java.io.InputStream;
-import java.lang.reflect.Method;
-import java.net.URL;
-import java.net.URLConnection;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.Date;
-import java.util.HashMap;
 import java.util.Hashtable;
 import java.util.List;
-import java.util.Map;
 import java.util.SortedSet;
 import java.util.TreeSet;
-import java.util.logging.Level;
-import java.util.logging.LogRecord;
-import java.util.logging.Logger;
 
-import javax.naming.NamingException;
-import javax.persistence.EntityManager;
-import javax.persistence.EntityManagerFactory;
-import javax.persistence.Persistence;
-
-import net.sf.ehcache.CacheManager;
-
-import org.hibernate.cfg.Configuration;
 import org.kxml2.io.KXmlParser;
 import org.xmlpull.v1.XmlPullParser;
 import org.xmlpull.v1.XmlPullParserException;
@@ -54,9 +37,6 @@ import org.xmlpull.v1.XmlPullParserException;
 import br.gov.jfrj.siga.base.AplicacaoException;
 import br.gov.jfrj.siga.cp.CpPapel;
 import br.gov.jfrj.siga.cp.CpTipoPapel;
-import br.gov.jfrj.siga.cp.bl.Cp;
-import br.gov.jfrj.siga.cp.bl.CpAmbienteEnumBL;
-import br.gov.jfrj.siga.cp.bl.CpPropriedadeBL;
 import br.gov.jfrj.siga.dp.CpOrgao;
 import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
 import br.gov.jfrj.siga.dp.CpTipoLotacao;
@@ -67,14 +47,12 @@ import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import br.gov.jfrj.siga.sinc.lib.Item;
 import br.gov.jfrj.siga.sinc.lib.Item.Operacao;
 import br.gov.jfrj.siga.sinc.lib.OperadorComHistorico;
 import br.gov.jfrj.siga.sinc.lib.Sincronizador;
 import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
 import br.gov.jfrj.siga.sinc.lib.SincronizavelComparator;
-import br.gov.jfrj.siga.util.ImportarXmlProperties;
 
 public class SigaCpSinc {
 
@@ -82,34 +60,16 @@ public class SigaCpSinc {
 	// a rotina de sync está atribuindo um nível de dependencia estranho para
 	// renato (8)
 
-	private static boolean modoLog = false;
-	protected static int maxSinc = -1;
-
-	private String servidor = "";
+	private boolean modoLog = false;
+	private int maxSinc = -1;
 
-	private String url = "";
-
-	private static String destinatariosExtras = "";
-	private static Level logLevel = Level.WARNING;
-
-	public String getServidor() {
-		return servidor;
-	}
-
-	public String getUrl() {
-		return url;
-	}
-
-	public Date getDt() {
-		return dt;
-	}
+	private String destinatariosExtras = "";
 
 	private SincronizavelComparator sc = new SincronizavelComparator();
 
 	protected SortedSet<Sincronizavel> setNovo = new TreeSet<Sincronizavel>(sc);
 
-	protected SortedSet<Sincronizavel> setAntigo = new TreeSet<Sincronizavel>(
-			sc);
+	protected SortedSet<Sincronizavel> setAntigo = new TreeSet<Sincronizavel>(sc);
 
 	public long orgaoUsuario;
 
@@ -121,14 +81,17 @@ public class SigaCpSinc {
 
 	private String versao;
 
+	public Date getDt() {
+		return dt;
+	}
+
 	List<Item> list;
 
 	/*
 	 * // para compatibilizar os arquivos novos e antigos
 	 */
 	/*
-	 * private boolean seXmlTemPapel = false; private boolean seXmlTemOrgao =
-	 * false;
+	 * private boolean seXmlTemPapel = false; private boolean seXmlTemOrgao = false;
 	 */
 	// listas de Tipos
 	private List<CpTipoLotacao> tiposLotacao;
@@ -141,16 +104,13 @@ public class SigaCpSinc {
 	private DpLotacao lotacaoSJRJ;
 	private DpLotacao lotacaoDIRFO;
 	//
-	private Logger logger = Logger.getLogger("br.gov.jfrj.log.sinc");
 	/*
-	 * verificar duplicidades (árvore de Hashtables : nivel 0: orgaoUsuario,
-	 * nivel 1: entidade, nivel 2: atributo,valor
+	 * verificar duplicidades (árvore de Hashtables : nivel 0: orgaoUsuario, nivel
+	 * 1: entidade, nivel 2: atributo,valor
 	 */
 	Hashtable<String, Hashtable<String, Hashtable<String, Hashtable<String, String>>>> unicidades = new Hashtable<String, Hashtable<String, Hashtable<String, Hashtable<String, String>>>>();
 
 	protected Date dt;
-	private SincLogHandler logHandler = new SincLogHandler();
-	protected String[] args;
 
 	protected void setOrgaoUsuario(long orgaoUsuario) {
 		this.orgaoUsuario = orgaoUsuario;
@@ -185,11 +145,9 @@ public class SigaCpSinc {
 			throw new Exception("Erro na gravação", e);
 		}
 		try {
-			CpDao.getInstance().iniciarTransacao();
 			OperadorComHistorico o = new OperadorComHistorico() {
 				public Sincronizavel gravar(Sincronizavel s) {
 					Sincronizavel o = CpDao.getInstance().gravar(s);
-					CpDao.getInstance().getSessao().flush();
 					return o;
 				}
 			};
@@ -208,45 +166,16 @@ public class SigaCpSinc {
 				manterHistoricoSeNecessario(opr);
 
 			}
-			/*
-			 * sqls para inspeção no display :
-			 * 
-			 * HibernateUtil.getSessao().createSQLQuery(
-			 * "select * from corporativo.dp_cargo where ID_ORGAO_USU = 9999"
-			 * ).list(); HibernateUtil.getSessao().createSQLQuery(
-			 * "select * from corporativo.dp_funcao_confianca where ID_ORGAO_USU = 9999"
-			 * ).list(); HibernateUtil.getSessao().createSQLQuery(
-			 * "select * from corporativo.cp_orgao where ID_ORGAO_USU = 9999"
-			 * ).list(); HibernateUtil.getSessao().createSQLQuery(
-			 * "select * from corporativo.dp_lotacao where ID_ORGAO_USU = 9999"
-			 * ).list(); HibernateUtil.getSessao().createSQLQuery(
-			 * "select * from corporativo.dp_pessoa where ID_ORGAO_USU = 9999"
-			 * ).list(); HibernateUtil.getSessao().createSQLQuery(
-			 * "select * from corporativo.cp_papel where ID_ORGAO_USU = 9999"
-			 * ).list()
-			 */
+
 			if (modoLog) {
-				log("");
-				log("*********MODO LOG **********");
-				log("As alterações não serão efetivadas! Executando rollback...");
-				log("");
-				log("");
-				CpDao.getInstance().rollbackTransacao();
+				log("*** MODO LOG: as alterações não serão efetivadas! Executando rollback...");
+				ContextoPersistencia.em().getTransaction().rollback();
 			} else if (maxSinc > 0 && list.size() > maxSinc) {
-				log("");
-				log("");
-				log("***ATENÇÃO***: Limite de operações por sincronismo excedido!");
-				log("Operações a serem executadas: " + list.size()
-						+ "\nOperações permitidas: " + maxSinc);
-				log("Ajuste o parâmetro -maxSinc=<VALOR> para permitir que o sincronismo seja efetivado!");
-				log("As alterações não serao efetivadas! Executando rollback...");
-				log("");
-				log("");
-
-				CpDao.getInstance().rollbackTransacao();
+				throw new RuntimeException("Limite de operações por sincronismo excedido! "
+						+ "Operações a serem executadas: " + list.size() + "\nOperações permitidas: " + maxSinc
+						+ " Informe o parâmetro maxSinc=<VALOR> para permitir que o sincronismo seja efetivado! "
+						+ "As alterações não serao efetivadas! Executando rollback...");
 			} else {
-
-				CpDao.getInstance().commitTransacao();
 				log("Transação confirmada");
 			}
 		} catch (Exception e) {
@@ -255,14 +184,12 @@ public class SigaCpSinc {
 			throw new Exception("Erro na gravação", e);
 		}
 
-		HibernateUtil.getSessao().flush();
 		log("Total de alterações: " + list.size());
-		// ((GenericoHibernateDao) dao).getSessao().flush();
 	}
 
 	/**
-	 * Verifica se a entidade que está sendo incluída à uma entidade que já
-	 * existe e foi removida indevidamente ocasionando a perda do histórico
+	 * Verifica se a entidade que está sendo incluída à uma entidade que já existe e
+	 * foi removida indevidamente ocasionando a perda do histórico
 	 * 
 	 * @param opr
 	 * @return
@@ -272,18 +199,14 @@ public class SigaCpSinc {
 		if (opr.getNovo() != null && opr.getNovo() instanceof DpPessoa) {
 			DpPessoa pesNova = (DpPessoa) opr.getNovo();
 			if (opr.getOperacao().equals(Operacao.incluir)) {
-				List<DpPessoa> historicoPessoa = CpDao.getInstance()
-						.consultarPorMatriculaEOrgao(pesNova.getMatricula(),
-								pesNova.getOrgaoUsuario().getId(), true, true);
-				log("*****************************" + pesNova.getMatricula());
+				List<DpPessoa> historicoPessoa = CpDao.getInstance().consultarPorMatriculaEOrgao(pesNova.getMatricula(),
+						pesNova.getOrgaoUsuario().getId(), true, true);
+				log("*** " + pesNova.getMatricula());
 				if (historicoPessoa.size() > 0) {
 					DpPessoa pesAnterior = historicoPessoa.get(0);
-					if (pesAnterior != null
-							&& !pesAnterior.getIdInicial().equals(
-									pesNova.getIdInicial())) {
+					if (pesAnterior != null && !pesAnterior.getIdInicial().equals(pesNova.getIdInicial())) {
 						pesNova.setIdInicial(pesAnterior.getIdInicial());
-						log("AVISO (PESSOA): ID_INICIAL reconectada ("
-								+ pesNova.getSigla() + ")");
+						log("AVISO (PESSOA): ID_INICIAL reconectada (" + pesNova.getSigla() + ")");
 					}
 
 				}
@@ -296,21 +219,15 @@ public class SigaCpSinc {
 
 			DpLotacao novo = (DpLotacao) opr.getNovo();
 			if (opr.getOperacao().equals(Operacao.incluir)) {
-				List<DpLotacao> historico = (List<DpLotacao>) CpDao
-						.getInstance().consultarFechadosPorIdExterna(
-								DpLotacao.class, novo.getIdExterna(),
-								novo.getOrgaoUsuario().getId());
+				List<DpLotacao> historico = (List<DpLotacao>) CpDao.getInstance().consultarFechadosPorIdExterna(
+						DpLotacao.class, novo.getIdExterna(), novo.getOrgaoUsuario().getId());
 
 				if (historico.size() > 0) {
 					DpLotacao anterior = historico.get(0);
-					if (anterior != null
-							&& (anterior.getIdExterna().equals(novo
-									.getIdExterna()))
-							&& (!anterior.getIdInicial().equals(
-									novo.getIdInicial()))) {
+					if (anterior != null && (anterior.getIdExterna().equals(novo.getIdExterna()))
+							&& (!anterior.getIdInicial().equals(novo.getIdInicial()))) {
 						novo.setIdInicial(anterior.getIdInicial());
-						log("AVISO (LOTACAO): ID_INICIAL reconectada ("
-								+ novo.getIdInicial() + ")");
+						log("AVISO (LOTACAO): ID_INICIAL reconectada (" + novo.getIdInicial() + ")");
 					}
 
 				}
@@ -323,21 +240,15 @@ public class SigaCpSinc {
 
 			DpCargo novo = (DpCargo) opr.getNovo();
 			if (opr.getOperacao().equals(Operacao.incluir)) {
-				List<DpCargo> historico = (List<DpCargo>) CpDao.getInstance()
-						.consultarFechadosPorIdExterna(DpCargo.class,
-								novo.getIdExterna(),
-								novo.getOrgaoUsuario().getId());
+				List<DpCargo> historico = (List<DpCargo>) CpDao.getInstance().consultarFechadosPorIdExterna(
+						DpCargo.class, novo.getIdExterna(), novo.getOrgaoUsuario().getId());
 
 				if (historico.size() > 0) {
 					DpCargo anterior = historico.get(0);
-					if (anterior != null
-							&& (anterior.getIdExterna().equals(novo
-									.getIdExterna()))
-							&& (!anterior.getIdInicial().equals(
-									novo.getIdInicial()))) {
+					if (anterior != null && (anterior.getIdExterna().equals(novo.getIdExterna()))
+							&& (!anterior.getIdInicial().equals(novo.getIdInicial()))) {
 						novo.setIdInicial(anterior.getIdInicial());
-						log("AVISO (CARGO): ID_INICIAL reconectada ("
-								+ novo.getIdInicial() + ")");
+						log("AVISO (CARGO): ID_INICIAL reconectada (" + novo.getIdInicial() + ")");
 					}
 
 				}
@@ -350,21 +261,16 @@ public class SigaCpSinc {
 
 			DpFuncaoConfianca novo = (DpFuncaoConfianca) opr.getNovo();
 			if (opr.getOperacao().equals(Operacao.incluir)) {
-				List<DpFuncaoConfianca> historico = (List<DpFuncaoConfianca>) CpDao
-						.getInstance().consultarFechadosPorIdExterna(
-								DpFuncaoConfianca.class, novo.getIdExterna(),
+				List<DpFuncaoConfianca> historico = (List<DpFuncaoConfianca>) CpDao.getInstance()
+						.consultarFechadosPorIdExterna(DpFuncaoConfianca.class, novo.getIdExterna(),
 								novo.getOrgaoUsuario().getId());
 
 				if (historico.size() > 0) {
 					DpFuncaoConfianca anterior = historico.get(0);
-					if (anterior != null
-							&& (anterior.getIdExterna().equals(novo
-									.getIdExterna()))
-							&& (!anterior.getIdInicial().equals(
-									novo.getIdInicial()))) {
+					if (anterior != null && (anterior.getIdExterna().equals(novo.getIdExterna()))
+							&& (!anterior.getIdInicial().equals(novo.getIdInicial()))) {
 						novo.setIdInicial(anterior.getIdInicial());
-						log("AVISO (FUNCAO CONFIANCA): ID_INICIAL reconectada ("
-								+ novo.getIdInicial() + ")");
+						log("AVISO (FUNCAO CONFIANCA): ID_INICIAL reconectada (" + novo.getIdInicial() + ")");
 					}
 
 				}
@@ -384,222 +290,33 @@ public class SigaCpSinc {
 		}
 	}
 
-	protected static int parseParametros(String[] pars) {
-
-		if (pars.length < 2) {
-			System.err.println("Número de Parametros inválidos");
-			return 10;
-		}
-		String servidor = pars[0];
-		if (!servidor.toLowerCase().contains("-prod")
-				&& !servidor.toLowerCase().contains("-desenv")
-				&& !servidor.toLowerCase().contains("-homolo")
-				&& !servidor.toLowerCase().contains("-treina")) {
-			System.err.println("Servidor não informado");
-			return 11;
-		}
-
-		for (String param : Arrays.asList(pars)) {
-			if (param.equals("-modoLog=true")) {
-				modoLog = true;
-			}
-
-			if (param.startsWith("-maxSinc=")) {
-				maxSinc = Integer.valueOf(param.split("=")[1]);
-			}
-
-			if (param.startsWith("-destinatariosExtras")) {
-				setDestinatariosExtras(param.split("=")[1]);
-			}
-
-			if (param.startsWith("-logLevel")) {
-				setLogLevel(param.split("=")[1]);
-			}
-
-		}
-
-		return 0;
-	}
-
-	private static void setLogLevel(String nomeLevel) {
-		logLevel = Level.parse(nomeLevel);
-	}
-
-	/**
-	 * @param args
-	 *            - recebe os parametros da linha de comando. Os parâmetros
-	 *            devem ser definidos na ordem abaixo:
-	 * 
-	 *            ****Banco de dados**** -prod --> aponta para o banco de dados
-	 *            de produção -homolo --> aponta para o banco de dados de
-	 *            homologação -treina --> aponta para o banco de dados de
-	 *            treinamento -desenv --> aponta para o banco de dados de testes
-	 * 
-	 *            ****Localidade**** -sjrj --> os dados que serão sincronizados
-	 *            são da SJRJ -trf2 --> os dados que serão sincronizados são do
-	 *            TRF2 -sjes --> os dados que serão sincronizados são da SJES
-	 * 
-	 *            ****Funcionalidades***** -ldap --> sincroniza o banco de dados
-	 *            com o Active Directory
-	 * 
-	 *            obs: se nenhum parâmetro for definido, sincorniza o XML com o
-	 *            banco de dados
-	 * 
-	 * 
-	 * 
-	 * @throws Exception
-	 * @throws Exception
-	 * @throws CsisException
-	 */
-	public static void main(String[] args) throws Exception {
-		SigaCpSinc sinc = new SigaCpSinc(args);
-		sinc.run();
-	}
-
-	public static void configurarEntityManager(CpAmbienteEnumBL ambiente)
-			throws Exception {
-		CpPropriedadeBL prop = Cp.getInstance().getProp();
-		prop.setPrefixo(ambiente.getSigla());
-
-		Map<String, String> properties = new HashMap<>();
-
-		properties.put("hibernate.connection.url", prop.urlConexao());
-		properties.put("hibernate.connection.username", prop.usuario());
-		properties.put("hibernate.connection.password", prop.senha());
-		properties.put("hibernate.connection.driver_class",
-				prop.driverConexao());
-		properties.put("c3p0.min_size", prop.c3poMinSize());
-		properties.put("c3p0.max_size", prop.c3poMaxSize());
-		properties.put("c3p0.timeout", prop.c3poTimeout());
-		properties.put("c3p0.max_statements", prop.c3poMaxStatements());
-
-		// persistenceMap.put("javax.persistence.jdbc.url", "<url>");
-		// persistenceMap.put("javax.persistence.jdbc.user", "<username>");
-		// persistenceMap.put("javax.persistence.jdbc.password", "<password>");
-		// persistenceMap.put("javax.persistence.jdbc.driver", "<driver>");
-		// <property name="jboss.entity.manager.jndi.name"
-		// value="java:/EntityManager/simpledb"/>
-
-		properties.put("hibernate.jdbc.use_streams_for_binary", "true");
-
-		EntityManagerFactory emf = Persistence.createEntityManagerFactory(
-				"default-ex", properties);
-
-		EntityManager em = emf.createEntityManager();
-		ContextoPersistencia.setEntityManager(em);
-	}
-
-	public void run() throws Exception, NamingException, AplicacaoException {
-
-		desativarCacheDeSegundoNivel();
-
-		Configuration cfg;
-		if (servidor.equals("prod"))
-			configurarEntityManager(CpAmbienteEnumBL.PRODUCAO);
-		else if (servidor.equals("homolo"))
-			configurarEntityManager(CpAmbienteEnumBL.HOMOLOGACAO);
-		else if (servidor.equals("treina"))
-			configurarEntityManager(CpAmbienteEnumBL.TREINAMENTO);
-		else if (servidor.equals("desenv"))
-			configurarEntityManager(CpAmbienteEnumBL.DESENVOLVIMENTO);
-		else
-			configurarEntityManager(CpAmbienteEnumBL.DESENVOLVIMENTO);
-
-		verificarOrigemDeDados();
-
+	public String importxml(String sigla, int maxSinc, boolean modoLog, InputStream st) throws Exception {
 		dt = new Date();
-		log("--- Processando  " + dt + "--- ");
-		log("--- Parametros: servidor= " + servidor + "  e url= " + url);
-
-		if (args.length >= 3 && !args[1].equals("-url") && args[2] != null) {
-			String method = args[2].trim().replace("-", "").toLowerCase();
-			Method m = this.getClass().getMethod(method, null);
-			m.invoke(this);
-		} else {
-			importxml();
-		}
-
-		log(" ---- Fim do Processamento --- ");
-		logEnd();
-		CacheManager.getInstance().shutdown();
-	}
-
-	private void desativarCacheDeSegundoNivel() throws Exception {
-		Cp.getInstance().getProp().setCacheUseSecondLevelCache(false);
-		Cp.getInstance().getProp().setCacheUseQueryCache(false);
-	}
-
-	private void verificarOrigemDeDados() throws AplicacaoException {
-		boolean orgaoValido = false;
-		for (CpOrgaoUsuario orgao : CpDao.getInstance()
-				.consultaCpOrgaoUsuario()) {
-			if (orgao.getAcronimoOrgaoUsu().equalsIgnoreCase(
-					url.replace("-", ""))) {
-				orgaoValido = true;
-				break;
-			}
-		}
-
-		if (!orgaoValido) {
-
-			if (url == null || (!url.startsWith("-url") && url.length() < 3)
-					|| (url.replace("-url=", "").startsWith("-"))) {
-				throw new AplicacaoException(("url não informada"));
-			}
+		log("--- Processando " + dt + " ---");
 
+		this.maxSinc = maxSinc;
+		this.modoLog = modoLog;
+		if (modoLog) {
+			log("*** MODO LOG: use -modoLog=false para sair do modo LOG e escrever as alterações");
 		}
+		log("MAX SINC = " + maxSinc);
 
-	}
-
-	public void importxml() {
 		long inicio = System.currentTimeMillis();
-		try {
-			log("Importando: XML");
-			/* -------------------------- */
-			// Mensagens.getString("url.origem")
-			String urlOrigem = "";
-			if (url.startsWith("-url")) {
-				urlOrigem = url.substring(5);
-
-			} else {
-				// Verificação do acrônimo do orgão usuário
-				String acron = url.substring(1);
-				CpOrgaoUsuario orgu = obterOrgaoUsuario(acron);
-				if (orgu == null) {
-					log("Acrônimo '" + acron
-							+ "' do órgão Usuário não encontrado no servidor '"
-							+ servidor + "'");
-					return;
-				}
-				urlOrigem = ImportarXmlProperties.getString("url."
-						.concat(acron));
-				if (urlOrigem == null || urlOrigem.trim().equals(""))
-					urlOrigem = ImportarXmlProperties.getString("url.".concat(
-							acron + ".").concat(servidor));
-			}
-			URL urlMumps = new URL(urlOrigem);
-
-			URLConnection connMumps = urlMumps.openConnection();
-			connMumps.setReadTimeout(0);
-
-			/* */
-			try (InputStream st = connMumps.getInputStream()) {
-				// String inputStreamString = new
-				// Scanner(st,"UTF-8").useDelimiter("\\A").next();
-				// System.out.println(inputStreamString);
-				importarXml(st);
-				log("Importando: BD");
-				setAntigo.addAll(importarTabela());
-				log("Gravando alterações");
-				gravar(dt);
-			}
-		} catch (Exception e) {
-			e.printStackTrace();
-			log(e.getMessage());
-		}
+		log("Importando: XML");
+		CpOrgaoUsuario orgu = obterOrgaoUsuario(sigla);
+		if (orgu == null)
+			throw new AplicacaoException(
+					"Sigla de órgão usuário '" + sigla + "' do órgão Usuário não encontrado no banco de dados");
+
+		importarXml(orgu, st);
+		log("Importando: BD");
+		setAntigo.addAll(importarTabela());
+		log("Gravando alterações");
+		gravar(dt);
 		long total = (System.currentTimeMillis() - inicio) / 1000;
-		log("Tempo total de execução: " + total + " segundos (" + total / 60
-				+ " min)");
+		log("Tempo total de execução: " + total + " segundos (" + total / 60 + " min)");
+		log(" ---- Fim do Processamento --- ");
+		return logEnd();
 	}
 
 	private void logComDestaque(String msg) {
@@ -610,44 +327,17 @@ public class SigaCpSinc {
 		log(espaco + msg + espaco);
 	}
 
-	public SigaCpSinc(String[] args) {
-		this.args = args;
-		int result = parseParametros(args);
-		if (result != 0)
-			System.exit(result);
-
-		logger.addHandler(logHandler);
-		logger.setLevel(logLevel);
-
-		if (modoLog) {
-			logComDestaque(">>>Iniciando em modo LOG!<<<\nUse -modoLog=false para sair do modo LOG e escrever as alterações");
-		}
-		log("MAX SINC = " + maxSinc);
-
-		String aUrl = "";
-		String oServidor = args[0].toLowerCase();
-		if (args[1].equalsIgnoreCase("-url"))
-			aUrl = args[1].toLowerCase() + "=" + args[2];
-		else
-			aUrl = args[1].toLowerCase();
-
-		this.servidor = oServidor.substring(oServidor.indexOf("-") + 1);
-		this.url = aUrl;
-	}
-
 	public List<Sincronizavel> importarTabela() {
 		List<Sincronizavel> l = new ArrayList<Sincronizavel>();
 
-		for (DpLotacao o : CpDao.getInstance().listarAtivos(DpLotacao.class,
-				"dataFimLotacao", orgaoUsuario)) {
+		for (DpLotacao o : CpDao.getInstance().listarAtivos(DpLotacao.class, "dataFimLotacao", orgaoUsuario)) {
 			l.add(o);
 		}
-		for (DpCargo o : CpDao.getInstance().listarAtivos(DpCargo.class,
-				"dataFimCargo", orgaoUsuario)) {
+		for (DpCargo o : CpDao.getInstance().listarAtivos(DpCargo.class, "dataFimCargo", orgaoUsuario)) {
 			l.add(o);
 		}
-		for (DpFuncaoConfianca o : CpDao.getInstance().listarAtivos(
-				DpFuncaoConfianca.class, "dataFimFuncao", orgaoUsuario)) {
+		for (DpFuncaoConfianca o : CpDao.getInstance().listarAtivos(DpFuncaoConfianca.class, "dataFimFuncao",
+				orgaoUsuario)) {
 			l.add(o);
 		}
 		// Comentado por Edson, pois precisa ser resolvido problema dos órgãos
@@ -655,16 +345,14 @@ public class SigaCpSinc {
 		// cadastrados manualmente mas que não constam são enviados pelo XML
 		/*
 		 * if (getVersaoInteira().intValue() >= 2) { for (CpOrgao o :
-		 * CpDao.getInstance().listarAtivos(CpOrgao.class, "hisDtFim",
-		 * orgaoUsuario)) { l.add(o); } }
+		 * CpDao.getInstance().listarAtivos(CpOrgao.class, "hisDtFim", orgaoUsuario)) {
+		 * l.add(o); } }
 		 */
-		for (DpPessoa o : CpDao.getInstance().listarAtivos(DpPessoa.class,
-				"dataFimPessoa", orgaoUsuario)) {
+		for (DpPessoa o : CpDao.getInstance().listarAtivos(DpPessoa.class, "dataFimPessoa", orgaoUsuario)) {
 			l.add(o);
 		}
 		if (getVersaoInteira().intValue() >= 2) {
-			for (CpPapel o : CpDao.getInstance().listarAtivos(CpPapel.class,
-					"hisDtFim", orgaoUsuario)) {
+			for (CpPapel o : CpDao.getInstance().listarAtivos(CpPapel.class, "hisDtFim", orgaoUsuario)) {
 				l.add(o);
 			}
 		}
@@ -677,8 +365,7 @@ public class SigaCpSinc {
 		tiposPapel = CpDao.getInstance().listarTiposPapel();
 	}
 
-	private CpTipoPessoa obterTipoPessoaPorDescricao(String dscTpPessoa)
-			throws Exception {
+	private CpTipoPessoa obterTipoPessoaPorDescricao(String dscTpPessoa) throws Exception {
 		if (dscTpPessoa == null)
 			return null;
 		if ("".equals(dscTpPessoa))
@@ -688,12 +375,10 @@ public class SigaCpSinc {
 				return tp;
 			}
 		}
-		throw new Exception("CpTipoPessoa com descrição '" + dscTpPessoa
-				+ "' não encontrado(a) !");
+		throw new Exception("CpTipoPessoa com descrição '" + dscTpPessoa + "' não encontrado(a) !");
 	}
 
-	private CpTipoPessoa obterTipoPessoaPorId(Integer idTpPessoa)
-			throws Exception {
+	private CpTipoPessoa obterTipoPessoaPorId(Integer idTpPessoa) throws Exception {
 		if (idTpPessoa == null)
 			return null;
 		if (idTpPessoa.intValue() < 1)
@@ -703,12 +388,10 @@ public class SigaCpSinc {
 				return tp;
 			}
 		}
-		throw new Exception("CpTipoPessoa com id '" + idTpPessoa
-				+ "' não encontrado(a) !");
+		throw new Exception("CpTipoPessoa com id '" + idTpPessoa + "' não encontrado(a) !");
 	}
 
-	private CpTipoPapel obterTipoPapelPorDescricao(String dscTpPapel)
-			throws Exception {
+	private CpTipoPapel obterTipoPapelPorDescricao(String dscTpPapel) throws Exception {
 		if (dscTpPapel == null)
 			return null;
 		if ("".equals(dscTpPapel))
@@ -718,12 +401,10 @@ public class SigaCpSinc {
 				return tp;
 			}
 		}
-		throw new Exception("CpTipoPapel com descrição " + dscTpPapel
-				+ " não encontrado !");
+		throw new Exception("CpTipoPapel com descrição " + dscTpPapel + " não encontrado !");
 	}
 
-	private CpTipoLotacao obterTipoLotacaoPorDescricao(String dscTpLotacao)
-			throws Exception {
+	private CpTipoLotacao obterTipoLotacaoPorDescricao(String dscTpLotacao) throws Exception {
 		if (dscTpLotacao == null)
 			return null;
 		if ("".equals(dscTpLotacao))
@@ -733,12 +414,10 @@ public class SigaCpSinc {
 				return tl;
 			}
 		}
-		throw new Exception("CpTipoLotacao com descrição " + dscTpLotacao
-				+ " não encontrado !");
+		throw new Exception("CpTipoLotacao com descrição " + dscTpLotacao + " não encontrado !");
 	}
 
-	private CpTipoLotacao obterTipoLotacaoPorId(Long idTpLotacao)
-			throws Exception {
+	private CpTipoLotacao obterTipoLotacaoPorId(Long idTpLotacao) throws Exception {
 		if (idTpLotacao == null)
 			return null;
 		if (idTpLotacao.longValue() < 0)
@@ -748,8 +427,7 @@ public class SigaCpSinc {
 				return tl;
 			}
 		}
-		throw new Exception("CpTipoPessoa com id " + idTpLotacao
-				+ "não encontrado !");
+		throw new Exception("CpTipoPessoa com id " + idTpLotacao + "não encontrado !");
 	}
 
 	protected static CpOrgaoUsuario obterOrgaoUsuario(String acronimo) {
@@ -766,25 +444,27 @@ public class SigaCpSinc {
 
 	private void obterLotacaoSJRJ() {
 		CpOrgaoUsuario o = obterOrgaoUsuarioSJRJ();
-		DpLotacao lotModeloSJRJ = new DpLotacao();
-		lotModeloSJRJ.setSigla("SJRJ");
-		lotModeloSJRJ.setOrgaoUsuario(o);
-		DpLotacao lotSJRJ = CpDao.getInstance()
-				.consultarPorSigla(lotModeloSJRJ);
-		setLotacaoSJRJ(lotSJRJ);
+		if (o != null) {
+			DpLotacao lotModeloSJRJ = new DpLotacao();
+			lotModeloSJRJ.setSigla("SJRJ");
+			lotModeloSJRJ.setOrgaoUsuario(o);
+			DpLotacao lotSJRJ = CpDao.getInstance().consultarPorSigla(lotModeloSJRJ);
+			setLotacaoSJRJ(lotSJRJ);
+		}
 	}
 
 	private void obterLotacaoDIRFO() {
 		CpOrgaoUsuario o = obterOrgaoUsuarioSJRJ();
-		DpLotacao lotModeloDIRFO = new DpLotacao();
-		lotModeloDIRFO.setSigla("DIRFO");
-		lotModeloDIRFO.setOrgaoUsuario(o);
-		DpLotacao lotDIRFO = CpDao.getInstance().consultarPorSigla(
-				lotModeloDIRFO);
-		setLotacaoDIRFO(lotDIRFO);
+		if (o != null) {
+			DpLotacao lotModeloDIRFO = new DpLotacao();
+			lotModeloDIRFO.setSigla("DIRFO");
+			lotModeloDIRFO.setOrgaoUsuario(o);
+			DpLotacao lotDIRFO = CpDao.getInstance().consultarPorSigla(lotModeloDIRFO);
+			setLotacaoDIRFO(lotDIRFO);
+		}
 	}
 
-	public void importarXml(InputStream in) throws Exception {
+	public void importarXml(CpOrgaoUsuario ou, InputStream in) throws Exception {
 		String aditionalEmails = "";
 
 		boolean contemCargo = false;
@@ -800,85 +480,62 @@ public class SigaCpSinc {
 		XmlPullParser parser = new KXmlParser();
 		boolean fDocumentoCompleto = false;
 
-		try {
-			// Mensagens.getString("url.origem")
-			/*
-			 * Código antigo (passou para )superior.
-			 * 
-			 * String urlOrigem = ""; if (this.url.startsWith("-url")) urlOrigem
-			 * = this.url.substring(5);
-			 * 
-			 * else urlOrigem = Mensagens.getString("url.".concat(this.url
-			 * .substring(1)));
-			 * 
-			 * URL urlMumps = new URL(urlOrigem);
-			 * 
-			 * URLConnection connMumps = urlMumps.openConnection();
-			 * connMumps.setReadTimeout(0);
-			 */
-			parser.setFeature(XmlPullParser.FEATURE_PROCESS_NAMESPACES, true);
-			// BufferedReader xmlReader = new BufferedReader(new
-			// InputStreamReader(connMumps.getInputStream()));
-			// parser.setInput(xmlReader);
-			parser.setInput(in, null);
-
-			while (parser.getEventType() != XmlPullParser.END_DOCUMENT) {
-				if (parser.getEventType() == XmlPullParser.START_TAG) {
-					if (parser.getName().equals("base")) {
-						CpOrgaoUsuario o = new CpOrgaoUsuario();
-						o.setSiglaOrgaoUsu(parser.getAttributeValue(null,
-								"orgaoUsuario"));
-						cpOrgaoUsuario = CpDao.getInstance().consultarPorSigla(
-								o);
-						setDataHora(parseStr(parser, "dataHora"));
-						setVersao(parseStr(parser, "versao"));
-						orgaoUsuario = cpOrgaoUsuario.getIdOrgaoUsu();
-						aditionalEmails = parser.getAttributeValue(null,
-								"NotificarPorEmail");
-
-						if (destinatariosExtras != null
-								&& aditionalEmails != null) {
-							destinatariosExtras = destinatariosExtras
-									+ (!aditionalEmails.trim().equals("") ? ","
-											+ aditionalEmails : "");
-						}
+		parser.setFeature(XmlPullParser.FEATURE_PROCESS_NAMESPACES, true);
+		// BufferedReader xmlReader = new BufferedReader(new
+		// InputStreamReader(connMumps.getInputStream()));
+		// parser.setInput(xmlReader);
+		parser.setInput(in, null);
+
+		while (parser.getEventType() != XmlPullParser.END_DOCUMENT) {
+			if (parser.getEventType() == XmlPullParser.START_TAG) {
+				if (parser.getName().equals("base")) {
+					CpOrgaoUsuario o = new CpOrgaoUsuario();
+					o.setSiglaOrgaoUsu(parser.getAttributeValue(null, "orgaoUsuario"));
+					setDataHora(parseStr(parser, "dataHora"));
+					setVersao(parseStr(parser, "versao"));
+					cpOrgaoUsuario = CpDao.getInstance().consultarPorSigla(o);
+					if (cpOrgaoUsuario == null) {
+						throw new Exception("Sigla de órgão usuário desconhecida: " + o.getSigla());
+					}
+					orgaoUsuario = cpOrgaoUsuario.getIdOrgaoUsu();
+					if (ou.getId().equals(orgaoUsuario)) {
+						log("XML confirma órgão usuário: " + cpOrgaoUsuario.getSigla() + " (" + cpOrgaoUsuario.getId() + ")");
+					} else {
+						throw new Exception("XML referente ao órgão usuário errado: " + o.getSigla());
+					}
+					aditionalEmails = parser.getAttributeValue(null, "NotificarPorEmail");
 
-					} else if (parser.getName().equals("cargo")) {
-						setNovo.add(importarXmlCargo(parser));
-						contemCargo = true;
-					} else if (parser.getName().equals("funcao")) {
-						setNovo.add(importarXmlFuncao(parser));
-						contemFuncao = true;
-					} else if (parser.getName().equals("orgao")) {
-						if (getVersaoInteira().intValue() < 2)
-							throw new Exception(
-									"Versão não possui órgão ou atributo 'versao' não especificado. ");
-						setNovo.add(importarXmlOrgao(parser));
-					} else if (parser.getName().equals("lotacao")) {
-						setNovo.add(importarXmlLotacao(parser));
-						contemLotacao = true;
-					} else if (parser.getName().equals("pessoa")) {
-						setNovo.add(importarXmlPessoa(parser));
-						contemPessoa = true;
-					} else if (parser.getName().equals("papel")) {
-						if (getVersaoInteira().intValue() < 2)
-							throw new Exception(
-									"Versão não possui papel ou atributo 'versao' não especificado. ");
-						setNovo.add(importarXmlPapel(parser));
+					if (destinatariosExtras != null && aditionalEmails != null) {
+						destinatariosExtras = destinatariosExtras
+								+ (!aditionalEmails.trim().equals("") ? "," + aditionalEmails : "");
 					}
+
+				} else if (parser.getName().equals("cargo")) {
+					setNovo.add(importarXmlCargo(parser));
+					contemCargo = true;
+				} else if (parser.getName().equals("funcao")) {
+					setNovo.add(importarXmlFuncao(parser));
+					contemFuncao = true;
+				} else if (parser.getName().equals("orgao")) {
+					if (getVersaoInteira().intValue() < 2)
+						throw new Exception("Versão não possui órgão ou atributo 'versao' não especificado. ");
+					setNovo.add(importarXmlOrgao(parser));
+				} else if (parser.getName().equals("lotacao")) {
+					setNovo.add(importarXmlLotacao(parser));
+					contemLotacao = true;
+				} else if (parser.getName().equals("pessoa")) {
+					setNovo.add(importarXmlPessoa(parser));
+					contemPessoa = true;
+				} else if (parser.getName().equals("papel")) {
+					if (getVersaoInteira().intValue() < 2)
+						throw new Exception("Versão não possui papel ou atributo 'versao' não especificado. ");
+					setNovo.add(importarXmlPapel(parser));
 				}
-				if (parser.getEventType() == XmlPullParser.END_TAG
-						&& parser.getName().equals("base")) {
-					fDocumentoCompleto = true;
-				}
-				parser.nextToken();
 			}
-		} catch (FileNotFoundException e) {
-			throw e;
-		} catch (XmlPullParserException e) {
-			throw e;
-		} catch (IOException e) {
-			throw e;
+			if (parser.getEventType() == XmlPullParser.END_TAG && parser.getName().equals("base")) {
+				fDocumentoCompleto = true;
+			}
+			parser.nextToken();
 		}
 
 		if (!contemCargo) {
@@ -900,8 +557,7 @@ public class SigaCpSinc {
 		}
 
 		if (!fDocumentoCompleto) {
-			throw new Exception(
-					"XML arquivo não estava completo! Nenhuma alteração foi realizada na base.");
+			throw new Exception("XML arquivo não estava completo! Nenhuma alteração foi realizada na base.");
 		}
 
 	}
@@ -910,99 +566,73 @@ public class SigaCpSinc {
 	 * Cria registro de processamento do XML com o objetivo de verificar se há
 	 * duplicidade
 	 * 
-	 * @param siglaOrgao
-	 *            - sigla do órgao (base)
-	 * @param nomeEntidade
-	 *            - nome da entidade (Se é 'orgao', 'pessoa', 'lotacao' etc.
-	 * @param nomeAtributo
-	 *            - nome do atributo da entidade
-	 * @param valor
-	 *            - valor do atributo
-	 * @param identificador
-	 *            - conteúdo que procura identificar onde ocorreu a duplicação
-	 * @throws Exception
-	 *             - no caso de haver duplicidade.
+	 * @param siglaOrgao    - sigla do órgao (base)
+	 * @param nomeEntidade  - nome da entidade (Se é 'orgao', 'pessoa', 'lotacao'
+	 *                      etc.
+	 * @param nomeAtributo  - nome do atributo da entidade
+	 * @param valor         - valor do atributo
+	 * @param identificador - conteúdo que procura identificar onde ocorreu a
+	 *                      duplicação
+	 * @throws Exception - no caso de haver duplicidade.
 	 */
-	private void criarUnicidade(String siglaOrgao, String nomeEntidade,
-			String nomeAtributo, String valor, String identificador)
-			throws Exception {
+	private void criarUnicidade(String siglaOrgao, String nomeEntidade, String nomeAtributo, String valor,
+			String identificador) throws Exception {
 		if (valor == null || valor.equals("")) {
-			throw new Exception("Orgão usuário: " + siglaOrgao + "; Entidade: "
-					+ nomeEntidade + "; Atributo: " + nomeAtributo
-					+ "; Valor: " + valor
-					+ " => valor nulo para o identificador: " + identificador);
+			throw new Exception("Orgão usuário: " + siglaOrgao + "; Entidade: " + nomeEntidade + "; Atributo: "
+					+ nomeAtributo + "; Valor: " + valor + " => valor nulo para o identificador: " + identificador);
 		}
 		if (unicidades.get(siglaOrgao) == null) {
-			unicidades
-					.put(siglaOrgao,
-							new Hashtable<String, Hashtable<String, Hashtable<String, String>>>());
+			unicidades.put(siglaOrgao, new Hashtable<String, Hashtable<String, Hashtable<String, String>>>());
 		}
 		if (unicidades.get(siglaOrgao).get(nomeEntidade) == null) {
-			unicidades.get(siglaOrgao).put(nomeEntidade,
-					new Hashtable<String, Hashtable<String, String>>());
+			unicidades.get(siglaOrgao).put(nomeEntidade, new Hashtable<String, Hashtable<String, String>>());
 		}
 		if (unicidades.get(siglaOrgao).get(nomeEntidade).get(nomeAtributo) == null) {
-			unicidades.get(siglaOrgao).get(nomeEntidade)
-					.put(nomeAtributo, new Hashtable<String, String>());
+			unicidades.get(siglaOrgao).get(nomeEntidade).put(nomeAtributo, new Hashtable<String, String>());
 		}
-		if (unicidades.get(siglaOrgao).get(nomeEntidade).get(nomeAtributo)
-				.get(valor) == null) {
+		if (unicidades.get(siglaOrgao).get(nomeEntidade).get(nomeAtributo).get(valor) == null) {
 			try {
-				unicidades.get(siglaOrgao).get(nomeEntidade).get(nomeAtributo)
-						.put(valor, identificador);
+				unicidades.get(siglaOrgao).get(nomeEntidade).get(nomeAtributo).put(valor, identificador);
 			} catch (Exception e) {
-				throw new Exception("Orgão usuário: " + siglaOrgao.toString()
-						+ "; Entidade: " + nomeEntidade.toString()
-						+ "; Atributo: " + nomeAtributo.toString()
-						+ "; Valor: " + valor.toString()
-						+ " Erro na tentativa de inserir a lotação. " + " => "
-						+ e.getMessage());
+				throw new Exception("Orgão usuário: " + siglaOrgao.toString() + "; Entidade: " + nomeEntidade.toString()
+						+ "; Atributo: " + nomeAtributo.toString() + "; Valor: " + valor.toString()
+						+ " Erro na tentativa de inserir a lotação. " + " => " + e.getMessage());
 			}
 		} else {
-			throw new Exception("Orgão usuário: "
-					+ siglaOrgao
-					+ "; Entidade: "
-					+ nomeEntidade
-					+ "; Atributo: "
-					+ nomeAtributo
-					+ "; Valor: "
-					+ valor
-					+ " => já existe para o identificador: "
-					+ unicidades.get(siglaOrgao).get(nomeEntidade)
-							.get(nomeAtributo).get(valor)
-					+ " na tentativa de inserir o identificador: "
-					+ identificador);
+			throw new Exception("Orgão usuário: " + siglaOrgao + "; Entidade: " + nomeEntidade + "; Atributo: "
+					+ nomeAtributo + "; Valor: " + valor + " => já existe para o identificador: "
+					+ unicidades.get(siglaOrgao).get(nomeEntidade).get(nomeAtributo).get(valor)
+					+ " na tentativa de inserir o identificador: " + identificador);
 		}
 	}
 
 	private DpCargo importarXmlCargo(XmlPullParser parser) throws Exception {
 		DpCargo cargo = new DpCargo();
 		cargo.setIdExterna(parseStr(parser, "id"));
-		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "cargo", "idExterna",
-				parseStr(parser, "id"), parseStr(parser, "nome"));
+		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "cargo", "idExterna", parseStr(parser, "id"),
+				parseStr(parser, "nome"));
 		cargo.setNomeCargo(parseStr(parser, "nome"));
 		cargo.setSigla(parseStr(parser, "sigla"));
 		// leiaute antigo ainda não contém sigla
 		if (parseStr(parser, "sigla") != null) {
-			criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "cargo", "sigla",
-					parseStr(parser, "sigla"), parseStr(parser, "id"));
+			criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "cargo", "sigla", parseStr(parser, "sigla"),
+					parseStr(parser, "id"));
 		}
 		cargo.setOrgaoUsuario(cpOrgaoUsuario);
 		return cargo;
 	}
 
-	private DpFuncaoConfianca importarXmlFuncao(XmlPullParser parser)
-			throws Exception {
+	private DpFuncaoConfianca importarXmlFuncao(XmlPullParser parser) throws Exception {
 		DpFuncaoConfianca funcao = new DpFuncaoConfianca();
 		funcao.setIdExterna(parseStr(parser, "id"));
-		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "funcao",
-				"idExterna", parseStr(parser, "id"), parseStr(parser, "nome"));
+		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "funcao", "idExterna", parseStr(parser, "id"),
+				parseStr(parser, "nome"));
 		funcao.setNomeFuncao(parseStr(parser, "nome"));
 		funcao.setSigla(parseStr(parser, "sigla"));
 		// leiaute antigo ainda não contém sigla
 		if (parseStr(parser, "sigla") != null) {
-			criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "funcao",
-					"sigla", parseStr(parser, "sigla"), parseStr(parser, "id"));
+			criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "funcao", "sigla", parseStr(parser, "sigla"),
+					parseStr(parser, "id"));
 		}
 		funcao.setOrgaoUsuario(cpOrgaoUsuario);
 		return funcao;
@@ -1012,12 +642,12 @@ public class SigaCpSinc {
 
 		CpOrgao orgao = new CpOrgao();
 		orgao.setIdeOrgao(parseStr(parser, "id"));
-		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "orgao", "ideOrgao",
-				parseStr(parser, "id"), parseStr(parser, "sigla"));
+		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "orgao", "ideOrgao", parseStr(parser, "id"),
+				parseStr(parser, "sigla"));
 		orgao.setNmOrgao(parseStr(parser, "nome"));
 		orgao.setSigla(parseStr(parser, "sigla"));
-		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "orgao", "sigla",
-				parseStr(parser, "sigla"), parseStr(parser, "id"));
+		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "orgao", "sigla", parseStr(parser, "sigla"),
+				parseStr(parser, "id"));
 		orgao.setOrgaoUsuario(cpOrgaoUsuario);
 		return orgao;
 	}
@@ -1026,12 +656,12 @@ public class SigaCpSinc {
 
 		DpLotacao lotacao = new DpLotacao();
 		lotacao.setIdExterna(parseStr(parser, "id"));
-		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "lotacao",
-				"idExterna", parseStr(parser, "id"), parseStr(parser, "sigla"));
+		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "lotacao", "idExterna", parseStr(parser, "id"),
+				parseStr(parser, "sigla"));
 		lotacao.setNomeLotacao(parseStr(parser, "nome"));
 		lotacao.setSiglaLotacao(parseStr(parser, "sigla"));
-		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "lotacao", "sigla",
-				parseStr(parser, "sigla"), parseStr(parser, "id"));
+		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "lotacao", "sigla", parseStr(parser, "sigla"),
+				parseStr(parser, "id"));
 		if (lotacao.getSiglaLotacao() == null) {
 			lotacao.setSiglaLotacao(parseStr(parser, "id"));
 		}
@@ -1040,8 +670,7 @@ public class SigaCpSinc {
 		}
 		lotacao.setDataInicioLotacao(new Date());
 		lotacao.setOrgaoUsuario(cpOrgaoUsuario);
-		if (parseStr(parser, "idPai") != null
-				&& !parseStr(parser, "idPai").equals(lotacao.getIdExterna())) {
+		if (parseStr(parser, "idPai") != null && !parseStr(parser, "idPai").equals(lotacao.getIdExterna())) {
 			DpLotacao o = new DpLotacao();
 			o.setIdExterna(parseStr(parser, "idPai"));
 			lotacao.setLotacaoPai(o);
@@ -1075,15 +704,14 @@ public class SigaCpSinc {
 
 		try {
 			pessoa.setIdExterna(parseStr(parser, "id"));
-			String situacaoFuncPessoa = obterSituacaoPessoaPelaDescricao(
-					parseStr(parser, "situacao").trim(), parseStr(parser, "id"));
+			String situacaoFuncPessoa = obterSituacaoPessoaPelaDescricao(parseStr(parser, "situacao").trim(),
+					parseStr(parser, "id"));
 			// A unicidade da ID somente é verificada para os ATIVOS
 			// (situacao=1)
 			/*
 			 * if ("1".equals(situacaoFuncPessoa) ) {
-			 * criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa",
-			 * "idExterna", parseStr(parser, "id"), parseStr(parser, "sigla"));
-			 * }
+			 * criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa", "idExterna",
+			 * parseStr(parser, "id"), parseStr(parser, "sigla")); }
 			 */
 			try {
 				pessoa.setCpfPessoa(parseLong(parser, "cpf"));
@@ -1094,9 +722,8 @@ public class SigaCpSinc {
 			// (situacao=1)
 			/*
 			 * if ("1".equals(situacaoFuncPessoa ) ) {
-			 * criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa",
-			 * "cpf", pessoa.getCpfPessoa().toString(), parseStr( parser,
-			 * "id")); }
+			 * criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa", "cpf",
+			 * pessoa.getCpfPessoa().toString(), parseStr( parser, "id")); }
 			 */
 			pessoa.setNomePessoa(parseStr(parser, "nome"));
 			Date dtNascimento = parseData(parser, "dtNascimento");
@@ -1107,21 +734,18 @@ public class SigaCpSinc {
 
 			pessoa.setEmailPessoa(parseStr(parser, "email"));
 			if (pessoa.getEmailPessoaAtual() != null)
-				pessoa.setEmailPessoa(pessoa.getEmailPessoaAtual()
-						.toLowerCase());
+				pessoa.setEmailPessoa(pessoa.getEmailPessoaAtual().toLowerCase());
 			pessoa.setSesbPessoa(cpOrgaoUsuario.getSiglaOrgaoUsu());
 			pessoa.setDataInicioPessoa(new Date());
 			pessoa.setSiglaPessoa(parseStr(parser, "sigla"));
 			/*
-			 * criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa",
-			 * "sigla", pessoa.getSiglaPessoa(), parseStr(parser, "id"));
+			 * criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa", "sigla",
+			 * pessoa.getSiglaPessoa(), parseStr(parser, "id"));
 			 */
 			pessoa.setPadraoReferencia(parseStr(parser, "padraoReferencia"));
 			pessoa.setMatricula(parseLong(parser, "matricula"));
-			criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa",
-					"matricula",
-					pessoa.getSesbPessoa() + pessoa.getMatricula(),
-					parseStr(parser, "id"));
+			criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "pessoa", "matricula",
+					pessoa.getSesbPessoa() + pessoa.getMatricula(), parseStr(parser, "id"));
 			pessoa.setOrgaoUsuario(cpOrgaoUsuario);
 			// pessoa.setSituacaoFuncionalPessoa(parseStr(parser, "situacao"));
 			pessoa.setSituacaoFuncionalPessoa(situacaoFuncPessoa);
@@ -1190,8 +814,8 @@ public class SigaCpSinc {
 				pessoa.setCpTipoPessoa(o);
 				/*
 				 * }else if (parseStr(parser, "tipo_rh") != null) { o =
-				 * obterTipoPessoaPorId(Integer.valueOf(parseStr(parser,
-				 * "tipo_rh"))); pessoa.setCpTipoPessoa(o);
+				 * obterTipoPessoaPorId(Integer.valueOf(parseStr(parser, "tipo_rh")));
+				 * pessoa.setCpTipoPessoa(o);
 				 */
 			} else {
 				// inferir tipo de pessoa para a SJRJ se vier nulo no XML
@@ -1208,8 +832,8 @@ public class SigaCpSinc {
 
 		CpPapel papel = new CpPapel();
 		papel.setIdExterna(parseStr(parser, "id"));
-		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "tipo", "idExterna",
-				parseStr(parser, "id"), dpPessoaCorrente.getIdExterna());
+		criarUnicidade(cpOrgaoUsuario.getSiglaOrgaoUsu(), "tipo", "idExterna", parseStr(parser, "id"),
+				dpPessoaCorrente.getIdExterna());
 		// if (parseStr(parser, "tipo") != null) {
 		// CpTipoPapel o = obterTipoPapelPorDescricao(parseStr(parser, "tipo"));
 		// papel.setCpTipoPapel(o);
@@ -1231,29 +855,20 @@ public class SigaCpSinc {
 			o.setIdExterna(parseStr(parser, "lotacao"));
 			papel.setDpLotacao(o);
 		}
-
+		papel.setHisAtivo(1);
 		return papel;
 	}
 
+	StringBuilder sbLog = new StringBuilder();
+
 	public void log(String s) {
-		logger.log(new LogRecord(logLevel, s));
+		sbLog.append(s);
+		sbLog.append("\n");
 	}
 
-	public void logEnd() throws Exception {
-		String sDest = ImportarXmlProperties.getString("lista.destinatario")
-				+ (!destinatariosExtras.trim().equals("") ? ","
-						+ destinatariosExtras : "");
-		if (getDataHora() != null) {
-			log("Arquivo XML gerado em " + getDataHora() + "\n");
-		}
-
-		if (maxSinc != -1 && list != null && (list.size() > maxSinc)) {
-			logHandler
-					.setAssunto("Limite de operações por sincronismo superior a 200. Execute o sincronismo manualmente.");
-		}
-
-		logHandler.setDestinatariosEmail(sDest.split(","));
-
+	public String logEnd() throws Exception {
+		return sbLog.toString();
+		// logHandler.setDestinatariosEmail(sDest.split(","));
 	}
 
 	private Date parseData(XmlPullParser parser, String campo) {
@@ -1342,20 +957,18 @@ public class SigaCpSinc {
 	 * @throws NumberFormatException
 	 * 
 	 */
-	public void inferirTipoLotacaoSJRJ(DpLotacao lot)
-			throws NumberFormatException, Exception {
+	public void inferirTipoLotacaoSJRJ(DpLotacao lot) throws NumberFormatException, Exception {
 		CpOrgaoUsuario org = lot.getOrgaoUsuario();
 		// ver se órgão usuário é SJRJ
 		if (org.getIdOrgaoUsu() == null)
 			return;
-		if (!org.getSigla().equals(obterOrgaoUsuarioSJRJ().getSigla()))
+		CpOrgaoUsuario orguSJRJ = obterOrgaoUsuarioSJRJ();
+		if (orguSJRJ == null || !org.getSigla().equals(orguSJRJ.getSigla()))
 			return;
 		DpLotacao lotDIRFO = getLotacaoDIRFO();
 		DpLotacao lotPaiAdm = lot;
 		while (lotPaiAdm != null) {
-			if (lotDIRFO != null
-					&& lotPaiAdm.getIdeLotacao()
-							.equals(lotDIRFO.getIdLotacao())) {
+			if (lotDIRFO != null && lotPaiAdm.getIdeLotacao().equals(lotDIRFO.getIdLotacao())) {
 				// é administrativo
 				lot.setCpTipoLotacao(obterTipoLotacaoPorId(Long.valueOf("1")));
 				return;
@@ -1370,9 +983,7 @@ public class SigaCpSinc {
 		DpLotacao lotSJRJ = getLotacaoSJRJ();
 		DpLotacao lotPaiJur = lot;
 		while (lotPaiJur != null) {
-			if (lotSJRJ != null
-					&& lotPaiJur.getIdeLotacao()
-							.equals(lotSJRJ.getIdeLotacao())) {
+			if (lotSJRJ != null && lotPaiJur.getIdeLotacao().equals(lotSJRJ.getIdeLotacao())) {
 				// é jurídico
 				lot.setCpTipoLotacao(obterTipoLotacaoPorId(Long.valueOf("100")));
 				return;
@@ -1401,7 +1012,8 @@ public class SigaCpSinc {
 	public void inferirTipoPessoaSJRJ(DpPessoa pes) throws Exception {
 		CpOrgaoUsuario org = pes.getOrgaoUsuario();
 		// SJRJ
-		if (org.getSigla().equals(obterOrgaoUsuarioSJRJ().getSigla())) {
+		CpOrgaoUsuario orguSJRJ = obterOrgaoUsuarioSJRJ();
+		if (orguSJRJ != null && org.getSigla().equals(orguSJRJ.getSigla())) {
 			if (pes.getMatricula() != null) {
 				long mat = pes.getMatricula().longValue();
 				int tipid = -1;
@@ -1434,19 +1046,17 @@ public class SigaCpSinc {
 	}
 
 	/**
-	 * Obtém o código da situação funcional da pessoa a partir de ALGUMAS
-	 * descrições Somente para os casos onde há erro no envio pelo remetete -
-	 * solicitar acerto nesse caso
+	 * Obtém o código da situação funcional da pessoa a partir de ALGUMAS descrições
+	 * Somente para os casos onde há erro no envio pelo remetete - solicitar acerto
+	 * nesse caso
 	 * 
-	 * @param situacaoFuncPessoa
-	 *            - parseStr(parser, "situacao").trim()
-	 * @param idPessoa
-	 *            - identificador ou descrição da situaçao fuuncioal da pessoa
+	 * @param situacaoFuncPessoa - parseStr(parser, "situacao").trim()
+	 * @param idPessoa           - identificador ou descrição da situaçao fuuncioal
+	 *                           da pessoa
 	 * @return - identif
 	 * @throws Exception
 	 */
-	public String obterSituacaoPessoaPelaDescricao(String situacaoFuncPessoa,
-			String idPessoa) throws Exception {
+	public String obterSituacaoPessoaPelaDescricao(String situacaoFuncPessoa, String idPessoa) throws Exception {
 		// String situacaoFuncPessoa = parseStr(parser, "situacao").trim();
 		// Alguns tem enviado a descrição da pessoa baseado no manual ao
 		// invés do ID
@@ -1473,18 +1083,13 @@ public class SigaCpSinc {
 		} else {
 			try {
 				int parseIntSituacao = Integer.parseInt(situacaoFuncPessoa);
-				if (parseIntSituacao > 31) {
-					throw new Exception(
-							"Tag pessoa id "
-									+ idPessoa // parseStr(parser, "id")
-									+ " tem situacao funcional não tratada no roteiro: '"
-									+ situacaoFuncPessoa + "'");
+				if (parseIntSituacao > 36) {
+					throw new Exception("Tag pessoa id " + idPessoa // parseStr(parser, "id")
+							+ " tem situacao funcional não tratada no roteiro: '" + situacaoFuncPessoa + "'");
 				}
 			} catch (Exception e) {
-				throw new Exception("Tag pessoa id "
-						+ idPessoa // parseStr(parser, "id")
-						+ " tem situacao funcional não conhecida: '"
-						+ situacaoFuncPessoa + "'");
+				throw new Exception("Tag pessoa id " + idPessoa // parseStr(parser, "id")
+						+ " tem situacao funcional não conhecida: '" + situacaoFuncPessoa + "'");
 			}
 		}
 		return situacaoFuncPessoa;
@@ -1505,30 +1110,4 @@ public class SigaCpSinc {
 	public DpLotacao getLotacaoDIRFO() {
 		return lotacaoDIRFO;
 	}
-
-	protected void setServidor(String servidor) {
-		this.servidor = servidor.replace("-", "");
-	}
-
-	protected void setUrl(String url) {
-		this.url = url;
-	}
-
-	/**
-	 * Acrescenta destinatários a serem notificados da sincronização
-	 * 
-	 * @param destinatarios
-	 *            - lista de e-mails separados por vírgula
-	 */
-	protected static void setDestinatariosExtras(String destinatarios) {
-		destinatariosExtras = destinatarios;
-	}
-
-	protected void exibirMensagemMaxSinc(List<Item> list) {
-		log("***ATENÇÃO***: Limite de operações por sincronismo excedido!");
-		log("Operações a serem executadas: " + list.size()
-				+ "\nOperações permitidas: " + maxSinc);
-		log("Ajuste o parâmetro -maxSinc=<VALOR> para permitir que o sincronismo seja efetivado!");
-		log("As alterações não serão efetivadas! Executando rollback...");
-	}
 }
\ No newline at end of file
diff --git a/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/SigaFlyway.java b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/SigaFlyway.java
new file mode 100644
index 0000000000..af113008f1
--- /dev/null
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/cp/util/SigaFlyway.java
@@ -0,0 +1,22 @@
+package br.gov.jfrj.siga.cp.util;
+
+import javax.naming.Context;
+import javax.naming.InitialContext;
+import javax.naming.NamingException;
+import javax.sql.DataSource;
+
+import org.flywaydb.core.Flyway;
+
+public class SigaFlyway {
+
+	public static void migrate(String dataSource, String location) throws NamingException {
+		if ("true".equals(System.getProperty("siga.flyway.mysql.migrate", "false"))) {
+			Context initContext = new InitialContext();
+			Context envContext = (Context) initContext.lookup("java:");
+			DataSource ds = (DataSource) envContext.lookup(dataSource);
+			Flyway flyway = Flyway.configure().dataSource(ds).locations(location).placeholderReplacement(false).load();
+			flyway.migrate();
+		}
+	}
+
+}
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCPMarca.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCPMarca.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCPMarca.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCPMarca.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpAplicacaoFeriado.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpAplicacaoFeriado.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpAplicacaoFeriado.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpAplicacaoFeriado.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpFeriado.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpFeriado.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpFeriado.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpFeriado.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpLocalidade.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpLocalidade.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpLocalidade.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpLocalidade.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpMarcador.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpMarcador.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpMarcador.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpMarcador.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpOcorrenciaFeriado.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpOcorrenciaFeriado.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpOcorrenciaFeriado.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpOcorrenciaFeriado.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpOrgao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpOrgao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpOrgao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpOrgao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpOrgaoUsuario.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpOrgaoUsuario.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpOrgaoUsuario.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpOrgaoUsuario.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpPersonalizacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpPersonalizacao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpPersonalizacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpPersonalizacao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoLotacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoLotacao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoLotacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoLotacao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoMarca.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoMarca.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoMarca.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoMarca.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoMarcador.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoMarcador.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoMarcador.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoMarcador.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoPessoa.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoPessoa.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpTipoPessoa.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpTipoPessoa.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpUF.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpUF.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractCpUF.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractCpUF.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpCargo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpCargo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpCargo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpCargo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpFuncaoConfianca.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpFuncaoConfianca.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpFuncaoConfianca.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpFuncaoConfianca.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpLotacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpLotacao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpLotacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpLotacao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpPessoa.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpPessoa.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpPessoa.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpPessoa.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpSubstituicao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpSubstituicao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/AbstractDpSubstituicao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/AbstractDpSubstituicao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpAplicacaoFeriado.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpAplicacaoFeriado.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpAplicacaoFeriado.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpAplicacaoFeriado.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpFeriado.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpFeriado.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpFeriado.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpFeriado.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpLocalidade.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpLocalidade.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpLocalidade.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpLocalidade.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpMarca.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpMarca.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpMarca.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpMarca.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpMarcador.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpMarcador.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpMarcador.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpMarcador.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpOcorrenciaFeriado.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpOcorrenciaFeriado.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpOcorrenciaFeriado.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpOcorrenciaFeriado.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpOrgao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpOrgao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpOrgao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpOrgao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpOrgaoUsuario.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpOrgaoUsuario.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpOrgaoUsuario.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpOrgaoUsuario.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpPersonalizacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpPersonalizacao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpPersonalizacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpPersonalizacao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoLotacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoLotacao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoLotacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoLotacao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoMarca.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoMarca.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoMarca.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoMarca.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoMarcador.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoMarcador.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoMarcador.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoMarcador.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoPessoa.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoPessoa.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpTipoPessoa.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpTipoPessoa.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpUF.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpUF.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/CpUF.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/CpUF.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpCargo.betwixt b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpCargo.betwixt
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpCargo.betwixt
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpCargo.betwixt
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpCargo.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpCargo.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpCargo.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpCargo.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpConvertableEntity.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpConvertableEntity.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpConvertableEntity.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpConvertableEntity.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpFuncaoConfianca.betwixt b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpFuncaoConfianca.betwixt
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpFuncaoConfianca.betwixt
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpFuncaoConfianca.betwixt
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpFuncaoConfianca.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpFuncaoConfianca.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpFuncaoConfianca.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpFuncaoConfianca.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpLotacao.betwixt b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpLotacao.betwixt
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpLotacao.betwixt
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpLotacao.betwixt
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpLotacao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpLotacao.java
similarity index 97%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpLotacao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpLotacao.java
index 02be99a141..5551de8f0b 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpLotacao.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpLotacao.java
@@ -47,8 +47,10 @@ import br.gov.jfrj.siga.base.Texto;
 import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.model.ActiveRecord;
 import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.model.ContextoPersistencia;
 import br.gov.jfrj.siga.model.Historico;
 import br.gov.jfrj.siga.model.Selecionavel;
+import br.gov.jfrj.siga.parser.SiglaParser;
 import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
 import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
 import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
@@ -153,6 +155,8 @@ public class DpLotacao extends AbstractDpLotacao implements Serializable,
 		if (sigla == null) {
 			sigla = "";
 		}
+		if (ContextoPersistencia.getEntityManager() == null) 
+			return;
 		String siglasOrgaoUsu = "";
 		List<CpOrgaoUsuario> lou = CpDao.getInstance().listarOrgaosUsuarios();
 		for (CpOrgaoUsuario ou : lou) {
@@ -438,5 +442,9 @@ public class DpLotacao extends AbstractDpLotacao implements Serializable,
 	public String toString() {
 		return getSiglaCompleta();
 	}
-
+	
+	@Override
+	public String getSiglaDePessoaEOuLotacao() {
+		return SiglaParser.makeSigla(null, this);
+	}
 }
\ No newline at end of file
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpPessoa.betwixt b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpPessoa.betwixt
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpPessoa.betwixt
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpPessoa.betwixt
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpPessoa.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpPessoa.java
similarity index 99%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpPessoa.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpPessoa.java
index be4b3c88a2..b617716bfc 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpPessoa.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpPessoa.java
@@ -56,6 +56,7 @@ import br.gov.jfrj.siga.model.ActiveRecord;
 import br.gov.jfrj.siga.model.Assemelhavel;
 import br.gov.jfrj.siga.model.Historico;
 import br.gov.jfrj.siga.model.Selecionavel;
+import br.gov.jfrj.siga.parser.SiglaParser;
 import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
 import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
 import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
@@ -670,4 +671,9 @@ public class DpPessoa extends AbstractDpPessoa implements Serializable,
 		this.idSitConfiguracaoConfManual = idSitConfiguracaoConfManual;
 	}
 
+	@Override
+	public String getSiglaDePessoaEOuLotacao() {
+		return SiglaParser.makeSigla(this, this.getLotacao());
+	}
+
 }
\ No newline at end of file
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpResponsavel.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpResponsavel.java
similarity index 88%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpResponsavel.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpResponsavel.java
index de0f091df5..847d8eb2f4 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpResponsavel.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpResponsavel.java
@@ -20,8 +20,11 @@ package br.gov.jfrj.siga.dp;
 
 import br.gov.jfrj.siga.model.Objeto;
 
-public abstract class DpResponsavel extends Objeto{
+@SuppressWarnings("serial")
+public abstract class DpResponsavel extends Objeto {
 	abstract public String getSigla();
 
 	abstract public String getSiglaCompleta();
+
+	abstract public String getSiglaDePessoaEOuLotacao();
 }
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpSubstituicao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpSubstituicao.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/DpSubstituicao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/DpSubstituicao.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/ImportacaoXML.betwixt b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/ImportacaoXML.betwixt
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/ImportacaoXML.betwixt
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/ImportacaoXML.betwixt
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpDao.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpDao.java
similarity index 95%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpDao.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpDao.java
index 0f564c9b44..20ae837f2e 100644
--- a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpDao.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpDao.java
@@ -29,6 +29,7 @@ import java.sql.SQLException;
 import java.util.ArrayList;
 import java.util.Date;
 import java.util.Iterator;
+import java.util.LinkedList;
 import java.util.List;
 import java.util.Map;
 import java.util.TreeMap;
@@ -552,8 +553,7 @@ public class CpDao extends ModeloDao {
 			final CpAplicacaoFeriado apl) {
 		final Query query = em()
 				.createNamedQuery("listarAplicacoesFeriado");
-		query.setParameter("cpOcorrenciaFeriado", apl.getCpOcorrenciaFeriado()
-				.getId());
+		query.setParameter("cpOcorrenciaFeriado", apl.getCpOcorrenciaFeriado());
 
 		query.setHint("org.hibernate.cacheable", true);
 		query.setHint("org.hibernate.cacheRegion", CACHE_QUERY_HOURS);
@@ -1122,9 +1122,13 @@ public class CpDao extends ModeloDao {
 			query.setParameter("nome",
 					flt.getNome().toUpperCase().replace(' ', '%'));
 
-			if (!flt.isBuscarFechadas())
+			if (!flt.isBuscarFechadas()) {
+				String situacaoFuncionalPessoa = flt.getSituacaoFuncionalPessoa();
+				if (situacaoFuncionalPessoa != null && situacaoFuncionalPessoa.length() == 0)
+					situacaoFuncionalPessoa = null;
 				query.setParameter("situacaoFuncionalPessoa",
-						flt.getSituacaoFuncionalPessoa());
+						situacaoFuncionalPessoa);
+			}
 
 			if(flt.getCpf() != null && !"".equals(flt.getCpf())) {
 				query.setParameter("cpf", Long.valueOf(flt.getCpf()));
@@ -1417,13 +1421,19 @@ public class CpDao extends ModeloDao {
 			Root<DpPessoa> c = q.from(DpPessoa.class);
 			q.select(c);
 			Join<DpPessoa, DpLotacao> joinLotacao = c.join("lotacao", JoinType.LEFT);
-			q.where(cb().equal(joinLotacao.get("idLotacao"), lot.getId()));
+			
+			List<Predicate> whereList = new LinkedList<Predicate>();
+			whereList.add(cb().equal(joinLotacao.get("idLotacao"), lot.getId()));
 			if (somenteServidor) { 
 				Join<DpPessoa, DpCargo> joinCargo = c.join("cargo", JoinType.LEFT);
-				q.where(joinCargo.get("nomeCargo").in(values));
+				whereList.add(joinCargo.get("nomeCargo").in(values));
 			}
-			q.where(c.get("situacaoFuncionalPessoa").in(situacoesFuncionais.getValor()));
-			q.where(cb().isNull(c.get("dataFimPessoa")));
+			whereList.add(c.get("situacaoFuncionalPessoa").in(situacoesFuncionais.getValor()));
+			whereList.add(cb().isNull(c.get("dataFimPessoa")));
+			Predicate[] whereArray = new Predicate[whereList.size()];
+			whereList.toArray(whereArray);
+			q.where(whereArray);
+
 			q.orderBy(cb().asc(c.get("nomePessoa")));
 			lstCompleta.addAll((List<DpPessoa>) em().createQuery(q).getResultList());
 		}
@@ -1452,7 +1462,9 @@ public class CpDao extends ModeloDao {
 		if (dialect != null && dialect.contains("MySQL"))
 			sql = "SELECT CURRENT_TIMESTAMP";
 	    Query query = em().createNativeQuery(sql);
-	    return (Date) query.getSingleResult();
+	    Date dt = (Date) query.getSingleResult();
+	    ContextoPersistencia.setDt(dt);
+		return dt; 
 	}
 
 	public List<CpConfiguracao> consultarConfiguracoesDesde(Date desde) {
@@ -1528,13 +1540,14 @@ public class CpDao extends ModeloDao {
 	}
 
 	@SuppressWarnings("unchecked")
-	public <T> List<T> listarAtivos(Class<T> clazz, String dtFim,
+	public <T> List<T> listarAtivos(Class<T> clazz, String campoDtFim,
 			long idOrgaoUsu) {
 		final CriteriaBuilder criteriaBuilder = em().getCriteriaBuilder();
-		CriteriaQuery<T> crit = criteriaBuilder.createQuery(clazz);
-		Root<T> root = crit.from(clazz);
-		crit.where(cb().isNull(root.get("hisDtFim")), cb().equal(root.get("orgaoUsuario.idOrgaoUsu"), idOrgaoUsu));
-		return em().createQuery(crit).getResultList();
+		CriteriaQuery<T> q = criteriaBuilder.createQuery(clazz);
+		Root<T> c = q.from(clazz);
+		Join<T, CpOrgaoUsuario> joinOrgao = c.join("orgaoUsuario", JoinType.INNER);
+		q.where(cb().isNull(c.get(campoDtFim)), cb().equal(joinOrgao.get("idOrgaoUsu"), idOrgaoUsu));
+		return em().createQuery(q).getResultList();
 	}
 
 	public <T> List<T> listarAtivos(Class<T> clazz, String orderBy) {
@@ -1562,8 +1575,10 @@ public class CpDao extends ModeloDao {
 		CriteriaQuery<T> q = cb().createQuery(clazz);
 		Root<T> c = q.from(clazz);
 		q.select(c);
-		q.where(cb().equal(c.get("hisIdIni"), hisIdIni));
-		q.where(cb().equal(c.get("hisAtivo"), 1));
+		q.where(
+			cb().equal(c.get("hisIdIni"), hisIdIni),
+			cb().equal(c.get("hisAtivo"), 1)
+		);
 
 		T obj = null;
 		try {
@@ -1947,17 +1962,21 @@ public class CpDao extends ModeloDao {
 		CriteriaQuery<DpPessoa> q = cb().createQuery(DpPessoa.class);
 		Root<DpPessoa> c = q.from(DpPessoa.class);
 		q.select(c);
-
+		Join<DpPessoa, CpOrgaoUsuario> joinOrgao = c.join("orgaoUsuario", JoinType.INNER);
+		
+		List<Predicate> whereList = new LinkedList<Predicate>();
+		whereList.add(cb().equal(joinOrgao.get("idOrgaoUsu"), idOrgaoUsu));
 		if(matricula != null) {
-			q.where(cb().equal(c.get("matricula"), matricula));
+			whereList.add(cb().equal(c.get("matricula"), matricula));
 		}
-		q.where(cb().equal(c.get("orgaoUsuario.idOrgaoUsu"), idOrgaoUsu));
-
 		if (pessoasFinalizadas) {
-			q.where(cb().isNotNull(c.get("dataFimPessoa")));
+			whereList.add(cb().isNotNull(c.get("dataFimPessoa")));
 		} else {
-			q.where(cb().isNull(c.get("dataFimPessoa")));
+			whereList.add(cb().isNull(c.get("dataFimPessoa")));
 		}
+		Predicate[] whereArray = new Predicate[whereList.size()];
+		whereList.toArray(whereArray);
+		q.where(whereArray);
 		if (ordemDesc) {
 			q.orderBy(cb().desc(c.get("dataInicioPessoa")));
 		} else {
@@ -1973,9 +1992,12 @@ public class CpDao extends ModeloDao {
 			CriteriaQuery<DpLotacao> q = cb().createQuery(DpLotacao.class);
 			Root<DpLotacao> c = q.from(DpLotacao.class);
 			q.select(c);
-			q.where(cb().equal(c.get("ideLotacao"), idExterna));
-			q.where(cb().equal(c.get("orgaoUsuario.idOrgaoUsu"), idOrgaoUsu));
-			q.where(cb().isNotNull(c.get("dataFimLotacao")));
+			Join<DpLotacao, CpOrgaoUsuario> joinOrgao = c.join("orgaoUsuario", JoinType.INNER);
+			q.where(
+				cb().equal(joinOrgao.get("idOrgaoUsu"), idOrgaoUsu),
+				cb().equal(c.get("ideLotacao"), idExterna),
+				cb().isNotNull(c.get("dataFimLotacao"))
+			);
 			q.orderBy(cb().desc(c.get("dataInicioLotacao")));
 			return em().createQuery(q).getResultList();
 		}
@@ -1984,9 +2006,12 @@ public class CpDao extends ModeloDao {
 			CriteriaQuery<DpCargo> q = cb().createQuery(DpCargo.class);
 			Root<DpCargo> c = q.from(DpCargo.class);
 			q.select(c);
-			q.where(cb().equal(c.get("ideCargo"), idExterna));
-			q.where(cb().equal(c.get("orgaoUsuario.idOrgaoUsu"), idOrgaoUsu));
-			q.where(cb().isNotNull(c.get("dataFimCargo")));
+			Join<DpCargo, CpOrgaoUsuario> joinOrgao = c.join("orgaoUsuario", JoinType.INNER);
+			q.where(
+				cb().equal(joinOrgao.get("idOrgaoUsu"), idOrgaoUsu),
+			    cb().equal(c.get("ideCargo"), idExterna),
+			    cb().isNotNull(c.get("dataFimCargo"))
+			);
 			q.orderBy(cb().desc(c.get("dataInicioCargo")));
 			return em().createQuery(q).getResultList();
 		}
@@ -1995,9 +2020,12 @@ public class CpDao extends ModeloDao {
 			CriteriaQuery<DpFuncaoConfianca> q = cb().createQuery(DpFuncaoConfianca.class);
 			Root<DpFuncaoConfianca> c = q.from(DpFuncaoConfianca.class);
 			q.select(c);
-			q.where(cb().equal(c.get("ideFuncao"), idExterna));
-			q.where(cb().equal(c.get("orgaoUsuario.idOrgaoUsu"), idOrgaoUsu));
-			q.where(cb().isNotNull(c.get("dataFimFuncao")));
+			Join<DpFuncaoConfianca, CpOrgaoUsuario> joinOrgao = c.join("orgaoUsuario", JoinType.INNER);
+			q.where(
+				cb().equal(joinOrgao.get("idOrgaoUsu"), idOrgaoUsu),
+				cb().equal(c.get("ideFuncao"), idExterna),
+				cb().isNotNull(c.get("dataFimFuncao"))
+			);
 			q.orderBy(cb().desc(c.get("dataInicioFuncao")));
 			return em().createQuery(q).getResultList();
 		}
@@ -2111,5 +2139,17 @@ public class CpDao extends ModeloDao {
 		qry.setParameter("idTpLotacao", idTpLotacao);
 		return qry.getResultList();
 	}
+	
+	public <T extends Selecionavel> T carregarPorId(T o) {
+		Long id = o.getId();
+		if (id == null)
+			return null;
+		return (T) consultar(id, o.getClass(), false);
+	}
+
+	public <T> T carregar(T objetoDetachado) {
+		return (T) em().find(objetoDetachado.getClass(), 
+				em().getEntityManagerFactory().getPersistenceUnitUtil().getIdentifier(objetoDetachado));
+	}
 
 }
\ No newline at end of file
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpDaoProducer.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpDaoProducer.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpDaoProducer.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpDaoProducer.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpGrupoDaoFiltro.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpGrupoDaoFiltro.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpGrupoDaoFiltro.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpGrupoDaoFiltro.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpOrgaoDaoFiltro.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpOrgaoDaoFiltro.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpOrgaoDaoFiltro.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpOrgaoDaoFiltro.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpOrgaoUsuarioDaoFiltro.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpOrgaoUsuarioDaoFiltro.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/CpOrgaoUsuarioDaoFiltro.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/CpOrgaoUsuarioDaoFiltro.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpCargoDaoFiltro.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpCargoDaoFiltro.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpCargoDaoFiltro.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpCargoDaoFiltro.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpFuncaoConfiancaDaoFiltro.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpFuncaoConfiancaDaoFiltro.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpFuncaoConfiancaDaoFiltro.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpFuncaoConfiancaDaoFiltro.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpLotacaoDaoFiltro.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpLotacaoDaoFiltro.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpLotacaoDaoFiltro.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpLotacaoDaoFiltro.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpPessoaDaoFiltro.java b/siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpPessoaDaoFiltro.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/dp/dao/DpPessoaDaoFiltro.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/dp/dao/DpPessoaDaoFiltro.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/parser/PessoaLotacaoParser.java b/siga-cp/src/main/java/br/gov/jfrj/siga/parser/PessoaLotacaoParser.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/parser/PessoaLotacaoParser.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/parser/PessoaLotacaoParser.java
diff --git a/siga-cp/src/main/app/br/gov/jfrj/siga/parser/SiglaParser.java b/siga-cp/src/main/java/br/gov/jfrj/siga/parser/SiglaParser.java
similarity index 100%
rename from siga-cp/src/main/app/br/gov/jfrj/siga/parser/SiglaParser.java
rename to siga-cp/src/main/java/br/gov/jfrj/siga/parser/SiglaParser.java
diff --git a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AcessoServicoRelatorio.java b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AcessoServicoRelatorio.java
index 018fddc099..d05b964646 100644
--- a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AcessoServicoRelatorio.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AcessoServicoRelatorio.java
@@ -106,17 +106,25 @@ public class AcessoServicoRelatorio extends RelatorioTemplate {
 			throw new DJBuilderException("Orgao Usuario inválido ! erro:"
 					+ e.getMessage());
 		}
-
+		parametros.put("titulo","SIGA");
+		parametros.put("subtitulo","Sistema de Gestão Administrativa");
+		parametros.put("secaoUsuario", "");
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 	}
 
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException {
-		this.setTemplateFile(null);
+		//this.setTemplateFile(null);
 		this.setTitle("Acesso - " + getDescricaoTipoConfiguracao() + " - "
 				+ "(" + cpServico.getSiglaServico() + ") "
 				+ cpServico.getDscServico());
-		this.addColuna("Situação", 20, RelatorioRapido.ESQUERDA, true, false);
+		this.addColuna("Situação", 0, RelatorioRapido.ESQUERDA, true, false);
 		this.addColuna("Pessoa", 60, RelatorioRapido.ESQUERDA, false, false);
 		this.addColuna("Lotação", 20, RelatorioRapido.ESQUERDA, false, false);
 		this.addColuna("Desde", 12, RelatorioRapido.ESQUERDA, false, false);
diff --git a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AlteracaoDireitosRelatorio.java b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AlteracaoDireitosRelatorio.java
index 21a5b4ea02..0cb25455d1 100644
--- a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AlteracaoDireitosRelatorio.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/AlteracaoDireitosRelatorio.java
@@ -93,13 +93,22 @@ public class AlteracaoDireitosRelatorio extends RelatorioTemplate {
 		}
 		setDtInicio(t_dtaDataHoraIni);
 		setDtFim(t_dtaDataHoraFim);
+		parametros.put("titulo","SIGA");
+		parametros.put("subtitulo","Sistema de Gestão Administrativa");
+		parametros.put("secaoUsuario", "");
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		// this.setPageSizeAndOrientation(Page.Page_A4_Landscape());
 	}
 
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException {// jar:file:/fullpath/main.jar!/a.resource
-		this.setTemplateFile(null);
+		//this.setTemplateFile(null);
 		this.setTitle("Alteracao de Direitos - de "
 				+ parametros.get("dataInicio") + " até "
 				+ parametros.get("dataFim"));
diff --git a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/HistoricoUsuarioRelatorio.java b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/HistoricoUsuarioRelatorio.java
index 5498c5a188..a65e81f260 100644
--- a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/HistoricoUsuarioRelatorio.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/HistoricoUsuarioRelatorio.java
@@ -115,17 +115,26 @@ public class HistoricoUsuarioRelatorio extends RelatorioTemplate {
 		setPessoasDoUsuario(dao().obterPessoasDoUsuario(getDpPessoa()));
 		@SuppressWarnings("unused")
 		int conta = 0;
+		parametros.put("titulo","SIGA");
+		parametros.put("subtitulo","Sistema de Gestão Administrativa");
+		parametros.put("secaoUsuario", "");
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 	}
 
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException {
-		this.setTemplateFile(null);
+		//this.setTemplateFile(null);
 		this.setTitle("Histórico de Usuário: " + "(" + dpPessoa.getSesbPessoa()
 				+ dpPessoa.getMatricula() + ") " + dpPessoa.getNomePessoa());
 		this.addColuna("Lotação", 0, RelatorioRapido.ESQUERDA, true, false);
-		this.addColuna("Desde", 12, RelatorioRapido.ESQUERDA, false, false);
-		this.addColuna("Serviço", 40, RelatorioRapido.ESQUERDA, false, false);
+		this.addColuna("Desde", 25, RelatorioRapido.ESQUERDA, false, false);
+		this.addColuna("Serviço", 60, RelatorioRapido.ESQUERDA, false, false);
 		this.addColuna("Situação", 15, RelatorioRapido.ESQUERDA, false, false);
 		this.addColuna("Origem", 13, RelatorioRapido.ESQUERDA, false, false);
 		this.addColuna("Cadastrante", 20, RelatorioRapido.ESQUERDA, false,
diff --git a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/PermissaoUsuarioRelatorio.java b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/PermissaoUsuarioRelatorio.java
index 4ca3104d7e..46ad0b5191 100644
--- a/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/PermissaoUsuarioRelatorio.java
+++ b/siga-cp/src/main/java/br/gov/jfrj/siga/relatorio/PermissaoUsuarioRelatorio.java
@@ -38,12 +38,20 @@ public class PermissaoUsuarioRelatorio extends RelatorioTemplate{
 		} catch (Exception e) {
 			throw new DJBuilderException("Parâmetro idPessoa inválido!");
 		}
-		this.setPageSizeAndOrientation( Page.Page_A4_Landscape());
+		parametros.put("titulo","SIGA");
+		parametros.put("subtitulo","Sistema de Gestão Administrativa");
+		parametros.put("secaoUsuario", "");
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 	}
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException {
-		this.setTemplateFile(null);
+		//this.setTemplateFile(null);
 		this.setTitle("Permissão de " 
 				        + getDescricaoTipoConfiguracao() 
 						+ ": (" 
@@ -51,11 +59,12 @@ public class PermissaoUsuarioRelatorio extends RelatorioTemplate{
 						+ ") " 
 						+ dpPessoa.getNomePessoa()  
 						); 
-		this.addColuna("Serviço",58,RelatorioRapido.ESQUERDA,false, false);
-		this.addColuna("Situação",10,RelatorioRapido.ESQUERDA,false, false);
-		this.addColuna("Origem", 10,RelatorioRapido.ESQUERDA,false, false);
-		this.addColuna("Desde", 12,RelatorioRapido.ESQUERDA,false, false);  
-		this.addColuna("Cadastrante", 10,RelatorioRapido.ESQUERDA,false, false);
+		this.addColuna("Serviço",45,RelatorioRapido.ESQUERDA,false, false);
+		this.addColuna("Situação",7,RelatorioRapido.ESQUERDA,false, false);
+		this.addColuna("Origem", 7,RelatorioRapido.ESQUERDA,false, false);
+		this.addColuna("Desde", 9,RelatorioRapido.ESQUERDA,false, false);  
+		this.addColuna("Cadastrante", 9,RelatorioRapido.ESQUERDA,false, false);
+		this.setPageSizeAndOrientation( Page.Page_A4_Landscape());
 		return this;
 	}
 	/**
diff --git a/siga-cp/src/main/resources/db/migration/CORPORATIVO_UTF8_V49_0__cp_arquivo.sql b/siga-cp/src/main/resources/db/migration/CORPORATIVO_UTF8_V49_0__cp_arquivo.sql
index 1590c23793..f7c87fdf59 100644
--- a/siga-cp/src/main/resources/db/migration/CORPORATIVO_UTF8_V49_0__cp_arquivo.sql
+++ b/siga-cp/src/main/resources/db/migration/CORPORATIVO_UTF8_V49_0__cp_arquivo.sql
@@ -45,6 +45,7 @@ GRANT debug ON "CORPORATIVO"."CP_ARQUIVO" TO "SIGA";
 
 GRANT flashback ON "CORPORATIVO"."CP_ARQUIVO" TO "SIGA"; 
 
+GRANT SELECT ON "CORPORATIVO"."CP_ARQUIVO" TO "SIGAWF"; 
 
 CREATE TABLE "CORPORATIVO"."CP_ARQUIVO_BLOB" 
   ( 
@@ -77,3 +78,4 @@ GRANT debug ON "CORPORATIVO"."CP_ARQUIVO_BLOB" TO "SIGA";
 
 GRANT flashback ON "CORPORATIVO"."CP_ARQUIVO_BLOB" TO "SIGA"; 
 
+GRANT SELECT ON "CORPORATIVO"."CP_ARQUIVO_BLOB" TO "SIGAWF"; 
diff --git a/siga-cp/src/main/resources/db/mysql/CORPORATIVO_UTF8_V1_0__Inicial.sql b/siga-cp/src/main/resources/db/mysql/CORPORATIVO_UTF8_V1_0__Inicial.sql
deleted file mode 100644
index ed08380f95..0000000000
--- a/siga-cp/src/main/resources/db/mysql/CORPORATIVO_UTF8_V1_0__Inicial.sql
+++ /dev/null
@@ -1,1552 +0,0 @@
-CREATE DATABASE  IF NOT EXISTS `corporativo` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
-USE `corporativo`;
--- MySQL dump 10.13  Distrib 8.0.18, for Win64 (x86_64)
---
--- Host: 127.0.0.1    Database: corporativo
--- ------------------------------------------------------
--- Server version	8.0.18
-
-/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
-/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
-/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
-/*!50503 SET NAMES utf8 */;
-/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
-/*!40103 SET TIME_ZONE='+00:00' */;
-/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
-/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
-/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
-/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
-
---
--- Table structure for table `cad_sit_funcional`
---
-
-DROP TABLE IF EXISTS `cad_sit_funcional`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cad_sit_funcional` (
-  `ID_CAD_SIT_FUNCIONAL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DSC_SIT_FUNCIONAL` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_MUMPS` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_CAD_SIT_FUNCIONAL`),
-  UNIQUE KEY `CAD_SIT_FUNCIONAL_PK` (`ID_CAD_SIT_FUNCIONAL`)
-) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cad_sit_funcional`
---
-
-LOCK TABLES `cad_sit_funcional` WRITE;
-/*!40000 ALTER TABLE `cad_sit_funcional` DISABLE KEYS */;
-INSERT INTO `cad_sit_funcional` VALUES (1,'ATIVO',1),(2,'CEDIDO',45),(3,'POSSE EM CARGO INACUMULAVEL',25),(4,'APOSENTADO',5),(5,'EXONERADO',10),(6,'DEMITIDO',15),(7,'FALECIDO',20),(9,'RETORNO PARA ORGAO DE ORIGEM',40),(10,'TRANSFERIDO',35),(11,'LICENCA PARA ACOMPANHAR CONJUGE SEM REMUNERACAO',65),(12,'LICENCA PARA ACOMPANHAR CONJUGE COM EXERCICIO PROVISORIO',70),(13,'LICENCA PARA MANDATO CLASSISTA',75),(14,'LICENCA PARA ASSUNTOS PARTICULARES',80),(15,'ESTAGIARIO DESLIGADO (SADES)',125),(16,'DISPONIBILIDADE',50),(17,'REMOVIDO',115),(18,'AFASTAMENTO POR DECISAO JUDICIAL',100),(19,'POSSE ANULADA',30),(20,'REDISTRIBUIDO',55),(21,'PROMOVIDO TRF',60),(23,'LICENCA PARA CURSO DE FORMACAO',85),(25,'LICENCA PARA ATIVIDADE POLITICA',90),(26,'AFASTAMENTO PARA MANDATO ELETIVO',105),(29,'LICENCA PARA CAPACITACAO',95),(30,'AFASTAMENTO PARA ESTUDO/MISSAO EXTERIOR',110),(31,'REMOVIDO - LEI 11.416/06',120);
-/*!40000 ALTER TABLE `cad_sit_funcional` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_acesso`
---
-
-DROP TABLE IF EXISTS `cp_acesso`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_acesso` (
-  `ID_ACESSO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_IDENTIDADE` INT UNSIGNED NOT NULL,
-  `DT_INI` datetime NOT NULL,
-  `DT_FIM` datetime DEFAULT NULL,
-  `TP_ACESSO` tinyint(4) NOT NULL,
-  `IP_AUDIT` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_ACESSO`),
-  KEY `CP_ACESSO_IDENTIDADE_FK` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_ACESSO_IDENTIDADE_FK` FOREIGN KEY (`ID_IDENTIDADE`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`)
-) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_acesso`
---
-
-LOCK TABLES `cp_acesso` WRITE;
-/*!40000 ALTER TABLE `cp_acesso` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_acesso` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_aplicacao_feriado`
---
-
-DROP TABLE IF EXISTS `cp_aplicacao_feriado`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_aplicacao_feriado` (
-  `ID_APLICACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
-  `ID_LOTACAO` INT UNSIGNED DEFAULT NULL,
-  `ID_LOCALIDADE` INT UNSIGNED DEFAULT NULL,
-  `ID_OCORRENCIA_FERIADO` INT UNSIGNED DEFAULT NULL,
-  `FERIADO` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_APLICACAO`),
-  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
-  KEY `ID_LOTACAO` (`ID_LOTACAO`),
-  KEY `ID_LOCALIDADE` (`ID_LOCALIDADE`),
-  KEY `ID_OCORRENCIA_FERIADO` (`ID_OCORRENCIA_FERIADO`),
-  CONSTRAINT `cp_aplicacao_feriado_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `cp_aplicacao_feriado_ibfk_2` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
-  CONSTRAINT `cp_aplicacao_feriado_ibfk_3` FOREIGN KEY (`ID_LOCALIDADE`) REFERENCES `cp_localidade` (`ID_LOCALIDADE`),
-  CONSTRAINT `cp_aplicacao_feriado_ibfk_4` FOREIGN KEY (`ID_OCORRENCIA_FERIADO`) REFERENCES `cp_ocorrencia_feriado` (`ID_OCORRENCIA`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_aplicacao_feriado`
---
-
-LOCK TABLES `cp_aplicacao_feriado` WRITE;
-/*!40000 ALTER TABLE `cp_aplicacao_feriado` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_aplicacao_feriado` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_complexo`
---
-
-DROP TABLE IF EXISTS `cp_complexo`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_complexo` (
-  `ID_COMPLEXO` INT UNSIGNED NOT NULL,
-  `NOME_COMPLEXO` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_LOCALIDADE` INT UNSIGNED DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_COMPLEXO`),
-  KEY `ID_LOCALIDADE` (`ID_LOCALIDADE`),
-  CONSTRAINT `cp_complexo_ibfk_1` FOREIGN KEY (`ID_LOCALIDADE`) REFERENCES `cp_localidade` (`ID_LOCALIDADE`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_complexo`
---
-
-LOCK TABLES `cp_complexo` WRITE;
-/*!40000 ALTER TABLE `cp_complexo` DISABLE KEYS */;
-INSERT INTO `cp_complexo` VALUES (1,'Almirante Barroso',15,999999999),(2,'Angra',1,999999999),(3,'Barra do Piraí',2,999999999),(4,'Campos',4,999999999),(5,'Duque de Caxias',5,999999999),(6,'Equador',5,999999999),(7,'Friburgo',11,999999999),(8,'Itaboraí',6,999999999),(9,'Itaperuna',7,999999999),(10,'Macaé',8,999999999),(11,'Mage',9,999999999),(12,'Niteroi',10,999999999),(13,'Nova Iguaçu',12,999999999),(14,'Petrópolis',13,999999999),(15,'Resende',14,999999999),(16,'Rio Branco',15,999999999),(17,'Sao Gonçalo',16,999999999),(18,'Sao Joao de Meriti',17,999999999),(19,'Sao Pedro da Aldeia',19,999999999),(20,'São Cristovão',15,999999999),(21,'Teresópolis',20,999999999),(22,'Tres Rios',21,999999999),(23,'Venezuela',15,999999999),(24,'Volta Redonda',23,999999999),(25,'Visconde de Inhaúma',15,3),(27,'Campo Grande',671,1);
-/*!40000 ALTER TABLE `cp_complexo` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_configuracao`
---
-
-DROP TABLE IF EXISTS `cp_configuracao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_configuracao` (
-  `ID_CONFIGURACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DT_INI_VIG_CONFIGURACAO` datetime DEFAULT NULL,
-  `DT_FIM_VIG_CONFIGURACAO` datetime DEFAULT NULL,
-  `his_dt_ini` datetime DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
-  `ID_LOTACAO` INT UNSIGNED DEFAULT NULL,
-  `ID_CARGO` INT UNSIGNED DEFAULT NULL,
-  `ID_FUNCAO_CONFIANCA` INT UNSIGNED DEFAULT NULL,
-  `ID_PESSOA` INT UNSIGNED DEFAULT NULL,
-  `ID_SIT_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
-  `ID_TP_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
-  `ID_SERVICO` INT UNSIGNED DEFAULT NULL,
-  `ID_GRUPO` INT UNSIGNED DEFAULT NULL,
-  `NM_EMAIL` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DESC_FORMULA` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_TP_LOTACAO` INT UNSIGNED DEFAULT NULL,
-  `ID_IDENTIDADE` INT UNSIGNED DEFAULT NULL,
-  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
-  `HIS_DT_FIM` datetime DEFAULT NULL,
-  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
-  `ID_COMPLEXO` INT UNSIGNED DEFAULT NULL,
-  `ID_ORGAO_OBJETO` INT UNSIGNED DEFAULT NULL,
-  `DESCR_CONFIGURACAO` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_LOTACAO_OBJETO` INT UNSIGNED DEFAULT NULL,
-  `ID_COMPLEXO_OBJETO` INT UNSIGNED DEFAULT NULL,
-  `ID_CARGO_OBJETO` INT UNSIGNED DEFAULT NULL,
-  `ID_FUNCAO_CONFIANCA_OBJETO` INT UNSIGNED DEFAULT NULL,
-  `ID_PESSOA_OBJETO` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_CONFIGURACAO`),
-  UNIQUE KEY `CP_CONF_ID_CONFIGURACAO_PK` (`ID_CONFIGURACAO`),
-  KEY `CP_CONF_CP_GRUP_ID_GRP_FK` (`ID_GRUPO`),
-  KEY `CP_CONF_CP_IDENT_IDC_FIM_FK` (`HIS_IDC_FIM`),
-  KEY `CP_CONF_CP_IDENT_IDC_INI_FK` (`HIS_IDC_INI`),
-  KEY `CP_CONF_CP_IDENT_ID_IDENT_FK` (`ID_IDENTIDADE`),
-  KEY `CP_CONF_CP_ORG_USU_ID_FK` (`ID_ORGAO_USU`),
-  KEY `CP_CONF_CP_SERV_ID_SERVICO_FK` (`ID_SERVICO`),
-  KEY `CP_CONF_CP_SIT_CONF_ID_FK` (`ID_SIT_CONFIGURACAO`),
-  KEY `CP_CONF_CP_TPLOT_ID_TP_LOT_FK` (`ID_TP_LOTACAO`),
-  KEY `CP_CONF_CP_TP_CONF_ID_FK` (`ID_TP_CONFIGURACAO`),
-  KEY `CP_CONF_DP_CARGO_ID_CARGO_FK` (`ID_CARGO`),
-  KEY `CP_CONF_DP_F_CONFIANCA_ID_FK` (`ID_FUNCAO_CONFIANCA`),
-  KEY `CP_CONF_DP_LOT_ID_LOTACAO_FK` (`ID_LOTACAO`),
-  KEY `CP_CONF_DP_PES_ID_PESSOA_FK` (`ID_PESSOA`),
-  KEY `CP_CONFIGURACAO_COMPLEXO_FK` (`ID_COMPLEXO`),
-  CONSTRAINT `CP_CONFIGURACAO_COMPLEXO_FK` FOREIGN KEY (`ID_COMPLEXO`) REFERENCES `cp_complexo` (`ID_COMPLEXO`),
-  CONSTRAINT `CP_CONF_CP_GRUP_ID_GRP_FK` FOREIGN KEY (`ID_GRUPO`) REFERENCES `cp_grupo` (`ID_GRUPO`),
-  CONSTRAINT `CP_CONF_CP_IDENT_IDC_FIM_FK` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_CONF_CP_IDENT_IDC_INI_FK` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_CONF_CP_IDENT_ID_IDENT_FK` FOREIGN KEY (`ID_IDENTIDADE`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_CONF_CP_ORG_USU_ID_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `CP_CONF_CP_SERV_ID_SERVICO_FK` FOREIGN KEY (`ID_SERVICO`) REFERENCES `cp_servico` (`ID_SERVICO`),
-  CONSTRAINT `CP_CONF_CP_SIT_CONF_ID_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_situacao_configuracao` (`ID_SIT_CONFIGURACAO`),
-  CONSTRAINT `CP_CONF_CP_TPLOT_ID_TP_LOT_FK` FOREIGN KEY (`ID_TP_LOTACAO`) REFERENCES `cp_tipo_lotacao` (`ID_TP_LOTACAO`),
-  CONSTRAINT `CP_CONF_CP_TP_CONF_ID_FK` FOREIGN KEY (`ID_TP_CONFIGURACAO`) REFERENCES `cp_tipo_configuracao` (`ID_TP_CONFIGURACAO`),
-  CONSTRAINT `CP_CONF_DP_CARGO_ID_CARGO_FK` FOREIGN KEY (`ID_CARGO`) REFERENCES `dp_cargo` (`ID_CARGO`),
-  CONSTRAINT `CP_CONF_DP_F_CONFIANCA_ID_FK` FOREIGN KEY (`ID_FUNCAO_CONFIANCA`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
-  CONSTRAINT `CP_CONF_DP_LOT_ID_LOTACAO_FK` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
-  CONSTRAINT `CP_CONF_DP_PES_ID_PESSOA_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
-) ENGINE=InnoDB AUTO_INCREMENT=38 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_configuracao`
---
-
-LOCK TABLES `cp_configuracao` WRITE;
-/*!40000 ALTER TABLE `cp_configuracao` DISABLE KEYS */;
-INSERT INTO `cp_configuracao` VALUES (1,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,2,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(2,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,65,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(3,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,3,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(4,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,42,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(5,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,41,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(6,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,24,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(7,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,16,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(8,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,284,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(9,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,306,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(10,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,15,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(11,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,17,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(12,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,18,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(13,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,19,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(14,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,20,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(15,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,21,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(16,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,22,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(17,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,23,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(18,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,1,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(19,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,305,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(20,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,304,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(21,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,62,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(22,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,64,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(23,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,63,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(24,NULL,NULL,'2020-02-07 16:07:37',NULL,NULL,NULL,NULL,1,1,200,307,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(25,NULL,NULL,'2020-02-07 16:07:37',NULL,NULL,NULL,NULL,1,1,200,308,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(26,'2012-03-12 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,18,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(27,'2012-03-12 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,19,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(28,'2012-03-12 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,3,4,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(29,'2012-10-31 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,1,30,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(30,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,2,2,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(31,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,2,2,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(32,NULL,NULL,'2014-04-11 17:03:01',NULL,NULL,NULL,NULL,NULL,1,35,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(33,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(34,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(35,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(36,'2020-02-07 16:07:40',NULL,NULL,NULL,NULL,NULL,NULL,NULL,1,200,310,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,35,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(37,'2020-02-07 16:07:40',NULL,NULL,NULL,NULL,NULL,NULL,NULL,1,200,4,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,36,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
-/*!40000 ALTER TABLE `cp_configuracao` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_feriado`
---
-
-DROP TABLE IF EXISTS `cp_feriado`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_feriado` (
-  `ID_FERIADO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DSC_FERIADO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  PRIMARY KEY (`ID_FERIADO`),
-  UNIQUE KEY `FERIADO_PK` (`ID_FERIADO`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_feriado`
---
-
-LOCK TABLES `cp_feriado` WRITE;
-/*!40000 ALTER TABLE `cp_feriado` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_feriado` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_grupo`
---
-
-DROP TABLE IF EXISTS `cp_grupo`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_grupo` (
-  `ID_GRUPO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_TP_GRUPO` INT UNSIGNED NOT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  `ID_GRUPO_PAI` INT UNSIGNED DEFAULT NULL,
-  `SIGLA_GRUPO` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DESC_GRUPO` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_DT_INI` datetime NOT NULL,
-  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_DT_FIM` datetime DEFAULT NULL,
-  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
-  `HIS_ATIVO` tinyint(4) NOT NULL,
-  PRIMARY KEY (`ID_GRUPO`),
-  UNIQUE KEY `CP_GRUPO_PK` (`ID_GRUPO`),
-  KEY `CP_GRP_CP_GRP_ID_INI_FK` (`HIS_ID_INI`),
-  KEY `CP_GRP_CP_GRP_ID_PAI_FK` (`ID_GRUPO_PAI`),
-  KEY `CP_GRP_CP_IDENT_IDC_FIM_FK` (`HIS_IDC_FIM`),
-  KEY `CP_GRP_CP_IDENT_IDC_INI_FK` (`HIS_IDC_INI`),
-  KEY `CP_GRP_CP_TP_GRP_ID_TP_GRP_FK` (`ID_TP_GRUPO`),
-  CONSTRAINT `CP_GRP_CP_GRP_ID_INI_FK` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_grupo` (`ID_GRUPO`),
-  CONSTRAINT `CP_GRP_CP_GRP_ID_PAI_FK` FOREIGN KEY (`ID_GRUPO_PAI`) REFERENCES `cp_grupo` (`ID_GRUPO`),
-  CONSTRAINT `CP_GRP_CP_IDENT_IDC_FIM_FK` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_GRP_CP_IDENT_IDC_INI_FK` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_GRP_CP_TP_GRP_ID_TP_GRP_FK` FOREIGN KEY (`ID_TP_GRUPO`) REFERENCES `cp_tipo_grupo` (`ID_TP_GRUPO`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_grupo`
---
-
-LOCK TABLES `cp_grupo` WRITE;
-/*!40000 ALTER TABLE `cp_grupo` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_grupo` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_identidade`
---
-
-DROP TABLE IF EXISTS `cp_identidade`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_identidade` (
-  `ID_IDENTIDADE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_TP_IDENTIDADE` INT UNSIGNED DEFAULT NULL,
-  `ID_PESSOA` INT UNSIGNED DEFAULT NULL,
-  `DATA_CRIACAO_IDENTIDADE` datetime DEFAULT NULL,
-  `DATA_EXPIRACAO_IDENTIDADE` datetime DEFAULT NULL,
-  `DATA_CANCELAMENTO_IDENTIDADE` datetime DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
-  `LOGIN_IDENTIDADE` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SENHA_IDENTIDADE` varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SENHA_IDENTIDADE_CRIPTO` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SENHA_IDENTIDADE_CRIPTO_SINC` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_DT_INI` datetime NOT NULL,
-  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_DT_FIM` datetime DEFAULT NULL,
-  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
-  `HIS_ATIVO` tinyint(4) NOT NULL,
-  PRIMARY KEY (`ID_IDENTIDADE`),
-  UNIQUE KEY `CP_IDENTIDADE_PK` (`ID_IDENTIDADE`),
-  UNIQUE KEY `apenas_uma_id_ativa` (`ID_TP_IDENTIDADE`,`LOGIN_IDENTIDADE`),
-  KEY `CP_IDENT_CPORGUSU_ID_ORGUSU_FK` (`ID_ORGAO_USU`),
-  KEY `CP_IDENT_CP_IDENT_IDC_FIM_FK` (`HIS_IDC_FIM`),
-  KEY `CP_IDENT_CP_IDENT_IDC_INI_FK` (`HIS_IDC_INI`),
-  KEY `CP_IDENT_CP_IDENT_ID_INI_FK` (`HIS_ID_INI`),
-  KEY `CP_IDENT_DP_PESS_ID_PESS_FK` (`ID_PESSOA`),
-  KEY `IDX_LOGIN_IDENTIDADE` (`LOGIN_IDENTIDADE`),
-  CONSTRAINT `CP_IDENT_CPORGUSU_ID_ORGUSU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `CP_IDENT_CP_IDENT_IDC_FIM_FK` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_IDENT_CP_IDENT_IDC_INI_FK` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_IDENT_CP_IDENT_ID_INI_FK` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `CP_IDENT_CP_TPIDT_ID_TP_IDT_FK` FOREIGN KEY (`ID_TP_IDENTIDADE`) REFERENCES `cp_tipo_identidade` (`ID_TP_IDENTIDADE`),
-  CONSTRAINT `CP_IDENT_DP_PESS_ID_PESS_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
-) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_identidade`
---
-
-LOCK TABLES `cp_identidade` WRITE;
-/*!40000 ALTER TABLE `cp_identidade` DISABLE KEYS */;
-INSERT INTO `cp_identidade` VALUES (1,1,1,'2011-10-26 00:00:00',NULL,NULL,999999999,'ZZ99999','2ac9cb7dc02b3c0083eb70898e549b63','I20BhBeI7KavVeWdbIa8+g==','I20BhBeI7KavVeWdbIa8+g==',1,'2011-10-26 00:00:00',1,NULL,NULL,1);
-/*!40000 ALTER TABLE `cp_identidade` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_localidade`
---
-
-DROP TABLE IF EXISTS `cp_localidade`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_localidade` (
-  `ID_LOCALIDADE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_LOCALIDADE` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `ID_UF` INT UNSIGNED NOT NULL,
-  PRIMARY KEY (`ID_LOCALIDADE`),
-  UNIQUE KEY `LOCALIDADE_FK` (`ID_LOCALIDADE`),
-  KEY `UF_LOCALIDADE_FK` (`ID_UF`),
-  CONSTRAINT `UF_LOCALIDADE_FK` FOREIGN KEY (`ID_UF`) REFERENCES `cp_uf` (`ID_UF`)
-) ENGINE=InnoDB AUTO_INCREMENT=672 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_localidade`
---
-
-LOCK TABLES `cp_localidade` WRITE;
-/*!40000 ALTER TABLE `cp_localidade` DISABLE KEYS */;
-INSERT INTO `cp_localidade` VALUES (1,'Angra dos Reis',19),(2,'Barra do Piraí',19),(3,'Cachoeiro do Itapemirim',8),(4,'Campos',19),(5,'Duque de Caxias',19),(6,'Itaboraí',19),(7,'Itaperuna',19),(8,'Macaé',19),(9,'Magé',19),(10,'Niterói',19),(11,'Nova Friburgo',19),(12,'Nova Iguaçu',19),(13,'Petrópolis',19),(14,'Resende',19),(15,'Rio de Janeiro',19),(16,'São Gonçalo',19),(17,'São João de Meriti',19),(18,'São Mateus',8),(19,'São Pedro da Aldeia',19),(20,'Teresópolis',19),(21,'Três Rios',19),(22,'Vitória',8),(23,'Volta Redonda',19),(24,'Campo Grande',19),(25,'São Paulo',26),(26,'Adamantina',26),(27,'Adolfo',26),(28,'Aguaí',26),(29,'Águas da Prata',26),(30,'Águas de Lindóia',26),(31,'Águas de Santa Bárbara',26),(32,'Águas de São Pedro',26),(33,'Agudos',26),(34,'Alambari',26),(35,'Alfredo Marcondes',26),(36,'Altair',26),(37,'Altinópolis',26),(38,'Alto Alegre',26),(39,'Alumínio',26),(40,'Álvares Florence',26),(41,'Álvares Machado',26),(42,'Álvaro de Carvalho',26),(43,'Alvinlândia',26),(44,'Americana',26),(45,'Américo Brasiliense',26),(46,'Américo de Campos',26),(47,'Amparo',26),(48,'Analândia',26),(49,'Andradina',26),(50,'Angatuba',26),(51,'Anhembi',26),(52,'Anhumas',26),(53,'Aparecida',26),(54,'Aparecida d\'Oeste',26),(55,'Apiaí',26),(56,'Araçariguama',26),(57,'Araçatuba',26),(58,'Araçoiaba da Serra',26),(59,'Aramina',26),(60,'Arandu',26),(61,'Arapeí',26),(62,'Araraquara',26),(63,'Araras',26),(64,'Arco-Íris',26),(65,'Arealva',26),(66,'Areias',26),(67,'Areiópolis',26),(68,'Ariranha',26),(69,'Artur Nogueira',26),(70,'Arujá',26),(71,'Aspásia',26),(72,'Assis',26),(73,'Atibaia',26),(74,'Auriflama',26),(75,'Avaí',26),(76,'Avanhandava',26),(77,'Avaré',26),(78,'Bady Bassitt',26),(79,'Balbinos',26),(80,'Bálsamo',26),(81,'Bananal',26),(82,'Barão de Antonina',26),(83,'Barbosa',26),(84,'Bariri',26),(85,'Barra Bonita',26),(86,'Barra do Chapéu',26),(87,'Barra do Turvo',26),(88,'Barretos',26),(89,'Barrinha',26),(90,'Barueri',26),(91,'Bastos',26),(92,'Batatais',26),(93,'Bauru',26),(94,'Bebedouro',26),(95,'Bento de Abreu',26),(96,'Bernardino de Campos',26),(97,'Bertioga',26),(98,'Bilac',26),(99,'Birigui',26),(100,'Biritiba-Mirim',26),(101,'Boa Esperança do Sul',26),(102,'Bocaina',26),(103,'Bofete',26),(104,'Boituva',26),(105,'Bom Jesus dos Perdões',26),(106,'Bom Sucesso de Itararé',26),(107,'Borá',26),(108,'Boracéia',26),(109,'Borborema',26),(110,'Borebi',26),(111,'Botucatu',26),(112,'Bragança Paulista',26),(113,'Braúna',26),(114,'Brejo Alegre',26),(115,'Brodowski',26),(116,'Brotas',26),(117,'Buri',26),(118,'Buritama',26),(119,'Buritizal',26),(120,'Cabrália Paulista',26),(121,'Cabreúva',26),(122,'Caçapava',26),(123,'Cachoeira Paulista',26),(124,'Caconde',26),(125,'Cafelândia',26),(126,'Caiabu',26),(127,'Caieiras',26),(128,'Caiuá',26),(129,'Cajamar',26),(130,'Cajati',26),(131,'Cajobi',26),(132,'Cajuru',26),(133,'Campina do Monte Alegre',26),(134,'Campinas',26),(135,'Campo Limpo Paulista',26),(136,'Campos do Jordão',26),(137,'Campos Novos Paulista',26),(138,'Cananéia',26),(139,'Canas',26),(140,'Cândido Mota',26),(141,'Cândido Rodrigues',26),(142,'Canitar',26),(143,'Capão Bonito',26),(144,'Capela do Alto',26),(145,'Capivari',26),(146,'Caraguatatuba',26),(147,'Carapicuíba',26),(148,'Cardoso',26),(149,'Casa Branca',26),(150,'Cássia dos Coqueiros',26),(151,'Castilho',26),(152,'Catanduva',26),(153,'Catiguá',26),(154,'Cedral',26),(155,'Cerqueira César',26),(156,'Cerquilho',26),(157,'Cesário Lange',26),(158,'Charqueada',26),(159,'Chavantes',26),(160,'Clementina',26),(161,'Colina',26),(162,'Colômbia',26),(163,'Conchal',26),(164,'Conchas',26),(165,'Cordeirópolis',26),(166,'Coroados',26),(167,'Coronel Macedo',26),(168,'Corumbataí',26),(169,'Cosmópolis',26),(170,'Cosmorama',26),(171,'Cotia',26),(172,'Cravinhos',26),(173,'Cristais Paulista',26),(174,'Cruzália',26),(175,'Cruzeiro',26),(176,'Cubatão',26),(177,'Cunha',26),(178,'Descalvado',26),(179,'Diadema',26),(180,'Dirce Reis',26),(181,'Divinolândia',26),(182,'Dobrada',26),(183,'Dois Córregos',26),(184,'Dolcinópolis',26),(185,'Dourado',26),(186,'Dracena',26),(187,'Duartina',26),(188,'Dumont',26),(189,'Echaporã',26),(190,'Eldorado',26),(191,'Elias Fausto',26),(192,'Elisiário',26),(193,'Embaúba',26),(194,'Embu',26),(195,'Embu-Guaçu',26),(196,'Emilianópolis',26),(197,'Engenheiro Coelho',26),(198,'Espírito Santo do Pinhal',26),(199,'Espírito Santo do Turvo',26),(200,'Estiva Gerbi',26),(201,'Estrela do Norte',26),(202,'Estrela d\'Oeste',26),(203,'Euclides da Cunha Paulista',26),(204,'Fartura',26),(205,'Fernando Prestes',26),(206,'Fernandópolis',26),(207,'Fernão',26),(208,'Ferraz de Vasconcelos',26),(209,'Flora Rica',26),(210,'Floreal',26),(211,'Flórida Paulista',26),(212,'Florínia',26),(213,'Franca',26),(214,'Francisco Morato',26),(215,'Franco da Rocha',26),(216,'Gabriel Monteiro',26),(217,'Gália',26),(218,'Garça',26),(219,'Gastão Vidigal',26),(220,'Gavião Peixoto',26),(221,'General Salgado',26),(222,'Getulina',26),(223,'Glicério',26),(224,'Guaiçara',26),(225,'Guaimbê',26),(226,'Guaíra',26),(227,'Guapiaçu',26),(228,'Guapiara',26),(229,'Guará',26),(230,'Guaraçaí',26),(231,'Guaraci',26),(232,'Guarani d\'Oeste',26),(233,'Guarantã',26),(234,'Guararapes',26),(235,'Guararema',26),(236,'Guaratinguetá',26),(237,'Guareí',26),(238,'Guariba',26),(239,'Guarujá',26),(240,'Guarulhos',26),(241,'Guatapará',26),(242,'Guzolândia',26),(243,'Herculândia',26),(244,'Holambra',26),(245,'Hortolândia',26),(246,'Iacanga',26),(247,'Iacri',26),(248,'Iaras',26),(249,'Ibaté',26),(250,'Ibirá',26),(251,'Ibirarema',26),(252,'Ibitinga',26),(253,'Ibiúna',26),(254,'Icém',26),(255,'Iepê',26),(256,'Igaraçu do Tietê',26),(257,'Igarapava',26),(258,'Igaratá',26),(259,'Iguape',26),(260,'Ilha Comprida',26),(261,'Ilha Solteira',26),(262,'Ilhabela',26),(263,'Indaiatuba',26),(264,'Indiana',26),(265,'Indiaporã',26),(266,'Inúbia Paulista',26),(267,'Ipaussu',26),(268,'Iperó',26),(269,'Ipeúna',26),(270,'Ipiguá',26),(271,'Iporanga',26),(272,'Ipuã',26),(273,'Iracemápolis',26),(274,'Irapuã',26),(275,'Irapuru',26),(276,'Itaberá',26),(277,'Itaí',26),(278,'Itajobi',26),(279,'Itaju',26),(280,'Itanhaém',26),(281,'Itaóca',26),(282,'Itapecerica da Serra',26),(283,'Itapetininga',26),(284,'Itapeva',26),(285,'Itapevi',26),(286,'Itapira',26),(287,'Itapirapuã Paulista',26),(288,'Itápolis',26),(289,'Itaporanga',26),(290,'Itapuí',26),(291,'Itapura',26),(292,'Itaquaquecetuba',26),(293,'Itararé',26),(294,'Itariri',26),(295,'Itatiba',26),(296,'Itatinga',26),(297,'Itirapina',26),(298,'Itirapuã',26),(299,'Itobi',26),(300,'Itu',26),(301,'Itupeva',26),(302,'Ituverava',26),(303,'Jaborandi',26),(304,'Jaboticabal',26),(305,'Jacareí',26),(306,'Jaci',26),(307,'Jacupiranga',26),(308,'Jaguariúna',26),(309,'Jales',26),(310,'Jambeiro',26),(311,'Jandira',26),(312,'Jardinópolis',26),(313,'Jarinu',26),(314,'Jaú',26),(315,'Jeriquara',26),(316,'Joanópolis',26),(317,'João Ramalho',26),(318,'José Bonifácio',26),(319,'Júlio Mesquita',26),(320,'Jumirim',26),(321,'Jundiaí',26),(322,'Junqueirópolis',26),(323,'Juquiá',26),(324,'Juquitiba',26),(325,'Lagoinha',26),(326,'Laranjal Paulista',26),(327,'Lavínia',26),(328,'Lavrinhas',26),(329,'Leme',26),(330,'Lençóis Paulista',26),(331,'Limeira',26),(332,'Lindóia',26),(333,'Lins',26),(334,'Lorena',26),(335,'Lourdes',26),(336,'Louveira',26),(337,'Lucélia',26),(338,'Lucianópolis',26),(339,'Luís Antônio',26),(340,'Luiziânia',26),(341,'Lupércio',26),(342,'Lutécia',26),(343,'Macatuba',26),(344,'Macaubal',26),(345,'Macedônia',26),(346,'Magda',26),(347,'Mairinque',26),(348,'Mairiporã',26),(349,'Manduri',26),(350,'Marabá Paulista',26),(351,'Maracaí',26),(352,'Marapoama',26),(353,'Mariápolis',26),(354,'Marília',26),(355,'Marinópolis',26),(356,'Martinópolis',26),(357,'Matão',26),(358,'Mauá',26),(359,'Mendonça',26),(360,'Meridiano',26),(361,'Mesópolis',26),(362,'Miguelópolis',26),(363,'Mineiros do Tietê',26),(364,'Mira Estrela',26),(365,'Miracatu',26),(366,'Mirandópolis',26),(367,'Mirante do Paranapanema',26),(368,'Mirassol',26),(369,'Mirassolândia',26),(370,'Mococa',26),(371,'Mogi das Cruzes',26),(372,'Mogi Guaçu',26),(373,'Moji Mirim',26),(374,'Mombuca',26),(375,'Monções',26),(376,'Mongaguá',26),(377,'Monte Alegre do Sul',26),(378,'Monte Alto',26),(379,'Monte Aprazível',26),(380,'Monte Azul Paulista',26),(381,'Monte Castelo',26),(382,'Monte Mor',26),(383,'Monteiro Lobato',26),(384,'Morro Agudo',26),(385,'Morungaba',26),(386,'Motuca',26),(387,'Murutinga do Sul',26),(388,'Nantes',26),(389,'Narandiba',26),(390,'Natividade da Serra',26),(391,'Nazaré Paulista',26),(392,'Neves Paulista',26),(393,'Nhandeara',26),(394,'Nipoã',26),(395,'Nova Aliança',26),(396,'Nova Campina',26),(397,'Nova Canaã Paulista',26),(398,'Nova Castilho',26),(399,'Nova Europa',26),(400,'Nova Granada',26),(401,'Nova Guataporanga',26),(402,'Nova Independência',26),(403,'Nova Luzitânia',26),(404,'Nova Odessa',26),(405,'Novais',26),(406,'Novo Horizonte',26),(407,'Nuporanga',26),(408,'Ocauçu',26),(409,'Óleo',26),(410,'Olímpia',26),(411,'Onda Verde',26),(412,'Oriente',26),(413,'Orindiúva',26),(414,'Orlândia',26),(415,'Osasco',26),(416,'Oscar Bressane',26),(417,'Osvaldo Cruz',26),(418,'Ourinhos',26),(419,'Ouro Verde',26),(420,'Ouroeste',26),(421,'Pacaembu',26),(422,'Palestina',26),(423,'Palmares Paulista',26),(424,'Palmeira d\'Oeste',26),(425,'Palmital',26),(426,'Panorama',26),(427,'Paraguaçu Paulista',26),(428,'Paraibuna',26),(429,'Paraíso',26),(430,'Paranapanema',26),(431,'Paranapuã',26),(432,'Parapuã',26),(433,'Pardinho',26),(434,'Pariquera-Açu',26),(435,'Parisi',26),(436,'Patrocínio Paulista',26),(437,'Paulicéia',26),(438,'Paulínia',26),(439,'Paulistânia',26),(440,'Paulo de Faria',26),(441,'Pederneiras',26),(442,'Pedra Bela',26),(443,'Pedranópolis',26),(444,'Pedregulho',26),(445,'Pedreira',26),(446,'Pedrinhas Paulista',26),(447,'Pedro de Toledo',26),(448,'Penápolis',26),(449,'Pereira Barreto',26),(450,'Pereiras',26),(451,'Peruíbe',26),(452,'Piacatu',26),(453,'Piedade',26),(454,'Pilar do Sul',26),(455,'Pindamonhangaba',26),(456,'Pindorama',26),(457,'Pinhalzinho',26),(458,'Piquerobi',26),(459,'Piquete',26),(460,'Piracaia',26),(461,'Piracicaba',26),(462,'Piraju',26),(463,'Pirajuí',26),(464,'Pirangi',26),(465,'Pirapora do Bom Jesus',26),(466,'Pirapozinho',26),(467,'Pirassununga',26),(468,'Piratininga',26),(469,'Pitangueiras',26),(470,'Planalto',26),(471,'Platina',26),(472,'Poá',26),(473,'Poloni',26),(474,'Pompéia',26),(475,'Pongaí',26),(476,'Pontal',26),(477,'Pontalinda',26),(478,'Pontes Gestal',26),(479,'Populina',26),(480,'Porangaba',26),(481,'Porto Feliz',26),(482,'Porto Ferreira',26),(483,'Potim',26),(484,'Potirendaba',26),(485,'Pracinha',26),(486,'Pradópolis',26),(487,'Praia Grande',26),(488,'Pratânia',26),(489,'Presidente Alves',26),(490,'Presidente Bernardes',26),(491,'Presidente Epitácio',26),(492,'Presidente Prudente',26),(493,'Presidente Venceslau',26),(494,'Promissão',26),(495,'Quadra',26),(496,'Quatá',26),(497,'Queiroz',26),(498,'Queluz',26),(499,'Quintana',26),(500,'Rafard',26),(501,'Rancharia',26),(502,'Redenção da Serra',26),(503,'Regente Feijó',26),(504,'Reginópolis',26),(505,'Registro',26),(506,'Restinga',26),(507,'Ribeira',26),(508,'Ribeirão Bonito',26),(509,'Ribeirão Branco',26),(510,'Ribeirão Corrente',26),(511,'Ribeirão do Sul',26),(512,'Ribeirão dos Índios',26),(513,'Ribeirão Grande',26),(514,'Ribeirão Pires',26),(515,'Ribeirão Preto',26),(516,'Rifaina',26),(517,'Rincão',26),(518,'Rinópolis',26),(519,'Rio Claro',26),(520,'Rio das Pedras',26),(521,'Rio Grande da Serra',26),(522,'Riolândia',26),(523,'Riversul',26),(524,'Rosana',26),(525,'Roseira',26),(526,'Rubiácea',26),(527,'Rubinéia',26),(528,'Sabino',26),(529,'Sagres',26),(530,'Sales',26),(531,'Sales Oliveira',26),(532,'Salesópolis',26),(533,'Salmourão',26),(534,'Saltinho',26),(535,'Salto',26),(536,'Salto de Pirapora',26),(537,'Salto Grande',26),(538,'Sandovalina',26),(539,'Santa Adélia',26),(540,'Santa Albertina',26),(541,'Santa Bárbara d\'Oeste',26),(542,'Santa Branca',26),(543,'Santa Clara d\'Oeste',26),(544,'Santa Cruz da Conceição',26),(545,'Santa Cruz da Esperança',26),(546,'Santa Cruz das Palmeiras',26),(547,'Santa Cruz do Rio Pardo',26),(548,'Santa Ernestina',26),(549,'Santa Fé do Sul',26),(550,'Santa Gertrudes',26),(551,'Santa Isabel',26),(552,'Santa Lúcia',26),(553,'Santa Maria da Serra',26),(554,'Santa Mercedes',26),(555,'Santa Rita do Passa Quatro',26),(556,'Santa Rita d\'Oeste',26),(557,'Santa Rosa de Viterbo',26),(558,'Santa Salete',26),(559,'Santana da Ponte Pensa',26),(560,'Santana de Parnaíba',26),(561,'Santo Anastácio',26),(562,'Santo André',26),(563,'Santo Antônio da Alegria',26),(564,'Santo Antônio de Posse',26),(565,'Santo Antônio do Aracanguá',26),(566,'Santo Antônio do Jardim',26),(567,'Santo Antônio do Pinhal',26),(568,'Santo Expedito',26),(569,'Santópolis do Aguapeí',26),(570,'Santos',26),(571,'São Bento do Sapucaí',26),(572,'São Bernardo do Campo',26),(573,'São Caetano do Sul',26),(574,'São Carlos',26),(575,'São Francisco',26),(576,'São João da Boa Vista',26),(577,'São João das Duas Pontes',26),(578,'São João de Iracema',26),(579,'São João do Pau d\'Alho',26),(580,'São Joaquim da Barra',26),(581,'São José da Bela Vista',26),(582,'São José do Barreiro',26),(583,'São José do Rio Pardo',26),(584,'São José do Rio Preto',26),(585,'São José dos Campos',26),(586,'São Lourenço da Serra',26),(587,'São Luís do Paraitinga',26),(588,'São Manuel',26),(589,'São Miguel Arcanjo',26),(591,'São Pedro',26),(592,'São Pedro do Turvo',26),(593,'São Roque',26),(594,'São Sebastião',26),(595,'São Sebastião da Grama',26),(596,'São Simão',26),(597,'São Vicente',26),(598,'Sarapuí',26),(599,'Sarutaiá',26),(600,'Sebastianópolis do Sul',26),(601,'Serra Azul',26),(602,'Serra Negra',26),(603,'Serrana',26),(604,'Sertãozinho',26),(605,'Sete Barras',26),(606,'Severínia',26),(607,'Silveiras',26),(608,'Socorro',26),(609,'Sorocaba',26),(610,'Sud Mennucci',26),(611,'Sumaré',26),(612,'Suzanápolis',26),(613,'Suzano',26),(614,'Tabapuã',26),(615,'Tabatinga',26),(616,'Taboão da Serra',26),(617,'Taciba',26),(618,'Taguaí',26),(619,'Taiaçu',26),(620,'Taiúva',26),(621,'Tambaú',26),(622,'Tanabi',26),(623,'Tapiraí',26),(624,'Tapiratiba',26),(625,'Taquaral',26),(626,'Taquaritinga',26),(627,'Taquarituba',26),(628,'Taquarivaí',26),(629,'Tarabai',26),(630,'Tarumã',26),(631,'Tatuí',26),(632,'Taubaté',26),(633,'Tejupá',26),(634,'Teodoro Sampaio',26),(635,'Terra Roxa',26),(636,'Tietê',26),(637,'Timburi',26),(638,'Torre de Pedra',26),(639,'Torrinha',26),(640,'Trabiju',26),(641,'Tremembé',26),(642,'Três Fronteiras',26),(643,'Tuiuti',26),(644,'Tupã',26),(645,'Tupi Paulista',26),(646,'Turiúba',26),(647,'Turmalina',26),(648,'Ubarana',26),(649,'Ubatuba',26),(650,'Ubirajara',26),(651,'Uchoa',26),(652,'União Paulista',26),(653,'Urânia',26),(654,'Uru',26),(655,'Urupês',26),(656,'Valentim Gentil',26),(657,'Valinhos',26),(658,'Valparaíso',26),(659,'Vargem',26),(660,'Vargem Grande do Sul',26),(661,'Vargem Grande Paulista',26),(662,'Várzea Paulista',26),(663,'Vera Cruz',26),(664,'Vinhedo',26),(665,'Viradouro',26),(666,'Vista Alegre do Alto',26),(667,'Vitória Brasil',26),(668,'Votorantim',26),(669,'Votuporanga',26),(670,'Zacarias',26),(671,'Campo Grande',19);
-/*!40000 ALTER TABLE `cp_localidade` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_marca`
---
-
-DROP TABLE IF EXISTS `cp_marca`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_marca` (
-  `ID_MARCA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DT_INI_MARCA` datetime DEFAULT NULL,
-  `DT_FIM_MARCA` datetime DEFAULT NULL,
-  `ID_MARCADOR` INT UNSIGNED DEFAULT NULL,
-  `ID_PESSOA_INI` INT UNSIGNED DEFAULT NULL,
-  `ID_LOTACAO_INI` INT UNSIGNED DEFAULT NULL,
-  `ID_MOBIL` INT UNSIGNED DEFAULT NULL,
-  `ID_TP_MARCA` INT UNSIGNED DEFAULT NULL,
-  `ID_REF` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_MARCA`),
-  KEY `LOTACAO` (`ID_LOTACAO_INI`),
-  KEY `PESSOA` (`ID_PESSOA_INI`),
-  KEY `CP_MARCA_IDX_004` (`ID_REF`),
-  KEY `ID_MARCADOR` (`ID_MARCADOR`),
-  KEY `ID_TP_MARCA` (`ID_TP_MARCA`),
-  KEY `ID_MOBIL` (`ID_MOBIL`),
-  CONSTRAINT `cp_marca_ibfk_1` FOREIGN KEY (`ID_MARCADOR`) REFERENCES `cp_marcador` (`ID_MARCADOR`),
-  CONSTRAINT `cp_marca_ibfk_2` FOREIGN KEY (`ID_PESSOA_INI`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
-  CONSTRAINT `cp_marca_ibfk_3` FOREIGN KEY (`ID_LOTACAO_INI`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
-  CONSTRAINT `cp_marca_ibfk_4` FOREIGN KEY (`ID_TP_MARCA`) REFERENCES `cp_tipo_marca` (`ID_TP_MARCA`),
-  CONSTRAINT `cp_marca_ibfk_5` FOREIGN KEY (`ID_MOBIL`) REFERENCES `siga`.`ex_mobil` (`ID_MOBIL`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_marca`
---
-
-LOCK TABLES `cp_marca` WRITE;
-/*!40000 ALTER TABLE `cp_marca` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_marca` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_marcador`
---
-
-DROP TABLE IF EXISTS `cp_marcador`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_marcador` (
-  `ID_MARCADOR` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_MARCADOR` varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_TP_MARCADOR` INT UNSIGNED DEFAULT NULL,
-  `ORD_MARCADOR` int(11) DEFAULT NULL,
-  PRIMARY KEY (`ID_MARCADOR`),
-  KEY `ID_TP_MARCADOR` (`ID_TP_MARCADOR`),
-  CONSTRAINT `cp_marcador_ibfk_1` FOREIGN KEY (`ID_TP_MARCADOR`) REFERENCES `cp_tipo_marcador` (`ID_TP_MARCADOR`)
-) ENGINE=InnoDB AUTO_INCREMENT=1003 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_marcador`
---
-
-LOCK TABLES `cp_marcador` WRITE;
-/*!40000 ALTER TABLE `cp_marcador` DISABLE KEYS */;
-INSERT INTO `cp_marcador` VALUES (1,'Em Elaboração',1,10),(2,'Aguardando Andamento',1,140),(3,'A Receber (Físico)',1,90),(4,'Extraviado',1,NULL),(5,'A Arquivar',1,NULL),(6,'Arquivo Corrente',1,200),(7,'A Eliminar',1,230),(8,'Eliminado',1,NULL),(9,'Juntado',1,NULL),(10,'Cancelado',1,NULL),(11,'Transferido para Órgão Externo',1,NULL),(12,'Arquivo Intermediário',1,NULL),(13,'Arquivo Permanente',1,NULL),(14,'Caixa de Entrada (Digital)',1,80),(15,'Pendente de Assinatura',1,40),(16,'Juntado a Documento Externo',1,NULL),(18,'Remetido para Publicação',1,NULL),(20,'Publicado',1,NULL),(21,'Publicação solicitada',1,NULL),(22,'Disponibilizado',1,NULL),(23,'Transferido',1,170),(24,'Transferido (Digital)',1,180),(25,'Como Subscritor',1,30),(26,'Apensado',1,NULL),(27,'Como Gestor',1,150),(28,'Como Interessado',1,160),(29,'Despacho Pendente de Assinatura',1,70),(30,'Anexo Pendente Assinatura/Conferência',1,60),(31,'Sobrestado',1,190),(32,'Sem Efeito',1,NULL),(36,'Ativo',1,NULL),(37,'Novo',1,NULL),(38,'Popular',1,NULL),(39,'Revisar',1,NULL),(40,'Tomar Ciência',1,NULL),(41,'A Receber',1,NULL),(42,'Em Andamento',1,NULL),(43,'Fechado',1,NULL),(44,'Pendente',1,NULL),(45,'Cancelado',1,NULL),(46,'Em Pré-atendimento',1,NULL),(47,'Em Pós-atendimento',1,NULL),(48,'Como cadastrante',1,NULL),(49,'Como solicitante',1,NULL),(50,'A Recolher para Arq. Permanente',1,220),(51,'A Transferir para Arq. Intermediário',1,210),(52,'Em Edital de Eliminação',1,240),(53,'A Fechar',1,NULL),(54,'Em Controle de Qualidade',1,NULL),(55,'Agendado',1,NULL),(56,'A devolver',1,100),(57,'Aguardando devolução',1,120),(58,'A devolver (Fora do prazo)',1,110),(59,'Aguardando devolução (Fora do prazo)',1,130),(60,'Pendente de Anexação',1,NULL),(61,'Em Elabora?',1,NULL),(62,'Documento Assinado com Senha',1,NULL),(63,'Movimentação Assinada com Senha',1,NULL),(64,'Movimentação Conferida com Senha',1,NULL),(65,'Fora do Prazo',1,NULL),(66,'Ativo',1,NULL),(67,'Elaborar Parte de Documento Colaborativo',1,5),(68,'Finalizar Documento Colaborativo',1,6),(69,'Necessita Providência',1,NULL),(70,'Como Executor',1,NULL),(71,'Pronto para Assinar',2,25),(72,'Como Revisor',2,25),(300,'A Receber',1,NULL),(301,'Em Andamento',1,NULL),(302,'Fechado',1,NULL),(303,'Pendente',1,NULL),(304,'Cancelado',1,NULL),(305,'Em Pré-atendimento',1,NULL),(306,'Em Pós-atendimento',1,NULL),(307,'Como cadastrante',1,NULL),(308,'Como solicitante',1,NULL),(1000,'Urgente',2,NULL),(1001,'Idoso',2,NULL),(1002,'Retenção de INSS',2,NULL);
-/*!40000 ALTER TABLE `cp_marcador` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_arquivo`
---
-
-DROP TABLE IF EXISTS `cp_arquivo`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_arquivo` (
-  `ID_ARQ` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
-  `CONTEUDO_TP_ARQ` VARCHAR(256),
-  PRIMARY KEY (`ID_ARQ`),
-  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
-  CONSTRAINT `cp_arq_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_arquivo`
---
-
-LOCK TABLES `cp_arquivo` WRITE;
-/*!40000 ALTER TABLE `cp_arquivo` DISABLE KEYS */;
-INSERT INTO `cp_arquivo` VALUES (1,null,'template/freemarker'),(2,null,'template/freemarker'),(3,null,'template/freemarker'),(4,NULL,'template/freemarker'),(5,NULL,'template/freemarker'),(519,NULL,'template/freemarker'),(7,NULL,'template/freemarker'),(8,NULL,'template/freemarker'),(9,NULL,'template/freemarker'),(10,NULL,'template/freemarker');
-/*!40000 ALTER TABLE `cp_arquivo` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_arquivo_blob`
---
-
-DROP TABLE IF EXISTS `cp_arquivo_blob`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_arquivo_blob` (
-  `ID_ARQ_BLOB` BIGINT UNSIGNED NOT NULL,
-  `CONTEUDO_ARQ_BLOB` BLOB DEFAULT NULL,
-  PRIMARY KEY (`ID_ARQ_BLOB`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_arquivo_blob`
---
-
-LOCK TABLES `cp_arquivo_blob` WRITE;
-/*!40000 ALTER TABLE `cp_arquivo_blob` DISABLE KEYS */;
-INSERT INTO `cp_arquivo_blob` VALUES (1,' \n[@oficio/]\n'),(2,'\n[@entrevista]\n	[@grupo titulo=\"Texto a ser inserido no corpo do memorando\"]\n		[@grupo]\n			[@editor titulo=\"\" var=\"texto_memorando\" /]\n		[/@grupo]\n	[/@grupo]\n	[@grupo]\n	        [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n	[/@grupo]\n	[@grupo]\n       		[@selecao titulo=\"Fecho\" var=\"fecho\" opcoes=\"Atenciosamente;Cordialmente;Respeitosamente\" /]\n	[/@grupo]\n[/@entrevista]\n\n[@documento]\n        [@memorando texto=texto_memorando! fecho=(fecho!)+\",\" tamanhoLetra=tamanhoLetra! /]\n[/@documento]\n'),(3,'\n[@entrevista]\n    [@grupo titulo=\"Dados do Documento de Origem\"]\n        [@grupo]\n            [@texto titulo=\"Tipo de documento\" var=\"tipoDeDocumentoOrigem\" largura=20 default=tipoDeDocumentoValue /]\n            [@texto titulo=\"Número\" var=\"numeroOrigem\" largura=20 default=numeroValue /]\n        [/@grupo]\n        [@grupo]\n            [@data titulo=\"Data\" var=\"dataOrigem\" default=dataValue /]\n            [@texto titulo=\"Nome do Órgão\" var=\"orgaoOrigem\" largura=30 default=orgaoValue /]\n        [/@grupo]\n    [/@grupo]\n    [@grupo]\n        [@texto titulo=\"Vocativo\" var=\"vocativo\" largura=\"100\" /]\n    [/@grupo]\n    [@grupo titulo=\"Texto da informação\"]\n        [@editor titulo=\"\" var=\"texto_informacao\" /]\n    [/@grupo]\n    [@grupo]\n        [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n    [/@grupo]\n[/@entrevista]\n\n[@documento margemDireita=\"3cm\"]\n    [#if tamanhoLetra! == \"Normal\"]\n        [#assign tl = \"11pt\" /]\n    [#elseif tamanhoLetra! == \"Pequeno\"]\n        [#assign tl = \"9pt\" /]\n    [#elseif tamanhoLetra! == \"Grande\"]\n        [#assign tl = \"13pt\" /]\n    [#else]     \n        [#assign tl = \"11pt\"]\n    [/#if]\n\n    [@estiloBrasaoCentralizado tipo=\"INFORMAÇÃO\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n        <div style=\"font-family: Arial; font-size: ${tl};\">\n            [#if tipoDeDocumentoOrigem?? && tipoDeDocumentoOrigem != \"\"]\n                Referência: ${tipoDeDocumentoOrigem!} N&ordm; ${numeroOrigem!}, ${dataOrigem!} - ${orgaoOrigem!}.<br/>\n            [/#if]\n            Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${vocativo!}</span></p>\n                <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${texto_informacao}</span></p>\n        </div>\n    [/@estiloBrasaoCentralizado]\n[/@documento]\n'),(4,'\n[#-- Se existir uma variável chamada \'texto\' copiar seu valor para \'texto_depacho\', pois a macro vai destruir o conteúdo da variável --]\n[@entrevista]\n  [@grupo titulo=\"Órgão de destino\"]\n    [#assign orgao_dest_atual = (doc.lotaDestinatario.nomeLotacao)!/]\n    [#if orgao_dest_ult! != orgao_dest_atual]\n      [#assign orgao_dest = orgao_dest_atual/]\n      [#assign orgao_dest_ult = orgao_dest_atual/]\n    [/#if]\n    [@oculto var=\"orgao_dest_ult\"/]\n    [@grupo]\n      [@selecao titulo=\"\" var=\"combinacao\" opcoes=\"A(o);À;Ao\" /]\n      [@texto titulo=\"Nome (opcional)\" var=\"orgao_dest\" largura=30 /]\n    [/@grupo]\n  [/@grupo]\n  [@grupo titulo=\"Texto do despacho\"]\n    [@grupo]\n      [#if !texto_padrao??]\n        [#assign texto_padrao = \"Para as providências cabíveis.\"/]\n      [/#if]\n      [@selecao titulo=\"Texto\" opcoes=\"A pedido.;Arquive-se.;Autorizo.;Ciente. Arquive-se.;De acordo.;Expeça-se memorando.;Expeça-se memorando-circular.;Expeça-se ofício-circular.;Intime-se.;Junte-se ao dossiê.;Junte-se ao processo.;Oficie-se.;Para as providências cabíveis.;Para atendimento.;Para atendimento e encaminhamento direto.;Para ciência.;Para publicação.;Para verificar a possibilidade de atendimento.;[Outro]\" var=\"texto_padrao\" reler=true /]\n    [/@grupo]\n  [/@grupo]\n  [@grupo depende=\"textopadrao\" esconder=((texto_padrao!\"\") != \"[Outro]\")]\n    [@editor titulo=\"\" var=\"texto_despacho\" /]\n  [/@grupo]\n  [@grupo]\n    [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n  [/@grupo]\n  [@grupo titulo=\"Dados do Documento de Origem\" esconder=doc.pai??]\n    [#if postback?? && !doc.idDoc?? && doc.pai??]\n      [#assign tipoDeDocumentoValue = doc.pai.descrFormaDoc /]\n      [#assign numeroValue = doc.pai.sigla /]\n      [#assign dataValue = doc.pai.dtDocDDMMYY /]\n      [#assign orgaoValue = doc.pai.orgaoUsuario.acronimoOrgaoUsu /]\n    [#else]\n      [#assign tipoDeDocumentoValue = tipoDeDocumentoOrigem! /]\n      [#assign numeroValue = numeroOrigem! /]\n      [#assign dataValue = dataOrigem! /]\n      [#assign orgaoValue = orgaoOrigem! /]\n    [/#if]\n    [@grupo]\n      [@texto titulo=\"Tipo de documento\" var=\"tipoDeDocumentoOrigem\" largura=20 default=tipoDeDocumentoValue /]\n      [@texto titulo=\"Número\" var=\"numeroOrigem\" largura=20 default=numeroValue /]\n    [/@grupo]\n    [@grupo]\n      [@data titulo=\"Data\" var=\"dataOrigem\" default=dataValue /]\n      [@texto titulo=\"Nome do Órgão\" var=\"orgaoOrigem\" largura=30 default=orgaoValue /]\n    [/@grupo]\n  [/@grupo]\n[/@entrevista]\n[@documento margemDireita=\"3cm\"]\n  [#if param.tamanhoLetra! == \"Normal\"]\n    [#assign tl = \"11pt\" /]\n  [#elseif param.tamanhoLetra! == \"Pequeno\"]\n    [#assign tl = \"9pt\" /]\n  [#elseif param.tamanhoLetra! == \"Grande\"]\n    [#assign tl = \"13pt\" /]\n  [#else]\n    [#assign tl = \"11pt\"/]\n  [/#if]\n  [@estiloBrasaoCentralizado tipo=\"DESPACHO\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n    <div style=\"font-family: Arial; font-size: ${tl};\">\n      [#if tipoDeDocumentoOrigem?? && tipoDeDocumentoOrigem != \"\"]\n        Referência: ${tipoDeDocumentoOrigem!} Nº ${numeroOrigem!}\n        [#if dataOrigem?? && dataOrigem != \"\"]\n          , ${dataOrigem!}\n        [/#if]\n        [#if orgaoOrigem?? && orgaoOrigem != \"\"]\n          - ${orgaoOrigem!}.\n        [/#if]\n        <br />\n      [/#if]\n      Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n    </div>\n    <div style=\"font-family: Arial; font-size: ${tl};\">\n      [#if orgao_dest?? && orgao_dest != \"\"]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl}\">${combinacao} ${orgao_dest!},</span>\n        </p>\n      [#elseif (doc.lotaDestinatario.nomeLotacao)?? && (doc.lotaDestinatario.nomeLotacao) != \"\"]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl}\">${combinacao} ${(doc.lotaDestinatario.nomeLotacao)!},</span>\n        </p>\n      [/#if]\n      [#if (texto_padrao!\"\") != \"[Outro]\"]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl!}\">${texto_padrao!}</span>\n        </p>\n      [#else]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl!}\">${texto_despacho!}</span>\n        </p>\n      [/#if]\n    </div>\n  [/@estiloBrasaoCentralizado]\n[/@documento]\n'),(5,'ELABORE SEU MODELO DE BOLETIM INTERNO NO MENU FERRAMENTAS/CADASTRO DE MODELOS'),(6,'\n[@entrevista]\n    [@grupo titulo=\"Dados do Documento de Origem\"]\n        [@grupo]\n            [@texto titulo=\"Tipo de documento\" var=\"tipoDeDocumentoOrigem\" largura=20 default=tipoDeDocumentoValue /]\n            [@texto titulo=\"Número\" var=\"numeroOrigem\" largura=20 default=numeroValue /]\n        [/@grupo]\n        [@grupo]\n            [@data titulo=\"Data\" var=\"dataOrigem\" default=dataValue /]\n            [@texto titulo=\"Nome do Órgão\" var=\"orgaoOrigem\" largura=30 default=orgaoValue /]\n        [/@grupo]\n    [/@grupo]\n    [@grupo]\n        [@texto titulo=\"Vocativo\" var=\"vocativo\" largura=\"100\" /]\n    [/@grupo]\n    [@grupo titulo=\"Texto do Parecer\"]\n        [@editor titulo=\"\" var=\"texto_parecer\" /]\n    [/@grupo]\n    [@grupo]\n        [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n    [/@grupo]\n[/@entrevista]\n\n[@documento margemDireita=\"3cm\"]\n    [#if param.tamanhoLetra! == \"Normal\"]\n        [#assign tl = \"11pt\" /]\n    [#elseif param.tamanhoLetra! == \"Pequeno\"]\n        [#assign tl = \"9pt\" /]\n    [#elseif param.tamanhoLetra! == \"Grande\"]\n        [#assign tl = \"13pt\" /]\n    [#else]     \n        [#assign tl = \"11pt\"]\n    [/#if]\n\n    [@estiloBrasaoCentralizado tipo=\"PARECER\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n        [#if tipoDeDocumentoOrigem?? && tipoDeDocumentoOrigem != \"\"]\n            Referência: ${tipoDeDocumentoOrigem!} N&ordm; ${numeroOrigem!}, ${dataOrigem!} - ${orgaoOrigem!}.<br/>\n        [/#if]\n        Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n\n        <div style=\"font-family: Arial; font-size: 10pt;\">\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${vocativo!}</span></p>\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${texto_parecer}</span></p>\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">É o Parecer.</span></p>\n        </div>\n    [/@estiloBrasaoCentralizado]\n[/@documento]\n\n'),(7,' Certidão de desentranhamento'),(8,'\n[@entrevista]\n [@grupo titulo=\"Informações Gerais\"]\n  [@grupo]\n   [@texto titulo=\"Objetivo da reunião\" var=\"objReuniao\" largura=\"84\" maxcaracteres=\"84\"/]\n  [/@grupo]\n  [@texto titulo=\"Horário\" var=\"horReuniao\" obrigatorio=\"Sim\" largura=\"4\" maxcaracteres=\"5\"/]\n  [@texto titulo=\"Local\" var=\"locReuniao\" obrigatorio=\"Sim\" largura=\"60\" maxcaracteres=\"60\"/]\n[#--\n  [@grupo]\n   [@memo titulo=\"Pendências (reuniões anteriores)\" var=\"pendencias\" colunas=\"78\" linhas=\"2\"/]\n  [/@grupo]\n--]\n  [@separador /]\n  [@selecao titulo=\"Participantes\" var=\"numParticipantes\" reler=true idAjax=\"numParticipantesAjax\" opcoes=\"0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n  [@grupo depende=\"numParticipantesAjax\"]\n   [#if numParticipantes! != \'0\']\n    [#list 1..(numParticipantes)?number as i]\n     [@grupo]\n      [@pessoa titulo=\"\" var=\"participantes\"+i/]\n     [/@grupo]\n    [/#list]\n   [/#if]\n  [/@grupo]\n  [@separador /]\n  [@grupo]\n   [@selecao titulo=\"Participantes (extra)\" var=\"numParticipantesExtra\" reler=true idAjax=\"numPartExtraAjax\" opcoes=\"0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n  [/@grupo]\n  [@grupo depende=\"numPartExtraAjax\"]\n   [#if numParticipantesExtra! != \'0\']\n    [#list 1..(numParticipantesExtra)?number as i]\n     [@grupo]\n      [@texto titulo=\"Nome\" var=\"participantesExtra\"+i largura=\"50\" maxcaracteres=\"101\"/]\n      [@texto titulo=\"Email\" var=\"participantesExtraEmail\"+i largura=\"51\" maxcaracteres=\"101\"/]\n     [/@grupo]\n     [@grupo]\n      [@texto titulo=\"Função\" var=\"participantesExtraFuncao\"+i largura=\"50\" maxcaracteres=\"101\"/]\n      [@texto titulo=\"Unidade\" var=\"participantesExtraUnidade\"+i largura=\"51\" maxcaracteres=\"101\"/]\n     [/@grupo]\n    [/#list]\n   [/#if]\n  [/@grupo]\n [/@grupo]\n [@separador /]\n [@grupo]\n  [@selecao titulo=\"Quantidade de itens da pauta\" var=\"qtdItePauta\" reler=true idAjax=\"qtdItePautaAjax\" opcoes=\"1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n [/@grupo]\n [@grupo depende=\"qtdItePautaAjax\"]\n  [#list 1..(qtdItePauta)?number as i]\n   [@grupo]\n    [@texto titulo=\"<b>Item ${i}</b>\" var=\"itePauta\"+i largura=\"96\" maxcaracteres=\"101\"/]\n   [/@grupo]\n   [@memo titulo=\"Comentários\" var=\"comentario\"+i colunas=\"78\" linhas=\"2\"/]\n   [@grupo]\n    [@selecao titulo=\"Quantidade de ações\" var=\"qtdAcoes\"+i reler=true idAjax=\"qtdAcoesAjax\"+i opcoes=\"0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n   [/@grupo]\n   [@grupo depende=\"qtdAcoesAjax\"+i]\n    [#if (.vars[\'qtdAcoes\'+i])! != \'0\']\n     [#list 1..(.vars[\'qtdAcoes\'+i])?number as j]\n      [@grupo]      \n       [@texto titulo=\"Ação ${j}\" var=\"acoes\"+i+j largura=\"95\" maxcaracteres=\"75\"/]\n      [/@grupo]\n      [@grupo]\n       [@texto titulo=\"Responsável\" var=\"responsavel\"+i+j largura=\"61\" maxcaracteres=\"55\"/]\n       [@data titulo=\"Data prevista\" var=\"datPrevista\"+i+j/] \n      [/@grupo]\n     [/#list]\n    [/#if]\n   [/@grupo]\n   [@separador /]  \n  [/#list] \n [/@grupo]\n[/@entrevista]\n\n[@documento]\n [#if tamanhoLetra! == \"Normal\"]\n		[#assign tl = \"11pt\" /]\n [#elseif tamanhoLetra! == \"Pequeno\"]\n		[#assign tl = \"9pt\" /]\n [#elseif tamanhoLetra! == \"Grande\"]\n		[#assign tl = \"13pt\" /]\n [#else]		\n		[#assign tl = \"11pt\"]\n [/#if]\n [@estiloBrasaoCentralizado tipo=\"MEMÓRIA DE REUNIÃO\" tamanhoLetra=tl formatarOrgao=true]\n   <p align=\"left\">\n    <b>Objetivo da reunião:</b>&nbsp;${objReuniao!}<br/>\n    Horário e local: ${horReuniao!} - ${locReuniao!}<br/>\n     Assunto: ${(doc.exClassificacao.descrClassificacao)!}</p><br/>\n[#--\n   [#if pendencias! != \"\"]\n    <p><b>Pendências (reuniões anteriores):</b>&nbsp;${pendencias!}</p><br/>\n   [/#if]\n--]\n   <table width=\"100%\" border=\"1\" cellpadding=\"5\">\n    <tr>\n     <td width=\"50%\"><b>Participantes</b></td>\n     <td width=\"25%\"><b>Função</b></td>\n     <td width=\"25%\"><b>Unidade</b></td>\n    </tr>\n    [#list 1..(numParticipantes)?number as i]\n     [#if .vars[\'participantes\' + i + \'_pessoaSel.id\']?? && .vars[\'participantes\' + i + \'_pessoaSel.id\'] != \"\"]\n      [#assign participante = func.pessoa(.vars[\'participantes\' + i + \'_pessoaSel.id\']?number) /]\n      <tr>\n       <td>${func.maiusculasEMinusculas(participante.descricao)}</td>\n       <td>${(participante.funcaoConfianca.descricao)!}</td>\n       <td>${participante.lotacao.sigla}</td>\n      </tr>\n     [/#if]\n    [/#list]\n\n    [#list 1..(numParticipantesExtra)?number as i] \n     [#if numParticipantesExtra! != \'0\']\n      <tr>\n       <td>${.vars[\'participantesExtra\'+i]!}\n        [#if .vars[\'participantesExtraEmail\'+i]??] (${.vars[\'participantesExtraEmail\'+i]!})[/#if]</td>\n       <td>${.vars[\'participantesExtraFuncao\'+i]!}</td>\n       <td>${.vars[\'participantesExtraUnidade\'+i]!}</td>\n      </tr>\n     [/#if]    \n    [/#list]\n   </table> \n   <br/>\n\n\n  \n   <p><b>Pauta</b></p>\n     [#list 1..(qtdItePauta)?number as i] \n        <p>\n          <b>${i}. ${.vars[\'itePauta\'+i]!}:</b> ${.vars[\'comentario\'+i]!}\n        </p>       \n     [/#list]  \n\n\n  <br/> \n\n  [#assign fAcoes = false/]\n  [#list 1..(qtdItePauta)?number as i]\n   [#if .vars[\'qtdAcoes\'+i] != \'0\']\n    [#assign fAcoes = true/]\n   [/#if] \n  [/#list]\n\n  [#if fAcoes]\n   <table width=\"100%\" border=\"1\" cellpadding=\"5\">\n     <tr>\n      <td width=\"10%\"><b>Ref.</b></td>\n      <td width=\"50%\"><b>Próximas Ações</b></td>\n      <td width=\"20%\"><b>Responsável</b></td>\n      <td width=\"20%\" align=\"center\"><b>Data Prevista</b></td>\n     </tr>\n     [#list 1..(qtdItePauta)?number as i]\n      [#if .vars[\'qtdAcoes\'+i] != \'0\']\n       [#list 1..(.vars[\'qtdAcoes\'+i])?number as j]\n        <tr>\n         <td>${i}.${j}</td>\n         <td>${.vars[\'acoes\'+i+j]!}</td>\n         <td>${.vars[\'responsavel\'+i+j]!}</td>\n         <td align=\"center\">${.vars[\'datPrevista\'+i+j]!}</td>\n        </tr>\n       [/#list]\n      [/#if]\n     [/#list]\n   </table>   \n  [/#if]\n [/@estiloBrasaoCentralizado]\n[/@documento]\n\n'),(9,'\n[@documento margemDireita=\"3cm\"]\n    [#assign tl=\"11pt\"/]\n    [@estiloBrasaoCentralizado tipo=\"DESPACHO\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n        <div style=\"font-family: Arial; font-size: ${tl};\">\n          Referência: ${doc.codigo} de ${doc.dtD} de ${doc.dtMMMM} de ${doc.dtYYYY}[#if doc.lotaTitular??] - ${(doc.lotaTitular.descricao)!}[/#if].<br/>\n            Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n        </div>\n\n        <div style=\"font-family: Arial; font-size: ${tl};\">\n            [#if mov.lotaResp?? && (mov.lotaResp.idLotacaoIni != mov.lotaCadastrante.idLotacaoIni)]\n                <p style=\"TEXT-INDENT: 0cm\">\n                  <span style=\"font-size: ${tl}\">À ${(mov.lotaResp.descricao)!},</span>\n                </p>\n            [/#if]\n            [#if despachoTexto??]\n                <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${despachoTexto}</span></p>\n            [/#if]\n            ${despachoHtml!}\n        </div>\n    [/@estiloBrasaoCentralizado]\n[/@documento]\n\n'),(10,' ');
-/*!40000 ALTER TABLE `cp_arquivo_blob` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_modelo`
---
-
-DROP TABLE IF EXISTS `cp_modelo`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_modelo` (
-  `ID_MODELO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
-  `ID_ARQ` BIGINT UNSIGNED DEFAULT NULL,
-  `CONTEUDO_BLOB_MOD` blob,
-  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_DT_INI` datetime NOT NULL,
-  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_DT_FIM` datetime DEFAULT NULL,
-  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
-  `HIS_ATIVO` tinyint(4) NOT NULL,
-  PRIMARY KEY (`ID_MODELO`),
-  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
-  KEY `HIS_IDC_INI` (`HIS_IDC_INI`),
-  KEY `HIS_IDC_FIM` (`HIS_IDC_FIM`),
-  KEY `HIS_ID_INI` (`HIS_ID_INI`),
-  KEY `ID_ARQ` (`ID_ARQ`),
-  CONSTRAINT `cp_modelo_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `cp_modelo_ibfk_2` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `cp_modelo_ibfk_3` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
-  CONSTRAINT `cp_modelo_ibfk_4` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_modelo` (`ID_MODELO`),
-  CONSTRAINT `cp_modelo_ibfk_5` FOREIGN KEY (`ID_ARQ`) REFERENCES `cp_arquivo` (`ID_ARQ`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_modelo`
---
-
-LOCK TABLES `cp_modelo` WRITE;
-/*!40000 ALTER TABLE `cp_modelo` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_modelo` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_ocorrencia_feriado`
---
-
-DROP TABLE IF EXISTS `cp_ocorrencia_feriado`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_ocorrencia_feriado` (
-  `ID_OCORRENCIA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DT_INI_FERIADO` datetime DEFAULT NULL,
-  `DT_FIM_FERIADO` datetime DEFAULT NULL,
-  `ID_FERIADO` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_OCORRENCIA`),
-  KEY `ID_FERIADO` (`ID_FERIADO`),
-  CONSTRAINT `cp_ocorrencia_feriado_ibfk_1` FOREIGN KEY (`ID_FERIADO`) REFERENCES `cp_feriado` (`ID_FERIADO`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_ocorrencia_feriado`
---
-
-LOCK TABLES `cp_ocorrencia_feriado` WRITE;
-/*!40000 ALTER TABLE `cp_ocorrencia_feriado` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_ocorrencia_feriado` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_orgao`
---
-
-DROP TABLE IF EXISTS `cp_orgao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_orgao` (
-  `ID_ORGAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_ORGAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `CGC_ORGAO` INT UNSIGNED DEFAULT NULL,
-  `RAZAO_SOCIAL_ORGAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `END_ORGAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `BAIRRO_ORGAO` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `MUNICIPIO_ORGAO` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `CEP_ORGAO` varchar(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DSC_TIPO_ORGAO` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `NOME_RESPONSAVEL_ORGAO` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `EMAIL_RESPONSAVEL_ORGAO` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `NOME_CONTATO_ORGAO` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `EMAIL_CONTATO_ORGAO` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `TEL_CONTATO_ORGAO` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SIGLA_ORGAO` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `UF_ORGAO` varchar(2) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  `FG_ATIVO` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_IDE` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `HIS_DT_INI` datetime DEFAULT NULL,
-  `HIS_DT_FIM` datetime DEFAULT NULL,
-  `HIS_ATIVO` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_ORGAO`),
-  UNIQUE KEY `ORGAO_PK` (`ID_ORGAO`),
-  KEY `ORGAO_ORGAO_USU_FK` (`ID_ORGAO_USU`),
-  CONSTRAINT `ORGAO_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
-) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_orgao`
---
-
-LOCK TABLES `cp_orgao` WRITE;
-/*!40000 ALTER TABLE `cp_orgao` DISABLE KEYS */;
-INSERT INTO `cp_orgao` VALUES (1,'PRESIDENCIA DA REPUBLICA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'Pres. Rep.',NULL,999999999,'S',1,'1','2011-08-03 00:00:00',NULL,1);
-/*!40000 ALTER TABLE `cp_orgao` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_orgao_usuario`
---
-
-DROP TABLE IF EXISTS `cp_orgao_usuario`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_orgao_usuario` (
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_ORGAO_USU` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `CGC_ORGAO_USU` bigint(20) DEFAULT NULL,
-  `RAZAO_SOCIAL_ORGAO_USU` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `END_ORGAO_USU` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `BAIRRO_ORGAO_USU` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `MUNICIPIO_ORGAO_USU` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `CEP_ORGAO_USU` varchar(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `NM_RESP_ORGAO_USU` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `TEL_ORGAO_USU` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SIGLA_ORGAO_USU` varchar(15) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `UF_ORGAO_USU` varchar(2) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `COD_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
-  `ACRONIMO_ORGAO_USU` varchar(12) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_ORGAO_USU`),
-  UNIQUE KEY `ORGAO_USU_PK` (`ID_ORGAO_USU`)
-) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_orgao_usuario`
---
-
-LOCK TABLES `cp_orgao_usuario` WRITE;
-/*!40000 ALTER TABLE `cp_orgao_usuario` DISABLE KEYS */;
-INSERT INTO `cp_orgao_usuario` VALUES (999999999,'ORGAO TESTE ZZ',NULL,NULL,NULL,NULL,'Rio de Janeiro',NULL,NULL,NULL,'ZZ',NULL,NULL,'OTZZ');
-/*!40000 ALTER TABLE `cp_orgao_usuario` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_papel`
---
-
-DROP TABLE IF EXISTS `cp_papel`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_papel` (
-  `ID_PAPEL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_TP_PAPEL` INT UNSIGNED NOT NULL,
-  `ID_PESSOA` INT UNSIGNED NOT NULL,
-  `ID_LOTACAO` INT UNSIGNED NOT NULL,
-  `ID_FUNCAO_CONFIANCA` INT UNSIGNED DEFAULT NULL,
-  `ID_CARGO` INT UNSIGNED NOT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
-  `HIS_IDE` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `HIS_DT_INI` datetime NOT NULL,
-  `HIS_DT_FIM` datetime DEFAULT NULL,
-  `HIS_ATIVO` tinyint(4) NOT NULL,
-  PRIMARY KEY (`ID_PAPEL`),
-  UNIQUE KEY `CP_PAPEL_PK` (`ID_PAPEL`),
-  KEY `CP_PAPEL_CPORGUSU_IDORGUSU_FK` (`ID_ORGAO_USU`),
-  KEY `CP_PAPEL_CPTPPAP_ID_TPPAP_FK` (`ID_TP_PAPEL`),
-  KEY `CP_PAPEL_CP_PAPEL_ID_INI_FK` (`HIS_ID_INI`),
-  KEY `CP_PAPEL_DP_CARGO_ID_CARGO_FK` (`ID_CARGO`),
-  KEY `CP_PAPEL_DP_FC_ID_FC_FK` (`ID_FUNCAO_CONFIANCA`),
-  KEY `CP_PAPEL_DP_LOT_ID_LOT_FK` (`ID_LOTACAO`),
-  KEY `CP_PAPEL_DP_PESS_ID_PESS_FK` (`ID_PESSOA`),
-  CONSTRAINT `CP_PAPEL_CPORGUSU_IDORGUSU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `CP_PAPEL_CPTPPAP_ID_TPPAP_FK` FOREIGN KEY (`ID_TP_PAPEL`) REFERENCES `cp_tipo_papel` (`ID_TP_PAPEL`),
-  CONSTRAINT `CP_PAPEL_CP_PAPEL_ID_INI_FK` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_papel` (`ID_PAPEL`),
-  CONSTRAINT `CP_PAPEL_DP_CARGO_ID_CARGO_FK` FOREIGN KEY (`ID_CARGO`) REFERENCES `dp_cargo` (`ID_CARGO`),
-  CONSTRAINT `CP_PAPEL_DP_FC_ID_FC_FK` FOREIGN KEY (`ID_FUNCAO_CONFIANCA`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
-  CONSTRAINT `CP_PAPEL_DP_LOT_ID_LOT_FK` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
-  CONSTRAINT `CP_PAPEL_DP_PESS_ID_PESS_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_papel`
---
-
-LOCK TABLES `cp_papel` WRITE;
-/*!40000 ALTER TABLE `cp_papel` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_papel` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_personalizacao`
---
-
-DROP TABLE IF EXISTS `cp_personalizacao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_personalizacao` (
-  `ID_PESSOA` INT UNSIGNED NOT NULL,
-  `ID_PAPEL_ATIVO` INT UNSIGNED DEFAULT NULL,
-  `ID_SUBSTITUINDO_PESSOA` INT UNSIGNED DEFAULT NULL,
-  `ID_SUBSTITUINDO_LOTACAO` INT UNSIGNED DEFAULT NULL,
-  `ID_SUBSTITUINDO_PAPEL` INT UNSIGNED DEFAULT NULL,
-  `NM_SIMULANDO_USUARIO` varchar(15) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_PERSONALIZACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  PRIMARY KEY (`ID_PERSONALIZACAO`),
-  KEY `CP_PERSON_CP_PAP_ID_ATIVO_FK` (`ID_PAPEL_ATIVO`),
-  KEY `CP_PERSON_CP_PAP_ID_SUBST_FK` (`ID_SUBSTITUINDO_PAPEL`),
-  KEY `CP_PERSON_DP_LOT_ID_SUBST_FK` (`ID_SUBSTITUINDO_LOTACAO`),
-  KEY `CP_PERSON_DP_PESS_ID_PESS_FK` (`ID_PESSOA`),
-  KEY `CP_PERSON_DP_PESS_ID_SUBST_FK` (`ID_SUBSTITUINDO_PESSOA`),
-  CONSTRAINT `CP_PERSON_CP_PAP_ID_ATIVO_FK` FOREIGN KEY (`ID_PAPEL_ATIVO`) REFERENCES `cp_papel` (`ID_PAPEL`),
-  CONSTRAINT `CP_PERSON_CP_PAP_ID_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUINDO_PAPEL`) REFERENCES `cp_papel` (`ID_PAPEL`),
-  CONSTRAINT `CP_PERSON_DP_LOT_ID_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUINDO_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
-  CONSTRAINT `CP_PERSON_DP_PESS_ID_PESS_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
-  CONSTRAINT `CP_PERSON_DP_PESS_ID_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUINDO_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_personalizacao`
---
-
-LOCK TABLES `cp_personalizacao` WRITE;
-/*!40000 ALTER TABLE `cp_personalizacao` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_personalizacao` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_sede`
---
-
-DROP TABLE IF EXISTS `cp_sede`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_sede` (
-  `ID_SEDE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_SEDE` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `DSC_SEDE` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  PRIMARY KEY (`ID_SEDE`),
-  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
-  CONSTRAINT `cp_sede_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_sede`
---
-
-LOCK TABLES `cp_sede` WRITE;
-/*!40000 ALTER TABLE `cp_sede` DISABLE KEYS */;
-/*!40000 ALTER TABLE `cp_sede` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_servico`
---
-
-DROP TABLE IF EXISTS `cp_servico`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_servico` (
-  `ID_SERVICO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `SIGLA_SERVICO` varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `DESC_SERVICO` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `ID_SERVICO_PAI` INT UNSIGNED DEFAULT NULL,
-  `ID_TP_SERVICO` INT UNSIGNED NOT NULL,
-  `LABEL_SERVICO` varchar(35) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_SERVICO`),
-  UNIQUE KEY `CP_SERVICO_ID_SERVICO_PK` (`ID_SERVICO`),
-  UNIQUE KEY `SIGLA_SERVICO_IDX` (`SIGLA_SERVICO`),
-  KEY `CP_SERV_CPTPSERV_ID_TPSERV_FK` (`ID_TP_SERVICO`),
-  CONSTRAINT `CP_SERV_CPTPSERV_ID_TPSERV_FK` FOREIGN KEY (`ID_TP_SERVICO`) REFERENCES `cp_tipo_servico` (`ID_TP_SERVICO`)
-) ENGINE=InnoDB AUTO_INCREMENT=316 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_servico`
---
-
-LOCK TABLES `cp_servico` WRITE;
-/*!40000 ALTER TABLE `cp_servico` DISABLE KEYS */;
-INSERT INTO `cp_servico` VALUES (1,'SIGA','Sistema Integrado de Gestão Administrativa',NULL,2,NULL),(2,'SIGA-DOC','Módulo de Documentos',1,2,NULL),(3,'SIGA-WF','Módulo de Workflow',1,2,NULL),(4,'SIGA-SR','Módulo de Serviços',1,2,NULL),(5,'FS','Acesso aos Diretórios do Sistema de Arquivos',NULL,1,NULL),(9,'FS-PUB','Acesso ao Diretório Público',5,1,'(K) PÚBLICA'),(10,'FS-RAIZ','Acesso ao Diretório Raiz da Unidade',5,1,'(K) RAIZ'),(15,'SIGA-GI','Módulo de Gestão de Identidade',1,2,NULL),(16,'SIGA-WF-OPERAR','Executar comandos da tela inicial',3,2,NULL),(17,'SIGA-GI-PERMISSAO','Gerenciar permissões',15,2,NULL),(18,'SIGA-GI-ID','Gerenciar identidades',15,2,NULL),(19,'SIGA-GI-PERFIL','Gerenciar perfis de acesso',15,2,NULL),(20,'SIGA-GI-PERFILJEE','Gerenciar perfis do JEE',15,2,NULL),(21,'SIGA-GI-GDISTR','Gerenciar grupos de distribuição',15,2,NULL),(22,'SIGA-GI-SELFSERVICE','Gerenciar serviços da própria lotação',15,2,NULL),(23,'SIGA-GI-REL','Gerar relatórios',15,2,NULL),(24,'SIGA-WF-DESIGNAR','Designar tarefas',3,2,NULL),(41,'SIGA-WF-MEDIR','Analisar métricas',3,2,NULL),(42,'SIGA-WF-CONFIGURAR','Configurar iniciadores',3,2,NULL),(62,'SIGA-FE','Ferramentas',1,2,NULL),(63,'SIGA-FE-MODVER','Visualizar modelos',62,2,NULL),(64,'SIGA-FE-MODEDITAR','Editar modelos',62,2,NULL),(65,'SIGA-DOC-MOD','Gerenciar modelos',2,2,NULL),(284,'SIGA-DOC-REL','Gerar relatórios',2,2,NULL),(304,'SIGA-DOC-REL-FORMS','Relação de formulários',284,2,NULL),(305,'SIGA-DOC-REL-DATAS','Relação de documentos entre datas',284,2,NULL),(306,'SIGA-DOC-REL-SUBORD','Relatório de documentos em setores subordinados',284,2,NULL),(307,'SIGA-DOC-FE','Ferramentas',2,2,NULL),(308,'SIGA-DOC-FE-CFG','Configurações',307,2,NULL),(309,'SIGA-GC-EDTCLASS','Editar Classificação',NULL,2,NULL),(310,'SIGA-SR-ADM','Administrar',4,2,NULL),(311,'SIGA-SR-EDTCONH','Criar Conhecimentos',4,2,NULL),(312,'SIGA-SR-EMAILATEND','Receber Notificação Atendente',4,2,NULL),(313,'SIGA-SR-OPENSAVE','Salvar Solicitação Ao Abrir',4,2,NULL),(314,'SIGA-SR-OPENPRIOR','Priorizar ao Abrir',4,2,NULL),(315,'SIGA-SR-VER_GESTOR_I','Ver gestor do item de configuração ao abrir solicitação',4,2,NULL);
-/*!40000 ALTER TABLE `cp_servico` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_situacao_configuracao`
---
-
-DROP TABLE IF EXISTS `cp_situacao_configuracao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_situacao_configuracao` (
-  `ID_SIT_CONFIGURACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DSC_SIT_CONFIGURACAO` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `RESTRITIVIDADE_SIT_CONF` double NOT NULL,
-  PRIMARY KEY (`ID_SIT_CONFIGURACAO`),
-  UNIQUE KEY `CP_SIT_CONF_ID_SIT_CONF_PK` (`ID_SIT_CONFIGURACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_situacao_configuracao`
---
-
-LOCK TABLES `cp_situacao_configuracao` WRITE;
-/*!40000 ALTER TABLE `cp_situacao_configuracao` DISABLE KEYS */;
-INSERT INTO `cp_situacao_configuracao` VALUES (1,'Pode',0),(2,'Não Pode',9),(3,'Obrigatório',7),(4,'Opcional',4),(5,'Default',5),(6,'Não default',6),(7,'Proibido',10),(8,'Só Leitura',8),(9,'Ignorar configuração anterior',1);
-/*!40000 ALTER TABLE `cp_situacao_configuracao` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_configuracao`
---
-
-DROP TABLE IF EXISTS `cp_tipo_configuracao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_configuracao` (
-  `ID_TP_CONFIGURACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DSC_TP_CONFIGURACAO` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_SIT_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_CONFIGURACAO`),
-  UNIQUE KEY `CP_TP_CONF_ID_TP_CONF_PK` (`ID_TP_CONFIGURACAO`),
-  KEY `CP_TP_CONF_CP_SIT_CONF_ID_FK` (`ID_SIT_CONFIGURACAO`),
-  CONSTRAINT `CP_TP_CONF_CP_SIT_CONF_ID_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_situacao_configuracao` (`ID_SIT_CONFIGURACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=308 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_configuracao`
---
-
-LOCK TABLES `cp_tipo_configuracao` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_configuracao` DISABLE KEYS */;
-INSERT INTO `cp_tipo_configuracao` VALUES (1,'Movimentar',1),(2,'Criar',1),(3,'Finalizar',1),(4,'Eletrônico',7),(5,'Nivel de Acesso',4),(6,'Acessar',2),(7,'Diretor do Foro',NULL),(8,'Refazer',1),(9,'Duplicar',1),(10,'Editar',1),(11,'Excluir',1),(12,'Excluir Anexo',1),(13,'Configurar',2),(14,'Excluir Anotação',1),(15,'Visualizar Impressão',1),(16,'Cancelar Via',1),(17,'Criar Via',1),(18,'Nível de Acesso Máximo',4),(19,'Nível de Acesso Mínimo',4),(20,'Cadastrar Qualquer Subst',2),(21,'Definir Publicadores',2),(22,'Atender Pedido de Publicação',2),(23,'Pode receber documento sem assinatura',2),(24,'Pode criar documento filho',1),(25,'Gerenciar Publicação Boletim',2),(26,'Simular Usuário',2),(27,'Notificar Por E-mail',2),(28,'Corrigir Erro',2),(29,'Cancelar Movimentação',2),(30,'Incluir como Filho',2),(31,'Destinatário',4),(32,'Utilizar Extensão de Editor',2),(33,'Utilizar Extensão de Conversor HTML',2),(34,'Reiniciar Numeração Todo Ano',1),(35,'Autuável',2),(36,'Editar Data',2),(37,'Editar Descrição',2),(38,'Trâmite Automático',5),(39,'Pode Assinar sem Solicitação',1),(40,'Definição Automática de Perfil',1),(41,'Incluir Documento',1),(42,'Criar Como Novo',1),(43,'Juntada Automática',1),(100,'Instanciar Procedimento',2),(101,'Designar Tarefa',2),(200,'Utilizar Serviço',2),(201,'Pode habilitar serviço',2),(202,'Pode habilitar serviço de diretório',2),(203,'Pertencer',1),(204,'Fazer Login',1),(205,'Utilizar Serviço de Outra Lotação',2),(206,'Gerenciar Grupo',2),(300,'Designação',NULL),(301,'Associação',NULL),(302,'Usar Lista',2),(303,'Inclus?o autom?tica em lista',1),(304,'Abrangência de Acordo',1),(305,'Associação de Configuração com Pesquisa',1),(306,'Escalonar Por Solicitacao Filha',NULL),(307,'Definição do horário da equipe',NULL);
-/*!40000 ALTER TABLE `cp_tipo_configuracao` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_grupo`
---
-
-DROP TABLE IF EXISTS `cp_tipo_grupo`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_grupo` (
-  `ID_TP_GRUPO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TP_GRUPO` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_GRUPO`),
-  UNIQUE KEY `CP_TIPO_GRUPO_PK` (`ID_TP_GRUPO`)
-) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_grupo`
---
-
-LOCK TABLES `cp_tipo_grupo` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_grupo` DISABLE KEYS */;
-INSERT INTO `cp_tipo_grupo` VALUES (1,'Perfil de Acesso'),(2,'Grupo de Distribuição'),(3,'Perfil de Acesso do JEE');
-/*!40000 ALTER TABLE `cp_tipo_grupo` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_identidade`
---
-
-DROP TABLE IF EXISTS `cp_tipo_identidade`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_identidade` (
-  `ID_TP_IDENTIDADE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TP_IDENTIDADE` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_IDENTIDADE`),
-  UNIQUE KEY `CP_TIPO_IDENTIDADE_PK` (`ID_TP_IDENTIDADE`)
-) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_identidade`
---
-
-LOCK TABLES `cp_tipo_identidade` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_identidade` DISABLE KEYS */;
-INSERT INTO `cp_tipo_identidade` VALUES (1,'Login e Senha'),(2,'Certidão Digital ICP-Brasil');
-/*!40000 ALTER TABLE `cp_tipo_identidade` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_lotacao`
---
-
-DROP TABLE IF EXISTS `cp_tipo_lotacao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_lotacao` (
-  `ID_TP_LOTACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `SIGLA_TP_LOTACAO` varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DESC_TP_LOTACAO` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_TP_LOTACAO_PAI` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_LOTACAO`),
-  UNIQUE KEY `CP_TIPO_LOTACAO_PK` (`ID_TP_LOTACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=204 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_lotacao`
---
-
-LOCK TABLES `cp_tipo_lotacao` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_lotacao` DISABLE KEYS */;
-INSERT INTO `cp_tipo_lotacao` VALUES (1,'ADM','Unidade da Administração',NULL),(100,'JUD','Unidade Judicial',NULL),(101,'VF','Vara Federal',100),(102,'VFCR','Vara Federal Criminal',100),(200,'AGR','Agrupamento',NULL),(201,'AGFM','Agrupamento Formal',200),(202,'AGOP','Agrupamento Operacional',200),(203,'AGFC','Agrupamento Funcional',200);
-/*!40000 ALTER TABLE `cp_tipo_lotacao` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_marca`
---
-
-DROP TABLE IF EXISTS `cp_tipo_marca`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_marca` (
-  `ID_TP_MARCA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_TP_MARCA` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_MARCA`)
-) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_marca`
---
-
-LOCK TABLES `cp_tipo_marca` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_marca` DISABLE KEYS */;
-INSERT INTO `cp_tipo_marca` VALUES (1,'SIGA-EX'),(2,'SIGA-SR'),(3,'SIGA-GC');
-/*!40000 ALTER TABLE `cp_tipo_marca` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_marcador`
---
-
-DROP TABLE IF EXISTS `cp_tipo_marcador`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_marcador` (
-  `ID_TP_MARCADOR` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_TIPO_MARCADOR` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_MARCADOR`)
-) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_marcador`
---
-
-LOCK TABLES `cp_tipo_marcador` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_marcador` DISABLE KEYS */;
-INSERT INTO `cp_tipo_marcador` VALUES (1,'Sistema'),(2,'Geral'),(3,'Lotação e sublotações'),(4,'Lotação'),(5,'Pessoa');
-/*!40000 ALTER TABLE `cp_tipo_marcador` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_papel`
---
-
-DROP TABLE IF EXISTS `cp_tipo_papel`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_papel` (
-  `ID_TP_PAPEL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TP_PAPEL` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_PAPEL`),
-  UNIQUE KEY `CP_TIPO_PAPEL_PK` (`ID_TP_PAPEL`)
-) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_papel`
---
-
-LOCK TABLES `cp_tipo_papel` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_papel` DISABLE KEYS */;
-INSERT INTO `cp_tipo_papel` VALUES (1,'Principal'),(2,'Funcional');
-/*!40000 ALTER TABLE `cp_tipo_papel` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_pessoa`
---
-
-DROP TABLE IF EXISTS `cp_tipo_pessoa`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_pessoa` (
-  `ID_TP_PESSOA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TP_PESSOA` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_PESSOA`),
-  UNIQUE KEY `CP_TIPO_PESSOA_PK` (`ID_TP_PESSOA`)
-) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_pessoa`
---
-
-LOCK TABLES `cp_tipo_pessoa` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_pessoa` DISABLE KEYS */;
-INSERT INTO `cp_tipo_pessoa` VALUES (1,'Magistrado'),(2,'Servidor'),(3,'Estagiário'),(4,'Terceirizado');
-/*!40000 ALTER TABLE `cp_tipo_pessoa` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_servico`
---
-
-DROP TABLE IF EXISTS `cp_tipo_servico`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_servico` (
-  `ID_TP_SERVICO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TP_SERVICO` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_SIT_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_TP_SERVICO`),
-  UNIQUE KEY `CP_TIPO_SERVICO_PK` (`ID_TP_SERVICO`),
-  KEY `CP_TP_SERV_ID_SIT_CONF_FK` (`ID_SIT_CONFIGURACAO`),
-  CONSTRAINT `CP_TP_SERV_ID_SIT_CONF_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_tipo_configuracao` (`ID_TP_CONFIGURACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_servico`
---
-
-LOCK TABLES `cp_tipo_servico` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_servico` DISABLE KEYS */;
-INSERT INTO `cp_tipo_servico` VALUES (1,'Diretório',2),(2,'Sistema',2);
-/*!40000 ALTER TABLE `cp_tipo_servico` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_tipo_servico_situacao`
---
-
-DROP TABLE IF EXISTS `cp_tipo_servico_situacao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_tipo_servico_situacao` (
-  `ID_TP_SERVICO` INT UNSIGNED NOT NULL DEFAULT '0',
-  `ID_SIT_CONFIGURACAO` INT UNSIGNED NOT NULL DEFAULT '0',
-  PRIMARY KEY (`ID_TP_SERVICO`,`ID_SIT_CONFIGURACAO`),
-  KEY `CP_TPSERVSIT_ID_SITCONF_FK` (`ID_SIT_CONFIGURACAO`),
-  CONSTRAINT `CP_TPSERVSIT_ID_SITCONF_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_situacao_configuracao` (`ID_SIT_CONFIGURACAO`),
-  CONSTRAINT `CP_TPSRVSIT_IDTPSRV_FK` FOREIGN KEY (`ID_TP_SERVICO`) REFERENCES `cp_tipo_servico` (`ID_TP_SERVICO`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_tipo_servico_situacao`
---
-
-LOCK TABLES `cp_tipo_servico_situacao` WRITE;
-/*!40000 ALTER TABLE `cp_tipo_servico_situacao` DISABLE KEYS */;
-INSERT INTO `cp_tipo_servico_situacao` VALUES (1,1),(2,1),(1,2),(2,2);
-/*!40000 ALTER TABLE `cp_tipo_servico_situacao` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_uf`
---
-
-DROP TABLE IF EXISTS `cp_uf`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_uf` (
-  `ID_UF` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_UF` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  PRIMARY KEY (`ID_UF`),
-  UNIQUE KEY `UF_PK` (`ID_UF`)
-) ENGINE=InnoDB AUTO_INCREMENT=28 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_uf`
---
-
-LOCK TABLES `cp_uf` WRITE;
-/*!40000 ALTER TABLE `cp_uf` DISABLE KEYS */;
-INSERT INTO `cp_uf` VALUES (1,'AC'),(2,'AL'),(3,'AM'),(4,'AP'),(5,'BA'),(6,'CE'),(7,'DF'),(8,'ES'),(9,'GO'),(10,'MA'),(11,'MG'),(12,'MS'),(13,'MT'),(14,'PA'),(15,'PB'),(16,'PE'),(17,'PI'),(18,'PR'),(19,'RJ'),(20,'RN'),(21,'RO'),(22,'RR'),(23,'RS'),(24,'SC'),(25,'SE'),(26,'SP'),(27,'TO');
-/*!40000 ALTER TABLE `cp_uf` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `cp_unidade_medida`
---
-
-DROP TABLE IF EXISTS `cp_unidade_medida`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `cp_unidade_medida` (
-  `ID_UNIDADE_MEDIDA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_UNIDADE_MEDIDA` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_UNIDADE_MEDIDA`)
-) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `cp_unidade_medida`
---
-
-LOCK TABLES `cp_unidade_medida` WRITE;
-/*!40000 ALTER TABLE `cp_unidade_medida` DISABLE KEYS */;
-INSERT INTO `cp_unidade_medida` VALUES (1,'Ano'),(2,'Mes'),(3,'Dia'),(4,'Hora'),(5,'Minuto'),(6,'Segundo');
-/*!40000 ALTER TABLE `cp_unidade_medida` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `dp_cargo`
---
-
-DROP TABLE IF EXISTS `dp_cargo`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_cargo` (
-  `ID_CARGO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NOME_CARGO` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  `DT_FIM_CARGO` datetime DEFAULT NULL,
-  `DT_INI_CARGO` datetime DEFAULT NULL,
-  `ID_CARGO_INICIAL` INT UNSIGNED DEFAULT NULL,
-  `IDE_CARGO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SIGLA_CARGO` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_CARGO`),
-  KEY `DP_CARGO_IDX_012` (`ID_ORGAO_USU`),
-  KEY `DP_CARGO_IDX_011` (`ID_CARGO_INICIAL`),
-  CONSTRAINT `CARGO_INICIAL_CARGO_FK` FOREIGN KEY (`ID_CARGO_INICIAL`) REFERENCES `dp_cargo` (`ID_CARGO`),
-  CONSTRAINT `CARGO_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
-) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_cargo`
---
-
-LOCK TABLES `dp_cargo` WRITE;
-/*!40000 ALTER TABLE `dp_cargo` DISABLE KEYS */;
-INSERT INTO `dp_cargo` VALUES (1,'FUNCIONÁRIO',999999999,NULL,'2011-08-03 00:00:00',1,'203','500300');
-/*!40000 ALTER TABLE `dp_cargo` ENABLE KEYS */;
-UNLOCK TABLES;
-/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
-/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
-/*!50003 SET @saved_col_connection = @@collation_connection */ ;
-/*!50003 SET character_set_client  = utf8 */ ;
-/*!50003 SET character_set_results = utf8 */ ;
-/*!50003 SET collation_connection  = utf8_general_ci */ ;
-/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
-/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
-DELIMITER ;;
-/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_CARGO_INSERT_TRG` BEFORE INSERT ON `dp_cargo` FOR EACH ROW BEGIN
-    if NEW.id_cargo_inicial is null then
-        SET NEW.ID_cargo = NEW.id_cargo_inicial;
-    end if;
-END */;;
-DELIMITER ;
-/*!50003 SET sql_mode              = @saved_sql_mode */ ;
-/*!50003 SET character_set_client  = @saved_cs_client */ ;
-/*!50003 SET character_set_results = @saved_cs_results */ ;
-/*!50003 SET collation_connection  = @saved_col_connection */ ;
-
---
--- Table structure for table `dp_estado_civil`
---
-
-DROP TABLE IF EXISTS `dp_estado_civil`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_estado_civil` (
-  `ID_ESTADO_CIVIL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_ESTADO_CIVIL` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  PRIMARY KEY (`ID_ESTADO_CIVIL`),
-  UNIQUE KEY `ESTADO_CIVIL_PK` (`ID_ESTADO_CIVIL`)
-) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_estado_civil`
---
-
-LOCK TABLES `dp_estado_civil` WRITE;
-/*!40000 ALTER TABLE `dp_estado_civil` DISABLE KEYS */;
-INSERT INTO `dp_estado_civil` VALUES (1,'SOLTEIRO'),(2,'CASADO'),(3,'SEPARADO'),(4,'DIVORCIADO'),(5,'VIUVO'),(6,'UNIAO ESTAVEL'),(7,'NÃO DECLARADO');
-/*!40000 ALTER TABLE `dp_estado_civil` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `dp_funcao_confianca`
---
-
-DROP TABLE IF EXISTS `dp_funcao_confianca`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_funcao_confianca` (
-  `ID_FUNCAO_CONFIANCA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NOME_FUNCAO_CONFIANCA` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `NIVEL_FUNCAO_CONFIANCA` tinyint(4) DEFAULT NULL,
-  `COD_FOLHA_FUNCAO_CONFIANCA` tinyint(4) DEFAULT NULL,
-  `DT_INI_FUNCAO_CONFIANCA` datetime DEFAULT NULL,
-  `DT_FIM_FUNCAO_CONFIANCA` datetime DEFAULT NULL,
-  `ID_FUNCAO_CONFIANCA_PAI` INT UNSIGNED DEFAULT NULL,
-  `CATEGORIA_FUNCAO_CONFIANCA` varchar(15) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  `IDE_FUNCAO_CONFIANCA` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_FUN_CONF_INI` INT UNSIGNED DEFAULT NULL,
-  `SIGLA_FUNCAO_CONFIANCA` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_FUNCAO_CONFIANCA`),
-  KEY `DP_FUNCAO_CONFIANCA_IDX_010` (`ID_FUNCAO_CONFIANCA_PAI`),
-  KEY `DP_FUNCAO_CONFIANCA_IDX_009` (`ID_ORGAO_USU`),
-  KEY `DP_FUNCAO_CONFIANCA_IDX_008` (`ID_FUN_CONF_INI`),
-  CONSTRAINT `FUN_CONF_INI_FUN_CONF_PK` FOREIGN KEY (`ID_FUN_CONF_INI`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
-  CONSTRAINT `FUN_CONF_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `dp_funcao_confianca_ibfk_1` FOREIGN KEY (`ID_FUNCAO_CONFIANCA_PAI`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_funcao_confianca`
---
-
-LOCK TABLES `dp_funcao_confianca` WRITE;
-/*!40000 ALTER TABLE `dp_funcao_confianca` DISABLE KEYS */;
-/*!40000 ALTER TABLE `dp_funcao_confianca` ENABLE KEYS */;
-UNLOCK TABLES;
-/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
-/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
-/*!50003 SET @saved_col_connection = @@collation_connection */ ;
-/*!50003 SET character_set_client  = utf8 */ ;
-/*!50003 SET character_set_results = utf8 */ ;
-/*!50003 SET collation_connection  = utf8_general_ci */ ;
-/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
-/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
-DELIMITER ;;
-/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_FUNC_CONF_INSERT_TRG` BEFORE INSERT ON `dp_funcao_confianca` FOR EACH ROW begin
-if NEW.id_fun_conf_ini is null then
-    SET NEW.ID_funcao_confianca = NEW.id_fun_conf_ini;
-end if;
-end */;;
-DELIMITER ;
-/*!50003 SET sql_mode              = @saved_sql_mode */ ;
-/*!50003 SET character_set_client  = @saved_cs_client */ ;
-/*!50003 SET character_set_results = @saved_cs_results */ ;
-/*!50003 SET collation_connection  = @saved_col_connection */ ;
-
---
--- Table structure for table `dp_lotacao`
---
-
-DROP TABLE IF EXISTS `dp_lotacao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_lotacao` (
-  `ID_LOTACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DATA_INI_LOT` datetime NOT NULL,
-  `DATA_FIM_LOT` datetime DEFAULT NULL,
-  `NOME_LOTACAO` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `ID_LOTACAO_PAI` INT UNSIGNED DEFAULT NULL,
-  `SIGLA_LOTACAO` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  `IDE_LOTACAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_LOTACAO_INI` INT UNSIGNED DEFAULT NULL,
-  `ID_TP_LOTACAO` INT UNSIGNED DEFAULT NULL,
-  `ID_LOCALIDADE` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_LOTACAO`),
-  UNIQUE KEY `SIGLA_LOTACAO_DP_LOTACAO_UK` (`SIGLA_LOTACAO`,`ID_ORGAO_USU`,`DATA_FIM_LOT`),
-  KEY `DP_LOTACAO_IDX_007` (`ID_LOTACAO_PAI`),
-  KEY `LOT_ID_INI` (`ID_LOTACAO_INI`,`DATA_FIM_LOT`),
-  KEY `DP_LOTACAO_IDX_006` (`ID_ORGAO_USU`),
-  KEY `DP_LOT_CP_TP_LOT_ID_TP_LOT_FK` (`ID_TP_LOTACAO`),
-  KEY `ID_LOCALIDADE` (`ID_LOCALIDADE`),
-  CONSTRAINT `DP_LOT_CP_TP_LOT_ID_TP_LOT_FK` FOREIGN KEY (`ID_TP_LOTACAO`) REFERENCES `cp_tipo_lotacao` (`ID_TP_LOTACAO`),
-  CONSTRAINT `LOTACAO_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `dp_lotacao_ibfk_1` FOREIGN KEY (`ID_LOTACAO_PAI`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
-  CONSTRAINT `dp_lotacao_ibfk_2` FOREIGN KEY (`ID_LOCALIDADE`) REFERENCES `cp_localidade` (`ID_LOCALIDADE`)
-) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_lotacao`
---
-
-LOCK TABLES `dp_lotacao` WRITE;
-/*!40000 ALTER TABLE `dp_lotacao` DISABLE KEYS */;
-INSERT INTO `dp_lotacao` VALUES (1,'2011-08-08 00:00:00',NULL,'LOTACAO TESTE',NULL,'LTEST',999999999,'1076',1,100,NULL);
-/*!40000 ALTER TABLE `dp_lotacao` ENABLE KEYS */;
-UNLOCK TABLES;
-/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
-/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
-/*!50003 SET @saved_col_connection = @@collation_connection */ ;
-/*!50003 SET character_set_client  = utf8 */ ;
-/*!50003 SET character_set_results = utf8 */ ;
-/*!50003 SET collation_connection  = utf8_general_ci */ ;
-/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
-/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
-DELIMITER ;;
-/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_LOTACAO_INSERT_TRG` BEFORE INSERT ON `dp_lotacao` FOR EACH ROW begin
-if NEW.id_lotacao_ini is null then
-    SET NEW.ID_lotacao = NEW.id_lotacao_ini;
-end if;
-end */;;
-DELIMITER ;
-/*!50003 SET sql_mode              = @saved_sql_mode */ ;
-/*!50003 SET character_set_client  = @saved_cs_client */ ;
-/*!50003 SET character_set_results = @saved_cs_results */ ;
-/*!50003 SET collation_connection  = @saved_col_connection */ ;
-
---
--- Table structure for table `dp_padrao_referencia`
---
-
-DROP TABLE IF EXISTS `dp_padrao_referencia`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_padrao_referencia` (
-  `ID_PADRAO_REFERENCIA` tinyint(4) NOT NULL AUTO_INCREMENT,
-  `ID_PADRAO_REFERENCIA_PAI` tinyint(4) DEFAULT NULL,
-  `DSC_PADRAO` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `DSC_CLASSE` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DSC_NIVEL` varchar(2) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `PADRAO_REFERENCIA_DT_FIM` datetime DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL DEFAULT '1',
-  PRIMARY KEY (`ID_PADRAO_REFERENCIA`),
-  UNIQUE KEY `PADRAO_REFERENCIA_PK` (`ID_PADRAO_REFERENCIA`),
-  KEY `PADRAO_REF_ORGAO_USU_FK` (`ID_ORGAO_USU`),
-  CONSTRAINT `PADRAO_REF_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_padrao_referencia`
---
-
-LOCK TABLES `dp_padrao_referencia` WRITE;
-/*!40000 ALTER TABLE `dp_padrao_referencia` DISABLE KEYS */;
-/*!40000 ALTER TABLE `dp_padrao_referencia` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `dp_pessoa`
---
-
-DROP TABLE IF EXISTS `dp_pessoa`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_pessoa` (
-  `ID_PESSOA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DATA_INI_PESSOA` datetime NOT NULL,
-  `DATA_FIM_PESSOA` datetime DEFAULT NULL,
-  `CPF_PESSOA` bigint(20) NOT NULL,
-  `NOME_PESSOA` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `DATA_NASC_PESSOA` datetime DEFAULT NULL,
-  `MATRICULA` INT UNSIGNED NOT NULL,
-  `ID_LOTACAO` INT UNSIGNED NOT NULL,
-  `ID_CARGO` INT UNSIGNED DEFAULT NULL,
-  `ID_FUNCAO_CONFIANCA` INT UNSIGNED DEFAULT NULL,
-  `SESB_PESSOA` varchar(5) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `EMAIL_PESSOA` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `TP_SERVIDOR_PESSOA` tinyint(4) DEFAULT NULL,
-  `SIGLA_PESSOA` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SEXO_PESSOA` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `GRAU_INSTRUCAO_PESSOA` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `TP_SANGUINEO_PESSOA` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `NACIONALIDADE_PESSOA` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DATA_POSSE_PESSOA` datetime DEFAULT NULL,
-  `DATA_NOMEACAO_PESSOA` datetime DEFAULT NULL,
-  `DATA_PUBLICACAO_PESSOA` datetime DEFAULT NULL,
-  `DATA_INICIO_EXERCICIO_PESSOA` datetime DEFAULT NULL,
-  `ATO_NOMEACAO_PESSOA` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `SITUACAO_FUNCIONAL_PESSOA` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_PROVIMENTO` tinyint(4) DEFAULT NULL,
-  `NATURALIDADE_PESSOA` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `FG_IMPRIME_END` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DSC_PADRAO_REFERENCIA_PESSOA` varchar(16) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
-  `IDE_PESSOA` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_PESSOA_INICIAL` INT UNSIGNED DEFAULT NULL,
-  `ENDERECO_PESSOA` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `BAIRRO_PESSOA` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `CIDADE_PESSOA` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `CEP_PESSOA` varchar(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `TELEFONE_PESSOA` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `RG_PESSOA` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `RG_ORGAO_PESSOA` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `RG_DATA_EXPEDICAO_PESSOA` datetime DEFAULT NULL,
-  `RG_UF_PESSOA` varchar(2) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `ID_ESTADO_CIVIL` INT UNSIGNED DEFAULT NULL,
-  `ID_TP_PESSOA` INT UNSIGNED DEFAULT NULL,
-  `NOME_EXIBICAO` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`ID_PESSOA`),
-  KEY `PES_ID_INI` (`ID_PESSOA_INICIAL`,`DATA_FIM_PESSOA`),
-  KEY `DP_PESSOA_IDX_003` (`ID_FUNCAO_CONFIANCA`),
-  KEY `DP_PESSOA_IDX_001` (`ID_ORGAO_USU`),
-  KEY `DP_PESSOA_NM_PESSOA_IX` (`NOME_PESSOA`),
-  KEY `DP_PESSOA_IDX_002` (`ID_CARGO`,`ID_LOTACAO`,`ID_FUNCAO_CONFIANCA`,`ID_ORGAO_USU`),
-  KEY `DP_PESSOA_IDX_015` (`DATA_FIM_PESSOA`,`NOME_PESSOA`),
-  KEY `DP_PESSOA_IDX_005` (`ID_PROVIMENTO`),
-  KEY `DP_PESSOA_IDX_014` (`MATRICULA`,`SESB_PESSOA`,`DATA_FIM_PESSOA`),
-  KEY `DP_PESSOA_IDX_004` (`ID_LOTACAO`),
-  KEY `DP_PESS_CPTPPESS_ID_TPPESS_FK` (`ID_TP_PESSOA`),
-  KEY `PESSOA_ESTADO_CIVIL_FK` (`ID_ESTADO_CIVIL`),
-  CONSTRAINT `DP_PESS_CPTPPESS_ID_TPPESS_FK` FOREIGN KEY (`ID_TP_PESSOA`) REFERENCES `cp_tipo_pessoa` (`ID_TP_PESSOA`),
-  CONSTRAINT `PESSOA_ESTADO_CIVIL_FK` FOREIGN KEY (`ID_ESTADO_CIVIL`) REFERENCES `dp_estado_civil` (`ID_ESTADO_CIVIL`),
-  CONSTRAINT `PESSOA_INICIAL_PESSOAL_FK` FOREIGN KEY (`ID_PESSOA_INICIAL`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
-  CONSTRAINT `PESSOA_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
-  CONSTRAINT `dp_pessoa_ibfk_1` FOREIGN KEY (`ID_CARGO`) REFERENCES `dp_cargo` (`ID_CARGO`),
-  CONSTRAINT `dp_pessoa_ibfk_2` FOREIGN KEY (`ID_FUNCAO_CONFIANCA`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
-  CONSTRAINT `dp_pessoa_ibfk_3` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
-  CONSTRAINT `dp_pessoa_ibfk_4` FOREIGN KEY (`ID_PROVIMENTO`) REFERENCES `dp_provimento` (`ID_PROVIMENTO`)
-) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_pessoa`
---
-
-LOCK TABLES `dp_pessoa` WRITE;
-/*!40000 ALTER TABLE `dp_pessoa` DISABLE KEYS */;
-INSERT INTO `dp_pessoa` VALUES (1,'2001-01-01 00:00:00',NULL,11111111111,'USUARIO TESTE','2001-01-01 00:00:00',99999,1,1,NULL,'ZZ','usuarioteste@jfrj.jus.br',NULL,'TST','M','ESPEC','A+','BRASILEIRO','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','0000/2001','1',NULL,NULL,NULL,'PAD-REF',999999999,'99999',1,'AV ALMTE BARROSO 78','CENTRO','RIO DE JANEIRO','20000000','9700','987654321','TESTE','2001-01-01 00:00:00','RJ',2,2,NULL);
-/*!40000 ALTER TABLE `dp_pessoa` ENABLE KEYS */;
-UNLOCK TABLES;
-/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
-/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
-/*!50003 SET @saved_col_connection = @@collation_connection */ ;
-/*!50003 SET character_set_client  = utf8 */ ;
-/*!50003 SET character_set_results = utf8 */ ;
-/*!50003 SET collation_connection  = utf8_general_ci */ ;
-/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
-/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
-DELIMITER ;;
-/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_PESSOA_INSERT_TRG` BEFORE INSERT ON `dp_pessoa` FOR EACH ROW begin
-if NEW.id_pessoa_inicial is null then
-    SET NEW.ID_pessoa = NEW.id_pessoa_inicial;
-end if;
-end */;;
-DELIMITER ;
-/*!50003 SET sql_mode              = @saved_sql_mode */ ;
-/*!50003 SET character_set_client  = @saved_cs_client */ ;
-/*!50003 SET character_set_results = @saved_cs_results */ ;
-/*!50003 SET collation_connection  = @saved_col_connection */ ;
-
---
--- Table structure for table `dp_provimento`
---
-
-DROP TABLE IF EXISTS `dp_provimento`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_provimento` (
-  `ID_PROVIMENTO` tinyint(4) NOT NULL AUTO_INCREMENT,
-  `DSC_PROVIMENTO` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  PRIMARY KEY (`ID_PROVIMENTO`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_provimento`
---
-
-LOCK TABLES `dp_provimento` WRITE;
-/*!40000 ALTER TABLE `dp_provimento` DISABLE KEYS */;
-/*!40000 ALTER TABLE `dp_provimento` ENABLE KEYS */;
-UNLOCK TABLES;
-
---
--- Table structure for table `dp_substituicao`
---
-
-DROP TABLE IF EXISTS `dp_substituicao`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
-CREATE TABLE `dp_substituicao` (
-  `ID_SUBSTITUICAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `ID_TITULAR` INT UNSIGNED DEFAULT NULL,
-  `ID_LOTA_TITULAR` INT UNSIGNED NOT NULL,
-  `ID_SUBSTITUTO` INT UNSIGNED DEFAULT NULL,
-  `ID_LOTA_SUBSTITUTO` INT UNSIGNED NOT NULL,
-  `DT_INI_SUBST` datetime NOT NULL,
-  `DT_FIM_SUBST` datetime DEFAULT NULL,
-  `DT_INI_REG` datetime DEFAULT NULL,
-  `DT_FIM_REG` datetime DEFAULT NULL,
-  `ID_REG_INI` INT UNSIGNED DEFAULT NULL,
-  PRIMARY KEY (`ID_SUBSTITUICAO`),
-  KEY `SUBSTITUICAO_PESOA_SUBST_FK` (`ID_SUBSTITUTO`),
-  KEY `SUBSTITUICAO_PESOA_TITULAR_FK` (`ID_TITULAR`),
-  CONSTRAINT `SUBSTITUICAO_PESOA_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUTO`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
-  CONSTRAINT `SUBSTITUICAO_PESOA_TITULAR_FK` FOREIGN KEY (`ID_TITULAR`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
---
--- Dumping data for table `dp_substituicao`
---
-
-LOCK TABLES `dp_substituicao` WRITE;
-/*!40000 ALTER TABLE `dp_substituicao` DISABLE KEYS */;
-/*!40000 ALTER TABLE `dp_substituicao` ENABLE KEYS */;
-UNLOCK TABLES;
-
-drop function if exists remove_acento;
-delimiter |
-create function remove_acento( textvalue varchar(20000) )
-returns varchar(20000) DETERMINISTIC
-begin
-
-set @textvalue = textvalue;
-
--- ACCENTS
-set @withaccents = 'ŠšŽžÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÑÒÓÔÕÖØÙÚÛÜÝŸÞàáâãäåæçèéêëìíîïñòóôõöøùúûüýÿþƒ';
-set @withoutaccents = 'SsZzAAAAAAACEEEEIIIINOOOOOOUUUUYYBaaaaaaaceeeeiiiinoooooouuuuyybf';
-set @count = length(@withaccents);
-
-while @count > 0 do
-    set @textvalue = replace(@textvalue, substring(@withaccents, @count, 1), substring(@withoutaccents, @count, 1));
-    set @count = @count - 1;
-end while;
-
--- SPECIAL CHARS
-set @special = '!@#$%¨&*()_+=§¹²³£¢¬"`´{[^~}]<,>.:;?/°ºª+*|\\''';
-set @count = length(@special);
-while @count > 0 do
-    set @textvalue = replace(@textvalue, substring(@special, @count, 1), '');
-    set @count = @count - 1;
-end while;
-
-return @textvalue;
-
-end;
-
-
---
--- Dumping routines for database 'corporativo'
---
-/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;
-
-/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
-/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
-/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
-/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
-/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
-/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
-/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
-
--- Dump completed on 2020-02-12 13:03:52
diff --git a/siga-cp/src/main/resources/db/mysql/sigacp/V1.0__Inicial.sql b/siga-cp/src/main/resources/db/mysql/sigacp/V1.0__Inicial.sql
new file mode 100644
index 0000000000..22ad850978
--- /dev/null
+++ b/siga-cp/src/main/resources/db/mysql/sigacp/V1.0__Inicial.sql
@@ -0,0 +1,2610 @@
+CREATE DATABASE  IF NOT EXISTS `corporativo` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
+USE `corporativo`;
+-- MySQL dump 10.13  Distrib 8.0.18, for Win64 (x86_64)
+--
+-- Host: 127.0.0.1    Database: corporativo
+-- ------------------------------------------------------
+-- Server version	8.0.18
+
+/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
+/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
+/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
+/*!50503 SET NAMES utf8 */;
+/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
+/*!40103 SET TIME_ZONE='+00:00' */;
+/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
+/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
+/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
+/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
+
+--
+-- Table structure for table `cad_sit_funcional`
+--
+
+DROP TABLE IF EXISTS `cad_sit_funcional`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cad_sit_funcional` (
+  `ID_CAD_SIT_FUNCIONAL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DSC_SIT_FUNCIONAL` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_MUMPS` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_CAD_SIT_FUNCIONAL`),
+  UNIQUE KEY `CAD_SIT_FUNCIONAL_PK` (`ID_CAD_SIT_FUNCIONAL`)
+) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cad_sit_funcional`
+--
+
+LOCK TABLES `cad_sit_funcional` WRITE;
+/*!40000 ALTER TABLE `cad_sit_funcional` DISABLE KEYS */;
+INSERT INTO `cad_sit_funcional` VALUES (1,'ATIVO',1),
+(2,'CEDIDO',45),
+(3,'POSSE EM CARGO INACUMULAVEL',25),
+(4,'APOSENTADO',5),
+(5,'EXONERADO',10),
+(6,'DEMITIDO',15),
+(7,'FALECIDO',20),
+(9,'RETORNO PARA ORGAO DE ORIGEM',40),
+(10,'TRANSFERIDO',35),
+(11,'LICENCA PARA ACOMPANHAR CONJUGE SEM REMUNERACAO',65),
+(12,'LICENCA PARA ACOMPANHAR CONJUGE COM EXERCICIO PROVISORIO',70),
+(13,'LICENCA PARA MANDATO CLASSISTA',75),
+(14,'LICENCA PARA ASSUNTOS PARTICULARES',80),
+(15,'ESTAGIARIO DESLIGADO (SADES)',125),
+(16,'DISPONIBILIDADE',50),
+(17,'REMOVIDO',115),
+(18,'AFASTAMENTO POR DECISAO JUDICIAL',100),
+(19,'POSSE ANULADA',30),
+(20,'REDISTRIBUIDO',55),
+(21,'PROMOVIDO TRF',60),
+(23,'LICENCA PARA CURSO DE FORMACAO',85),
+(25,'LICENCA PARA ATIVIDADE POLITICA',90),
+(26,'AFASTAMENTO PARA MANDATO ELETIVO',105),
+(29,'LICENCA PARA CAPACITACAO',95),
+(30,'AFASTAMENTO PARA ESTUDO/MISSAO EXTERIOR',110),
+(31,'REMOVIDO - LEI 11.416/06',120);
+/*!40000 ALTER TABLE `cad_sit_funcional` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_acesso`
+--
+
+DROP TABLE IF EXISTS `cp_acesso`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_acesso` (
+  `ID_ACESSO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_IDENTIDADE` INT UNSIGNED NOT NULL,
+  `DT_INI` datetime NOT NULL,
+  `DT_FIM` datetime DEFAULT NULL,
+  `TP_ACESSO` tinyint(4) NOT NULL,
+  `IP_AUDIT` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_ACESSO`),
+  KEY `CP_ACESSO_IDENTIDADE_FK` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_ACESSO_IDENTIDADE_FK` FOREIGN KEY (`ID_IDENTIDADE`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`)
+) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_acesso`
+--
+
+LOCK TABLES `cp_acesso` WRITE;
+/*!40000 ALTER TABLE `cp_acesso` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_acesso` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_aplicacao_feriado`
+--
+
+DROP TABLE IF EXISTS `cp_aplicacao_feriado`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_aplicacao_feriado` (
+  `ID_APLICACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
+  `ID_LOTACAO` INT UNSIGNED DEFAULT NULL,
+  `ID_LOCALIDADE` INT UNSIGNED DEFAULT NULL,
+  `ID_OCORRENCIA_FERIADO` INT UNSIGNED DEFAULT NULL,
+  `FERIADO` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_APLICACAO`),
+  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
+  KEY `ID_LOTACAO` (`ID_LOTACAO`),
+  KEY `ID_LOCALIDADE` (`ID_LOCALIDADE`),
+  KEY `ID_OCORRENCIA_FERIADO` (`ID_OCORRENCIA_FERIADO`),
+  CONSTRAINT `cp_aplicacao_feriado_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `cp_aplicacao_feriado_ibfk_2` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
+  CONSTRAINT `cp_aplicacao_feriado_ibfk_3` FOREIGN KEY (`ID_LOCALIDADE`) REFERENCES `cp_localidade` (`ID_LOCALIDADE`),
+  CONSTRAINT `cp_aplicacao_feriado_ibfk_4` FOREIGN KEY (`ID_OCORRENCIA_FERIADO`) REFERENCES `cp_ocorrencia_feriado` (`ID_OCORRENCIA`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_aplicacao_feriado`
+--
+
+LOCK TABLES `cp_aplicacao_feriado` WRITE;
+/*!40000 ALTER TABLE `cp_aplicacao_feriado` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_aplicacao_feriado` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_complexo`
+--
+
+DROP TABLE IF EXISTS `cp_complexo`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_complexo` (
+  `ID_COMPLEXO` INT UNSIGNED NOT NULL,
+  `NOME_COMPLEXO` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_LOCALIDADE` INT UNSIGNED DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_COMPLEXO`),
+  KEY `ID_LOCALIDADE` (`ID_LOCALIDADE`),
+  CONSTRAINT `cp_complexo_ibfk_1` FOREIGN KEY (`ID_LOCALIDADE`) REFERENCES `cp_localidade` (`ID_LOCALIDADE`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_complexo`
+--
+
+LOCK TABLES `cp_complexo` WRITE;
+/*!40000 ALTER TABLE `cp_complexo` DISABLE KEYS */;
+INSERT INTO `cp_complexo` VALUES (1,'Almirante Barroso',15,999999999),
+(2,'Angra',1,999999999),
+(3,'Barra do Piraí',2,999999999),
+(4,'Campos',4,999999999),
+(5,'Duque de Caxias',5,999999999),
+(6,'Equador',5,999999999),
+(7,'Friburgo',11,999999999),
+(8,'Itaboraí',6,999999999),
+(9,'Itaperuna',7,999999999),
+(10,'Macaé',8,999999999),
+(11,'Mage',9,999999999),
+(12,'Niteroi',10,999999999),
+(13,'Nova Iguaçu',12,999999999),
+(14,'Petrópolis',13,999999999),
+(15,'Resende',14,999999999),
+(16,'Rio Branco',15,999999999),
+(17,'Sao Gonçalo',16,999999999),
+(18,'Sao Joao de Meriti',17,999999999),
+(19,'Sao Pedro da Aldeia',19,999999999),
+(20,'São Cristovão',15,999999999),
+(21,'Teresópolis',20,999999999),
+(22,'Tres Rios',21,999999999),
+(23,'Venezuela',15,999999999),
+(24,'Volta Redonda',23,999999999),
+(25,'Visconde de Inhaúma',15,3),
+(27,'Campo Grande',671,1);
+/*!40000 ALTER TABLE `cp_complexo` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_configuracao`
+--
+
+DROP TABLE IF EXISTS `cp_configuracao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_configuracao` (
+  `ID_CONFIGURACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DT_INI_VIG_CONFIGURACAO` datetime DEFAULT NULL,
+  `DT_FIM_VIG_CONFIGURACAO` datetime DEFAULT NULL,
+  `his_dt_ini` datetime DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
+  `ID_LOTACAO` INT UNSIGNED DEFAULT NULL,
+  `ID_CARGO` INT UNSIGNED DEFAULT NULL,
+  `ID_FUNCAO_CONFIANCA` INT UNSIGNED DEFAULT NULL,
+  `ID_PESSOA` INT UNSIGNED DEFAULT NULL,
+  `ID_SIT_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
+  `ID_TP_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
+  `ID_SERVICO` INT UNSIGNED DEFAULT NULL,
+  `ID_GRUPO` INT UNSIGNED DEFAULT NULL,
+  `NM_EMAIL` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DESC_FORMULA` varchar(1024) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_TP_LOTACAO` INT UNSIGNED DEFAULT NULL,
+  `ID_IDENTIDADE` INT UNSIGNED DEFAULT NULL,
+  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
+  `HIS_DT_FIM` datetime DEFAULT NULL,
+  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
+  `ID_COMPLEXO` INT UNSIGNED DEFAULT NULL,
+  `ID_ORGAO_OBJETO` INT UNSIGNED DEFAULT NULL,
+  `DESCR_CONFIGURACAO` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_LOTACAO_OBJETO` INT UNSIGNED DEFAULT NULL,
+  `ID_COMPLEXO_OBJETO` INT UNSIGNED DEFAULT NULL,
+  `ID_CARGO_OBJETO` INT UNSIGNED DEFAULT NULL,
+  `ID_FUNCAO_CONFIANCA_OBJETO` INT UNSIGNED DEFAULT NULL,
+  `ID_PESSOA_OBJETO` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_CONFIGURACAO`),
+  UNIQUE KEY `CP_CONF_ID_CONFIGURACAO_PK` (`ID_CONFIGURACAO`),
+  KEY `CP_CONF_CP_GRUP_ID_GRP_FK` (`ID_GRUPO`),
+  KEY `CP_CONF_CP_IDENT_IDC_FIM_FK` (`HIS_IDC_FIM`),
+  KEY `CP_CONF_CP_IDENT_IDC_INI_FK` (`HIS_IDC_INI`),
+  KEY `CP_CONF_CP_IDENT_ID_IDENT_FK` (`ID_IDENTIDADE`),
+  KEY `CP_CONF_CP_ORG_USU_ID_FK` (`ID_ORGAO_USU`),
+  KEY `CP_CONF_CP_SERV_ID_SERVICO_FK` (`ID_SERVICO`),
+  KEY `CP_CONF_CP_SIT_CONF_ID_FK` (`ID_SIT_CONFIGURACAO`),
+  KEY `CP_CONF_CP_TPLOT_ID_TP_LOT_FK` (`ID_TP_LOTACAO`),
+  KEY `CP_CONF_CP_TP_CONF_ID_FK` (`ID_TP_CONFIGURACAO`),
+  KEY `CP_CONF_DP_CARGO_ID_CARGO_FK` (`ID_CARGO`),
+  KEY `CP_CONF_DP_F_CONFIANCA_ID_FK` (`ID_FUNCAO_CONFIANCA`),
+  KEY `CP_CONF_DP_LOT_ID_LOTACAO_FK` (`ID_LOTACAO`),
+  KEY `CP_CONF_DP_PES_ID_PESSOA_FK` (`ID_PESSOA`),
+  KEY `CP_CONFIGURACAO_COMPLEXO_FK` (`ID_COMPLEXO`),
+  CONSTRAINT `CP_CONFIGURACAO_COMPLEXO_FK` FOREIGN KEY (`ID_COMPLEXO`) REFERENCES `cp_complexo` (`ID_COMPLEXO`),
+  CONSTRAINT `CP_CONF_CP_GRUP_ID_GRP_FK` FOREIGN KEY (`ID_GRUPO`) REFERENCES `cp_grupo` (`ID_GRUPO`),
+  CONSTRAINT `CP_CONF_CP_IDENT_IDC_FIM_FK` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_CONF_CP_IDENT_IDC_INI_FK` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_CONF_CP_IDENT_ID_IDENT_FK` FOREIGN KEY (`ID_IDENTIDADE`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_CONF_CP_ORG_USU_ID_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `CP_CONF_CP_SERV_ID_SERVICO_FK` FOREIGN KEY (`ID_SERVICO`) REFERENCES `cp_servico` (`ID_SERVICO`),
+  CONSTRAINT `CP_CONF_CP_SIT_CONF_ID_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_situacao_configuracao` (`ID_SIT_CONFIGURACAO`),
+  CONSTRAINT `CP_CONF_CP_TPLOT_ID_TP_LOT_FK` FOREIGN KEY (`ID_TP_LOTACAO`) REFERENCES `cp_tipo_lotacao` (`ID_TP_LOTACAO`),
+  CONSTRAINT `CP_CONF_CP_TP_CONF_ID_FK` FOREIGN KEY (`ID_TP_CONFIGURACAO`) REFERENCES `cp_tipo_configuracao` (`ID_TP_CONFIGURACAO`),
+  CONSTRAINT `CP_CONF_DP_CARGO_ID_CARGO_FK` FOREIGN KEY (`ID_CARGO`) REFERENCES `dp_cargo` (`ID_CARGO`),
+  CONSTRAINT `CP_CONF_DP_F_CONFIANCA_ID_FK` FOREIGN KEY (`ID_FUNCAO_CONFIANCA`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
+  CONSTRAINT `CP_CONF_DP_LOT_ID_LOTACAO_FK` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
+  CONSTRAINT `CP_CONF_DP_PES_ID_PESSOA_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
+) ENGINE=InnoDB AUTO_INCREMENT=38 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_configuracao`
+--
+
+LOCK TABLES `cp_configuracao` WRITE;
+/*!40000 ALTER TABLE `cp_configuracao` DISABLE KEYS */;
+INSERT INTO `cp_configuracao` VALUES 
+(1,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,2,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(2,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,65,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(3,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,3,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(4,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,42,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(5,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,41,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(6,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,24,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(7,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,16,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(8,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,284,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(9,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,306,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(10,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,15,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(11,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,17,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(12,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,18,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(13,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,19,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(14,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,20,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(15,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,21,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(16,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,22,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(17,NULL,NULL,'2012-03-20 00:00:00',NULL,NULL,NULL,NULL,1,1,200,23,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(18,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,1,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(19,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,305,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(20,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,304,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(21,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,62,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(22,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,64,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(23,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,63,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(24,NULL,NULL,'2020-02-07 16:07:37',NULL,NULL,NULL,NULL,1,1,200,307,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(25,NULL,NULL,'2020-02-07 16:07:37',NULL,NULL,NULL,NULL,1,1,200,308,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(26,'2012-03-12 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,18,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(27,'2012-03-12 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,19,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(28,'2012-03-12 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,3,4,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(29,'2012-10-31 00:00:00',NULL,NULL,NULL,NULL,NULL,NULL,NULL,1,30,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(30,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,1,30,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(31,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,2,2,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(32,NULL,NULL,'2014-04-11 17:03:01',NULL,NULL,NULL,NULL,NULL,1,35,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(33,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,5,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(34,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,5,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(35,NULL,NULL,'2020-02-07 16:07:39',NULL,NULL,NULL,NULL,NULL,5,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(36,'2020-02-07 16:07:40',NULL,NULL,NULL,NULL,NULL,NULL,NULL,1,200,310,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,35,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(38,NULL,NULL,'2020-04-02 16:38:44',NULL,NULL,NULL,NULL,NULL,2,2,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,38,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(39,NULL,NULL,'2020-04-02 16:39:05',NULL,NULL,NULL,NULL,NULL,2,2,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,39,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(40,NULL,NULL,'2020-04-13 16:13:37',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,40,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(41,NULL,NULL,'2020-04-13 16:14:05',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,41,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(42,NULL,NULL,'2020-04-13 16:14:54',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,42,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(43,NULL,NULL,'2020-04-13 16:15:30',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,43,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(44,NULL,NULL,'2020-04-13 16:16:09',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,44,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(45,NULL,NULL,'2020-04-13 16:16:57',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,45,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(46,NULL,NULL,'2020-04-13 16:19:43',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,46,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(47,NULL,NULL,'2020-04-13 16:20:52',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,47,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(48,NULL,NULL,'2020-04-13 16:36:08',NULL,NULL,NULL,NULL,NULL,1,35,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,48,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(54,NULL,NULL,'2020-04-13 17:59:24',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,1,'2020-04-13 17:59:57',54,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(55,NULL,NULL,'2020-04-13 18:00:20',NULL,NULL,NULL,NULL,NULL,2,17,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,55,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(56,NULL,NULL,'2020-04-13 18:01:58',NULL,NULL,NULL,NULL,NULL,2,1,NULL,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,56,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(58,NULL,NULL,'2012-03-22 00:00:00',NULL,NULL,NULL,NULL,1,1,200,43,NULL,NULL,NULL,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
+/*!40000 ALTER TABLE `cp_configuracao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_feriado`
+--
+
+DROP TABLE IF EXISTS `cp_feriado`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_feriado` (
+  `ID_FERIADO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DSC_FERIADO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  PRIMARY KEY (`ID_FERIADO`),
+  UNIQUE KEY `FERIADO_PK` (`ID_FERIADO`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_feriado`
+--
+
+LOCK TABLES `cp_feriado` WRITE;
+/*!40000 ALTER TABLE `cp_feriado` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_feriado` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_grupo`
+--
+
+DROP TABLE IF EXISTS `cp_grupo`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_grupo` (
+  `ID_GRUPO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_TP_GRUPO` INT UNSIGNED NOT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  `ID_GRUPO_PAI` INT UNSIGNED DEFAULT NULL,
+  `SIGLA_GRUPO` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DESC_GRUPO` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_DT_INI` datetime NOT NULL,
+  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_DT_FIM` datetime DEFAULT NULL,
+  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
+  `HIS_ATIVO` tinyint(4) NOT NULL,
+  PRIMARY KEY (`ID_GRUPO`),
+  UNIQUE KEY `CP_GRUPO_PK` (`ID_GRUPO`),
+  KEY `CP_GRP_CP_GRP_ID_INI_FK` (`HIS_ID_INI`),
+  KEY `CP_GRP_CP_GRP_ID_PAI_FK` (`ID_GRUPO_PAI`),
+  KEY `CP_GRP_CP_IDENT_IDC_FIM_FK` (`HIS_IDC_FIM`),
+  KEY `CP_GRP_CP_IDENT_IDC_INI_FK` (`HIS_IDC_INI`),
+  KEY `CP_GRP_CP_TP_GRP_ID_TP_GRP_FK` (`ID_TP_GRUPO`),
+  CONSTRAINT `CP_GRP_CP_GRP_ID_INI_FK` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_grupo` (`ID_GRUPO`),
+  CONSTRAINT `CP_GRP_CP_GRP_ID_PAI_FK` FOREIGN KEY (`ID_GRUPO_PAI`) REFERENCES `cp_grupo` (`ID_GRUPO`),
+  CONSTRAINT `CP_GRP_CP_IDENT_IDC_FIM_FK` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_GRP_CP_IDENT_IDC_INI_FK` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_GRP_CP_TP_GRP_ID_TP_GRP_FK` FOREIGN KEY (`ID_TP_GRUPO`) REFERENCES `cp_tipo_grupo` (`ID_TP_GRUPO`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_grupo`
+--
+
+LOCK TABLES `cp_grupo` WRITE;
+/*!40000 ALTER TABLE `cp_grupo` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_grupo` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_identidade`
+--
+
+DROP TABLE IF EXISTS `cp_identidade`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_identidade` (
+  `ID_IDENTIDADE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_TP_IDENTIDADE` INT UNSIGNED DEFAULT NULL,
+  `ID_PESSOA` INT UNSIGNED DEFAULT NULL,
+  `DATA_CRIACAO_IDENTIDADE` datetime DEFAULT NULL,
+  `DATA_EXPIRACAO_IDENTIDADE` datetime DEFAULT NULL,
+  `DATA_CANCELAMENTO_IDENTIDADE` datetime DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
+  `LOGIN_IDENTIDADE` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SENHA_IDENTIDADE` varchar(40) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SENHA_IDENTIDADE_CRIPTO` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SENHA_IDENTIDADE_CRIPTO_SINC` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_DT_INI` datetime NOT NULL,
+  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_DT_FIM` datetime DEFAULT NULL,
+  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
+  `HIS_ATIVO` tinyint(4) NOT NULL,
+  PRIMARY KEY (`ID_IDENTIDADE`),
+  KEY `CP_IDENT_CPORGUSU_ID_ORGUSU_FK` (`ID_ORGAO_USU`),
+  KEY `CP_IDENT_CP_IDENT_IDC_FIM_FK` (`HIS_IDC_FIM`),
+  KEY `CP_IDENT_CP_IDENT_IDC_INI_FK` (`HIS_IDC_INI`),
+  KEY `CP_IDENT_CP_IDENT_ID_INI_FK` (`HIS_ID_INI`),
+  KEY `CP_IDENT_DP_PESS_ID_PESS_FK` (`ID_PESSOA`),
+  KEY `IDX_LOGIN_IDENTIDADE` (`LOGIN_IDENTIDADE`),
+  CONSTRAINT `CP_IDENT_CPORGUSU_ID_ORGUSU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `CP_IDENT_CP_IDENT_IDC_FIM_FK` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_IDENT_CP_IDENT_IDC_INI_FK` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_IDENT_CP_IDENT_ID_INI_FK` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `CP_IDENT_CP_TPIDT_ID_TP_IDT_FK` FOREIGN KEY (`ID_TP_IDENTIDADE`) REFERENCES `cp_tipo_identidade` (`ID_TP_IDENTIDADE`),
+  CONSTRAINT `CP_IDENT_DP_PESS_ID_PESS_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
+) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_identidade`
+--
+
+LOCK TABLES `cp_identidade` WRITE;
+/*!40000 ALTER TABLE `cp_identidade` DISABLE KEYS */;
+INSERT INTO `cp_identidade` (
+ `ID_IDENTIDADE`,
+  `ID_TP_IDENTIDADE` ,
+  `ID_PESSOA` ,
+  `DATA_CRIACAO_IDENTIDADE` ,
+  `DATA_EXPIRACAO_IDENTIDADE` ,
+  `DATA_CANCELAMENTO_IDENTIDADE` ,
+  `ID_ORGAO_USU` ,
+  `LOGIN_IDENTIDADE` ,
+  `SENHA_IDENTIDADE` ,
+  `SENHA_IDENTIDADE_CRIPTO` ,
+  `SENHA_IDENTIDADE_CRIPTO_SINC` ,
+  `HIS_ID_INI` ,
+  `HIS_DT_INI` ,
+  `HIS_IDC_INI` ,
+  `HIS_DT_FIM`,
+  `HIS_IDC_FIM` ,
+  `HIS_ATIVO`
+  ) 
+  VALUES (1,1,1,'2011-10-26 00:00:00',NULL,NULL,999999999,'ZZ99999','2ac9cb7dc02b3c0083eb70898e549b63','I20BhBeI7KavVeWdbIa8+g==','I20BhBeI7KavVeWdbIa8+g==',1,'2011-10-26 00:00:00',1,NULL,NULL,1),
+         (2,1,2,'2011-10-26 00:00:00',NULL,NULL,999999999,'ZZ99998','2ac9cb7dc02b3c0083eb70898e549b63','I20BhBeI7KavVeWdbIa8+g==','I20BhBeI7KavVeWdbIa8+g==',2,'2011-10-26 00:00:00',1,NULL,NULL,1),
+         (3,1,3,'2011-10-26 00:00:00',NULL,NULL,999999999,'ZZ99997','2ac9cb7dc02b3c0083eb70898e549b63','I20BhBeI7KavVeWdbIa8+g==','I20BhBeI7KavVeWdbIa8+g==',3,'2011-10-26 00:00:00',1,NULL,NULL,1);
+/*!40000 ALTER TABLE `cp_identidade` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_localidade`
+--
+
+DROP TABLE IF EXISTS `cp_localidade`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_localidade` (
+  `ID_LOCALIDADE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NM_LOCALIDADE` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `ID_UF` INT UNSIGNED NOT NULL,
+  PRIMARY KEY (`ID_LOCALIDADE`),
+  UNIQUE KEY `LOCALIDADE_FK` (`ID_LOCALIDADE`),
+  KEY `UF_LOCALIDADE_FK` (`ID_UF`),
+  CONSTRAINT `UF_LOCALIDADE_FK` FOREIGN KEY (`ID_UF`) REFERENCES `cp_uf` (`ID_UF`)
+) ENGINE=InnoDB AUTO_INCREMENT=672 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_localidade`
+--
+
+LOCK TABLES `cp_localidade` WRITE;
+/*!40000 ALTER TABLE `cp_localidade` DISABLE KEYS */;
+INSERT INTO `cp_localidade` VALUES (1,'Angra dos Reis',19),
+(2,'Barra do Piraí',19),
+(3,'Cachoeiro do Itapemirim',8),
+(4,'Campos',19),
+(5,'Duque de Caxias',19),
+(6,'Itaboraí',19),
+(7,'Itaperuna',19),
+(8,'Macaé',19),
+(9,'Magé',19),
+(10,'Niterói',19),
+(11,'Nova Friburgo',19),
+(12,'Nova Iguaçu',19),
+(13,'Petrópolis',19),
+(14,'Resende',19),
+(15,'Rio de Janeiro',19),
+(16,'São Gonçalo',19),
+(17,'São João de Meriti',19),
+(18,'São Mateus',8),
+(19,'São Pedro da Aldeia',19),
+(20,'Teresópolis',19),
+(21,'Três Rios',19),
+(22,'Vitória',8),
+(23,'Volta Redonda',19),
+(24,'Campo Grande',19),
+(25,'São Paulo',26),
+(26,'Adamantina',26),
+(27,'Adolfo',26),
+(28,'Aguaí',26),
+(29,'Águas da Prata',26),
+(30,'Águas de Lindóia',26),
+(31,'Águas de Santa Bárbara',26),
+(32,'Águas de São Pedro',26),
+(33,'Agudos',26),
+(34,'Alambari',26),
+(35,'Alfredo Marcondes',26),
+(36,'Altair',26),
+(37,'Altinópolis',26),
+(38,'Alto Alegre',26),
+(39,'Alumínio',26),
+(40,'Álvares Florence',26),
+(41,'Álvares Machado',26),
+(42,'Álvaro de Carvalho',26),
+(43,'Alvinlândia',26),
+(44,'Americana',26),
+(45,'Américo Brasiliense',26),
+(46,'Américo de Campos',26),
+(47,'Amparo',26),
+(48,'Analândia',26),
+(49,'Andradina',26),
+(50,'Angatuba',26),
+(51,'Anhembi',26),
+(52,'Anhumas',26),
+(53,'Aparecida',26),
+(54,'Aparecida d\'Oeste',26),
+(55,'Apiaí',26),
+(56,'Araçariguama',26),
+(57,'Araçatuba',26),
+(58,'Araçoiaba da Serra',26),
+(59,'Aramina',26),
+(60,'Arandu',26),
+(61,'Arapeí',26),
+(62,'Araraquara',26),
+(63,'Araras',26),
+(64,'Arco-Íris',26),
+(65,'Arealva',26),
+(66,'Areias',26),
+(67,'Areiópolis',26),
+(68,'Ariranha',26),
+(69,'Artur Nogueira',26),
+(70,'Arujá',26),
+(71,'Aspásia',26),
+(72,'Assis',26),
+(73,'Atibaia',26),
+(74,'Auriflama',26),
+(75,'Avaí',26),
+(76,'Avanhandava',26),
+(77,'Avaré',26),
+(78,'Bady Bassitt',26),
+(79,'Balbinos',26),
+(80,'Bálsamo',26),
+(81,'Bananal',26),
+(82,'Barão de Antonina',26),
+(83,'Barbosa',26),
+(84,'Bariri',26),
+(85,'Barra Bonita',26),
+(86,'Barra do Chapéu',26),
+(87,'Barra do Turvo',26),
+(88,'Barretos',26),
+(89,'Barrinha',26),
+(90,'Barueri',26),
+(91,'Bastos',26),
+(92,'Batatais',26),
+(93,'Bauru',26),
+(94,'Bebedouro',26),
+(95,'Bento de Abreu',26),
+(96,'Bernardino de Campos',26),
+(97,'Bertioga',26),
+(98,'Bilac',26),
+(99,'Birigui',26),
+(100,'Biritiba-Mirim',26),
+(101,'Boa Esperança do Sul',26),
+(102,'Bocaina',26),
+(103,'Bofete',26),
+(104,'Boituva',26),
+(105,'Bom Jesus dos Perdões',26),
+(106,'Bom Sucesso de Itararé',26),
+(107,'Borá',26),
+(108,'Boracéia',26),
+(109,'Borborema',26),
+(110,'Borebi',26),
+(111,'Botucatu',26),
+(112,'Bragança Paulista',26),
+(113,'Braúna',26),
+(114,'Brejo Alegre',26),
+(115,'Brodowski',26),
+(116,'Brotas',26),
+(117,'Buri',26),
+(118,'Buritama',26),
+(119,'Buritizal',26),
+(120,'Cabrália Paulista',26),
+(121,'Cabreúva',26),
+(122,'Caçapava',26),
+(123,'Cachoeira Paulista',26),
+(124,'Caconde',26),
+(125,'Cafelândia',26),
+(126,'Caiabu',26),
+(127,'Caieiras',26),
+(128,'Caiuá',26),
+(129,'Cajamar',26),
+(130,'Cajati',26),
+(131,'Cajobi',26),
+(132,'Cajuru',26),
+(133,'Campina do Monte Alegre',26),
+(134,'Campinas',26),
+(135,'Campo Limpo Paulista',26),
+(136,'Campos do Jordão',26),
+(137,'Campos Novos Paulista',26),
+(138,'Cananéia',26),
+(139,'Canas',26),
+(140,'Cândido Mota',26),
+(141,'Cândido Rodrigues',26),
+(142,'Canitar',26),
+(143,'Capão Bonito',26),
+(144,'Capela do Alto',26),
+(145,'Capivari',26),
+(146,'Caraguatatuba',26),
+(147,'Carapicuíba',26),
+(148,'Cardoso',26),
+(149,'Casa Branca',26),
+(150,'Cássia dos Coqueiros',26),
+(151,'Castilho',26),
+(152,'Catanduva',26),
+(153,'Catiguá',26),
+(154,'Cedral',26),
+(155,'Cerqueira César',26),
+(156,'Cerquilho',26),
+(157,'Cesário Lange',26),
+(158,'Charqueada',26),
+(159,'Chavantes',26),
+(160,'Clementina',26),
+(161,'Colina',26),
+(162,'Colômbia',26),
+(163,'Conchal',26),
+(164,'Conchas',26),
+(165,'Cordeirópolis',26),
+(166,'Coroados',26),
+(167,'Coronel Macedo',26),
+(168,'Corumbataí',26),
+(169,'Cosmópolis',26),
+(170,'Cosmorama',26),
+(171,'Cotia',26),
+(172,'Cravinhos',26),
+(173,'Cristais Paulista',26),
+(174,'Cruzália',26),
+(175,'Cruzeiro',26),
+(176,'Cubatão',26),
+(177,'Cunha',26),
+(178,'Descalvado',26),
+(179,'Diadema',26),
+(180,'Dirce Reis',26),
+(181,'Divinolândia',26),
+(182,'Dobrada',26),
+(183,'Dois Córregos',26),
+(184,'Dolcinópolis',26),
+(185,'Dourado',26),
+(186,'Dracena',26),
+(187,'Duartina',26),
+(188,'Dumont',26),
+(189,'Echaporã',26),
+(190,'Eldorado',26),
+(191,'Elias Fausto',26),
+(192,'Elisiário',26),
+(193,'Embaúba',26),
+(194,'Embu',26),
+(195,'Embu-Guaçu',26),
+(196,'Emilianópolis',26),
+(197,'Engenheiro Coelho',26),
+(198,'Espírito Santo do Pinhal',26),
+(199,'Espírito Santo do Turvo',26),
+(200,'Estiva Gerbi',26),
+(201,'Estrela do Norte',26),
+(202,'Estrela d\'Oeste',26),
+(203,'Euclides da Cunha Paulista',26),
+(204,'Fartura',26),
+(205,'Fernando Prestes',26),
+(206,'Fernandópolis',26),
+(207,'Fernão',26),
+(208,'Ferraz de Vasconcelos',26),
+(209,'Flora Rica',26),
+(210,'Floreal',26),
+(211,'Flórida Paulista',26),
+(212,'Florínia',26),
+(213,'Franca',26),
+(214,'Francisco Morato',26),
+(215,'Franco da Rocha',26),
+(216,'Gabriel Monteiro',26),
+(217,'Gália',26),
+(218,'Garça',26),
+(219,'Gastão Vidigal',26),
+(220,'Gavião Peixoto',26),
+(221,'General Salgado',26),
+(222,'Getulina',26),
+(223,'Glicério',26),
+(224,'Guaiçara',26),
+(225,'Guaimbê',26),
+(226,'Guaíra',26),
+(227,'Guapiaçu',26),
+(228,'Guapiara',26),
+(229,'Guará',26),
+(230,'Guaraçaí',26),
+(231,'Guaraci',26),
+(232,'Guarani d\'Oeste',26),
+(233,'Guarantã',26),
+(234,'Guararapes',26),
+(235,'Guararema',26),
+(236,'Guaratinguetá',26),
+(237,'Guareí',26),
+(238,'Guariba',26),
+(239,'Guarujá',26),
+(240,'Guarulhos',26),
+(241,'Guatapará',26),
+(242,'Guzolândia',26),
+(243,'Herculândia',26),
+(244,'Holambra',26),
+(245,'Hortolândia',26),
+(246,'Iacanga',26),
+(247,'Iacri',26),
+(248,'Iaras',26),
+(249,'Ibaté',26),
+(250,'Ibirá',26),
+(251,'Ibirarema',26),
+(252,'Ibitinga',26),
+(253,'Ibiúna',26),
+(254,'Icém',26),
+(255,'Iepê',26),
+(256,'Igaraçu do Tietê',26),
+(257,'Igarapava',26),
+(258,'Igaratá',26),
+(259,'Iguape',26),
+(260,'Ilha Comprida',26),
+(261,'Ilha Solteira',26),
+(262,'Ilhabela',26),
+(263,'Indaiatuba',26),
+(264,'Indiana',26),
+(265,'Indiaporã',26),
+(266,'Inúbia Paulista',26),
+(267,'Ipaussu',26),
+(268,'Iperó',26),
+(269,'Ipeúna',26),
+(270,'Ipiguá',26),
+(271,'Iporanga',26),
+(272,'Ipuã',26),
+(273,'Iracemápolis',26),
+(274,'Irapuã',26),
+(275,'Irapuru',26),
+(276,'Itaberá',26),
+(277,'Itaí',26),
+(278,'Itajobi',26),
+(279,'Itaju',26),
+(280,'Itanhaém',26),
+(281,'Itaóca',26),
+(282,'Itapecerica da Serra',26),
+(283,'Itapetininga',26),
+(284,'Itapeva',26),
+(285,'Itapevi',26),
+(286,'Itapira',26),
+(287,'Itapirapuã Paulista',26),
+(288,'Itápolis',26),
+(289,'Itaporanga',26),
+(290,'Itapuí',26),
+(291,'Itapura',26),
+(292,'Itaquaquecetuba',26),
+(293,'Itararé',26),
+(294,'Itariri',26),
+(295,'Itatiba',26),
+(296,'Itatinga',26),
+(297,'Itirapina',26),
+(298,'Itirapuã',26),
+(299,'Itobi',26),
+(300,'Itu',26),
+(301,'Itupeva',26),
+(302,'Ituverava',26),
+(303,'Jaborandi',26),
+(304,'Jaboticabal',26),
+(305,'Jacareí',26),
+(306,'Jaci',26),
+(307,'Jacupiranga',26),
+(308,'Jaguariúna',26),
+(309,'Jales',26),
+(310,'Jambeiro',26),
+(311,'Jandira',26),
+(312,'Jardinópolis',26),
+(313,'Jarinu',26),
+(314,'Jaú',26),
+(315,'Jeriquara',26),
+(316,'Joanópolis',26),
+(317,'João Ramalho',26),
+(318,'José Bonifácio',26),
+(319,'Júlio Mesquita',26),
+(320,'Jumirim',26),
+(321,'Jundiaí',26),
+(322,'Junqueirópolis',26),
+(323,'Juquiá',26),
+(324,'Juquitiba',26),
+(325,'Lagoinha',26),
+(326,'Laranjal Paulista',26),
+(327,'Lavínia',26),
+(328,'Lavrinhas',26),
+(329,'Leme',26),
+(330,'Lençóis Paulista',26),
+(331,'Limeira',26),
+(332,'Lindóia',26),
+(333,'Lins',26),
+(334,'Lorena',26),
+(335,'Lourdes',26),
+(336,'Louveira',26),
+(337,'Lucélia',26),
+(338,'Lucianópolis',26),
+(339,'Luís Antônio',26),
+(340,'Luiziânia',26),
+(341,'Lupércio',26),
+(342,'Lutécia',26),
+(343,'Macatuba',26),
+(344,'Macaubal',26),
+(345,'Macedônia',26),
+(346,'Magda',26),
+(347,'Mairinque',26),
+(348,'Mairiporã',26),
+(349,'Manduri',26),
+(350,'Marabá Paulista',26),
+(351,'Maracaí',26),
+(352,'Marapoama',26),
+(353,'Mariápolis',26),
+(354,'Marília',26),
+(355,'Marinópolis',26),
+(356,'Martinópolis',26),
+(357,'Matão',26),
+(358,'Mauá',26),
+(359,'Mendonça',26),
+(360,'Meridiano',26),
+(361,'Mesópolis',26),
+(362,'Miguelópolis',26),
+(363,'Mineiros do Tietê',26),
+(364,'Mira Estrela',26),
+(365,'Miracatu',26),
+(366,'Mirandópolis',26),
+(367,'Mirante do Paranapanema',26),
+(368,'Mirassol',26),
+(369,'Mirassolândia',26),
+(370,'Mococa',26),
+(371,'Mogi das Cruzes',26),
+(372,'Mogi Guaçu',26),
+(373,'Moji Mirim',26),
+(374,'Mombuca',26),
+(375,'Monções',26),
+(376,'Mongaguá',26),
+(377,'Monte Alegre do Sul',26),
+(378,'Monte Alto',26),
+(379,'Monte Aprazível',26),
+(380,'Monte Azul Paulista',26),
+(381,'Monte Castelo',26),
+(382,'Monte Mor',26),
+(383,'Monteiro Lobato',26),
+(384,'Morro Agudo',26),
+(385,'Morungaba',26),
+(386,'Motuca',26),
+(387,'Murutinga do Sul',26),
+(388,'Nantes',26),
+(389,'Narandiba',26),
+(390,'Natividade da Serra',26),
+(391,'Nazaré Paulista',26),
+(392,'Neves Paulista',26),
+(393,'Nhandeara',26),
+(394,'Nipoã',26),
+(395,'Nova Aliança',26),
+(396,'Nova Campina',26),
+(397,'Nova Canaã Paulista',26),
+(398,'Nova Castilho',26),
+(399,'Nova Europa',26),
+(400,'Nova Granada',26),
+(401,'Nova Guataporanga',26),
+(402,'Nova Independência',26),
+(403,'Nova Luzitânia',26),
+(404,'Nova Odessa',26),
+(405,'Novais',26),
+(406,'Novo Horizonte',26),
+(407,'Nuporanga',26),
+(408,'Ocauçu',26),
+(409,'Óleo',26),
+(410,'Olímpia',26),
+(411,'Onda Verde',26),
+(412,'Oriente',26),
+(413,'Orindiúva',26),
+(414,'Orlândia',26),
+(415,'Osasco',26),
+(416,'Oscar Bressane',26),
+(417,'Osvaldo Cruz',26),
+(418,'Ourinhos',26),
+(419,'Ouro Verde',26),
+(420,'Ouroeste',26),
+(421,'Pacaembu',26),
+(422,'Palestina',26),
+(423,'Palmares Paulista',26),
+(424,'Palmeira d\'Oeste',26),
+(425,'Palmital',26),
+(426,'Panorama',26),
+(427,'Paraguaçu Paulista',26),
+(428,'Paraibuna',26),
+(429,'Paraíso',26),
+(430,'Paranapanema',26),
+(431,'Paranapuã',26),
+(432,'Parapuã',26),
+(433,'Pardinho',26),
+(434,'Pariquera-Açu',26),
+(435,'Parisi',26),
+(436,'Patrocínio Paulista',26),
+(437,'Paulicéia',26),
+(438,'Paulínia',26),
+(439,'Paulistânia',26),
+(440,'Paulo de Faria',26),
+(441,'Pederneiras',26),
+(442,'Pedra Bela',26),
+(443,'Pedranópolis',26),
+(444,'Pedregulho',26),
+(445,'Pedreira',26),
+(446,'Pedrinhas Paulista',26),
+(447,'Pedro de Toledo',26),
+(448,'Penápolis',26),
+(449,'Pereira Barreto',26),
+(450,'Pereiras',26),
+(451,'Peruíbe',26),
+(452,'Piacatu',26),
+(453,'Piedade',26),
+(454,'Pilar do Sul',26),
+(455,'Pindamonhangaba',26),
+(456,'Pindorama',26),
+(457,'Pinhalzinho',26),
+(458,'Piquerobi',26),
+(459,'Piquete',26),
+(460,'Piracaia',26),
+(461,'Piracicaba',26),
+(462,'Piraju',26),
+(463,'Pirajuí',26),
+(464,'Pirangi',26),
+(465,'Pirapora do Bom Jesus',26),
+(466,'Pirapozinho',26),
+(467,'Pirassununga',26),
+(468,'Piratininga',26),
+(469,'Pitangueiras',26),
+(470,'Planalto',26),
+(471,'Platina',26),
+(472,'Poá',26),
+(473,'Poloni',26),
+(474,'Pompéia',26),
+(475,'Pongaí',26),
+(476,'Pontal',26),
+(477,'Pontalinda',26),
+(478,'Pontes Gestal',26),
+(479,'Populina',26),
+(480,'Porangaba',26),
+(481,'Porto Feliz',26),
+(482,'Porto Ferreira',26),
+(483,'Potim',26),
+(484,'Potirendaba',26),
+(485,'Pracinha',26),
+(486,'Pradópolis',26),
+(487,'Praia Grande',26),
+(488,'Pratânia',26),
+(489,'Presidente Alves',26),
+(490,'Presidente Bernardes',26),
+(491,'Presidente Epitácio',26),
+(492,'Presidente Prudente',26),
+(493,'Presidente Venceslau',26),
+(494,'Promissão',26),
+(495,'Quadra',26),
+(496,'Quatá',26),
+(497,'Queiroz',26),
+(498,'Queluz',26),
+(499,'Quintana',26),
+(500,'Rafard',26),
+(501,'Rancharia',26),
+(502,'Redenção da Serra',26),
+(503,'Regente Feijó',26),
+(504,'Reginópolis',26),
+(505,'Registro',26),
+(506,'Restinga',26),
+(507,'Ribeira',26),
+(508,'Ribeirão Bonito',26),
+(509,'Ribeirão Branco',26),
+(510,'Ribeirão Corrente',26),
+(511,'Ribeirão do Sul',26),
+(512,'Ribeirão dos Índios',26),
+(513,'Ribeirão Grande',26),
+(514,'Ribeirão Pires',26),
+(515,'Ribeirão Preto',26),
+(516,'Rifaina',26),
+(517,'Rincão',26),
+(518,'Rinópolis',26),
+(519,'Rio Claro',26),
+(520,'Rio das Pedras',26),
+(521,'Rio Grande da Serra',26),
+(522,'Riolândia',26),
+(523,'Riversul',26),
+(524,'Rosana',26),
+(525,'Roseira',26),
+(526,'Rubiácea',26),
+(527,'Rubinéia',26),
+(528,'Sabino',26),
+(529,'Sagres',26),
+(530,'Sales',26),
+(531,'Sales Oliveira',26),
+(532,'Salesópolis',26),
+(533,'Salmourão',26),
+(534,'Saltinho',26),
+(535,'Salto',26),
+(536,'Salto de Pirapora',26),
+(537,'Salto Grande',26),
+(538,'Sandovalina',26),
+(539,'Santa Adélia',26),
+(540,'Santa Albertina',26),
+(541,'Santa Bárbara d\'Oeste',26),
+(542,'Santa Branca',26),
+(543,'Santa Clara d\'Oeste',26),
+(544,'Santa Cruz da Conceição',26),
+(545,'Santa Cruz da Esperança',26),
+(546,'Santa Cruz das Palmeiras',26),
+(547,'Santa Cruz do Rio Pardo',26),
+(548,'Santa Ernestina',26),
+(549,'Santa Fé do Sul',26),
+(550,'Santa Gertrudes',26),
+(551,'Santa Isabel',26),
+(552,'Santa Lúcia',26),
+(553,'Santa Maria da Serra',26),
+(554,'Santa Mercedes',26),
+(555,'Santa Rita do Passa Quatro',26),
+(556,'Santa Rita d\'Oeste',26),
+(557,'Santa Rosa de Viterbo',26),
+(558,'Santa Salete',26),
+(559,'Santana da Ponte Pensa',26),
+(560,'Santana de Parnaíba',26),
+(561,'Santo Anastácio',26),
+(562,'Santo André',26),
+(563,'Santo Antônio da Alegria',26),
+(564,'Santo Antônio de Posse',26),
+(565,'Santo Antônio do Aracanguá',26),
+(566,'Santo Antônio do Jardim',26),
+(567,'Santo Antônio do Pinhal',26),
+(568,'Santo Expedito',26),
+(569,'Santópolis do Aguapeí',26),
+(570,'Santos',26),
+(571,'São Bento do Sapucaí',26),
+(572,'São Bernardo do Campo',26),
+(573,'São Caetano do Sul',26),
+(574,'São Carlos',26),
+(575,'São Francisco',26),
+(576,'São João da Boa Vista',26),
+(577,'São João das Duas Pontes',26),
+(578,'São João de Iracema',26),
+(579,'São João do Pau d\'Alho',26),
+(580,'São Joaquim da Barra',26),
+(581,'São José da Bela Vista',26),
+(582,'São José do Barreiro',26),
+(583,'São José do Rio Pardo',26),
+(584,'São José do Rio Preto',26),
+(585,'São José dos Campos',26),
+(586,'São Lourenço da Serra',26),
+(587,'São Luís do Paraitinga',26),
+(588,'São Manuel',26),
+(589,'São Miguel Arcanjo',26),
+(591,'São Pedro',26),
+(592,'São Pedro do Turvo',26),
+(593,'São Roque',26),
+(594,'São Sebastião',26),
+(595,'São Sebastião da Grama',26),
+(596,'São Simão',26),
+(597,'São Vicente',26),
+(598,'Sarapuí',26),
+(599,'Sarutaiá',26),
+(600,'Sebastianópolis do Sul',26),
+(601,'Serra Azul',26),
+(602,'Serra Negra',26),
+(603,'Serrana',26),
+(604,'Sertãozinho',26),
+(605,'Sete Barras',26),
+(606,'Severínia',26),
+(607,'Silveiras',26),
+(608,'Socorro',26),
+(609,'Sorocaba',26),
+(610,'Sud Mennucci',26),
+(611,'Sumaré',26),
+(612,'Suzanápolis',26),
+(613,'Suzano',26),
+(614,'Tabapuã',26),
+(615,'Tabatinga',26),
+(616,'Taboão da Serra',26),
+(617,'Taciba',26),
+(618,'Taguaí',26),
+(619,'Taiaçu',26),
+(620,'Taiúva',26),
+(621,'Tambaú',26),
+(622,'Tanabi',26),
+(623,'Tapiraí',26),
+(624,'Tapiratiba',26),
+(625,'Taquaral',26),
+(626,'Taquaritinga',26),
+(627,'Taquarituba',26),
+(628,'Taquarivaí',26),
+(629,'Tarabai',26),
+(630,'Tarumã',26),
+(631,'Tatuí',26),
+(632,'Taubaté',26),
+(633,'Tejupá',26),
+(634,'Teodoro Sampaio',26),
+(635,'Terra Roxa',26),
+(636,'Tietê',26),
+(637,'Timburi',26),
+(638,'Torre de Pedra',26),
+(639,'Torrinha',26),
+(640,'Trabiju',26),
+(641,'Tremembé',26),
+(642,'Três Fronteiras',26),
+(643,'Tuiuti',26),
+(644,'Tupã',26),
+(645,'Tupi Paulista',26),
+(646,'Turiúba',26),
+(647,'Turmalina',26),
+(648,'Ubarana',26),
+(649,'Ubatuba',26),
+(650,'Ubirajara',26),
+(651,'Uchoa',26),
+(652,'União Paulista',26),
+(653,'Urânia',26),
+(654,'Uru',26),
+(655,'Urupês',26),
+(656,'Valentim Gentil',26),
+(657,'Valinhos',26),
+(658,'Valparaíso',26),
+(659,'Vargem',26),
+(660,'Vargem Grande do Sul',26),
+(661,'Vargem Grande Paulista',26),
+(662,'Várzea Paulista',26),
+(663,'Vera Cruz',26),
+(664,'Vinhedo',26),
+(665,'Viradouro',26),
+(666,'Vista Alegre do Alto',26),
+(667,'Vitória Brasil',26),
+(668,'Votorantim',26),
+(669,'Votuporanga',26),
+(670,'Zacarias',26),
+(671,'Campo Grande',19);
+/*!40000 ALTER TABLE `cp_localidade` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_marca`
+--
+
+DROP TABLE IF EXISTS `cp_marca`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_marca` (
+  `ID_MARCA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DT_INI_MARCA` datetime DEFAULT NULL,
+  `DT_FIM_MARCA` datetime DEFAULT NULL,
+  `ID_MARCADOR` INT UNSIGNED DEFAULT NULL,
+  `ID_PESSOA_INI` INT UNSIGNED DEFAULT NULL,
+  `ID_LOTACAO_INI` INT UNSIGNED DEFAULT NULL,
+  `ID_MOBIL` INT UNSIGNED DEFAULT NULL,
+  `ID_TP_MARCA` INT UNSIGNED DEFAULT NULL,
+  `ID_REF` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_MARCA`),
+  KEY `LOTACAO` (`ID_LOTACAO_INI`),
+  KEY `PESSOA` (`ID_PESSOA_INI`),
+  KEY `CP_MARCA_IDX_004` (`ID_REF`),
+  KEY `ID_MARCADOR` (`ID_MARCADOR`),
+  KEY `ID_TP_MARCA` (`ID_TP_MARCA`),
+  KEY `ID_MOBIL` (`ID_MOBIL`),
+  CONSTRAINT `cp_marca_ibfk_1` FOREIGN KEY (`ID_MARCADOR`) REFERENCES `cp_marcador` (`ID_MARCADOR`),
+  CONSTRAINT `cp_marca_ibfk_2` FOREIGN KEY (`ID_PESSOA_INI`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
+  CONSTRAINT `cp_marca_ibfk_3` FOREIGN KEY (`ID_LOTACAO_INI`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
+  CONSTRAINT `cp_marca_ibfk_4` FOREIGN KEY (`ID_TP_MARCA`) REFERENCES `cp_tipo_marca` (`ID_TP_MARCA`),
+  CONSTRAINT `cp_marca_ibfk_5` FOREIGN KEY (`ID_MOBIL`) REFERENCES `siga`.`ex_mobil` (`ID_MOBIL`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_marca`
+--
+
+LOCK TABLES `cp_marca` WRITE;
+/*!40000 ALTER TABLE `cp_marca` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_marca` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_marcador`
+--
+
+DROP TABLE IF EXISTS `cp_marcador`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_marcador` (
+  `ID_MARCADOR` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESCR_MARCADOR` varchar(40) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_TP_MARCADOR` INT UNSIGNED DEFAULT NULL,
+  `ORD_MARCADOR` int(11) DEFAULT NULL,
+  PRIMARY KEY (`ID_MARCADOR`),
+  KEY `ID_TP_MARCADOR` (`ID_TP_MARCADOR`),
+  CONSTRAINT `cp_marcador_ibfk_1` FOREIGN KEY (`ID_TP_MARCADOR`) REFERENCES `cp_tipo_marcador` (`ID_TP_MARCADOR`)
+) ENGINE=InnoDB AUTO_INCREMENT=1003 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_marcador`
+--
+
+LOCK TABLES `cp_marcador` WRITE;
+/*!40000 ALTER TABLE `cp_marcador` DISABLE KEYS */;
+INSERT INTO `cp_marcador` VALUES (1,'Em Elaboração',1,10),
+(2,'Aguardando Andamento',1,140),
+(3,'A Receber (Físico)',1,90),
+(4,'Extraviado',1,NULL),
+(5,'A Arquivar',1,NULL),
+(6,'Arquivo Corrente',1,200),
+(7,'A Eliminar',1,230),
+(8,'Eliminado',1,NULL),
+(9,'Juntado',1,NULL),
+(10,'Cancelado',1,NULL),
+(11,'Transferido para Órgão Externo',1,NULL),
+(12,'Arquivo Intermediário',1,NULL),
+(13,'Arquivo Permanente',1,NULL),
+(14,'Caixa de Entrada (Digital)',1,80),
+(15,'Pendente de Assinatura',1,40),
+(16,'Juntado a Documento Externo',1,NULL),
+(18,'Remetido para Publicação',1,NULL),
+(20,'Publicado',1,NULL),
+(21,'Publicação solicitada',1,NULL),
+(22,'Disponibilizado',1,NULL),
+(23,'Transferido',1,170),
+(24,'Transferido (Digital)',1,180),
+(25,'Como Subscritor',1,30),
+(26,'Apensado',1,NULL),
+(27,'Como Gestor',1,150),
+(28,'Como Interessado',1,160),
+(29,'Despacho Pendente de Assinatura',1,70),
+(30,'Anexo Pendente Assinatura/Conferência',1,60),
+(31,'Sobrestado',1,190),
+(32,'Sem Efeito',1,NULL),
+(36,'Ativo',1,NULL),
+(37,'Novo',1,NULL),
+(38,'Popular',1,NULL),
+(39,'Revisar',1,NULL),
+(40,'Tomar Ciência',1,NULL),
+(41,'A Receber',1,NULL),
+(42,'Em Andamento',1,NULL),
+(43,'Fechado',1,NULL),
+(44,'Pendente',1,NULL),
+(45,'Cancelado',1,NULL),
+(46,'Em Pré-atendimento',1,NULL),
+(47,'Em Pós-atendimento',1,NULL),
+(48,'Como cadastrante',1,NULL),
+(49,'Como solicitante',1,NULL),
+(50,'A Recolher para Arq. Permanente',1,220),
+(51,'A Transferir para Arq. Intermediário',1,210),
+(52,'Em Edital de Eliminação',1,240),
+(53,'A Fechar',1,NULL),
+(54,'Em Controle de Qualidade',1,NULL),
+(55,'Agendado',1,NULL),
+(56,'A devolver',1,100),
+(57,'Aguardando devolução',1,120),
+(58,'A devolver (Fora do prazo)',1,110),
+(59,'Aguardando devolução (Fora do prazo)',1,130),
+(60,'Pendente de Anexação',1,NULL),
+(61,'Em Elabora?',1,NULL),
+(62,'Documento Assinado com Senha',1,NULL),
+(63,'Movimentação Assinada com Senha',1,NULL),
+(64,'Movimentação Conferida com Senha',1,NULL),
+(65,'Fora do Prazo',1,NULL),
+(66,'Ativo',1,NULL),
+(67,'Elaborar Parte de Documento Colaborativo',1,5),
+(68,'Finalizar Documento Colaborativo',1,6),
+(69,'Necessita Providência',1,NULL),
+(70,'Como Executor',1,NULL),
+(71,'Pronto para Assinar',2,25),
+(72,'Como Revisor',2,25),
+(300,'A Receber',1,NULL),
+(301,'Em Andamento',1,NULL),
+(302,'Fechado',1,NULL),
+(303,'Pendente',1,NULL),
+(304,'Cancelado',1,NULL),
+(305,'Em Pré-atendimento',1,NULL),
+(306,'Em Pós-atendimento',1,NULL),
+(307,'Como cadastrante',1,NULL),
+(308,'Como solicitante',1,NULL),
+(1000,'Urgente',2,NULL),
+(1001,'Idoso',2,NULL),
+(1002,'Retenção de INSS',2,NULL);
+/*!40000 ALTER TABLE `cp_marcador` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_arquivo`
+--
+
+DROP TABLE IF EXISTS `cp_arquivo`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_arquivo` (
+  `ID_ARQ` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
+  `CONTEUDO_TP_ARQ` VARCHAR(256),
+  PRIMARY KEY (`ID_ARQ`),
+  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
+  CONSTRAINT `cp_arq_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_arquivo`
+--
+
+LOCK TABLES `cp_arquivo` WRITE;
+/*!40000 ALTER TABLE `cp_arquivo` DISABLE KEYS */;
+INSERT INTO `cp_arquivo` VALUES (1,null,'template/freemarker'),
+(2,null,'template/freemarker'),
+(3,null,'template/freemarker'),
+(4,NULL,'template/freemarker'),
+(5,NULL,'template/freemarker'),
+(6,NULL,'template/freemarker'),
+(519,NULL,'template/freemarker'),
+(7,NULL,'template/freemarker'),
+(8,NULL,'template/freemarker'),
+(9,NULL,'template/freemarker'),
+(10,NULL,'template/freemarker');
+/*!40000 ALTER TABLE `cp_arquivo` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_arquivo_blob`
+--
+
+DROP TABLE IF EXISTS `cp_arquivo_blob`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_arquivo_blob` (
+  `ID_ARQ_BLOB` BIGINT UNSIGNED NOT NULL,
+  `CONTEUDO_ARQ_BLOB` LONGBLOB DEFAULT NULL,
+  PRIMARY KEY (`ID_ARQ_BLOB`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_arquivo_blob`
+--
+
+LOCK TABLES `cp_arquivo_blob` WRITE;
+/*!40000 ALTER TABLE `cp_arquivo_blob` DISABLE KEYS */;
+INSERT INTO `cp_arquivo_blob` VALUES (1,' \n[@oficio/]\n'),
+(2,'\n[@entrevista]\n	[@grupo titulo=\"Texto a ser inserido no corpo do memorando\"]\n		[@grupo]\n			[@editor titulo=\"\" var=\"texto_memorando\" /]\n		[/@grupo]\n	[/@grupo]\n	[@grupo]\n	        [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n	[/@grupo]\n	[@grupo]\n       		[@selecao titulo=\"Fecho\" var=\"fecho\" opcoes=\"Atenciosamente;Cordialmente;Respeitosamente\" /]\n	[/@grupo]\n[/@entrevista]\n\n[@documento]\n        [@memorando texto=texto_memorando! fecho=(fecho!)+\",\" tamanhoLetra=tamanhoLetra! /]\n[/@documento]\n'),
+(3,'\n[@entrevista]\n    [@grupo titulo=\"Dados do Documento de Origem\"]\n        [@grupo]\n            [@texto titulo=\"Tipo de documento\" var=\"tipoDeDocumentoOrigem\" largura=20 default=tipoDeDocumentoValue /]\n            [@texto titulo=\"Número\" var=\"numeroOrigem\" largura=20 default=numeroValue /]\n        [/@grupo]\n        [@grupo]\n            [@data titulo=\"Data\" var=\"dataOrigem\" default=dataValue /]\n            [@texto titulo=\"Nome do Órgão\" var=\"orgaoOrigem\" largura=30 default=orgaoValue /]\n        [/@grupo]\n    [/@grupo]\n    [@grupo]\n        [@texto titulo=\"Vocativo\" var=\"vocativo\" largura=\"100\" /]\n    [/@grupo]\n    [@grupo titulo=\"Texto da informação\"]\n        [@editor titulo=\"\" var=\"texto_informacao\" /]\n    [/@grupo]\n    [@grupo]\n        [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n    [/@grupo]\n[/@entrevista]\n\n[@documento margemDireita=\"3cm\"]\n    [#if tamanhoLetra! == \"Normal\"]\n        [#assign tl = \"11pt\" /]\n    [#elseif tamanhoLetra! == \"Pequeno\"]\n        [#assign tl = \"9pt\" /]\n    [#elseif tamanhoLetra! == \"Grande\"]\n        [#assign tl = \"13pt\" /]\n    [#else]     \n        [#assign tl = \"11pt\"]\n    [/#if]\n\n    [@estiloBrasaoCentralizado tipo=\"INFORMAÇÃO\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n        <div style=\"font-family: Arial; font-size: ${tl};\">\n            [#if tipoDeDocumentoOrigem?? && tipoDeDocumentoOrigem != \"\"]\n                Referência: ${tipoDeDocumentoOrigem!} N&ordm; ${numeroOrigem!}, ${dataOrigem!} - ${orgaoOrigem!}.<br/>\n            [/#if]\n            Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${vocativo!}</span></p>\n                <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${texto_informacao}</span></p>\n        </div>\n    [/@estiloBrasaoCentralizado]\n[/@documento]\n'),
+(4,'\n[#-- Se existir uma variável chamada \'texto\' copiar seu valor para \'texto_depacho\', pois a macro vai destruir o conteúdo da variável --]\n[@entrevista]\n  [@grupo titulo=\"Órgão de destino\"]\n    [#assign orgao_dest_atual = (doc.lotaDestinatario.nomeLotacao)!/]\n    [#if orgao_dest_ult! != orgao_dest_atual]\n      [#assign orgao_dest = orgao_dest_atual/]\n      [#assign orgao_dest_ult = orgao_dest_atual/]\n    [/#if]\n    [@oculto var=\"orgao_dest_ult\"/]\n    [@grupo]\n      [@selecao titulo=\"\" var=\"combinacao\" opcoes=\"A(o);À;Ao\" /]\n      [@texto titulo=\"Nome (opcional)\" var=\"orgao_dest\" largura=30 /]\n    [/@grupo]\n  [/@grupo]\n  [@grupo titulo=\"Texto do despacho\"]\n    [@grupo]\n      [#if !texto_padrao??]\n        [#assign texto_padrao = \"Para as providências cabíveis.\"/]\n      [/#if]\n      [@selecao titulo=\"Texto\" opcoes=\"A pedido.;Arquive-se.;Autorizo.;Ciente. Arquive-se.;De acordo.;Expeça-se memorando.;Expeça-se memorando-circular.;Expeça-se ofício-circular.;Intime-se.;Junte-se ao dossiê.;Junte-se ao processo.;Oficie-se.;Para as providências cabíveis.;Para atendimento.;Para atendimento e encaminhamento direto.;Para ciência.;Para publicação.;Para verificar a possibilidade de atendimento.;[Outro]\" var=\"texto_padrao\" reler=true /]\n    [/@grupo]\n  [/@grupo]\n  [@grupo depende=\"textopadrao\" esconder=((texto_padrao!\"\") != \"[Outro]\")]\n    [@editor titulo=\"\" var=\"texto_despacho\" /]\n  [/@grupo]\n  [@grupo]\n    [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n  [/@grupo]\n  [@grupo titulo=\"Dados do Documento de Origem\" esconder=doc.pai??]\n    [#if postback?? && !doc.idDoc?? && doc.pai??]\n      [#assign tipoDeDocumentoValue = doc.pai.descrFormaDoc /]\n      [#assign numeroValue = doc.pai.sigla /]\n      [#assign dataValue = doc.pai.dtDocDDMMYY /]\n      [#assign orgaoValue = doc.pai.orgaoUsuario.acronimoOrgaoUsu /]\n    [#else]\n      [#assign tipoDeDocumentoValue = tipoDeDocumentoOrigem! /]\n      [#assign numeroValue = numeroOrigem! /]\n      [#assign dataValue = dataOrigem! /]\n      [#assign orgaoValue = orgaoOrigem! /]\n    [/#if]\n    [@grupo]\n      [@texto titulo=\"Tipo de documento\" var=\"tipoDeDocumentoOrigem\" largura=20 default=tipoDeDocumentoValue /]\n      [@texto titulo=\"Número\" var=\"numeroOrigem\" largura=20 default=numeroValue /]\n    [/@grupo]\n    [@grupo]\n      [@data titulo=\"Data\" var=\"dataOrigem\" default=dataValue /]\n      [@texto titulo=\"Nome do Órgão\" var=\"orgaoOrigem\" largura=30 default=orgaoValue /]\n    [/@grupo]\n  [/@grupo]\n[/@entrevista]\n[@documento margemDireita=\"3cm\"]\n  [#if param.tamanhoLetra! == \"Normal\"]\n    [#assign tl = \"11pt\" /]\n  [#elseif param.tamanhoLetra! == \"Pequeno\"]\n    [#assign tl = \"9pt\" /]\n  [#elseif param.tamanhoLetra! == \"Grande\"]\n    [#assign tl = \"13pt\" /]\n  [#else]\n    [#assign tl = \"11pt\"/]\n  [/#if]\n  [@estiloBrasaoCentralizado tipo=\"DESPACHO\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n    <div style=\"font-family: Arial; font-size: ${tl};\">\n      [#if tipoDeDocumentoOrigem?? && tipoDeDocumentoOrigem != \"\"]\n        Referência: ${tipoDeDocumentoOrigem!} Nº ${numeroOrigem!}\n        [#if dataOrigem?? && dataOrigem != \"\"]\n          , ${dataOrigem!}\n        [/#if]\n        [#if orgaoOrigem?? && orgaoOrigem != \"\"]\n          - ${orgaoOrigem!}.\n        [/#if]\n        <br />\n      [/#if]\n      Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n    </div>\n    <div style=\"font-family: Arial; font-size: ${tl};\">\n      [#if orgao_dest?? && orgao_dest != \"\"]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl}\">${combinacao} ${orgao_dest!},</span>\n        </p>\n      [#elseif (doc.lotaDestinatario.nomeLotacao)?? && (doc.lotaDestinatario.nomeLotacao) != \"\"]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl}\">${combinacao} ${(doc.lotaDestinatario.nomeLotacao)!},</span>\n        </p>\n      [/#if]\n      [#if (texto_padrao!\"\") != \"[Outro]\"]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl!}\">${texto_padrao!}</span>\n        </p>\n      [#else]\n        <p style=\"TEXT-INDENT: 2cm\">\n          <span style=\"font-size: ${tl!}\">${texto_despacho!}</span>\n        </p>\n      [/#if]\n    </div>\n  [/@estiloBrasaoCentralizado]\n[/@documento]\n'),
+(5,'ELABORE SEU MODELO DE BOLETIM INTERNO NO MENU FERRAMENTAS/CADASTRO DE MODELOS'),
+(6,'\n[@entrevista]\n    [@grupo titulo=\"Dados do Documento de Origem\"]\n        [@grupo]\n            [@texto titulo=\"Tipo de documento\" var=\"tipoDeDocumentoOrigem\" largura=20 default=tipoDeDocumentoValue /]\n            [@texto titulo=\"Número\" var=\"numeroOrigem\" largura=20 default=numeroValue /]\n        [/@grupo]\n        [@grupo]\n            [@data titulo=\"Data\" var=\"dataOrigem\" default=dataValue /]\n            [@texto titulo=\"Nome do Órgão\" var=\"orgaoOrigem\" largura=30 default=orgaoValue /]\n        [/@grupo]\n    [/@grupo]\n    [@grupo]\n        [@texto titulo=\"Vocativo\" var=\"vocativo\" largura=\"100\" /]\n    [/@grupo]\n    [@grupo titulo=\"Texto do Parecer\"]\n        [@editor titulo=\"\" var=\"texto_parecer\" /]\n    [/@grupo]\n    [@grupo]\n        [@selecao titulo=\"Tamanho da letra\" var=\"tamanhoLetra\" opcoes=\"Normal;Pequeno;Grande\" /]\n    [/@grupo]\n[/@entrevista]\n\n[@documento margemDireita=\"3cm\"]\n    [#if param.tamanhoLetra! == \"Normal\"]\n        [#assign tl = \"11pt\" /]\n    [#elseif param.tamanhoLetra! == \"Pequeno\"]\n        [#assign tl = \"9pt\" /]\n    [#elseif param.tamanhoLetra! == \"Grande\"]\n        [#assign tl = \"13pt\" /]\n    [#else]     \n        [#assign tl = \"11pt\"]\n    [/#if]\n\n    [@estiloBrasaoCentralizado tipo=\"PARECER\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n        [#if tipoDeDocumentoOrigem?? && tipoDeDocumentoOrigem != \"\"]\n            Referência: ${tipoDeDocumentoOrigem!} N&ordm; ${numeroOrigem!}, ${dataOrigem!} - ${orgaoOrigem!}.<br/>\n        [/#if]\n        Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n\n        <div style=\"font-family: Arial; font-size: 10pt;\">\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${vocativo!}</span></p>\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${texto_parecer}</span></p>\n            <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">É o Parecer.</span></p>\n        </div>\n    [/@estiloBrasaoCentralizado]\n[/@documento]\n\n'),
+(7,' Certidão de desentranhamento'),
+(8,'\n[@entrevista]\n [@grupo titulo=\"Informações Gerais\"]\n  [@grupo]\n   [@texto titulo=\"Objetivo da reunião\" var=\"objReuniao\" largura=\"84\" maxcaracteres=\"84\"/]\n  [/@grupo]\n  [@texto titulo=\"Horário\" var=\"horReuniao\" obrigatorio=\"Sim\" largura=\"4\" maxcaracteres=\"5\"/]\n  [@texto titulo=\"Local\" var=\"locReuniao\" obrigatorio=\"Sim\" largura=\"60\" maxcaracteres=\"60\"/]\n[#--\n  [@grupo]\n   [@memo titulo=\"Pendências (reuniões anteriores)\" var=\"pendencias\" colunas=\"78\" linhas=\"2\"/]\n  [/@grupo]\n--]\n  [@separador /]\n  [@selecao titulo=\"Participantes\" var=\"numParticipantes\" reler=true idAjax=\"numParticipantesAjax\" opcoes=\"0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n  [@grupo depende=\"numParticipantesAjax\"]\n   [#if numParticipantes! != \'0\']\n    [#list 1..(numParticipantes)?number as i]\n     [@grupo]\n      [@pessoa titulo=\"\" var=\"participantes\"+i/]\n     [/@grupo]\n    [/#list]\n   [/#if]\n  [/@grupo]\n  [@separador /]\n  [@grupo]\n   [@selecao titulo=\"Participantes (extra)\" var=\"numParticipantesExtra\" reler=true idAjax=\"numPartExtraAjax\" opcoes=\"0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n  [/@grupo]\n  [@grupo depende=\"numPartExtraAjax\"]\n   [#if numParticipantesExtra! != \'0\']\n    [#list 1..(numParticipantesExtra)?number as i]\n     [@grupo]\n      [@texto titulo=\"Nome\" var=\"participantesExtra\"+i largura=\"50\" maxcaracteres=\"101\"/]\n      [@texto titulo=\"Email\" var=\"participantesExtraEmail\"+i largura=\"51\" maxcaracteres=\"101\"/]\n     [/@grupo]\n     [@grupo]\n      [@texto titulo=\"Função\" var=\"participantesExtraFuncao\"+i largura=\"50\" maxcaracteres=\"101\"/]\n      [@texto titulo=\"Unidade\" var=\"participantesExtraUnidade\"+i largura=\"51\" maxcaracteres=\"101\"/]\n     [/@grupo]\n    [/#list]\n   [/#if]\n  [/@grupo]\n [/@grupo]\n [@separador /]\n [@grupo]\n  [@selecao titulo=\"Quantidade de itens da pauta\" var=\"qtdItePauta\" reler=true idAjax=\"qtdItePautaAjax\" opcoes=\"1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n [/@grupo]\n [@grupo depende=\"qtdItePautaAjax\"]\n  [#list 1..(qtdItePauta)?number as i]\n   [@grupo]\n    [@texto titulo=\"<b>Item ${i}</b>\" var=\"itePauta\"+i largura=\"96\" maxcaracteres=\"101\"/]\n   [/@grupo]\n   [@memo titulo=\"Comentários\" var=\"comentario\"+i colunas=\"78\" linhas=\"2\"/]\n   [@grupo]\n    [@selecao titulo=\"Quantidade de ações\" var=\"qtdAcoes\"+i reler=true idAjax=\"qtdAcoesAjax\"+i opcoes=\"0;1;2;3;4;5;6;7;8;9;10;11;12;13;14;15\"/]\n   [/@grupo]\n   [@grupo depende=\"qtdAcoesAjax\"+i]\n    [#if (.vars[\'qtdAcoes\'+i])! != \'0\']\n     [#list 1..(.vars[\'qtdAcoes\'+i])?number as j]\n      [@grupo]      \n       [@texto titulo=\"Ação ${j}\" var=\"acoes\"+i+j largura=\"95\" maxcaracteres=\"75\"/]\n      [/@grupo]\n      [@grupo]\n       [@texto titulo=\"Responsável\" var=\"responsavel\"+i+j largura=\"61\" maxcaracteres=\"55\"/]\n       [@data titulo=\"Data prevista\" var=\"datPrevista\"+i+j/] \n      [/@grupo]\n     [/#list]\n    [/#if]\n   [/@grupo]\n   [@separador /]  \n  [/#list] \n [/@grupo]\n[/@entrevista]\n\n[@documento]\n [#if tamanhoLetra! == \"Normal\"]\n		[#assign tl = \"11pt\" /]\n [#elseif tamanhoLetra! == \"Pequeno\"]\n		[#assign tl = \"9pt\" /]\n [#elseif tamanhoLetra! == \"Grande\"]\n		[#assign tl = \"13pt\" /]\n [#else]		\n		[#assign tl = \"11pt\"]\n [/#if]\n [@estiloBrasaoCentralizado tipo=\"MEMÓRIA DE REUNIÃO\" tamanhoLetra=tl formatarOrgao=true]\n   <p align=\"left\">\n    <b>Objetivo da reunião:</b>&nbsp;${objReuniao!}<br/>\n    Horário e local: ${horReuniao!} - ${locReuniao!}<br/>\n     Assunto: ${(doc.exClassificacao.descrClassificacao)!}</p><br/>\n[#--\n   [#if pendencias! != \"\"]\n    <p><b>Pendências (reuniões anteriores):</b>&nbsp;${pendencias!}</p><br/>\n   [/#if]\n--]\n   <table width=\"100%\" border=\"1\" cellpadding=\"5\">\n    <tr>\n     <td width=\"50%\"><b>Participantes</b></td>\n     <td width=\"25%\"><b>Função</b></td>\n     <td width=\"25%\"><b>Unidade</b></td>\n    </tr>\n    [#list 1..(numParticipantes)?number as i]\n     [#if .vars[\'participantes\' + i + \'_pessoaSel.id\']?? && .vars[\'participantes\' + i + \'_pessoaSel.id\'] != \"\"]\n      [#assign participante = func.pessoa(.vars[\'participantes\' + i + \'_pessoaSel.id\']?number) /]\n      <tr>\n       <td>${func.maiusculasEMinusculas(participante.descricao)}</td>\n       <td>${(participante.funcaoConfianca.descricao)!}</td>\n       <td>${participante.lotacao.sigla}</td>\n      </tr>\n     [/#if]\n    [/#list]\n\n    [#list 1..(numParticipantesExtra)?number as i] \n     [#if numParticipantesExtra! != \'0\']\n      <tr>\n       <td>${.vars[\'participantesExtra\'+i]!}\n        [#if .vars[\'participantesExtraEmail\'+i]??] (${.vars[\'participantesExtraEmail\'+i]!})[/#if]</td>\n       <td>${.vars[\'participantesExtraFuncao\'+i]!}</td>\n       <td>${.vars[\'participantesExtraUnidade\'+i]!}</td>\n      </tr>\n     [/#if]    \n    [/#list]\n   </table> \n   <br/>\n\n\n  \n   <p><b>Pauta</b></p>\n     [#list 1..(qtdItePauta)?number as i] \n        <p>\n          <b>${i}. ${.vars[\'itePauta\'+i]!}:</b> ${.vars[\'comentario\'+i]!}\n        </p>       \n     [/#list]  \n\n\n  <br/> \n\n  [#assign fAcoes = false/]\n  [#list 1..(qtdItePauta)?number as i]\n   [#if .vars[\'qtdAcoes\'+i] != \'0\']\n    [#assign fAcoes = true/]\n   [/#if] \n  [/#list]\n\n  [#if fAcoes]\n   <table width=\"100%\" border=\"1\" cellpadding=\"5\">\n     <tr>\n      <td width=\"10%\"><b>Ref.</b></td>\n      <td width=\"50%\"><b>Próximas Ações</b></td>\n      <td width=\"20%\"><b>Responsável</b></td>\n      <td width=\"20%\" align=\"center\"><b>Data Prevista</b></td>\n     </tr>\n     [#list 1..(qtdItePauta)?number as i]\n      [#if .vars[\'qtdAcoes\'+i] != \'0\']\n       [#list 1..(.vars[\'qtdAcoes\'+i])?number as j]\n        <tr>\n         <td>${i}.${j}</td>\n         <td>${.vars[\'acoes\'+i+j]!}</td>\n         <td>${.vars[\'responsavel\'+i+j]!}</td>\n         <td align=\"center\">${.vars[\'datPrevista\'+i+j]!}</td>\n        </tr>\n       [/#list]\n      [/#if]\n     [/#list]\n   </table>   \n  [/#if]\n [/@estiloBrasaoCentralizado]\n[/@documento]\n\n'),
+(9,'\n[@documento margemDireita=\"3cm\"]\n    [#assign tl=\"11pt\"/]\n    [@estiloBrasaoCentralizado tipo=\"DESPACHO\" tamanhoLetra=tl formatarOrgao=true numeracaoCentralizada=false dataAntesDaAssinatura =true]\n        <div style=\"font-family: Arial; font-size: ${tl};\">\n          Referência: ${doc.codigo} de ${doc.dtD} de ${doc.dtMMMM} de ${doc.dtYYYY}[#if doc.lotaTitular??] - ${(doc.lotaTitular.descricao)!}[/#if].<br/>\n            Assunto: ${(doc.exClassificacao.descrClassificacao)!}\n        </div>\n\n        <div style=\"font-family: Arial; font-size: ${tl};\">\n            [#if mov.lotaResp?? && (mov.lotaResp.idLotacaoIni != mov.lotaCadastrante.idLotacaoIni)]\n                <p style=\"TEXT-INDENT: 0cm\">\n                  <span style=\"font-size: ${tl}\">À ${(mov.lotaResp.descricao)!},</span>\n                </p>\n            [/#if]\n            [#if despachoTexto??]\n                <p style=\"TEXT-INDENT: 2cm\"><span style=\"font-size: ${tl}\">${despachoTexto}</span></p>\n            [/#if]\n            ${despachoHtml!}\n        </div>\n    [/@estiloBrasaoCentralizado]\n[/@documento]\n\n'),
+(10,' ');
+/*!40000 ALTER TABLE `cp_arquivo_blob` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_modelo`
+--
+
+DROP TABLE IF EXISTS `cp_modelo`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_modelo` (
+  `ID_MODELO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
+  `ID_ARQ` BIGINT UNSIGNED DEFAULT NULL,
+  `CONTEUDO_BLOB_MOD` blob,
+  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_DT_INI` datetime NOT NULL,
+  `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_DT_FIM` datetime DEFAULT NULL,
+  `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
+  `HIS_ATIVO` tinyint(4) NOT NULL,
+  PRIMARY KEY (`ID_MODELO`),
+  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
+  KEY `HIS_IDC_INI` (`HIS_IDC_INI`),
+  KEY `HIS_IDC_FIM` (`HIS_IDC_FIM`),
+  KEY `HIS_ID_INI` (`HIS_ID_INI`),
+  KEY `ID_ARQ` (`ID_ARQ`),
+  CONSTRAINT `cp_modelo_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `cp_modelo_ibfk_2` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `cp_modelo_ibfk_3` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `cp_identidade` (`ID_IDENTIDADE`),
+  CONSTRAINT `cp_modelo_ibfk_4` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_modelo` (`ID_MODELO`),
+  CONSTRAINT `cp_modelo_ibfk_5` FOREIGN KEY (`ID_ARQ`) REFERENCES `cp_arquivo` (`ID_ARQ`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_modelo`
+--
+
+LOCK TABLES `cp_modelo` WRITE;
+/*!40000 ALTER TABLE `cp_modelo` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_modelo` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_ocorrencia_feriado`
+--
+
+DROP TABLE IF EXISTS `cp_ocorrencia_feriado`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_ocorrencia_feriado` (
+  `ID_OCORRENCIA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DT_INI_FERIADO` datetime DEFAULT NULL,
+  `DT_FIM_FERIADO` datetime DEFAULT NULL,
+  `ID_FERIADO` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_OCORRENCIA`),
+  KEY `ID_FERIADO` (`ID_FERIADO`),
+  CONSTRAINT `cp_ocorrencia_feriado_ibfk_1` FOREIGN KEY (`ID_FERIADO`) REFERENCES `cp_feriado` (`ID_FERIADO`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_ocorrencia_feriado`
+--
+
+LOCK TABLES `cp_ocorrencia_feriado` WRITE;
+/*!40000 ALTER TABLE `cp_ocorrencia_feriado` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_ocorrencia_feriado` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_orgao`
+--
+
+DROP TABLE IF EXISTS `cp_orgao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_orgao` (
+  `ID_ORGAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NM_ORGAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `CGC_ORGAO` INT UNSIGNED DEFAULT NULL,
+  `RAZAO_SOCIAL_ORGAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `END_ORGAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `BAIRRO_ORGAO` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `MUNICIPIO_ORGAO` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `CEP_ORGAO` varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DSC_TIPO_ORGAO` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `NOME_RESPONSAVEL_ORGAO` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `EMAIL_RESPONSAVEL_ORGAO` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `NOME_CONTATO_ORGAO` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `EMAIL_CONTATO_ORGAO` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `TEL_CONTATO_ORGAO` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SIGLA_ORGAO` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `UF_ORGAO` varchar(2) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  `FG_ATIVO` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_IDE` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `HIS_DT_INI` datetime DEFAULT NULL,
+  `HIS_DT_FIM` datetime DEFAULT NULL,
+  `HIS_ATIVO` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_ORGAO`),
+  UNIQUE KEY `ORGAO_PK` (`ID_ORGAO`),
+  KEY `ORGAO_ORGAO_USU_FK` (`ID_ORGAO_USU`),
+  CONSTRAINT `ORGAO_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
+) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_orgao`
+--
+
+LOCK TABLES `cp_orgao` WRITE;
+/*!40000 ALTER TABLE `cp_orgao` DISABLE KEYS */;
+INSERT INTO `cp_orgao` VALUES (1,'PRESIDENCIA DA REPUBLICA',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'Pres. Rep.',NULL,999999999,'S',1,'1','2011-08-03 00:00:00',NULL,1);
+/*!40000 ALTER TABLE `cp_orgao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_orgao_usuario`
+--
+
+DROP TABLE IF EXISTS `cp_orgao_usuario`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_orgao_usuario` (
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NM_ORGAO_USU` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `CGC_ORGAO_USU` bigint(20) DEFAULT NULL,
+  `RAZAO_SOCIAL_ORGAO_USU` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `END_ORGAO_USU` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `BAIRRO_ORGAO_USU` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `MUNICIPIO_ORGAO_USU` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `CEP_ORGAO_USU` varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `NM_RESP_ORGAO_USU` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `TEL_ORGAO_USU` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SIGLA_ORGAO_USU` varchar(15) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `UF_ORGAO_USU` varchar(2) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `COD_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
+  `ACRONIMO_ORGAO_USU` varchar(12) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_ORGAO_USU`),
+  UNIQUE KEY `ORGAO_USU_PK` (`ID_ORGAO_USU`)
+) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_orgao_usuario`
+--
+
+LOCK TABLES `cp_orgao_usuario` WRITE;
+/*!40000 ALTER TABLE `cp_orgao_usuario` DISABLE KEYS */;
+INSERT INTO `cp_orgao_usuario` VALUES (999999999,'ORGAO TESTE ZZ',NULL,NULL,NULL,NULL,'Rio de Janeiro',NULL,NULL,NULL,'ZZ',NULL,NULL,'OTZZ');
+/*!40000 ALTER TABLE `cp_orgao_usuario` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_papel`
+--
+
+DROP TABLE IF EXISTS `cp_papel`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_papel` (
+  `ID_PAPEL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_TP_PAPEL` INT UNSIGNED NOT NULL,
+  `ID_PESSOA` INT UNSIGNED NOT NULL,
+  `ID_LOTACAO` INT UNSIGNED NOT NULL,
+  `ID_FUNCAO_CONFIANCA` INT UNSIGNED DEFAULT NULL,
+  `ID_CARGO` INT UNSIGNED NOT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
+  `HIS_IDE` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `HIS_DT_INI` datetime NOT NULL,
+  `HIS_DT_FIM` datetime DEFAULT NULL,
+  `HIS_ATIVO` tinyint(4) NOT NULL,
+  PRIMARY KEY (`ID_PAPEL`),
+  UNIQUE KEY `CP_PAPEL_PK` (`ID_PAPEL`),
+  KEY `CP_PAPEL_CPORGUSU_IDORGUSU_FK` (`ID_ORGAO_USU`),
+  KEY `CP_PAPEL_CPTPPAP_ID_TPPAP_FK` (`ID_TP_PAPEL`),
+  KEY `CP_PAPEL_CP_PAPEL_ID_INI_FK` (`HIS_ID_INI`),
+  KEY `CP_PAPEL_DP_CARGO_ID_CARGO_FK` (`ID_CARGO`),
+  KEY `CP_PAPEL_DP_FC_ID_FC_FK` (`ID_FUNCAO_CONFIANCA`),
+  KEY `CP_PAPEL_DP_LOT_ID_LOT_FK` (`ID_LOTACAO`),
+  KEY `CP_PAPEL_DP_PESS_ID_PESS_FK` (`ID_PESSOA`),
+  CONSTRAINT `CP_PAPEL_CPORGUSU_IDORGUSU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `CP_PAPEL_CPTPPAP_ID_TPPAP_FK` FOREIGN KEY (`ID_TP_PAPEL`) REFERENCES `cp_tipo_papel` (`ID_TP_PAPEL`),
+  CONSTRAINT `CP_PAPEL_CP_PAPEL_ID_INI_FK` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `cp_papel` (`ID_PAPEL`),
+  CONSTRAINT `CP_PAPEL_DP_CARGO_ID_CARGO_FK` FOREIGN KEY (`ID_CARGO`) REFERENCES `dp_cargo` (`ID_CARGO`),
+  CONSTRAINT `CP_PAPEL_DP_FC_ID_FC_FK` FOREIGN KEY (`ID_FUNCAO_CONFIANCA`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
+  CONSTRAINT `CP_PAPEL_DP_LOT_ID_LOT_FK` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
+  CONSTRAINT `CP_PAPEL_DP_PESS_ID_PESS_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_papel`
+--
+
+LOCK TABLES `cp_papel` WRITE;
+/*!40000 ALTER TABLE `cp_papel` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_papel` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_personalizacao`
+--
+
+DROP TABLE IF EXISTS `cp_personalizacao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_personalizacao` (
+  `ID_PESSOA` INT UNSIGNED NOT NULL,
+  `ID_PAPEL_ATIVO` INT UNSIGNED DEFAULT NULL,
+  `ID_SUBSTITUINDO_PESSOA` INT UNSIGNED DEFAULT NULL,
+  `ID_SUBSTITUINDO_LOTACAO` INT UNSIGNED DEFAULT NULL,
+  `ID_SUBSTITUINDO_PAPEL` INT UNSIGNED DEFAULT NULL,
+  `NM_SIMULANDO_USUARIO` varchar(15) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_PERSONALIZACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  PRIMARY KEY (`ID_PERSONALIZACAO`),
+  KEY `CP_PERSON_CP_PAP_ID_ATIVO_FK` (`ID_PAPEL_ATIVO`),
+  KEY `CP_PERSON_CP_PAP_ID_SUBST_FK` (`ID_SUBSTITUINDO_PAPEL`),
+  KEY `CP_PERSON_DP_LOT_ID_SUBST_FK` (`ID_SUBSTITUINDO_LOTACAO`),
+  KEY `CP_PERSON_DP_PESS_ID_PESS_FK` (`ID_PESSOA`),
+  KEY `CP_PERSON_DP_PESS_ID_SUBST_FK` (`ID_SUBSTITUINDO_PESSOA`),
+  CONSTRAINT `CP_PERSON_CP_PAP_ID_ATIVO_FK` FOREIGN KEY (`ID_PAPEL_ATIVO`) REFERENCES `cp_papel` (`ID_PAPEL`),
+  CONSTRAINT `CP_PERSON_CP_PAP_ID_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUINDO_PAPEL`) REFERENCES `cp_papel` (`ID_PAPEL`),
+  CONSTRAINT `CP_PERSON_DP_LOT_ID_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUINDO_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
+  CONSTRAINT `CP_PERSON_DP_PESS_ID_PESS_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
+  CONSTRAINT `CP_PERSON_DP_PESS_ID_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUINDO_PESSOA`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_personalizacao`
+--
+
+LOCK TABLES `cp_personalizacao` WRITE;
+/*!40000 ALTER TABLE `cp_personalizacao` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_personalizacao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_sede`
+--
+
+DROP TABLE IF EXISTS `cp_sede`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_sede` (
+  `ID_SEDE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NM_SEDE` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `DSC_SEDE` varchar(512) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  PRIMARY KEY (`ID_SEDE`),
+  KEY `ID_ORGAO_USU` (`ID_ORGAO_USU`),
+  CONSTRAINT `cp_sede_ibfk_1` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_sede`
+--
+
+LOCK TABLES `cp_sede` WRITE;
+/*!40000 ALTER TABLE `cp_sede` DISABLE KEYS */;
+/*!40000 ALTER TABLE `cp_sede` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_servico`
+--
+
+DROP TABLE IF EXISTS `cp_servico`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_servico` (
+  `ID_SERVICO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `SIGLA_SERVICO` varchar(40) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `DESC_SERVICO` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `ID_SERVICO_PAI` INT UNSIGNED DEFAULT NULL,
+  `ID_TP_SERVICO` INT UNSIGNED NOT NULL,
+  `LABEL_SERVICO` varchar(35) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_SERVICO`),
+  UNIQUE KEY `CP_SERVICO_ID_SERVICO_PK` (`ID_SERVICO`),
+  UNIQUE KEY `SIGLA_SERVICO_IDX` (`SIGLA_SERVICO`),
+  KEY `CP_SERV_CPTPSERV_ID_TPSERV_FK` (`ID_TP_SERVICO`),
+  CONSTRAINT `CP_SERV_CPTPSERV_ID_TPSERV_FK` FOREIGN KEY (`ID_TP_SERVICO`) REFERENCES `cp_tipo_servico` (`ID_TP_SERVICO`)
+) ENGINE=InnoDB AUTO_INCREMENT=316 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_servico`
+--
+
+LOCK TABLES `cp_servico` WRITE;
+/*!40000 ALTER TABLE `cp_servico` DISABLE KEYS */;
+INSERT INTO `cp_servico` VALUES 
+(1,'SIGA','Sistema Integrado de Gestão Administrativa',NULL,2,NULL),
+(2,'SIGA-DOC','Módulo de Documentos',1,2,NULL),
+(3,'SIGA-WF','Módulo de Workflow',1,2,NULL),
+(4,'SIGA-SR','Módulo de Serviços',1,2,NULL),
+(5,'FS','Acesso aos Diretórios do Sistema de Arquivos',NULL,1,NULL),
+(9,'FS-PUB','Acesso ao Diretório Público',5,1,'(K) PÚBLICA'),
+(10,'FS-RAIZ','Acesso ao Diretório Raiz da Unidade',5,1,'(K) RAIZ'),
+(15,'SIGA-GI','Módulo de Gestão de Identidade',1,2,NULL),
+(16,'SIGA-WF-INI','Iniciar',3,2,NULL),
+(17,'SIGA-GI-PERMISSAO','Gerenciar permissões',15,2,NULL),
+(18,'SIGA-GI-ID','Gerenciar identidades',15,2,NULL),
+(19,'SIGA-GI-PERFIL','Gerenciar perfis de acesso',15,2,NULL),
+(20,'SIGA-GI-PERFILJEE','Gerenciar perfis do JEE',15,2,NULL),
+(21,'SIGA-GI-GDISTR','Gerenciar grupos de distribuição',15,2,NULL),
+(22,'SIGA-GI-SELFSERVICE','Gerenciar serviços da própria lotação',15,2,NULL),
+(23,'SIGA-GI-REL','Gerar relatórios',15,2,NULL),
+(24,'SIGA-WF-FE','Ferramentas',3,2,NULL),
+(41,'SIGA-WF-REL','Relatórios',3,2,NULL),
+(42,'SIGA-WF-FE-DEFP','Cadastrar Diagramas',24,2,NULL),
+(43,'SIGA-WF-FE-DEFR','Cadastrar Responsáveis',24,2,NULL),
+(62,'SIGA-FE','Ferramentas',1,2,NULL),
+(63,'SIGA-FE-MODVER','Visualizar modelos',62,2,NULL),
+(64,'SIGA-FE-MODEDITAR','Editar modelos',62,2,NULL),
+(65,'SIGA-DOC-MOD','Gerenciar modelos',2,2,NULL),
+(284,'SIGA-DOC-REL','Gerar relatórios',2,2,NULL),
+(304,'SIGA-DOC-REL-FORMS','Relação de formulários',284,2,NULL),
+(305,'SIGA-DOC-REL-DATAS','Relação de documentos entre datas',284,2,NULL),
+(306,'SIGA-DOC-REL-SUBORD','Relatório de documentos em setores subordinados',284,2,NULL),
+(307,'SIGA-DOC-FE','Ferramentas',2,2,NULL),
+(308,'SIGA-DOC-FE-CFG','Configurações',307,2,NULL),
+(309,'SIGA-GC-EDTCLASS','Editar Classificação',NULL,2,NULL),
+(310,'SIGA-SR-ADM','Administrar',4,2,NULL),
+(311,'SIGA-SR-EDTCONH','Criar Conhecimentos',4,2,NULL),
+(312,'SIGA-SR-EMAILATEND','Receber Notificação Atendente',4,2,NULL),
+(313,'SIGA-SR-OPENSAVE','Salvar Solicitação Ao Abrir',4,2,NULL),
+(314,'SIGA-SR-OPENPRIOR','Priorizar ao Abrir',4,2,NULL),
+(315,'SIGA-SR-VER_GESTOR_I','Ver gestor do item de configuração ao abrir solicitação',4,2,NULL);
+/*!40000 ALTER TABLE `cp_servico` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_situacao_configuracao`
+--
+
+DROP TABLE IF EXISTS `cp_situacao_configuracao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_situacao_configuracao` (
+  `ID_SIT_CONFIGURACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DSC_SIT_CONFIGURACAO` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `RESTRITIVIDADE_SIT_CONF` double NOT NULL,
+  PRIMARY KEY (`ID_SIT_CONFIGURACAO`),
+  UNIQUE KEY `CP_SIT_CONF_ID_SIT_CONF_PK` (`ID_SIT_CONFIGURACAO`)
+) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_situacao_configuracao`
+--
+
+LOCK TABLES `cp_situacao_configuracao` WRITE;
+/*!40000 ALTER TABLE `cp_situacao_configuracao` DISABLE KEYS */;
+INSERT INTO `cp_situacao_configuracao` VALUES 
+(1,'Pode',0),
+(2,'Não Pode',9),
+(3,'Obrigatório',7),
+(4,'Opcional',4),
+(5,'Default',5),
+(6,'Não default',6),
+(7,'Proibido',10),
+(8,'Só Leitura',8),
+(9,'Ignorar configuração anterior',1);
+/*!40000 ALTER TABLE `cp_situacao_configuracao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_configuracao`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_configuracao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_configuracao` (
+  `ID_TP_CONFIGURACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DSC_TP_CONFIGURACAO` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_SIT_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_CONFIGURACAO`),
+  UNIQUE KEY `CP_TP_CONF_ID_TP_CONF_PK` (`ID_TP_CONFIGURACAO`),
+  KEY `CP_TP_CONF_CP_SIT_CONF_ID_FK` (`ID_SIT_CONFIGURACAO`),
+  CONSTRAINT `CP_TP_CONF_CP_SIT_CONF_ID_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_situacao_configuracao` (`ID_SIT_CONFIGURACAO`)
+) ENGINE=InnoDB AUTO_INCREMENT=308 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_configuracao`
+--
+
+LOCK TABLES `cp_tipo_configuracao` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_configuracao` DISABLE KEYS */;
+INSERT INTO `cp_tipo_configuracao` VALUES 
+(1,'Movimentar',1),
+(2,'Criar',1),
+(3,'Finalizar',1),
+(4,'Eletrônico',7),
+(5,'Nivel de Acesso',4),
+(6,'Acessar',2),
+(7,'Diretor do Foro',NULL),
+(8,'Refazer',1),
+(9,'Duplicar',1),
+(10,'Editar',1),
+(11,'Excluir',1),
+(12,'Excluir Anexo',1),
+(13,'Configurar',2),
+(14,'Excluir Anotação',1),
+(15,'Visualizar Impressão',1),
+(16,'Cancelar Via',1),
+(17,'Criar Via',1),
+(18,'Nível de Acesso Máximo',4),
+(19,'Nível de Acesso Mínimo',4),
+(20,'Cadastrar Qualquer Subst',2),
+(21,'Definir Publicadores',2),
+(22,'Atender Pedido de Publicação',2),
+(23,'Pode receber documento sem assinatura',2),
+(24,'Pode criar documento filho',1),
+(25,'Gerenciar Publicação Boletim',2),
+(26,'Simular Usuário',2),
+(27,'Notificar Por E-mail',1),
+(28,'Corrigir Erro',2),
+(29,'Cancelar Movimentação',2),
+(30,'Incluir como Filho',2),
+(31,'Destinatário',4),
+(32,'Utilizar Extensão de Editor',2),
+(33,'Utilizar Extensão de Conversor HTML',2),
+(34,'Reiniciar Numeração Todo Ano',1),
+(35,'Autuável',2),
+(36,'Editar Data',2),
+(37,'Editar Descrição',1),
+(38,'Trâmite Automático',5),
+(39,'Pode Assinar sem Solicitação',1),
+(40,'Definição Automática de Perfil',1),
+(41,'Incluir Documento',1),
+(42,'Criar Como Novo',1),
+(43,'Juntada Automática',1),
+(100,'Instanciar Procedimento',2),
+(101,'Designar Tarefa',2),
+(200,'Utilizar Serviço',2),
+(201,'Pode habilitar serviço',2),
+(202,'Pode habilitar serviço de diretório',2),
+(203,'Pertencer',1),
+(204,'Fazer Login',1),
+(205,'Utilizar Serviço de Outra Lotação',2),
+(206,'Gerenciar Grupo',2),
+(300,'Designação',NULL),
+(301,'Associação',NULL),
+(302,'Usar Lista',2),
+(303,'Inclusão automática em lista',1),
+(304,'Abrangência de Acordo',1),
+(305,'Associação de Configuração com Pesquisa',1),
+(306,'Escalonar Por Solicitacao Filha',NULL),
+(307,'Definição do horário da equipe',NULL);
+/*!40000 ALTER TABLE `cp_tipo_configuracao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_grupo`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_grupo`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_grupo` (
+  `ID_TP_GRUPO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESC_TP_GRUPO` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_GRUPO`),
+  UNIQUE KEY `CP_TIPO_GRUPO_PK` (`ID_TP_GRUPO`)
+) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_grupo`
+--
+
+LOCK TABLES `cp_tipo_grupo` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_grupo` DISABLE KEYS */;
+INSERT INTO `cp_tipo_grupo` VALUES (1,'Perfil de Acesso'),
+(2,'Grupo de Distribuição'),
+(3,'Perfil de Acesso do JEE');
+/*!40000 ALTER TABLE `cp_tipo_grupo` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_identidade`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_identidade`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_identidade` (
+  `ID_TP_IDENTIDADE` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESC_TP_IDENTIDADE` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_IDENTIDADE`),
+  UNIQUE KEY `CP_TIPO_IDENTIDADE_PK` (`ID_TP_IDENTIDADE`)
+) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_identidade`
+--
+
+LOCK TABLES `cp_tipo_identidade` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_identidade` DISABLE KEYS */;
+INSERT INTO `cp_tipo_identidade` VALUES (1,'Login e Senha'),
+(2,'Certidão Digital ICP-Brasil');
+/*!40000 ALTER TABLE `cp_tipo_identidade` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_lotacao`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_lotacao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_lotacao` (
+  `ID_TP_LOTACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `SIGLA_TP_LOTACAO` varchar(40) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DESC_TP_LOTACAO` varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_TP_LOTACAO_PAI` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_LOTACAO`),
+  UNIQUE KEY `CP_TIPO_LOTACAO_PK` (`ID_TP_LOTACAO`)
+) ENGINE=InnoDB AUTO_INCREMENT=204 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_lotacao`
+--
+
+LOCK TABLES `cp_tipo_lotacao` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_lotacao` DISABLE KEYS */;
+INSERT INTO `cp_tipo_lotacao` VALUES (1,'ADM','Unidade da Administração',NULL),
+(100,'JUD','Unidade Judicial',NULL),
+(101,'VF','Vara Federal',100),
+(102,'VFCR','Vara Federal Criminal',100),
+(200,'AGR','Agrupamento',NULL),
+(201,'AGFM','Agrupamento Formal',200),
+(202,'AGOP','Agrupamento Operacional',200),
+(203,'AGFC','Agrupamento Funcional',200);
+/*!40000 ALTER TABLE `cp_tipo_lotacao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_marca`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_marca`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_marca` (
+  `ID_TP_MARCA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESCR_TP_MARCA` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_MARCA`)
+) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_marca`
+--
+
+LOCK TABLES `cp_tipo_marca` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_marca` DISABLE KEYS */;
+INSERT INTO `cp_tipo_marca` VALUES (1,'SIGA-EX'),
+(2,'SIGA-SR'),
+(3,'SIGA-GC');
+/*!40000 ALTER TABLE `cp_tipo_marca` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_marcador`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_marcador`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_marcador` (
+  `ID_TP_MARCADOR` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESCR_TIPO_MARCADOR` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_MARCADOR`)
+) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_marcador`
+--
+
+LOCK TABLES `cp_tipo_marcador` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_marcador` DISABLE KEYS */;
+INSERT INTO `cp_tipo_marcador` VALUES (1,'Sistema'),
+(2,'Geral'),
+(3,'Lotação e sublotações'),
+(4,'Lotação'),
+(5,'Pessoa');
+/*!40000 ALTER TABLE `cp_tipo_marcador` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_papel`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_papel`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_papel` (
+  `ID_TP_PAPEL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESC_TP_PAPEL` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_PAPEL`),
+  UNIQUE KEY `CP_TIPO_PAPEL_PK` (`ID_TP_PAPEL`)
+) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_papel`
+--
+
+LOCK TABLES `cp_tipo_papel` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_papel` DISABLE KEYS */;
+INSERT INTO `cp_tipo_papel` VALUES (1,'Principal'),
+(2,'Funcional');
+/*!40000 ALTER TABLE `cp_tipo_papel` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_pessoa`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_pessoa`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_pessoa` (
+  `ID_TP_PESSOA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESC_TP_PESSOA` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_PESSOA`),
+  UNIQUE KEY `CP_TIPO_PESSOA_PK` (`ID_TP_PESSOA`)
+) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_pessoa`
+--
+
+LOCK TABLES `cp_tipo_pessoa` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_pessoa` DISABLE KEYS */;
+INSERT INTO `cp_tipo_pessoa` VALUES (1,'Magistrado'),
+(2,'Servidor'),
+(3,'Estagiário'),
+(4,'Terceirizado');
+/*!40000 ALTER TABLE `cp_tipo_pessoa` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_servico`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_servico`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_servico` (
+  `ID_TP_SERVICO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESC_TP_SERVICO` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_SIT_CONFIGURACAO` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_TP_SERVICO`),
+  UNIQUE KEY `CP_TIPO_SERVICO_PK` (`ID_TP_SERVICO`),
+  KEY `CP_TP_SERV_ID_SIT_CONF_FK` (`ID_SIT_CONFIGURACAO`),
+  CONSTRAINT `CP_TP_SERV_ID_SIT_CONF_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_tipo_configuracao` (`ID_TP_CONFIGURACAO`)
+) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_servico`
+--
+
+LOCK TABLES `cp_tipo_servico` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_servico` DISABLE KEYS */;
+INSERT INTO `cp_tipo_servico` VALUES (1,'Diretório',2),
+(2,'Sistema',2);
+/*!40000 ALTER TABLE `cp_tipo_servico` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_tipo_servico_situacao`
+--
+
+DROP TABLE IF EXISTS `cp_tipo_servico_situacao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_tipo_servico_situacao` (
+  `ID_TP_SERVICO` INT UNSIGNED NOT NULL DEFAULT '0',
+  `ID_SIT_CONFIGURACAO` INT UNSIGNED NOT NULL DEFAULT '0',
+  PRIMARY KEY (`ID_TP_SERVICO`,`ID_SIT_CONFIGURACAO`),
+  KEY `CP_TPSERVSIT_ID_SITCONF_FK` (`ID_SIT_CONFIGURACAO`),
+  CONSTRAINT `CP_TPSERVSIT_ID_SITCONF_FK` FOREIGN KEY (`ID_SIT_CONFIGURACAO`) REFERENCES `cp_situacao_configuracao` (`ID_SIT_CONFIGURACAO`),
+  CONSTRAINT `CP_TPSRVSIT_IDTPSRV_FK` FOREIGN KEY (`ID_TP_SERVICO`) REFERENCES `cp_tipo_servico` (`ID_TP_SERVICO`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_tipo_servico_situacao`
+--
+
+LOCK TABLES `cp_tipo_servico_situacao` WRITE;
+/*!40000 ALTER TABLE `cp_tipo_servico_situacao` DISABLE KEYS */;
+INSERT INTO `cp_tipo_servico_situacao` VALUES (1,1),
+(2,1),
+(1,2),
+(2,2);
+/*!40000 ALTER TABLE `cp_tipo_servico_situacao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_uf`
+--
+
+DROP TABLE IF EXISTS `cp_uf`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_uf` (
+  `ID_UF` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NM_UF` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  PRIMARY KEY (`ID_UF`),
+  UNIQUE KEY `UF_PK` (`ID_UF`)
+) ENGINE=InnoDB AUTO_INCREMENT=28 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_uf`
+--
+
+LOCK TABLES `cp_uf` WRITE;
+/*!40000 ALTER TABLE `cp_uf` DISABLE KEYS */;
+INSERT INTO `cp_uf` VALUES (1,'AC'),
+(2,'AL'),
+(3,'AM'),
+(4,'AP'),
+(5,'BA'),
+(6,'CE'),
+(7,'DF'),
+(8,'ES'),
+(9,'GO'),
+(10,'MA'),
+(11,'MG'),
+(12,'MS'),
+(13,'MT'),
+(14,'PA'),
+(15,'PB'),
+(16,'PE'),
+(17,'PI'),
+(18,'PR'),
+(19,'RJ'),
+(20,'RN'),
+(21,'RO'),
+(22,'RR'),
+(23,'RS'),
+(24,'SC'),
+(25,'SE'),
+(26,'SP'),
+(27,'TO');
+/*!40000 ALTER TABLE `cp_uf` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `cp_unidade_medida`
+--
+
+DROP TABLE IF EXISTS `cp_unidade_medida`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `cp_unidade_medida` (
+  `ID_UNIDADE_MEDIDA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DESCR_UNIDADE_MEDIDA` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_UNIDADE_MEDIDA`)
+) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `cp_unidade_medida`
+--
+
+LOCK TABLES `cp_unidade_medida` WRITE;
+/*!40000 ALTER TABLE `cp_unidade_medida` DISABLE KEYS */;
+INSERT INTO `cp_unidade_medida` VALUES (1,'Ano'),
+(2,'Mes'),
+(3,'Dia'),
+(4,'Hora'),
+(5,'Minuto'),
+(6,'Segundo');
+/*!40000 ALTER TABLE `cp_unidade_medida` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `dp_cargo`
+--
+
+DROP TABLE IF EXISTS `dp_cargo`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_cargo` (
+  `ID_CARGO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NOME_CARGO` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  `DT_FIM_CARGO` datetime DEFAULT NULL,
+  `DT_INI_CARGO` datetime DEFAULT NULL,
+  `ID_CARGO_INICIAL` INT UNSIGNED DEFAULT NULL,
+  `IDE_CARGO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SIGLA_CARGO` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_CARGO`),
+  KEY `DP_CARGO_IDX_012` (`ID_ORGAO_USU`),
+  KEY `DP_CARGO_IDX_011` (`ID_CARGO_INICIAL`),
+  CONSTRAINT `CARGO_INICIAL_CARGO_FK` FOREIGN KEY (`ID_CARGO_INICIAL`) REFERENCES `dp_cargo` (`ID_CARGO`),
+  CONSTRAINT `CARGO_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
+) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_cargo`
+--
+
+LOCK TABLES `dp_cargo` WRITE;
+/*!40000 ALTER TABLE `dp_cargo` DISABLE KEYS */;
+INSERT INTO `dp_cargo` VALUES (1,'FUNCIONÁRIO',999999999,NULL,'2011-08-03 00:00:00',1,'203','500300');
+/*!40000 ALTER TABLE `dp_cargo` ENABLE KEYS */;
+UNLOCK TABLES;
+/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
+/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
+/*!50003 SET @saved_col_connection = @@collation_connection */ ;
+/*!50003 SET character_set_client  = utf8 */ ;
+/*!50003 SET character_set_results = utf8 */ ;
+/*!50003 SET collation_connection  = utf8_general_ci */ ;
+/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
+/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
+DELIMITER ;;
+/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_CARGO_INSERT_TRG` BEFORE INSERT ON `dp_cargo` FOR EACH ROW BEGIN
+    if NEW.id_cargo_inicial is null then
+        SET NEW.ID_cargo = NEW.id_cargo_inicial;
+    end if;
+END */;;
+DELIMITER ;
+/*!50003 SET sql_mode              = @saved_sql_mode */ ;
+/*!50003 SET character_set_client  = @saved_cs_client */ ;
+/*!50003 SET character_set_results = @saved_cs_results */ ;
+/*!50003 SET collation_connection  = @saved_col_connection */ ;
+
+--
+-- Table structure for table `dp_estado_civil`
+--
+
+DROP TABLE IF EXISTS `dp_estado_civil`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_estado_civil` (
+  `ID_ESTADO_CIVIL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NM_ESTADO_CIVIL` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  PRIMARY KEY (`ID_ESTADO_CIVIL`),
+  UNIQUE KEY `ESTADO_CIVIL_PK` (`ID_ESTADO_CIVIL`)
+) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_estado_civil`
+--
+
+LOCK TABLES `dp_estado_civil` WRITE;
+/*!40000 ALTER TABLE `dp_estado_civil` DISABLE KEYS */;
+INSERT INTO `dp_estado_civil` VALUES (1,'SOLTEIRO'),
+(2,'CASADO'),
+(3,'SEPARADO'),
+(4,'DIVORCIADO'),
+(5,'VIUVO'),
+(6,'UNIAO ESTAVEL'),
+(7,'NÃO DECLARADO');
+/*!40000 ALTER TABLE `dp_estado_civil` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `dp_funcao_confianca`
+--
+
+DROP TABLE IF EXISTS `dp_funcao_confianca`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_funcao_confianca` (
+  `ID_FUNCAO_CONFIANCA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `NOME_FUNCAO_CONFIANCA` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `NIVEL_FUNCAO_CONFIANCA` tinyint(4) DEFAULT NULL,
+  `COD_FOLHA_FUNCAO_CONFIANCA` tinyint(4) DEFAULT NULL,
+  `DT_INI_FUNCAO_CONFIANCA` datetime DEFAULT NULL,
+  `DT_FIM_FUNCAO_CONFIANCA` datetime DEFAULT NULL,
+  `ID_FUNCAO_CONFIANCA_PAI` INT UNSIGNED DEFAULT NULL,
+  `CATEGORIA_FUNCAO_CONFIANCA` varchar(15) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  `IDE_FUNCAO_CONFIANCA` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_FUN_CONF_INI` INT UNSIGNED DEFAULT NULL,
+  `SIGLA_FUNCAO_CONFIANCA` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_FUNCAO_CONFIANCA`),
+  KEY `DP_FUNCAO_CONFIANCA_IDX_010` (`ID_FUNCAO_CONFIANCA_PAI`),
+  KEY `DP_FUNCAO_CONFIANCA_IDX_009` (`ID_ORGAO_USU`),
+  KEY `DP_FUNCAO_CONFIANCA_IDX_008` (`ID_FUN_CONF_INI`),
+  CONSTRAINT `FUN_CONF_INI_FUN_CONF_PK` FOREIGN KEY (`ID_FUN_CONF_INI`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
+  CONSTRAINT `FUN_CONF_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `dp_funcao_confianca_ibfk_1` FOREIGN KEY (`ID_FUNCAO_CONFIANCA_PAI`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_funcao_confianca`
+--
+
+LOCK TABLES `dp_funcao_confianca` WRITE;
+/*!40000 ALTER TABLE `dp_funcao_confianca` DISABLE KEYS */;
+/*!40000 ALTER TABLE `dp_funcao_confianca` ENABLE KEYS */;
+UNLOCK TABLES;
+/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
+/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
+/*!50003 SET @saved_col_connection = @@collation_connection */ ;
+/*!50003 SET character_set_client  = utf8 */ ;
+/*!50003 SET character_set_results = utf8 */ ;
+/*!50003 SET collation_connection  = utf8_general_ci */ ;
+/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
+/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
+DELIMITER ;;
+/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_FUNC_CONF_INSERT_TRG` BEFORE INSERT ON `dp_funcao_confianca` FOR EACH ROW begin
+if NEW.id_fun_conf_ini is null then
+    SET NEW.ID_funcao_confianca = NEW.id_fun_conf_ini;
+end if;
+end */;;
+DELIMITER ;
+/*!50003 SET sql_mode              = @saved_sql_mode */ ;
+/*!50003 SET character_set_client  = @saved_cs_client */ ;
+/*!50003 SET character_set_results = @saved_cs_results */ ;
+/*!50003 SET collation_connection  = @saved_col_connection */ ;
+
+--
+-- Table structure for table `dp_lotacao`
+--
+
+DROP TABLE IF EXISTS `dp_lotacao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_lotacao` (
+  `ID_LOTACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DATA_INI_LOT` datetime NOT NULL,
+  `DATA_FIM_LOT` datetime DEFAULT NULL,
+  `NOME_LOTACAO` varchar(120) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `ID_LOTACAO_PAI` INT UNSIGNED DEFAULT NULL,
+  `SIGLA_LOTACAO` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  `IDE_LOTACAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_LOTACAO_INI` INT UNSIGNED DEFAULT NULL,
+  `ID_TP_LOTACAO` INT UNSIGNED DEFAULT NULL,
+  `ID_LOCALIDADE` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_LOTACAO`),
+  UNIQUE KEY `SIGLA_LOTACAO_DP_LOTACAO_UK` (`SIGLA_LOTACAO`,`ID_ORGAO_USU`,`DATA_FIM_LOT`),
+  KEY `DP_LOTACAO_IDX_007` (`ID_LOTACAO_PAI`),
+  KEY `LOT_ID_INI` (`ID_LOTACAO_INI`,`DATA_FIM_LOT`),
+  KEY `DP_LOTACAO_IDX_006` (`ID_ORGAO_USU`),
+  KEY `DP_LOT_CP_TP_LOT_ID_TP_LOT_FK` (`ID_TP_LOTACAO`),
+  KEY `ID_LOCALIDADE` (`ID_LOCALIDADE`),
+  CONSTRAINT `DP_LOT_CP_TP_LOT_ID_TP_LOT_FK` FOREIGN KEY (`ID_TP_LOTACAO`) REFERENCES `cp_tipo_lotacao` (`ID_TP_LOTACAO`),
+  CONSTRAINT `LOTACAO_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `dp_lotacao_ibfk_1` FOREIGN KEY (`ID_LOTACAO_PAI`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
+  CONSTRAINT `dp_lotacao_ibfk_2` FOREIGN KEY (`ID_LOCALIDADE`) REFERENCES `cp_localidade` (`ID_LOCALIDADE`)
+) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_lotacao`
+--
+
+LOCK TABLES `dp_lotacao` WRITE;
+/*!40000 ALTER TABLE `dp_lotacao` DISABLE KEYS */;
+INSERT INTO `dp_lotacao` VALUES (1,'2011-08-08 00:00:00',NULL,'LOTACAO TESTE',NULL,'LTEST',999999999,'1076',1,100,NULL);
+INSERT INTO `dp_lotacao` VALUES (2,'2011-08-08 00:00:00',NULL,'LOTACAO TESTE 2',NULL,'LTEST2',999999999,'1077',2,100,NULL);
+INSERT INTO `dp_lotacao` VALUES (3,'2011-08-08 00:00:00',NULL,'LOTACAO TESTE 3',NULL,'LTEST3',999999999,'1078',3,100,NULL);
+/*!40000 ALTER TABLE `dp_lotacao` ENABLE KEYS */;
+UNLOCK TABLES;
+/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
+/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
+/*!50003 SET @saved_col_connection = @@collation_connection */ ;
+/*!50003 SET character_set_client  = utf8 */ ;
+/*!50003 SET character_set_results = utf8 */ ;
+/*!50003 SET collation_connection  = utf8_general_ci */ ;
+/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
+/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
+DELIMITER ;;
+/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_LOTACAO_INSERT_TRG` BEFORE INSERT ON `dp_lotacao` FOR EACH ROW begin
+if NEW.id_lotacao_ini is null then
+    SET NEW.ID_lotacao = NEW.id_lotacao_ini;
+end if;
+end */;;
+DELIMITER ;
+/*!50003 SET sql_mode              = @saved_sql_mode */ ;
+/*!50003 SET character_set_client  = @saved_cs_client */ ;
+/*!50003 SET character_set_results = @saved_cs_results */ ;
+/*!50003 SET collation_connection  = @saved_col_connection */ ;
+
+--
+-- Table structure for table `dp_padrao_referencia`
+--
+
+DROP TABLE IF EXISTS `dp_padrao_referencia`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_padrao_referencia` (
+  `ID_PADRAO_REFERENCIA` tinyint(4) NOT NULL AUTO_INCREMENT,
+  `ID_PADRAO_REFERENCIA_PAI` tinyint(4) DEFAULT NULL,
+  `DSC_PADRAO` varchar(3) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `DSC_CLASSE` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DSC_NIVEL` varchar(2) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `PADRAO_REFERENCIA_DT_FIM` datetime DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL DEFAULT '1',
+  PRIMARY KEY (`ID_PADRAO_REFERENCIA`),
+  UNIQUE KEY `PADRAO_REFERENCIA_PK` (`ID_PADRAO_REFERENCIA`),
+  KEY `PADRAO_REF_ORGAO_USU_FK` (`ID_ORGAO_USU`),
+  CONSTRAINT `PADRAO_REF_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_padrao_referencia`
+--
+
+LOCK TABLES `dp_padrao_referencia` WRITE;
+/*!40000 ALTER TABLE `dp_padrao_referencia` DISABLE KEYS */;
+/*!40000 ALTER TABLE `dp_padrao_referencia` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `dp_pessoa`
+--
+
+DROP TABLE IF EXISTS `dp_pessoa`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_pessoa` (
+  `ID_PESSOA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `DATA_INI_PESSOA` datetime NOT NULL,
+  `DATA_FIM_PESSOA` datetime DEFAULT NULL,
+  `CPF_PESSOA` bigint(20) NOT NULL,
+  `NOME_PESSOA` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `DATA_NASC_PESSOA` datetime DEFAULT NULL,
+  `MATRICULA` INT UNSIGNED NOT NULL,
+  `ID_LOTACAO` INT UNSIGNED NOT NULL,
+  `ID_CARGO` INT UNSIGNED DEFAULT NULL,
+  `ID_FUNCAO_CONFIANCA` INT UNSIGNED DEFAULT NULL,
+  `SESB_PESSOA` varchar(5) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `EMAIL_PESSOA` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `TP_SERVIDOR_PESSOA` tinyint(4) DEFAULT NULL,
+  `SIGLA_PESSOA` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SEXO_PESSOA` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `GRAU_INSTRUCAO_PESSOA` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `TP_SANGUINEO_PESSOA` varchar(3) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `NACIONALIDADE_PESSOA` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DATA_POSSE_PESSOA` datetime DEFAULT NULL,
+  `DATA_NOMEACAO_PESSOA` datetime DEFAULT NULL,
+  `DATA_PUBLICACAO_PESSOA` datetime DEFAULT NULL,
+  `DATA_INICIO_EXERCICIO_PESSOA` datetime DEFAULT NULL,
+  `ATO_NOMEACAO_PESSOA` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `SITUACAO_FUNCIONAL_PESSOA` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_PROVIMENTO` tinyint(4) DEFAULT NULL,
+  `NATURALIDADE_PESSOA` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `FG_IMPRIME_END` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DSC_PADRAO_REFERENCIA_PESSOA` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
+  `IDE_PESSOA` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_PESSOA_INICIAL` INT UNSIGNED DEFAULT NULL,
+  `ENDERECO_PESSOA` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `BAIRRO_PESSOA` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `CIDADE_PESSOA` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `CEP_PESSOA` varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `TELEFONE_PESSOA` varchar(30) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `RG_PESSOA` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `RG_ORGAO_PESSOA` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `RG_DATA_EXPEDICAO_PESSOA` datetime DEFAULT NULL,
+  `RG_UF_PESSOA` varchar(2) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `ID_ESTADO_CIVIL` INT UNSIGNED DEFAULT NULL,
+  `ID_TP_PESSOA` INT UNSIGNED DEFAULT NULL,
+  `NOME_EXIBICAO` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  PRIMARY KEY (`ID_PESSOA`),
+  KEY `PES_ID_INI` (`ID_PESSOA_INICIAL`,`DATA_FIM_PESSOA`),
+  KEY `DP_PESSOA_IDX_003` (`ID_FUNCAO_CONFIANCA`),
+  KEY `DP_PESSOA_IDX_001` (`ID_ORGAO_USU`),
+  KEY `DP_PESSOA_NM_PESSOA_IX` (`NOME_PESSOA`),
+  KEY `DP_PESSOA_IDX_002` (`ID_CARGO`,`ID_LOTACAO`,`ID_FUNCAO_CONFIANCA`,`ID_ORGAO_USU`),
+  KEY `DP_PESSOA_IDX_015` (`DATA_FIM_PESSOA`,`NOME_PESSOA`),
+  KEY `DP_PESSOA_IDX_005` (`ID_PROVIMENTO`),
+  KEY `DP_PESSOA_IDX_014` (`MATRICULA`,`SESB_PESSOA`,`DATA_FIM_PESSOA`),
+  KEY `DP_PESSOA_IDX_004` (`ID_LOTACAO`),
+  KEY `DP_PESS_CPTPPESS_ID_TPPESS_FK` (`ID_TP_PESSOA`),
+  KEY `PESSOA_ESTADO_CIVIL_FK` (`ID_ESTADO_CIVIL`),
+  CONSTRAINT `DP_PESS_CPTPPESS_ID_TPPESS_FK` FOREIGN KEY (`ID_TP_PESSOA`) REFERENCES `cp_tipo_pessoa` (`ID_TP_PESSOA`),
+  CONSTRAINT `PESSOA_ESTADO_CIVIL_FK` FOREIGN KEY (`ID_ESTADO_CIVIL`) REFERENCES `dp_estado_civil` (`ID_ESTADO_CIVIL`),
+  CONSTRAINT `PESSOA_INICIAL_PESSOAL_FK` FOREIGN KEY (`ID_PESSOA_INICIAL`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
+  CONSTRAINT `PESSOA_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `cp_orgao_usuario` (`ID_ORGAO_USU`),
+  CONSTRAINT `dp_pessoa_ibfk_1` FOREIGN KEY (`ID_CARGO`) REFERENCES `dp_cargo` (`ID_CARGO`),
+  CONSTRAINT `dp_pessoa_ibfk_2` FOREIGN KEY (`ID_FUNCAO_CONFIANCA`) REFERENCES `dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
+  CONSTRAINT `dp_pessoa_ibfk_3` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `dp_lotacao` (`ID_LOTACAO`),
+  CONSTRAINT `dp_pessoa_ibfk_4` FOREIGN KEY (`ID_PROVIMENTO`) REFERENCES `dp_provimento` (`ID_PROVIMENTO`)
+) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_pessoa`
+--
+
+LOCK TABLES `dp_pessoa` WRITE;
+/*!40000 ALTER TABLE `dp_pessoa` DISABLE KEYS */;
+INSERT INTO `dp_pessoa` VALUES (1,'2001-01-01 00:00:00',NULL,11111111111,'USUARIO TESTE','2001-01-01 00:00:00',99999,1,1,NULL,'ZZ','usuarioteste@jfrj.jus.br',NULL,'TST','M','ESPEC','A+','BRASILEIRO','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','0000/2001','1',NULL,NULL,NULL,'PAD-REF',999999999,'99999',1,'AV ALMTE BARROSO 78','CENTRO','RIO DE JANEIRO','20000000','9700','987654321','TESTE','2001-01-01 00:00:00','RJ',2,2,NULL);
+INSERT INTO `dp_pessoa` VALUES (2,'2001-01-01 00:00:00',NULL,22222222222,'USUARIO TESTE 2','2001-01-01 00:00:00',99998,2,1,NULL,'ZZ','usuarioteste2@jfrj.jus.br',NULL,'TST','M','ESPEC','A+','BRASILEIRO','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','0000/2001','1',NULL,NULL,NULL,'PAD-REF',999999999,'99998',2,'AV ALMTE BARROSO 78','CENTRO','RIO DE JANEIRO','20000000','9702','987654321','TESTE','2001-01-01 00:00:00','RJ',2,2,NULL);
+INSERT INTO `dp_pessoa` VALUES (3,'2001-01-01 00:00:00',NULL,33333333333,'USUARIO TESTE 3','2001-01-01 00:00:00',99997,3,1,NULL,'ZZ','usuarioteste3@jfrj.jus.br',NULL,'TST','M','ESPEC','A+','BRASILEIRO','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','2001-01-01 00:00:00','0000/2001','1',NULL,NULL,NULL,'PAD-REF',999999999,'99997',3,'AV ALMTE BARROSO 78','CENTRO','RIO DE JANEIRO','20000000','9703','987654321','TESTE','2001-01-01 00:00:00','RJ',2,2,NULL);
+/*!40000 ALTER TABLE `dp_pessoa` ENABLE KEYS */;
+UNLOCK TABLES;
+/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
+/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
+/*!50003 SET @saved_col_connection = @@collation_connection */ ;
+/*!50003 SET character_set_client  = utf8 */ ;
+/*!50003 SET character_set_results = utf8 */ ;
+/*!50003 SET collation_connection  = utf8_general_ci */ ;
+/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
+/*!50003 SET sql_mode              = 'NO_ENGINE_SUBSTITUTION' */ ;
+DELIMITER ;;
+/*!50003 CREATE*/ /*!50017 DEFINER=`root`@`localhost`*/ /*!50003 TRIGGER `DP_PESSOA_INSERT_TRG` BEFORE INSERT ON `dp_pessoa` FOR EACH ROW begin
+if NEW.id_pessoa_inicial is null then
+    SET NEW.ID_pessoa = NEW.id_pessoa_inicial;
+end if;
+end */;;
+DELIMITER ;
+/*!50003 SET sql_mode              = @saved_sql_mode */ ;
+/*!50003 SET character_set_client  = @saved_cs_client */ ;
+/*!50003 SET character_set_results = @saved_cs_results */ ;
+/*!50003 SET collation_connection  = @saved_col_connection */ ;
+
+--
+-- Table structure for table `dp_provimento`
+--
+
+DROP TABLE IF EXISTS `dp_provimento`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_provimento` (
+  `ID_PROVIMENTO` tinyint(4) NOT NULL AUTO_INCREMENT,
+  `DSC_PROVIMENTO` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  PRIMARY KEY (`ID_PROVIMENTO`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_provimento`
+--
+
+LOCK TABLES `dp_provimento` WRITE;
+/*!40000 ALTER TABLE `dp_provimento` DISABLE KEYS */;
+/*!40000 ALTER TABLE `dp_provimento` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `dp_substituicao`
+--
+
+DROP TABLE IF EXISTS `dp_substituicao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8 */;
+CREATE TABLE `dp_substituicao` (
+  `ID_SUBSTITUICAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
+  `ID_TITULAR` INT UNSIGNED DEFAULT NULL,
+  `ID_LOTA_TITULAR` INT UNSIGNED NOT NULL,
+  `ID_SUBSTITUTO` INT UNSIGNED DEFAULT NULL,
+  `ID_LOTA_SUBSTITUTO` INT UNSIGNED NOT NULL,
+  `DT_INI_SUBST` datetime NOT NULL,
+  `DT_FIM_SUBST` datetime DEFAULT NULL,
+  `DT_INI_REG` datetime DEFAULT NULL,
+  `DT_FIM_REG` datetime DEFAULT NULL,
+  `ID_REG_INI` INT UNSIGNED DEFAULT NULL,
+  PRIMARY KEY (`ID_SUBSTITUICAO`),
+  KEY `SUBSTITUICAO_PESOA_SUBST_FK` (`ID_SUBSTITUTO`),
+  KEY `SUBSTITUICAO_PESOA_TITULAR_FK` (`ID_TITULAR`),
+  CONSTRAINT `SUBSTITUICAO_PESOA_SUBST_FK` FOREIGN KEY (`ID_SUBSTITUTO`) REFERENCES `dp_pessoa` (`ID_PESSOA`),
+  CONSTRAINT `SUBSTITUICAO_PESOA_TITULAR_FK` FOREIGN KEY (`ID_TITULAR`) REFERENCES `dp_pessoa` (`ID_PESSOA`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `dp_substituicao`
+--
+
+LOCK TABLES `dp_substituicao` WRITE;
+/*!40000 ALTER TABLE `dp_substituicao` DISABLE KEYS */;
+/*!40000 ALTER TABLE `dp_substituicao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+drop function if exists remove_acento;
+delimiter //
+create function remove_acento( textvalue varchar(20000) )
+returns varchar(20000) DETERMINISTIC
+begin
+
+set @textvalue = textvalue;
+
+-- ACCENTS
+set @withaccents = 'ŠšŽžÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÑÒÓÔÕÖØÙÚÛÜÝŸÞàáâãäåæçèéêëìíîïñòóôõöøùúûüýÿþƒ';
+set @withoutaccents = 'SsZzAAAAAAACEEEEIIIINOOOOOOUUUUYYBaaaaaaaceeeeiiiinoooooouuuuyybf';
+set @count = length(@withaccents);
+
+while @count > 0 do
+    set @textvalue = replace(@textvalue, substring(@withaccents, @count, 1), substring(@withoutaccents, @count, 1));
+    set @count = @count - 1;
+end while;
+
+-- SPECIAL CHARS
+set @special = '!@#$%¨&*()_+=§¹²³£¢¬"`´{[^~}]<,>.:;?/°ºª+*|\\''';
+set @count = length(@special);
+while @count > 0 do
+    set @textvalue = replace(@textvalue, substring(@special, @count, 1), '');
+    set @count = @count - 1;
+end while;
+
+return @textvalue;
+
+end;//
+DELIMITER ;
+
+
+--
+-- Dumping routines for database 'corporativo'
+--
+/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;
+
+/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
+/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
+/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
+/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
+/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
+/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
+/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
+
+-- Dump completed on 2020-02-12 13:03:52
diff --git a/siga-cp/src/main/resources/messages_TRF2.properties b/siga-cp/src/main/resources/messages_TRF2.properties
index 83688fd5ef..7a86ca97e0 100644
--- a/siga-cp/src/main/resources/messages_TRF2.properties
+++ b/siga-cp/src/main/resources/messages_TRF2.properties
@@ -15,7 +15,7 @@ documento.novo=Criar Documento
 documento.pesquisar=Pesquisar
 documento.modelo=Modelo
 documento.modelo2=Modelo
-documento.label.especie=&nbsp;
+documento.label.especie=Esp�cie
 documento.subscritor=Subscritor
 documento.subscritor.antigo=Subscritor Antigo
 documento.preenchimento.automatico=Preenchimento autom�tico
@@ -50,4 +50,4 @@ usuario.esqueciminhasenha.sucesso=A Senha foi alterada com sucesso e foi enviada
 usuario.primeiroacesso.sucessocomplemento=O seu login e senha foram enviados para seu email.
 usuario.mesavirtual.etiquetas=Etiquetas
 usuario.mesavirtual.codigo=C�digo
-usuario.novodocumento.arquivo=Arquivo PDF
\ No newline at end of file
+usuario.novodocumento.arquivo=Arquivo PDF
diff --git a/siga-ex/pom.xml b/siga-ex/pom.xml
index 0c1cba5f44..7250fd3acb 100644
--- a/siga-ex/pom.xml
+++ b/siga-ex/pom.xml
@@ -11,30 +11,6 @@
 
 	<artifactId>siga-ex</artifactId>
 
-	<build>
-		<plugins>
-			<plugin>
-				<groupId>org.codehaus.mojo</groupId>
-				<artifactId>build-helper-maven-plugin</artifactId>
-				<version>1.6</version>
-				<executions>
-					<execution>
-						<id>add-source</id>
-						<phase>generate-sources</phase>
-						<goals>
-							<goal>add-source</goal>
-						</goals>
-						<configuration>
-							<sources>
-								<source>src/main/nheengatu</source>
-							</sources>
-						</configuration>
-					</execution>
-				</executions>
-			</plugin>
- 		</plugins>
-	</build>
-
 	<dependencies>
 		<dependency>
 			<groupId>com.google.code.gson</groupId>
@@ -149,10 +125,14 @@
 			<artifactId>ojdbc6</artifactId> <version>11.2.0.3.0</version> <scope>compile</scope> 
 			</dependency> -->
 			
+		<dependency>
+			<groupId>com.crivano</groupId>
+			<artifactId>swaggerservlet</artifactId>
+		</dependency>
+		
 		<dependency>
 			<groupId>br.jus.trf2.xjus</groupId>
 			<artifactId>x-jus-record-api</artifactId>
-			<version>1.0.0</version>
 		</dependency>
 	</dependencies>
 
@@ -248,7 +228,7 @@
 							<sqlMigrationPrefix>SIGA_UTF8_V</sqlMigrationPrefix>
 							<placeholderPrefix>flyway${</placeholderPrefix>
 							<locations>
-								<location>filesystem:src\main\resources</location>
+								<location>filesystem:src\main\resources\db\migration</location>
 							</locations>
 						</configuration>
 						<executions>
@@ -274,4 +254,4 @@
 		</profile>
 	</profiles>
 
-</project>
\ No newline at end of file
+</project>
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/AbstractExClassificacao.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/AbstractExClassificacao.java
index 7855800798..a6a43f8c16 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/AbstractExClassificacao.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/AbstractExClassificacao.java
@@ -88,10 +88,10 @@ import br.gov.jfrj.siga.hibernate.ExDao;
 		@NamedQuery(name = "consultarDescricaoExClassificacao", query = "select descrClassificacao from ExClassificacao cla"
 				+ "		where cla.codificacao in :listaCodificacao"
 				+ "		and cla.hisAtivo = 1 order by codificacao"),
-		@NamedQuery(name = "consultarExClassificacaoPorMascara", query = "select distinct(cla) from ExClassificacao cla left join fetch cla.exViaSet"
+		@NamedQuery(name = "consultarExClassificacaoPorMascara", query = "select distinct(cla) from ExClassificacao cla left join fetch cla.exViaSet via"
 				+ "		where cla.codificacao like :mascara"
 				+ "			and (upper(cla.descrClassificacao) like upper('%' || :descrClassificacao || '%'))"
-				+ "	    	and cla.hisAtivo = 1" + "	    	order by codificacao") })
+				+ "	    	and cla.hisAtivo = 1 order by codificacao, via.codVia") })
 public abstract class AbstractExClassificacao extends HistoricoAuditavelSuporte
 		implements Serializable {
 
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExArquivo.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExArquivo.java
index 55378c2427..6743729369 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExArquivo.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExArquivo.java
@@ -148,8 +148,7 @@ public abstract class ExArquivo extends Objeto {
 		if (isAssinadoDigitalmente()) {
 			sMensagem += getAssinantesCompleto();
 			sMensagem += "Documento Nº: " + getSiglaAssinatura()
-					+ " - consulta à autenticidade em "
-					+ SigaExProperties.getEnderecoAutenticidadeDocs();
+					+ " - consulta à autenticidade em " + getQRCode();
 		}
 		return sMensagem;
 	}
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExClassificacao.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExClassificacao.java
index 354f0f0612..ee36e4037d 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExClassificacao.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExClassificacao.java
@@ -150,6 +150,8 @@ public class ExClassificacao extends AbstractExClassificacao implements
 	}
 
 	public Integer getNumVias() {
+		if (getExViaSet() == null)
+			return 0;
 		return getExViaSet().size();
 	}
 
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExMobil.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExMobil.java
index 0e6b43a34c..52de64a7de 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExMobil.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExMobil.java
@@ -249,7 +249,7 @@ public class ExMobil extends AbstractExMobil implements Serializable, Selecionav
 		}
 
 		s = s + "', 'documento', " + winProp + ")\">" + descricaoCurta + "</a>";
-		return s;
+		return descricaoCurta;
 	}
 
 	/**
@@ -2167,4 +2167,19 @@ public class ExMobil extends AbstractExMobil implements Serializable, Selecionav
 		}
 		return set;
 	}
+
+	public boolean isModeloIncluso(Long idModelo) {
+		ExModelo mod = ExDao.getInstance().consultar(idModelo, ExModelo.class, false);
+		
+		for (ExMovimentacao m : getExMovimentacaoReferenciaSet()) {
+			if (m.getExMovimentacaoCanceladora() != null)
+				continue;
+			if (m.getExTipoMovimentacao().getIdTpMov() != ExTipoMovimentacao.TIPO_MOVIMENTACAO_JUNTADA)
+				continue;
+			if (m.getExMobilRef() == this && m.getExMobil() != null 
+					&& m.getExMobil().doc().getExModelo().getIdInicial().equals(mod.getIdInicial()))
+				return true;
+		}
+		return false;
+	}
 }
\ No newline at end of file
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExModelo.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExModelo.java
index 7928a886e5..7efe22ab17 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExModelo.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExModelo.java
@@ -24,7 +24,6 @@ package br.gov.jfrj.siga.ex;
 import java.io.UnsupportedEncodingException;
 import java.util.Date;
 
-import javax.persistence.Column;
 import javax.persistence.Entity;
 import javax.persistence.Table;
 import javax.persistence.Transient;
@@ -33,7 +32,7 @@ import org.hibernate.annotations.BatchSize;
 
 import br.gov.jfrj.siga.base.Texto;
 import br.gov.jfrj.siga.hibernate.ExDao;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
+import br.gov.jfrj.siga.model.Selecionavel;
 import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
 
 /**
@@ -43,7 +42,7 @@ import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
 @Entity
 @BatchSize(size = 500)
 @Table(name = "siga.ex_modelo")
-public class ExModelo extends AbstractExModelo implements Sincronizavel {
+public class ExModelo extends AbstractExModelo implements Sincronizavel, Selecionavel {
 	@Transient
 	private byte[] cacheConteudoBlobMod;
 
@@ -191,4 +190,19 @@ public class ExModelo extends AbstractExModelo implements Sincronizavel {
 			return filename.substring(0, filename.lastIndexOf("/"));
 		return null;
 	}
+
+	@Override
+	public String getSigla() {
+		return getNmMod();
+	}
+
+	@Override
+	public void setSigla(String sigla) {
+		setNmMod(sigla);
+	}
+
+	@Override
+	public String getDescricao() {
+		return null;
+	}
 }
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExTipoMovimentacao.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExTipoMovimentacao.java
index f4117f82f8..a24d826885 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExTipoMovimentacao.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/ExTipoMovimentacao.java
@@ -187,6 +187,8 @@ public class ExTipoMovimentacao extends AbstractExTipoMovimentacao implements Se
 	final static public long TIPO_MOVIMENTACAO_ANEXACAO_DE_ARQUIVO_AUXILIAR = 64;
 
 	final static public long TIPO_MOVIMENTACAO_SOLICITACAO_DE_ASSINATURA = 65;
+	
+	final static public long TIPO_MOVIMENTACAO_AUTUAR = 67;
 
 	public static boolean hasDespacho(long id) {
 		return id == ExTipoMovimentacao.TIPO_MOVIMENTACAO_DESPACHO
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/SigaExProperties.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/SigaExProperties.java
index f2b283ac8a..bb9c304223 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/SigaExProperties.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/SigaExProperties.java
@@ -158,7 +158,10 @@ public class SigaExProperties extends ModeloPropriedade {
 	}
 
 	public static String getEnderecoAutenticidadeDocs() {
-		return getString("siga.ex.enderecoAutenticidadeDocs");
+		String url = getString("siga.ex.enderecoAutenticidadeDocs");
+		if (url != null)
+		return url;
+		return "http://localhost:8080/sigaex/public/app/autenticar";
 	}
 	
 	public static Long getIdModInternoImportado() throws Exception{
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExBL.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExBL.java
index a3ecea000c..b409351611 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExBL.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExBL.java
@@ -27,7 +27,6 @@ import java.lang.reflect.Field;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 import java.lang.reflect.Type;
-import java.net.URLDecoder;
 import java.net.URLEncoder;
 import java.sql.SQLException;
 import java.text.SimpleDateFormat;
@@ -88,6 +87,7 @@ import br.gov.jfrj.siga.base.Par;
 import br.gov.jfrj.siga.base.SigaBaseProperties;
 import br.gov.jfrj.siga.base.Texto;
 import br.gov.jfrj.siga.base.util.SetUtils;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.bluc.service.BlucService;
 import br.gov.jfrj.siga.bluc.service.EnvelopeRequest;
 import br.gov.jfrj.siga.bluc.service.EnvelopeResponse;
@@ -155,6 +155,7 @@ import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
 import br.gov.jfrj.siga.wf.service.WfService;
 
 public class ExBL extends CpBL {
+	private static final String MODELO_DESPACHO_AUTOMATICO = "Despacho Automático";
 	private static final String MODELO_FOLHA_DE_ROSTO_EXPEDIENTE_INTERNO = "Folha de Rosto - Expediente Interno";
 	private static final String MODELO_FOLHA_DE_ROSTO_PROCESSO_ADMINISTRATIVO_INTERNO = "Folha de Rosto - Processo Administrativo Interno";
 	private static final String SHA1 = "1.3.14.3.2.26";
@@ -474,11 +475,11 @@ public class ExBL extends CpBL {
 
 			new BoletimInternoBL().deixarDocDisponivelParaInclusaoEmBoletim(mov.getExDocumento());
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao agendar publicação no boletim.", 0, e);
+			throw new RuntimeException(
+					"Erro ao agendar publicação no boletim.", e);
 		}
 	}
 
@@ -497,15 +498,15 @@ public class ExBL extends CpBL {
 			mov.setDescrMov("Publicado em " + mov.getDtMovDDMMYY());
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 			for (ExDocumento ex : new ManipuladorEntrevista(doc).obterDocsMarcados())
 				notificarPublicacao(cadastrante, lotaCadastrante, ex,
 						mov.getDtMov(), doc);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao atestar publicação no boletim.", 0, e);
+			throw new RuntimeException(
+					"Erro ao atestar publicação no boletim.", e);
 		}
 	}
 
@@ -524,7 +525,7 @@ public class ExBL extends CpBL {
 			mov.setExMobilRef(boletim.getMobilGeral());
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 			try {
 				String mensagemTeste = null;
@@ -573,7 +574,7 @@ public class ExBL extends CpBL {
 			}
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao notificar publicação.", 0, e);
+			throw new RuntimeException("Erro ao notificar publicação.", e);
 		}
 	}
 	
@@ -706,10 +707,10 @@ public class ExBL extends CpBL {
 							+ mov.getLotaCadastrante().getSiglaLotacao() + ") ",
 					sb.toString(), sbHtml.toString());
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao agendar publicação.", 0, e);
+			throw new RuntimeException("Erro ao agendar publicação.", e);
 		}
 	}
 
@@ -729,7 +730,7 @@ public class ExBL extends CpBL {
 			mov.setDescrMov("Documento disponibilizado no Diário em " + FuncoesEL.getDataDDMMYYYY(dtMov));
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 			try {
 				String mensagemTeste = null;
@@ -782,8 +783,8 @@ public class ExBL extends CpBL {
 
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao registrar disponibilização.",
-					0, e);
+			throw new RuntimeException("Erro ao registrar disponibilização.",
+					e);
 		}
 	}
 
@@ -850,10 +851,10 @@ public class ExBL extends CpBL {
 					+ new SimpleDateFormat("dd/MM/yy").format(dtDispPublicacao));
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new Exception(e.getMessage());
+			throw e;
 		}
 	}
 
@@ -891,11 +892,11 @@ public class ExBL extends CpBL {
 			
 			encerrarVolumeAutomatico(cadastrante, lotaCadastrante, mob, dtMov);
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao anexar documento.", 0, e);
+			throw new RuntimeException("Erro ao anexar documento.", e);
 		}
 	}
 
@@ -938,10 +939,10 @@ public class ExBL extends CpBL {
 				dao().gravar(m);
 			}
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao anexar arquivo auxiliar.", 0, e);
+			throw new RuntimeException("Erro ao anexar arquivo auxiliar.", e);
 		}
 	}
 
@@ -1026,8 +1027,8 @@ public class ExBL extends CpBL {
 			throw e;
 		} catch (final Exception e) {
 			ExDao.rollbackTransacao();
-			throw new AplicacaoException("Ocorreu um Erro durante a Operação",
-					0, e);
+			throw new RuntimeException("Ocorreu um Erro durante a Operação",
+					e);
 		}
 
 	}
@@ -1061,10 +1062,10 @@ public class ExBL extends CpBL {
 				mov.setDescrMov("Arquivamento automático.");
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao arquivar documento.", 0, e);
+			throw new RuntimeException("Erro ao arquivar documento.", e);
 		}
 	}
 
@@ -1085,10 +1086,10 @@ public class ExBL extends CpBL {
 			mov.setDescrMov(descrMov);
 			gravarMovimentacao(mov);
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao arquivar um documento.", 0, e);
+			throw new RuntimeException("Erro ao arquivar um documento.", e);
 		}
 	}
 
@@ -1107,11 +1108,11 @@ public class ExBL extends CpBL {
 					cadastrante, lotaCadastrante, mob, dtMov, subscritor, null,
 					null, null, dt);
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao arquivar permanentemente um documento.", 0, e);
+			throw new RuntimeException(
+					"Erro ao arquivar permanentemente um documento.", e);
 		}
 	}
 
@@ -1132,10 +1133,10 @@ public class ExBL extends CpBL {
 			mov.setExMobilRef(termo);
 			gravarMovimentacao(mov);
 			concluirAlteracaoParcialComRecalculoAcesso(mob);
-			concluirAlteracao(null);
+			concluirAlteracao();
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao eliminar o documento.", 0, e);
+			throw new RuntimeException("Erro ao eliminar o documento.", e);
 		}
 	}
 
@@ -1162,10 +1163,10 @@ public class ExBL extends CpBL {
 				gravarMovimentacao(mov);
 				concluirAlteracaoParcial(m);
 			}
-			concluirAlteracao(null);
+			concluirAlteracao();
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao sobrestar documento.", 0, e);
+			throw new RuntimeException("Erro ao sobrestar documento.", e);
 		}
 	}
 
@@ -1227,10 +1228,10 @@ public class ExBL extends CpBL {
 				if (!mobPai.doc().equals(mob.doc()))
 					atualizarMarcas(mobPai);
 			}
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao reclassificar.", 0, e);
+			throw new RuntimeException("Erro ao reclassificar.", e);
 		}
 
 	}
@@ -1265,7 +1266,7 @@ public class ExBL extends CpBL {
 			mov.setDescrMov(doc.getSubscritor().getNomePessoa());
 
 			gravarMovimentacao(mov);
-			concluirAlteracaoDoc(mov.getExMobil().doc());
+			concluirAlteracaoDoc(mov);
 
 			// Verifica se o documento possui documento pai e faz a juntada
 			// automática. Caso o pai seja um volume de um processo, primeiro
@@ -1296,11 +1297,11 @@ public class ExBL extends CpBL {
 			cancelarAlteracao();
 
 			if (e.getMessage().contains("junta"))
-				throw new AplicacaoException(
+				throw new RuntimeException(
 						"Não foi possível juntar este documento ao documento pai. O erro da juntada foi - "
-								+ e.getMessage(), 0, e);
+								+ e.getMessage(), e);
 
-			throw new AplicacaoException("Erro ao assinar documento.", 0, e);
+			throw new RuntimeException("Erro ao assinar documento.", e);
 		}
 
 	}
@@ -1332,14 +1333,14 @@ public class ExBL extends CpBL {
 					.getSubscritor().getNomePessoa() : movAlvo.getDescrMov());
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final AplicacaoException e) {
 			cancelarAlteracao();
 			throw e;
 		} catch (final Exception e) {
 			log.error("Erro ao assinar movimentação.", e);
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao assinar movimentação.", 0, e);
+			throw new RuntimeException("Erro ao assinar movimentação.", e);
 		}
 
 	}
@@ -1475,8 +1476,8 @@ public class ExBL extends CpBL {
 
 			lCPF = Long.valueOf(sCPF);
 		} catch (final Exception e) {
-			throw new AplicacaoException("Erro na assinatura de um documento: "
-					+ e.getMessage() == null ? "" : e.getMessage(), 0, e);
+			throw new RuntimeException("Erro na assinatura de um documento: "
+					+ e.getMessage() == null ? "" : e.getMessage(), e);
 		}
 
 		boolean fValido = false;
@@ -1493,7 +1494,7 @@ public class ExBL extends CpBL {
 			lMatricula = Long.valueOf(sMatricula);
 		} catch (final Exception e) {
 			// throw new AplicacaoException(
-			// "não foi possível obter a matrícula do assinante", 0, e);
+			// "não foi possível obter a matrícula do assinante", e);
 		}
 
 		// Verifica se a matrícula confere com o subscritor titular ou com um
@@ -1573,9 +1574,9 @@ public class ExBL extends CpBL {
 				throw new AplicacaoException(
 						"Assinante não é subscritor nem cossignatario");
 		} catch (final Exception e) {
-			throw new AplicacaoException(
+			throw new RuntimeException(
 					"Só é permitida a assinatura digital do subscritor e dos cossignatários do documento",
-					0, e);
+					e);
 		}
 
 		String s = null;
@@ -1599,11 +1600,9 @@ public class ExBL extends CpBL {
 			mov.setDescrMov(sNome);
 
 			gravarMovimentacao(mov);
-			concluirAlteracaoDocComRecalculoAcesso(mov.getExMobil().getDoc());
-
-			ContextoPersistencia.flushTransaction();
+			concluirAlteracaoDocComRecalculoAcesso(mov);
 		} catch (final Exception e) {
-			throw new AplicacaoException("Erro ao assinar documento.", 0, e);
+			throw new RuntimeException("Erro ao assinar documento.", e);
 		}
 
 		try {
@@ -1630,12 +1629,10 @@ public class ExBL extends CpBL {
 				juntarAoDocumentoAutuado(cadastrante, lotaCadastrante, doc,
 						dtMov, cadastrante, cadastrante, mov);
 			}
-			
-			ContextoPersistencia.flushTransaction();
 		} catch (final Exception e) {
-			throw new AplicacaoException(
+			throw new RuntimeException(
 					"Não foi possível juntar este documento ao documento pai. O erro da juntada foi - "
-							+ e.getMessage(), 0, e);
+							+ e.getMessage(), e);
 		}
 
 		try {
@@ -1643,7 +1640,7 @@ public class ExBL extends CpBL {
 				processarComandosEmTag(doc, "assinatura");
 			}
 		} catch (final Exception e) {
-			throw new AplicacaoException("Erro ao executar procedimento pós-assinatura.", 0, e);
+			throw new RuntimeException("Erro ao executar procedimento pós-assinatura.", e);
 		}
 
 		try {
@@ -1652,14 +1649,14 @@ public class ExBL extends CpBL {
 			if (tramitar)
 				trasferirAutomaticamente(cadastrante, lotaCadastrante, usuarioDoToken, doc, fPreviamenteAssinado);
 		} catch (final Exception e) {
-			throw new AplicacaoException("Erro ao tramitar automaticamente.", 0, e);
+			throw new RuntimeException("Erro ao tramitar automaticamente.", e);
 		}
 
 		try {
 			if (doc.isAssinadoPorTodosOsSignatariosComTokenOuSenha())
 				removerPapel(doc, ExPapel.PAPEL_REVISOR);
 		} catch (final Exception e) {
-			throw new AplicacaoException("Erro ao remover revisores.", 0, e);
+			throw new RuntimeException("Erro ao remover revisores.", e);
 		}
 
 		return s;
@@ -1761,9 +1758,9 @@ public class ExBL extends CpBL {
 					throw new AplicacaoException(
 							"Assinante não é subscritor nem cossignatario");
 			} catch (final Exception e) {
-				throw new AplicacaoException(
+				throw new RuntimeException(
 						"Só é permitida a assinatura digital do subscritor e dos cossignatários do documento",
-						0, e);
+						e);
 			}
 		}
 
@@ -1788,7 +1785,7 @@ public class ExBL extends CpBL {
 					autenticando, subscritor.getNomePessoa(), cpf, null);
 
 			gravarMovimentacao(mov);
-			concluirAlteracaoDocComRecalculoAcesso(doc);
+			concluirAlteracaoDocComRecalculoAcesso(mov);
 
 			// Verifica se o documento possui documento pai e faz a juntada
 			// automática.
@@ -1805,11 +1802,12 @@ public class ExBL extends CpBL {
 						dtMov, cadastrante, cadastrante, mov);
 			}
 
-			if (!fPreviamenteAssinado && doc.isAssinadoPorTodosOsSignatariosComTokenOuSenha())
+			if (!fPreviamenteAssinado && doc.isAssinadoPorTodosOsSignatariosComTokenOuSenha()) {
 				s = processarComandosEmTag(doc, "assinatura");
+			}
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao registrar assinatura.", 0, e);
+			throw new Exception("Erro ao registrar assinatura.", e);
 		}
 
 		if (tramitar == null)
@@ -1821,7 +1819,7 @@ public class ExBL extends CpBL {
 			if (doc.isAssinadoPorTodosOsSignatariosComTokenOuSenha())
 				removerPapel(doc, ExPapel.PAPEL_REVISOR);
 		} catch (final Exception e) {
-			throw new AplicacaoException("Erro ao remover revisores.", 0, e);
+			throw new Exception("Erro ao remover revisores.", e);
 		}
 
 		return s;
@@ -1944,7 +1942,7 @@ public class ExBL extends CpBL {
 					subscritor.getNomePessoa(), cpf, null);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 		} catch (final AplicacaoException e) {
 			cancelarAlteracao();
@@ -1952,7 +1950,7 @@ public class ExBL extends CpBL {
 		} catch (final Exception e) {
 			log.error("Erro ao assinar movimentação.", e);
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao assinar movimentação.", 0, e);
+			throw new RuntimeException("Erro ao assinar movimentação.", e);
 		}
 	}
 
@@ -2157,7 +2155,7 @@ public class ExBL extends CpBL {
 				lMatricula = Long.valueOf(sMatricula.replace("-", ""));
 			} catch (final Exception e) {
 				// throw new AplicacaoException(
-				// "não foi possível obter a matrícula do assinante", 0, e);
+				// "não foi possível obter a matrícula do assinante", e);
 			}
 
 			// Verifica se a matrícula confere com o subscritor do Despacho ou
@@ -2205,14 +2203,14 @@ public class ExBL extends CpBL {
 					if (fValido == false
 							&& movAlvo.getIdTpMov() == ExTipoMovimentacao.TIPO_MOVIMENTACAO_CANCELAMENTO_JUNTADA) {
 						log.warn("Só é permitida a assinatura digital do subscritor do desentranhamento");
-						throw new AplicacaoException(
+						throw new RuntimeException(
 								"Só é permitida a assinatura digital do subscritor do desentranhamento",
-								0, e);
+								e);
 					}
 					log.warn("Só é permitida a assinatura digital do subscritor do despacho");
-					throw new AplicacaoException(
+					throw new RuntimeException(
 							"Só é permitida a assinatura digital do subscritor do despacho",
-							0, e);
+							e);
 				}
 			}
 
@@ -2240,15 +2238,15 @@ public class ExBL extends CpBL {
 			mov.setDescrMov(sNome);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final AplicacaoException e) {
 			cancelarAlteracao();
 			throw e;
 		} catch (final Exception e) {
 			log.error("Erro ao assinar movimentação.", e);
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao assinar movimentação. "
-					+ e.getMessage(), 0, e);
+			throw new RuntimeException("Erro ao assinar movimentação. "
+					+ e.getMessage(), e);
 		}
 
 	}
@@ -2274,10 +2272,10 @@ public class ExBL extends CpBL {
 					+ ", na página " + pagPublicacao);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao cancelar juntada.", 0, e);
+			throw new RuntimeException("Erro ao cancelar juntada.", e);
 		}
 
 	}
@@ -2292,7 +2290,7 @@ public class ExBL extends CpBL {
 			concluirAlteracaoDocComRecalculoAcesso(doc);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao cancelar o documento.", 0, e);
+			throw new RuntimeException("Erro ao cancelar o documento.", e);
 		}
 	}
 
@@ -2386,10 +2384,10 @@ public class ExBL extends CpBL {
 			}
 
 			gravarMovimentacao(mov);
-			concluirAlteracaoComRecalculoAcesso(mov.getExMobil());
+			concluirAlteracaoComRecalculoAcesso(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao cancelar juntada.", 0, e);
+			throw new RuntimeException("Erro ao cancelar juntada.", e);
 		}
 	}
 
@@ -2480,26 +2478,6 @@ public class ExBL extends CpBL {
 		}
 	}
 
 !!!!!!
-	/**
-	 * @param map
-	 * @param form
-	 */
-	public static void mapFromUrlEncodedForm(Map map, final byte[] form) {
-		if (form != null) {
-			final String as[] = new String(form).split("&");
-			for (final String s : as) {
-				final String param[] = s.split("=");
-				try {
-					if (param.length == 2) {
-						map.put(param[0],
-								URLDecoder.decode(param[1], "iso-8859-1"));
-					}
-				} catch (final UnsupportedEncodingException e) {
-				}
-			}
-		}
-	}
-
 	public void cancelarMovimentacao(final DpPessoa cadastrante,
 			final DpLotacao lotaCadastrante, final ExMobil mob) {
 		try {
@@ -2558,7 +2536,15 @@ public class ExBL extends CpBL {
 				gravarMovimentacao(mov);
 
 				mov.setExMovimentacaoRef(ultMovNaoCancelada);
-				mov.setExNivelAcesso(ultMovNaoCancelada.getExNivelAcesso());
+				if (ultMovNaoCancelada.getExTipoMovimentacao()
+						.getIdTpMov() == ExTipoMovimentacao.TIPO_MOVIMENTACAO_REDEFINICAO_NIVEL_ACESSO) {
+					if (penultMovNaoCancelada != null)
+						mov.setExNivelAcesso(penultMovNaoCancelada.getExNivelAcesso());
+					else
+						mov.setExNivelAcesso(m.doc().getExNivelAcesso());
+				} else {
+					mov.setExNivelAcesso(ultMovNaoCancelada.getExNivelAcesso());
+				}
 
 				if (ultMovNaoCancelada.getExTipoMovimentacao().getIdTpMov() == ExTipoMovimentacao.TIPO_MOVIMENTACAO_AGENDAMENTO_DE_PUBLICACAO)
 					PublicacaoDJEBL.cancelarRemessaPublicacao(mov);
@@ -2632,10 +2618,10 @@ public class ExBL extends CpBL {
 				concluirAlteracaoParcialComRecalculoAcesso(m);
 			}
 
-			concluirAlteracao(null);
+			concluirAlteracao();
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao cancelar movimentação.", 0, e);
+			throw new RuntimeException("Erro ao cancelar movimentação.", e);
 			// throw e;
 		}
 	}
@@ -2657,7 +2643,7 @@ public class ExBL extends CpBL {
 				
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao remover data de devolução.", 0, e);
+			throw new RuntimeException("Erro ao remover data de devolução.", e);
 			// throw e;
 		}
 	}	
@@ -2744,13 +2730,13 @@ public class ExBL extends CpBL {
 
 			gravarMovimentacaoCancelamento(mov, movCancelar);
 			if (movCancelar.getIdTpMov() == ExTipoMovimentacao.TIPO_MOVIMENTACAO_VINCULACAO_PAPEL)
-				concluirAlteracaoComRecalculoAcesso(mov.getExMobil());
+				concluirAlteracaoComRecalculoAcesso(mov);
 			else	
-			   concluirAlteracao(mov.getExMobil());
+			   concluirAlteracao(mov);
 
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao cancelar movimentação.", 0, e);
+			throw new RuntimeException("Erro ao cancelar movimentação.", e);
 			// throw e;
 		}
 	}
@@ -2765,7 +2751,7 @@ public class ExBL extends CpBL {
 						
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao cancelar movimentaçôes replicadas.", 0, e);
+			throw new RuntimeException("Erro ao cancelar movimentaçôes replicadas.", e);
 		}
 	}
 	
@@ -2800,10 +2786,10 @@ public class ExBL extends CpBL {
 					lotaCadastrante, mob, null, null, null, null, null, null);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao criar nova via.", 0, e);
+			throw new RuntimeException("Erro ao criar nova via.", e);
 			// throw e;
 		}
 	}
@@ -2829,10 +2815,10 @@ public class ExBL extends CpBL {
 					cadastrante, lotaCadastrante, mob, dtMov, subscritor,
 					null, null, null, dt);
 			gravarMovimentacao(mov);
-			concluirAlteracao(mob);
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao reabrir.", 0, e);
+			throw new RuntimeException("Erro ao reabrir.", e);
 		}
 	}
 
@@ -2855,11 +2841,11 @@ public class ExBL extends CpBL {
 					cadastrante, lotaCadastrante, mob, dtMov, subscritor,
 					null, null, null, dt);
 			gravarMovimentacao(mov);
-			concluirAlteracao(mob);
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao desarquivar intermediário.",
-					0, e);
+			throw new RuntimeException("Erro ao desarquivar intermediário.",
+					e);
 		}
 	}
 
@@ -2886,10 +2872,10 @@ public class ExBL extends CpBL {
 				gravarMovimentacao(mov);
 				concluirAlteracaoParcial(m);
 			}
-			concluirAlteracao(null);
+			concluirAlteracao();
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao desobrestar.", 0, e);
+			throw new RuntimeException("Erro ao desobrestar.", e);
 		}
 	}
 
@@ -2908,11 +2894,11 @@ public class ExBL extends CpBL {
 							|| (mob.doc().isEletronico() 
 							&& mob.doc().getAssinaturasEAutenticacoesComTokenOuSenhaERegistros().isEmpty())))
 				processar(mob.getExDocumento(), true, false);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao excluir movimentação.", 0, e);
+			throw new RuntimeException("Erro ao excluir movimentação.", e);
 		}
 	}
 
@@ -3038,21 +3024,16 @@ public class ExBL extends CpBL {
 				criarVolume(cadastrante, lotaCadastrante, doc);
 			}
 
-			ContextoPersistencia.flushTransaction();
-
 			concluirAlteracaoDocComRecalculoAcesso(doc);			
 
-			ContextoPersistencia.flushTransaction();
-
 			if (setVias == null || setVias.size() == 0)
 				criarVia(cadastrante, lotaCadastrante, doc, null);
 
 			String s = processarComandosEmTag(doc, "finalizacao");
-			ContextoPersistencia.flushTransaction();
 			return s;
 		} catch (final Exception e) {
-			throw new AplicacaoException("Erro ao finalizar o documento: "
-					+ e.getMessage(), 0, e);
+			throw new RuntimeException("Erro ao finalizar o documento: "
+					+ e.getMessage(), e);
 		}
 	}
 
@@ -3102,7 +3083,7 @@ public class ExBL extends CpBL {
 					lotaCadastrante, mob, null, null, null, null, null, null);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mob);
+			concluirAlteracao(mov);
 			
 			if (mob.getNumSequencia() > 1) {
 				ExMobil mobApenso = mob.doc().getVolume(
@@ -3120,7 +3101,7 @@ public class ExBL extends CpBL {
 			}
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao criar novo volume.", 0, e);
+			throw new RuntimeException("Erro ao criar novo volume.", e);
 			// throw e;
 		}
 	}
@@ -3169,6 +3150,8 @@ public class ExBL extends CpBL {
 				}
 			}
 			{
+				// Nato: Esse flush é necessário porque o workflow precisará dos dados atualizados do documento para prosseguir
+				ContextoPersistencia.flushTransaction();
 				client.criarInstanciaDeProcesso(
 						nomeProcesso,
 						SiglaParser.makeSigla(cadastrante,
@@ -3177,7 +3160,7 @@ public class ExBL extends CpBL {
 						values);
 			}
 		}
-		atualizarWorkFlow(doc);
+		// atualizarWorkFlow(doc);
 	}
 
 	public static String descricaoSePuderAcessar(ExDocumento doc,
@@ -3687,7 +3670,7 @@ public class ExBL extends CpBL {
 
 			mov.getExMobil().getExMovimentacaoSet().add(mov);
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 		} catch (final Exception e) {
 			cancelarAlteracao();
@@ -3704,7 +3687,7 @@ public class ExBL extends CpBL {
 
 			dao().excluir(mov);
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 
 		} catch (final Exception e) {
 			cancelarAlteracao();
@@ -3923,7 +3906,7 @@ public class ExBL extends CpBL {
 
 			gravarMovimentacao(mov);
 			processar(doc, true, false);
-			concluirAlteracaoDocComRecalculoAcesso(doc);
+			concluirAlteracaoDocComRecalculoAcesso(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
 			throw new Exception("Erro ao incluir Cossignatário.", e);
@@ -4061,7 +4044,7 @@ public class ExBL extends CpBL {
 			if(!movs.isEmpty())
 				removerPendenciaDeDevolucao(movs, mob);
 						
-			concluirAlteracaoComRecalculoAcesso(mov.getExMobil());
+			concluirAlteracaoComRecalculoAcesso(mov);
 			
 		} catch (final Exception e) {
 			cancelarAlteracao();
@@ -4233,7 +4216,7 @@ public class ExBL extends CpBL {
 				try {
 					iniciarAlteracao();
 					gravarMovimentacao(novaMov);
-					concluirAlteracaoDoc(novaMov.getExDocumento());
+					concluirAlteracaoDoc(novaMov);
 				} catch (final Exception e) {
 					cancelarAlteracao();
 					throw new Exception(
@@ -4308,7 +4291,7 @@ public class ExBL extends CpBL {
 				gravarMovimentacao(mov);
 				concluirAlteracaoParcial(m);
 			}
-			concluirAlteracao(null);
+			concluirAlteracao();
 		} catch (final Exception e) {
 			cancelarAlteracao();
 			throw new Exception("Erro ao receber documento.", e);
@@ -4323,10 +4306,10 @@ public class ExBL extends CpBL {
 		// ExEstadoDoc.ESTADO_DOC_EM_ANDAMENTO, ExEstadoDoc.class,
 		// false));
 		// dao().gravar(mov);
-		// concluirAlteracao(mov.getExMobil());
+		// concluirAlteracao(mov);
 		// } catch (final Exception e) {
 		// cancelarAlteracao();
-		// throw new AplicacaoException("Erro ao receber documento.", 0, e);
+		// throw new AplicacaoException("Erro ao receber documento.", e);
 		//
 		// }
 
@@ -4353,7 +4336,7 @@ public class ExBL extends CpBL {
 			mov.setDescrMov(descrMov);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
 			throw new Exception(
@@ -4377,7 +4360,7 @@ public class ExBL extends CpBL {
 			mov.setDescrMov(descrMov);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
 			throw new Exception(
@@ -4419,7 +4402,7 @@ public class ExBL extends CpBL {
 					+ mov.getExMobilRef().getCodigo().toString());
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
 			throw new Exception("Erro ao vincular documento.", e);
@@ -4462,7 +4445,7 @@ public class ExBL extends CpBL {
 					+ mov.getExMobilRef().getCodigo().toString());
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
 			throw new Exception("Erro ao copiar documento.", e);
@@ -4489,7 +4472,7 @@ public class ExBL extends CpBL {
 					subscritor, null, null, null, null);
 
 			gravarMovimentacao(mov);
-			concluirAlteracaoDocComRecalculoAcesso(doc);
+			concluirAlteracaoDocComRecalculoAcesso(mov);
 
 			// Verifica se o documento possui documento pai e faz a juntada
 			// automática.
@@ -4498,8 +4481,9 @@ public class ExBL extends CpBL {
 						subscritor, titular, mov);
 			}
 
-			if (!fPreviamenteAssinado && !doc.isPendenteDeAssinatura())
+			if (!fPreviamenteAssinado && !doc.isPendenteDeAssinatura()) {
 				s = processarComandosEmTag(doc, "assinatura");
+			}
 		} catch (final Exception e) {
 			cancelarAlteracao();
 			throw new Exception("Erro ao registrar assinatura.", e);
@@ -4767,14 +4751,14 @@ public class ExBL extends CpBL {
 			if (fDespacho)
 				encerrarVolumeAutomatico(cadastrante, lotaCadastrante, mob, dtMovIni);
 			
-			concluirAlteracao(null);
+			concluirAlteracao();
 
 		} catch (final AplicacaoException e) {
 			cancelarAlteracao();
 			throw e;
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao transferir documento.", 0, e);
+			throw new RuntimeException("Erro ao transferir documento.", e);
 		}
 	}
 
@@ -4793,11 +4777,11 @@ public class ExBL extends CpBL {
 					+ " (" + lotaCadastrante.getNomeLotacao() + ")");
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao registrar acesso reservado.",
-					0, e);
+			throw new RuntimeException("Erro ao registrar acesso reservado.",
+					e);
 		}
 	}
 
@@ -4831,10 +4815,10 @@ public class ExBL extends CpBL {
 
 			atualizarDnmAnotacao(mov.getExMobil());
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao fazer anotação.", 0, e);
+			throw new RuntimeException("Erro ao fazer anotação.", e);
 		}
 	}
 
@@ -4870,11 +4854,11 @@ public class ExBL extends CpBL {
 			mov.setExPapel(papel);
 
 			gravarMovimentacao(mov);
-			concluirAlteracaoComRecalculoAcesso(mov.getExMobil());
+			concluirAlteracaoComRecalculoAcesso(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao fazer vinculação de papel.",
-					0, e);
+			throw new RuntimeException("Erro ao fazer vinculação de papel.",
+					e);
 		}
 
 	}
@@ -4906,10 +4890,10 @@ public class ExBL extends CpBL {
 				mov.setMarcador(marcador);
 
 				gravarMovimentacao(mov);
-				concluirAlteracao(mov.getExMobil());
+				concluirAlteracao(mov);
 			} catch (final Exception e) {
 				cancelarAlteracao();
-				throw new AplicacaoException("Erro ao fazer marcação.", 0, e);
+				throw new RuntimeException("Erro ao fazer marcação.", e);
 			}
 		} else {
 			Set<CpMarcador> set = new HashSet<CpMarcador>();
@@ -4958,14 +4942,18 @@ public class ExBL extends CpBL {
 					+ nivelAcesso.getNmNivelAcesso());
 
 			mov.setExNivelAcesso(nivelAcesso);
-			doc.setExNivelAcesso(nivelAcesso);
+			// A variável doc.exNivelAcesso deve conter o acesso
+			// da criação do documento e não pode ser alterada
+			// mais a frente. Para isso existe a dnmNivelAcesso.
+			//
+			// doc.setExNivelAcesso(nivelAcesso);
 
 			gravarMovimentacao(mov);
-			concluirAlteracaoComRecalculoAcesso(mov.getExMobil());
+			concluirAlteracaoComRecalculoAcesso(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao tentar redefinir nível de acesso", 0, e);
+			throw new RuntimeException(
+					"Erro ao tentar redefinir nível de acesso", e);
 		}
 	}
 
@@ -5005,7 +4993,7 @@ public class ExBL extends CpBL {
 		} catch (final Exception e) {
 			if (fGravarMov)
 				cancelarAlteracao();
-			throw new AplicacaoException("Erro ao exigir anexação.", 0, e);
+			throw new RuntimeException("Erro ao exigir anexação.", e);
 		}
 	}
 
@@ -5048,7 +5036,7 @@ public class ExBL extends CpBL {
 
 				// Internos antigos devem usar sempre o modelo 778L
 				Long backupID = null;
-				if (doc.getExTipoDocumento().getIdTpDoc() == 2) {
+				if (doc.getExTipoDocumento().getIdTpDoc() == ExTipoDocumento.TIPO_DOCUMENTO_INTERNO_FOLHA_DE_ROSTO) {
 					if (doc.getExModelo() != null)
 						backupID = doc.getExModelo().getIdMod();
 					
@@ -5069,12 +5057,12 @@ public class ExBL extends CpBL {
 					strHtml = processarModelo(doc, null, "processar_modelo",
 							null, null);
 				} catch (Exception e) {
-					throw new AplicacaoException(
-							"Erro no processamento do modelo HTML.", 0, e);
+					throw new RuntimeException(
+							"Erro no processamento do modelo HTML.", e);
 				}
 
 				// Restaurar o modelo do "Interno Antigo"
-				if (doc.getExTipoDocumento().getIdTpDoc() == 2) {
+				if (doc.getExTipoDocumento().getIdTpDoc() == ExTipoDocumento.TIPO_DOCUMENTO_INTERNO_FOLHA_DE_ROSTO) {
 					if (backupID != null) {
 						doc.setExModelo(dao().consultar(backupID,
 								ExModelo.class, false));
@@ -5095,9 +5083,9 @@ public class ExBL extends CpBL {
 					try {
 						pdf = Documento.generatePdf(strHtml, conversor);
 					} catch (Exception e) {
-						throw new AplicacaoException(
+						throw new RuntimeException(
 								"Erro na geração do PDF. Por favor, verifique se existem recursos de formatação não suportados. Para eliminar toda a formatação do texto clique em voltar e depois, no editor, clique no botõo de 'Selecionar Tudo' e depois no botão de 'Remover Formatação'.",
-								0, e);
+								e);
 					}
 					doc.setConteudoBlobPdf(pdf);
 				}
@@ -5119,7 +5107,7 @@ public class ExBL extends CpBL {
 			if (gravar && transacao) {
 				cancelarAlteracao();
 			}
-			throw new AplicacaoException("Erro na gravação", 0, e);
+			throw new RuntimeException("Erro na gravação", e);
 		}
 	}
 
@@ -5157,7 +5145,7 @@ public class ExBL extends CpBL {
 					form = doc.getConteudoBlob("doc.form");
 				else
 					form = mov.getConteudoBlob("doc.form");
-				mapFromUrlEncodedForm(attrs, form);
+				Utils.mapFromUrlEncodedForm(attrs, form);
 			}
 		}
 		if (acao != null)
@@ -5203,7 +5191,7 @@ public class ExBL extends CpBL {
 				}
 				// attrs.put("nmArqMod", "despacho_mov.jsp");
 				ExModelo m = dao().consultarExModelo(null,
-						"Despacho Automático");
+						MODELO_DESPACHO_AUTOMATICO);
 				attrs.put("nmMod", m.getNmMod());
 				attrs.put("template", new String(m.getConteudoBlobMod2(),
 						"utf-8"));
@@ -5549,23 +5537,39 @@ public class ExBL extends CpBL {
 		atualizarDnmAcesso(doc);
 	}
 	
+	private void concluirAlteracao() throws Exception {
+		concluirAlteracao(null, null, null, false);
+	}
+	
+	private void concluirAlteracao(ExMovimentacao mov) throws Exception {
+		concluirAlteracao(mov.getExDocumento(), mov.getExMobil(), mov, false);
+	}
+	
 	private void concluirAlteracao(ExMobil mob) throws Exception {
-		concluirAlteracao(mob, null, false);
+		concluirAlteracao(null, mob, null, false);
 	}
 	
 	private void concluirAlteracaoDoc(ExDocumento doc) throws Exception {
-		concluirAlteracao(null, doc, false);
+		concluirAlteracao(doc, null, null, false);
 	}
 	
-	private void concluirAlteracaoComRecalculoAcesso(ExMobil mob) throws Exception {
-		concluirAlteracao(mob, null, true);
+	private void concluirAlteracaoDoc(ExMovimentacao mov) throws Exception {
+		concluirAlteracao(mov.getExDocumento(), null, null, false);
+	}
+	
+	private void concluirAlteracaoComRecalculoAcesso(ExMovimentacao mov) throws Exception {
+		concluirAlteracao(null, mov.getExMobil(), mov, true);
 	}
 	
 	private void concluirAlteracaoDocComRecalculoAcesso(ExDocumento doc) throws Exception {
-		concluirAlteracao(null, doc, true);
+		concluirAlteracao(doc, null, null, true);
+	}
+
+	private void concluirAlteracaoDocComRecalculoAcesso(ExMovimentacao mov) throws Exception {
+		concluirAlteracao(mov.getExDocumento(), null, null, true);
 	}
 
-	private void concluirAlteracao(ExMobil mob, ExDocumento doc, boolean recalcularAcesso) throws Exception {
+	private void concluirAlteracao(ExDocumento doc, ExMobil mob, ExMovimentacao mov, boolean recalcularAcesso) throws Exception {
 		if (mob != null) {
 			if (mob.isGeral())
 				atualizarMarcas(mob.doc());
@@ -5578,21 +5582,45 @@ public class ExBL extends CpBL {
 			if (recalcularAcesso)
 				atualizarVariaveisDenormalizadas(doc);
 		}
-		ExDao.commitTransacao();
-		// if (doc != null)
-		// atualizarWorkflow(doc, null);
+		
+		
+		// Nato: meio confuso esse código de commitar a transação e depois atualizar o workflow, mas
+		// quis manter assim mesmo para não correr o risco de mudar alguma lógica e provocar algum erro
+		// inesperado.
+		boolean commited = false;
+		
+		if (mov != null && mov.getExMobilRef() != null) {
+			if (!commited) {
+				ContextoPersistencia.flushTransaction();
+				commited = true;
+			}
+			atualizarWorkFlow(mov.getExMobilRef().doc());
+		}
 
 		SortedSet<ExMobil> set = threadAlteracaoParcial.get();
 		if (set != null && set.size() > 0) {
 			for (ExMobil mobParcial : set) {
+				if (!commited) {
+					ContextoPersistencia.flushTransaction();
+					commited = true;
+				}
 				atualizarWorkflow(mobParcial.doc(), null);
 			}
 			set.clear();
 		} else {
 			if (mob != null) {
+				if (!commited) {
+					ContextoPersistencia.flushTransaction();
+					commited = true;
+				}
 				atualizarWorkflow(mob.doc(), null);
+			} else if (doc != null) {
+				if (!commited) {
+					ContextoPersistencia.flushTransaction();
+					commited = true;
+				}
+				atualizarWorkflow(doc, null);
 			}
-
 		}
 	}
 
@@ -5625,21 +5653,25 @@ public class ExBL extends CpBL {
 
 	public void atualizarWorkFlow(ExDocumento doc) throws AplicacaoException {
 		try {
-			Service.getWfService().atualizarWorkflowsDeDocumento(
-					doc.getCodigo());
+			if (doc.getIdDoc() != null) {
+				Service.getWfService().atualizarWorkflowsDeDocumento(
+						doc.getCodigo());
+			}
 		} catch (Exception ex) {
-			throw new AplicacaoException(
-					"Erro ao tentar atualizar estado do workflow", 0, ex);
+			throw new RuntimeException(
+					"Erro ao tentar atualizar estado do workflow", ex);
 		}
 	}
 
 	public void atualizarWorkFlow(ExMovimentacao mov) throws AplicacaoException {
 		try {
-			Service.getWfService().atualizarWorkflowsDeDocumento(
-					mov.getExMobil().getSigla());
+			if (mov.mob() != null && mov.getIdMov() != null && mov.mob().getIdMobil() != null && mov.mob().doc() != null && mov.mob().doc().getIdDoc() != null) {
+				Service.getWfService().atualizarWorkflowsDeDocumento(
+						mov.getExMobil().getSigla());
+			}
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"Erro ao tentar atualizar estado do workflow", 0, e);
+			throw new RuntimeException(
+					"Erro ao tentar atualizar estado do workflow", e);
 		}
 	}
 
@@ -5777,11 +5809,11 @@ public class ExBL extends CpBL {
 
 			gravarMovimentacao(mov);
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao incluir em edital de eliminação.", 0, e);
+			throw new RuntimeException(
+					"Erro ao incluir em edital de eliminação.", e);
 		}
 
 	}
@@ -5804,11 +5836,11 @@ public class ExBL extends CpBL {
 
 			gravarMovimentacao(mov);
 
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao retirar do edital de eliminação.", 0, e);
+			throw new RuntimeException(
+					"Erro ao retirar do edital de eliminação.", e);
 		}
 
 	}
@@ -5862,7 +5894,7 @@ public class ExBL extends CpBL {
 		try {
 			doc.getDescrCurta();
 		} catch (ObjectNotFoundException e) {
-			throw new AplicacaoException("Documento não encontrado", 0, e);
+			throw new RuntimeException("Documento não encontrado na base", e);
 		}
 
 		/*
@@ -5984,10 +6016,10 @@ public class ExBL extends CpBL {
 					+ mov.getExMobilRef().getCodigo().toString());
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao apensar documento.", 0, e);
+			throw new RuntimeException("Erro ao apensar documento.", e);
 		}
 	}
 
@@ -6039,10 +6071,10 @@ public class ExBL extends CpBL {
 			mov.setResp(mobMestre.getUltimaMovimentacaoNaoCancelada().getResp());
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mov.getExMobil());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao desapensar.", 0, e);
+			throw new RuntimeException("Erro ao desapensar.", e);
 		}
 
 	}
@@ -6120,13 +6152,13 @@ public class ExBL extends CpBL {
 				mov.setDescrMov("Volume encerrado automaticamente.");
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(mob);
+			concluirAlteracao(mov);
 		} catch (final AplicacaoException e) {
 			cancelarAlteracao();
 			throw e;
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao encerrar volume.", 0, e);
+			throw new RuntimeException("Erro ao encerrar volume.", e);
 		}
 	}
 
@@ -6194,7 +6226,7 @@ public class ExBL extends CpBL {
 			ExDao.commitTransacao();
 		} catch (Exception e) {
 			ExDao.rollbackTransacao();
-			throw new AplicacaoException("Erro ao salvar um modelo.", 0, e);
+			throw new RuntimeException("Erro ao salvar um modelo.", e);
 		}
 	}
 
@@ -6222,7 +6254,7 @@ public class ExBL extends CpBL {
 			ExDao.commitTransacao();
 		} catch (Exception e) {
 			ExDao.rollbackTransacao();
-			throw new AplicacaoException("Erro ao salvar um tipo.", 0, e);
+			throw new RuntimeException("Erro ao salvar um tipo.", e);
 		}
 	}
 
@@ -6259,12 +6291,12 @@ public class ExBL extends CpBL {
 				concluirAlteracaoParcial(mob);
 			}
 
-			concluirAlteracao(null);
+			concluirAlteracao();
 
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao anular cancelamento do documento.", 0, e);
+			throw new RuntimeException(
+					"Erro ao anular cancelamento do documento.", e);
 		}
 	}
 
@@ -6306,11 +6338,11 @@ public class ExBL extends CpBL {
 				obterMetodoPorString(funcao, doc);
 			}
 
-			concluirAlteracaoDocComRecalculoAcesso(doc);
+			concluirAlteracaoDocComRecalculoAcesso(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException(
-					"Erro ao tornar o documento sem efeito.", 0, e);
+			throw new RuntimeException(
+					"Erro ao tornar o documento sem efeito.", e);
 		}
 	}
 
@@ -6325,9 +6357,8 @@ public class ExBL extends CpBL {
 					identidadeCadastrante);
 
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"Erro ao copiar as propriedades do modelo anterior. "
-							+ e.getMessage());
+			throw new RuntimeException(
+					"Erro ao copiar as propriedades do modelo anterior.", e);
 		}
 
 	}
@@ -6379,8 +6410,8 @@ public class ExBL extends CpBL {
 			}
 
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"não foi possível fazer cópia dos modelos!");
+			throw new RuntimeException(
+					"não foi possível fazer cópia dos modelos!", e);
 		}
 	}
 
@@ -6406,8 +6437,8 @@ public class ExBL extends CpBL {
 
 			}
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"não foi possível fazer cópia das vias!");
+			throw new RuntimeException(
+					"não foi possível fazer cópia das vias!", e);
 		}
 	}
 
@@ -6479,8 +6510,8 @@ public class ExBL extends CpBL {
 			Set<ExModelo> setExModeloCriacaoVia = new HashSet<ExModelo>();
 			exClassCopia.setExModeloCriacaoViaSet(setExModeloCriacaoVia);
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"Erro ao copiar as propriedades do modelo anterior.");
+			throw new RuntimeException(
+					"Erro ao copiar as propriedades do modelo anterior.", e);
 		}
 
 		return exClassCopia;
@@ -6553,8 +6584,8 @@ public class ExBL extends CpBL {
 			exTempCopia.setExViaArqIntermediarioSet(setExViaArqInterm);
 
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"Erro ao copiar as propriedades do objeto ExTemporalidade.");
+			throw new RuntimeException(
+					"Erro ao copiar as propriedades do objeto ExTemporalidade.", e);
 		}
 
 		return exTempCopia;
@@ -6586,8 +6617,8 @@ public class ExBL extends CpBL {
 
 			}
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"não foi possível fazer cópia das vias em arquivo corrente!");
+			throw new RuntimeException(
+					"não foi possível fazer cópia das vias em arquivo corrente!", e);
 		}
 
 		// copiar Referências arq intermediário
@@ -6609,8 +6640,8 @@ public class ExBL extends CpBL {
 
 			}
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"não foi possível fazer cópia das vias em arquivo intermediário!");
+			throw new RuntimeException(
+					"não foi possível fazer cópia das vias em arquivo intermediário!", e);
 		}
 
 	}
@@ -6628,8 +6659,8 @@ public class ExBL extends CpBL {
 			exModCopia.updateAtivo();
 
 		} catch (Exception e) {
-			throw new AplicacaoException(
-					"Erro ao copiar as propriedades do modelo anterior.");
+			throw new RuntimeException(
+					"Erro ao copiar as propriedades do modelo anterior.", e);
 		}
 
 		return exModCopia;
@@ -7044,10 +7075,10 @@ public class ExBL extends CpBL {
 					null, null, null, null);
 
 			gravarMovimentacao(mov);
-			concluirAlteracao(doc.getMobilGeral());
+			concluirAlteracao(mov);
 		} catch (final Exception e) {
 			cancelarAlteracao();
-			throw new AplicacaoException("Erro ao revisar documento.", 0, e);
+			throw new RuntimeException("Erro ao revisar documento.", e);
 		}
 	}
 }
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExCompetenciaBL.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExCompetenciaBL.java
index 9fbb394730..551b6c11ed 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExCompetenciaBL.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExCompetenciaBL.java
@@ -613,6 +613,8 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 				ExTipoMovimentacao.TIPO_MOVIMENTACAO_COPIA,
 				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR, null, null, null, null, null, null);
 	
+	    Boolean podePorConfModelo = getConf().podePorConfiguracao(titular, lotaTitular, titular.getCargo(), titular.getFuncaoConfianca(), mob.doc().getExFormaDocumento(), mob.doc().getExModelo(), ExTipoMovimentacao.TIPO_MOVIMENTACAO_COPIA, CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
+		
 		return mob.doc().isFinalizado() && !mob.isEmTransito()
 				&& (!mob.isGeral() || mob.doc().isExterno())
 				&& !mob.isJuntado()
@@ -621,7 +623,8 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 				&& !mob.isSobrestado()
 				&& podeMovimentar(titular, lotaTitular, mob)
 				&& !mob.doc().isSemEfeito()
-				&& podePorConf;
+				&& podePorConf
+				&& podePorConfModelo;
 	}
 
 	/**
@@ -1192,12 +1195,39 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 		
 		ExTipoMovimentacao exTpMov = ExDao.getInstance().consultar(ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_COM_SENHA,
 				ExTipoMovimentacao.class, false);
-
+		
 		return getConf().podePorConfiguracao(null, null, null, null, mob.doc().getExFormaDocumento(), mob.doc().getExModelo(), null,
 				null, exTpMov, null, null, null, lotaTitular, titular, null,null,
 				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
 	}
 	
+	/*
+	 * Retorna se é default assinar um documento com senha:
+	 * 
+	 * @param titular
+	 * @param lotaTitular
+	 * @param mob
+	 * @return
+	 * @throws Exception
+	 */
+	public boolean deveAssinarComSenha(final DpPessoa titular,
+			final DpLotacao lotaTitular, final ExMobil mob) {
+		
+		ExTipoMovimentacao exTpMov = ExDao.getInstance().consultar(ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_COM_SENHA,
+				ExTipoMovimentacao.class, false);
+		
+		CpSituacaoConfiguracao situacao = getConf().situacaoPorConfiguracao(null, null, null, null, mob.doc().getExFormaDocumento(), mob.doc().getExModelo(), null,
+				null, exTpMov, null, null, null, lotaTitular, titular, null,null,
+				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
+		
+		if (situacao != null
+				&& (situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_DEFAULT ||
+						situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_OBRIGATORIO))
+			return true;
+
+		return false; 
+	}
+	
 	/*
 	 * Retorna se pode autenticar um documento que só foi assinado com senha.
 	 * 
@@ -1291,6 +1321,26 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
 	}
 	
+	public boolean deveAssinarMovimentacaoComSenha(final DpPessoa titular,
+			final DpLotacao lotaTitular, final ExMovimentacao mov) {
+
+		ExTipoMovimentacao exTpMov = ExDao.getInstance().consultar(ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_MOVIMENTACAO_COM_SENHA,
+				ExTipoMovimentacao.class, false);
+
+		CpSituacaoConfiguracao situacao = getConf().situacaoPorConfiguracao(null, null, null, null, mov.getExMobil().getExDocumento().getExFormaDocumento(), mov.getExMobil().getExDocumento().getExModelo(), null,
+				null, exTpMov, null, null, null, lotaTitular, titular, null,null,
+				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
+		
+		if (situacao != null
+				&& (situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_DEFAULT ||
+						situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_OBRIGATORIO))
+			return true;
+
+		return false; 
+	}
+	
+
+	
 	/*
 	 * Retorna se é possível assinar movimentações do mobil com senha:
 	 * 
@@ -1337,6 +1387,30 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
 	}	
 	
+	public boolean deveAutenticarMovimentacaoComSenha(final DpPessoa titular,
+			final DpLotacao lotaTitular, final ExMovimentacao mov) throws Exception {
+		
+		if(mov == null)
+			return false;
+		
+		if(!mov.getExTipoMovimentacao().getIdTpMov().equals(ExTipoMovimentacao.TIPO_MOVIMENTACAO_ANEXACAO))
+			return false;
+
+		ExTipoMovimentacao exTpMov = ExDao.getInstance().consultar(ExTipoMovimentacao.TIPO_MOVIMENTACAO_CONFERENCIA_COPIA_COM_SENHA,
+				ExTipoMovimentacao.class, false);
+		
+		CpSituacaoConfiguracao situacao = getConf().situacaoPorConfiguracao(null, null, null, null, mov.getExMobil().getExDocumento().getExFormaDocumento(), mov.getExMobil().getExDocumento().getExModelo(), null,
+				null, exTpMov, null, null, null, lotaTitular, titular, null,null,
+				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
+		
+		if (situacao != null
+				&& (situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_DEFAULT ||
+						situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_OBRIGATORIO))
+			return true;
+
+		return false; 
+	}	
+	
 	/*
 	 * Retorna se é possível cópia de um movimentações do mobil com senha:
 	 * 
@@ -1359,6 +1433,28 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 				null, exTpMov, null, null, null, lotaTitular, titular, null,null,
 				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
 	}	
+	
+	public boolean deveAutenticarComSenha(final DpPessoa titular,
+			final DpLotacao lotaTitular, final ExMobil mob) throws Exception {
+		
+		if(mob == null)
+			return false;
+
+		ExTipoMovimentacao exTpMov = ExDao.getInstance().consultar(ExTipoMovimentacao.TIPO_MOVIMENTACAO_CONFERENCIA_COPIA_COM_SENHA,
+				ExTipoMovimentacao.class, false);
+
+		CpSituacaoConfiguracao situacao = getConf().situacaoPorConfiguracao(null, null, null, null, mob.getExDocumento().getExFormaDocumento(), mob.getExDocumento().getExModelo(), null,
+				null, exTpMov, null, null, null, lotaTitular, titular, null,null,
+				CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR);
+		
+		if (situacao != null
+				&& (situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_DEFAULT ||
+						situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_OBRIGATORIO))
+			return true;
+
+		return false; 
+
+	}	
 	public boolean podeSerSubscritor(final ExDocumento doc) {
 		
 		if(doc.isExterno() || doc.isExternoCapturado())
@@ -1784,7 +1880,7 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 				|| exUltMovNaoCanc.getExTipoMovimentacao().getIdTpMov() == ExTipoMovimentacao.TIPO_MOVIMENTACAO_REGISTRO_ASSINATURA_DOCUMENTO
 				|| exUltMovNaoCanc.getExTipoMovimentacao().getIdTpMov() == ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_DIGITAL_DOCUMENTO
 				|| exUltMovNaoCanc.getExTipoMovimentacao().getIdTpMov() == ExTipoMovimentacao.TIPO_MOVIMENTACAO_SOLICITACAO_DE_ASSINATURA) {
-			return exUltMovNaoCanc.getLotaTitular().equivale(lotaTitular);
+			return exUltMovNaoCanc.getLotaTitular() != null && exUltMovNaoCanc.getLotaTitular().equivale(lotaTitular);
 		} else {
 			if (exUltMovNaoCanc.getLotaResp() != null) {
 				if (!exUltMovNaoCanc.getLotaResp().equivale(lotaTitular))
@@ -2553,7 +2649,8 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 		
 		return (mob.getExDocumento().isFinalizado())								
 				&& !mob.isEmTransito()
-				&& podeMovimentar(titular, lotaTitular, mob);
+				&& podeMovimentar(titular, lotaTitular, mob)
+				&& getConf().podePorConfiguracao(titular, lotaTitular, mob.doc().getExModelo(), CpTipoConfiguracao.TIPO_CONFIG_JUNTADA_AUTOMATICA);
 
 	}
 	
@@ -4465,8 +4562,7 @@ public class ExCompetenciaBL extends CpCompetenciaBL {
 		final boolean podeMovimentar = podeMovimentar(titular, lotaTitular, mob);
 
 		return (!mob.isGeral() && mob.doc().isExpediente()
-				&& !mob.doc().isPendenteDeAssinatura() && !mob.isEmTransito() && podeMovimentar);
-
+				&& !mob.doc().isPendenteDeAssinatura() && !mob.isEmTransito() && podeMovimentar && getConf().podePorConfiguracao(titular, lotaTitular, ExTipoMovimentacao.TIPO_MOVIMENTACAO_AUTUAR, CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR) && getConf().podePorConfiguracao(titular, lotaTitular, titular.getCargo(), titular.getFuncaoConfianca(), mob.doc().getExFormaDocumento(), mob.doc().getExModelo(), ExTipoMovimentacao.TIPO_MOVIMENTACAO_AUTUAR, CpTipoConfiguracao.TIPO_CONFIG_MOVIMENTAR));
 	}
 
 }
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExConfiguracaoBL.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExConfiguracaoBL.java
index 59acb2f026..54ce505800 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExConfiguracaoBL.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/ExConfiguracaoBL.java
@@ -277,58 +277,70 @@ public class ExConfiguracaoBL extends CpConfiguracaoBL {
 			long idTpConf, DpPessoa pessoaObjeto, 
 			DpLotacao lotacaoObjeto, CpComplexo complexoObjeto, DpCargo cargoObjeto, 
 			DpFuncaoConfianca funcaoConfiancaObjeto, CpOrgaoUsuario orgaoObjeto) {
-
-		if (isUsuarioRoot(dpPessoa) && idTpConf != CpTipoConfiguracao.TIPO_CONFIG_UTILIZAR_EXTENSAO_CONVERSOR_HTML){
+		CpSituacaoConfiguracao situacao = situacaoPorConfiguracao(cpServico, exTipoFormaDoc, exPapel, exTpDoc,
+				exFormaDoc, exMod, exClassificacao, exVia, exTpMov, cargo, cpOrgaoUsu, dpFuncaoConfianca, dpLotacao,
+				dpPessoa, nivelAcesso, cpTpLotacao, idTpConf, pessoaObjeto, lotacaoObjeto, complexoObjeto, cargoObjeto,
+				funcaoConfiancaObjeto, orgaoObjeto);
+		if (situacao != null
+				&& (situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_PODE ||
+						situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_DEFAULT ||
+						situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_OBRIGATORIO))
 			return true;
-		}
-
-		try {
-			ExConfiguracao config = new ExConfiguracao();
-			config.setCargo(cargo);
-			config.setOrgaoUsuario(cpOrgaoUsu);
-			config.setFuncaoConfianca(dpFuncaoConfianca);
-			config.setLotacao(dpLotacao);
-			config.setDpPessoa(dpPessoa);
-			config.setCpTipoConfiguracao(CpDao.getInstance().consultar(idTpConf,
-					CpTipoConfiguracao.class, false));
-			config.setCpTipoLotacao(cpTpLotacao);
-
-			config.setCpServico(cpServico);
-			config.setExTipoFormaDoc(exTipoFormaDoc);
-			config.setExPapel(exPapel);
-			config.setExTipoDocumento(exTpDoc);
-			config.setExFormaDocumento(exFormaDoc);
-			config.setExModelo(exMod);
-			config.setExClassificacao(exClassificacao);
-			config.setExVia(exVia);
-			config.setExTipoMovimentacao(exTpMov);
-			config.setExNivelAcesso(nivelAcesso);
-			
-			config.setPessoaObjeto(pessoaObjeto);
-			config.setLotacaoObjeto(lotacaoObjeto);
-			config.setComplexoObjeto(complexoObjeto);
-			config.setCargoObjeto(cargoObjeto);
-			config.setFuncaoConfiancaObjeto(funcaoConfiancaObjeto);
-			config.setOrgaoObjeto(orgaoObjeto);
-
-			CpConfiguracao cfg = (CpConfiguracao) buscaConfiguracao(config,
-					new int[] { 0 }, null);
-
-			CpSituacaoConfiguracao situacao;
-			if (cfg != null)
-				situacao = cfg.getCpSituacaoConfiguracao();
-			else
-				situacao = config.getCpTipoConfiguracao().getSituacaoDefault();
-
-			if (situacao != null
-					&& situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_PODE)
-				return true;
-		} catch (Exception e) {
-			return false;
-		}		
 		return false;
 	}
 	
+	
+	public CpSituacaoConfiguracao situacaoPorConfiguracao(CpServico cpServico,
+			ExTipoFormaDoc exTipoFormaDoc, ExPapel exPapel,
+			ExTipoDocumento exTpDoc, ExFormaDocumento exFormaDoc,
+			ExModelo exMod, ExClassificacao exClassificacao, ExVia exVia,
+			ExTipoMovimentacao exTpMov, DpCargo cargo,
+			CpOrgaoUsuario cpOrgaoUsu, DpFuncaoConfianca dpFuncaoConfianca,
+			DpLotacao dpLotacao, DpPessoa dpPessoa, ExNivelAcesso nivelAcesso, CpTipoLotacao cpTpLotacao,
+			long idTpConf, DpPessoa pessoaObjeto, 
+			DpLotacao lotacaoObjeto, CpComplexo complexoObjeto, DpCargo cargoObjeto, 
+			DpFuncaoConfianca funcaoConfiancaObjeto, CpOrgaoUsuario orgaoObjeto) {
+
+		ExConfiguracao config = new ExConfiguracao();
+		config.setCargo(cargo);
+		config.setOrgaoUsuario(cpOrgaoUsu);
+		config.setFuncaoConfianca(dpFuncaoConfianca);
+		config.setLotacao(dpLotacao);
+		config.setDpPessoa(dpPessoa);
+		config.setCpTipoConfiguracao(CpDao.getInstance().consultar(idTpConf,
+				CpTipoConfiguracao.class, false));
+		config.setCpTipoLotacao(cpTpLotacao);
+
+		config.setCpServico(cpServico);
+		config.setExTipoFormaDoc(exTipoFormaDoc);
+		config.setExPapel(exPapel);
+		config.setExTipoDocumento(exTpDoc);
+		config.setExFormaDocumento(exFormaDoc);
+		config.setExModelo(exMod);
+		config.setExClassificacao(exClassificacao);
+		config.setExVia(exVia);
+		config.setExTipoMovimentacao(exTpMov);
+		config.setExNivelAcesso(nivelAcesso);
+		
+		config.setPessoaObjeto(pessoaObjeto);
+		config.setLotacaoObjeto(lotacaoObjeto);
+		config.setComplexoObjeto(complexoObjeto);
+		config.setCargoObjeto(cargoObjeto);
+		config.setFuncaoConfiancaObjeto(funcaoConfiancaObjeto);
+		config.setOrgaoObjeto(orgaoObjeto);
+
+		CpConfiguracao cfg = (CpConfiguracao) buscaConfiguracao(config,
+				new int[] { 0 }, null);
+
+		CpSituacaoConfiguracao situacao;
+		if (cfg != null)
+			situacao = cfg.getCpSituacaoConfiguracao();
+		else
+			situacao = config.getCpTipoConfiguracao().getSituacaoDefault();
+		
+		return situacao;
+	}
+	
 	public boolean podePorConfiguracao(CpServico cpServico,
 			ExTipoFormaDoc exTipoFormaDoc, ExPapel exPapel,
 			ExTipoDocumento exTpDoc, ExFormaDocumento exFormaDoc,
@@ -347,6 +359,24 @@ public class ExConfiguracaoBL extends CpConfiguracaoBL {
 				idTpConf, null, null, null, null, null, null);
 	}
 
+	public CpSituacaoConfiguracao situacaoPorConfiguracao(CpServico cpServico,
+			ExTipoFormaDoc exTipoFormaDoc, ExPapel exPapel,
+			ExTipoDocumento exTpDoc, ExFormaDocumento exFormaDoc,
+			ExModelo exMod, ExClassificacao exClassificacao, ExVia exVia,
+			ExTipoMovimentacao exTpMov, DpCargo cargo,
+			CpOrgaoUsuario cpOrgaoUsu, DpFuncaoConfianca dpFuncaoConfianca,
+			DpLotacao dpLotacao, DpPessoa dpPessoa, ExNivelAcesso nivelAcesso, CpTipoLotacao cpTpLotacao,
+			long idTpConf) {
+		return situacaoPorConfiguracao(cpServico,
+				exTipoFormaDoc, exPapel,
+				exTpDoc, exFormaDoc,
+				exMod, exClassificacao, exVia,
+				exTpMov, cargo,
+				cpOrgaoUsu, dpFuncaoConfianca,
+				dpLotacao, dpPessoa, nivelAcesso, cpTpLotacao,
+				idTpConf, null, null, null, null, null, null);
+	}
+
 
 	/**
 	 * 
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/Mesa.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/Mesa.java
index 914c9e27d6..9b3fe6beea 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/Mesa.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/bl/Mesa.java
@@ -68,24 +68,24 @@ public class Mesa {
 		//
 		CAIXA_DE_ENTRADA("Caixa de Entrada", "fas fa-inbox"),
 		//
-		EM_ELABORACAO("Em Elaboração", "far fa-lightbulb"),
+		EM_ELABORACAO("Em Elaboração", "fas fa-lightbulb"),
 		//
-		AGUARDANDO_ANDAMENTO("Aguardando Andamento", "far fa-clock"),
+		AGUARDANDO_ANDAMENTO("Aguardando Andamento", "fas fa-clock"),
 		//
 		CAIXA_DE_SAIDA("Caixa de Saída", "fas fa-inbox"),
 		//
 		ACOMPANHANDO("Acompanhando", "fas fa-tags"),
 		//
-		MONITORANDO("Monitorando", "far fa-hourglass-half"),
+		MONITORANDO("Monitorando", "fas fa-hourglass-half"),
 		//
 		AGUARDANDO_ACAO_DE_TEMPORALIDADE("Aguardando Ação de Temporalidade",
-				"far fa-hourglass-half"),
+				"fas fa-hourglass-half"),
 		//
-		OUTROS("Outros", "far fa-inbox"),
+		OUTROS("Outros", "fas fa-inbox"),
 		//
-		QUALQUER("Qualquer", "far fa-inbox"),
+		QUALQUER("Qualquer", "fas fa-inbox"),
 		//
-		NENHUM("Nenhum", "far fa-inbox");
+		NENHUM("Nenhum", "fas fa-inbox");
 
 		private final String nome;
 		private final String icone;
@@ -98,23 +98,23 @@ public class Mesa {
 
 	public enum MarcadorEnum {
 		//
-		EM_ELABORACAO(1, "Em Elaboração", "far fa-lightbulb", "",
+		EM_ELABORACAO(1, "Em Elaboração", "fas fa-lightbulb", "",
 				GrupoDeMarcadorEnum.EM_ELABORACAO),
 		//
-		EM_ANDAMENTO(2, "Aguardando Andamento", "far fa-clock", "",
+		EM_ANDAMENTO(2, "Aguardando Andamento", "fas fa-clock", "",
 				GrupoDeMarcadorEnum.AGUARDANDO_ANDAMENTO),
 		//
-		A_RECEBER(3, "A Receber", "far fa-inbox", "",
+		A_RECEBER(3, "A Receber", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.CAIXA_DE_ENTRADA),
 		//
-		EXTRAVIADO(4, "Extraviado", "far fa-inbox", "", GrupoDeMarcadorEnum.ALERTA),
+		EXTRAVIADO(4, "Extraviado", "fas fa-inbox", "", GrupoDeMarcadorEnum.ALERTA),
 		//
-		A_ARQUIVAR(5, "A Arquivar", "far fa-inbox", "", GrupoDeMarcadorEnum.OUTROS),
+		A_ARQUIVAR(5, "A Arquivar", "fas fa-inbox", "", GrupoDeMarcadorEnum.OUTROS),
 		//
-		ARQUIVADO_CORRENTE(6, "Arquivado Corrente", "far fa-inbox", "",
+		ARQUIVADO_CORRENTE(6, "Arquivado Corrente", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.OUTROS),
 		//
-		A_ELIMINAR(7, "A Eliminar", "far fa-inbox", "",
+		A_ELIMINAR(7, "A Eliminar", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.AGUARDANDO_ACAO_DE_TEMPORALIDADE),
 		//
 		ELIMINADO(8, "Eliminado", "fas fa-power-off", "", GrupoDeMarcadorEnum.OUTROS),
@@ -126,23 +126,23 @@ public class Mesa {
 		//
 		CANCELADO(10, "Cancelado", "fas fa-ban", "", GrupoDeMarcadorEnum.OUTROS),
 		//
-		TRANSFERIDO_A_ORGAO_EXTERNO(11, "Tranferido a Órgão Externo", "far fa-paper-plane",
+		TRANSFERIDO_A_ORGAO_EXTERNO(11, "Tranferido a Órgão Externo", "fas fa-paper-plane",
 				"", GrupoDeMarcadorEnum.OUTROS),
 
 		//
-		ARQUIVADO_INTERMEDIARIO(12, "Arquivado Intermediário", "far fa-inbox", "",
+		ARQUIVADO_INTERMEDIARIO(12, "Arquivado Intermediário", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.OUTROS),
 		//
-		CAIXA_DE_ENTRADA(14, "A Receber", "far fa-inbox", "",
+		CAIXA_DE_ENTRADA(14, "A Receber", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.CAIXA_DE_ENTRADA),
 		//
-		ARQUIVADO_PERMANENTE(13, "Arquivado Permanente", "far fa-inbox", "",
+		ARQUIVADO_PERMANENTE(13, "Arquivado Permanente", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.OUTROS),
 		//
 		PENDENTE_DE_ASSINATURA(15, "Pendente de Assinatura", "fas fa-key", "",
 				GrupoDeMarcadorEnum.AGUARDANDO_ANDAMENTO),
 		//
-		JUNTADO_A_DOCUMENTO_EXTERNO(16, "Juntado a Documento Externo", "far fa-inbox",
+		JUNTADO_A_DOCUMENTO_EXTERNO(16, "Juntado a Documento Externo", "fas fa-inbox",
 				"", GrupoDeMarcadorEnum.OUTROS),
 		//
 		A_REMETER_PARA_PUBLICACAO(17, "A Remeter para Publicação", "fas fa-scroll", "",
@@ -238,15 +238,15 @@ public class Mesa {
 		SOLICITACAO_COMO_SOLICITANTE(49, "Solicitante", "inbox", "",
 				GrupoDeMarcadorEnum.AGUARDANDO_ANDAMENTO),
 		//
-		RECOLHER_PARA_ARQUIVO_PERMANENTE(50, "Recolher Arq. Permante", "far fa-inbox",
+		RECOLHER_PARA_ARQUIVO_PERMANENTE(50, "Recolher Arq. Permante", "fas fa-inbox",
 				"", GrupoDeMarcadorEnum.AGUARDANDO_ACAO_DE_TEMPORALIDADE),
 
 		//
 		TRANSFERIR_PARA_ARQUIVO_INTERMEDIARIO(51,
-				"Transferir Arq. Intermediário", "far fa-inbox", "",
+				"Transferir Arq. Intermediário", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.AGUARDANDO_ACAO_DE_TEMPORALIDADE),
 		//
-		EM_EDITAL_DE_ELIMINACAO(52, "Em Edital de Eliminação", "far fa-inbox", "",
+		EM_EDITAL_DE_ELIMINACAO(52, "Em Edital de Eliminação", "fas fa-inbox", "",
 				GrupoDeMarcadorEnum.AGUARDANDO_ANDAMENTO),
 		//
 		SOLICITACAO_FECHADO_PARCIAL(53, "Fechado Parcial", "inbox", "",
@@ -259,7 +259,7 @@ public class Mesa {
 				GrupoDeMarcadorEnum.AGUARDANDO_ANDAMENTO),
 
 		//
-		AGUARDANDO(57, "Aguardando", "far fa-clock", "",
+		AGUARDANDO(57, "Aguardando", "fas fa-clock", "",
 				GrupoDeMarcadorEnum.AGUARDANDO_ANDAMENTO),
 		//
 		A_DEVOLVER_FORA_DO_PRAZO(58, "A Devolver Fora do Prazo", "fas fa-exchange-alt", "",
@@ -269,7 +269,7 @@ public class Mesa {
 				"Aguardando Devolução Fora Do Prazo", "fas fa-exchange-alt", "",
 				GrupoDeMarcadorEnum.ALERTA),
 		//
-		PENDENTE_DE_ANEXACAO(60, "Pendente de Anexação", "far fa-arrow-alt-circle-up", "",
+		PENDENTE_DE_ANEXACAO(60, "Pendente de Anexação", "fas fa-arrow-alt-circle-up", "",
 				GrupoDeMarcadorEnum.ALERTA),
 		//
 		SOLICITACAO_EM_ELABORACAO(61, "Em Elaboração", "inbox", "",
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FreemarkerDefault.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FreemarkerDefault.java
index 6a33bc2576..fd756436f7 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FreemarkerDefault.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FreemarkerDefault.java
@@ -1,8 +1,6 @@
 package br.gov.jfrj.siga.ex.util;
 
-import java.io.IOException;
 import java.io.InputStream;
-import java.io.UnsupportedEncodingException;
 import java.nio.file.Files;
 import java.nio.file.Paths;
 
@@ -13,21 +11,32 @@ import br.gov.jfrj.siga.ex.bl.Ex;
 public class FreemarkerDefault {
 	public static String getDefaultTemplate() {
 		try {
-			String pathname = Ex
-					.getInstance()
-					.getProp()
-					.obterPropriedade("siga.ex.debug.default.template.pathname");
+			String pathname = Ex.getInstance().getProp().obterPropriedade("siga.ex.debug.default.template.pathname");
 			if (pathname != null)
-				return new String(Files.readAllBytes(Paths.get(pathname)),
-						"UTF-8");
+				return new String(Files.readAllBytes(Paths.get(pathname)), "UTF-8");
 		} catch (Exception e1) {
 		}
 
 		String template;
 		try (InputStream stream = FreemarkerDefault.class.getClassLoader()
-				.getResourceAsStream(
-						"br/gov/jfrj/siga/ex/util/" + "default.ftl")) {
+				.getResourceAsStream("br/gov/jfrj/siga/ex/util/" + "default.ftl")) {
 			template = IOUtils.toString(stream, "UTF-8");
+
+			String pathBrasao = Ex.getInstance().getProp().obterPropriedade("siga.ex.default.template.brasao") + "";
+			if (pathBrasao != null)
+				template = template.replaceAll("\\[#assign _pathBrasao = \"([^\"]+)\" /\\]",
+						"[#assign _pathBrasao = \"" + pathBrasao + "\" /]");
+
+			String tituloGeral = Ex.getInstance().getProp().obterPropriedade("siga.ex.default.template.titulo");
+			if (tituloGeral != null)
+				template = template.replaceAll("\\[#assign _tituloGeral = \"[^\"]+\" /\\]",
+						"[#assign _tituloGeral = \"" + tituloGeral + "\" /]");
+
+			String subtituloGeral = Ex.getInstance().getProp().obterPropriedade("siga.ex.default.template.subtitulo");
+			if (subtituloGeral != null)
+				template = template.replaceAll("\\[#assign _subtituloGeral = \"[^\"]+\" /\\]",
+						"[#assign _subtituloGeral = \"" + subtituloGeral + "\" /]");
+
 			return template;
 		} catch (Exception e) {
 			throw new RuntimeException(e);
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FuncoesEL.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FuncoesEL.java
index 8b5c1f9ab1..6436d7e153 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FuncoesEL.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/FuncoesEL.java
@@ -671,15 +671,6 @@ public class FuncoesEL {
 	public static Boolean criarWorkflow(String nomeProcesso, ExDocumento d,
 			DpPessoa cadastrante, DpPessoa titular, DpLotacao lotaCadastrante,
 			DpLotacao lotaTitular) throws Exception {
-
-		// Nato: Nesse caso, o titular ï¿½ considerado o subscritor do
-		// documento.
-		// Nï¿½o sei se isso ï¿½ 100% correto, mas acho que ï¿½ uma abordagem
-		// bastante
-		// razoï¿½vel.
-		// Markenson: Conversando com o Renato, alteramos o titular para o
-		// titular do sistema
-		// e nï¿½o do documento.
 		Ex.getInstance()
 				.getBL()
 				.criarWorkflow(cadastrante,
@@ -985,6 +976,9 @@ public class FuncoesEL {
 		try {
 			HashMap<String, String> headers = new HashMap<String, String>();
 			headers.put("Content-Type", "text/xml;charset=UTF-8");
+			String auth = (String) resource("siga.freemarker.webservice.password");
+			if (auth != null)
+				headers.put("Authorization", auth);
 			// String s = ConexaoHTTP.get(url, headers, timeout, corpo);
 			// //Reescrito para utilizar o SigaTTP
 			SigaHTTP sigaHTTP = new SigaHTTP();
@@ -1011,12 +1005,24 @@ public class FuncoesEL {
 				.podeAssinarComSenha(titular, lotaTitular, mob);
 	}
 
+	public static Boolean deveAssinarComSenha(DpPessoa titular,
+			DpLotacao lotaTitular, ExMobil mob) throws Exception {
+		return Ex.getInstance().getComp()
+				.deveAssinarComSenha(titular, lotaTitular, mob);
+	}
+
 	public static Boolean podeAssinarMovimentacaoComSenha(DpPessoa titular,
 			DpLotacao lotaTitular, ExMovimentacao mov) throws Exception {
 		return Ex.getInstance().getComp()
 				.podeAssinarMovimentacaoComSenha(titular, lotaTitular, mov);
 	}
 
+	public static Boolean deveAssinarMovimentacaoComSenha(DpPessoa titular,
+			DpLotacao lotaTitular, ExMovimentacao mov) throws Exception {
+		return Ex.getInstance().getComp()
+				.deveAssinarMovimentacaoComSenha(titular, lotaTitular, mov);
+	}
+
 	public static Boolean podeAutenticarMovimentacaoComSenha(
 			DpPessoa titular, DpLotacao lotaTitular, ExMovimentacao mov)
 			throws Exception {
@@ -1027,6 +1033,16 @@ public class FuncoesEL {
 						mov);
 	}
 
+	public static Boolean deveAutenticarMovimentacaoComSenha(
+			DpPessoa titular, DpLotacao lotaTitular, ExMovimentacao mov)
+			throws Exception {
+		return Ex
+				.getInstance()
+				.getComp()
+				.deveAutenticarMovimentacaoComSenha(titular, lotaTitular,
+						mov);
+	}
+
 	public static Boolean podeAssinarMovimentacaoComSenha(DpPessoa titular,
 			DpLotacao lotaTitular, ExMobil mob) throws Exception {
 		return Ex.getInstance().getComp()
@@ -1043,6 +1059,16 @@ public class FuncoesEL {
 						mob);
 	}
 
+	public static Boolean deveAutenticarComSenha(
+			DpPessoa titular, DpLotacao lotaTitular, ExMobil mob)
+			throws Exception {
+		return Ex
+				.getInstance()
+				.getComp()
+				.deveAutenticarComSenha(titular, lotaTitular,
+						mob);
+	}
+
 	public static Boolean podeAutenticarDocumento(DpPessoa titular,
 			DpLotacao lotaTitular, ExDocumento doc) throws Exception {
 		return Ex.getInstance().getComp()
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/GeradorRTF.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/GeradorRTF.java
index 10d7133daf..4a0a108041 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/GeradorRTF.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/GeradorRTF.java
@@ -168,6 +168,8 @@ public class GeradorRTF {
 				fimNumero = "FIM NUMERO -->";
 			}
 
+			assertContemTags(doc.getCodigo(), html, "número", inicioNumero, fimNumero);
+				
 			htmlDocPrincipal = html.substring(html.indexOf(inicioNumero)
 					+ inicioNumero.length(), html.indexOf(fimNumero))
 					+ "<br />";
@@ -176,6 +178,7 @@ public class GeradorRTF {
 			String inicioTituloForm = "<!-- INICIO TITULO";
 			String fimTituloForm = "FIM TITULO -->";
 
+			assertContemTags(doc.getCodigo(), html, "título", inicioTituloForm, fimTituloForm);
 			if (html.contains(inicioTituloForm))
 				htmlTitulo = html.substring(html.indexOf(inicioTituloForm)
 						+ inicioTituloForm.length(),
@@ -183,6 +186,7 @@ public class GeradorRTF {
 
 			String inicioMiolo = "<!-- INICIO MIOLO -->";
 			String fimMiolo = "<!-- FIM MIOLO -->";
+			assertContemTags(doc.getCodigo(), html, "conteúdo do documento", inicioMiolo, fimMiolo);
 			html = htmlTitulo
 					+ html.substring(
 							html.indexOf(inicioMiolo) + inicioMiolo.length(),
@@ -197,11 +201,13 @@ public class GeradorRTF {
 						if (docFilho.getExFormaDocumento().getIdFormaDoc() == 60) {
 							String htmlFilho = docFilho
 									.getConteudoBlobHtmlString();
+							assertContemTags(docFilho.getCodigo(), htmlFilho, "título", inicioTitulo, fimTitulo);
 							html = html
 									+ htmlFilho.substring(
 											htmlFilho.indexOf(inicioTitulo)
 													+ inicioTitulo.length(),
 											htmlFilho.indexOf(fimTitulo));
+							assertContemTags(docFilho.getCodigo(), htmlFilho, "conteúdo do documento", inicioMiolo, fimMiolo);
 							html = html
 									+ htmlFilho.substring(
 											htmlFilho.indexOf(inicioMiolo)
@@ -232,6 +238,12 @@ public class GeradorRTF {
 		}
 	}
 
+	private void assertContemTags(String sigla, String html, String trecho, String inicio, String fim) {
+		if (!html.contains(inicio) || !html.contains(fim) ) 
+			throw new AplicacaoException(
+					"O HTML do documento " + sigla + " deve conter tags para marcar o início e o término do " + trecho + ", utilizar: '" + inicio + "' e '\" + fim + \"'.");
+	}
+
 	private String removerTabela(String html) {
 		final String tags[] = { "<table", "</table", "<tr", "</tr", "<td",
 				"</td", "<th", "</th", "<tbody", "</tbody", "<tfoot",
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/Notificador.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/Notificador.java
index 74aeb96961..2532613ef3 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/Notificador.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/Notificador.java
@@ -190,8 +190,8 @@ public class Notificador {
 						}
 					}
 				} catch (Exception e) {
-					throw new AplicacaoException(
-							"Erro ao enviar email de notificação de movimentação.", 0,
+					throw new RuntimeException(
+							"Erro ao enviar email de notificação de movimentação.", 
 							e);
 				}	
 				
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/ProcessadorModeloFreemarker.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/ProcessadorModeloFreemarker.java
index 4dbe5b1941..1ddc1ff1af 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/ProcessadorModeloFreemarker.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/util/ProcessadorModeloFreemarker.java
@@ -23,8 +23,8 @@ import java.io.IOException;
 import java.io.OutputStreamWriter;
 import java.io.Reader;
 import java.io.StringReader;
-import java.io.UnsupportedEncodingException;
 import java.io.Writer;
+import java.nio.charset.StandardCharsets;
 import java.util.HashMap;
 import java.util.Map;
 import java.util.concurrent.ExecutionException;
@@ -44,6 +44,7 @@ import freemarker.template.Configuration;
 import freemarker.template.DefaultObjectWrapper;
 import freemarker.template.Template;
 import freemarker.template.TemplateException;
+import freemarker.template.TemplateExceptionHandler;
 
 public class ProcessadorModeloFreemarker implements ProcessadorModelo,
 		TemplateLoader {
@@ -62,6 +63,8 @@ public class ProcessadorModeloFreemarker implements ProcessadorModelo,
 		cfg.setTagSyntax(Configuration.SQUARE_BRACKET_TAG_SYNTAX);
 		cfg.setNumberFormat("0.######");
 		cfg.setLocalizedLookup(false);
+		cfg.setLogTemplateExceptions(false);
+		cfg.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER);
 	}
 
 	public String processarModelo(CpOrgaoUsuario ou, Map<String, Object> attrs,
@@ -106,18 +109,20 @@ public class ProcessadorModeloFreemarker implements ProcessadorModelo,
 			sTemplate += "\n" + (String) attrs.get("template");
 		sTemplate += "\n[/#compress]";
 
-		try (ByteArrayOutputStream baos = new ByteArrayOutputStream(); Writer out = new OutputStreamWriter(baos)) {
+		try (ByteArrayOutputStream baos = new ByteArrayOutputStream(); Writer out = new OutputStreamWriter(baos, StandardCharsets.UTF_8)) {
 			Template temp = new Template((String) attrs.get("nmMod"),
 					new StringReader(sTemplate), cfg);
 			temp.process(root, out);
 			out.flush();
-			return baos.toString();
+			String processed = baos.toString(StandardCharsets.UTF_8.name());
+			return processed;
 		} catch (TemplateException e) {
 			if (e.getCauseException() != null
 					&& e.getCauseException() instanceof AplicacaoException)
 				throw (AplicacaoException) e.getCauseException();
-			return ("Erro executando template FreeMarker\n\n" + e.getMessage() + "\n" + e.getFTLInstructionStack())
-					.replace("\n", "<br/>").replace("\r", "");
+			throw new RuntimeException("Erro executanto template Freemarker", e);
+//			return ("Erro executando template FreeMarker\n\n" + e.getMessage() + "\n" + e.getFTLInstructionStack())
+//					.replace("\n", "<br/>").replace("\r", "");
 		} catch (IOException e) {
 			return "Erro executando template FreeMarker\n\n" + e.getMessage();
 		}
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/vo/ExAcaoVO.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/vo/ExAcaoVO.java
deleted file mode 100644
index e67e1ee78f..0000000000
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/vo/ExAcaoVO.java
+++ /dev/null
@@ -1,139 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.ex.vo;
-
-import java.util.Collections;
-import java.util.Comparator;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-import java.util.TreeMap;
-
-import br.gov.jfrj.siga.ex.util.BIE.Topico;
-
-public class ExAcaoVO {
-	String icone;
-	String nome;
-	String nameSpace;
-	String acao;
-	boolean pode;
-	String msgConfirmacao;
-	String pre;
-	String pos;
-	String classe;
-	Map<String, String> params;
-	
-	public Map<String, String> getParams() {
-		return params;
-	}
-	
-	public String getPre() {
-		return pre;
-	}
-	
-	public String getPos() {
-		return pos;
-	}
-	
-	public String getIcone() {
-		return icone;
-	}
-	
-	public String getNome() {
-		return nome;
-	}
-	
-	public String getNomeNbsp() {
-		return getNome().replace(" ", "&nbsp;");
-	}
-	
-	public String getNameSpace() {
-		return nameSpace;
-	}
-	
-	public String getAcao() {
-		return acao;
-	}
-	
-	public boolean isPode() {
-		return pode;
-	}
-	
-	public boolean isPopup() {
-		return params.containsKey("popup");
-	}
-	
-	public boolean isAjax() {
-		return params.containsKey("ajax");
-	}
-	
-	public String getMsgConfirmacao() {
-		return msgConfirmacao;
-	}
-	
-	public String getClasse() {
-		return classe;
-	}
-	
-	public void setClasse(String classe) {
-		this.classe = classe;
-	}
-	
-	public ExAcaoVO(String icone, String nome, String nameSpace, String acao, boolean pode, String msgConfirmacao,
-			TreeMap<String, String> params, String pre, String pos, String classe) {
-		super();
-		this.icone = icone;
-		this.nome = nome;
-		this.nameSpace = nameSpace;
-		this.acao = acao;
-		this.pode = pode;
-		this.msgConfirmacao = msgConfirmacao;
-		this.params = params;
-		this.pre = pre;
-		this.pos = pos;
-		this.classe = classe;
-	}
-	
-	@Override
-	public String toString() {
-		return getPre() + " " + getNome() + " " + getPos() + " <" + getNameSpace() + " - " + getAcao() + "?"
-				+ getParams() + ">";
-	}
-	
-	public static List<ExAcaoVO> ordena(List<ExAcaoVO> acoes, Comparator<ExAcaoVO> comparator) {
-		if (comparator != null)
-			Collections.sort(acoes, comparator);
-		return acoes;
-	}
-	
-	public String getUrl() {
-		String resultUrl = "";
-		String valueOfParameterToAdd;
-		Map<String, String> parameters = this.params;
-		Set<String> parametersNames = this.params.keySet();
-		for (String nameOfParameterToAdd : parametersNames) {
-			valueOfParameterToAdd = parameters.get(nameOfParameterToAdd);
-			resultUrl = (nameOfParameterToAdd + "=" + valueOfParameterToAdd + "&").concat(resultUrl);
-		}
-		if (!parametersNames.isEmpty())
-			resultUrl = ("?").concat(resultUrl);
-		resultUrl = (this.nameSpace + "/" + this.acao).concat(resultUrl);
-		return resultUrl;
-	}
-}
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/vo/ExVO.java b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/vo/ExVO.java
index 8c09e8311a..3949ee7abb 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/ex/vo/ExVO.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/ex/vo/ExVO.java
@@ -19,50 +19,27 @@
 package br.gov.jfrj.siga.ex.vo;
 
 import java.io.UnsupportedEncodingException;
-import java.util.ArrayList;
-import java.util.Comparator;
-import java.util.List;
 import java.util.TreeMap;
 
-import br.gov.jfrj.siga.ex.bl.Ex;
+import br.gov.jfrj.siga.base.AcaoVO;
+import br.gov.jfrj.siga.base.VO;
+import br.gov.jfrj.siga.base.util.Utils;
 
-public class ExVO {
-	List<ExAcaoVO> acoes = new ArrayList<ExAcaoVO>();
+public class ExVO extends VO {
 
-	private class NomeExAcaoVOComparator implements Comparator<ExAcaoVO> {
-
-		public int compare(ExAcaoVO o1, ExAcaoVO o2) {
-			return o1.getNome().replace("_", "").compareTo(o2.getNome().replace("_", ""));
-		}
-	}
-
-	public List<ExAcaoVO> getAcoes() {
-		return acoes;
-	}
-
-	public List<ExAcaoVO> getAcoesOrdenadasPorNome() {
-		return ExAcaoVO.ordena(getAcoes(), new NomeExAcaoVOComparator());
-	}
-
-	public void setAcoes(List<ExAcaoVO> acoes) {
-		this.acoes = acoes;
-	}
-
-	protected void addAcao(String icone, String nome, String nameSpace,
-			String action, boolean pode) {
-		addAcao(icone, nome, nameSpace, action, pode, null, null, null, null, null);
+	public void addAcao(String icone, String nome, String nameSpace, String action, boolean pode, String msgConfirmacao,
+			String parametros, String pre, String pos, String classe) {
+		addAcao(icone, nome, nameSpace, action, pode, null, msgConfirmacao, parametros, pre, pos, classe, null);
 	}
 
-	protected void addAcao(String icone, String nome, String nameSpace,
-			String action, boolean pode, String msgConfirmacao,
-			String parametros, String pre, String pos, String classe) {
+	@Override
+	public void addAcao(String icone, String nome, String nameSpace, String action, boolean pode, String tooltip, String msgConfirmacao,
+			String parametros, String pre, String pos, String classe, String modal) {
 		TreeMap<String, String> params = new TreeMap<String, String>();
 
 		if (this instanceof ExMovimentacaoVO) {
-			params.put("id",
-					Long.toString(((ExMovimentacaoVO) this).getIdMov()));
-			// params.put("sigla", ((ExMovimentacaoVO)
-			// this).getMobilVO().getSigla());
+			params.put("id", Long.toString(((ExMovimentacaoVO) this).getIdMov()));
+			params.put("sigla", ((ExMovimentacaoVO) this).getMobilVO().getSigla());
 		} else if (this instanceof ExMobilVO) {
 			params.put("sigla", ((ExMobilVO) this).getSigla());
 		} else if (this instanceof ExDocumentoVO) {
@@ -75,18 +52,15 @@ public class ExVO {
 			else
 				params.clear();
 			try {
-				Ex.getInstance()
-						.getBL()
-						.mapFromUrlEncodedForm(params,
-								parametros.getBytes("iso-8859-1"));
+				Utils.mapFromUrlEncodedForm(params, parametros.getBytes("iso-8859-1"));
 			} catch (UnsupportedEncodingException e) {
 			}
 		}
 
 		if (pode) {
-			ExAcaoVO acao = new ExAcaoVO(icone, nome, nameSpace, action, pode,
-					msgConfirmacao, params, pre, pos, classe);
-			acoes.add(acao);
+			AcaoVO acao = new AcaoVO(icone, nome, nameSpace, action, pode, msgConfirmacao, params, pre, pos, classe,
+					modal);
+			getAcoes().add(acao);
 		}
 	}
 }
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/CarregadorPlugin.java b/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/CarregadorPlugin.java
index a4b95626bb..8aaebc5b6f 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/CarregadorPlugin.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/CarregadorPlugin.java
@@ -10,6 +10,7 @@ import java.util.logging.Logger;
 
 import br.gov.jfrj.siga.ex.SigaExProperties;
 import br.gov.jfrj.siga.hibernate.ext.IMontadorQuery;
+import br.gov.jfrj.siga.hibernate.ext.MontadorQuery;
 
 /**
  * Classe que trata da lógica de carregamento da extensão de busca textual em outro classloader. 
@@ -62,7 +63,7 @@ public class CarregadorPlugin {
 	 */
 	public IMontadorQuery getMontadorQueryDefault() {
 		try {
-			return (IMontadorQuery) (IMontadorQuery) this.classloader.loadClass("br.gov.jfrj.siga.hibernate.ext.MontadorQuery").newInstance();
+			return new MontadorQuery();
 		} catch (Exception e) {
 			log.severe("Não foi possível instanciar o MontadorQuery default! Será utilizado o MontadorQuery no mesmo classloader da aplicação e isso"
 					+ " poderá exigir o reinicio da instância do servidor de aplicação durante o redeploy");
@@ -76,7 +77,9 @@ public class CarregadorPlugin {
 	 */
 	public IMontadorQuery getMontadorQueryImpl() {
 		try {
-			return (IMontadorQuery) Class.forName(SigaExProperties.getMontadorQuery(),true,this.classloader).newInstance();
+			String montadorQuery = SigaExProperties.getMontadorQuery();
+			if (montadorQuery != null)
+				return (IMontadorQuery) Class.forName(montadorQuery,true,this.classloader).newInstance();
 		} catch (Exception e) {
 			log.warning("Não foi possível instanciar o MontadorQuery do plugin!");
 		}
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExDao.java b/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExDao.java
index 5cf71cc10b..5319738366 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExDao.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExDao.java
@@ -30,12 +30,15 @@ import java.text.SimpleDateFormat;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Date;
+import java.util.LinkedList;
 import java.util.List;
 
+import javax.persistence.NoResultException;
 import javax.persistence.Query;
 import javax.persistence.criteria.CriteriaQuery;
 import javax.persistence.criteria.Join;
 import javax.persistence.criteria.JoinType;
+import javax.persistence.criteria.Predicate;
 import javax.persistence.criteria.Root;
 
 import org.jboss.logging.Logger;
@@ -69,15 +72,18 @@ import br.gov.jfrj.siga.ex.ExTipoMobil;
 import br.gov.jfrj.siga.ex.ExTipoMovimentacao;
 import br.gov.jfrj.siga.ex.ExTpDocPublicacao;
 import br.gov.jfrj.siga.ex.ExVia;
+import br.gov.jfrj.siga.ex.SigaExProperties;
 import br.gov.jfrj.siga.ex.BIE.ExBoletimDoc;
 import br.gov.jfrj.siga.ex.util.MascaraUtil;
 import br.gov.jfrj.siga.hibernate.ext.IExMobilDaoFiltro;
 import br.gov.jfrj.siga.hibernate.ext.IMontadorQuery;
+import br.gov.jfrj.siga.hibernate.ext.MontadorQuery;
 import br.gov.jfrj.siga.model.Selecionavel;
 import br.gov.jfrj.siga.model.dao.ModeloDao;
 import br.gov.jfrj.siga.persistencia.ExClassificacaoDaoFiltro;
 import br.gov.jfrj.siga.persistencia.ExDocumentoDaoFiltro;
 import br.gov.jfrj.siga.persistencia.ExMobilDaoFiltro;
+import br.gov.jfrj.siga.persistencia.ExModeloDaoFiltro;
 
 @SuppressWarnings({ "unchecked", "rawtypes" })
 public class ExDao extends CpDao {
@@ -381,11 +387,15 @@ public class ExDao extends CpDao {
 	}
 
 	private IMontadorQuery carregarPlugin() {
-		CarregadorPlugin carregador = new CarregadorPlugin();
-		IMontadorQuery montadorQuery = carregador.getMontadorQueryImpl();
-		montadorQuery
-				.setMontadorPrincipal(carregador.getMontadorQueryDefault());
-		return montadorQuery;
+		String prop = SigaExProperties.getMontadorQuery();
+ 		if (prop != null) {
+			CarregadorPlugin carregador = new CarregadorPlugin();
+			IMontadorQuery montadorQuery = carregador.getMontadorQueryImpl();
+			montadorQuery
+					.setMontadorPrincipal(carregador.getMontadorQueryDefault());
+			return montadorQuery;
+ 		}
+ 		return new MontadorQuery();
 	}
 
 	public Integer consultarQuantidadePorFiltroOtimizado(
@@ -506,7 +516,7 @@ public class ExDao extends CpDao {
 		CriteriaQuery<ExFormaDocumento> q = cb().createQuery(ExFormaDocumento.class);
 		Root<ExFormaDocumento> c = q.from(ExFormaDocumento.class);
 		q.select(c);
-		q.orderBy(cb().asc(cb().parameter(String.class, "descrFormaDoc")));
+		q.orderBy(cb().asc(c.get("descrFormaDoc")));
 		return em().createQuery(q).getResultList();
 	}
 
@@ -544,7 +554,7 @@ public class ExDao extends CpDao {
 
 		if (pess != null) {
 			query = em().createNamedQuery("consultarEmailporPessoa");
-			query.setParameter("idPessoaIni", pess.getPessoaInicial());
+			query.setParameter("idPessoaIni", pess.getIdInicial());
 		} else {
 			query = em().createNamedQuery("consultarEmailporLotacao");
 
@@ -1078,12 +1088,23 @@ public class ExDao extends CpDao {
 		Root<ExModelo> c = q.from(ExModelo.class);
 		q.select(c);
 		Join<ExModelo, ExFormaDocumento> joinForma = c.join("exFormaDocumento");
-		q.where(cb().equal(c.get("nmMod"), sModelo), cb().equal(c.get("hisAtivo"), 1));
+		
+		List<Predicate> whereList = new LinkedList<Predicate>();
+		whereList.add(cb().equal(c.get("nmMod"), sModelo));
+		whereList.add(cb().equal(c.get("hisAtivo"), 1));
 		if (sForma != null) {
 			c.join("exFormaDocumento", JoinType.INNER);
-			q.where(cb().equal(joinForma.get("descrFormaDoc"), sForma));
+			whereList.add(cb().equal(joinForma.get("descrFormaDoc"), sForma));
+		}
+		Predicate[] whereArray = new Predicate[whereList.size()];
+		whereList.toArray(whereArray);
+		q.where(whereArray);
+		
+		try {
+			return em().createQuery(q).getSingleResult();
+		} catch (NoResultException ex) {
+			return null;
 		}
-		return em().createQuery(q).getSingleResult();
 	}
 
 	public ExFormaDocumento consultarExForma(String sForma) {
@@ -1120,7 +1141,7 @@ public class ExDao extends CpDao {
 	public List<ExDocumento> listarDocPendenteAssinatura(DpPessoa pessoa, boolean apenasComSolicitacaoDeAssinatura) {
 		final Query query = em().createNamedQuery(
 				"listarDocPendenteAssinatura" + (apenasComSolicitacaoDeAssinatura ? "ERevisado" : ""));
-		query.setParameter("idPessoaIni", pessoa.getIdPessoaIni());
+		query.setParameter("idPessoaIni", pessoa);
 		return query.getResultList();
 	}
 
@@ -1310,13 +1331,17 @@ public class ExDao extends CpDao {
 								+ " inner join marca.exMobil mobil"
 								+ " where (marca.dtIniMarca is null or marca.dtIniMarca < CURRENT_TIMESTAMP)"
 								+ " and (marca.dtFimMarca is null or marca.dtFimMarca > CURRENT_TIMESTAMP)"
-								+ (titular != null ? " and (marca.dpPessoaIni.idPessoa = :titular)"
-										: " and (marca.dpLotacaoIni.idLotacao = :lotaTitular)"));
+								+ " and (marca.dpPessoaIni.idPessoa = :titular or "
+								+ " (marca.dpPessoaIni.idPessoa = null and marca.dpLotacaoIni.idLotacao = :lotaTitular))");
 
 		if (titular != null)
 			query.setParameter("titular", titular.getIdPessoaIni());
-		else if (lotaTitular != null)
+		else
+			query.setParameter("titular", null);
+		if (lotaTitular != null)
 			query.setParameter("lotaTitular", lotaTitular.getIdLotacaoIni());
+		else
+			query.setParameter("lotaTitular", null);
 
 		List l = query.getResultList();
  		long tempoTotal = System.nanoTime() - tempoIni;
@@ -1339,5 +1364,30 @@ public class ExDao extends CpDao {
 	}
 
 
+	public List<ExModelo> consultarPorFiltro(
+			final ExModeloDaoFiltro flt) {
+		return consultarPorFiltro(flt, 0, 0);
+	}
+	
+	public List<ExModelo> consultarPorFiltro(
+			final ExModeloDaoFiltro flt, final int offset,
+			final int itemPagina) {
+		CriteriaQuery<ExModelo> q = cb().createQuery(ExModelo.class);
+		Root<ExModelo> c = q.from(ExModelo.class);
+		q.select(c);
+		List<Predicate> whereList = new LinkedList<Predicate>();
+		if(flt.getSigla() != null) {
+			whereList.add(cb().like(c.get("nmMod").as(String.class), "%" + flt.getSigla() + "%"));
+		}
+		Predicate[] whereArray = new Predicate[whereList.size()];
+		whereList.toArray(whereArray);
+		q.where(whereArray);
+			q.orderBy(cb().desc(c.get("nmMod")));
+		return em().createQuery(q).getResultList();
+	}
+
+	public int consultarQuantidade(final ExModeloDaoFiltro flt) {
+		return consultarPorFiltro(flt).size();
+	}
 
 }
\ No newline at end of file
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExStarter.java b/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExStarter.java
index 81d4312d17..292b61259e 100644
--- a/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExStarter.java
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/hibernate/ExStarter.java
@@ -3,22 +3,24 @@ package br.gov.jfrj.siga.hibernate;
 import javax.annotation.PostConstruct;
 import javax.ejb.Singleton;
 import javax.ejb.Startup;
+import javax.ejb.TransactionManagement;
+import javax.ejb.TransactionManagementType;
+import javax.naming.NamingException;
 import javax.persistence.EntityManagerFactory;
 import javax.persistence.Persistence;
 
-/**
- * 
- * @author Rodrigo Ramalho hodrigohamalho@gmail.com
- *
- */
+import br.gov.jfrj.siga.cp.util.SigaFlyway;
+
 @Startup
 @Singleton
+@TransactionManagement(value = TransactionManagementType.BEAN)
 public class ExStarter {
 
 	public static EntityManagerFactory emf;
 
 	@PostConstruct
-	public void init() {
+	public void init() throws NamingException {
+		SigaFlyway.migrate("java:/jboss/datasources/SigaExDS", "classpath:db/mysql/sigaex");
 		emf = Persistence.createEntityManagerFactory("default");
 	}
 }
\ No newline at end of file
diff --git a/siga-ex/src/main/java/br/gov/jfrj/siga/persistencia/ExModeloDaoFiltro.java b/siga-ex/src/main/java/br/gov/jfrj/siga/persistencia/ExModeloDaoFiltro.java
new file mode 100644
index 0000000000..b0fa617896
--- /dev/null
+++ b/siga-ex/src/main/java/br/gov/jfrj/siga/persistencia/ExModeloDaoFiltro.java
@@ -0,0 +1,34 @@
+/*******************************************************************************
+ * Copyright (c) 2006 - 2011 SJRJ.
+ * 
+ *     This file is part of SIGA.
+ * 
+ *     SIGA is free software: you can redistribute it and/or modify
+ *     it under the terms of the GNU General Public License as published by
+ *     the Free Software Foundation, either version 3 of the License, or
+ *     (at your option) any later version.
+ * 
+ *     SIGA is distributed in the hope that it will be useful,
+ *     but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *     GNU General Public License for more details.
+ * 
+ *     You should have received a copy of the GNU General Public License
+ *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
+ ******************************************************************************/
+package br.gov.jfrj.siga.persistencia;
+
+import br.gov.jfrj.siga.model.dao.DaoFiltroSelecionavel;
+
+public class ExModeloDaoFiltro extends DaoFiltroSelecionavel {
+	private String nome;
+
+	public String getNome() {
+		return nome;
+	}
+
+	public void setNome(String nome) {
+		this.nome = nome;
+	}
+
+}
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/css2/Style.java b/siga-ex/src/main/java/com/aryjr/nheengatu/css2/Style.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/css2/Style.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/css2/Style.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/css2/StyleSheet.java b/siga-ex/src/main/java/com/aryjr/nheengatu/css2/StyleSheet.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/css2/StyleSheet.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/css2/StyleSheet.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/csv/CSVDocument.java b/siga-ex/src/main/java/com/aryjr/nheengatu/csv/CSVDocument.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/csv/CSVDocument.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/csv/CSVDocument.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/csv/HTML2CSVParser.java b/siga-ex/src/main/java/com/aryjr/nheengatu/csv/HTML2CSVParser.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/csv/HTML2CSVParser.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/csv/HTML2CSVParser.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/document/Document.java b/siga-ex/src/main/java/com/aryjr/nheengatu/document/Document.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/document/Document.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/document/Document.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/HTML2MParser.java b/siga-ex/src/main/java/com/aryjr/nheengatu/html/HTML2MParser.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/HTML2MParser.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/html/HTML2MParser.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/HTMLDocument.java b/siga-ex/src/main/java/com/aryjr/nheengatu/html/HTMLDocument.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/HTMLDocument.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/html/HTMLDocument.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/HTMLHandler.java b/siga-ex/src/main/java/com/aryjr/nheengatu/html/HTMLHandler.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/HTMLHandler.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/html/HTMLHandler.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/Tag.java b/siga-ex/src/main/java/com/aryjr/nheengatu/html/Tag.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/Tag.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/html/Tag.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/Text.java b/siga-ex/src/main/java/com/aryjr/nheengatu/html/Text.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/html/Text.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/html/Text.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/calc/CalcDocument.java b/siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/calc/CalcDocument.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/calc/CalcDocument.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/calc/CalcDocument.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/calc/HTML2CalcParser.java b/siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/calc/HTML2CalcParser.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/calc/HTML2CalcParser.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/calc/HTML2CalcParser.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/impress/HTML2ImpressParser.java b/siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/impress/HTML2ImpressParser.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/impress/HTML2ImpressParser.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/impress/HTML2ImpressParser.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/impress/ImpressDocument.java b/siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/impress/ImpressDocument.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/impress/ImpressDocument.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/impress/ImpressDocument.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/writer/HTML2WriterParser.java b/siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/writer/HTML2WriterParser.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/writer/HTML2WriterParser.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/writer/HTML2WriterParser.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/writer/WriterDocument.java b/siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/writer/WriterDocument.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/openoffice/writer/WriterDocument.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/openoffice/writer/WriterDocument.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/CellWidths.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/CellWidths.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/CellWidths.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/CellWidths.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/HTML2PDFParser.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/HTML2PDFParser.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/HTML2PDFParser.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/HTML2PDFParser.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFDiv.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFDiv.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFDiv.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFDiv.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFDocument.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFDocument.java
similarity index 97%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFDocument.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFDocument.java
index ffe4d70ff9..32ee1129fa 100644
--- a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFDocument.java
+++ b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFDocument.java
@@ -240,7 +240,7 @@ public class PDFDocument extends com.aryjr.nheengatu.document.Document {
 		PDFTable table;
 		final TagsManager tm = TagsManager.getInstance();
 
-		PDFDocument.log.info("extractVisibleComponents");
+		// PDFDocument.log.info("extractVisibleComponents");
 		// PDFDocument.log.info(tm.states.size());
 		// PDFDocument.log.info(tm.getTextIndent());
 		// if (paragraph != null)
@@ -256,7 +256,7 @@ public class PDFDocument extends com.aryjr.nheengatu.document.Document {
 					s = s.replace("\\\"", "\"");
 					((Text) component).setText(s);
 				}
-				PDFDocument.log.info("text: " + ((Text) component).getText());
+				// PDFDocument.log.info("text: " + ((Text) component).getText());
 				// PDFDocument.log.info(tm.states.size());
 				// PDFDocument.log.info(tm.getTextIndent());
 				// PDFDocument.log.info(tm.getSpacingBefore());
@@ -293,9 +293,9 @@ public class PDFDocument extends com.aryjr.nheengatu.document.Document {
 				tm.checkTag((Tag) component);
 				final Paragraph p = PDFText.createParagraph(null, tm);
 
-				PDFDocument.log.info("p");
-				PDFDocument.log.info(tm.getFont().getSize());
-				PDFDocument.log.info(p.getLeading());
+//				PDFDocument.log.info("p");
+//				PDFDocument.log.info(tm.getFont().getSize());
+//				PDFDocument.log.info(p.getLeading());
 				// PDFDocument.log.info(tm.states.size());
 				// PDFDocument.log.info(tm.getTextIndent());
 				// PDFDocument.log.info("align:");
@@ -363,9 +363,9 @@ public class PDFDocument extends com.aryjr.nheengatu.document.Document {
 				final ListItem li = new ListItem(tm.getFont().getSize() * 1.25f);
 				li.setSpacingAfter(tm.getFont().getSize() * 0.5f);
 
-				PDFDocument.log.info("li");
-				PDFDocument.log.info(tm.getFont().getSize());
-				PDFDocument.log.info(li.getLeading());
+//				PDFDocument.log.info("li");
+//				PDFDocument.log.info(tm.getFont().getSize());
+//				PDFDocument.log.info(li.getLeading());
 
 				tm.checkTag((Tag) component);
 				if (list == null)
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFImage.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFImage.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFImage.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFImage.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFPageBreak.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFPageBreak.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFPageBreak.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFPageBreak.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFTable.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFTable.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFTable.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFTable.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFText.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFText.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/PDFText.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/PDFText.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/RomanList.java b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/RomanList.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/pdf/RomanList.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/RomanList.java
diff --git a/siga-ex/src/main/nheengatu/license.txt b/siga-ex/src/main/java/com/aryjr/nheengatu/pdf/license.txt
similarity index 100%
rename from siga-ex/src/main/nheengatu/license.txt
rename to siga-ex/src/main/java/com/aryjr/nheengatu/pdf/license.txt
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/AbsolutePosition.java b/siga-ex/src/main/java/com/aryjr/nheengatu/testes/AbsolutePosition.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/AbsolutePosition.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/testes/AbsolutePosition.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteImpressao.java b/siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteImpressao.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteImpressao.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteImpressao.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteParagrafos.java b/siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteParagrafos.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteParagrafos.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteParagrafos.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteParagrafosImagens.java b/siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteParagrafosImagens.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteParagrafosImagens.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteParagrafosImagens.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteTabelao.java b/siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteTabelao.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteTabelao.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteTabelao.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteTabelasAninhadas.java b/siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteTabelasAninhadas.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/testes/TesteTabelasAninhadas.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/testes/TesteTabelasAninhadas.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/util/GraphicsState.java b/siga-ex/src/main/java/com/aryjr/nheengatu/util/GraphicsState.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/util/GraphicsState.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/util/GraphicsState.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/util/HexadecimalColor.java b/siga-ex/src/main/java/com/aryjr/nheengatu/util/HexadecimalColor.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/util/HexadecimalColor.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/util/HexadecimalColor.java
diff --git a/siga-ex/src/main/nheengatu/com/aryjr/nheengatu/util/TagsManager.java b/siga-ex/src/main/java/com/aryjr/nheengatu/util/TagsManager.java
similarity index 100%
rename from siga-ex/src/main/nheengatu/com/aryjr/nheengatu/util/TagsManager.java
rename to siga-ex/src/main/java/com/aryjr/nheengatu/util/TagsManager.java
diff --git a/siga-ex/src/main/resources/db/mysql/SIGA_UTF8_V1_0__Inicial.sql b/siga-ex/src/main/resources/db/mysql/sigaex/V1.0__Inicial.sql
similarity index 65%
rename from siga-ex/src/main/resources/db/mysql/SIGA_UTF8_V1_0__Inicial.sql
rename to siga-ex/src/main/resources/db/mysql/sigaex/V1.0__Inicial.sql
index 9abd357b5d..4eda4feacd 100644
--- a/siga-ex/src/main/resources/db/mysql/SIGA_UTF8_V1_0__Inicial.sql
+++ b/siga-ex/src/main/resources/db/mysql/sigaex/V1.0__Inicial.sql
@@ -1,4 +1,4 @@
-CREATE DATABASE  IF NOT EXISTS `siga` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
+CREATE DATABASE  IF NOT EXISTS `siga` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
 USE `siga`;
 -- MySQL dump 10.13  Distrib 8.0.18, for Win64 (x86_64)
 --
@@ -23,7 +23,7 @@ USE `siga`;
 
 DROP TABLE IF EXISTS `ex_boletim_doc`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_boletim_doc` (
   `ID_BOLETIM_DOC` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `ID_DOC` INT UNSIGNED DEFAULT NULL,
@@ -33,7 +33,7 @@ CREATE TABLE `ex_boletim_doc` (
   KEY `BOL_BOLETIM_FK` (`ID_BOLETIM`),
   CONSTRAINT `BOL_BOLETIM_FK` FOREIGN KEY (`ID_BOLETIM`) REFERENCES `ex_documento` (`ID_DOC`),
   CONSTRAINT `BOL_DOC_FK` FOREIGN KEY (`ID_DOC`) REFERENCES `ex_documento` (`ID_DOC`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -51,12 +51,12 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_classificacao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_classificacao` (
   `ID_CLASSIFICACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `codificacao` varchar(13) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DESCR_CLASSIFICACAO` varchar(4000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `OBS` varchar(4000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `codificacao` varchar(13) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DESCR_CLASSIFICACAO` varchar(4000) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `OBS` varchar(4000) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
   `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
   `HIS_ATIVO` INT UNSIGNED NOT NULL,
@@ -70,7 +70,7 @@ CREATE TABLE `ex_classificacao` (
   CONSTRAINT `ex_classificacao_ibfk_1` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`),
   CONSTRAINT `ex_classificacao_ibfk_2` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`),
   CONSTRAINT `ex_classificacao_ibfk_3` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `ex_classificacao` (`ID_CLASSIFICACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -79,7 +79,18 @@ CREATE TABLE `ex_classificacao` (
 
 LOCK TABLES `ex_classificacao` WRITE;
 /*!40000 ALTER TABLE `ex_classificacao` DISABLE KEYS */;
-INSERT INTO `ex_classificacao` VALUES (1,'00.00.00.00','ORGANIZAÇÃO E FUNCIONAMENTO',NULL,NULL,NULL,1,1,'2009-03-13 00:00:00',NULL),(2,'00.01.00.00','REGULAMENTAÇÃO',NULL,NULL,NULL,1,2,'2009-03-13 00:00:00',NULL),(3,'00.01.01.00','ORGANIZAÇÃO ADMINISTRATIVA',NULL,NULL,NULL,1,3,'2009-03-13 00:00:00',NULL),(4,'00.01.01.01','Modernização Administrativa',NULL,NULL,NULL,1,4,'2009-03-13 00:00:00',NULL),(5,'00.06.00.00','FISCALIZAÇÃO CONTÁBIL, FINANCEIRA, ORÇAMENTÁRIA',NULL,NULL,NULL,1,5,'2009-03-13 00:00:00',NULL),(6,'00.06.01.00','AUDITORIA',NULL,NULL,NULL,1,6,'2009-03-13 00:00:00',NULL),(7,'00.06.01.01','Auditoria externa',NULL,NULL,NULL,1,7,'2009-03-13 00:00:00',NULL),(8,'00.06.01.02','Auditoria  interna',NULL,NULL,NULL,1,8,'2009-03-13 00:00:00',NULL),(10,'00.06.02.00','APRESTAÇÃO DE CONTAS',NULL,NULL,NULL,1,10,'2009-03-13 00:00:00',NULL),(11,'00.06.02.01','Tomada de contas especial',NULL,NULL,NULL,1,11,'2009-03-13 00:00:00',NULL),(12,'00.06.02.03','Decisão do TCU sobre as contas',NULL,NULL,NULL,1,12,'2009-03-13 00:00:00',NULL);
+INSERT INTO `ex_classificacao` VALUES 
+(1,'00.00.00.00','ORGANIZAÇÃO E FUNCIONAMENTO',NULL,NULL,NULL,1,1,'2009-03-13 00:00:00',NULL),
+(2,'00.01.00.00','REGULAMENTAÇÃO',NULL,NULL,NULL,1,2,'2009-03-13 00:00:00',NULL),
+(3,'00.01.01.00','ORGANIZAÇÃO ADMINISTRATIVA',NULL,NULL,NULL,1,3,'2009-03-13 00:00:00',NULL),
+(4,'00.01.01.01','Modernização Administrativa',NULL,NULL,NULL,1,4,'2009-03-13 00:00:00',NULL),
+(5,'00.06.00.00','FISCALIZAÇÃO CONTÁBIL, FINANCEIRA, ORÇAMENTÁRIA',NULL,NULL,NULL,1,5,'2009-03-13 00:00:00',NULL),
+(6,'00.06.01.00','AUDITORIA',NULL,NULL,NULL,1,6,'2009-03-13 00:00:00',NULL),
+(7,'00.06.01.01','Auditoria externa',NULL,NULL,NULL,1,7,'2009-03-13 00:00:00',NULL),
+(8,'00.06.01.02','Auditoria  interna',NULL,NULL,NULL,1,8,'2009-03-13 00:00:00',NULL),
+(10,'00.06.02.00','APRESTAÇÃO DE CONTAS',NULL,NULL,NULL,1,10,'2009-03-13 00:00:00',NULL),
+(11,'00.06.02.01','Tomada de contas especial',NULL,NULL,NULL,1,11,'2009-03-13 00:00:00',NULL),
+(12,'00.06.02.03','Decisão do TCU sobre as contas',NULL,NULL,NULL,1,12,'2009-03-13 00:00:00',NULL);
 /*!40000 ALTER TABLE `ex_classificacao` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -89,9 +100,9 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_competencia`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_competencia` (
-  `FG_COMPETENCIA` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `FG_COMPETENCIA` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
   `ID_PESSOA` INT UNSIGNED DEFAULT NULL,
   `ID_CARGO` INT UNSIGNED DEFAULT NULL,
   `ID_LOTACAO` INT UNSIGNED DEFAULT NULL,
@@ -109,7 +120,7 @@ CREATE TABLE `ex_competencia` (
   CONSTRAINT `COMPETENCIA_FUNC_CONF_FK` FOREIGN KEY (`ID_FUNCAO_CONFIANCA`) REFERENCES `corporativo`.`dp_funcao_confianca` (`ID_FUNCAO_CONFIANCA`),
   CONSTRAINT `COMPETENCIA_LOTACAO_FK` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `corporativo`.`dp_lotacao` (`ID_LOTACAO`),
   CONSTRAINT `COMPETENCIA_PESSOA_FK` FOREIGN KEY (`ID_PESSOA`) REFERENCES `corporativo`.`dp_pessoa` (`ID_PESSOA`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -127,7 +138,7 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_configuracao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_configuracao` (
   `ID_CONFIGURACAO_EX` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `ID_TP_MOV` INT UNSIGNED DEFAULT NULL,
@@ -158,7 +169,7 @@ CREATE TABLE `ex_configuracao` (
   CONSTRAINT `FK_TP_FORMA_DOC` FOREIGN KEY (`ID_TP_FORMA_DOC`) REFERENCES `ex_tipo_forma_documento` (`ID_TIPO_FORMA_DOC`),
   CONSTRAINT `FK_TP_MOV` FOREIGN KEY (`ID_TP_MOV`) REFERENCES `ex_tipo_movimentacao` (`ID_TP_MOV`),
   CONSTRAINT `FK_VIA` FOREIGN KEY (`ID_VIA`) REFERENCES `ex_via` (`ID_VIA`)
-) ENGINE=InnoDB AUTO_INCREMENT=37 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=37 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -167,7 +178,30 @@ CREATE TABLE `ex_configuracao` (
 
 LOCK TABLES `ex_configuracao` WRITE;
 /*!40000 ALTER TABLE `ex_configuracao` DISABLE KEYS */;
-INSERT INTO `ex_configuracao` VALUES (27,NULL,NULL,NULL,NULL,NULL,NULL,NULL,5,NULL),(28,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(30,NULL,NULL,NULL,NULL,78,NULL,NULL,NULL,NULL),(31,NULL,NULL,NULL,NULL,529,NULL,NULL,NULL,NULL),(32,NULL,NULL,NULL,NULL,545,NULL,NULL,NULL,NULL),(33,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(34,58,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(35,59,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(36,60,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
+INSERT INTO `ex_configuracao` VALUES 
+(27,NULL,NULL,NULL,NULL,NULL,NULL,NULL,5,NULL),
+(28,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(29,NULL,NULL,NULL,NULL,78,NULL,NULL,NULL,NULL),
+(30,NULL,NULL,NULL,NULL,519,NULL,NULL,NULL,NULL),
+(31,NULL,NULL,NULL,NULL,529,NULL,NULL,NULL,NULL),
+(32,NULL,NULL,NULL,57,NULL,NULL,NULL,NULL,NULL),
+(33,60,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(34,58,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(35,59,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(38,NULL,NULL,NULL,NULL,545,NULL,NULL,NULL,NULL),
+(39,NULL,NULL,NULL,NULL,665,NULL,NULL,NULL,NULL),
+(40,32,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(41,36,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(42,37,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(43,38,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(44,52,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(45,51,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(46,2,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(47,49,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(48,NULL,NULL,NULL,NULL,533,NULL,NULL,NULL,NULL),
+(54,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(55,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),
+(56,62,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
 /*!40000 ALTER TABLE `ex_configuracao` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -177,7 +211,7 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_documento`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_documento` (
   `ID_DOC` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `NUM_EXPEDIENTE` INT UNSIGNED DEFAULT NULL,
@@ -187,37 +221,37 @@ CREATE TABLE `ex_documento` (
   `ID_LOTA_CADASTRANTE` INT UNSIGNED NOT NULL,
   `ID_SUBSCRITOR` INT UNSIGNED DEFAULT NULL,
   `ID_LOTA_SUBSCRITOR` INT UNSIGNED DEFAULT NULL,
-  `DESCR_DOCUMENTO` varchar(4000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESCR_DOCUMENTO` varchar(4000) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `DT_DOC` datetime DEFAULT NULL,
   `DT_REG_DOC` datetime NOT NULL,
-  `NM_SUBSCRITOR_EXT` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `NUM_EXT_DOC` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_SUBSCRITOR_EXT` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `NUM_EXT_DOC` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_ARQ` BIGINT UNSIGNED DEFAULT NULL,
   `CONTEUDO_BLOB_DOC` blob,
-  `NM_ARQ_DOC` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `CONTEUDO_TP_DOC` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_ARQ_DOC` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `CONTEUDO_TP_DOC` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_DESTINATARIO` INT UNSIGNED DEFAULT NULL,
   `ID_LOTA_DESTINATARIO` INT UNSIGNED DEFAULT NULL,
-  `NM_DESTINATARIO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_DESTINATARIO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `DT_FINALIZACAO` datetime DEFAULT NULL,
   `ASSINATURA_BLOB_DOC` blob,
   `ID_MOD` INT UNSIGNED DEFAULT NULL,
   `ID_ORGAO_USU` INT UNSIGNED DEFAULT NULL,
   `ID_CLASSIFICACAO` INT UNSIGNED DEFAULT NULL,
   `ID_FORMA_DOC` INT UNSIGNED DEFAULT NULL,
-  `FG_PESSOAL` enum('S','N') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'N',
+  `FG_PESSOAL` enum('S','N') CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT 'N',
   `ID_ORGAO_DESTINATARIO` INT UNSIGNED DEFAULT NULL,
   `ID_ORGAO` INT UNSIGNED DEFAULT NULL,
-  `OBS_ORGAO_DOC` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `NM_ORGAO_DESTINATARIO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `FG_SIGILOSO` enum('S','N') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'N',
-  `NM_FUNCAO_SUBSCRITOR` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `FG_ELETRONICO` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'N',
-  `NUM_ANTIGO_DOC` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `OBS_ORGAO_DOC` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `NM_ORGAO_DESTINATARIO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `FG_SIGILOSO` enum('S','N') CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT 'N',
+  `NM_FUNCAO_SUBSCRITOR` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `FG_ELETRONICO` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT 'N',
+  `NUM_ANTIGO_DOC` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_LOTA_TITULAR` INT UNSIGNED DEFAULT NULL,
   `ID_TITULAR` INT UNSIGNED DEFAULT NULL,
-  `NUM_AUX_DOC` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `DSC_CLASS_DOC` varchar(4000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NUM_AUX_DOC` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `DSC_CLASS_DOC` varchar(4000) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_NIVEL_ACESSO` INT UNSIGNED DEFAULT NULL,
   `ID_DOC_PAI` INT UNSIGNED DEFAULT NULL,
   `NUM_VIA_DOC_PAI` INT UNSIGNED DEFAULT NULL,
@@ -228,7 +262,7 @@ CREATE TABLE `ex_documento` (
   `DT_DOC_ORIGINAL` datetime DEFAULT NULL,
   `ID_MOB_AUTUADO` INT UNSIGNED DEFAULT NULL,
   `DNM_DT_ACESSO` datetime DEFAULT NULL,
-  `DNM_ACESSO` varchar(4000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DNM_ACESSO` varchar(4000) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `DNM_ID_NIVEL_ACESSO` INT UNSIGNED DEFAULT NULL,
   `HIS_DT_ALT` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
   PRIMARY KEY (`ID_DOC`),
@@ -264,7 +298,7 @@ CREATE TABLE `ex_documento` (
   CONSTRAINT `SIGA_EXDOC_MOB_AUTUADO_ID_IX` FOREIGN KEY (`ID_MOB_AUTUADO`) REFERENCES `ex_mobil` (`ID_MOBIL`),
   CONSTRAINT `ex_documento_ibfk_1` FOREIGN KEY (`ID_MOB_PAI`) REFERENCES `ex_mobil` (`ID_MOBIL`),
   CONSTRAINT `ex_documento_ibfk_2` FOREIGN KEY (`ID_ARQ`) REFERENCES `corporativo`.`cp_arquivo` (`ID_ARQ`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -310,7 +344,7 @@ DELIMITER ;;
 	if OLD.dt_finalizacao is not null and OLD.dt_finalizacao <> NEW.dt_finalizacao THEN
 		   signal sqlstate value '20101' set message_text = 'Não é permitido alterar uma DATA de Finalização já existente';
 	end if; 
-	if OLD.fg_eletronico = 'N' then
+	if OLD.dt_finalizacao is not null and OLD.fg_eletronico = 'N' then
 		if  NEW.conteudo_blob_doc <> OLD.conteudo_blob_doc then
 			signal sqlstate value '20101' set message_text = 'Não é permitido alterar: não eletrônico com data de fechamento e com conteúdo.';
 		end if;
@@ -456,16 +490,16 @@ DELIMITER ;
 
 DROP TABLE IF EXISTS `ex_email_notificacao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_email_notificacao` (
   `ID_EMAIL_NOTIFICACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `ID_LOTACAO` INT UNSIGNED DEFAULT NULL,
   `ID_PESSOA` INT UNSIGNED DEFAULT NULL,
   `ID_LOTA_EMAIL` INT UNSIGNED DEFAULT NULL,
   `ID_PESSOA_EMAIL` INT UNSIGNED DEFAULT NULL,
-  `EMAIL` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `EMAIL` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_EMAIL_NOTIFICACAO`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -483,13 +517,13 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_estado_doc`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_estado_doc` (
   `ID_ESTADO_DOC` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_ESTADO_DOC` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `DESC_ESTADO_DOC` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
   `ORDEM_ESTADO_DOC` tinyint(4) DEFAULT NULL,
   PRIMARY KEY (`ID_ESTADO_DOC`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -507,7 +541,7 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_estado_tp_mov`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_estado_tp_mov` (
   `ID_ESTADO_DOC` INT UNSIGNED NOT NULL,
   `ID_TP_MOV` INT UNSIGNED NOT NULL,
@@ -515,7 +549,7 @@ CREATE TABLE `ex_estado_tp_mov` (
   KEY `TP_MOV_ESTADO_TPMOV_FK` (`ID_TP_MOV`),
   CONSTRAINT `ESTADO_TPMOV_ESTADO_FK` FOREIGN KEY (`ID_ESTADO_DOC`) REFERENCES `ex_estado_doc` (`ID_ESTADO_DOC`),
   CONSTRAINT `TP_MOV_ESTADO_TPMOV_FK` FOREIGN KEY (`ID_TP_MOV`) REFERENCES `ex_tipo_movimentacao` (`ID_TP_MOV`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -533,17 +567,17 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_forma_documento`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_forma_documento` (
   `ID_FORMA_DOC` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_FORMA_DOC` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `SIGLA_FORMA_DOC` varchar(3) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `DESCR_FORMA_DOC` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `SIGLA_FORMA_DOC` varchar(3) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
   `ID_TIPO_FORMA_DOC` INT UNSIGNED NOT NULL,
   PRIMARY KEY (`ID_FORMA_DOC`),
   KEY `EX_FORMA_DOCUMENTO_IDX_021` (`SIGLA_FORMA_DOC`,`ID_FORMA_DOC`,`DESCR_FORMA_DOC`),
   KEY `ID_TIPO_FORMA_DOC` (`ID_TIPO_FORMA_DOC`),
   CONSTRAINT `ex_forma_documento_ibfk_1` FOREIGN KEY (`ID_TIPO_FORMA_DOC`) REFERENCES `ex_tipo_forma_documento` (`ID_TIPO_FORMA_DOC`)
-) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -552,7 +586,24 @@ CREATE TABLE `ex_forma_documento` (
 
 LOCK TABLES `ex_forma_documento` WRITE;
 /*!40000 ALTER TABLE `ex_forma_documento` DISABLE KEYS */;
-INSERT INTO `ex_forma_documento` VALUES (1,'Ofício','OFI',1),(2,'Memorando','MEM',1),(3,'Formulário','FOR',1),(4,'Informação','INF',1),(5,'Externo','EXT',1),(8,'Despacho','DES',1),(9,'Contrato','CON',1),(12,'Requerimento','REQ',1),(13,'Solicitação','SOL',1),(14,'Parecer','PAR',1),(15,'Certidão','CER',1),(54,'Boletim Interno','BIE',1),(55,'Processo Administrativo','ADM',2),(56,'Processo de Pessoal','RHU',2),(57,'Processo de Execução Orçamentária e Financeira','EOF',2),(97,'Memória de Reunião','MRU',1),(98,'Relatório','REL',1),(99,'Documento Capturado','CAP',1);
+INSERT INTO `ex_forma_documento` VALUES (1,'Ofício','OFI',1),
+(2,'Memorando','MEM',1),
+(3,'Formulário','FOR',1),
+(4,'Informação','INF',1),
+(5,'Externo','EXT',1),
+(8,'Despacho','DES',1),
+(9,'Contrato','CON',1),
+(12,'Requerimento','REQ',1),
+(13,'Solicitação','SOL',1),
+(14,'Parecer','PAR',1),
+(15,'Certidão','CER',1),
+(54,'Boletim Interno','BIE',1),
+(55,'Processo Administrativo','ADM',2),
+(56,'Processo de Pessoal','RHU',2),
+(57,'Processo de Execução Orçamentária e Financeira','EOF',2),
+(97,'Memória de Reunião','MRU',1),
+(98,'Relatório','REL',1),
+(99,'Documento Capturado','CAP',1);
 /*!40000 ALTER TABLE `ex_forma_documento` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -562,20 +613,20 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_mobil`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_mobil` (
   `ID_MOBIL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `ID_DOC` INT UNSIGNED NOT NULL,
   `ID_TIPO_MOBIL` INT UNSIGNED NOT NULL,
   `NUM_SEQUENCIA` tinyint(4) NOT NULL,
-  `DNM_ULTIMA_ANOTACAO` varchar(400) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DNM_ULTIMA_ANOTACAO` varchar(400) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `DNM_NUM_PRIMEIRA_PAGINA` INT UNSIGNED DEFAULT NULL,
   PRIMARY KEY (`ID_MOBIL`),
   UNIQUE KEY `IDX_MOBIL_UNIQUE` (`ID_DOC`,`ID_TIPO_MOBIL`,`NUM_SEQUENCIA`),
   KEY `ID_TIPO_MOBIL` (`ID_TIPO_MOBIL`),
   CONSTRAINT `ex_mobil_ibfk_1` FOREIGN KEY (`ID_DOC`) REFERENCES `ex_documento` (`ID_DOC`),
   CONSTRAINT `ex_mobil_ibfk_2` FOREIGN KEY (`ID_TIPO_MOBIL`) REFERENCES `ex_tipo_mobil` (`ID_TIPO_MOBIL`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -593,15 +644,15 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_modelo`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_modelo` (
   `ID_MOD` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_MOD` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `DESC_MOD` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_MOD` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `DESC_MOD` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_ARQ` BIGINT UNSIGNED DEFAULT NULL,
   `CONTEUDO_BLOB_MOD` blob,
-  `CONTEUDO_TP_BLOB` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `NM_ARQ_MOD` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `CONTEUDO_TP_BLOB` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `NM_ARQ_MOD` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_CLASSIFICACAO` INT UNSIGNED DEFAULT NULL,
   `ID_FORMA_DOC` INT UNSIGNED DEFAULT NULL,
   `ID_CLASS_CRIACAO_VIA` INT UNSIGNED DEFAULT NULL,
@@ -612,8 +663,8 @@ CREATE TABLE `ex_modelo` (
   `HIS_IDC_INI` INT UNSIGNED DEFAULT NULL,
   `HIS_IDC_FIM` INT UNSIGNED DEFAULT NULL,
   `HIS_ATIVO` INT UNSIGNED NOT NULL,
-  `NM_DIRETORIO` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `HIS_IDE` varchar(48) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_DIRETORIO` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `HIS_IDE` varchar(48) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_MOD`),
   KEY `EX_MODELO_IDX_014` (`ID_CLASSIFICACAO`),
   KEY `EX_MODELO_IDX_017` (`ID_NIVEL_ACESSO`),
@@ -629,7 +680,7 @@ CREATE TABLE `ex_modelo` (
   CONSTRAINT `ex_modelo_ibfk_1` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`),
   CONSTRAINT `ex_modelo_ibfk_2` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`),
   CONSTRAINT `ex_modelo_ibfk_3` FOREIGN KEY (`ID_ARQ`) REFERENCES `corporativo`.`cp_arquivo` (`ID_ARQ`)
-) ENGINE=InnoDB AUTO_INCREMENT=667 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=667 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -638,7 +689,23 @@ CREATE TABLE `ex_modelo` (
 
 LOCK TABLES `ex_modelo` WRITE;
 /*!40000 ALTER TABLE `ex_modelo` DISABLE KEYS */;
-INSERT INTO `ex_modelo` VALUES (2,'Ofício','Ofício',1,NULL,'template/freemarker','oficio.jsp',NULL,1,NULL,NULL,2,NULL,NULL,NULL,NULL,1,NULL,NULL),(26,'Memorando','Memorando',2,NULL,'template/freemarker','memorando.jsp',NULL,2,NULL,NULL,26,NULL,NULL,NULL,NULL,1,NULL,NULL),(27,'Informação','Informação',3,NULL,'template/freemarker',NULL,NULL,4,NULL,NULL,27,NULL,NULL,NULL,NULL,1,NULL,NULL),(28,'Documento Externo',NULL,NULL,NULL,NULL,'externo.jsp',NULL,5,NULL,NULL,28,NULL,NULL,NULL,NULL,1,NULL,NULL),(29,'Interno Importado',NULL,NULL,NULL,NULL,'interno_antigo.jsp',NULL,NULL,NULL,NULL,29,NULL,NULL,NULL,NULL,1,NULL,NULL),(78,'Despacho','Despacho',4,NULL,'template/freemarker',NULL,NULL,8,NULL,NULL,78,NULL,NULL,NULL,NULL,1,NULL,NULL),(181,'Contrato','Contrato',NULL,NULL,'template-file/jsp','contrato.jsp',NULL,9,NULL,NULL,181,NULL,'2020-02-12 14:52:59',NULL,NULL,0,NULL,NULL),(241,'Boletim Interno',NULL,5,NULL,'template/freemarker','boletimInterno.jsp',NULL,54,NULL,NULL,241,NULL,NULL,NULL,NULL,1,NULL,NULL),(519,'Parecer','Parecer',6,NULL,'template/freemarker',NULL,NULL,14,NULL,NULL,519,NULL,NULL,NULL,NULL,1,NULL,NULL),(529,'Certidão de desentranhamento',NULL,7,NULL,'template/freemarker','certidaoDesentranhamento.jsp',NULL,15,NULL,NULL,529,NULL,NULL,NULL,NULL,1,NULL,NULL),(533,'Processo de Pessoal',NULL,NULL,NULL,NULL,'processoAdministrativo.jsp',NULL,56,NULL,NULL,533,NULL,NULL,NULL,NULL,1,NULL,NULL),(534,'Processo de Execução Orçamentária e Financeira','Processo de Execução Orçamentária e Financeira',NULL,NULL,'template-file/jsp','processoAdministrativo.jsp',NULL,57,NULL,NULL,534,NULL,NULL,NULL,NULL,1,NULL,NULL),(545,'Certidão de encerramendo de volume',NULL,NULL,NULL,NULL,'certidaoEncerramentoVolume.jsp',NULL,15,NULL,NULL,545,NULL,NULL,NULL,NULL,1,NULL,NULL),(546,'Folha inicial de volume - EOF',NULL,NULL,NULL,NULL,'folhaInicialVolume.jsp',NULL,3,NULL,NULL,546,NULL,'2020-02-12 14:52:59',NULL,NULL,0,NULL,NULL),(663,'Memória de Reunião','Memória de Reunião',8,NULL,'template/freemarker',NULL,NULL,97,NULL,NULL,663,NULL,'2020-02-12 14:52:59',NULL,NULL,0,NULL,NULL),(665,'Despacho Automático','Despacho gerado automaticamente pela transferência',9,NULL,'template/freemarker',NULL,NULL,8,NULL,NULL,665,NULL,NULL,NULL,NULL,1,NULL,NULL),(666,'Planta','Planta',10,' ','template/freemarker',NULL,NULL,99,NULL,NULL,0,NULL,NULL,NULL,NULL,1,NULL,NULL);
+INSERT INTO `ex_modelo` VALUES (2,'Ofício','Ofício',1,NULL,'template/freemarker','oficio.jsp',NULL,1,NULL,NULL,2,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(26,'Memorando','Memorando',2,NULL,'template/freemarker','memorando.jsp',NULL,2,NULL,NULL,26,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(27,'Informação','Informação',3,NULL,'template/freemarker',NULL,NULL,4,NULL,NULL,27,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(28,'Documento Externo',NULL,NULL,NULL,NULL,'externo.jsp',NULL,5,NULL,NULL,28,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(29,'Interno Importado',NULL,NULL,NULL,NULL,'interno_antigo.jsp',NULL,NULL,NULL,NULL,29,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(78,'Despacho','Despacho',4,NULL,'template/freemarker',NULL,NULL,8,NULL,NULL,78,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(181,'Contrato','Contrato',NULL,NULL,'template-file/jsp','contrato.jsp',NULL,9,NULL,NULL,181,NULL,'2020-02-12 14:52:59',NULL,NULL,0,NULL,NULL),
+(241,'Boletim Interno',NULL,5,NULL,'template/freemarker','boletimInterno.jsp',NULL,54,NULL,NULL,241,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(519,'Parecer','Parecer',6,NULL,'template/freemarker',NULL,NULL,14,NULL,NULL,519,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(529,'Certidão de desentranhamento',NULL,7,NULL,'template/freemarker','certidaoDesentranhamento.jsp',NULL,15,NULL,NULL,529,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(533,'Processo de Pessoal',NULL,NULL,NULL,NULL,'processoAdministrativo.jsp',NULL,56,NULL,NULL,533,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(534,'Processo de Execução Orçamentária e Financeira','Processo de Execução Orçamentária e Financeira',NULL,NULL,'template-file/jsp','processoAdministrativo.jsp',NULL,57,NULL,NULL,534,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(545,'Certidão de encerramendo de volume',NULL,NULL,NULL,NULL,'certidaoEncerramentoVolume.jsp',NULL,15,NULL,NULL,545,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(546,'Folha inicial de volume - EOF',NULL,NULL,NULL,NULL,'folhaInicialVolume.jsp',NULL,3,NULL,NULL,546,NULL,'2020-02-12 14:52:59',NULL,NULL,0,NULL,NULL),
+(663,'Memória de Reunião','Memória de Reunião',8,NULL,'template/freemarker',NULL,NULL,97,NULL,NULL,663,NULL,'2020-02-12 14:52:59',NULL,NULL,0,NULL,NULL),
+(665,'Despacho Automático','Despacho gerado automaticamente pela transferência',9,NULL,'template/freemarker',NULL,NULL,8,NULL,NULL,665,NULL,NULL,NULL,NULL,1,NULL,NULL),
+(666,'Planta','Planta',10,' ','template/freemarker',NULL,NULL,99,NULL,NULL,0,NULL,NULL,NULL,NULL,1,NULL,NULL);
 /*!40000 ALTER TABLE `ex_modelo` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -648,7 +715,7 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_modelo_tp_doc_publicacao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_modelo_tp_doc_publicacao` (
   `ID_MOD` INT UNSIGNED NOT NULL,
   `ID_DOC_PUBLICACAO` INT UNSIGNED NOT NULL,
@@ -656,7 +723,7 @@ CREATE TABLE `ex_modelo_tp_doc_publicacao` (
   KEY `MOD_PUBL_ID_DOC_PUBLICACAO_FK` (`ID_DOC_PUBLICACAO`),
   CONSTRAINT `MOD_PUBL_ID_DOC_PUBLICACAO_FK` FOREIGN KEY (`ID_DOC_PUBLICACAO`) REFERENCES `ex_tp_doc_publicacao` (`ID_DOC_PUBLICACAO`),
   CONSTRAINT `MOD_PUBL_ID_MOD_FK` FOREIGN KEY (`ID_MOD`) REFERENCES `ex_modelo` (`ID_MOD`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -674,7 +741,7 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_movimentacao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_movimentacao` (
   `ID_MOV` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `ID_DOC` INT UNSIGNED DEFAULT NULL,
@@ -692,32 +759,32 @@ CREATE TABLE `ex_movimentacao` (
   `ID_ARQ` BIGINT UNSIGNED DEFAULT NULL,
   `CONTEUDO_BLOB_MOV` blob,
   `ID_MOV_CANCELADORA` INT UNSIGNED DEFAULT NULL,
-  `NM_ARQ_MOV` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `CONTEUDO_TP_MOV` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_ARQ_MOV` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `CONTEUDO_TP_MOV` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `DT_FIM_MOV` datetime DEFAULT NULL,
   `ID_LOTA_RESP` INT UNSIGNED DEFAULT NULL,
   `ID_RESP` INT UNSIGNED DEFAULT NULL,
-  `DESCR_MOV` varchar(400) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESCR_MOV` varchar(400) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ASSINATURA_BLOB_MOV` blob,
   `ID_DESTINO_FINAL` INT UNSIGNED DEFAULT NULL,
   `ID_LOTA_DESTINO_FINAL` INT UNSIGNED DEFAULT NULL,
   `NUM_VIA_DOC_PAI` tinyint(4) DEFAULT NULL,
   `ID_DOC_REF` INT UNSIGNED DEFAULT NULL,
   `NUM_VIA_DOC_REF` tinyint(4) DEFAULT NULL,
-  `OBS_ORGAO_MOV` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `OBS_ORGAO_MOV` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_ORGAO` INT UNSIGNED DEFAULT NULL,
   `ID_MOV_REF` INT UNSIGNED DEFAULT NULL,
   `ID_LOTA_TITULAR` INT UNSIGNED DEFAULT NULL,
   `ID_TITULAR` INT UNSIGNED DEFAULT NULL,
-  `NM_FUNCAO_SUBSCRITOR` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_FUNCAO_SUBSCRITOR` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `NUM_PROC_ADM` INT UNSIGNED DEFAULT NULL,
   `ID_NIVEL_ACESSO` INT UNSIGNED DEFAULT NULL,
   `DT_DISP_PUBLICACAO` datetime DEFAULT NULL,
   `DT_EFETIVA_PUBLICACAO` datetime DEFAULT NULL,
   `DT_EFETIVA_DISP_PUBLICACAO` datetime DEFAULT NULL,
-  `PAG_PUBLICACAO` varchar(15) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `PAG_PUBLICACAO` varchar(15) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `NUM_TRF_PUBLICACAO` INT UNSIGNED DEFAULT NULL,
-  `CADERNO_PUBLICACAO_DJE` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `CADERNO_PUBLICACAO_DJE` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_MOBIL` INT UNSIGNED DEFAULT NULL,
   `ID_MOB_REF` INT UNSIGNED DEFAULT NULL,
   `NUM_PAGINAS` smallint(6) DEFAULT NULL,
@@ -726,8 +793,8 @@ CREATE TABLE `ex_movimentacao` (
   `ID_CLASSIFICACAO` INT UNSIGNED DEFAULT NULL,
   `ID_MARCADOR` INT UNSIGNED DEFAULT NULL,
   `ID_IDENTIDADE_AUDIT` INT UNSIGNED DEFAULT NULL,
-  `IP_AUDIT` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `HASH_AUDIT` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `IP_AUDIT` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `HASH_AUDIT` varchar(1024) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_MOV`),
   KEY `ID_MOBIL_REF_IDX` (`ID_MOB_REF`),
   KEY `EX_MOVIMENTACAO_IDX_001` (`ID_MOV_REF`,`DT_INI_MOV`),
@@ -782,7 +849,7 @@ CREATE TABLE `ex_movimentacao` (
   CONSTRAINT `ex_movimentacao_ibfk_2` FOREIGN KEY (`ID_MOB_REF`) REFERENCES `ex_mobil` (`ID_MOBIL`),
   CONSTRAINT `ex_movimentacao_ibfk_3` FOREIGN KEY (`ID_PAPEL`) REFERENCES `ex_papel` (`ID_PAPEL`),
   CONSTRAINT `ex_movimentacao_ibfk_4` FOREIGN KEY (`ID_ARQ`) REFERENCES `corporativo`.`cp_arquivo` (`ID_ARQ`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -800,14 +867,14 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_nivel_acesso`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_nivel_acesso` (
   `ID_NIVEL_ACESSO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_NIVEL_ACESSO` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `DSC_NIVEL_ACESSO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_NIVEL_ACESSO` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `DSC_NIVEL_ACESSO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `GRAU_NIVEL_ACESSO` INT UNSIGNED DEFAULT NULL,
   PRIMARY KEY (`ID_NIVEL_ACESSO`)
-) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -816,7 +883,12 @@ CREATE TABLE `ex_nivel_acesso` (
 
 LOCK TABLES `ex_nivel_acesso` WRITE;
 /*!40000 ALTER TABLE `ex_nivel_acesso` DISABLE KEYS */;
-INSERT INTO `ex_nivel_acesso` VALUES (1,'Limitado ao órgão (padrão)','Dá acesso a todos do órgão ao qual o documento pertence, bem como a toda a lotação de qualquer órgão para onde for enviado',20),(2,'Limitado de divisão para pessoa','Dá acesso a toda a divisão onde o documento foi criado e também a qualquer lotação (ou apenas pessoa específica) para onde for enviado',40),(3,'Limitado entre lotações','Dá acesso a toda a lotação do cadastrante do documento e à lotação (nunca somente à pessoa) para onde for enviado',60),(5,'Limitado entre pessoas','Dá acesso somente ao cadastrante do documento e à lotação (ou apenas pessoa específica) para onde for enviado',100),(6,'Público','Dá acesso a todos, independentemente do órgão',10),(7,'Limitado de pessoa para divisão','Dá acesso somente ao cadastrante do documento e a toda a divisão para onde for enviado',30);
+INSERT INTO `ex_nivel_acesso` VALUES (1,'Limitado ao órgão','Dá acesso a todos do órgão ao qual o documento pertence, bem como a toda a lotação de qualquer órgão para onde for enviado',20),
+(2,'Limitado de divisão para pessoa','Dá acesso a toda a divisão onde o documento foi criado e também a qualquer lotação (ou apenas pessoa específica) para onde for enviado',40),
+(3,'Limitado entre lotações','Dá acesso a toda a lotação do cadastrante do documento e à lotação (nunca somente à pessoa) para onde for enviado',60),
+(5,'Limitado entre pessoas','Dá acesso somente ao cadastrante do documento e à lotação (ou apenas pessoa específica) para onde for enviado',100),
+(6,'Público','Dá acesso a todos, independentemente do órgão',10),
+(7,'Limitado de pessoa para divisão','Dá acesso somente ao cadastrante do documento e a toda a divisão para onde for enviado',30);
 /*!40000 ALTER TABLE `ex_nivel_acesso` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -826,7 +898,7 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_numeracao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_numeracao` (
   `ID_ORGAO_USU` INT UNSIGNED NOT NULL,
   `ID_FORMA_DOC` INT UNSIGNED NOT NULL,
@@ -836,7 +908,7 @@ CREATE TABLE `ex_numeracao` (
   KEY `NUMERACAO_FORMA_DOC_FK` (`ID_FORMA_DOC`),
   CONSTRAINT `NUMERACAO_FORMA_DOC_FK` FOREIGN KEY (`ID_FORMA_DOC`) REFERENCES `ex_forma_documento` (`ID_FORMA_DOC`),
   CONSTRAINT `NUMERACAO_ORGAO_USU_FK` FOREIGN KEY (`ID_ORGAO_USU`) REFERENCES `corporativo`.`cp_orgao_usuario` (`ID_ORGAO_USU`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -854,12 +926,12 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_papel`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_papel` (
   `ID_PAPEL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_PAPEL` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESC_PAPEL` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_PAPEL`)
-) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -868,7 +940,11 @@ CREATE TABLE `ex_papel` (
 
 LOCK TABLES `ex_papel` WRITE;
 /*!40000 ALTER TABLE `ex_papel` DISABLE KEYS */;
-INSERT INTO `ex_papel` VALUES (1,'Gestor'),(2,'Interessado'),(5,'Liquidante'),(6,'Autorizador'),(7,'Revisor');
+INSERT INTO `ex_papel` VALUES (1,'Gestor'),
+(2,'Interessado'),
+(5,'Liquidante'),
+(6,'Autorizador'),
+(7,'Revisor');
 /*!40000 ALTER TABLE `ex_papel` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -878,12 +954,12 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_preenchimento`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_preenchimento` (
   `ID_PREENCHIMENTO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `ID_LOTACAO` INT UNSIGNED NOT NULL,
   `ID_MOD` INT UNSIGNED NOT NULL,
-  `EX_NOME_PREENCHIMENTO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `EX_NOME_PREENCHIMENTO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
   `ID_ARQ` BIGINT UNSIGNED DEFAULT NULL,
   `PREENCHIMENTO_BLOB` blob,
   PRIMARY KEY (`ID_PREENCHIMENTO`),
@@ -893,7 +969,7 @@ CREATE TABLE `ex_preenchimento` (
   CONSTRAINT `PREENCHIMENTO_LOTACAO_FK` FOREIGN KEY (`ID_LOTACAO`) REFERENCES `corporativo`.`dp_lotacao` (`ID_LOTACAO`),
   CONSTRAINT `PREENCHIMENTO_MODELO_FK` FOREIGN KEY (`ID_MOD`) REFERENCES `ex_modelo` (`ID_MOD`),
   CONSTRAINT `PREENCHIMENTO_ARQ_FK` FOREIGN KEY (`ID_ARQ`) REFERENCES `corporativo`.`cp_arquivo` (`ID_ARQ`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -911,12 +987,12 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_situacao_configuracao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_situacao_configuracao` (
   `ID_SIT_CONFIGURACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DSC_SIT_CONFIGURACAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DSC_SIT_CONFIGURACAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_SIT_CONFIGURACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -925,7 +1001,13 @@ CREATE TABLE `ex_situacao_configuracao` (
 
 LOCK TABLES `ex_situacao_configuracao` WRITE;
 /*!40000 ALTER TABLE `ex_situacao_configuracao` DISABLE KEYS */;
-INSERT INTO `ex_situacao_configuracao` VALUES (1,'Pode'),(2,'Não Pode'),(3,'Obrigatório'),(4,'Opcional'),(5,'Default'),(6,'Não default'),(7,'Proibido');
+INSERT INTO `ex_situacao_configuracao` VALUES (1,'Pode'),
+(2,'Não Pode'),
+(3,'Obrigatório'),
+(4,'Opcional'),
+(5,'Default'),
+(6,'Não default'),
+(7,'Proibido');
 /*!40000 ALTER TABLE `ex_situacao_configuracao` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -935,10 +1017,10 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_temporalidade`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_temporalidade` (
   `ID_TEMPORALIDADE` smallint(6) NOT NULL AUTO_INCREMENT,
-  `DESC_TEMPORALIDADE` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `DESC_TEMPORALIDADE` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
   `VALOR_TEMPORALIDADE` double DEFAULT NULL,
   `ID_UNIDADE_MEDIDA` INT UNSIGNED DEFAULT NULL,
   `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
@@ -954,7 +1036,7 @@ CREATE TABLE `ex_temporalidade` (
   CONSTRAINT `ex_temporalidade_ibfk_1` FOREIGN KEY (`ID_UNIDADE_MEDIDA`) REFERENCES `corporativo`.`cp_unidade_medida` (`ID_UNIDADE_MEDIDA`),
   CONSTRAINT `ex_temporalidade_ibfk_2` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`),
   CONSTRAINT `ex_temporalidade_ibfk_3` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`)
-) ENGINE=InnoDB AUTO_INCREMENT=178 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=178 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -963,7 +1045,86 @@ CREATE TABLE `ex_temporalidade` (
 
 LOCK TABLES `ex_temporalidade` WRITE;
 /*!40000 ALTER TABLE `ex_temporalidade` DISABLE KEYS */;
-INSERT INTO `ex_temporalidade` VALUES (81,'1 ano',1,1,81,NULL,NULL,NULL,NULL,1),(82,'1 ano após a atualização',1,1,82,NULL,NULL,NULL,NULL,1),(83,'10 anos',10,1,83,NULL,NULL,NULL,NULL,1),(84,'15 anos',15,1,84,NULL,NULL,NULL,NULL,1),(85,'2 anos',2,1,85,NULL,NULL,NULL,NULL,1),(86,'2 anos após a devolução do documento / processo',2,1,86,NULL,NULL,NULL,NULL,1),(87,'2 anos após o encerramento',2,1,87,NULL,NULL,NULL,NULL,1),(88,'2 anos após o encerramento com devolução',2,1,88,NULL,NULL,NULL,NULL,1),(89,'20 anos',20,1,89,NULL,NULL,NULL,NULL,1),(90,'3 anos',3,1,90,NULL,NULL,NULL,NULL,1),(92,'3 anos após o encerramento',3,1,92,NULL,NULL,NULL,NULL,1),(93,'30 dias',30,3,93,NULL,NULL,NULL,NULL,1),(94,'35 anos',35,1,94,NULL,NULL,NULL,NULL,1),(95,'4 anos',4,1,95,NULL,NULL,NULL,NULL,1),(96,'5 anos',5,1,96,NULL,NULL,NULL,NULL,1),(97,'5 anos após o encerramento',5,1,97,NULL,NULL,NULL,NULL,1),(98,'50 anos',50,1,98,NULL,NULL,NULL,NULL,1),(99,'51 anos',51,1,99,NULL,NULL,NULL,NULL,1),(100,'6 anos',6,1,100,NULL,NULL,NULL,NULL,1),(101,'7 anos',7,1,101,NULL,NULL,NULL,NULL,1),(102,'71 anos',71,1,102,NULL,NULL,NULL,NULL,1),(103,'90 dias',90,3,103,NULL,NULL,NULL,NULL,1),(104,'95 anos',95,1,104,NULL,NULL,NULL,NULL,1),(105,'Até a alienação',NULL,NULL,105,NULL,NULL,NULL,NULL,1),(106,'Até a aposentadoria ou o desligamento',NULL,NULL,106,NULL,NULL,NULL,NULL,1),(107,'Até a atualização',NULL,NULL,107,NULL,NULL,NULL,NULL,1),(108,'Até a conclusão da apuração',NULL,NULL,108,NULL,NULL,NULL,NULL,1),(109,'Até a devolução',NULL,NULL,109,NULL,NULL,NULL,NULL,1),(110,'Até a inclusão',NULL,NULL,110,NULL,NULL,NULL,NULL,1),(111,'Até a informatização ou alienação',NULL,NULL,111,NULL,NULL,NULL,NULL,1),(112,'Até a prestação de contas',NULL,NULL,112,NULL,NULL,NULL,NULL,1),(113,'Até a quitação da dívida',NULL,NULL,113,NULL,NULL,NULL,NULL,1),(114,'Até a restauração da obra',NULL,NULL,114,NULL,NULL,NULL,NULL,1),(115,'Até alienação do bem',NULL,NULL,115,NULL,NULL,NULL,NULL,1),(116,'Até o emplacamento',NULL,NULL,116,NULL,NULL,NULL,NULL,1),(117,'Até o encerramento',NULL,NULL,117,NULL,NULL,NULL,NULL,1),(118,'Até o pagamento',NULL,NULL,118,NULL,NULL,NULL,NULL,1),(119,'Até o trânsito em julgado',NULL,NULL,119,NULL,NULL,NULL,NULL,1),(120,'Até vigência',NULL,NULL,120,NULL,NULL,NULL,NULL,1),(121,'Até vigência + 6 anos',6,1,121,NULL,NULL,NULL,NULL,1),(122,'Duração obra',NULL,NULL,122,NULL,NULL,NULL,NULL,1),(123,'Durante vigência',NULL,NULL,123,NULL,NULL,NULL,NULL,1),(124,'Enquanto permanece a ocupação',NULL,NULL,124,NULL,NULL,NULL,NULL,1),(125,'Enquanto vigora',NULL,NULL,125,NULL,NULL,NULL,NULL,1),(126,'Guarda Permanente',NULL,NULL,126,NULL,NULL,NULL,NULL,1),(127,'Indeterminado',NULL,NULL,127,NULL,NULL,NULL,NULL,1),(128,'Julg. TCU',NULL,NULL,128,NULL,NULL,NULL,NULL,1),(129,'No momento do recolhimento',NULL,NULL,129,NULL,NULL,NULL,NULL,1),(130,'Para utilização',NULL,NULL,130,NULL,NULL,NULL,NULL,1),(131,'Prazo da pasta',NULL,NULL,131,NULL,NULL,NULL,NULL,1),(132,'Prazo do assent.',NULL,NULL,132,NULL,NULL,NULL,NULL,1),(133,'Prazo do dossiê',NULL,NULL,133,NULL,NULL,NULL,NULL,1),(134,'Prazo do precatório',NULL,NULL,134,NULL,NULL,NULL,NULL,1),(135,'Prazo do processo',NULL,NULL,135,NULL,NULL,NULL,NULL,1),(136,'Prazo do prontuário',NULL,NULL,136,NULL,NULL,NULL,NULL,1),(137,'Transitado em julgado',NULL,NULL,137,NULL,NULL,NULL,NULL,1),(138,'Validade Concurso',NULL,NULL,138,NULL,NULL,NULL,NULL,1),(139,'Validade contrato',NULL,NULL,139,NULL,NULL,NULL,NULL,1),(140,'Validade credenciamento',NULL,NULL,140,NULL,NULL,NULL,NULL,1),(141,'Validade Projeto',NULL,NULL,141,NULL,NULL,NULL,NULL,1),(142,'Vigência',NULL,NULL,142,NULL,NULL,NULL,NULL,1),(143,'Vigência cadastro',NULL,NULL,143,NULL,NULL,NULL,NULL,1),(144,'Vigência da pensão',NULL,NULL,144,NULL,NULL,NULL,NULL,1),(161,'Até a devolução do bem',NULL,NULL,161,NULL,NULL,NULL,NULL,1),(162,'Até a posse',NULL,NULL,162,NULL,NULL,NULL,NULL,1),(163,'Até a próxima atualização',NULL,NULL,163,NULL,NULL,NULL,NULL,1),(164,'Até a publicação ',NULL,NULL,164,NULL,NULL,NULL,NULL,1),(165,'Até o desfazimento do bem',NULL,NULL,165,NULL,NULL,NULL,NULL,1),(166,'Até o encerramento do processo de execução penal',NULL,NULL,166,NULL,NULL,NULL,NULL,1),(167,'Até o vitaliciamento',NULL,NULL,167,NULL,NULL,NULL,NULL,1),(168,'Até revogação',NULL,NULL,168,NULL,NULL,NULL,NULL,1),(169,'Até vigência do contrato ou Julg. TCU',NULL,NULL,169,NULL,NULL,NULL,NULL,1),(170,'Eliminação no momento do recebimento',NULL,NULL,170,NULL,NULL,NULL,NULL,1),(171,'Enquanto durar a ocupação',NULL,NULL,171,NULL,NULL,NULL,NULL,1),(172,'Enquanto durar a pesquisa',NULL,NULL,172,NULL,NULL,NULL,NULL,1),(173,'Enquanto o bem estiver alienado',NULL,NULL,173,NULL,NULL,NULL,NULL,1),(174,'Enquanto vigente',NULL,NULL,174,NULL,NULL,NULL,NULL,1),(175,'Imediatamente após a produção',NULL,NULL,175,NULL,NULL,NULL,NULL,1),(176,'Prazo da licença',NULL,NULL,176,NULL,NULL,NULL,NULL,1),(177,'Validade do concurso',NULL,NULL,177,NULL,NULL,NULL,NULL,1);
+INSERT INTO `ex_temporalidade` VALUES (81,'1 ano',1,1,81,NULL,NULL,NULL,NULL,1),
+(82,'1 ano após a atualização',1,1,82,NULL,NULL,NULL,NULL,1),
+(83,'10 anos',10,1,83,NULL,NULL,NULL,NULL,1),
+(84,'15 anos',15,1,84,NULL,NULL,NULL,NULL,1),
+(85,'2 anos',2,1,85,NULL,NULL,NULL,NULL,1),
+(86,'2 anos após a devolução do documento / processo',2,1,86,NULL,NULL,NULL,NULL,1),
+(87,'2 anos após o encerramento',2,1,87,NULL,NULL,NULL,NULL,1),
+(88,'2 anos após o encerramento com devolução',2,1,88,NULL,NULL,NULL,NULL,1),
+(89,'20 anos',20,1,89,NULL,NULL,NULL,NULL,1),
+(90,'3 anos',3,1,90,NULL,NULL,NULL,NULL,1),
+(92,'3 anos após o encerramento',3,1,92,NULL,NULL,NULL,NULL,1),
+(93,'30 dias',30,3,93,NULL,NULL,NULL,NULL,1),
+(94,'35 anos',35,1,94,NULL,NULL,NULL,NULL,1),
+(95,'4 anos',4,1,95,NULL,NULL,NULL,NULL,1),
+(96,'5 anos',5,1,96,NULL,NULL,NULL,NULL,1),
+(97,'5 anos após o encerramento',5,1,97,NULL,NULL,NULL,NULL,1),
+(98,'50 anos',50,1,98,NULL,NULL,NULL,NULL,1),
+(99,'51 anos',51,1,99,NULL,NULL,NULL,NULL,1),
+(100,'6 anos',6,1,100,NULL,NULL,NULL,NULL,1),
+(101,'7 anos',7,1,101,NULL,NULL,NULL,NULL,1),
+(102,'71 anos',71,1,102,NULL,NULL,NULL,NULL,1),
+(103,'90 dias',90,3,103,NULL,NULL,NULL,NULL,1),
+(104,'95 anos',95,1,104,NULL,NULL,NULL,NULL,1),
+(105,'Até a alienação',NULL,NULL,105,NULL,NULL,NULL,NULL,1),
+(106,'Até a aposentadoria ou o desligamento',NULL,NULL,106,NULL,NULL,NULL,NULL,1),
+(107,'Até a atualização',NULL,NULL,107,NULL,NULL,NULL,NULL,1),
+(108,'Até a conclusão da apuração',NULL,NULL,108,NULL,NULL,NULL,NULL,1),
+(109,'Até a devolução',NULL,NULL,109,NULL,NULL,NULL,NULL,1),
+(110,'Até a inclusão',NULL,NULL,110,NULL,NULL,NULL,NULL,1),
+(111,'Até a informatização ou alienação',NULL,NULL,111,NULL,NULL,NULL,NULL,1),
+(112,'Até a prestação de contas',NULL,NULL,112,NULL,NULL,NULL,NULL,1),
+(113,'Até a quitação da dívida',NULL,NULL,113,NULL,NULL,NULL,NULL,1),
+(114,'Até a restauração da obra',NULL,NULL,114,NULL,NULL,NULL,NULL,1),
+(115,'Até alienação do bem',NULL,NULL,115,NULL,NULL,NULL,NULL,1),
+(116,'Até o emplacamento',NULL,NULL,116,NULL,NULL,NULL,NULL,1),
+(117,'Até o encerramento',NULL,NULL,117,NULL,NULL,NULL,NULL,1),
+(118,'Até o pagamento',NULL,NULL,118,NULL,NULL,NULL,NULL,1),
+(119,'Até o trânsito em julgado',NULL,NULL,119,NULL,NULL,NULL,NULL,1),
+(120,'Até vigência',NULL,NULL,120,NULL,NULL,NULL,NULL,1),
+(121,'Até vigência + 6 anos',6,1,121,NULL,NULL,NULL,NULL,1),
+(122,'Duração obra',NULL,NULL,122,NULL,NULL,NULL,NULL,1),
+(123,'Durante vigência',NULL,NULL,123,NULL,NULL,NULL,NULL,1),
+(124,'Enquanto permanece a ocupação',NULL,NULL,124,NULL,NULL,NULL,NULL,1),
+(125,'Enquanto vigora',NULL,NULL,125,NULL,NULL,NULL,NULL,1),
+(126,'Guarda Permanente',NULL,NULL,126,NULL,NULL,NULL,NULL,1),
+(127,'Indeterminado',NULL,NULL,127,NULL,NULL,NULL,NULL,1),
+(128,'Julg. TCU',NULL,NULL,128,NULL,NULL,NULL,NULL,1),
+(129,'No momento do recolhimento',NULL,NULL,129,NULL,NULL,NULL,NULL,1),
+(130,'Para utilização',NULL,NULL,130,NULL,NULL,NULL,NULL,1),
+(131,'Prazo da pasta',NULL,NULL,131,NULL,NULL,NULL,NULL,1),
+(132,'Prazo do assent.',NULL,NULL,132,NULL,NULL,NULL,NULL,1),
+(133,'Prazo do dossiê',NULL,NULL,133,NULL,NULL,NULL,NULL,1),
+(134,'Prazo do precatório',NULL,NULL,134,NULL,NULL,NULL,NULL,1),
+(135,'Prazo do processo',NULL,NULL,135,NULL,NULL,NULL,NULL,1),
+(136,'Prazo do prontuário',NULL,NULL,136,NULL,NULL,NULL,NULL,1),
+(137,'Transitado em julgado',NULL,NULL,137,NULL,NULL,NULL,NULL,1),
+(138,'Validade Concurso',NULL,NULL,138,NULL,NULL,NULL,NULL,1),
+(139,'Validade contrato',NULL,NULL,139,NULL,NULL,NULL,NULL,1),
+(140,'Validade credenciamento',NULL,NULL,140,NULL,NULL,NULL,NULL,1),
+(141,'Validade Projeto',NULL,NULL,141,NULL,NULL,NULL,NULL,1),
+(142,'Vigência',NULL,NULL,142,NULL,NULL,NULL,NULL,1),
+(143,'Vigência cadastro',NULL,NULL,143,NULL,NULL,NULL,NULL,1),
+(144,'Vigência da pensão',NULL,NULL,144,NULL,NULL,NULL,NULL,1),
+(161,'Até a devolução do bem',NULL,NULL,161,NULL,NULL,NULL,NULL,1),
+(162,'Até a posse',NULL,NULL,162,NULL,NULL,NULL,NULL,1),
+(163,'Até a próxima atualização',NULL,NULL,163,NULL,NULL,NULL,NULL,1),
+(164,'Até a publicação ',NULL,NULL,164,NULL,NULL,NULL,NULL,1),
+(165,'Até o desfazimento do bem',NULL,NULL,165,NULL,NULL,NULL,NULL,1),
+(166,'Até o encerramento do processo de execução penal',NULL,NULL,166,NULL,NULL,NULL,NULL,1),
+(167,'Até o vitaliciamento',NULL,NULL,167,NULL,NULL,NULL,NULL,1),
+(168,'Até revogação',NULL,NULL,168,NULL,NULL,NULL,NULL,1),
+(169,'Até vigência do contrato ou Julg. TCU',NULL,NULL,169,NULL,NULL,NULL,NULL,1),
+(170,'Eliminação no momento do recebimento',NULL,NULL,170,NULL,NULL,NULL,NULL,1),
+(171,'Enquanto durar a ocupação',NULL,NULL,171,NULL,NULL,NULL,NULL,1),
+(172,'Enquanto durar a pesquisa',NULL,NULL,172,NULL,NULL,NULL,NULL,1),
+(173,'Enquanto o bem estiver alienado',NULL,NULL,173,NULL,NULL,NULL,NULL,1),
+(174,'Enquanto vigente',NULL,NULL,174,NULL,NULL,NULL,NULL,1),
+(175,'Imediatamente após a produção',NULL,NULL,175,NULL,NULL,NULL,NULL,1),
+(176,'Prazo da licença',NULL,NULL,176,NULL,NULL,NULL,NULL,1),
+(177,'Validade do concurso',NULL,NULL,177,NULL,NULL,NULL,NULL,1);
 /*!40000 ALTER TABLE `ex_temporalidade` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -973,13 +1134,13 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tipo_despacho`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tipo_despacho` (
   `ID_TP_DESPACHO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TP_DESPACHO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `FG_ATIVO_TP_DESPACHO` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESC_TP_DESPACHO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `FG_ATIVO_TP_DESPACHO` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_TP_DESPACHO`)
-) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -988,7 +1149,23 @@ CREATE TABLE `ex_tipo_despacho` (
 
 LOCK TABLES `ex_tipo_despacho` WRITE;
 /*!40000 ALTER TABLE `ex_tipo_despacho` DISABLE KEYS */;
-INSERT INTO `ex_tipo_despacho` VALUES (1,'De acordo.','S'),(2,'Para ciência.','S'),(3,'Para as providências cabíveis','S'),(4,'Intime-se.','S'),(5,'Autorizo.','S'),(6,'Para atendimento.','S'),(7,'Para verificar a possibilidade de atendimento.','S'),(8,'Oficie-se.','S'),(9,'Expeça-se ofício-circular.','S'),(10,'Expeça-se memorando.','S'),(11,'Expeça-se memorando-circular.','S'),(12,'Arquive-se.','S'),(13,'Junte-se ao dossiê.','S'),(14,'Junte-se ao processo.','S'),(15,'Ciente. Arquive-se.','S'),(16,'Para atendimento e encaminhamento direto','S'),(17,'A pedido','S');
+INSERT INTO `ex_tipo_despacho` VALUES (1,'De acordo.','S'),
+(2,'Para ciência.','S'),
+(3,'Para as providências cabíveis','S'),
+(4,'Intime-se.','S'),
+(5,'Autorizo.','S'),
+(6,'Para atendimento.','S'),
+(7,'Para verificar a possibilidade de atendimento.','S'),
+(8,'Oficie-se.','S'),
+(9,'Expeça-se ofício-circular.','S'),
+(10,'Expeça-se memorando.','S'),
+(11,'Expeça-se memorando-circular.','S'),
+(12,'Arquive-se.','S'),
+(13,'Junte-se ao dossiê.','S'),
+(14,'Junte-se ao processo.','S'),
+(15,'Ciente. Arquive-se.','S'),
+(16,'Para atendimento e encaminhamento direto','S'),
+(17,'A pedido','S');
 /*!40000 ALTER TABLE `ex_tipo_despacho` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -998,13 +1175,13 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tipo_destinacao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tipo_destinacao` (
   `ID_TP_DESTINACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_TIPO_DESTINACAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `FACILITADOR_DEST` varchar(4000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESCR_TIPO_DESTINACAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
+  `FACILITADOR_DEST` varchar(4000) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_TP_DESTINACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=83 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=83 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1013,7 +1190,50 @@ CREATE TABLE `ex_tipo_destinacao` (
 
 LOCK TABLES `ex_tipo_destinacao` WRITE;
 /*!40000 ALTER TABLE `ex_tipo_destinacao` DISABLE KEYS */;
-INSERT INTO `ex_tipo_destinacao` VALUES (1,'Eliminação',NULL),(2,'Guarda Permanente',NULL),(21,'5 anos',NULL),(22,'Agência',NULL),(23,'Arquivo',NULL),(24,'Arquivo Intermediário',NULL),(26,'Arquivo Permanente',NULL),(27,'Assentamento Funcional',NULL),(28,'Banco',NULL),(29,'Biblioteca',NULL),(30,'Candidato',NULL),(31,'Clínica',NULL),(32,'Correios',NULL),(33,'Devolvida',NULL),(34,'Doador',NULL),(35,'Dossiê',NULL),(36,'Dossiê do curso',NULL),(37,'Dossiê do Evento',NULL),(38,'Empresa',NULL),(39,'Estagiário',NULL),(40,'Executor',NULL),(41,'Imprensa',NULL),(42,'Interessado',NULL),(43,'Julg. TCU',NULL),(44,'Magistrado',NULL),(45,'Participante',NULL),(46,'Participante / Instrutor',NULL),(47,'Pasta do Evento',NULL),(48,'Pasta do projeto',NULL),(49,'Precatório',NULL),(50,'Processo',NULL),(51,'Processo de origem',NULL),(52,'Prontuário Médico',NULL),(53,'Receita Federal',NULL),(54,'Remetido',NULL),(55,'Servidor',NULL),(57,'Setor',NULL),(58,'Setor Competente',NULL),(59,'Setores ',NULL),(60,'Setores / Interessados',NULL),(61,'TCU',NULL),(62,'Unidade Geradora',NULL),(81,'Magistrado / Servidor',NULL),(82,'Processo Judicial',NULL);
+INSERT INTO `ex_tipo_destinacao` VALUES (1,'Eliminação',NULL),
+(2,'Guarda Permanente',NULL),
+(21,'5 anos',NULL),
+(22,'Agência',NULL),
+(23,'Arquivo',NULL),
+(24,'Arquivo Intermediário',NULL),
+(26,'Arquivo Permanente',NULL),
+(27,'Assentamento Funcional',NULL),
+(28,'Banco',NULL),
+(29,'Biblioteca',NULL),
+(30,'Candidato',NULL),
+(31,'Clínica',NULL),
+(32,'Correios',NULL),
+(33,'Devolvida',NULL),
+(34,'Doador',NULL),
+(35,'Dossiê',NULL),
+(36,'Dossiê do curso',NULL),
+(37,'Dossiê do Evento',NULL),
+(38,'Empresa',NULL),
+(39,'Estagiário',NULL),
+(40,'Executor',NULL),
+(41,'Imprensa',NULL),
+(42,'Interessado',NULL),
+(43,'Julg. TCU',NULL),
+(44,'Magistrado',NULL),
+(45,'Participante',NULL),
+(46,'Participante / Instrutor',NULL),
+(47,'Pasta do Evento',NULL),
+(48,'Pasta do projeto',NULL),
+(49,'Precatório',NULL),
+(50,'Processo',NULL),
+(51,'Processo de origem',NULL),
+(52,'Prontuário Médico',NULL),
+(53,'Receita Federal',NULL),
+(54,'Remetido',NULL),
+(55,'Servidor',NULL),
+(57,'Setor',NULL),
+(58,'Setor Competente',NULL),
+(59,'Setores ',NULL),
+(60,'Setores / Interessados',NULL),
+(61,'TCU',NULL),
+(62,'Unidade Geradora',NULL),
+(81,'Magistrado / Servidor',NULL),
+(82,'Processo Judicial',NULL);
 /*!40000 ALTER TABLE `ex_tipo_destinacao` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1023,12 +1243,12 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tipo_documento`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tipo_documento` (
   `ID_TP_DOC` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_TIPO_DOCUMENTO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `DESCR_TIPO_DOCUMENTO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
   PRIMARY KEY (`ID_TP_DOC`)
-) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1037,7 +1257,11 @@ CREATE TABLE `ex_tipo_documento` (
 
 LOCK TABLES `ex_tipo_documento` WRITE;
 /*!40000 ALTER TABLE `ex_tipo_documento` DISABLE KEYS */;
-INSERT INTO `ex_tipo_documento` VALUES (1,'Interno Produzido'),(2,'Interno Folha de Rosto'),(3,'Externo Folha de Rosto'),(4,'Externo Capturado'),(5,'Interno Capturado');
+INSERT INTO `ex_tipo_documento` VALUES (1,'Interno Produzido'),
+(2,'Interno Folha de Rosto'),
+(3,'Externo Folha de Rosto'),
+(4,'Externo Capturado'),
+(5,'Interno Capturado');
 /*!40000 ALTER TABLE `ex_tipo_documento` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1047,13 +1271,13 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tipo_forma_documento`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tipo_forma_documento` (
   `ID_TIPO_FORMA_DOC` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TIPO_FORMA_DOC` varchar(60) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESC_TIPO_FORMA_DOC` varchar(60) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `NUMERACAO_UNICA` tinyint(4) DEFAULT NULL,
   PRIMARY KEY (`ID_TIPO_FORMA_DOC`)
-) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1062,7 +1286,8 @@ CREATE TABLE `ex_tipo_forma_documento` (
 
 LOCK TABLES `ex_tipo_forma_documento` WRITE;
 /*!40000 ALTER TABLE `ex_tipo_forma_documento` DISABLE KEYS */;
-INSERT INTO `ex_tipo_forma_documento` VALUES (1,'Expediente',0),(2,'Processo Administrativo',1);
+INSERT INTO `ex_tipo_forma_documento` VALUES (1,'Expediente',0),
+(2,'Processo Administrativo',1);
 /*!40000 ALTER TABLE `ex_tipo_forma_documento` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1072,12 +1297,12 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tipo_mobil`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tipo_mobil` (
   `ID_TIPO_MOBIL` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESC_TIPO_MOBIL` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESC_TIPO_MOBIL` varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_TIPO_MOBIL`)
-) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1086,7 +1311,10 @@ CREATE TABLE `ex_tipo_mobil` (
 
 LOCK TABLES `ex_tipo_mobil` WRITE;
 /*!40000 ALTER TABLE `ex_tipo_mobil` DISABLE KEYS */;
-INSERT INTO `ex_tipo_mobil` VALUES (1,'Geral'),(2,'Via'),(3,'Cópia'),(4,'Volume');
+INSERT INTO `ex_tipo_mobil` VALUES (1,'Geral'),
+(2,'Via'),
+(3,'Cópia'),
+(4,'Volume');
 /*!40000 ALTER TABLE `ex_tipo_mobil` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1096,12 +1324,12 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tipo_movimentacao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tipo_movimentacao` (
   `ID_TP_MOV` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `DESCR_TIPO_MOVIMENTACAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `DESCR_TIPO_MOVIMENTACAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_TP_MOV`)
-) ENGINE=InnoDB AUTO_INCREMENT=68 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=68 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1110,7 +1338,71 @@ CREATE TABLE `ex_tipo_movimentacao` (
 
 LOCK TABLES `ex_tipo_movimentacao` WRITE;
 /*!40000 ALTER TABLE `ex_tipo_movimentacao` DISABLE KEYS */;
-INSERT INTO `ex_tipo_movimentacao` VALUES (1,'Criação'),(2,'Anexação'),(3,'Transferência'),(4,'Recebimento'),(5,'Despacho'),(6,'Despacho com Transferência'),(7,'Despacho Interno'),(8,'Despacho Interno com Transferência'),(9,'Arquivamento Corrente'),(10,'Eliminação'),(11,'Assinatura'),(12,'Juntada'),(13,'Desentranhamento'),(14,'Cancelamento de Movimentação'),(15,'Extravio'),(16,'Vinculação'),(17,'Transferência Externa'),(18,'Despacho com Transferência Externa'),(19,'Recolhimento ao Arq. Permanente'),(20,'Arquivamento Intermediário'),(21,'Desarquivamento'),(22,'Assinatura de Movimentação'),(23,'Recebimento Transitório'),(24,'Inclusão de Cossignatário'),(25,'Registro de Assinatura'),(26,'Registro de Assinatura de Movimentação'),(27,'Atualização'),(28,'Anotação'),(29,'Redefinição de Sigilo'),(30,'Registro de Acesso Alheio'),(31,'Juntada a Documento Externo'),(32,'Agendamento de Publicação no DJE'),(33,'Remessa para Publicação'),(34,'Confirmação de Remessa Manual'),(35,'Disponibilização'),(36,'Solicitação de Publicação no Boletim'),(37,'Publicação do Boletim'),(38,'Pedido de Publicação no DJE'),(39,'Revolvimento Unidirecional'),(40,'Notificação de Publicação no Boletim'),(41,'Apensação'),(42,'Desapensação'),(43,'Encerramento de Volume'),(44,'Definição de Perfil'),(45,'Autenticação de Documento'),(46,'Sobrestar'),(47,'Desobrestar'),(48,'Tornar sem Efeito'),(49,'Indicação para Guarda Permanente'),(50,'Reversão de Ind. para Guarda Permanente'),(51,'Reclassificação'),(52,'Avaliação'),(53,'Avaliação com Reclassificação'),(54,'Inclusão em Edital de Eliminação'),(55,'Retirada de Edital de Eliminação'),(56,'Desarquivamento Intermediário'),(57,'Pendência de Anexação'),(58,'Assinatura com senha'),(59,'Assinatura de movimentação com senha'),(60,'Autenticação de Documento com senha'),(61,'Controle de Coloboração'),(62,'Marcação'),(63,'Inclusão de Cópia'),(64,'Anexação de Arquivo Auxiliar'),(67,'Autuar');
+INSERT INTO `ex_tipo_movimentacao` VALUES (1,'Criação'),
+(2,'Anexação'),
+(3,'Transferência'),
+(4,'Recebimento'),
+(5,'Despacho'),
+(6,'Despacho com Transferência'),
+(7,'Despacho Interno'),
+(8,'Despacho Interno com Transferência'),
+(9,'Arquivamento Corrente'),
+(10,'Eliminação'),
+(11,'Assinatura'),
+(12,'Juntada'),
+(13,'Desentranhamento'),
+(14,'Cancelamento de Movimentação'),
+(15,'Extravio'),
+(16,'Vinculação'),
+(17,'Transferência Externa'),
+(18,'Despacho com Transferência Externa'),
+(19,'Recolhimento ao Arq. Permanente'),
+(20,'Arquivamento Intermediário'),
+(21,'Desarquivamento'),
+(22,'Assinatura de Movimentação'),
+(23,'Recebimento Transitório'),
+(24,'Inclusão de Cossignatário'),
+(25,'Registro de Assinatura'),
+(26,'Registro de Assinatura de Movimentação'),
+(27,'Atualização'),
+(28,'Anotação'),
+(29,'Redefinição de Sigilo'),
+(30,'Registro de Acesso Alheio'),
+(31,'Juntada a Documento Externo'),
+(32,'Agendamento de Publicação no DJE'),
+(33,'Remessa para Publicação'),
+(34,'Confirmação de Remessa Manual'),
+(35,'Disponibilização'),
+(36,'Solicitação de Publicação no Boletim'),
+(37,'Publicação do Boletim'),
+(38,'Pedido de Publicação no DJE'),
+(39,'Revolvimento Unidirecional'),
+(40,'Notificação de Publicação no Boletim'),
+(41,'Apensação'),
+(42,'Desapensação'),
+(43,'Encerramento de Volume'),
+(44,'Definição de Perfil'),
+(45,'Autenticação de Documento'),
+(46,'Sobrestar'),
+(47,'Desobrestar'),
+(48,'Tornar sem Efeito'),
+(49,'Indicação para Guarda Permanente'),
+(50,'Reversão de Ind. para Guarda Permanente'),
+(51,'Reclassificação'),
+(52,'Avaliação'),
+(53,'Avaliação com Reclassificação'),
+(54,'Inclusão em Edital de Eliminação'),
+(55,'Retirada de Edital de Eliminação'),
+(56,'Desarquivamento Intermediário'),
+(57,'Pendência de Anexação'),
+(58,'Assinatura com senha'),
+(59,'Assinatura de movimentação com senha'),
+(60,'Autenticação de Documento com senha'),
+(61,'Controle de Coloboração'),
+(62,'Marcação'),
+(63,'Inclusão de Cópia'),
+(64,'Anexação de Arquivo Auxiliar'),
+(67,'Autuar');
 /*!40000 ALTER TABLE `ex_tipo_movimentacao` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1120,13 +1412,13 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tp_doc_publicacao`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tp_doc_publicacao` (
   `ID_DOC_PUBLICACAO` INT UNSIGNED NOT NULL AUTO_INCREMENT,
-  `NM_DOC_PUBLICACAO` varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `CARATER` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `NM_DOC_PUBLICACAO` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
+  `CARATER` varchar(1) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   PRIMARY KEY (`ID_DOC_PUBLICACAO`)
-) ENGINE=InnoDB AUTO_INCREMENT=163 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=163 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1135,7 +1427,34 @@ CREATE TABLE `ex_tp_doc_publicacao` (
 
 LOCK TABLES `ex_tp_doc_publicacao` WRITE;
 /*!40000 ALTER TABLE `ex_tp_doc_publicacao` DISABLE KEYS */;
-INSERT INTO `ex_tp_doc_publicacao` VALUES (1,'Ato Ordinatório','J'),(2,'Decisão','J'),(3,'Despacho','J'),(4,'Sentença','J'),(5,'Edital (Teor Judicial)','J'),(6,'Informação de Secretaria',NULL),(7,'Ordem de Serviço',NULL),(8,'Portaria',NULL),(9,'Acórdão','J'),(18,'Outros','A'),(25,'Aviso','A'),(26,'Aviso de Aditamento','A'),(40,'Aviso de Licitação','A'),(73,'Errata',NULL),(83,'Extrato de convênio','A'),(85,'Extratos de Contratos','A'),(86,'Extrato de dispensa de licitação','A'),(90,'Extrato de inexigibilidade de licitação','A'),(104,'Extrato de Registro de Preços','A'),(106,'Extrato de Rescisão','A'),(107,'Extrato de rescisão contratual','A'),(108,'Extrato de termo aditivo','A'),(147,'Aviso de Pregão','A'),(158,'Ato da Presidência',NULL),(159,'Edital da Presidência',NULL),(160,'Portaria da Presidência',NULL),(161,'Ordem de Serviço da presidência',NULL),(162,'Resolução da Presidência',NULL);
+INSERT INTO `ex_tp_doc_publicacao` VALUES (1,'Ato Ordinatório','J'),
+(2,'Decisão','J'),
+(3,'Despacho','J'),
+(4,'Sentença','J'),
+(5,'Edital (Teor Judicial)','J'),
+(6,'Informação de Secretaria',NULL),
+(7,'Ordem de Serviço',NULL),
+(8,'Portaria',NULL),
+(9,'Acórdão','J'),
+(18,'Outros','A'),
+(25,'Aviso','A'),
+(26,'Aviso de Aditamento','A'),
+(40,'Aviso de Licitação','A'),
+(73,'Errata',NULL),
+(83,'Extrato de convênio','A'),
+(85,'Extratos de Contratos','A'),
+(86,'Extrato de dispensa de licitação','A'),
+(90,'Extrato de inexigibilidade de licitação','A'),
+(104,'Extrato de Registro de Preços','A'),
+(106,'Extrato de Rescisão','A'),
+(107,'Extrato de rescisão contratual','A'),
+(108,'Extrato de termo aditivo','A'),
+(147,'Aviso de Pregão','A'),
+(158,'Ato da Presidência',NULL),
+(159,'Edital da Presidência',NULL),
+(160,'Portaria da Presidência',NULL),
+(161,'Ordem de Serviço da presidência',NULL),
+(162,'Resolução da Presidência',NULL);
 /*!40000 ALTER TABLE `ex_tp_doc_publicacao` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1145,7 +1464,7 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tp_forma_doc`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tp_forma_doc` (
   `ID_FORMA_DOC` INT UNSIGNED NOT NULL,
   `ID_TP_DOC` INT UNSIGNED NOT NULL,
@@ -1153,7 +1472,7 @@ CREATE TABLE `ex_tp_forma_doc` (
   KEY `TP_FORMA_DOC_TP_DOC_FK` (`ID_TP_DOC`),
   CONSTRAINT `TP_FORMA_DOC_FORMA_DOC_FK` FOREIGN KEY (`ID_FORMA_DOC`) REFERENCES `ex_forma_documento` (`ID_FORMA_DOC`),
   CONSTRAINT `TP_FORMA_DOC_TP_DOC_FK` FOREIGN KEY (`ID_TP_DOC`) REFERENCES `ex_tipo_documento` (`ID_TP_DOC`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1162,7 +1481,23 @@ CREATE TABLE `ex_tp_forma_doc` (
 
 LOCK TABLES `ex_tp_forma_doc` WRITE;
 /*!40000 ALTER TABLE `ex_tp_forma_doc` DISABLE KEYS */;
-INSERT INTO `ex_tp_forma_doc` VALUES (1,1),(2,1),(3,1),(4,1),(5,3),(8,2),(8,1),(9,1),(9,2),(12,1),(12,2),(13,1),(13,2),(14,1),(14,2),(54,1),(55,1),(56,1),(57,1),(97,1),(97,2),(98,1),(98,2),(99,4);
+INSERT INTO `ex_tp_forma_doc` VALUES (1,1),
+(2,1),
+(3,1),
+(4,1),
+(5,3),
+(8,1),
+(9,1),
+(12,1),
+(13,1),
+(14,1),
+(54,1),
+(55,1),
+(56,1),
+(57,1),
+(97,1),
+(98,1),
+(99,4);
 /*!40000 ALTER TABLE `ex_tp_forma_doc` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1172,14 +1507,14 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_tp_mov_estado`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_tp_mov_estado` (
   `ID_TP_MOV` INT UNSIGNED NOT NULL,
   `ID_ESTADO_DOC` INT UNSIGNED NOT NULL,
   PRIMARY KEY (`ID_TP_MOV`,`ID_ESTADO_DOC`),
   UNIQUE KEY `TP_MOV_ESTADO_PK` (`ID_ESTADO_DOC`,`ID_TP_MOV`),
   CONSTRAINT `TP_MOV_TPMOV_ESTADO_FK` FOREIGN KEY (`ID_TP_MOV`) REFERENCES `ex_tipo_movimentacao` (`ID_TP_MOV`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1188,7 +1523,20 @@ CREATE TABLE `ex_tp_mov_estado` (
 
 LOCK TABLES `ex_tp_mov_estado` WRITE;
 /*!40000 ALTER TABLE `ex_tp_mov_estado` DISABLE KEYS */;
-INSERT INTO `ex_tp_mov_estado` VALUES (1,1),(3,3),(4,2),(5,2),(6,3),(7,2),(8,3),(9,6),(10,8),(12,9),(13,2),(15,4),(17,11),(18,11);
+INSERT INTO `ex_tp_mov_estado` VALUES (1,1),
+(3,3),
+(4,2),
+(5,2),
+(6,3),
+(7,2),
+(8,3),
+(9,6),
+(10,8),
+(12,9),
+(13,2),
+(15,4),
+(17,11),
+(18,11);
 /*!40000 ALTER TABLE `ex_tp_mov_estado` ENABLE KEYS */;
 UNLOCK TABLES;
 
@@ -1198,15 +1546,15 @@ UNLOCK TABLES;
 
 DROP TABLE IF EXISTS `ex_via`;
 /*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!50503 SET character_set_client = utf8mb4 */;
+/*!50503 SET character_set_client = utf8 */;
 CREATE TABLE `ex_via` (
   `ID_VIA` INT UNSIGNED NOT NULL AUTO_INCREMENT,
   `ID_CLASSIFICACAO` INT UNSIGNED NOT NULL,
   `ID_DESTINACAO` INT UNSIGNED DEFAULT NULL,
-  `COD_VIA` varchar(2) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `COD_VIA` varchar(2) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_TEMPORAL_ARQ_COR` smallint(6) DEFAULT NULL,
   `ID_TEMPORAL_ARQ_INT` smallint(6) DEFAULT NULL,
-  `OBS` varchar(4000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `OBS` varchar(4000) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
   `ID_DESTINACAO_FINAL` tinyint(4) DEFAULT NULL,
   `HIS_ID_INI` INT UNSIGNED DEFAULT NULL,
   `HIS_DT_INI` datetime DEFAULT NULL,
@@ -1229,7 +1577,7 @@ CREATE TABLE `ex_via` (
   CONSTRAINT `ex_via_ibfk_1` FOREIGN KEY (`HIS_IDC_INI`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`),
   CONSTRAINT `ex_via_ibfk_2` FOREIGN KEY (`HIS_IDC_FIM`) REFERENCES `corporativo`.`cp_identidade` (`ID_IDENTIDADE`),
   CONSTRAINT `ex_via_ibfk_3` FOREIGN KEY (`HIS_ID_INI`) REFERENCES `ex_via` (`ID_VIA`)
-) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
+) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
 --
@@ -1238,7 +1586,11 @@ CREATE TABLE `ex_via` (
 
 LOCK TABLES `ex_via` WRITE;
 /*!40000 ALTER TABLE `ex_via` DISABLE KEYS */;
-INSERT INTO `ex_via` VALUES (1,4,58,'1',85,NULL,'-',1,1,'2019-03-13 00:00:00',NULL,NULL,NULL,1),(2,7,58,'1',85,NULL,'-',1,2,'2009-03-13 00:00:00',NULL,NULL,NULL,1),(3,8,58,'1',85,NULL,'-',1,3,'2009-03-13 00:00:00',NULL,NULL,NULL,1),(4,11,58,'1',85,NULL,'-',1,4,'2009-03-13 00:00:00',NULL,NULL,NULL,1),(5,12,58,'1',85,NULL,'-',1,5,'2009-03-13 00:00:00',NULL,NULL,NULL,1);
+INSERT INTO `ex_via` VALUES (1,4,58,'1',85,NULL,'-',1,1,'2019-03-13 00:00:00',NULL,NULL,NULL,1),
+(2,7,58,'1',85,NULL,'-',1,2,'2009-03-13 00:00:00',NULL,NULL,NULL,1),
+(3,8,58,'1',85,NULL,'-',1,3,'2009-03-13 00:00:00',NULL,NULL,NULL,1),
+(4,11,58,'1',85,NULL,'-',1,4,'2009-03-13 00:00:00',NULL,NULL,NULL,1),
+(5,12,58,'1',85,NULL,'-',1,5,'2009-03-13 00:00:00',NULL,NULL,NULL,1);
 /*!40000 ALTER TABLE `ex_via` ENABLE KEYS */;
 UNLOCK TABLES;
 
diff --git a/siga-rel/pom.xml b/siga-rel/pom.xml
index 8aeb72515e..d3d18e73f7 100644
--- a/siga-rel/pom.xml
+++ b/siga-rel/pom.xml
@@ -13,6 +13,10 @@
     <artifactId>siga-rel</artifactId>
 
     <dependencies>
+   		<dependency>
+			<groupId>siga</groupId>
+			<artifactId>siga-base</artifactId>
+		</dependency>
         <dependency>
             <groupId>ar.com.fdvs</groupId>
             <artifactId>DynamicJasper</artifactId>
diff --git a/siga-rel/src/main/java/br/gov/jfrj/relatorio/dinamico/RelatorioTemplate.java b/siga-rel/src/main/java/br/gov/jfrj/relatorio/dinamico/RelatorioTemplate.java
index a7f41d43d1..6347ee604b 100644
--- a/siga-rel/src/main/java/br/gov/jfrj/relatorio/dinamico/RelatorioTemplate.java
+++ b/siga-rel/src/main/java/br/gov/jfrj/relatorio/dinamico/RelatorioTemplate.java
@@ -19,22 +19,19 @@
 package br.gov.jfrj.relatorio.dinamico;
 
 import java.io.ByteArrayOutputStream;
-import java.io.File;
 import java.io.IOException;
 import java.util.Collection;
-import java.util.HashMap;
 import java.util.Map;
 
+import ar.com.fdvs.dj.domain.builders.ColumnBuilderException;
+import ar.com.fdvs.dj.domain.builders.DJBuilderException;
+import ar.com.fdvs.dj.domain.constants.VerticalAlign;
+import br.gov.jfrj.siga.base.AplicacaoException;
 import net.sf.jasperreports.engine.JRException;
 import net.sf.jasperreports.engine.JRExporterParameter;
 import net.sf.jasperreports.engine.JasperExportManager;
-import net.sf.jasperreports.engine.export.JRHtmlExporter;
-import net.sf.jasperreports.engine.export.JRHtmlExporterParameter;
 import net.sf.jasperreports.engine.export.JRXlsExporterParameter;
 import net.sf.jasperreports.engine.export.ooxml.JRXlsxExporter;
-import ar.com.fdvs.dj.domain.builders.ColumnBuilderException;
-import ar.com.fdvs.dj.domain.builders.DJBuilderException;
-import ar.com.fdvs.dj.domain.constants.VerticalAlign;
 
 /**
  * USE ESTA CLASSE para a criação de relatórios rápidos.<br>
@@ -202,7 +199,7 @@ public abstract class RelatorioTemplate extends RelatorioRapido {
 		if (dados != null && dados.size() > 0) {
 			relatorio.setDados(dados);
 		} else {
-			throw new Exception("Não há dados para gerar o relatório!");
+			throw new AplicacaoException("Não há dados para gerar o relatório!");
 		}
 
 	}
@@ -274,24 +271,24 @@ public abstract class RelatorioTemplate extends RelatorioRapido {
 		// JasperViewer.viewReport(relatorio.getRelatorio());
 	}
 
-	public StringBuffer getRelatorioHTML() throws JRException {
-		JRHtmlExporter htmlExp = new JRHtmlExporter();
-
-		htmlExp.setParameter(JRExporterParameter.JASPER_PRINT,
-				relatorio.getRelatorioJasperPrint());
-		StringBuffer sb = new StringBuffer();
-		htmlExp.setParameter(JRHtmlExporterParameter.IMAGES_DIR, new File(
-				RelatorioTemplate.class.getResource("/").getFile()));
-		htmlExp.setParameter(JRHtmlExporterParameter.IMAGES_MAP,
-				new HashMap<String, Object>());
-		htmlExp.setParameter(JRHtmlExporterParameter.IMAGES_URI, "");
-		htmlExp.setParameter(JRHtmlExporterParameter.IS_OUTPUT_IMAGES_TO_DIR,
-				true);
-		htmlExp.setParameter(JRExporterParameter.OUTPUT_STRING_BUFFER, sb);
-
-		htmlExp.exportReport();
-		return sb;
-	}
+//	public StringBuffer getRelatorioHTML() throws JRException {
+//		JRHtmlExporter htmlExp = new JRHtmlExporter();
+//
+//		htmlExp.setParameter(JRExporterParameter.JASPER_PRINT,
+//				relatorio.getRelatorioJasperPrint());
+//		StringBuffer sb = new StringBuffer();
+//		htmlExp.setParameter(JRHtmlExporterParameter.IMAGES_DIR, new File(
+//				RelatorioTemplate.class.getResource("/").getFile()));
+//		htmlExp.setParameter(JRHtmlExporterParameter.IMAGES_MAP,
+//				new HashMap<String, Object>());
+//		htmlExp.setParameter(JRHtmlExporterParameter.IMAGES_URI, "");
+//		htmlExp.setParameter(JRHtmlExporterParameter.IS_OUTPUT_IMAGES_TO_DIR,
+//				true);
+//		htmlExp.setParameter(JRExporterParameter.OUTPUT_STRING_BUFFER, sb);
+//
+//		htmlExp.exportReport();
+//		return sb;
+//	}
 
 	public byte[]  getRelatorioExcel() throws JRException, IOException {
 		try (ByteArrayOutputStream xlsReport = new ByteArrayOutputStream()) {
diff --git a/siga-rel/src/main/resources/RelatorioBase.jrxml b/siga-rel/src/main/resources/RelatorioBase.jrxml
index 200c315240..f36cf2cb62 100644
--- a/siga-rel/src/main/resources/RelatorioBase.jrxml
+++ b/siga-rel/src/main/resources/RelatorioBase.jrxml
@@ -26,6 +26,12 @@
 	<parameter name="secaoUsuario" isForPrompting="false" class="java.lang.String">
 		<defaultValueExpression ><![CDATA[$P{secaoUsuario}]]></defaultValueExpression>
 	</parameter>
+	<parameter name="titulo" isForPrompting="false" class="java.lang.String">
+		<defaultValueExpression ><![CDATA[$P{titulo}]]></defaultValueExpression>
+	</parameter>
+	<parameter name="subtitulo" isForPrompting="false" class="java.lang.String">
+		<defaultValueExpression ><![CDATA[$P{subtitulo}]]></defaultValueExpression>
+	</parameter>
 	<parameter name="dataInicio" isForPrompting="false" class="java.lang.String">
 		<defaultValueExpression ><![CDATA[$P{dataInicio}]]></defaultValueExpression>
 	</parameter>
@@ -67,12 +73,12 @@ order by descr_forma_doc,nm_mod]]></queryString>
 		</background>
 		<title>
 			<band height="68"  isSplitAllowed="true" >
-				<staticText>
+				<textField isStretchWithOverflow="false">
 					<reportElement
 						mode="Opaque"
 						x="72"
 						y="12"
-						width="129"
+						width="250"
 						height="13"
 						forecolor="#000000"
 						backcolor="#FFFFFF"
@@ -81,8 +87,8 @@ order by descr_forma_doc,nm_mod]]></queryString>
 					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" lineSpacing="Single">
 						<font fontName="Arial" pdfFontName="Helvetica" size="11" isBold="false" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
 					</textElement>
-				<text><![CDATA[PODER JUDICIÁRIO]]></text>
-				</staticText>
+					<textFieldExpression   class="java.lang.String"><![CDATA[$P{titulo}.toString()]]></textFieldExpression>
+				</textField>
 				<image  scaleImage="RetainShape" vAlign="Middle" hAlign="Center" isUsingCache="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
 					<reportElement
 						mode="Opaque"
@@ -95,14 +101,14 @@ order by descr_forma_doc,nm_mod]]></queryString>
 						key="image-1"/>
 					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
 					<graphicElement stretchType="NoStretch" pen="None" fill="Solid" />
-					<imageExpression class="java.lang.String"><![CDATA["brasao.png"]]></imageExpression>
+					<imageExpression class="java.lang.String"><![CDATA[$P{brasao}]]></imageExpression>
 				</image>
-				<staticText>
+				<textField isStretchWithOverflow="false">
 					<reportElement
 						mode="Opaque"
 						x="71"
 						y="26"
-						width="98"
+						width="250"
 						height="13"
 						forecolor="#000000"
 						backcolor="#FFFFFF"
@@ -111,8 +117,8 @@ order by descr_forma_doc,nm_mod]]></queryString>
 					<textElement textAlignment="Left" verticalAlignment="Middle" rotation="None" lineSpacing="Single">
 						<font fontName="Arial" pdfFontName="Helvetica" size="10" isBold="true" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
 					</textElement>
-				<text><![CDATA[JUSTIÇA FEDERAL]]></text>
-				</staticText>
+					<textFieldExpression   class="java.lang.String"><![CDATA[$P{subtitulo}.toString()]]></textFieldExpression>
+				</textField>
 				<textField isStretchWithOverflow="false" pattern="dd/MM/yyyy" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
 					<reportElement
 						mode="Opaque"
diff --git a/siga-vraptor-module/src/main/java/br/com/caelum/iogi/ObjetoObjectInstantiator.java b/siga-vraptor-module/src/main/java/br/com/caelum/iogi/ObjetoObjectInstantiator.java
deleted file mode 100644
index e91c955c2d..0000000000
--- a/siga-vraptor-module/src/main/java/br/com/caelum/iogi/ObjetoObjectInstantiator.java
+++ /dev/null
@@ -1,139 +0,0 @@
-package br.com.caelum.iogi;
-
-import javax.persistence.EntityManager;
-
-import br.com.caelum.iogi.DependenciesInjector;
-import br.com.caelum.iogi.Instantiator;
-import br.com.caelum.iogi.exceptions.InvalidTypeException;
-import br.com.caelum.iogi.parameters.Parameter;
-import br.com.caelum.iogi.parameters.Parameters;
-import br.com.caelum.iogi.reflection.NewObject;
-import br.com.caelum.iogi.reflection.Target;
-import br.com.caelum.iogi.spi.DependencyProvider;
-import br.com.caelum.iogi.spi.ParameterNamesProvider;
-import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.Objeto;
-
-public class ObjetoObjectInstantiator implements Instantiator<Object> {
-
-	private final Instantiator<Object> argumentInstantiator;
-	private final DependenciesInjector dependenciesInjector;
-	private final ParameterNamesProvider parameterNamesProvider;
-
-	public ObjetoObjectInstantiator(
-			final Instantiator<Object> argumentInstantiator,
-			final DependencyProvider dependencyProvider,
-			final ParameterNamesProvider parameterNamesProvider) {
-		this.argumentInstantiator = argumentInstantiator;
-		this.dependenciesInjector = new DependenciesInjector(dependencyProvider);
-		this.parameterNamesProvider = parameterNamesProvider;
-	}
-
-	public boolean isAbleToInstantiate(final Target<?> target) {
-		return true;
-	}
-
-	public Object instantiate(final Target<?> target,
-			final Parameters parameters) {
-
-		//Edson: comentei porque, em alguns casos (por exemplo, CpConfiguracao.CpGrupo), 
-		//o tipo da propriedade é uma abstract mas vem do formulário o id de um objeto de 
-		//uma subclasse (por exemplo, CpPerfil)
-		//expectingAConcreteTarget(target);
-
-		final Parameters parametersForTarget = parameters.focusedOn(target);
-
-		Object obj = null;
-
-		if (target.getType() instanceof Class
-				&& Objeto.class
-						.isAssignableFrom(((Class) target.getType()))) {
-			Long id = null;
-			boolean allNull = true;
-
-			String keyName = target.getName() + ".id";
-			for (Parameter p : parameters.forTarget(target)) {
-				if (p.getValue() != null
-						&& p.getValue().length() > 0) {
-					allNull = false;
-					if (keyName.equals(p.getName()) || keyName.equals(p.getName().replaceAll("\\[\\d+\\]", ""))) 
-						id = Long.valueOf(p.getValue());
-				}
-			}
-			
-			if (allNull)
-				return null;
-
-			// Desabilitei a leitura a partir da id para simplificar o
-			// polimorfismo
-			// if (key == null) {
-			// try {
-			// key = Key.create(obj);
-			// } catch (IllegalArgumentException e) {
-			// if (e.getMessage()
-			// .startsWith(
-			// "You cannot create a Key for an object with a null @Id"))
-			// return obj;
-			// }
-			// }
-
-			try {
-				if (id != null) {
-					EntityManager em = ContextoPersistencia.em();
-					obj = em.find(target.getClassType(), id);
-					if (obj != null)
-						em.detach(obj); // Detached para que não seja acidentalmente
-					// salva no banco de dados
-				}
-			} catch (Exception e) {
-				throw new RuntimeException(
-						"Não foi possível ler um objeto do banco de dados.", e);
-			}
-
-			// if (obj == null) {
-			// String className = target.getName() + ".class";
-			// for (Parameter p : parameters.forTarget(target)) {
-			// if (className.equals(p.getName())) {
-			// try {
-			// obj =
-			// this.getClass().getClassLoader().loadClass(p.getValue()).newInstance();
-			// } catch (InstantiationException | IllegalAccessException
-			// | ClassNotFoundException e) {
-			// throw new RuntimeException("Can't instantiate entity of class " +
-			// p.getValue(), e);
-			// }
-			// }
-			// }
-			// }
-
-			if (obj == null)
-				return target
-						.constructors(parameterNamesProvider,
-								dependenciesInjector)
-						.compatibleWith(parametersForTarget).largest()
-						.instantiate(argumentInstantiator)
-						.valueWithPropertiesSet();
-			else {
-				NewObject nobj = new NewObject(argumentInstantiator,
-					parametersForTarget, obj);
-
-				return nobj.valueWithPropertiesSet();
-			}
-		} else {
-			obj = target
-					.constructors(parameterNamesProvider, dependenciesInjector)
-					.compatibleWith(parametersForTarget).largest()
-					.instantiate(argumentInstantiator).valueWithPropertiesSet();
-			return obj;
-		}
-
-	}
-
-	private <T> void expectingAConcreteTarget(final Target<T> target) {
-		if (!target.isInstantiable())
-			throw new InvalidTypeException(
-					"Cannot instantiate abstract type %s",
-					target.getClassType());
-	}
-
-}
\ No newline at end of file
diff --git a/siga-vraptor-module/src/main/java/br/com/caelum/iogi/parameters/ParametersHelper.java b/siga-vraptor-module/src/main/java/br/com/caelum/iogi/parameters/ParametersHelper.java
deleted file mode 100644
index e1f998cb53..0000000000
--- a/siga-vraptor-module/src/main/java/br/com/caelum/iogi/parameters/ParametersHelper.java
+++ /dev/null
@@ -1,22 +0,0 @@
-package br.com.caelum.iogi.parameters;
-
-/**
- * Helper para possibilitar o acesso a lista de parametros
- * 
- * @author DB1
- *
- */
-public class ParametersHelper {
-
-	public static Parameter findIdParameter(Parameters parameters, String name) {
-		for (Parameter parameter : parameters.getParametersList()) {
-			/**
-			 * Se o nome do parametro esta em branco ele representa o atributo sendo convertido
-			 */
-			if (parameter.getName().isEmpty() || parameter.getName().equals(name)) {
-				return parameter;
-			}
-		}
-		return null;
-	}
-}
\ No newline at end of file
diff --git a/siga-vraptor-module/src/main/java/br/com/caelum/vraptor/http/iogi/ObjetoInstantiator.java b/siga-vraptor-module/src/main/java/br/com/caelum/vraptor/http/iogi/ObjetoInstantiator.java
deleted file mode 100644
index faf51b4ae5..0000000000
--- a/siga-vraptor-module/src/main/java/br/com/caelum/vraptor/http/iogi/ObjetoInstantiator.java
+++ /dev/null
@@ -1,186 +0,0 @@
-package br.com.caelum.vraptor.http.iogi;
-
-/***
- * Copyright (c) 2009 Caelum - www.caelum.com.br/opensource
- * All rights reserved.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- * http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-import java.util.List;
-
-import javax.enterprise.inject.Specializes;
-import javax.inject.Inject;
-import javax.servlet.http.HttpServletRequest;
-
-import com.google.common.collect.ImmutableList;
-
-import br.com.caelum.iogi.Instantiator;
-import br.com.caelum.iogi.MultiInstantiator;
-import br.com.caelum.iogi.ObjetoObjectInstantiator;
-import br.com.caelum.iogi.collections.ArrayInstantiator;
-import br.com.caelum.iogi.collections.ListInstantiator;
-import br.com.caelum.iogi.conversion.FallbackConverter;
-import br.com.caelum.iogi.conversion.StringConverter;
-import br.com.caelum.iogi.exceptions.ConversionException;
-import br.com.caelum.iogi.parameters.Parameter;
-import br.com.caelum.iogi.parameters.Parameters;
-import br.com.caelum.iogi.reflection.NewObject;
-import br.com.caelum.iogi.reflection.Target;
-import br.com.caelum.iogi.spi.DependencyProvider;
-import br.com.caelum.iogi.spi.ParameterNamesProvider;
-import br.com.caelum.vraptor.converter.Converter;
-import br.com.caelum.vraptor.core.Converters;
-import br.com.caelum.vraptor.http.InvalidParameterException;
-import br.com.caelum.vraptor.validator.Message;
-import br.com.caelum.vraptor.validator.SimpleMessage;
-import br.com.caelum.vraptor.validator.ValidationException;
-
-@Specializes
-public class ObjetoInstantiator implements InstantiatorWithErrors,
-		Instantiator<Object> {
-	private final MultiInstantiator multiInstantiator;
-	private List<Message> errors;
-	private final DependencyProvider provider;
-
-	@Inject
-	public ObjetoInstantiator(Converters converters,
-			DependencyProvider provider, 
-			ParameterNamesProvider parameterNameProvider,
-			HttpServletRequest request) {
-		this.provider = provider;
-		
-		ObjetoObjectInstantiator objectInstantiator = new ObjetoObjectInstantiator(
-				this, provider, parameterNameProvider);
-		List<Instantiator<?>> instantiatorList = ImmutableList.of(
-				new RequestAttributeInstantiator(request),
-				new VRaptorTypeConverter(converters),
-				FallbackConverter.fallbackToNull(new StringConverter()),
-				new ArrayAdapter(new ArrayInstantiator(this)),
-				new NullDecorator(new ListInstantiator(this)), // NOTE:
-																// NullDecorator
-																// is here to
-																// preserve
-																// existing
-																// behaviour.
-																// Don't know if
-																// it is the
-																// ideal one,
-																// though.
-				new NullDecorator(new SetInstantiator(this)),
-				new DependencyInstantiator(objectInstantiator),
-				objectInstantiator);
-		multiInstantiator = new MultiInstantiator(instantiatorList);
-	}
-
-	public boolean isAbleToInstantiate(Target<?> target) {
-		return true;
-	}
-
-	public Object instantiate(Target<?> target, Parameters parameters,
-			List<Message> errors) {
-		this.errors = errors;
-		return instantiate(target, parameters);
-	}
-
-	public Object instantiate(Target<?> target, Parameters parameters) {
-		try {
-			return multiInstantiator.instantiate(target, parameters);
-		} catch (Exception e) {
-			handleException(target, e);
-			return null;
-		}
-	}
-
-	private void handleException(Target<?> target, Throwable e) {
-		if (e instanceof ValidationException) {
-			errors.add(new SimpleMessage("validation", e.getLocalizedMessage(), target
-					.getName()));
-		} else if (e.getCause() == null) {
-			throw new InvalidParameterException(
-					"Exception when trying to instantiate " + target, e);
-		} else {
-			handleException(target, e.getCause());
-		}
-	}
-
-	private final class DependencyInstantiator implements Instantiator<Object> {
-		private final Instantiator<Object> delegate;
-
-		public DependencyInstantiator(Instantiator<Object> delegate) {
-			this.delegate = delegate;
-		}
-
-		public Object instantiate(Target<?> target, Parameters params) {
-			return provider.provide(target);
-		}
-
-		public boolean isAbleToInstantiate(Target<?> target) {
-			return target.getClassType().isInterface()
-					&& provider.canProvide(target);
-		}
-
-	}
-
-	private final class VRaptorTypeConverter implements Instantiator<Object> {
-		private final Converters converters;
-
-		public VRaptorTypeConverter(Converters converters) {
-			this.converters = converters;
-		}
-
-		public boolean isAbleToInstantiate(Target<?> target) {
-			return converters.existsFor(target.getClassType());
-		}
-
-		public Object instantiate(Target<?> target, Parameters parameters) {
-			try {
-				Parameter parameter = parameters.namedAfter(target);
-				return converterForTarget(target).convert(parameter.getValue(),
-						target.getClassType());
-			} catch (ConversionException ex) {
-				errors.add(new SimpleMessage("conversion", ex.getMessage(), target
-						.getName()));
-			} catch (IllegalStateException e) {
-				return setPropertiesAfterConversions(target, parameters);
-			}
-			return null;
-		}
-
-		private Object setPropertiesAfterConversions(Target<?> target,
-				Parameters parameters) {
-			List<Parameter> params = parameters.forTarget(target);
-			Parameter parameter = findParamFor(params, target);
-
-			Object converted = converterForTarget(target).convert(
-					parameter.getValue(), target.getClassType());
-
-			return new NewObject(this, parameters.focusedOn(target), converted)
-					.valueWithPropertiesSet();
-		}
-
-		private Parameter findParamFor(List<Parameter> params, Target<?> target) {
-			for (Parameter parameter : params) {
-				if (parameter.getName().equals(target.getName())) {
-					return parameter;
-				}
-			}
-			return null;
-		}
-
-		@SuppressWarnings("unchecked")
-		private Converter<Object> converterForTarget(Target<?> target) {
-			return (Converter<Object>) converters.to(target.getClassType());
-		}
-	}
-}
diff --git a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/idp/jwt/AuthJwtFormFilter.java b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/idp/jwt/AuthJwtFormFilter.java
index 4ba7912ee9..b7bb9cb90b 100644
--- a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/idp/jwt/AuthJwtFormFilter.java
+++ b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/idp/jwt/AuthJwtFormFilter.java
@@ -121,7 +121,7 @@ public class AuthJwtFormFilter implements Filter {
 			if ("jwt expired".equals(e.getMessage()))
 				redirecionarParaFormDeLogin(req, resp, e);
 			else
-				throw new RuntimeException(e);
+				throw new ServletException(e);
 		} catch (SigaJwtInvalidException e) {
 			redirecionarParaFormDeLogin(req, resp, e);
 			return;
@@ -130,7 +130,7 @@ public class AuthJwtFormFilter implements Filter {
 				informarAutenticacaoProibida(resp, e);
 				return;
 			} else {
-				throw new RuntimeException(e);
+				throw new ServletException(e);
 			}
 		} finally {
 			ContextoPersistencia.removeUserPrincipal();
diff --git a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/jee/SigaErrorHandlerServlet.java b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/jee/SigaErrorHandlerServlet.java
new file mode 100644
index 0000000000..4c3d6683c5
--- /dev/null
+++ b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/jee/SigaErrorHandlerServlet.java
@@ -0,0 +1,42 @@
+package br.gov.jfrj.siga.jee;
+
+import java.io.IOException;
+
+import javax.servlet.ServletException;
+import javax.servlet.http.HttpServlet;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+@SuppressWarnings("serial")
+public class SigaErrorHandlerServlet extends HttpServlet {
+
+	// Method to handle GET method request.
+	public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
+		Throwable throwable = (Throwable) request.getAttribute("javax.servlet.error.exception");
+		Integer statusCode = (Integer) request.getAttribute("javax.servlet.error.status_code");
+		String servletName = (String) request.getAttribute("javax.servlet.error.servlet_name");
+		String newWindow = (String) request.getParameter("newWindow");
+		if ("1".equals(newWindow))
+			request.setAttribute("newWindow", newWindow);
+
+		if (servletName == null) {
+			servletName = "Unknown";
+		}
+		String requestUri = (String) request.getAttribute("javax.servlet.error.request_uri");
+
+		if (requestUri == null) {
+			requestUri = "Unknown";
+		}
+
+		if (response.isCommitted())
+			return;
+		
+		request.setAttribute("exception", throwable);
+
+		request.getRequestDispatcher("/WEB-INF/page/erroGeral.jsp").forward(request, response);
+	}
+
+	public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
+		doGet(request, response);
+	}
+}
\ No newline at end of file
diff --git a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/jee/SigaLibsEL.java b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/jee/SigaLibsEL.java
index 3a906c54f1..632b3f082f 100644
--- a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/jee/SigaLibsEL.java
+++ b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/jee/SigaLibsEL.java
@@ -83,11 +83,18 @@ public class SigaLibsEL {
 		return Texto.maiusculasEMinusculas(s);
 	}
 
+	public static String slugify(String string, Boolean lowercase,
+			Boolean underscore) {
+		return Texto.slugify(string, lowercase, underscore);
+	}
+
 	public static Object resource(String name) {
 		return Contexto.resource(name);
 	}
 
 	public static String espera(Date dt) {
+		if (dt == null)
+			return null;
 		SigaCalendar c = new SigaCalendar();
 		SigaCalendar lAnterior = new SigaCalendar(dt.getTime());
 		// long l = -c.diffDayPeriods(lAnterior);
diff --git a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaController.java b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaController.java
index 9cd8bd1ea5..11134c37dd 100644
--- a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaController.java
+++ b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaController.java
@@ -6,6 +6,7 @@ import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.UnsupportedEncodingException;
+import java.lang.reflect.Type;
 import java.net.URLEncoder;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
@@ -16,9 +17,27 @@ import java.util.Map;
 
 import javax.inject.Inject;
 import javax.persistence.EntityManager;
+import javax.servlet.ServletContext;
 import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import org.apache.axis.encoding.Base64;
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
 
 import com.google.common.collect.Lists;
+import com.google.gson.ExclusionStrategy;
+import com.google.gson.FieldAttributes;
+import com.google.gson.Gson;
+import com.google.gson.GsonBuilder;
+import com.google.gson.JsonDeserializationContext;
+import com.google.gson.JsonDeserializer;
+import com.google.gson.JsonElement;
+import com.google.gson.JsonParseException;
+import com.google.gson.JsonPrimitive;
+import com.google.gson.JsonSerializationContext;
+import com.google.gson.JsonSerializer;
 
 import br.com.caelum.vraptor.Result;
 import br.com.caelum.vraptor.observer.upload.UploadedFile;
@@ -26,6 +45,7 @@ import br.com.caelum.vraptor.validator.Validator;
 import br.com.caelum.vraptor.view.HttpResult;
 import br.com.caelum.vraptor.view.Results;
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.log.RequestExceptionLogger;
 import br.gov.jfrj.siga.base.util.Paginador;
 import br.gov.jfrj.siga.cp.CpIdentidade;
 import br.gov.jfrj.siga.cp.bl.Cp;
@@ -46,29 +66,31 @@ public class SigaController {
 	protected CpDao dao;
 
 	private Paginador p = new Paginador();
-		
+
 	private Integer postback;
-	
-	
+
 	private String mensagemAguarde = null;
-	
-	//Todo: verificar se após a migração do vraptor se ainda necessita deste atributo "par"
+
+	private HttpServletResponse response;
+	private ServletContext context;
+
+	// Todo: verificar se após a migração do vraptor se ainda necessita deste
+	// atributo "par"
 	private Map<String, String[]> par;
 
 	private Validator validator;
-	
+
 	protected Map<String, String[]> getPar() {
 		return par;
 	}
-	
+
 	protected void setParam(final String parameterName, final String parameterValue) {
 		final String as[] = { parameterValue };
 		getPar().put(parameterName, as);
 		return;
-	}	
-	
-	protected String getUrlEncodedParameters()
-			throws UnsupportedEncodingException, IOException {
+	}
+
+	protected String getUrlEncodedParameters() throws UnsupportedEncodingException, IOException {
 		if (getPar() != null) {
 			try (ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
 				for (final String key : getPar().keySet()) {
@@ -86,7 +108,7 @@ public class SigaController {
 		}
 		return null;
 	}
-	
+
 	protected CpDao dao() {
 		return CpDao.getInstance();
 	}
@@ -94,40 +116,45 @@ public class SigaController {
 	protected Integer getPostback() {
 		return postback;
 	}
-	
+
 	/**
 	 * @deprecated CDI eyes only
 	 */
 	public SigaController() {
 		super();
 	}
-	
+
 	@SuppressWarnings("unchecked")
-	public SigaController(HttpServletRequest request, Result result, CpDao dao,
-			SigaObjects so, EntityManager em) {
+	public SigaController(HttpServletRequest request, Result result, CpDao dao, SigaObjects so, EntityManager em) {
 		super();
 		this.setRequest(request);
 		this.dao = dao;
-		this.setPar(new HashMap<>( getRequest().getParameterMap()));
+		this.setPar(new HashMap<>(getRequest().getParameterMap()));
 		this.result = result;
 		this.so = so;
 		this.em = em;
 
-		result.on(AplicacaoException.class).forwardTo(this).appexception();
-		result.on(Exception.class).forwardTo(this).exception();
-		
+		try {
+			result.on(AplicacaoException.class).forwardTo(this).appexception();
+			result.on(Exception.class).forwardTo(this).exception();
+		} catch (Throwable ex) {
+		}
+
 		result.include("cadastrante", getCadastrante());
 		result.include("lotaCadastrante", getLotaCadastrante());
 		result.include("titular", getTitular());
 		result.include("lotaTitular", getLotaTitular());
 		result.include("meusTitulares", getMeusTitulares());
-		result.include("identidadeCadastrante",getIdentidadeCadastrante());
+		result.include("identidadeCadastrante", getIdentidadeCadastrante());
 	}
-	
+
 	@Inject
 	private void setValidator(Validator validator) {
 		this.validator = validator;
-		this.validator.onErrorUse(Results.page()).of(SigaController.class).exception();
+		try {
+			this.validator.onErrorUse(Results.page()).of(SigaController.class).exception();
+		} catch (Throwable ex) {
+		}
 	}
 
 	protected List<DpSubstituicao> getMeusTitulares() {
@@ -142,92 +169,96 @@ public class SigaController {
 			throw new AplicacaoException("Erro", 500, e);
 		}
 	}
-	
+
 	protected byte[] toByteArray(final UploadedFile upload) throws IOException {
 		try (InputStream is = upload.getFile()) {
 			// Get the size of the file
 			final long tamanho = upload.getSize();
-	
+
 			// Não podemos criar um array usando o tipo long.
 			// é necessário usar o tipo int.
 			if (tamanho > Integer.MAX_VALUE)
 				throw new IOException("Arquivo muito grande");
-	
+
 			// Create the byte array to hold the data
 			final byte[] meuByteArray = new byte[(int) tamanho];
-	
+
 			// Read in the bytes
 			int offset = 0;
 			int numRead = 0;
-			while (offset < meuByteArray.length && (numRead = is.read(meuByteArray, offset, meuByteArray.length - offset)) >= 0) {
+			while (offset < meuByteArray.length
+					&& (numRead = is.read(meuByteArray, offset, meuByteArray.length - offset)) >= 0) {
 				offset += numRead;
 			}
-	
+
 			// Ensure all the bytes have been read in
 			if (offset < meuByteArray.length)
 				throw new IOException("Não foi possível ler o arquivo completamente " + upload.getFileName());
-	
+
 			return meuByteArray;
 		}
 	}
 
-
-
 	private void resolveLazy(List<DpSubstituicao> substituicoes) {
 		for (DpSubstituicao dpSubstituicao : substituicoes) {
 			if (dpSubstituicao.getTitular() != null) {
 				dpSubstituicao.getTitular().getId();
 			}
-			
+
 			if (dpSubstituicao.getLotaTitular() != null) {
 				dpSubstituicao.getLotaTitular().getId();
 			}
 		}
 	}
-	
-	public void appexception() {
+
+	public void appexception() throws Throwable {
 		configurarHttpResult(400);
+		throw (Throwable) result.included().get("exception");
 	}
 
-	public void exception() {
+	public void exception() throws Throwable {
 		configurarHttpResult(500);
+		throw (Throwable) result.included().get("exception");
+		// new RequestExceptionLogger(request, (Exception) result.included().get("exception"), 0L, this.getClass().getName()).logar();
 	}
-	
+
 	private void configurarHttpResult(int statusCode) {
 		HttpResult res = this.result.use(http());
 		res.setStatusCode(statusCode);
 		definirPaginaDeErro();
 	}
-    
+
 	private void definirPaginaDeErro() {
-		if (requisicaoEhAjax())
-		    result.forwardTo("/WEB-INF/page/erroGeralAjax.jsp");
-		else 
-		    result.forwardTo("/WEB-INF/page/erroGeral.jsp");
-    }
-	
-    private boolean requisicaoEhAjax() {
-        return request.getHeader("X-Requested-With") != null;
-    }
-    
+		if (!response.isCommitted()) {
+			if (requisicaoEhAjax())
+				result.forwardTo("/WEB-INF/page/erroGeralAjax.jsp");
+			else
+				result.forwardTo("/WEB-INF/page/erroGeral.jsp");
+		}
+	}
+
+	private boolean requisicaoEhAjax() {
+		return request.getHeader("X-Requested-With") != null;
+	}
+
 	protected DpLotacao getLotaTitular() {
 		return so.getLotaTitular();
 	}
-	
+
 	protected void setLotaTitular(DpLotacao lotaTitular) {
 		so.setLotaTitular(lotaTitular);
-	}	
+	}
 
 	protected DpPessoa getTitular() {
 		return so.getTitular();
 	}
-	
+
 	protected void setTitular(DpPessoa titular) {
 		so.setTitular(titular);
 	}
-	
-	protected DpLotacao getLotaCadastrante(){
-		if(null != so.getCadastrante()) {
+
+	protected DpLotacao getLotaCadastrante() {
+		if (null != so.getCadastrante()) {
 			return so.getCadastrante().getLotacao();
 		} else {
 			return null;
@@ -237,9 +268,9 @@ public class SigaController {
 	protected DpPessoa getCadastrante() {
 		return so.getCadastrante();
 	}
-	
+
 	protected void setCadastrante(DpPessoa cadastrante) {
-		so.setCadastrante(cadastrante);		
+		so.setCadastrante(cadastrante);
 	}
 
 	protected CpIdentidade getIdentidadeCadastrante() {
@@ -333,15 +364,15 @@ public class SigaController {
 	protected void setRequest(HttpServletRequest request) {
 		this.request = request;
 	}
-	
+
 	protected void assertAcesso(final String pathServico) {
 		so.assertAcesso(pathServico);
-	}	
-	
+	}
+
 	protected void setP(Paginador p) {
 		this.p = p;
 	}
-	
+
 	@SuppressWarnings({ "unchecked", "rawtypes" })
 	protected void setPar(final Map par) {
 		this.par = par;
@@ -350,11 +381,11 @@ public class SigaController {
 	protected void setPostback(final Integer postback) {
 		this.postback = postback;
 	}
-	
+
 	protected String getMensagemAguarde() {
 		return mensagemAguarde;
 	}
-	
+
 	protected void setMensagemAguarde(String mensagemAguarde) {
 		this.mensagemAguarde = mensagemAguarde;
 	}
@@ -362,14 +393,111 @@ public class SigaController {
 	protected List<CpOrgaoUsuario> getOrgaosUsu() throws AplicacaoException {
 		return dao().listarOrgaosUsuarios();
 	}
-	
+
 	protected Paginador getP() {
 		return p;
 	}
-	
-	protected boolean podeUtilizarServico(String servico)
-			throws Exception {
+
+	protected boolean podeUtilizarServico(String servico) throws Exception {
 		return Cp.getInstance().getConf().podeUtilizarServicoPorConfiguracao(getTitular(), getLotaTitular(), servico);
 	}
 
+	// Recursos para possibilitar o retorno de JSON
+	//
+	public static String ISO_FORMAT = "yyyy-MM-dd'T'HH:mm:ss.SSSXXX";
+	public static final SimpleDateFormat isoFormatter = new SimpleDateFormat(ISO_FORMAT);
+
+	public static final Gson gson = new GsonBuilder().setExclusionStrategies(new ExclusionStrategy() {
+
+		@Override
+		public boolean shouldSkipClass(Class<?> clazz) {
+			return false;
+		}
+
+		@Override
+		public boolean shouldSkipField(FieldAttributes f) {
+			return false;
+		}
+
+	}).registerTypeHierarchyAdapter(byte[].class, new ByteArrayToBase64TypeAdapter())
+			.registerTypeHierarchyAdapter(Date.class, new DateToStringTypeAdapter()).setPrettyPrinting().create();
+
+	private static class ByteArrayToBase64TypeAdapter implements JsonSerializer<byte[]>, JsonDeserializer<byte[]> {
+		public byte[] deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context)
+				throws JsonParseException {
+			return Base64.decode(json.getAsString());
+		}
+
+		public JsonElement serialize(byte[] src, Type typeOfSrc, JsonSerializationContext context) {
+			return new JsonPrimitive(Base64.encode(src));
+		}
+	}
+
+	private static class DateToStringTypeAdapter implements JsonSerializer<Date>, JsonDeserializer<Date> {
+		public Date deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context)
+				throws JsonParseException {
+			return parse(json.getAsString());
+		}
+
+		public JsonElement serialize(Date src, Type typeOfSrc, JsonSerializationContext context) {
+			return new JsonPrimitive(format(src));
+		}
+	}
+
+	public static String format(Date date) {
+		return isoFormatter.format(date);
+	}
+
+	public static Date parse(String date) {
+		try {
+			return isoFormatter.parse(date);
+		} catch (ParseException e) {
+			return null;
+		}
+	}
+
+	protected void jsonSuccess(final Object resp) {
+		String s = gson.toJson(resp);
+		result.use(Results.http()).addHeader("Content-Type", "application/json").body(s).setStatusCode(200);
+	}
+
+	protected void jsonError(final Exception e) throws Exception {
+		String errstack = RequestExceptionLogger.simplificarStackTrace(e);
+
+		JSONObject json = new JSONObject();
+		try {
+			json.put("errormsg", e.getMessage());
+
+			// Error Details
+			JSONArray arr = new JSONArray();
+			JSONObject detail = new JSONObject();
+			detail.put("context", context.getContextPath());
+			detail.put("service", "sigadocsigner");
+			detail.put("stacktrace", errstack);
+			arr.put(detail);
+			json.put("errordetails", arr);
+		} catch (JSONException e1) {
+			throw new RuntimeException(e1);
+		}
+
+		String s = json.toString(4);
+		result.use(Results.http()).addHeader("Content-Type", "application/json").body(s).setStatusCode(500);
+		response.flushBuffer();
+		throw e;
+	}
+
+	@Inject
+	public void setResponse(HttpServletResponse response) {
+		this.response = response;
+	}
+
+	public HttpServletResponse getResponse() {
+		return this.response;
+	}
+
+	@Inject
+	public void setContext(ServletContext context) {
+		this.context = context;
+	}
+
 }
diff --git a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaSelecionavelControllerSupport.java b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaSelecionavelControllerSupport.java
index c813c0e11a..32768c99b6 100644
--- a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaSelecionavelControllerSupport.java
+++ b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaSelecionavelControllerSupport.java
@@ -24,6 +24,7 @@
  */
 package br.gov.jfrj.siga.vraptor;
 
+import java.util.ArrayList;
 import java.util.List;
 
 import javax.persistence.EntityManager;
@@ -34,6 +35,8 @@ import br.gov.jfrj.siga.base.AplicacaoException;
 import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.model.Selecionavel;
 import br.gov.jfrj.siga.model.dao.DaoFiltroSelecionavel;
+import br.gov.jfrj.siga.vraptor.SigaSelecionavelControllerSupport.RetornoJson;
+import br.gov.jfrj.siga.vraptor.SigaSelecionavelControllerSupport.RetornoJsonItem;
 
 public abstract class SigaSelecionavelControllerSupport<T extends Selecionavel, DaoFiltroT extends DaoFiltroSelecionavel>
 		extends SigaController {
@@ -65,6 +68,29 @@ public abstract class SigaSelecionavelControllerSupport<T extends Selecionavel,
 	private String sigla;
 
 	private Integer tamanho;
+	
+	protected void aBuscarJson(String sigla) throws Exception{
+		Long orgaoUsu = getLotaTitular().getOrgaoUsuario().getIdOrgaoUsu();
+	
+	if (sigla == null)
+		sigla = "";
+	
+	aBuscar(sigla, "");
+	
+	try {
+		RetornoJson l = new RetornoJson();
+		for (Selecionavel s : (List<Selecionavel>) getItens()) {
+			RetornoJsonItem i = new RetornoJsonItem();
+			i.key = Long.toString(s.getId());
+			i.firstLine = s.getSigla();
+			i.secondLine = s.getDescricao();
+			l.list.add(i);
+		}
+		jsonSuccess(l);
+	} catch (Exception e) {
+		jsonError(e);
+	}
+}
 
 	protected String aBuscar(String sigla, String postback) throws Exception {
 		if (sigla != null) 
@@ -206,5 +232,15 @@ public abstract class SigaSelecionavelControllerSupport<T extends Selecionavel,
 	protected void setTamanho(final Integer tamanho) {
 		this.tamanho = tamanho;
 	}
+	
+	protected static class RetornoJson {
+		List<RetornoJsonItem> list = new ArrayList<>();
+	}
+
+	protected static class RetornoJsonItem {
+		String key;
+		String firstLine;
+		String secondLine;
+	}
 
 }
diff --git a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaTransacionalInterceptor.java b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaTransacionalInterceptor.java
index 7c30e997ba..2d6cdfaad3 100644
--- a/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaTransacionalInterceptor.java
+++ b/siga-vraptor-module/src/main/java/br/gov/jfrj/siga/vraptor/SigaTransacionalInterceptor.java
@@ -40,7 +40,6 @@ public class SigaTransacionalInterceptor extends br.com.caelum.vraptor.jpa.JPATr
 	private final MutableResponse response;
 	private HttpServletRequest request;
 	private ControllerMethod method;
-	EntityTransaction transaction = null;
 
 	private final static ThreadLocal<SigaTransacionalInterceptor> current = new ThreadLocal<SigaTransacionalInterceptor>();
 
@@ -73,22 +72,23 @@ public class SigaTransacionalInterceptor extends br.com.caelum.vraptor.jpa.JPATr
 		addRedirectListener();
 
 		try {
-			if (this.method.containsAnnotation(Transacional.class)
-					&& !(this.request.getRequestURI().startsWith("app/sigawf"))) {
-				transaction = manager.getTransaction();
+			if (this.method.containsAnnotation(Transacional.class)) {
+				EntityTransaction transaction = manager.getTransaction();
 				transaction.begin();
 			} else {
 				disableAutoFlush();
 			}
-			
-			System.out.println("*** " + this.method.toString() + " - " + (transaction == null ? "NÃO" : "") + " Transacional");
+
+//			 System.out.println("*** " + (manager.getTransaction() ==
+//					 null || !manager.getTransaction().isActive() ? "NÃO" : "") + " TRANSACIONAL" + this.method.toString() + " - ");
 
 			stack.next();
 
-			commit(transaction);
+			commit(manager.getTransaction());
 
 		} finally {
 			ContextoPersistencia.setDt(null);
+			EntityTransaction transaction = manager.getTransaction();
 			if (transaction != null && transaction.isActive()) {
 				transaction.rollback();
 				beanManager.fireEvent(new AfterRollback());
@@ -124,34 +124,36 @@ public class SigaTransacionalInterceptor extends br.com.caelum.vraptor.jpa.JPATr
 
 	public static void upgradeParaTransacional() {
 		SigaTransacionalInterceptor thiz = current.get();
-		if (thiz != null && thiz.transaction == null) {
-			System.out.println("*** UPGRADE para Transacional - " + thiz.method.toString());
+		EntityTransaction transaction = thiz.manager.getTransaction();
+		if (!transaction.isActive()) {
+			// System.out.println("*** UPGRADE para Transacional - " + thiz.method.toString());
 			enableAutoFlush();
-			thiz.transaction = thiz.manager.getTransaction();
-			thiz.transaction.begin();
+			transaction.begin();
 		}
 	}
 
 	public static void downgradeParaNaoTransacional() {
 		SigaTransacionalInterceptor thiz = current.get();
-		if (thiz != null && thiz.transaction != null) {
-			thiz.commit(thiz.transaction);
-			System.out.println("*** DOWNGRADE para NÃO Transacional - " + thiz.method.toString());
+		EntityTransaction transaction = thiz.manager.getTransaction();
+		if (thiz != null && transaction != null) {
+			thiz.commit(transaction);
+			// System.out.println("*** DOWNGRADE para NÃO Transacional - " +
+			// thiz.method.toString());
 			disableAutoFlush();
-			thiz.transaction = thiz.manager.getTransaction();
-			thiz.transaction.begin();
+			transaction = thiz.manager.getTransaction();
+			transaction.begin();
 		}
 	}
 
 	public static void disableAutoFlush() {
-		SigaTransacionalInterceptor thiz = current.get();
-		Session session = CDIProxies.unproxifyIfPossible(thiz.manager).unwrap(org.hibernate.Session.class);
-		session.setFlushMode(FlushMode.MANUAL);
+//		SigaTransacionalInterceptor thiz = current.get();
+//		Session session = CDIProxies.unproxifyIfPossible(thiz.manager).unwrap(org.hibernate.Session.class);
+//		session.setFlushMode(FlushMode.MANUAL);
 	}
 
 	public static void enableAutoFlush() {
-		SigaTransacionalInterceptor thiz = current.get();
-		Session session = CDIProxies.unproxifyIfPossible(thiz.manager).unwrap(org.hibernate.Session.class);
-		session.setFlushMode(FlushMode.AUTO);
+//		SigaTransacionalInterceptor thiz = current.get();
+//		Session session = CDIProxies.unproxifyIfPossible(thiz.manager).unwrap(org.hibernate.Session.class);
+//		session.setFlushMode(FlushMode.AUTO);
 	}
 }
diff --git a/siga-vraptor-module/src/main/resources/META-INF/libs.tld b/siga-vraptor-module/src/main/resources/META-INF/libs.tld
index ddea93b269..0092b4d674 100644
--- a/siga-vraptor-module/src/main/resources/META-INF/libs.tld
+++ b/siga-vraptor-module/src/main/resources/META-INF/libs.tld
@@ -61,6 +61,11 @@
   <function-class>br.gov.jfrj.siga.jee.SigaLibsEL</function-class>
   <function-signature>java.lang.String maiusculasEMinusculas(java.lang.String)</function-signature>
  </function>
+ <function>
+  <name>slugify</name>
+  <function-class>br.gov.jfrj.siga.jee.SigaLibsEL</function-class>
+  <function-signature>java.lang.String slugify(java.lang.String,java.lang.Boolean,java.lang.Boolean)</function-signature>
+ </function>
  <function>
   <name>resource</name>
   <function-class>br.gov.jfrj.siga.jee.SigaLibsEL</function-class>
diff --git a/siga-vraptor-module/src/main/resources/META-INF/tags/cabecalho.tag b/siga-vraptor-module/src/main/resources/META-INF/tags/cabecalho.tag
index f9a592916e..dbc3606025 100644
--- a/siga-vraptor-module/src/main/resources/META-INF/tags/cabecalho.tag
+++ b/siga-vraptor-module/src/main/resources/META-INF/tags/cabecalho.tag
@@ -128,6 +128,11 @@ ${meta}
 		</c:if>
 		
 		<c:set var="navbar_logo" value="logo-siga-novo-38px.png" />
+		<c:set var="navbar_logo2" value="${f:resource('siga.cabecalho.logo')}" />
+		<c:if test="${empty navbar_logo2}">
+			<c:set var="navbar_logo2" value="/siga/imagens/logo-trf2-38px.png" />
+		</c:if>
+		
 		<c:set var="navbar_logo_size" value="38" />
 		<c:set var="button_class_busca" value="btn-outline-light" />
 		<c:set var="collapse_Tramitacao" scope="request" value="collapsible expanded" />
@@ -161,8 +166,8 @@ ${meta}
 			
 			<c:if test="${siga_cliente != 'GOVSP'}">
 				<img id="logo-header2"
-					 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAmCAYAAAA1MOAmAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4QUPFCQBHI8nPQAAA2pJREFUWMO9l0uIllUYx3/P+DkalpO3RU1hoQ7jpUDSTS1Gogi6EAm1icxFi4aKFkHShSgolAgqyhYhtGhX1sKwoqhFg1BYQS1EjJpoSiq7OEmTM47+WvS8cnqZyzvTNz3wcs57zvme/3n/z/WDWYi6RO3l/xD1UnVopr/rmCXeGWDZnIKpZ6ezuWHHTIAiAnUrcF4FWFygbTaqxuv9R9aoJ9SuuQK6Ux0pwH5Wn27716l3+W9Zo36n/qVubgrY1GY3197HgdPAQmC/uh1YpXapi/PpUqP8Uash2Kna+xDwFXAJsAJ4BTgGjNTOfabeCpyJiMY0vlGjsaWuV0edXl5UO2dis/drChbm+lXqFw0AP1CXRQOgxcBBoKdai+SkiL2NwOa05WRyqDWVu6fOrcDqYnt/DWgNsBHozkDvzHG0br/pvmqbOlbQcUK9oLZ/vEbZM+omdUPxrFcXoS5K7rfk05cBfLBQcEodUvsKoC01kGPq5RPk0bMSajdwExC1rD5W2OAX4JOI+C0VzQM+Aq4sYzEi9lX0TiSt5Pt24OQkbP4KHADeK258IXBxcWYwIvYVdp7ULi11dwP3Hc2Mj7oyaa1kd6MSExHjEXEP8NA0ZzuBveraTFWljDUBaxVuvEvtAPprxbETWJJjAHuAG9tSSiZYP0e9Tj1U0HZRZv1KXmpbLcv5UvXbWokx43Ddf24LSs9Kt3++2J6XntoXEYfmoj3YnF/Tm7T2zGW/2JtgK9QFM20JWjPEq3gdjoixqbJFO5vUmDZbtAFsOJ+Ohh7cLL6mULaqqtQz7oizAPaq36iDxfhj1qsHM6a+Vr8EromIkxnY3+fZQfVAxuIj6h/pSG+pS+u3Xa7ep+5Ux9W38/0y9eUskNvU11PJberanO/Ns9vVc9Uj6gPqh7l/72Qcb1D/VB8t1vaogzm/Wj2t7lB7Ull/7eLzc7wl9+8/6/oNPEpgufoccANwGHgVOD/371A3AT8AT0VE1Xv0Zx8yUIVIU28czwZ0NfBxRBwtPHIk09Zw8c9mB3At8HBEfD6Zp01H4wtJzUp1Xc7vrumo6Hu8aCEmjLOO7N/n1+pZ5eqv5fhEsb+gAOoG3szieoX6LrBzsnR1FNgFvFOs7QU+zYwxoD4GHAd+Ap4FBoqzvwNPZsNUXf5Itfk35wXnXBwGnuIAAAAASUVORK5CYII="
-				 	 alt="Logo TRF2" height="38" class="ml-2" />
+					 src="${navbar_logo2}"
+				 	 alt="${f:resource('siga.cabecalho.titulo')}" height="${navbar_logo_size}" class="ml-2" />
 			</c:if>
 			
 			<button class="navbar-toggler" type="button" data-toggle="collapse"
diff --git a/siga-vraptor-module/src/main/resources/META-INF/tags/link.tag b/siga-vraptor-module/src/main/resources/META-INF/tags/link.tag
index f1f7261500..28a4bcde11 100644
--- a/siga-vraptor-module/src/main/resources/META-INF/tags/link.tag
+++ b/siga-vraptor-module/src/main/resources/META-INF/tags/link.tag
@@ -15,10 +15,14 @@
 <%@ attribute name="classe"%>
 <%@ attribute name="estilo"%>
 <%@ attribute name="atalho"%>
+<%@ attribute name="modal"%>
+<%@ attribute name="explicacao"%>
+<%@ attribute name="post"%>
 
 <c:if test="${(atalho == true) and fn:contains(title, '_')}">
 	<c:set var="ious" value="${fn:indexOf(title, '_')}" />
-	<c:set var="accesskey" value="${fn:toLowerCase(fn:substring(title, ious+1, ious+2))}" />
+	<c:set var="accesskey"
+		value="${fn:toLowerCase(fn:substring(title, ious+1, ious+2))}" />
 	<c:set var="title">${fn:substring(title, 0, ious)}<u>${fn:substring(title, ious+1, ious+2)}</u>${fn:substring(title, ious+2, -1)}</c:set>
 </c:if>
 
@@ -34,8 +38,8 @@
 <c:set var="img" value="" />
 <c:if test="${not empty icon}">
 	<c:set var="img">
-		<img src="/siga/css/famfamfam/icons/${icon}.png"
-			class="mr-1 mb-1" title="${titleImg}">
+		<img src="/siga/css/famfamfam/icons/${icon}.png" class="mr-1 mb-1"
+			title="${titleImg}">
 	</c:set>
 </c:if>
 
@@ -56,23 +60,42 @@
 	${pre}
 	<c:if test="${not empty url}">
 		<c:choose>
+			<c:when test="${not empty modal}">
+				<a
+					class="${classe} ${linkBotoes ? 'btn btn-sm btn-info text-white link-tag' : ''}"
+					<c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
+					data-toggle="modal" data-target="#${modal}" title="${explicacao}">${img}${title}</a>
+			</c:when>
 			<c:when test="${not empty popup and popup != false}">
-				<a class="${classe} ${linkBotoes ? 'btn btn-sm btn-info link-tag' : ''}" <c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
-					href="javascript:${linkConfirm}popitup('${url}');">${img}${title}</a>
+				<a
+					class="${classe} ${linkBotoes ? 'btn btn-sm btn-info text-white link-tag' : ''}"
+					<c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
+					href="javascript:${linkConfirm}popitup('${url}');"
+					title="${explicacao}">${img}${title}</a>
 			</c:when>
 			<c:when test="${not empty ajax and ajax != false}">
-				<span id="spanAjax_${idAjax}"> <a class="${classe} ${linkBotoes ? 'btn btn-sm btn-info link-tag' : ''} link-tag" <c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
-					href="javascript: SetInnerHTMLFromAjaxResponse('${url}', 'spanAjax_${idAjax}');">${img}${title}</a>
+				<span id="spanAjax_${idAjax}"> <a
+					class="${classe} ${linkBotoes ? 'btn btn-sm btn-info text-white link-tag' : ''} link-tag"
+					<c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
+					href="javascript: SetInnerHTMLFromAjaxResponse('${url}', 'spanAjax_${idAjax}');"
+					title="${explicacao}">${img}${title}</a>
 				</span>
 			</c:when>
 			<c:otherwise>
 				<c:choose>
 					<c:when test="${not empty linkConfirm}">
-						<a class="${classe} ${linkBotoes ? 'btn btn-sm btn-info link-tag' : ''} link-tag" <c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
-							href="javascript:${linkConfirm}location.href='${url}';">${img}${title}</a>
+						<a
+							class="${classe} ${linkBotoes ? 'btn btn-sm btn-info text-white link-tag' : ''} link-tag"
+							<c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
+							href="javascript:${linkConfirm}${post ? 'postToUrl(\''.concat(url).concat('\')') : 'location.href=\''.concat(url).concat('\';')}"
+							title="${explicacao}">${img}${title}</a>
 					</c:when>
 					<c:otherwise>
-						<a class="${classe} ${linkBotoes ? 'btn btn-sm btn-info link-tag' : ''} link-tag" <c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if> href="${url}">${img}${title}</a>
+						<a
+							class="${classe} ${linkBotoes ? 'btn btn-sm btn-info text-white link-tag' : ''} link-tag"
+							<c:if test="${not empty accesskey}">accesskey="${accesskey}"</c:if>
+							href="${post ? 'javascript:postToUrl(\''.concat(url).concat('\')') : url}"
+							title="${explicacao}">${img}${title}</a>
 					</c:otherwise>
 				</c:choose>
 			</c:otherwise>
diff --git a/siga-vraptor-module/src/main/resources/META-INF/tags/menuprincipal.tag b/siga-vraptor-module/src/main/resources/META-INF/tags/menuprincipal.tag
index 6aacc7b5d3..c2902f2dc6 100644
--- a/siga-vraptor-module/src/main/resources/META-INF/tags/menuprincipal.tag
+++ b/siga-vraptor-module/src/main/resources/META-INF/tags/menuprincipal.tag
@@ -54,7 +54,7 @@
 
 				<c:if
 					test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF:Módulo de Workflow')}">
-					<li><a class="dropdown-item" href="/sigawf/app/resumo">Workflow</a></li>
!!!!!!
+					<li><a class="dropdown-item" href="/sigawf/app/ativos">Workflow</a></li>
 				</c:if>
 
 				<c:if
diff --git a/siga-vraptor-module/src/main/resources/META-INF/tags/pessoaLotaSelecao2.tag b/siga-vraptor-module/src/main/resources/META-INF/tags/pessoaLotaSelecao2.tag
index 572428c0ab..96f0482d3c 100644
--- a/siga-vraptor-module/src/main/resources/META-INF/tags/pessoaLotaSelecao2.tag
+++ b/siga-vraptor-module/src/main/resources/META-INF/tags/pessoaLotaSelecao2.tag
@@ -2,6 +2,7 @@
 <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
 <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
 <%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+<%@ taglib uri="http://localhost/libstag" prefix="libs"%>
 
 <%@ attribute name="propriedadePessoa" required="true"%>
 <%@ attribute name="propriedadeLotacao" required="true"%>
@@ -9,11 +10,11 @@
 <%@ attribute name="disabled" required="false"%>
 
 <c:set var="propriedadePessoaClean"
-	value="${fn:replace(propriedadePessoa,'.','')}" />
+	value="${libs:slugify(propriedadePessoa, false, true)}" />
 <c:set var="propriedadeLotacaoClean"
-	value="${fn:replace(propriedadeLotacao,'.','')}" />
+	value="${libs:slugify(propriedadeLotacao, false, true)}" />
 <c:set var="propriedadeEmailClean"
-	value="${fn:replace(propriedadeEmail,'.','')}" />
+	value="${libs:slugify(propriedadeEmail, false, true)}" />
 
 <c:set var="desativar" value="nao"></c:set>
 <c:if test="${disabled == 'sim'}">
diff --git a/siga-vraptor-module/src/main/resources/META-INF/tags/selecao2.tag b/siga-vraptor-module/src/main/resources/META-INF/tags/selecao2.tag
index 2f99be4656..1ef2347abb 100644
--- a/siga-vraptor-module/src/main/resources/META-INF/tags/selecao2.tag
+++ b/siga-vraptor-module/src/main/resources/META-INF/tags/selecao2.tag
@@ -18,7 +18,7 @@
 <%@ attribute name="tamanho" required="false"%>
 <%@ attribute name="checarInput" required="false"%>
 
-<c:set var="propriedadeClean" value="${fn:replace(propriedade,'.','')}" />
+<c:set var="propriedadeClean" value="${f:slugify(propriedade, false, true)}" />
 
 <c:forEach var="parametro" items="${fn:split(paramList,';')}">
 	<c:set var="p2" value="${fn:split(parametro,'=')}" />
diff --git a/siga-wf/pom.xml b/siga-wf/pom.xml
index 1094143990..d427c6fb5f 100644
--- a/siga-wf/pom.xml
+++ b/siga-wf/pom.xml
@@ -1,69 +1,63 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
-    <parent>
-        <artifactId>siga-doc</artifactId>
-        <groupId>siga</groupId>
-        <version>1.2-SNAPSHOT</version>
-    </parent>
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
+	<parent>
+		<artifactId>siga-doc</artifactId>
+		<groupId>siga</groupId>
+		<version>1.2-SNAPSHOT</version>
+	</parent>
 
-    <modelVersion>4.0.0</modelVersion>
+	<modelVersion>4.0.0</modelVersion>
 
-    <artifactId>siga-wf</artifactId>
+	<artifactId>siga-wf</artifactId>
 
-    <dependencies>
-        <dependency>
-            <groupId>info.bliki.wiki</groupId>
-            <artifactId>bliki-core</artifactId>
-        </dependency>
-
-        <dependency>
-            <groupId>org.apache.lucene</groupId>
-            <artifactId>lucene-analyzers</artifactId>
-        </dependency>
+	<dependencies>
+		<dependency>
+			<groupId>siga</groupId>
+			<artifactId>siga-cp</artifactId>
+		</dependency>
 
-        <!-- JBPM -->
-        <dependency>
-            <groupId>org.jbpm.jbpm3</groupId>
-            <artifactId>jbpm-identity</artifactId>
-        </dependency>
-        <dependency>
-            <groupId>org.jbpm.jbpm3</groupId>
-            <artifactId>jbpm-jpdl</artifactId>
-        </dependency>
-        
-       	<dependency>
-			<groupId>javax.jcr</groupId>
-			<artifactId>jcr</artifactId>
-			<version>1.0.1</version>
+		<dependency>
+			<groupId>com.crivano</groupId>
+			<artifactId>jflow</artifactId>
+			<version>1.0.2</version>
 		</dependency>
 
-        <dependency>
-            <groupId>org.jboss.spec.javax.servlet</groupId>
-            <artifactId>jboss-servlet-api_2.5_spec</artifactId>
-            <scope>provided</scope>
-        </dependency>
+		<dependency>
+			<groupId>com.crivano</groupId>
+			<artifactId>jlogic</artifactId>
+			<version>1.0.0</version>
+		</dependency>
+		
+				
+		<!-- https://mvnrepository.com/artifact/info.bliki.wiki/bliki-core
+		<dependency>
+			<groupId>info.bliki.wiki</groupId>
+			<artifactId>bliki-core</artifactId>
+			<version>3.1.0</version>
+		</dependency>
+		 -->
 
-        <dependency>
-            <groupId>net.sf.kxml</groupId>
-            <artifactId>kxml2</artifactId>
-        </dependency>
+		<dependency>
+			<groupId>javax.enterprise</groupId>
+			<artifactId>cdi-api</artifactId>
+			<version>1.1</version>
+			<scope>provided</scope>
+		</dependency>
 
-        <dependency>
-            <groupId>backport-util-concurrent</groupId>
-            <artifactId>backport-util-concurrent</artifactId>
-        </dependency>
+		<!-- CDI -->
+		<dependency>
+			<groupId>org.jboss.spec.javax.ejb</groupId>
+			<artifactId>jboss-ejb-api_3.1_spec</artifactId>
+			<scope>provided</scope>
+		</dependency>
+	</dependencies>
 
-        <dependency>
-            <groupId>siga</groupId>
-            <artifactId>siga-cp</artifactId>
-        </dependency>
-    </dependencies>
-    
 	<profiles>
 		<profile>
 			<id>flyway</id>
-			
+
 			<properties>
 				<maven.test.skip>true</maven.test.skip>
 				<maven.main.skip>true</maven.main.skip>
@@ -85,7 +79,7 @@
 							<sqlMigrationPrefix>SIGAWF_UTF8_V</sqlMigrationPrefix>
 							<placeholderPrefix>flyway${</placeholderPrefix>
 							<locations>
-								<location>filesystem:src\main\resources</location>
+								<location>filesystem:src\main\resources\db\migration</location>
 							</locations>
 						</configuration>
 						<executions>
@@ -108,5 +102,5 @@
 				</plugins>
 			</build>
 		</profile>
-	</profiles>    
+	</profiles>
 </project>
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/Designacao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/Designacao.java
deleted file mode 100644
index f03af4edc9..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/Designacao.java
+++ /dev/null
@@ -1,267 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf;
-
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-
-/**
- * Esta classe representa uma designação de responsabilidade e é utilizada na view pesquisarDesignação.jsp <br/> 
- * 
- * Designação de Tarefas (Cadastro de Responsabilidades)
-
-1.CRIAÇÃO
-2.OBJETIVO
-3.UTILIZAÇÃO
-4.COMPONENTES
-5.BANCO DE DADOS
-6.FUNCIONAMENTO BÁSICO
-7.OBSERVAÇÕES
-
-1.CRIAÇÃO
-	Funcionalidade iniciada na iteração 05/10/2009 a 16/10/2009 do SIGAWF.
-	
-2.OBJETIVO
-	Configurar quem são os responsáveis por cada tarefa do processo. 
-
-3.UTILIZAÇÃO
-	Acesse a opção "Designar Tarefas" e o processo desejado no quadro de tarefas 
-	localizado na página inicial do SIGA-DOC. 
-
-4.COMPONENTES
-	4.1 pesquisarDesignacao.jsp (/sigawf/WebContent/WEB-INF/page/workflow/)
-		Interface do usuário de configuração e pesquisa de desgnações
-		
-	4.2 WfDesignacaoAction.java (/sigawf/src/br/gov/jfrj/siga/wf/webwork/action/)
-		Executa a lógica da funcionalidade de designação de resposabilidades. 
-		Possui uma classe interna que define o tipo de responsável.
-		
-	4.3 Designacao.java (/siga-wf/src/br/gov/jfrj/siga/wf/)
-		Representa uma designação de responsabilidade
-		
-	4.4 xwork.xml (/sigawf/src/)
-		Configuração do webwork que realiza a conexão entre a interface do usuário e 
-		lógica da designação de tarefas.
-		
-	4.5 inbox.jsp (/sigawf/WebContent/WEB-INF/page/workflow/)
-		Interface de acesso à funcionalidade
-
-5.BANCO DE DADOS
-	
-	5.1 CORPORATIVO.CP_CONFIGURACAO
-		Registra as informações comuns entre configurações. 
-		Determina se uma configuração está ativa ou não dentre outras informações.
-
-	5.2 SIGAWF.WF_CONFIGURACAO
-		Registra a configuração da designação da tarefa
-
-6.FUNCIONAMENTO BÁSICO
-       
-	6.1 PESQUISA
-       Quando o usuário acessa a página inicial, seleciona a opção "Designar Tarefas" 
-       e o processo desejado, o inbox.jsp chama a action pesquisarDesignação configurada 
-       no xwork.xml. Nesse momento o método WfDesignacaoAction.aPesquisarDesignacao() é 
-       chamado e retorna a página pesquisarDesignacao.jsp. A página pesquisarDesignacao.jsp 
-       lê as listas de designação (com raias e sem raias) e a página é desenhada na tela do 
-       usuário. 
-       
-	6.2 GRAVACAO
-       O usuário define as responsabilidades através dos componentes de seleção (seleção.tag) 
-       e clica no botão gravar que ativa a action gravarDesignacao que, por sua vez, chama o 
-       método WfDesignacaoAction.aGravarDesignacao(). Este método grava as designações e retorna 
-       a página pesquisarDesignacao.jsp com as informações gravadas.
-
-7.OBSERVAÇÕES       
-       Maiores detalhes são encontrados no próprio código dos componentes responsáveis 
-       pela funcionalidade de desiganção de tarefas.  
- * 
- * @author kpf
- * 
- */
-public class Designacao {
-	private String procedimento;
-	private String raia;
-	private Long Id;
-	private String tarefa;
-	private String nomeDoNo;
-	private String expressao;
-	private DpPessoa ator;
-	private DpLotacao lotaAtor;
-	private Integer tipoResponsavel;
-
-	/**
-	 * Retorna o tipo de responsável desigando para a tarefa.
-	 * 
-	 * @return retorna 0 para INDEFINIDO (Sem designação), retorna 1 para
-	 *         MATRICULA (Usuário de uma pessoa [DpPessoa]), retorna 2 para
-	 *         LOTACAO (Sigla de uma lotação) retorna 3 para LOTA_SUP (Lotação
-	 *         hierarquicamente superior da pessoa designada na tarefa anterior)
-	 *         retorna 4 para SUP_HIER (Superior hierárquico da pessoa designada
-	 *         na tarefa anterior)
-	 */
-	public Integer getTipoResponsavel() {
-		return tipoResponsavel;
-	}
-
-	/**
-	 * Informa o tipo de responsável desigando para a tarefa.
-	 * 
-	 * @return retorna 0 para INDEFINIDO (Sem designação), retorna 1 para
-	 *         MATRICULA (Usuário de uma pessoa [DpPessoa]), retorna 2 para
-	 *         LOTACAO (Sigla de uma lotação) retorna 3 para LOTA_SUP (Lotação
-	 *         hierarquicamente superior da pessoa designada na tarefa anterior)
-	 *         retorna 4 para SUP_HIER (Superior hierárquico da pessoa designada
-	 *         na tarefa anterior)
-	 */
-	public void setTipoResponsavel(Integer tipoResponsavel) {
-		this.tipoResponsavel = tipoResponsavel;
-	}
-
-	/**
-	 * Retorna o procedimento referente à designação.
-	 * 
-	 * @return
-	 */
-	public String getProcedimento() {
-		return procedimento;
-	}
-
-	/**
-	 * Informa o procedimento referente à designação.
-	 * 
-	 * @param procedimento
-	 */
-	public void setProcedimento(String procedimento) {
-		this.procedimento = procedimento;
-	}
-
-	/**
-	 * Retorna a raia referente à designação.
-	 * 
-	 * @return
-	 */
-	public String getRaia() {
-		return raia;
-	}
-
-	/**
-	 * Informa a raia referente à designação.
-	 * 
-	 * @param raia
-	 */
-	public void setRaia(String raia) {
-		this.raia = raia;
-	}
-
-	/**
-	 * Retorna a tarefa referente à designação.
-	 * 
-	 * @return
-	 */
-	public String getTarefa() {
-		return tarefa;
-	}
-
-	/**
-	 * Informa a tarefa referente à designação.
-	 * 
-	 * @param tarefa
-	 */
-	public void setTarefa(String tarefa) {
-		this.tarefa = tarefa;
-	}
-
-	/**
-	 * Retorna a expressão de uma designação. As expressões existentes são :
-	 * "previous --> group() --> superior_group" para Lotação superior e
-	 * "previous --> chief" para superior hierárquico.
-	 * 
-	 * @return
-	 */
-	public String getExpressao() {
-		return expressao;
-	}
-
-	/**
-	 * Informa a expressão de uma designação. As expressões existentes são :
-	 * "previous --> group() --> superior_group" para Lotação superior e
-	 * "previous --> chief" para superior hierárquico.
-	 * @param expressao
-	 */
-	public void setExpressao(String expressao) {
-		this.expressao = expressao;
-	}
-
-	/**
-	 * Retorna o ator referente à designação.
-	 * @return
-	 */
-	public DpPessoa getAtor() {
-		return ator;
-	}
-
-	/**
-	 * Informa o ator referente à designação. 
-	 * @param ator
-	 */
-	public void setAtor(DpPessoa ator) {
-		this.ator = ator;
-	}
-
-	/**
-	 * Retorna a lotação referente à designação.
-	 * @return
-	 */
-	public DpLotacao getLotaAtor() {
-		return lotaAtor;
-	}
-
-	/**
-	 * Informa a lotação referente à designação.
-	 * @param lotaAtor
-	 */
-	public void setLotaAtor(DpLotacao lotaAtor) {
-		this.lotaAtor = lotaAtor;
-	}
-
-	/**
-	 * Retorna o ID da designação.
-	 * @return
-	 */
-	public Long getId() {
-		return Id;
-	}
-
-	/**
-	 * Informa o ID da designação.
-	 * @param id
-	 */
-	public void setId(Long id) {
-		Id = id;
-	}
-
-	public void setNomeDoNo(String nomeDoNo) {
-		this.nomeDoNo = nomeDoNo;
-	}
-
-	public String getNomeDoNo() {
-		return nomeDoNo;
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/Permissao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/Permissao.java
deleted file mode 100644
index 3b274c0be6..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/Permissao.java
+++ /dev/null
@@ -1,122 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf;
-
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-
-/**
- * Esta classe representa uma permissão para instaciação de procedimentos e é utilizada na view configurarInstanciacao.jsp 
- * 
- * @author kpf
- * 
- */
-public class Permissao {
-    private String procedimento;
-    private Long id;
-    private DpPessoa pessoa;
-    private DpLotacao lotacao;
-    private Integer tipoResponsavel;
-    
-    /**
-     * Retorna o tipo de responsável que pode instanciar um procedimento.
-     * @return 0 - INDEFINIDO (sem definição de permissão)
-     * 1 - MATRICULA (permissão para uma pessoa)
-     * 2 - LOTACAO (permissão para uma lotação inteira, ou seja, todos da lotação)
-     */
-	public Integer getTipoResponsavel() {
-		return tipoResponsavel;
-	}
-	
-    /**
-     * Informa o tipo de responsável que pode instanciar um procedimento.
-     * @return 0 - INDEFINIDO (sem definição de permissão)
-     * 1 - MATRICULA (permissão para uma pessoa)
-     * 2 - LOTACAO (permissão para uma lotação inteira, ou seja, todos da lotação)
-     */
-	public void setTipoResponsavel(Integer tipoResponsavel) {
-		this.tipoResponsavel = tipoResponsavel;
-	}
-	
-	/**
-	 * Retorna o procedimento referente à permissão.
-	 * 
-	 * @return
-	 */
-	public String getProcedimento() {
-		return procedimento;
-	}
-	
-	/**
-	 * Informa o procedimento referente à permissão.
-	 *  
-	 */
-	public void setProcedimento(String procedimento) {
-		this.procedimento = procedimento;
-	}
-	
-	/**
-	 * Retorna a pessoa referente à permissão.
-	 * @return
-	 */
-	public DpPessoa getPessoa() {
-		return pessoa;
-	}
-	
-	/**
-	 * Informa  a pessoa referente à permissão.
-	 * @param pessoa
-	 */
-	public void setPessoa(DpPessoa pessoa) {
-		this.pessoa = pessoa;
-	}
-	
-	/**
-	 *  Retorna a lotação referente à permissão.
-	 * @return
-	 */
-	public DpLotacao getLotacao() {
-		return lotacao;
-	}
-	
-	/**
-	 * Informa a lotação referente à permissão.
-	 * @param lotacao
-	 */
-	public void setLotacao(DpLotacao lotacao) {
-		this.lotacao = lotacao;
-	}
-
-	/**
-	 * Retorna o id da permissão.
-	 * @return
-	 */
-	public Long getId() {
-		return this.id;
-	}
-	
-	/**
-	 * Informa o id da permissão.
-	 * @param id
-	 */
-	public void setId(Long id) {
-		this.id = id;
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/SigaWfProperties.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/SigaWfProperties.java
deleted file mode 100644
index 3b2e10f469..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/SigaWfProperties.java
+++ /dev/null
@@ -1,63 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-/*
- * Criado em  16/06/2011
- *
- *  To change the template for this generated file go to
- * Window - Preferences - Java - Code Style - Code Templates
- */
-package br.gov.jfrj.siga.wf;
-
-import br.gov.jfrj.siga.model.prop.ModeloPropriedade;
-
-public class SigaWfProperties extends ModeloPropriedade {
-
-	private static SigaWfProperties instance = new SigaWfProperties();
-
-	protected SigaWfProperties() {
-		// construtor privado
-	}
-	
-	@Override
-	public String getPrefixoModulo() {
-		return "siga.wf";
-	}
-	
-	public static String getString(final String key) {
-		try {
-			return instance.obterPropriedade(key);
-		} catch (Exception e) {
-			e.printStackTrace();
-			return "";
-		}
-	}
-
-	public static Double getRelEstatGeraisMinMediaTrunc() {
-		return Double.valueOf(getString("rel.estatisticas.gerais.media.truncada.min").replace(",", "."));
-	}
-
-	public static Double getRelEstatGeraisMaxMediaTrunc() {
-		return Double.valueOf(getString("rel.estatisticas.gerais.media.truncada.max").replace(",", "."));
-	}
-	
-	
-	
-	
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/Wf.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/Wf.java
index 72b6310524..1070ba9723 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/Wf.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/Wf.java
@@ -26,13 +26,12 @@ import br.gov.jfrj.siga.cp.bl.Cp;
  * @author kpf
  * 
  */
-public class Wf extends
-		Cp<WfConfiguracaoBL, WfCompetenciaBL, WfBL, WfPropriedadeBL> {
+public class Wf extends Cp<WfConfiguracaoBL, WfCompetenciaBL, WfBL, WfPropriedadeBL> {
 
 	/**
 	 * Retorna uma instância do sistema de workflow. Através dessa instância é
-	 * possível acessar a lógica de negócio, competências e configurações do
-	 * sistema de workflow.
+	 * possível acessar a lógica de negócio, competências e configurações do sistema
+	 * de workflow.
 	 * 
 	 * @return Instância de workflow
 	 */
@@ -43,8 +42,7 @@ public class Wf extends
 					Wf instance = new Wf();
 					setInstance(instance);
 					instance.setConf(new WfConfiguracaoBL());
-					instance.getConf().setComparator(
-							new WfConfiguracaoComparator());
+					instance.getConf().setComparator(new WfConfiguracaoComparator());
 					instance.setComp(new WfCompetenciaBL());
 					instance.getComp().setConfiguracaoBL(instance.getConf());
 					instance.setBL(new WfBL());
@@ -53,6 +51,11 @@ public class Wf extends
 				}
 			}
 		}
-		return (Wf) Cp.getInstance();
+		Cp wf = Cp.getInstance();
+		if (wf instanceof Wf) {
+			return (Wf) Cp.getInstance();
+		}
+		setInstance(null);
+		return getInstance();
 	}
 }
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfBL.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfBL.java
index 344d809fc0..82ca38ab1b 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfBL.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfBL.java
@@ -18,39 +18,39 @@
  ******************************************************************************/
 package br.gov.jfrj.siga.wf.bl;
 
-import java.io.UnsupportedEncodingException;
 import java.util.ArrayList;
-import java.util.Calendar;
-import java.util.Collection;
-import java.util.Comparator;
 import java.util.Date;
+import java.util.HashMap;
 import java.util.List;
-import java.util.Set;
+import java.util.Map;
 import java.util.SortedSet;
 import java.util.TreeSet;
 
-import org.jbpm.JbpmContext;
-import org.jbpm.db.GraphSession;
-import org.jbpm.graph.def.Node;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.def.Transition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.instantiation.Delegation;
-import org.jbpm.taskmgmt.def.Swimlane;
-import org.jbpm.taskmgmt.def.Task;
-import org.jbpm.taskmgmt.exe.SwimlaneInstance;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-import org.jbpm.taskmgmt.exe.TaskMgmtInstance;
+import org.apache.commons.beanutils.PropertyUtils;
 
+import com.crivano.jlogic.Expression;
+
+import br.gov.jfrj.siga.Service;
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.cp.CpIdentidade;
 import br.gov.jfrj.siga.cp.bl.CpBL;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.dao.DpPessoaDaoFiltro;
+import br.gov.jfrj.siga.ex.service.ExService;
 import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
+import br.gov.jfrj.siga.wf.logic.WfPodePegar;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfMov;
+import br.gov.jfrj.siga.wf.model.WfMovAnotacao;
+import br.gov.jfrj.siga.wf.model.WfMovDesignacao;
+import br.gov.jfrj.siga.wf.model.WfMovTransicao;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDePrincipal;
+import br.gov.jfrj.siga.wf.util.WfEngine;
+import br.gov.jfrj.siga.wf.util.WfHandler;
+import br.gov.jfrj.siga.wf.util.WfResp;
+import br.gov.jfrj.siga.wf.util.WfTarefa;
+import br.gov.jfrj.siga.wf.util.WfTarefaComparator;
 
 /**
  * Classe que representa a lógica do negócio do sistema de workflow.
@@ -63,18 +63,18 @@ public class WfBL extends CpBL {
 	public static final String WF_LOTA_CADASTRANTE = "wf_lota_cadastrante";
 	public static final String WF_TITULAR = "wf_titular";
 	public static final String WF_LOTA_TITULAR = "wf_lota_titular";
-	private static TaskInstanceComparator tic = new TaskInstanceComparator();
+	private static WfTarefaComparator tic = new WfTarefaComparator();
 
 	/**
 	 * Cria uma instância de processo. Ao final da criação, define as seguintes
-	 * variáveis na instância do processo: WF_CADASTRANTE - Pessoa responsável
-	 * (que responde) pelas ações realizadas no sistema no momento da criação da
+	 * variáveis na instância do processo: WF_CADASTRANTE - Pessoa responsável (que
+	 * responde) pelas ações realizadas no sistema no momento da criação da
 	 * instância do processo WF_LOTA_CADASTRANTE - Lotação da pessoa que está
-	 * operando o sistema no momento da criação da instância do processo
-	 * WF_TITULAR - Pessoa responsável (que responde) pelas ações realizadas no
-	 * sistema no momento da criação da instância do processo WF_LOTA_TITULAR -
-	 * Lotação da pessoa responsável (que responde) pelas ações realizadas no
-	 * sistema no momento da criação da instância do processo
+	 * operando o sistema no momento da criação da instância do processo WF_TITULAR
+	 * - Pessoa responsável (que responde) pelas ações realizadas no sistema no
+	 * momento da criação da instância do processo WF_LOTA_TITULAR - Lotação da
+	 * pessoa responsável (que responde) pelas ações realizadas no sistema no
+	 * momento da criação da instância do processo
 	 * 
 	 * Essas variáveis são do banco de dados corporativo.
 	 * 
@@ -88,210 +88,129 @@ public class WfBL extends CpBL {
 	 * @return
 	 * @throws Exception
 	 */
-	public ProcessInstance createProcessInstance(long pdId,
-			DpPessoa cadastrante, DpLotacao lotaCadastrante, DpPessoa titular,
-			DpLotacao lotaTitular, ArrayList<String> keys,
-			ArrayList<String> values, boolean fCreateStartTask)
-			throws Exception {
-		GraphSession graph = WfContextBuilder.getJbpmContext()
-				.getGraphSession();
-		ProcessDefinition pd = graph.loadProcessDefinition(pdId);
-		// ProcessInstance processInstance = pd.createProcessInstance();
-		// ExecutionContext ec = new ExecutionContext(processInstance
-		// .getRootToken());
-		// // processInstance.getRootToken().getNode().leave(ec);
-		// processInstance.getRootToken().signal();
-		// WfContextBuilder.getJbpmContext().getJbpmContext()
-		// .save(processInstance);
-		// return processInstance;
-
-		final ProcessInstance pi = pd.createProcessInstance();
-		// Signal the root token based on the following criteria:
-		// 1. If there is no start task, and
-		// 2. If the root token is still at the start state, and
-		// 3. If the start state has a default leaving transition, then
-		// signal the token along the default transition.
-		// context.addSuccessMessage("Started process");
-
-		pi.getContextInstance().setVariable(WF_CADASTRANTE,
-				cadastrante.getSigla());
-		pi.getContextInstance().setVariable(WF_LOTA_CADASTRANTE,
-				lotaCadastrante.getSiglaCompleta());
-		pi.getContextInstance().setVariable(WF_TITULAR, titular.getSigla());
-		pi.getContextInstance().setVariable(WF_LOTA_TITULAR,
-				lotaTitular.getSiglaCompleta());
+	public WfProcedimento createProcessInstance(long pdId, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade identidade, WfTipoDePrincipal tipoDePrincipal, String principal, ArrayList<String> keys,
+			ArrayList<String> values, boolean fCreateStartTask) throws Exception {
+
+		// Create the process definition,
+		WfDefinicaoDeProcedimento pd = WfDao.getInstance().consultar(pdId, WfDefinicaoDeProcedimento.class, false);
+
+		// Create the process instance without responsible support
+		HashMap<String, Object> variable = new HashMap<>();
+//		variable.put(WF_CADASTRANTE, cadastrante.getSigla());
+//		variable.put(WF_LOTA_CADASTRANTE, lotaCadastrante.getSiglaCompleta());
+//		variable.put(WF_TITULAR, titular.getSigla());
+//		variable.put(WF_LOTA_TITULAR, lotaTitular.getSiglaCompleta());
 
 		if (keys != null && values != null) {
 			for (int n = 0; n < keys.size(); n++) {
-				pi.getContextInstance().setVariable(keys.get(n), values.get(n));
+				variable.put(keys.get(n), values.get(n));
 			}
 		}
 
-		final TaskMgmtInstance taskMgmtInstance = pi.getTaskMgmtInstance();
-		TaskInstance startTaskInstance = null;
-		if (fCreateStartTask)
-			startTaskInstance = taskMgmtInstance.createStartTaskInstance();
-
-		/*
-		 * next piece causes NPE. and i don't think it is needed to signal a new
-		 * process automatically. that can be done in the console itself as
-		 * well. TODO it would be nice if the console automatically navigated to
-		 * the screen where you can see the root token and actually give the
-		 * signal
-		 */
-
-		if (startTaskInstance == null) {
-			// There is no start task
-			final Node initialNode = pd.getStartState();
-			final Token rootToken = pi.getRootToken();
-			final Node rootTokenNode = rootToken.getNode();
-			if (initialNode.getId() == rootTokenNode.getId()) {
-
-				Task startTaskDefinition = initialNode.getProcessDefinition()
-						.getTaskMgmtDefinition().getStartTask();
-
-				if (startTaskDefinition != null) {
-					SwimlaneInstance si = pi
-							.getTaskMgmtInstance()
-							.createSwimlaneInstance(
-									startTaskDefinition.getSwimlane().getName());
-					si.setActorId(titular.getSigla());
-					String[] actorsId = new String[1];
-					actorsId[0] = lotaTitular.getSiglaCompleta();
-					si.setPooledActors(actorsId);
-					pi.getTaskMgmtInstance().addSwimlaneInstance(si);
-				}
-				// The root token is still at the start node
-				final Transition defaultLeavingTransition = initialNode
-						.getDefaultLeavingTransition();
-				if (defaultLeavingTransition != null) {
-					// There's a default transition
-					rootToken.signal(defaultLeavingTransition);
-					// context.addSuccessMessage("Signalled root token");
-				}
-			} 
-		} else {
-			startTaskInstance.assign(new ExecutionContext(startTaskInstance.getToken()));
-		}
+		if (variable.containsKey("doc_document"))
+			principal = (String) variable.get("doc_document");
 
-		// context.selectOutcome("started");
-		if (pi.hasEnded()) {
-			// context.selectOutcome("finished");
-			// context.addSuccessMessage("Process completed");
-		}
+		WfProcedimento pi = new WfProcedimento(pd, variable);
+		pi.setTipoDePrincipal(WfTipoDePrincipal.DOC);
+		pi.setPrincipal(principal);
+		pi.setTitular(titular);
+		pi.setLotaTitular(lotaTitular);
+		pi.setHisIdcIni(identidade);
+		pi.setOrgaoUsuario(titular.getOrgaoUsuario());
+		pi.setHisDtIni(dao().consultarDataEHoraDoServidor());
+
+		WfEngine engine = new WfEngine(dao(), new WfHandler(titular, lotaTitular, identidade));
+
+		// Start the process instance
+		engine.start(pi);
 
-		// if (instanceExpression != null) {
-		// try {
-		// instanceExpression.setValue(elContext, instance);
-		// } catch (ELException ex) {
-		// context.setError("Error setting value of "
-		// + instanceExpression.getExpressionString(), ex);
-		// return;
-		// }
-		// }
-
-		// Nothing else saves the process, so we must
-		WfContextBuilder.getJbpmContext().getJbpmContext().save(pi);
 		return pi;
 	}
 
+	public void prosseguir(String event, Integer detourIndex, Map<String, Object> param, DpPessoa titular,
+			DpLotacao lotaTitular, CpIdentidade identidade) throws Exception {
+		WfEngine engine = new WfEngine(dao(), new WfHandler(titular, lotaTitular, identidade));
+		engine.resume(event, detourIndex, param);
+	}
+
 	/**
 	 * Retorna o conjunto de tarefas que estão na responsabilidade do usuário.
 	 * 
 	 * @throws AplicacaoException
 	 */
-	public SortedSet<TaskInstance> getTaskList(DpPessoa cadastrante,
-			DpPessoa titular, DpLotacao lotaTitular) throws AplicacaoException {
-		SortedSet<TaskInstance> tasks = new TreeSet<TaskInstance>(tic);
-		boolean fActorIdNaLista = false;
-
-		List<String> actorIds = new ArrayList<String>(2);
-		actorIds.add(lotaTitular.getSiglaCompleta());
-		actorIds.add(titular.getSigla());
-
-		// Acrescenta os tasks do titular
-		// tasks.addAll(WfContextBuilder.getJbpmContext().getJbpmContext()
-		// .getTaskList(titular.getSigla()));
-
-		// Acrescenta os tasks das pessoas da lotação. Se o usuário estiver
-		// substituindo uma lotação, seu actorId deve ser adicionado à lista
-		// posteriormente.
-		List<DpPessoa> pessoas = dao().pessoasPorLotacao(lotaTitular.getId(),
-				false,true);
-		if (pessoas != null) {
-			List<String> aActorIds = new ArrayList<String>(pessoas.size());
-			int i = 0;
-			for (DpPessoa pes : pessoas) {
-				aActorIds.add(pes.getSigla());
-				if (pes.getSigla().equals(titular.getSigla()))
-					fActorIdNaLista = true;
-				i++;
-			}
-			if (!fActorIdNaLista)
-				aActorIds.add(titular.getSigla());
-
-			tasks.addAll(WfContextBuilder.getJbpmContext().getJbpmContext()
-					.getTaskMgmtSession().findTaskInstances(aActorIds));
-		}
-
-		tasks.addAll(getGroupTaskList(actorIds));
+	public SortedSet<WfTarefa> getTaskList(DpPessoa cadastrante, DpPessoa titular, DpLotacao lotaTitular)
+			throws AplicacaoException {
+		SortedSet<WfTarefa> tasks = WfDao.getInstance().consultarTarefasDeLotacao(lotaTitular);
 		return tasks;
 	}
 
-	/*
-	 * Esse método é necessário pois o método getGroupTaskList de JbpmContext
-	 * gera uma exceção sempre que nenhum task é encontrado.
-	 */
-	private static List<TaskInstance> getGroupTaskList(List<String> actorIds) {
-		// Acrescenta os tasks que não tem actorId, mas que possuem a
-		// lotaTitular ou o titular no seu pool de atores
-		List taskInstanceIds = WfDao.getInstance().getSessao().getNamedQuery(
-				"TaskMgmtSession.findPooledTaskInstancesByActorIds")
-				.setParameterList("actorIds", actorIds).list();
-		List<TaskInstance> taskInstances = null;
-		if (taskInstanceIds != null && taskInstanceIds.size() > 0) {
-			taskInstances = WfDao.getInstance().getSessao().getNamedQuery(
-					"TaskMgmtSession.findTaskInstancesByIds").setParameterList(
-					"taskInstanceIds", taskInstanceIds).list();
-			return taskInstances;
-		}
-		return new ArrayList<TaskInstance>();
+	public List<WfProcedimento> getTaskList(String siglaDoc) {
+		List<WfProcedimento> pis = WfDao.getInstance().consultarProcedimentosAtivosPorEvento(siglaDoc);
+		return pis;
 	}
 
-	public SortedSet<TaskInstance> getTaskList(String siglaDoc) {
-		SortedSet<TaskInstance> tasks = new TreeSet<TaskInstance>(tic);
-		tasks.addAll(WfDao.getInstance().consultarTarefasAtivasPorDocumento(
-				siglaDoc));
-		return tasks;
+	public static void transferirDocumentosVinculados(WfProcedimento pi, String siglaTitular) throws Exception {
+		String principal = pi.getPrincipal();
+		WfTipoDePrincipal tipo = pi.getTipoDePrincipal();
+		if (principal == null || tipo == null)
+			return;
+
+		if (tipo != WfTipoDePrincipal.DOC)
+			return;
+
+		if (pi.getResponsible() == null)
+			return;
+
+		String destino = pi.getResponsible().getCodigo();
+
+		ExService service = Service.getExService();
+		service.transferir(principal, destino, siglaTitular, true);
 	}
 
-	public static Boolean podePegarTarefa(DpPessoa cadastrante,
-			DpPessoa titular, DpLotacao lotaCadastrante, DpLotacao lotaTitular,
-			TaskInstance ti) {
-		Set<TaskInstance> tasks = new TreeSet<TaskInstance>(tic);
-		List<String> actorIds = new ArrayList<String>();
-		actorIds.add(lotaTitular == null ? lotaCadastrante.getSiglaCompleta()
-				: lotaTitular.getSiglaCompleta());
+	public static void assertPodeTransferirDocumentosVinculados(WfTarefa ti, String siglaTitular) throws Exception {
+		String principal = ti.getInstanciaDeProcedimento().getPrincipal();
+		WfTipoDePrincipal tipo = ti.getInstanciaDeProcedimento().getTipoDePrincipal();
+		if (principal == null || tipo == null)
+			return;
 
-		tasks.addAll(getGroupTaskList(actorIds));
+		if (tipo != WfTipoDePrincipal.DOC)
+			return;
 
-		for (TaskInstance t : tasks) {
-			if (t.getId() == ti.getId()) {
+		ExService service = Service.getExService();
+		if (!service.podeTransferir(principal, siglaTitular, true)) {
+			throw new AplicacaoException("A tarefa não pode prosseguir porque o documento '" + principal
+					+ "' não pode ser transferido. Por favor, verifique se o documento está em sua lotação e se está 'Aguardando andamento'.");
+		}
+	}
+
+	public static boolean assertLotacaoAscendenteOuDescendente(DpLotacao lotAtual, DpLotacao lotFutura)
+			throws AplicacaoException {
+		if (lotAtual.getIdInicial().equals(lotFutura.getIdInicial()))
+			return true;
+
+		// Linha ascendente
+		DpLotacao lot = lotAtual;
+		while (lot.getLotacaoPai() != null) {
+			lot = lot.getLotacaoPai();
+			if (lot.getIdInicial().equals(lotFutura.getIdInicial()))
 				return true;
-			}
 		}
 
-		
-		if (ti.getActorId() != null){
-			DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-			flt.setSigla(ti.getActorId());
-			DpPessoa actor = (DpPessoa) WfDao.getInstance().consultarPorSigla(flt);
-			if (cadastrante.getLotacao().equivale(actor.getLotacao()) ||
-					(lotaTitular != null && lotaTitular.equivale(actor.getLotacao()))){
+		// Descendente direta
+		lot = lotFutura;
+		while (lot.getLotacaoPai() != null) {
+			lot = lot.getLotacaoPai();
+			if (lot.getIdInicial().equals(lotAtual.getIdInicial()))
 				return true;
-			}
 		}
-		
+
+		throw new AplicacaoException("A designaï¿½ï¿½o de '" + lotAtual.getSigla() + "' para '" + lotFutura.getSigla()
+				+ "' nï¿½o ï¿½ permitida pois sï¿½ sï¿½o aceitas lotaï¿½ï¿½es ascendentes seguindo a linha do organograma ou descendentes diretas.");
+	}
+
+	public static Boolean podePegarTarefa(DpPessoa cadastrante, DpPessoa titular, DpLotacao lotaCadastrante,
+			DpLotacao lotaTitular, WfTarefa ti) {
 		return false;
 	}
 
@@ -299,212 +218,84 @@ public class WfBL extends CpBL {
 		return (WfDao) getComp().getConfiguracaoBL().dao();
 	}
 
-	public Comparator<? super TaskInstance> getTaskInstanceComparator() {
-		return tic;
+	public void encerrarProcessInstance(Long id, Date consultarDataEHoraDoServidor) {
+		// TODO Auto-generated method stub
 	}
 
-	/**
-	 * Finaliza todas as Processes Instances que estiverem abertas.
-	 * @throws AplicacaoException 
-	 */
-	public void encerrarTodasProcessesInstances(String nomeProcesso) throws AplicacaoException {
-		List<ProcessDefinition> pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findAllProcessDefinitionVersions(nomeProcesso);
+	public WfDefinicaoDeProcedimento getCopia(WfDefinicaoDeProcedimento original) {
+		WfDefinicaoDeProcedimento copia = new WfDefinicaoDeProcedimento();
+		try {
 
-		for (ProcessDefinition p : pd) {
-			List<ProcessInstance> instanciasProcesso = WfDao.getInstance().consultarInstanciasDoProcessInstance(p.getId());
+			PropertyUtils.copyProperties(copia, original);
 
-			for (ProcessInstance pi : instanciasProcesso) {
-				encerrarProcessInstance(pi.getId(), new Date());
-			}
+			// novo id
+			copia.setId(null);
+			copia.setHisDtFim(null);
+			copia.setHisDtIni(null);
+			copia.updateAtivo();
 
+		} catch (Exception e) {
+			throw new AplicacaoException("Erro ao copiar as propriedades anteriores.");
 		}
-		WfContextBuilder.closeContext();
 
+		return copia;
 	}
 
-	/**
-	 * Encerra uma process instance com uma data de fim específica.
-	 * 
-	 * @param idProcessInstance
-	 * @param dataFim
-	 * @throws AplicacaoException
-	 */
-	public void encerrarProcessInstance(Long idProcessInstance, Date dataFim)
-			throws AplicacaoException {
-		Calendar cDtFim = Calendar.getInstance();
-		cDtFim.setTime(dataFim);
-		ProcessInstance pi = WfContextBuilder.getJbpmContext()
-				.getGraphSession().getProcessInstance(idProcessInstance);
-
-		Calendar cPiStart = Calendar.getInstance();
-		cPiStart.setTime(pi.getStart());
-		pi.end();
-
-		if (cDtFim != null && (cDtFim.after(cPiStart))) {
-			pi.setEnd(cDtFim.getTime());
-		} else {
-			throw new AplicacaoException(
-					"A data de fim é anterior à data de criação do Process Instance ID: "
-							+ pi.getId() + " START: " + pi.getStart());
-		}
-
-		for (TaskInstance ti : (Collection<TaskInstance>) (pi
-				.getTaskMgmtInstance().getUnfinishedTasks(pi.getRootToken()))) {
-			Calendar cTiCreate = Calendar.getInstance();
-			cTiCreate.setTime(ti.getCreate());
-			ti.end();
-			if (cDtFim != null && (cDtFim.after(cTiCreate))) {
-				ti.setEnd(cDtFim.getTime());
-			} else {
-				throw new AplicacaoException(
-						"A data de fim é anterior à data de criação da Task Instance ID:"
-								+ ti.getId() + " CREATE: " + ti.getCreate());
-			}
-		}
-
+	public void gravar(WfDefinicaoDeProcedimento novo, WfDefinicaoDeProcedimento antigo, Date dt,
+			CpIdentidade identidadeCadastrante) throws AplicacaoException {
+		if (novo.getNome() == null || novo.getNome().trim().length() == 0)
+			throw new AplicacaoException("não é possível salvar sem informar o nome.");
+		dao().gravarComHistorico(novo, antigo, dt, identidadeCadastrante);
 	}
 
-	public void excluirProcessInstance(Long idProcessInstance) {
-		ProcessInstance pi = WfContextBuilder.getJbpmContext()
-				.getGraphSession().getProcessInstance(idProcessInstance);
-		WfContextBuilder.getJbpmContext().getGraphSession()
-				.deleteProcessInstance(pi.getId());
+	private void gravarMovimentacao(final WfMov mov) throws AplicacaoException {
+		dao().gravar(mov);
+		if (mov.getProcedimento().getMovimentacoes() == null)
+			mov.getProcedimento().setMovimentacoes(new TreeSet<WfMov>());
+		mov.getProcedimento().getMovimentacoes().add(mov);
 	}
-	
-	/**
-	 * Exclui do banco de dados todas as instâncias do processo. CUIDADO: As
-	 * exclusões de instâncias são realizadas em TODAS AS VERSÕES do Process
-	 * Definition.
-	 * 
-	 * @param nomeProcesso -
-	 *            Nome do processo que terá suas instâncias excluídas.
-	 */
-	public void excluirTodasProcessInstances(String nomeProcesso) {
-		List<ProcessDefinition> pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findAllProcessDefinitionVersions(nomeProcesso);
-
-		for (ProcessDefinition p : pd) {
-			List<ProcessInstance> instanciasProcesso =  WfDao.getInstance().consultarInstanciasDoProcessInstance(p.getId());
 
-			for (ProcessInstance pi : instanciasProcesso) {
-				WfContextBuilder.getJbpmContext().getGraphSession()
-						.deleteProcessInstance(pi.getId());
-			}
+	public void anotar(WfProcedimento pi, String descrMov, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade identidade) {
+		try {
 
+			WfMovAnotacao mov = new WfMovAnotacao(pi, descrMov, dao().consultarDataEHoraDoServidor(), titular,
+					lotaTitular, identidade);
+			gravarMovimentacao(mov);
+		} catch (final Exception e) {
+			throw new AplicacaoException("Erro ao fazer anotação.", 0, e);
 		}
-		WfContextBuilder.closeContext();
 	}
-	
-	/**
-	 * Exclui a última versão da definição do processo (Process Definition) do
-	 * banco de dados. CUIDADO: todas as instâncias associadas a ela também
-	 * serão excluídas.
-	 * 
-	 * @param nomeProcesso -
-	 *            Nome do processo.
-	 */
-	private static void excluirUltimaVersaoProcessDefinition(String nomeProcesso) {
-		ProcessDefinition pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findLatestProcessDefinition(nomeProcesso);
-
-		WfContextBuilder.getJbpmContext().getGraphSession()
-				.deleteProcessDefinition(pd.getId());
-
-		WfContextBuilder.closeContext();
 
+	public void excluirAnotacao(WfProcedimento pi, WfMovAnotacao mov) {
+		pi.getMovimentacoes().remove(mov);
+		mov.delete();
 	}
-	
-	
-	/**
-	 * Exclui TODAS as definições de processo (Process definition) do banco de
-	 * dados. O process definition deixará de existir, bem como suas instâncias
-	 * de processo.
-	 * 
-	 * @param nomeProcesso
-	 */
-	private static void excluirTodosProcessDefinition(String nomeProcesso) {
-		List<ProcessDefinition> pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findAllProcessDefinitionVersions(nomeProcesso);
-
-		for (ProcessDefinition p : pd) {
-			WfContextBuilder.getJbpmContext().getGraphSession()
-					.deleteProcessDefinition(p.getId());
-		}
-		WfContextBuilder.closeContext();
 
+	public void registrarTransicao(WfProcedimento pi, Integer de, Integer para, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade identidade) {
+		WfMovTransicao mov = new WfMovTransicao(pi, dao().consultarDataEHoraDoServidor(), titular, lotaTitular,
+				identidade, de, para);
+		gravarMovimentacao(mov);
 	}
 
-	/**
-	 * Encerra o processo da tarefa especificada.
-	 * @param idTI
-	 * @param dtFim
-	 * @throws AplicacaoException
-	 */
-	public void encerrarProcessInstanceDaTarefa(Long idTI, Date dtFim) throws AplicacaoException {
-		TaskInstance ti = WfContextBuilder.getJbpmContext().getJbpmContext().getTaskInstance(idTI);
-
-		if (ti==null){
-			throw new AplicacaoException("Tarefa não encontrada!");
+	public void pegar(WfProcedimento pi, DpPessoa titular, DpLotacao lotaTitular, CpIdentidade identidade) {
+		assertLogic(new WfPodePegar(pi, titular, lotaTitular), "pegar");
+		WfMovDesignacao mov = new WfMovDesignacao(pi, dao().consultarDataEHoraDoServidor(), titular, lotaTitular,
+				identidade, pi.getEventoPessoa(), pi.getEventoLotacao(), titular, lotaTitular);
+		gravarMovimentacao(mov);
+
+		if (pi.getEventoPessoa() != null || pi.getEventoLotacao() != null) {
+			WfResp resp = pi.calcResponsible(pi.getCurrentTaskDefinition());
+			pi.setEventoPessoa(resp.getPessoa());
+			pi.setEventoLotacao(resp.getLotacao());
+			dao().gravarInstanciaDeProcedimento(pi);
 		}
-		if (dtFim==null){
-			throw new AplicacaoException("Data inválida!");
-		}
-		
-		encerrarProcessInstance(ti.getProcessInstance().getId(), dtFim);
-	}
-	
-	public String gravarProcessDefinition(String xml) {
-		JbpmContext jbpmContext = WfContextBuilder.getJbpmContext().getJbpmContext();
-		ProcessDefinition processDefinition = ProcessDefinition.parseXmlString(xml);
-		jbpmContext.deployProcessDefinition(processDefinition);
-		long id = processDefinition.getId();
-
-		String sReturn = "Definição de Procedimento: " + processDefinition.getName()
-				+ " atualizada com sucesso.";
-
-		// ProcessDefinition pi = jbpmContext.getGraphSession()
-		// .loadProcessDefinition(id);
-
-		Delegation d = new Delegation(
-				"br.gov.jfrj.siga.wf.util.WfAssignmentHandler");
-
-		for (Swimlane s : ((Collection<Swimlane>) processDefinition
-				.getTaskMgmtDefinition().getSwimlanes().values())) {
-			if (s.getTasks() != null)
-				for (Object t : s.getTasks()) {
-					System.out.println(((Task) t).toString());
-				}
-			if (s.getAssignmentDelegation() == null)
-				s.setAssignmentDelegation(d);
-		}
-
-		for (Task t : ((Collection<Task>) processDefinition
-				.getTaskMgmtDefinition().getTasks().values())) {
-			if (t.getSwimlane() == null
-					&& t.getAssignmentDelegation() == null)
-				t.setAssignmentDelegation(d);
-		}
-		return sReturn; 
 	}
 
-	public String lerProcessDefinition(String nome) {
-		JbpmContext jbpmContext = WfContextBuilder.getJbpmContext().getJbpmContext();
-		ProcessDefinition pd = jbpmContext.getGraphSession().findLatestProcessDefinition(nome);
-
-		byte ab[] = pd.getFileDefinition().getBytes("processdefinition.xml");
-		String sXML;
-		try {
-			sXML = new String(ab, "UTF-8");
-			return sXML; 
-		} catch (UnsupportedEncodingException e) {
-			return null;
-		}
-		
+	private static void assertLogic(Expression expr, String descr) {
+		if (!expr.eval())
+			throw new AplicacaoException("Não pode " + descr + " porque " + expr.explain(false));
 	}
 
 }
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfCompetenciaBL.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfCompetenciaBL.java
index 6ddb36b36f..3f21969e42 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfCompetenciaBL.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfCompetenciaBL.java
@@ -28,8 +28,8 @@ import br.gov.jfrj.siga.cp.bl.CpCompetenciaBL;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.dp.dao.CpDao;
-import br.gov.jfrj.siga.wf.WfConfiguracao;
 import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfConfiguracao;
 
 /**
  * Classe que representa as competências da lógica de negócio do sistema de
@@ -41,8 +41,7 @@ import br.gov.jfrj.siga.wf.dao.WfDao;
 public class WfCompetenciaBL extends CpCompetenciaBL {
 
 	/**
-	 * Verifica se a pessoa ou lotação pode instanciar um procedimento
-	 * (Process).
+	 * Verifica se a pessoa ou lotação pode instanciar um procedimento (Process).
 	 * 
 	 * @param titular
 	 * @param lotaTitular
@@ -50,8 +49,8 @@ public class WfCompetenciaBL extends CpCompetenciaBL {
 	 * @return
 	 * @throws Exception
 	 */
-	public Boolean podeInstanciarProcedimento(DpPessoa titular,
-			DpLotacao lotaTitular, final String procedimento) throws Exception {
+	public Boolean podeInstanciarProcedimento(DpPessoa titular, DpLotacao lotaTitular, final String procedimento)
+			throws Exception {
 		if (lotaTitular == null)
 			return false;
 		return podePorConfiguracao(titular, lotaTitular, procedimento,
@@ -59,8 +58,8 @@ public class WfCompetenciaBL extends CpCompetenciaBL {
 	}
 
 	/**
-	 * Retorna um configuração existente para a combinação dos dados passados
-	 * como parâmetros, caso exista.
+	 * Retorna um configuração existente para a combinação dos dados passados como
+	 * parâmetros, caso exista.
 	 * 
 	 * @param titularIniciador
 	 * @param lotaTitularIniciador
@@ -71,67 +70,49 @@ public class WfCompetenciaBL extends CpCompetenciaBL {
 	 * @return
 	 * @throws Exception
 	 */
-	private WfConfiguracao preencherFiltroEBuscarConfiguracao(
-			DpPessoa titularIniciador, DpLotacao lotaTitularIniciador,
-			long tipoConfig, final String procedimento, final String raia,
-			final String tarefa) throws Exception {
+	private WfConfiguracao preencherFiltroEBuscarConfiguracao(DpPessoa titularIniciador, DpLotacao lotaTitularIniciador,
+			long tipoConfig, final String procedimento, final String raia, final String tarefa) throws Exception {
 		WfConfiguracao cfgFiltro = new WfConfiguracao();
 
-		cfgFiltro.setCargo(titularIniciador!=null?titularIniciador.getCargo():null);
-		cfgFiltro.setOrgaoUsuario(lotaTitularIniciador!=null?lotaTitularIniciador.getOrgaoUsuario():null);
-		cfgFiltro.setFuncaoConfianca(titularIniciador!=null?titularIniciador.getFuncaoConfianca():null);
+		cfgFiltro.setCargo(titularIniciador != null ? titularIniciador.getCargo() : null);
+		cfgFiltro.setOrgaoUsuario(lotaTitularIniciador != null ? lotaTitularIniciador.getOrgaoUsuario() : null);
+		cfgFiltro.setFuncaoConfianca(titularIniciador != null ? titularIniciador.getFuncaoConfianca() : null);
 		cfgFiltro.setLotacao(lotaTitularIniciador);
-		cfgFiltro.setDpPessoa(titularIniciador!=null?titularIniciador:null);
-		cfgFiltro.setCpTipoConfiguracao(CpDao.getInstance().consultar(
-				tipoConfig, CpTipoConfiguracao.class, false));
+		cfgFiltro.setDpPessoa(titularIniciador != null ? titularIniciador : null);
+		cfgFiltro.setCpTipoConfiguracao(CpDao.getInstance().consultar(tipoConfig, CpTipoConfiguracao.class, false));
 
 		cfgFiltro.setProcedimento(procedimento);
 		cfgFiltro.setRaia(raia);
 		cfgFiltro.setTarefa(tarefa);
 
-		WfConfiguracao cfg = (WfConfiguracao) getConfiguracaoBL()
-				.buscaConfiguracao(cfgFiltro, new int[] { 0 }, null);
-
-		// Essa linha é necessária porque quando recuperamos um objeto da classe
-		// WfConfiguracao do TreeMap estático que os armazena, este objeto está
-		// detached, ou seja, não está conectado com a seção atual do hibernate.
-		// Portanto, quando vamos acessar alguma propriedade dele que seja do
-		// tipo LazyRead, obtemos um erro. O método lock, attacha ele novamente
-		// na seção atual.
-		if (cfg != null)
-			WfDao.getInstance().getSessao().lock(cfg, LockMode.NONE);
-
+		WfConfiguracao cfg = (WfConfiguracao) getConfiguracaoBL().buscaConfiguracao(cfgFiltro, new int[] { 0 }, null);
 		return cfg;
 	}
 
 	/**
-	 * Verifica se uma pessoa ou lotação tem permissão em uma configuração
-	 * passada como parâmetro.
+	 * Verifica se uma pessoa ou lotação tem permissão em uma configuração passada
+	 * como parâmetro.
 	 * 
 	 * @param titular
 	 * @param lotaTitular
 	 * @param procedimento
-	 * @param tipoConfig
-	 *            - Configuração que terá a permissão verificada.
+	 * @param tipoConfig   - Configuração que terá a permissão verificada.
 	 * @return
 	 * @throws Exception
 	 */
-	private Boolean podePorConfiguracao(DpPessoa titular,
-			DpLotacao lotaTitular, String procedimento, long tipoConfig)
+	private Boolean podePorConfiguracao(DpPessoa titular, DpLotacao lotaTitular, String procedimento, long tipoConfig)
 			throws Exception {
 		CpSituacaoConfiguracao situacao;
-		WfConfiguracao cfg = preencherFiltroEBuscarConfiguracao(titular,
-				lotaTitular, tipoConfig, procedimento, null, null);
+		WfConfiguracao cfg = preencherFiltroEBuscarConfiguracao(titular, lotaTitular, tipoConfig, procedimento, null,
+				null);
 
 		if (cfg != null) {
 			situacao = cfg.getCpSituacaoConfiguracao();
 		} else {
-			situacao = CpDao.getInstance().consultar(tipoConfig,
-					CpTipoConfiguracao.class, false).getSituacaoDefault();
+			situacao = CpDao.getInstance().consultar(tipoConfig, CpTipoConfiguracao.class, false).getSituacaoDefault();
 		}
 
-		if (situacao != null
-				&& situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_PODE)
+		if (situacao != null && situacao.getIdSitConfiguracao() == CpSituacaoConfiguracao.SITUACAO_PODE)
 			return true;
 		return false;
 	}
@@ -149,15 +130,12 @@ public class WfCompetenciaBL extends CpCompetenciaBL {
 	 * @return
 	 * @throws Exception
 	 */
-	public WfConfiguracao designar(DpPessoa titularIniciador,
-			DpLotacao lotaTitularIniciador, DpPessoa titularAnterior,
-			DpLotacao lotaTitularAnterior, final String procedimento,
-			final String raia, final String tarefa) throws Exception {
-
-		WfConfiguracao cfg = preencherFiltroEBuscarConfiguracao(
-				titularIniciador, lotaTitularIniciador,
-				CpTipoConfiguracao.TIPO_CONFIG_DESIGNAR_TAREFA, procedimento,
-				raia, tarefa);
+	public WfConfiguracao designar(DpPessoa titularIniciador, DpLotacao lotaTitularIniciador, DpPessoa titularAnterior,
+			DpLotacao lotaTitularAnterior, final String procedimento, final String raia, final String tarefa)
+			throws Exception {
+
+		WfConfiguracao cfg = preencherFiltroEBuscarConfiguracao(titularIniciador, lotaTitularIniciador,
+				CpTipoConfiguracao.TIPO_CONFIG_DESIGNAR_TAREFA, procedimento, raia, tarefa);
 		if (cfg == null)
 			return null;
 
@@ -168,27 +146,20 @@ public class WfCompetenciaBL extends CpCompetenciaBL {
 	 * Verifica se uma pessoa ou lotação tem competência para realizar uma
 	 * determinada ação no sistema.
 	 * 
-	 * @param funcao
-	 *            Competência a ser testada (Ex: IntanciarProcedimento)
-	 * @param titular
-	 *            Pessoa a ser verificada
-	 * @param lotaTitular
-	 *            Lotação a ser verificada
-	 * @param pd
-	 *            Procedimento a ser testado
+	 * @param funcao      Competência a ser testada (Ex: IntanciarProcedimento)
+	 * @param titular     Pessoa a ser verificada
+	 * @param lotaTitular Lotação a ser verificada
+	 * @param pd          Procedimento a ser testado
 	 * @return true se a pessoa/lotação tem competência para realizar a ação.
 	 */
-	public boolean testaCompetencia(final String funcao,
-			final DpPessoa titular, final DpLotacao lotaTitular, final String pd) {
-		final Class[] classes = new Class[] { DpPessoa.class, DpLotacao.class,
-				String.class };
+	public boolean testaCompetencia(final String funcao, final DpPessoa titular, final DpLotacao lotaTitular,
+			final String pd) {
+		final Class[] classes = new Class[] { DpPessoa.class, DpLotacao.class, String.class };
 		Boolean resposta = false;
 		try {
-			final Method method = WfCompetenciaBL.class.getDeclaredMethod(
-					"pode" + funcao.substring(0, 1).toUpperCase()
-							+ funcao.substring(1), classes);
-			resposta = (Boolean) method.invoke(WfCompetenciaBL.class,
-					new Object[] { titular, lotaTitular, pd });
+			final Method method = WfCompetenciaBL.class
+					.getDeclaredMethod("pode" + funcao.substring(0, 1).toUpperCase() + funcao.substring(1), classes);
+			resposta = (Boolean) method.invoke(WfCompetenciaBL.class, new Object[] { titular, lotaTitular, pd });
 		} catch (final Exception e) {
 			e.printStackTrace();
 		}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoBL.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoBL.java
index 4dcd6aa234..2b7d462670 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoBL.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoBL.java
@@ -32,7 +32,7 @@ import br.gov.jfrj.siga.dp.DpFuncaoConfianca;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.dp.dao.CpDao;
-import br.gov.jfrj.siga.wf.WfConfiguracao;
+import br.gov.jfrj.siga.wf.model.WfConfiguracao;
 
 /**
  * Classe que representa a configuração do sistema de workflow.
@@ -106,12 +106,6 @@ public class WfConfiguracaoBL extends CpConfiguracaoBL {
 			DpFuncaoConfianca dpFuncaoConfianca, DpPessoa dpPessoa,
 			long idTpConf, String procedimento, String raia, String tarefa)
 			throws Exception {
-
-		
-		if (isUsuarioRoot(dpPessoa)){
-			return true;
-		}
-
 		WfConfiguracao cfgFiltro = createNewConfiguracao();
 
 		cfgFiltro.setCargo(cargo);
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoComparator.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoComparator.java
index 4e6e161604..f5f24b0cbd 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoComparator.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfConfiguracaoComparator.java
@@ -20,7 +20,7 @@ package br.gov.jfrj.siga.wf.bl;
 
 import br.gov.jfrj.siga.cp.CpConfiguracao;
 import br.gov.jfrj.siga.cp.bl.CpConfiguracaoComparator;
-import br.gov.jfrj.siga.wf.WfConfiguracao;
+import br.gov.jfrj.siga.wf.model.WfConfiguracao;
 
 /**
  * Classe que permite a comparação entre duas configurações de workflow.
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfPropriedadeBL.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfPropriedadeBL.java
index e5bbd12452..37d1b10c72 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfPropriedadeBL.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/WfPropriedadeBL.java
@@ -21,12 +21,13 @@ package br.gov.jfrj.siga.wf.bl;
 import br.gov.jfrj.siga.cp.bl.CpPropriedadeBL;
 
 public class WfPropriedadeBL extends CpPropriedadeBL {
+	private static WfPropriedadeBL instance = new WfPropriedadeBL();
 
 	@Override
 	public String getPrefixoModulo() {
 		return "siga.wf";
 	}
-	
+
 	public String getMailLinkTarefa() {
 		String result = "indefinido";
 		try {
@@ -36,7 +37,7 @@ public class WfPropriedadeBL extends CpPropriedadeBL {
 		}
 		return result;
 	}
-	
+
 	public String getMailLinkDocumento() {
 		String result = "indefinido";
 		try {
@@ -47,4 +48,23 @@ public class WfPropriedadeBL extends CpPropriedadeBL {
 		return result;
 	}
 
+	public Double getRelEstatGeraisMinMediaTrunc() {
+		return Double.valueOf(getString("rel.estatisticas.gerais.media.truncada.min", "5").replace(",", "."));
+	}
+
+	public Double getRelEstatGeraisMaxMediaTrunc() {
+		return Double.valueOf(getString("rel.estatisticas.gerais.media.truncada.max", "25").replace(",", "."));
+	}
+
+	public static String getString(final String key, final String def) {
+		try {
+			String obterPropriedade = instance.obterPropriedade(key);
+			if (obterPropriedade == null)
+				return def;
+			return obterPropriedade;
+		} catch (Exception e) {
+			return def;
+		}
+	}
+
 }
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfDao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfDao.java
index 88fbf75ace..3f7ecd6740 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfDao.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfDao.java
@@ -23,392 +23,270 @@
  */
 package br.gov.jfrj.siga.wf.dao;
 
-import java.util.Comparator;
+import java.util.ArrayList;
+import java.util.Date;
 import java.util.List;
-import java.util.Set;
+import java.util.SortedSet;
 import java.util.TreeSet;
 
-import net.sf.ehcache.Cache;
-import net.sf.ehcache.CacheManager;
-import net.sf.ehcache.config.CacheConfiguration;
+import javax.enterprise.inject.Specializes;
+import javax.persistence.criteria.CriteriaBuilder;
+import javax.persistence.criteria.CriteriaQuery;
+import javax.persistence.criteria.Join;
+import javax.persistence.criteria.JoinType;
+import javax.persistence.criteria.Root;
 
-import org.hibernate.Query;
-import org.hibernate.Session;
-import org.hibernate.cfg.Configuration;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.graph.node.TaskNode;
-import org.jbpm.taskmgmt.def.Task;
-import org.jbpm.taskmgmt.exe.TaskInstance;
+import org.jboss.logging.Logger;
 
-import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.dp.dao.CpDao;
+import br.gov.jfrj.siga.model.ContextoPersistencia;
 import br.gov.jfrj.siga.model.dao.ModeloDao;
-import br.gov.jfrj.siga.wf.WfConfiguracao;
-import br.gov.jfrj.siga.wf.WfConhecimento;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-import br.gov.jfrj.siga.wf.util.WfHibernateUtil;
+import br.gov.jfrj.siga.sinc.lib.Item;
+import br.gov.jfrj.siga.sinc.lib.Sincronizador;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.wf.model.WfConhecimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.WfResponsavel;
+import br.gov.jfrj.siga.wf.model.WfVariavel;
+import br.gov.jfrj.siga.wf.util.SiglaUtils;
+import br.gov.jfrj.siga.wf.util.SiglaUtils.SiglaDecodificada;
+import br.gov.jfrj.siga.wf.util.WfTarefa;
 
 /**
  * Classe que representa o DAO do sistema de workflow.
  * 
- * @author kpf
- * 
  */
-public class WfDao extends CpDao {
+@Specializes
+@SuppressWarnings({ "unchecked", "rawtypes" })
+public class WfDao extends CpDao implements com.crivano.jflow.Dao<WfProcedimento> {
 
 	public static final String CACHE_WF = "wf";
 
-	/**
-	 * Retorna uma instância do DAO.
-	 * 
-	 * @return
-	 */
+	private static final Logger log = Logger.getLogger(WfDao.class);
+
 	public static WfDao getInstance() {
 		return ModeloDao.getInstance(WfDao.class);
 	}
 
-	public Session getSessao() {
-		return WfHibernateUtil.getSessao();
+	public WfDao() {
 	}
 
-	/**
-	 * Pesquisa as configurações que são semelhantes ao exemplo
-	 * 
-	 * @param exemplo
-	 *            Uma configuração de exemplo para a pesquisa.
-	 * @return Lista de configurações encontradas.
-	 */
-	public List<WfConfiguracao> consultar(final WfConfiguracao exemplo) {
-		Query query = getSessao().getNamedQuery("consultarWfConfiguracoes");
-
-		query.setLong("idTpConfiguracao", exemplo.getCpTipoConfiguracao()
-				.getIdTpConfiguracao());
+	public WfDefinicaoDeProcedimento consultarWfDefinicaoDeProcedimentoPorNome(String nome) {
+		CriteriaQuery<WfDefinicaoDeProcedimento> q = cb().createQuery(WfDefinicaoDeProcedimento.class);
+		Root<WfDefinicaoDeProcedimento> c = q.from(WfDefinicaoDeProcedimento.class);
+		q.select(c);
+		q.where(cb().equal(c.get("nome"), nome), cb().equal(c.get("hisAtivo"), 1));
+		try {
+			return em().createQuery(q).getSingleResult();
+		} catch (Exception ex) {
+			throw new RuntimeException("Não foi possível localizar definição de procedimento com nome '" + nome + "'",
+					ex);
+		}
+	}
 
-		query.setCacheable(true);
-		query.setCacheRegion(CACHE_QUERY_CONFIGURACAO);
-		return query.list();
+	public SortedSet<WfTarefa> consultarTarefasDeLotacao(DpLotacao lotaTitular) {
+		// TODO Auto-generated method stub
+		return null;
 	}
 
-	public List<TaskInstance> consultarTarefasAtivasPorDocumento(String siglaDoc) {
-		Query query = getSessao().getNamedQuery(
-				"consultarTarefasAtivasPorDocumento");
-		query.setParameter("siglaDoc", siglaDoc);
-		return query.list();
+	public List<WfProcedimento> consultarProcedimentosAtivosPorEvento(String evento) {
+		String sql = "from WfProcedimento p where p.eventoNome like :eventoNome";
+		javax.persistence.Query query = ContextoPersistencia.em().createQuery(sql);
+		query.setParameter("eventoNome", evento + "%");
+		List<WfProcedimento> result = query.getResultList();
+		return result;
 	}
 
-	public WfConhecimento consultarConhecimento(String procedimento,
-			String tarefa) {
-		Query query = getSessao().getNamedQuery("consultarConhecimento");
-		query.setParameter("procedimento", procedimento);
-		query.setParameter("tarefa", tarefa);
-		List<WfConhecimento> l = query.list();
-		if (l.size() == 0)
-			return null;
-		return l.get(0);
+	public void gravarInstanciaDeProcedimento(WfProcedimento pi) {
+		SortedSet<Sincronizavel> setDepois = new TreeSet<>();
+		SortedSet<Sincronizavel> setAntes = new TreeSet<>();
+
+		setAntes.addAll(pi.getVariaveis());
+
+		if (pi.getVariavelMap() != null) {
+			for (String k : pi.getVariavelMap().keySet()) {
+				WfVariavel v = new WfVariavel();
+				v.setProcedimento(pi);
+				v.setNome(k);
+
+				Object o = pi.getVariavelMap().get(k);
+				if (o != null) {
+					if (o instanceof Date)
+						v.setDate((Date) o);
+					else if (o instanceof Double)
+						v.setNumber((Double) o);
+					else if (o instanceof Boolean)
+						v.setBool((Boolean) o);
+					else
+						v.setString((String) o);
+				}
+				setDepois.add(v);
+			}
+		}
 
+		// Utilizaremos o sincronizador para perceber apenas as diferenças entre a
+		// as variáveis que estão no banco e as variáveis no mapa..
+		Sincronizador sinc = new Sincronizador();
+		sinc.setSetNovo(setDepois);
+		sinc.setSetAntigo(setAntes);
+		List<Item> list = sinc.getEncaixe();
+		sinc.ordenarOperacoes();
+
+		gravar(pi);
+		for (Item i : list) {
+			switch (i.getOperacao()) {
+			case alterar:
+				WfVariavel antigo = (WfVariavel) i.getAntigo();
+				WfVariavel novo = (WfVariavel) i.getNovo();
+				antigo.setBool(novo.getBool());
+				antigo.setDate(novo.getDate());
+				antigo.setNumber(novo.getNumber());
+				antigo.setString(novo.getString());
+				gravar(antigo);
+				break;
+			case incluir:
+				pi.getVariaveis().add((WfVariavel) i.getNovo());
+				gravar(i.getNovo());
+				break;
+			case excluir:
+				pi.getVariaveis().remove((WfVariavel) i.getAntigo());
+				excluir(i.getAntigo());
+				break;
+			}
+		}
+		gravar(pi);
 	}
 
-	public List<ProcessInstance> consultarInstanciasDoProcessInstance(Long id) {
-		return WfContextBuilder.getJbpmContext().getGraphSession()
-				.findProcessInstances(id);
+	@Override
+	public void persist(WfProcedimento pi) {
+		gravarInstanciaDeProcedimento((WfProcedimento) pi);
 	}
 
-	static public Configuration criarHibernateCfg(String datasource)
-			throws Exception {
-		Configuration cfg = CpDao.criarHibernateCfg(datasource);
-
-		return WfDao.configurarHibernate(cfg);
+	@Override
+	public List<WfProcedimento> listByEvent(String event) {
+		List<WfProcedimento> l = new ArrayList<>();
+		l.addAll(consultarProcedimentosAtivosPorEvento(event));
+		return l;
 	}
 
-	static private Configuration configurarHibernate(Configuration cfg)
-			throws Exception {
-		cfg.addClass(br.gov.jfrj.siga.wf.WfConfiguracao.class);
-		cfg.addClass(br.gov.jfrj.siga.wf.WfConhecimento.class);
-
-		cfg.addResource("org/jbpm/db/hibernate.queries.hbm.xml");
-		cfg.addResource("org/jbpm/db/hibernate.types.hbm.xml");
-		cfg.addResource("hibernate.extra.hbm.xml");
-
-		cfg.addClass(org.jbpm.graph.action.MailAction.class);
-		cfg.addClass(org.jbpm.graph.def.ProcessDefinition.class);
-		cfg.addClass(org.jbpm.graph.def.Node.class);
-		cfg.addClass(org.jbpm.graph.def.Transition.class);
-		cfg.addClass(org.jbpm.graph.def.Event.class);
-		cfg.addClass(org.jbpm.graph.def.Action.class);
-		cfg.addClass(org.jbpm.graph.def.SuperState.class);
-		cfg.addClass(org.jbpm.graph.def.ExceptionHandler.class);
-		cfg.addClass(org.jbpm.instantiation.Delegation.class);
-		cfg.addClass(org.jbpm.graph.action.Script.class);
-		cfg.addClass(org.jbpm.graph.node.StartState.class);
-		cfg.addClass(org.jbpm.graph.node.EndState.class);
-		cfg.addClass(org.jbpm.graph.node.ProcessState.class);
-		cfg.addClass(org.jbpm.graph.node.Decision.class);
-		cfg.addClass(org.jbpm.graph.node.Fork.class);
-		cfg.addClass(org.jbpm.graph.node.Join.class);
-		cfg.addClass(org.jbpm.graph.node.MailNode.class);
-		cfg.addClass(org.jbpm.graph.node.State.class);
-		cfg.addClass(org.jbpm.graph.node.TaskNode.class);
-
-		cfg.addClass(org.jbpm.context.def.ContextDefinition.class);
-		cfg.addClass(org.jbpm.context.def.VariableAccess.class);
-		cfg.addClass(org.jbpm.bytes.ByteArray.class);
-
-		cfg.addClass(org.jbpm.module.def.ModuleDefinition.class);
-		cfg.addClass(org.jbpm.file.def.FileDefinition.class);
-
-		cfg.addClass(org.jbpm.taskmgmt.def.TaskMgmtDefinition.class);
-		cfg.addClass(org.jbpm.taskmgmt.def.Swimlane.class);
-		cfg.addClass(org.jbpm.taskmgmt.def.Task.class);
-
-		cfg.addClass(org.jbpm.taskmgmt.def.TaskController.class);
-
-		cfg.addClass(org.jbpm.scheduler.def.CreateTimerAction.class);
-
-		cfg.addClass(org.jbpm.scheduler.def.CancelTimerAction.class);
-		cfg.addClass(org.jbpm.graph.exe.Comment.class);
-		cfg.addClass(org.jbpm.graph.exe.ProcessInstance.class);
-		cfg.addClass(org.jbpm.graph.exe.Token.class);
-		cfg.addClass(org.jbpm.graph.exe.RuntimeAction.class);
-		cfg.addClass(org.jbpm.module.exe.ModuleInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.ContextInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.TokenVariableMap.class);
-
-		cfg.addClass(org.jbpm.context.exe.VariableInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.ByteArrayInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.DateInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.DoubleInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.HibernateLongInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.HibernateStringInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.LongInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.NullInstance.class);
-
-		cfg.addClass(org.jbpm.context.exe.variableinstance.StringInstance.class);
-		cfg.addClass(org.jbpm.job.Job.class);
-		cfg.addClass(org.jbpm.job.Timer.class);
-		cfg.addClass(org.jbpm.job.ExecuteNodeJob.class);
-		cfg.addClass(org.jbpm.job.ExecuteActionJob.class);
-		cfg.addClass(org.jbpm.job.CleanUpProcessJob.class);
-
-		cfg.addClass(org.jbpm.taskmgmt.exe.TaskMgmtInstance.class);
-		cfg.addClass(org.jbpm.taskmgmt.exe.TaskInstance.class);
-		cfg.addClass(org.jbpm.taskmgmt.exe.PooledActor.class);
-
-		cfg.addClass(org.jbpm.taskmgmt.exe.SwimlaneInstance.class);
-		cfg.addClass(org.jbpm.logging.log.ProcessLog.class);
-		cfg.addClass(org.jbpm.logging.log.MessageLog.class);
-		cfg.addClass(org.jbpm.logging.log.CompositeLog.class);
-		cfg.addClass(org.jbpm.graph.log.ActionLog.class);
-		cfg.addClass(org.jbpm.graph.log.NodeLog.class);
-
-		cfg.addClass(org.jbpm.graph.log.ProcessInstanceCreateLog.class);
-
-		cfg.addClass(org.jbpm.graph.log.ProcessInstanceEndLog.class);
-		cfg.addClass(org.jbpm.graph.log.ProcessStateLog.class);
-		cfg.addClass(org.jbpm.graph.log.SignalLog.class);
-		cfg.addClass(org.jbpm.graph.log.TokenCreateLog.class);
-		cfg.addClass(org.jbpm.graph.log.TokenEndLog.class);
-		cfg.addClass(org.jbpm.graph.log.TransitionLog.class);
-		cfg.addClass(org.jbpm.context.log.VariableLog.class);
-
-		cfg.addClass(org.jbpm.context.log.VariableCreateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.VariableDeleteLog.class);
-
-		cfg.addClass(org.jbpm.context.log.VariableUpdateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.variableinstance.ByteArrayUpdateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.variableinstance.DateUpdateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.variableinstance.DoubleUpdateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.variableinstance.HibernateLongUpdateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.variableinstance.HibernateStringUpdateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.variableinstance.LongUpdateLog.class);
-
-		cfg.addClass(org.jbpm.context.log.variableinstance.StringUpdateLog.class);
-		cfg.addClass(org.jbpm.taskmgmt.log.TaskLog.class);
-		cfg.addClass(org.jbpm.taskmgmt.log.TaskCreateLog.class);
-		cfg.addClass(org.jbpm.taskmgmt.log.TaskAssignLog.class);
-		cfg.addClass(org.jbpm.taskmgmt.log.TaskEndLog.class);
-		cfg.addClass(org.jbpm.taskmgmt.log.SwimlaneLog.class);
-
-		cfg.addClass(org.jbpm.taskmgmt.log.SwimlaneCreateLog.class);
-
-		cfg.addClass(org.jbpm.taskmgmt.log.SwimlaneAssignLog.class);
-
-		cfg.addClass(br.gov.jfrj.siga.wf.util.WfTaskInstance.class);
-
-		cfg.setCacheConcurrencyStrategy("org.jbpm.context.def.VariableAccess",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.file.def.FileDefinition.processFiles",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.action.Script.variableAccesses",
-				"transactional", CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.graph.def.Action",
-				"transactional", CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.graph.def.Event",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.Event.actions", "transactional", CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.graph.def.ExceptionHandler",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.ExceptionHandler.actions", "transactional",
-				CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.graph.def.Node",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.Node.events", "transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.Node.exceptionHandlers", "transactional",
-				CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.Node.leavingTransitions", "transactional",
-				CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.Node.arrivingTransitions", "transactional",
-				CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.graph.def.ProcessDefinition",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.ProcessDefinition.events", "transactional",
-				CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.ProcessDefinition.exceptionHandlers",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.ProcessDefinition.nodes", "transactional",
-				CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.ProcessDefinition.actions",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.ProcessDefinition.definitions",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.SuperState.nodes", "transactional",
-				CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.graph.def.Transition",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.Transition.events", "transactional",
-				CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.def.Transition.exceptionHandlers",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.node.Decision.decisionConditions",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.node.ProcessState.variableAccesses",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.graph.node.TaskNode.tasks", "transactional", CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.instantiation.Delegation",
-				"transactional", CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.module.def.ModuleDefinition",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.taskmgmt.def.Swimlane.tasks", "transactional",
-				CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.taskmgmt.def.TaskController",
-				"transactional", CACHE_WF);
-		cfg.setCacheConcurrencyStrategy("org.jbpm.taskmgmt.def.Task",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.taskmgmt.def.TaskController.variableAccesses",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.taskmgmt.def.Task.events", "transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.taskmgmt.def.Task.exceptionHandlers",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.taskmgmt.def.TaskMgmtDefinition.swimlanes",
-				"transactional", CACHE_WF);
-		cfg.setCollectionCacheConcurrencyStrategy(
-				"org.jbpm.taskmgmt.def.TaskMgmtDefinition.tasks",
-				"transactional", CACHE_WF);
-
-		CacheManager manager = CacheManager.getInstance();
-		Cache cache;
-		CacheConfiguration config;
-
-		if (!manager.cacheExists(CACHE_WF)) {
-			manager.addCache(CACHE_WF);
-			cache = manager.getCache(CACHE_WF);
-			config = cache.getCacheConfiguration();
-			config.setTimeToIdleSeconds(3600);
-			config.setTimeToLiveSeconds(36000);
-			config.setMaxElementsInMemory(10000);
-			config.setMaxElementsOnDisk(1000000);
-		}
-
-		return cfg;
+	public WfConhecimento consultarConhecimento(Long id) {
+		// TODO Auto-generated method stub
+		return null;
 	}
 
-	public ProcessDefinition getProcessDefinition(Long id) {
-		return WfContextBuilder.getJbpmContext().getGraphSession()
-				.getProcessDefinition(id);
+//	public List<ExDocumento> consultarDocsInclusosNoBoletim(ExDocumento doc) {
+//		final Query query = em().createNamedQuery(
+//				"consultarDocsInclusosNoBoletim");
+//		query.setHint("org.hibernate.cacheable", true);
+//		query.setHint("org.hibernate.cacheRegion", ExDao.CACHE_QUERY_SECONDS);
+//
+//		query.setParameter("idDoc", doc.getIdDoc());
+//		return query.getResultList();
+//	}
+
+	public List<WfProcedimento> consultarProcedimentosPorPessoaOuLotacao(DpPessoa titular, DpLotacao lotaTitular) {
+		String sql = "select p from WfProcedimento p left join p.eventoPessoa pes left join p.eventoLotacao lot where pes.idPessoaIni = :idPessoaIni or lot.idLotacaoIni = :idLotacaoIni";
+		javax.persistence.Query query = ContextoPersistencia.em().createQuery(sql);
+		query.setParameter("idPessoaIni", titular.getIdPessoaIni());
+		query.setParameter("idLotacaoIni", lotaTitular.getIdLotacaoIni());
+		List<WfProcedimento> result = query.getResultList();
+		return result;
 	}
 
-	public List<ProcessDefinition> getTodasAsVersoesProcessDefinition(
-			String nome) {
-		return WfContextBuilder.getJbpmContext().getGraphSession()
-				.findAllProcessDefinitionVersions(nome);
+	public List<WfResponsavel> consultarResponsaveisPorDefinicaoDeResponsavel(WfDefinicaoDeResponsavel dr) {
+		String sql = "from WfResponsavel o where o.definicaoDeResponsavel.hisIdIni = :idIni and o.hisDtFim is null";
+		javax.persistence.Query query = ContextoPersistencia.em().createQuery(sql);
+		query.setParameter("idIni", dr.getHisIdIni());
+		List<WfResponsavel> result = query.getResultList();
+		if (result == null || result.size() == 0)
+			return null;
+		return result;
 	}
 
-	public Set<Task> getTodasAsTarefas(String nomeProcessDefinition) {
-		Set<Task> result = new TreeSet<Task>(new Comparator<Task>() {
-
-			@Override
-			public int compare(Task t1, Task t2) {
-				return t1.getName().compareTo(t2.getName());
-			}
-
-		});
-
-		List<ProcessDefinition> lstPD = WfDao.getInstance()
-				.getTodasAsVersoesProcessDefinition(nomeProcessDefinition);
-		for (ProcessDefinition pd : lstPD) {
-			for (Object o : pd.getNodes()) {
-				if (o instanceof TaskNode) {
-					TaskNode t = (TaskNode) o;
-					result.addAll(t.getTasks());
-				}
-
-			}
-		}
+	public WfResponsavel consultarResponsavelPorOrgaoEDefinicaoDeResponsavel(CpOrgaoUsuario ou,
+			WfDefinicaoDeResponsavel dr) {
+		String sql = "from WfResponsavel o where o.orgaoUsuario.idOrgaoUsu = :idOrgaoUsu and o.definicaoDeResponsavel.hisIdIni = :idIni and o.hisDtFim is null";
+		javax.persistence.Query query = ContextoPersistencia.em().createQuery(sql);
+		query.setParameter("idOrgaoUsu", ou.getIdOrgaoUsu());
+		query.setParameter("idIni", dr.getHisIdIni());
+		WfResponsavel result = (WfResponsavel) query.getSingleResult();
 		return result;
 	}
-	
-	public static void iniciarTransacao() {
-		WfHibernateUtil.iniciarTransacao();
-	}
 
-	public static void commitTransacao() throws AplicacaoException {
-		WfHibernateUtil.commitTransacao();
+	public List<WfProcedimento> consultarProcedimentosParaEstatisticas(WfDefinicaoDeProcedimento pd, Date dataInicialDe,
+			Date dataInicialAte, Date dataFinalDe, Date dataFinalAte) {
+		String sql = "select p from WfProcedimento p inner join p.definicaoDeProcedimento pd where pd.hisIdIni = :hisIdIni and p.hisDtFim is not null "
+				+ " and p.hisDtIni >= :dataInicialDe and p.hisDtIni <= :dataInicialAte "
+				+ " and p.hisDtFim >= :dataFinalDe and p.hisDtFim <= :dataFinalAte";
+		javax.persistence.Query query = ContextoPersistencia.em().createQuery(sql);
+		query.setParameter("hisIdIni", pd.getHisIdIni());
+		query.setParameter("dataInicialDe", dataInicialDe);
+		query.setParameter("dataInicialAte", dataInicialAte);
+		query.setParameter("dataFinalDe", dataFinalDe);
+		query.setParameter("dataFinalAte", dataFinalAte);
+		List<WfProcedimento> result = query.getResultList();
+		return result;
 	}
 
-	public static void rollbackTransacao() {
-		WfHibernateUtil.rollbackTransacao();
+	public List<WfProcedimento> consultarProcedimentosParaEstatisticasPorPrincipal(WfDefinicaoDeProcedimento pd,
+			Date dataInicialDe, Date dataInicialAte, Date dataFinalDe, Date dataFinalAte) {
+		String sql = "select p from WfProcedimento p inner join p.definicaoDeProcedimento pd where pd.hisIdIni = :hisIdIni and p.hisDtFim is not null "
+				+ " and p.hisDtIni >= :dataInicialDe and p.hisDtIni <= :dataInicialAte "
+				+ " and p.hisDtFim >= :dataFinalDe and p.hisDtFim <= :dataFinalAte "
+				+ " and p.principal is not null and p.principal <> '' order by p.principal";
+		javax.persistence.Query query = ContextoPersistencia.em().createQuery(sql);
+		query.setParameter("hisIdIni", pd.getHisIdIni());
+		query.setParameter("dataInicialDe", dataInicialDe);
+		query.setParameter("dataInicialAte", dataInicialAte);
+		query.setParameter("dataFinalDe", dataFinalDe);
+		query.setParameter("dataFinalAte", dataFinalAte);
+		List<WfProcedimento> result = query.getResultList();
+		return result;
 	}
 
+	public List<WfProcedimento> consultarProcedimentosParaEstatisticasPorPrincipalInclusiveNaoFinalizados(
+			WfDefinicaoDeProcedimento pd, Date dataInicialDe, Date dataInicialAte, Date dataFinalDe,
+			Date dataFinalAte) {
+		String sql = "select p from WfProcedimento p inner join p.definicaoDeProcedimento pd where pd.hisIdIni = :hisIdIni "
+				+ " and p.hisDtIni >= :dataInicialDe and p.hisDtIni <= :dataInicialAte "
+				+ " and ((p.hisDtFim >= :dataFinalDe and p.hisDtFim <= :dataFinalAte) or p.hisDtFim is null) "
+				+ " and p.principal is not null and p.principal <> '' order by p.principal";
+		javax.persistence.Query query = ContextoPersistencia.em().createQuery(sql);
+		query.setParameter("hisIdIni", pd.getHisIdIni());
+		query.setParameter("dataInicialDe", dataInicialDe);
+		query.setParameter("dataInicialAte", dataInicialAte);
+		query.setParameter("dataFinalDe", dataFinalDe);
+		query.setParameter("dataFinalAte", dataFinalAte);
+		List<WfProcedimento> result = query.getResultList();
+		return result;
+	}
 
+	public <T> T consultarPorSigla(String sigla, Class<T> clazz) {
+		String acronimo = null;
+		if (clazz.isAssignableFrom(WfProcedimento.class)) {
+			acronimo = "WF";
+		} else if (clazz.isAssignableFrom(WfDefinicaoDeProcedimento.class)) {
+			acronimo = "DP";
+		} else {
+			throw new RuntimeException("Não é permitido consultar por sigla registros da classe " + clazz.getName());
+		}
+		SiglaDecodificada d = SiglaUtils.parse(sigla, acronimo, null);
+		Integer ano = d.ano;
+		Integer numero = d.numero;
+		CpOrgaoUsuario orgaoUsuario = d.orgaoUsuario;
+
+		final CriteriaBuilder criteriaBuilder = em().getCriteriaBuilder();
+		CriteriaQuery<T> q = criteriaBuilder.createQuery(clazz);
+		Root<T> c = q.from(clazz);
+		Join<T, CpOrgaoUsuario> joinOrgao = c.join("orgaoUsuario", JoinType.INNER);
+		q.where(cb().equal(c.get("numero"), numero), cb().equal(c.get("ano"), ano), cb().equal(c.get("hisAtivo"), 1),
+				cb().equal(joinOrgao.get("idOrgaoUsu"), orgaoUsuario.getId()));
+		return em().createQuery(q).getSingleResult();
+	}
 
-}
+}
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfStarter.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfStarter.java
new file mode 100644
index 0000000000..9760ed14f9
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfStarter.java
@@ -0,0 +1,26 @@
+package br.gov.jfrj.siga.wf.dao;
+
+import javax.annotation.PostConstruct;
+import javax.ejb.Singleton;
+import javax.ejb.Startup;
+import javax.ejb.TransactionManagement;
+import javax.ejb.TransactionManagementType;
+import javax.naming.NamingException;
+import javax.persistence.EntityManagerFactory;
+import javax.persistence.Persistence;
+
+import br.gov.jfrj.siga.cp.util.SigaFlyway;
+
+@Startup
+@Singleton
+@TransactionManagement(value = TransactionManagementType.BEAN)
+public class WfStarter {
+
+	public static EntityManagerFactory emf;
+
+	@PostConstruct
+	public void init() throws NamingException {
+		SigaFlyway.migrate("java:/jboss/datasources/SigaWfDS", "classpath:db/mysql/sigawf");
+		emf = Persistence.createEntityManagerFactory("default");
+	}
+}
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfThreadFilter.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfThreadFilter.java
new file mode 100644
index 0000000000..88a8a8b2d1
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/dao/WfThreadFilter.java
@@ -0,0 +1,81 @@
+/*******************************************************************************
+ * Copyright (c) 2006 - 2011 SJRJ.
+ * 
+ *     This file is part of SIGA.
+ * 
+ *     SIGA is free software: you can redistribute it and/or modify
+ *     it under the terms of the GNU General Public License as published by
+ *     the Free Software Foundation, either version 3 of the License, or
+ *     (at your option) any later version.
+ * 
+ *     SIGA is distributed in the hope that it will be useful,
+ *     but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *     GNU General Public License for more details.
+ * 
+ *     You should have received a copy of the GNU General Public License
+ *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
+ ******************************************************************************/
+package br.gov.jfrj.siga.wf.dao;
+
+import java.io.IOException;
+
+import javax.persistence.EntityManager;
+import javax.servlet.Filter;
+import javax.servlet.FilterChain;
+import javax.servlet.FilterConfig;
+import javax.servlet.ServletException;
+import javax.servlet.ServletRequest;
+import javax.servlet.ServletResponse;
+
+import br.gov.jfrj.siga.model.ContextoPersistencia;
+import br.gov.jfrj.siga.model.dao.ModeloDao;
+import br.gov.jfrj.siga.wf.bl.Wf;
+
+public class WfThreadFilter implements Filter {
+
+	private FilterConfig config;
+
+	@Override
+	public void init(FilterConfig config) {
+		this.config = config;
+	}
+
+	public void doFilter(final ServletRequest request, final ServletResponse response, final FilterChain chain)
+			throws IOException, ServletException {
+
+		EntityManager em = WfStarter.emf.createEntityManager();
+		ContextoPersistencia.setEntityManager(em);
+
+		// Inicialização padronizada
+//		CurrentRequest.set(new RequestInfo(config.getServletContext(), (HttpServletRequest) request,
+//				(HttpServletResponse) response));
+
+		ModeloDao.freeInstance();
+		WfDao.getInstance();
+		try {
+			Wf.getInstance().getConf().limparCacheSeNecessario();
+		} catch (Exception e1) {
+			throw new RuntimeException("Não foi possível atualizar o cache de configurações", e1);
+		}
+
+		em.getTransaction().begin();
+
+		try {
+			chain.doFilter(request, response);
+			em.getTransaction().commit();
+		} catch (Exception e) {
+			if (em.getTransaction().isActive())
+				em.getTransaction().rollback();
+
+			throw new ServletException(e);
+		} finally {
+			em.close();
+			ContextoPersistencia.setEntityManager(null);
+		}
+	}
+
+	@Override
+	public void destroy() {
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/PodeSim.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/PodeSim.java
new file mode 100644
index 0000000000..47ef072357
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/PodeSim.java
@@ -0,0 +1,16 @@
+package br.gov.jfrj.siga.wf.logic;
+
+import com.crivano.jlogic.Expression;
+import com.crivano.jlogic.JLogic;
+
+public class PodeSim implements Expression {
+	@Override
+	public boolean eval() {
+		return true;
+	}
+
+	@Override
+	public String explain(boolean result) {
+		return JLogic.explain("sempre pode", result);
+	}
+};
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfEstaPessoalmenteResponsavel.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfEstaPessoalmenteResponsavel.java
new file mode 100644
index 0000000000..fbf5803786
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfEstaPessoalmenteResponsavel.java
@@ -0,0 +1,31 @@
+package br.gov.jfrj.siga.wf.logic;
+
+import com.crivano.jlogic.Expression;
+import com.crivano.jlogic.JLogic;
+
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+
+public class WfEstaPessoalmenteResponsavel implements Expression {
+
+	private WfProcedimento pi;
+	private DpPessoa titular;
+
+	public WfEstaPessoalmenteResponsavel(WfProcedimento pi, DpPessoa titular) {
+		this.pi = pi;
+		this.titular = titular;
+	}
+
+	@Override
+	public boolean eval() {
+		if (titular != null && titular.equivale(pi.getEventoPessoa()))
+			return true;
+		return false;
+	}
+
+	@Override
+	public String explain(boolean result) {
+		return JLogic.explain("pessoalmente responsável", result);
+	}
+};
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfEstaResponsavel.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfEstaResponsavel.java
new file mode 100644
index 0000000000..908555e232
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfEstaResponsavel.java
@@ -0,0 +1,37 @@
+package br.gov.jfrj.siga.wf.logic;
+
+import com.crivano.jlogic.Expression;
+import com.crivano.jlogic.JLogic;
+
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+
+public class WfEstaResponsavel implements Expression {
+
+	private WfProcedimento pi;
+	private DpPessoa titular;
+	private DpLotacao lotaTitular;
+
+	public WfEstaResponsavel(WfProcedimento pi, DpPessoa titular, DpLotacao lotaTitular) {
+		this.pi = pi;
+		this.titular = titular;
+		this.lotaTitular = lotaTitular;
+	}
+
+	@Override
+	public boolean eval() {
+		if (titular != null && titular.equivale(pi.getEventoPessoa()))
+			return true;
+		if (titular != null && titular.getLotacao().equivale(pi.getEventoLotacao()))
+			return true;
+		if (lotaTitular != null && lotaTitular.equivale(pi.getEventoLotacao()))
+			return true;
+		return false;
+	}
+
+	@Override
+	public String explain(boolean result) {
+		return JLogic.explain("responsável", result);
+	}
+};
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfPodePegar.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfPodePegar.java
new file mode 100644
index 0000000000..e31c218013
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/logic/WfPodePegar.java
@@ -0,0 +1,29 @@
+package br.gov.jfrj.siga.wf.logic;
+
+import com.crivano.jlogic.And;
+import com.crivano.jlogic.CompositeExpressionSuport;
+import com.crivano.jlogic.Expression;
+import com.crivano.jlogic.Not;
+
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+
+public class WfPodePegar extends CompositeExpressionSuport {
+
+	private WfProcedimento pi;
+	private DpPessoa titular;
+	private DpLotacao lotaTitular;
+
+	public WfPodePegar(WfProcedimento pi, DpPessoa titular, DpLotacao lotaTitular) {
+		this.pi = pi;
+		this.titular = titular;
+		this.lotaTitular = lotaTitular;
+	}
+
+	@Override
+	protected Expression create() {
+		return And.of(new WfEstaResponsavel(pi, titular, lotaTitular),
+				Not.of(new WfEstaPessoalmenteResponsavel(pi, titular)));
+	}
+};
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/WfConfiguracao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfConfiguracao.java
similarity index 98%
rename from siga-wf/src/main/java/br/gov/jfrj/siga/wf/WfConfiguracao.java
rename to siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfConfiguracao.java
index e55d669de4..449c724cc9 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/WfConfiguracao.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfConfiguracao.java
@@ -16,7 +16,7 @@
  *     You should have received a copy of the GNU General Public License
  *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
  ******************************************************************************/
-package br.gov.jfrj.siga.wf;
+package br.gov.jfrj.siga.wf.model;
 
 import br.gov.jfrj.siga.cp.CpConfiguracao;
 import br.gov.jfrj.siga.dp.DpCargo;
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/WfConhecimento.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfConhecimento.java
similarity index 98%
rename from siga-wf/src/main/java/br/gov/jfrj/siga/wf/WfConhecimento.java
rename to siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfConhecimento.java
index 991ddbebe2..e6787968ea 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/WfConhecimento.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfConhecimento.java
@@ -16,7 +16,7 @@
  *     You should have received a copy of the GNU General Public License
  *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
  ******************************************************************************/
-package br.gov.jfrj.siga.wf;
+package br.gov.jfrj.siga.wf.model;
 
 import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
 import br.gov.jfrj.siga.model.Assemelhavel;
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeDesvio.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeDesvio.java
new file mode 100644
index 0000000000..2af3fb83ee
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeDesvio.java
@@ -0,0 +1,345 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.Date;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Set;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.PostLoad;
+import javax.persistence.Table;
+import javax.persistence.Transient;
+
+import org.hibernate.annotations.BatchSize;
+
+import com.crivano.jflow.PausableTask;
+import com.crivano.jflow.model.TaskDefinitionDetour;
+
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
+import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
+import br.gov.jfrj.siga.sinc.lib.NaoRecursivo;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
+import br.gov.jfrj.siga.wf.util.NaoSerializar;
+import br.gov.jfrj.siga.wf.util.WfResp;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_def_desvio")
+public class WfDefinicaoDeDesvio extends HistoricoAuditavelSuporte
+		implements TaskDefinitionDetour, Sincronizavel, Comparable<Sincronizavel> {
+	@Id
+	@GeneratedValue
+	@Column(name = "DEFD_ID", unique = true, nullable = false)
+	@Desconsiderar
+	private java.lang.Long id;
+
+	@Column(name = "DEFD_NM", length = 256)
+	private java.lang.String nome;
+
+	@Column(name = "DEFD_TX_CONDICAO", length = 256)
+	private java.lang.String condicao;
+
+	@Column(name = "DEFD_NR_ORDEM")
+	private int ordem;
+
+	@NaoSerializar
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFT_ID")
+	private WfDefinicaoDeTarefa definicaoDeTarefa;
+
+	@NaoSerializar
+	@NaoRecursivo
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFT_ID_SEGUINTE")
+	private WfDefinicaoDeTarefa seguinte;
+
+	@Transient
+	private String seguinteIde;
+
+	@Column(name = "DEFD_FG_ULTIMO")
+	private boolean ultimo;
+
+	//
+	// Solução para não precisar criar HIS_ATIVO em todas as tabelas que herdam
+	// de HistoricoSuporte.
+	//
+	@Column(name = "HIS_ATIVO")
+	private Integer hisAtivo;
+
+	@Override
+	public Integer getHisAtivo() {
+		this.hisAtivo = super.getHisAtivo();
+		return this.hisAtivo;
+	}
+
+	@Override
+	public void setHisAtivo(Integer hisAtivo) {
+		super.setHisAtivo(hisAtivo);
+		this.hisAtivo = getHisAtivo();
+	}
+
+	@Override
+	public String getTitle() {
+		return nome;
+	}
+
+	@Override
+	public String getTaskIdentifier() {
+		if (isUltimo())
+			return "finish";
+		if (seguinte == null)
+			return null;
+		return seguinte.getIdentifier();
+	}
+
+	@Override
+	public String getCondition() {
+		return condicao;
+	}
+
+	public java.lang.Long getId() {
+		return id;
+	}
+
+	public void setId(java.lang.Long id) {
+		this.id = id;
+	}
+
+	public java.lang.String getNome() {
+		return nome;
+	}
+
+	public void setNome(java.lang.String nome) {
+		this.nome = nome;
+	}
+
+	public java.lang.String getCondicao() {
+		return condicao;
+	}
+
+	public void setCondicao(java.lang.String condicao) {
+		this.condicao = condicao;
+	}
+
+	public int getOrdem() {
+		return ordem;
+	}
+
+	public void setOrdem(int ordem) {
+		this.ordem = ordem;
+	}
+
+	public WfDefinicaoDeTarefa getDefinicaoDeTarefa() {
+		return definicaoDeTarefa;
+	}
+
+	public void setDefinicaoDeTarefa(WfDefinicaoDeTarefa definicaoDeTarefa) {
+		this.definicaoDeTarefa = definicaoDeTarefa;
+	}
+
+	public WfDefinicaoDeTarefa getSeguinte() {
+		return seguinte;
+	}
+
+	public void setSeguinte(WfDefinicaoDeTarefa seguinte) {
+		this.seguinte = seguinte;
+	}
+
+	public boolean isUltimo() {
+		return ultimo;
+	}
+
+	public void setUltimo(boolean ultimo) {
+		this.ultimo = ultimo;
+	}
+
+	public String getSeguinteIde() {
+		return seguinteIde;
+	}
+
+	public void setSeguinteIde(String seguinteIde) {
+		this.seguinteIde = seguinteIde;
+	}
+
+	@Override
+	public String getIdExterna() {
+		return this.getDefinicaoDeTarefa().getIdExterna() + "|" + getNome();
+	}
+
+	@Override
+	public void setIdExterna(String idExterna) {
+	}
+
+	@Override
+	public void setIdInicial(Long idInicial) {
+		this.setHisIdIni(idInicial);
+	}
+
+	@Override
+	public Date getDataInicio() {
+		return getHisDtIni();
+	}
+
+	@Override
+	public void setDataInicio(Date dataInicio) {
+		setHisDtIni(dataInicio);
+	}
+
+	@Override
+	public Date getDataFim() {
+		return getHisDtFim();
+	}
+
+	@Override
+	public void setDataFim(Date dataFim) {
+		setHisDtFim(dataFim);
+	}
+
+	@Override
+	public String getLoteDeImportacao() {
+		return null;
+	}
+
+	@Override
+	public void setLoteDeImportacao(String loteDeImportacao) {
+	}
+
+	@Override
+	public int getNivelDeDependencia() {
+		return SincronizavelSuporte.getNivelDeDependencia(this);
+	}
+
+	@Override
+	public String getDescricaoExterna() {
+		return getNome();
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return SincronizavelSuporte.semelhante(this, obj, profundidade);
+	}
+
+	@Override
+	public int compareTo(Sincronizavel o) {
+		if (!this.getClass().equals(o.getClass()))
+			return this.getClass().getName().compareTo(o.getClass().getName());
+		return this.getIdExterna().compareTo(o.getIdExterna());
+	}
+
+	@PostLoad
+	public void postLoad() {
+		if (this.getSeguinte() != null)
+			this.setSeguinteIde(Long.toString(this.getSeguinte().getIdInicial()));
+	}
+
+	public String getIcon() {
+		if (ultimo)
+			return "stop";
+		if (isYes())
+			return "accept";
+		if (isNo())
+			return "cancel";
+		return "bullet_go";
+	}
+
+	public boolean isYes() {
+		return nome.equalsIgnoreCase("sim");
+	}
+
+	public boolean isNo() {
+		return nome.equalsIgnoreCase("não") || nome.equalsIgnoreCase("nao");
+	}
+
+	private static class ProximaTarefa {
+		public WfDefinicaoDeTarefa tdProxima;
+		public boolean ultimo;
+	}
+
+	public ProximaTarefa localizarProximaTarefaPausavel() {
+		WfDefinicaoDeTarefa tdProxima = getSeguinte();
+		boolean ultimo = isUltimo();
+		if (tdProxima == null && !ultimo)
+			tdProxima = obterSeguinte(getDefinicaoDeTarefa());
+		Set<WfDefinicaoDeTarefa> set = new HashSet<>();
+
+		while (tdProxima != null) {
+			if (set.contains(tdProxima))
+				throw new RuntimeException("Caminho circular encontrado ao calcular próxima tarefa pausável");
+			else
+				set.add(tdProxima);
+
+			if (PausableTask.class.isAssignableFrom(tdProxima.getTipoDeTarefa().getClazz()))
+				break;
+
+			WfDefinicaoDeDesvio desvio = null;
+			if (tdProxima.getDefinicaoDeDesvio() != null && tdProxima.getDefinicaoDeDesvio().size() == 1)
+				desvio = tdProxima.getDefinicaoDeDesvio().get(0);
+
+			// A proxima tarefa está indicada
+			if (tdProxima.getSeguinte() != null) {
+				tdProxima = tdProxima.getSeguinte();
+				continue;
+			}
+
+			// Existe um único desvio e ele aponta para uma próxima tarefa
+			else if (desvio != null && desvio.getSeguinte() != null) {
+				tdProxima = desvio.getSeguinte();
+				continue;
+			}
+
+			// Existe mais de um desvio e não poderemos inferir a próxima tarefa pausável
+			else if (tdProxima.getDefinicaoDeDesvio() != null && tdProxima.getDefinicaoDeDesvio().size() > 1) {
+				tdProxima = null;
+				break;
+			}
+
+			// Depois dessa tarefa vai terminar
+			else if (tdProxima.isUltimo()
+					|| tdProxima.getDefinicaoDeProcedimento().getDefinicaoDeTarefa().size() == tdProxima.getOrdem() + 1
+					|| (desvio != null && desvio.isUltimo())) {
+				ultimo = true;
+				tdProxima = null;
+				break;
+			}
+
+			// Ou vai para a tarefa seguinte
+			else {
+				tdProxima = obterSeguinte(tdProxima);
+			}
+		}
+		ProximaTarefa p = new ProximaTarefa();
+		p.tdProxima = tdProxima;
+		p.ultimo = ultimo;
+		return p;
+	}
+
+	private WfDefinicaoDeTarefa obterSeguinte(WfDefinicaoDeTarefa tdProxima) {
+		List<WfDefinicaoDeTarefa> definicoesDeTarefas = getDefinicaoDeTarefa().getDefinicaoDeProcedimento()
+				.getDefinicaoDeTarefa();
+		int indice = tdProxima.getOrdem();
+		if (definicoesDeTarefas.size() > indice + 1)
+			return definicoesDeTarefas.get(indice + 1);
+		return null;
+	}
+
+	public String obterProximoResponsavel(WfProcedimento pi) {
+		ProximaTarefa pt = localizarProximaTarefaPausavel();
+		if (pt.ultimo)
+			return "FIM";
+		else if (pt.tdProxima != null) {
+			WfResp r = (WfResp) pi.calcResponsible(pt.tdProxima);
+			if (r != null)
+				return r.getInitials();
+		}
+		return null;
+	}
+
+}
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeProcedimento.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeProcedimento.java
new file mode 100644
index 0000000000..d171419cd5
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeProcedimento.java
@@ -0,0 +1,311 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.io.Serializable;
+import java.util.ArrayList;
+import java.util.Calendar;
+import java.util.Date;
+import java.util.List;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.OneToMany;
+import javax.persistence.OrderBy;
+import javax.persistence.PrePersist;
+import javax.persistence.Query;
+import javax.persistence.Table;
+import javax.persistence.Transient;
+import javax.validation.constraints.NotNull;
+
+import org.hibernate.annotations.BatchSize;
+
+import com.crivano.jflow.model.ProcessDefinition;
+
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
+import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
+import br.gov.jfrj.siga.model.ActiveRecord;
+import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.model.Selecionavel;
+import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.util.SiglaUtils;
+import br.gov.jfrj.siga.wf.util.SiglaUtils.SiglaDecodificada;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_def_procedimento")
+public class WfDefinicaoDeProcedimento extends HistoricoAuditavelSuporte implements Serializable,
+		ProcessDefinition<WfDefinicaoDeTarefa>, Selecionavel, Sincronizavel, Comparable<Sincronizavel> {
+	public static ActiveRecord<WfDefinicaoDeProcedimento> AR = new ActiveRecord<>(WfDefinicaoDeProcedimento.class);
+
+	@Id
+	@GeneratedValue
+	@Column(name = "DEFP_ID", unique = true, nullable = false)
+	@Desconsiderar
+	private java.lang.Long id;
+
+	@NotNull
+	@Column(name = "DEFP_NM", length = 256)
+	private java.lang.String nome;
+
+	@NotNull
+	@Column(name = "DEFP_DS", length = 256)
+	private java.lang.String descr;
+
+	@OneToMany(fetch = FetchType.LAZY, mappedBy = "definicaoDeProcedimento")
+	@OrderBy("ordem ASC")
+	@Desconsiderar
+	private List<WfDefinicaoDeTarefa> definicaoDeTarefa = new ArrayList<>();
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "ORGU_ID")
+	private CpOrgaoUsuario orgaoUsuario;
+
+	@Column(name = "DEFP_ANO")
+	private Integer ano;
+
+	@Column(name = "DEFP_NR")
+	private Integer numero;
+
+	@Transient
+	private java.lang.String hisIde;
+
+	//
+	// Solução para não precisar criar HIS_ATIVO em todas as tabelas que herdam
+	// de HistoricoSuporte.
+	//
+	@Column(name = "HIS_ATIVO")
+	private Integer hisAtivo;
+
+	@Override
+	public Integer getHisAtivo() {
+		this.hisAtivo = super.getHisAtivo();
+		return this.hisAtivo;
+	}
+
+	@Override
+	public void setHisAtivo(Integer hisAtivo) {
+		super.setHisAtivo(hisAtivo);
+		this.hisAtivo = getHisAtivo();
+	}
+
+	@Override
+	public List<WfDefinicaoDeTarefa> getTaskDefinition() {
+		return getDefinicaoDeTarefa();
+	}
+
+	@Override
+	public Long getId() {
+		return id;
+	}
+
+	@Override
+	public void setId(Long id) {
+		this.id = id;
+	}
+
+	public java.lang.String getNome() {
+		return nome;
+	}
+
+	public void setNome(java.lang.String nome) {
+		this.nome = nome;
+	}
+
+	@Override
+	public String getDescricao() {
+		return nome;
+	}
+
+	public List<WfDefinicaoDeTarefa> getDefinicaoDeTarefa() {
+		return definicaoDeTarefa;
+	}
+
+	public void setDefinicaoDeTarefa(List<WfDefinicaoDeTarefa> definicaoDeTarefa) {
+		this.definicaoDeTarefa = definicaoDeTarefa;
+	}
+
+	public java.lang.String getHisIde() {
+		return hisIde;
+	}
+
+	public void setHisIde(java.lang.String hisIde) {
+		this.hisIde = hisIde;
+	}
+
+	@Override
+	public String getIdExterna() {
+		return getHisIde() != null ? getHisIde() : "nova definição de procedimento";
+	}
+
+	@Override
+	public void setIdExterna(String idExterna) {
+		setHisIde(idExterna);
+	}
+
+	@Override
+	public void setIdInicial(Long idInicial) {
+		this.setHisIdIni(idInicial);
+	}
+
+	@Override
+	public Date getDataInicio() {
+		return getHisDtIni();
+	}
+
+	@Override
+	public void setDataInicio(Date dataInicio) {
+		setHisDtIni(dataInicio);
+	}
+
+	@Override
+	public Date getDataFim() {
+		return getHisDtFim();
+	}
+
+	@Override
+	public void setDataFim(Date dataFim) {
+		setHisDtFim(dataFim);
+	}
+
+	@Override
+	public String getLoteDeImportacao() {
+		return null;
+	}
+
+	@Override
+	public void setLoteDeImportacao(String loteDeImportacao) {
+	}
+
+	@Override
+	public int getNivelDeDependencia() {
+		return 0;
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return SincronizavelSuporte.semelhante(this, obj, profundidade);
+	}
+
+	@Override
+	public String getDescricaoExterna() {
+		return getNome();
+	}
+
+	@Override
+	public int compareTo(Sincronizavel o) {
+		if (!this.getClass().equals(o.getClass()))
+			return this.getClass().getName().compareTo(o.getClass().getName());
+		return this.getIdExterna().compareTo(o.getIdExterna());
+	}
+
+	public java.lang.String getDescr() {
+		return descr;
+	}
+
+	public void setDescr(java.lang.String descr) {
+		this.descr = descr;
+	}
+
+	public CpOrgaoUsuario getOrgaoUsuario() {
+		return orgaoUsuario;
+	}
+
+	public void setOrgaoUsuario(CpOrgaoUsuario orgaoUsuario) {
+		this.orgaoUsuario = orgaoUsuario;
+	}
+
+	public Integer getAno() {
+		return ano;
+	}
+
+	public void setAno(Integer ano) {
+		this.ano = ano;
+	}
+
+	public Integer getNumero() {
+		return numero;
+	}
+
+	public void setNumero(Integer numero) {
+		this.numero = numero;
+	}
+
+	public String getSigla() {
+		return orgaoUsuario.getAcronimoOrgaoUsu() + "-DP-" + ano + "/" + Utils.completarComZeros(numero, 5);
+	}
+
+	public String getSiglaCompacta() {
+		return getSigla().replace("-", "").replace("/", "");
+	}
+
+	public static WfDefinicaoDeProcedimento findBySigla(String sigla) throws NumberFormatException, Exception {
+		return findBySigla(sigla, null);
+	}
+
+	public static WfDefinicaoDeProcedimento findBySigla(String sigla, CpOrgaoUsuario ouDefault)
+			throws NumberFormatException, Exception {
+		SiglaDecodificada d = SiglaUtils.parse(sigla, "DP", null);
+
+		WfDefinicaoDeProcedimento info = null;
+
+		if (d.id != null) {
+			info = AR.findById(d.id);
+		} else if (d.numero != null) {
+			info = AR.find("ano = ?1 and numero = ?2 and ou.idOrgaoUsu = ?3", d.ano, d.numero, d.orgaoUsuario.getId())
+					.first();
+		}
+
+		if (info == null) {
+			throw new AplicacaoException("Não foi possível encontrar uma definição de procedimento com o código "
+					+ sigla + ". Favor verificá-lo.");
+		} else
+			return info;
+	}
+
+	public static WfDefinicaoDeProcedimento findByNome(String titulo) throws Exception {
+		try {
+			String[] palavras = titulo.toUpperCase().split(" ");
+			StringBuilder query = new StringBuilder("hisDtFim is null");
+			for (String palavra : palavras) {
+				query.append(" and upper(nome) like '%");
+				query.append(palavra);
+				query.append("%' ");
+			}
+			List<WfDefinicaoDeProcedimento> results = AR.find(query.toString()).fetch();
+			return results.size() == 1 ? results.get(0) : null;
+		} catch (Exception e) {
+			return null;
+		}
+	}
+
+	@PrePersist
+	private void onPersist() {
+		if (getAno() != null)
+			return;
+		setAno(WfDao.getInstance().dt().getYear() + 1900);
+		Query qry = em().createQuery(
+				"select max(numero) from WfDefinicaoDeProcedimento pi where ano = :ano and orgaoUsuario.idOrgaoUsu = :ouid");
+		qry.setParameter("ano", getAno());
+		qry.setParameter("ouid", getOrgaoUsuario().getId());
+		Integer i = (Integer) qry.getSingleResult();
+		setNumero((i == null ? 0 : i) + 1);
+	}
+
+	@Override
+	public void setSigla(String sigla) {
+		SiglaDecodificada d = SiglaUtils.parse(sigla, "DP", null);
+		this.ano = d.ano;
+		this.numero = d.numero;
+		this.orgaoUsuario = d.orgaoUsuario;
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeResponsavel.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeResponsavel.java
new file mode 100644
index 0000000000..859da19f45
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeResponsavel.java
@@ -0,0 +1,93 @@
+package br.gov.jfrj.siga.wf.model;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.EnumType;
+import javax.persistence.Enumerated;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.Table;
+
+import org.hibernate.annotations.BatchSize;
+
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
+import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
+import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeResponsavel;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_def_responsavel")
+public class WfDefinicaoDeResponsavel extends HistoricoAuditavelSuporte {
+	@Id
+	@GeneratedValue
+	@Column(name = "DEFR_ID", unique = true, nullable = false)
+	@Desconsiderar
+	private Long id;
+
+	@Column(name = "DEFR_NM", length = 256)
+	private String nome;
+
+	@Column(name = "DEFR_DS", length = 256)
+	private String descr;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "DEFR_TP")
+	WfTipoDeResponsavel tipo;
+
+	// Solução para não precisar criar HIS_ATIVO em todas as tabelas que herdam
+	// de HistoricoSuporte.
+	//
+	@Desconsiderar
+	@Column(name = "HIS_ATIVO")
+	private Integer hisAtivo;
+
+	@Override
+	public Integer getHisAtivo() {
+		this.hisAtivo = super.getHisAtivo();
+		return this.hisAtivo;
+	}
+
+	@Override
+	public void setHisAtivo(Integer hisAtivo) {
+		this.hisAtivo = hisAtivo;
+	}
+
+	public Long getId() {
+		return id;
+	}
+
+	public void setId(Long id) {
+		this.id = id;
+	}
+
+	public String getNome() {
+		return nome;
+	}
+
+	public void setNome(String nome) {
+		this.nome = nome;
+	}
+
+	public String getDescr() {
+		return descr;
+	}
+
+	public void setDescr(String descr) {
+		this.descr = descr;
+	}
+
+	public WfTipoDeResponsavel getTipo() {
+		return tipo;
+	}
+
+	public void setTipo(WfTipoDeResponsavel tipo) {
+		this.tipo = tipo;
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return SincronizavelSuporte.semelhante(this, obj, profundidade);
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeTarefa.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeTarefa.java
new file mode 100644
index 0000000000..0332787bbb
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeTarefa.java
@@ -0,0 +1,456 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.List;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.EnumType;
+import javax.persistence.Enumerated;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.OneToMany;
+import javax.persistence.OrderBy;
+import javax.persistence.PostLoad;
+import javax.persistence.Table;
+import javax.persistence.Transient;
+
+import org.hibernate.annotations.BatchSize;
+
+import com.crivano.jflow.model.TaskDefinition;
+
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
+import br.gov.jfrj.siga.sinc.lib.NaoRecursivo;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeTarefa;
+import br.gov.jfrj.siga.wf.util.NaoSerializar;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_def_tarefa")
+public class WfDefinicaoDeTarefa extends HistoricoAuditavelSuporte
+		implements TaskDefinition<WfTipoDeTarefa, WfTipoDeResponsavel, WfDefinicaoDeVariavel, WfDefinicaoDeDesvio>,
+		Sincronizavel, Comparable<Sincronizavel> {
+	@Id
+	@GeneratedValue
+	@Column(name = "DEFT_ID", unique = true, nullable = false)
+	@Desconsiderar
+	private java.lang.Long id;
+
+	@Column(name = "DEFT_NM", length = 256)
+	private java.lang.String nome;
+
+	@Column(name = "DEFT_TX_ASSUNTO", length = 256)
+	private java.lang.String assunto;
+
+	@Column(name = "DEFT_TX_CONTEUDO", length = 2048)
+	private java.lang.String conteudo;
+
+	@NaoSerializar
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFP_ID")
+	private WfDefinicaoDeProcedimento definicaoDeProcedimento;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "DEFT_TP_TAREFA")
+	private WfTipoDeTarefa tipoDeTarefa;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "DEFT_TP_RESPONSAVEL")
+	private WfTipoDeResponsavel tipoDeResponsavel;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFR_ID")
+	private WfDefinicaoDeResponsavel definicaoDeResponsavel;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PESS_ID")
+	private DpPessoa pessoa;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "LOTA_ID")
+	private DpLotacao lotacao;
+
+	@NaoSerializar
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFT_ID_SEGUINTE")
+	private WfDefinicaoDeTarefa seguinte;
+
+	@Transient
+	private String seguinteIde;
+
+	@Transient
+	private Long pessoaId;
+
+	@Transient
+	private Long lotacaoId;
+
+	@Transient
+	private Long definicaoDeResponsavelId;
+
+	@Column(name = "DEFT_FG_ULTIMO")
+	private boolean ultimo;
+
+	@Column(name = "DEFT_NR_ORDEM")
+	private int ordem;
+
+	@OneToMany(fetch = FetchType.LAZY, mappedBy = "definicaoDeTarefa")
+	@OrderBy("ordem ASC")
+	@Desconsiderar
+	private List<WfDefinicaoDeVariavel> definicaoDeVariavel = new ArrayList<>();
+
+	@OneToMany(fetch = FetchType.LAZY, mappedBy = "definicaoDeTarefa")
+	@OrderBy("ordem ASC")
+	@Desconsiderar
+	private List<WfDefinicaoDeDesvio> definicaoDeDesvio = new ArrayList<>();
+
+	@Column(name = "DEFT_ID_REF")
+	private java.lang.Long refId;
+
+	@Column(name = "DEFT_SG_REF", length = 32)
+	private java.lang.String refSigla;
+
+	@Column(name = "DEFT_DS_REF", length = 256)
+	private java.lang.String refDescr;
+
+	@Transient
+	private java.lang.String hisIde;
+
+	//
+	// Solução para não precisar criar HIS_ATIVO em todas as tabelas que herdam de
+	// HistoricoSuporte.
+	//
+	@Column(name = "HIS_ATIVO")
+	private Integer hisAtivo;
+
+	@Override
+	public Integer getHisAtivo() {
+		this.hisAtivo = super.getHisAtivo();
+		return this.hisAtivo;
+	}
+
+	@Override
+	public void setHisAtivo(Integer hisAtivo) {
+		super.setHisAtivo(hisAtivo);
+		this.hisAtivo = getHisAtivo();
+	}
+
+	public java.lang.Long getId() {
+		return id;
+	}
+
+	public void setId(java.lang.Long id) {
+		this.id = id;
+	}
+
+	public java.lang.String getNome() {
+		return nome;
+	}
+
+	public void setNome(java.lang.String nome) {
+		this.nome = nome;
+	}
+
+	public java.lang.String getAssunto() {
+		return assunto;
+	}
+
+	public void setAssunto(java.lang.String assunto) {
+		this.assunto = assunto;
+	}
+
+	public java.lang.String getConteudo() {
+		return conteudo;
+	}
+
+	public void setConteudo(java.lang.String conteudo) {
+		this.conteudo = conteudo;
+	}
+
+	public WfDefinicaoDeProcedimento getDefinicaoDeProcedimento() {
+		return definicaoDeProcedimento;
+	}
+
+	public void setDefinicaoDeProcedimento(WfDefinicaoDeProcedimento definicaoDeProcedimento) {
+		this.definicaoDeProcedimento = definicaoDeProcedimento;
+	}
+
+	public WfTipoDeTarefa getTipoDeTarefa() {
+		return tipoDeTarefa;
+	}
+
+	public void setTipoDeTarefa(WfTipoDeTarefa tipoDeTarefa) {
+		this.tipoDeTarefa = tipoDeTarefa;
+	}
+
+	public WfTipoDeResponsavel getTipoDeResponsavel() {
+		return tipoDeResponsavel;
+	}
+
+	public void setTipoDeResponsavel(WfTipoDeResponsavel tipoDeResponsavel) {
+		this.tipoDeResponsavel = tipoDeResponsavel;
+	}
+
+	public WfDefinicaoDeTarefa getSeguinte() {
+		return seguinte;
+	}
+
+	public void setSeguinte(WfDefinicaoDeTarefa seguinte) {
+		this.seguinte = seguinte;
+	}
+
+	public boolean isUltimo() {
+		return ultimo;
+	}
+
+	public void setUltimo(boolean ultimo) {
+		this.ultimo = ultimo;
+	}
+
+	public int getOrdem() {
+		return ordem;
+	}
+
+	public void setOrdem(int ordem) {
+		this.ordem = ordem;
+	}
+
+	public List<WfDefinicaoDeVariavel> getDefinicaoDeVariavel() {
+		return definicaoDeVariavel;
+	}
+
+	public void setDefinicaoDeVariavel(List<WfDefinicaoDeVariavel> definicaoDeVariavel) {
+		this.definicaoDeVariavel = definicaoDeVariavel;
+	}
+
+	public List<WfDefinicaoDeDesvio> getDefinicaoDeDesvio() {
+		return definicaoDeDesvio;
+	}
+
+	public void setDefinicaoDeDesvio(List<WfDefinicaoDeDesvio> definicaoDeDesvio) {
+		this.definicaoDeDesvio = definicaoDeDesvio;
+	}
+
+	@Override
+	public String getIdentifier() {
+		return Long.toString(getId());
+	}
+
+	@Override
+	public WfTipoDeTarefa getKind() {
+		return getTipoDeTarefa();
+	}
+
+	@Override
+	public String getTitle() {
+		return getNome();
+	}
+
+	@Override
+	public String getAfter() {
+		if (isUltimo())
+			return null;
+		if (getSeguinte() != null)
+			return getSeguinte().getIdentifier();
+		if (getDefinicaoDeProcedimento().getDefinicaoDeTarefa().size() > getOrdem() + 1)
+			return getDefinicaoDeProcedimento().getDefinicaoDeTarefa().get(getOrdem() + 1).getIdentifier();
+		return null;
+	}
+
+	@Override
+	public WfTipoDeResponsavel getResponsibleKind() {
+		return getTipoDeResponsavel();
+	}
+
+	@Override
+	public List<WfDefinicaoDeVariavel> getVariable() {
+		return getDefinicaoDeVariavel();
+	}
+
+	@Override
+	public List<WfDefinicaoDeDesvio> getDetour() {
+		return getDefinicaoDeDesvio();
+	}
+
+	@Override
+	public String getSubject() {
+		return getAssunto();
+	}
+
+	@Override
+	public String getText() {
+		return getConteudo();
+	}
+
+	public String getSeguinteIde() {
+		return seguinteIde;
+	}
+
+	public void setSeguinteIde(String seguinteIde) {
+		this.seguinteIde = seguinteIde;
+	}
+
+	@Override
+	public String getIdExterna() {
+		return this.getHisIde();
+	}
+
+	@Override
+	public void setIdExterna(String idExterna) {
+		this.setHisIde(idExterna);
+	}
+
+	@Override
+	public void setIdInicial(Long idInicial) {
+		this.setHisIdIni(idInicial);
+	}
+
+	@Override
+	public Date getDataInicio() {
+		return getHisDtIni();
+	}
+
+	@Override
+	public void setDataInicio(Date dataInicio) {
+		setHisDtIni(dataInicio);
+	}
+
+	@Override
+	public Date getDataFim() {
+		return getHisDtFim();
+	}
+
+	@Override
+	public void setDataFim(Date dataFim) {
+		setHisDtFim(dataFim);
+	}
+
+	@Override
+	public String getLoteDeImportacao() {
+		return null;
+	}
+
+	@Override
+	public void setLoteDeImportacao(String loteDeImportacao) {
+	}
+
+	@Override
+	public String getDescricaoExterna() {
+		return getNome();
+	}
+
+	@Override
+	public int getNivelDeDependencia() {
+		return SincronizavelSuporte.getNivelDeDependencia(this);
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return SincronizavelSuporte.semelhante(this, obj, profundidade);
+	}
+
+	public java.lang.String getHisIde() {
+		return hisIde;
+	}
+
+	public void setHisIde(java.lang.String hisIde) {
+		this.hisIde = hisIde;
+	}
+
+	@Override
+	public int compareTo(Sincronizavel o) {
+		if (!this.getClass().equals(o.getClass()))
+			return this.getClass().getName().compareTo(o.getClass().getName());
+		return this.getIdExterna().compareTo(o.getIdExterna());
+	}
+
+	@PostLoad
+	public void postLoad() {
+		this.setHisIde(Long.toString(this.getIdInicial()));
+		if (this.getSeguinte() != null)
+			this.setSeguinteIde(Long.toString(this.getSeguinte().getIdInicial()));
+	}
+
+	public WfDefinicaoDeResponsavel getDefinicaoDeResponsavel() {
+		return definicaoDeResponsavel;
+	}
+
+	public void setDefinicaoDeResponsavel(WfDefinicaoDeResponsavel definicaoDeResponsavel) {
+		this.definicaoDeResponsavel = definicaoDeResponsavel;
+	}
+
+	public DpPessoa getPessoa() {
+		return pessoa;
+	}
+
+	public void setPessoa(DpPessoa pessoa) {
+		this.pessoa = pessoa;
+	}
+
+	public DpLotacao getLotacao() {
+		return lotacao;
+	}
+
+	public void setLotacao(DpLotacao lotacao) {
+		this.lotacao = lotacao;
+	}
+
+	public Long getPessoaId() {
+		return pessoaId;
+	}
+
+	public void setPessoaId(Long pessoaId) {
+		this.pessoaId = pessoaId;
+	}
+
+	public Long getLotacaoId() {
+		return lotacaoId;
+	}
+
+	public void setLotacaoId(Long lotacaoId) {
+		this.lotacaoId = lotacaoId;
+	}
+
+	public Long getDefinicaoDeResponsavelId() {
+		return definicaoDeResponsavelId;
+	}
+
+	public void setDefinicaoDeResponsavelId(Long definicaoDeResponsavelId) {
+		this.definicaoDeResponsavelId = definicaoDeResponsavelId;
+	}
+
+	public java.lang.Long getRefId() {
+		return refId;
+	}
+
+	public void setRefId(java.lang.Long refId) {
+		this.refId = refId;
+	}
+
+	public java.lang.String getRefSigla() {
+		return refSigla;
+	}
+
+	public void setRefSigla(java.lang.String refSigla) {
+		this.refSigla = refSigla;
+	}
+
+	public java.lang.String getRefDescr() {
+		return refDescr;
+	}
+
+	public void setRefDescr(java.lang.String refDescr) {
+		this.refDescr = refDescr;
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeVariavel.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeVariavel.java
new file mode 100644
index 0000000000..60f5567c94
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfDefinicaoDeVariavel.java
@@ -0,0 +1,227 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.Date;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.EnumType;
+import javax.persistence.Enumerated;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.Table;
+
+import org.hibernate.annotations.BatchSize;
+
+import com.crivano.jflow.model.TaskDefinitionVariable;
+import com.crivano.jflow.model.enm.VariableEditingKind;
+import com.crivano.jflow.model.enm.VariableKind;
+
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
+import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
+import br.gov.jfrj.siga.wf.util.NaoSerializar;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_def_variavel")
+public class WfDefinicaoDeVariavel extends HistoricoAuditavelSuporte
+		implements TaskDefinitionVariable, Sincronizavel, Comparable<Sincronizavel> {
+	@Id
+	@GeneratedValue
+	@Column(name = "DEFV_ID", unique = true, nullable = false)
+	@Desconsiderar
+	private Long id;
+
+	@NaoSerializar
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFT_ID")
+	private WfDefinicaoDeTarefa definicaoDeTarefa;
+
+	@Column(name = "DEFV_CD", length = 32)
+	private String identificador;
+
+	@Column(name = "DEFV_NM", length = 256)
+	private String nome;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "DEFV_TP")
+	VariableKind tipo;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "DEFV_TP_ACESSO")
+	VariableEditingKind acesso;
+
+	@Column(name = "DEFV_NR_ORDEM")
+	private int ordem;
+
+	//
+	// Solução para não precisar criar HIS_ATIVO em todas as tabelas que herdam
+	// de HistoricoSuporte.
+	//
+	@Column(name = "HIS_ATIVO")
+	private Integer hisAtivo;
+
+	@Override
+	public Integer getHisAtivo() {
+		this.hisAtivo = super.getHisAtivo();
+		return this.hisAtivo;
+	}
+
+	@Override
+	public void setHisAtivo(Integer hisAtivo) {
+		super.setHisAtivo(hisAtivo);
+		this.hisAtivo = getHisAtivo();
+	}
+
+	public VariableEditingKind getAcesso() {
+		return acesso;
+	}
+
+	@Override
+	public VariableEditingKind getEditingKind() {
+		return acesso;
+	}
+
+	public Long getId() {
+		return id;
+	}
+
+	public String getIdentificador() {
+		return identificador;
+	}
+
+	@Override
+	public String getIdentifier() {
+		return identificador;
+	}
+
+	@Override
+	public VariableKind getKind() {
+		return tipo;
+	}
+
+	public String getNome() {
+		return nome;
+	}
+
+	public VariableKind getTipo() {
+		return tipo;
+	}
+
+	@Override
+	public String getTitle() {
+		return nome;
+	}
+
+	public void setAcesso(VariableEditingKind acesso) {
+		this.acesso = acesso;
+	}
+
+	public void setId(Long id) {
+		this.id = id;
+	}
+
+	public void setIdentificador(String identificador) {
+		this.identificador = identificador;
+	}
+
+	public void setNome(String nome) {
+		this.nome = nome;
+	}
+
+	public void setTipo(VariableKind tipo) {
+		this.tipo = tipo;
+	}
+
+	public boolean isRequired() {
+		// TODO Esse método deve ser implementado
+		return false;
+	}
+
+	public int getOrdem() {
+		return ordem;
+	}
+
+	public void setOrdem(int ordem) {
+		this.ordem = ordem;
+	}
+
+	public WfDefinicaoDeTarefa getDefinicaoDeTarefa() {
+		return definicaoDeTarefa;
+	}
+
+	public void setDefinicaoDeTarefa(WfDefinicaoDeTarefa definicaoDeTarefa) {
+		this.definicaoDeTarefa = definicaoDeTarefa;
+	}
+
+	@Override
+	public String getIdExterna() {
+		return this.getDefinicaoDeTarefa().getIdExterna() + "|" + this.getIdentificador();
+	}
+
+	@Override
+	public void setIdExterna(String idExterna) {
+	}
+
+	@Override
+	public void setIdInicial(Long idInicial) {
+		this.setHisIdIni(idInicial);
+	}
+
+	@Override
+	public Date getDataInicio() {
+		return getHisDtIni();
+	}
+
+	@Override
+	public void setDataInicio(Date dataInicio) {
+		setHisDtIni(dataInicio);
+	}
+
+	@Override
+	public Date getDataFim() {
+		return getHisDtFim();
+	}
+
+	@Override
+	public void setDataFim(Date dataFim) {
+		setHisDtFim(dataFim);
+	}
+
+	@Override
+	public String getLoteDeImportacao() {
+		return null;
+	}
+
+	@Override
+	public void setLoteDeImportacao(String loteDeImportacao) {
+	}
+
+	@Override
+	public int getNivelDeDependencia() {
+		return SincronizavelSuporte.getNivelDeDependencia(this);
+	}
+
+	@Override
+	public String getDescricaoExterna() {
+		return getNome();
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return SincronizavelSuporte.semelhante(this, obj, profundidade);
+	}
+
+	@Override
+	public int compareTo(Sincronizavel o) {
+		if (!this.getClass().equals(o.getClass()))
+			return this.getClass().getName().compareTo(o.getClass().getName());
+		return (this.getIdExterna()).compareTo(o.getIdExterna());
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMov.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMov.java
new file mode 100644
index 0000000000..68810c47e1
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMov.java
@@ -0,0 +1,203 @@
+/*******************************************************************************
+ * Copyright (c) 2006 - 2011 SJRJ.
+ * 
+ *     This file is part of SIGA.
+ * 
+ *     SIGA is free software: you can redistribute it and/or modify
+ *     it under the terms of the GNU General Public License as published by
+ *     the Free Software Foundation, either version 3 of the License, or
+ *     (at your option) any later version.
+ * 
+ *     SIGA is distributed in the hope that it will be useful,
+ *     but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *     GNU General Public License for more details.
+ * 
+ *     You should have received a copy of the GNU General Public License
+ *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
+ ******************************************************************************/
+/*
+ */
+package br.gov.jfrj.siga.wf.model;
+
+import java.io.Serializable;
+import java.text.SimpleDateFormat;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.List;
+
+import javax.persistence.Column;
+import javax.persistence.DiscriminatorColumn;
+import javax.persistence.Entity;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.Inheritance;
+import javax.persistence.InheritanceType;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.Table;
+
+import br.gov.jfrj.siga.base.AcaoVO;
+import br.gov.jfrj.siga.base.Data;
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.model.Assemelhavel;
+
+/**
+ * A class that represents a row in the EX_MOVIMENTACAO table. You can customize
+ * the behavior of this class by editing the class, {@link ExMovimentacao()}.
+ */
+@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
+@Entity
+@DiscriminatorColumn(name = "MOVI_TP")
+@Table(name = "sigawf.wf_movimentacao")
+public abstract class WfMov extends HistoricoAuditavelSuporte implements Serializable, Comparable<WfMov> {
+	@Id
+	@GeneratedValue
+	@Column(name = "MOVI_ID", unique = true, nullable = false)
+	private Long id;
+
+	@Column(name = "MOVI_DS", length = 400)
+	private String descr;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PROC_ID")
+	private WfProcedimento procedimento;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PESS_ID_TITULAR")
+	private DpPessoa titular;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "LOTA_ID_TITULAR")
+	private DpLotacao lotaTitular;
+
+//	@ManyToOne(fetch = FetchType.LAZY)
+//	@JoinColumn(name = "MOVI_ID_CANCELADORA")
+//	private WfMov movimentacaoCanceladora;
+
+//	@BatchSize(size = 1)
+//	@OneToMany(fetch = FetchType.LAZY, mappedBy = "movimentacaoRef")
+//	private java.util.Set<WfMov> movimentacaoReferenciadoraSet;
+
+//	@ManyToOne(fetch = FetchType.LAZY)
+//	@JoinColumn(name = "MOVI_ID_REF")
+//	private WfMov movimentacaoRef;
+
+	// Solução para não precisar criar HIS_ATIVO em todas as tabelas que herdam de
+	// HistoricoSuporte.
+	//
+	@Column(name = "HIS_ATIVO")
+	private Integer hisAtivo;
+
+	public WfMov() {
+		super();
+	}
+
+	public WfMov(WfProcedimento procedimento, String descr, Date dtIni, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade idcIni) {
+		super();
+		this.setProcedimento(procedimento);
+		this.setDescr(descr);
+		this.titular = titular;
+		this.lotaTitular = lotaTitular;
+		this.setHisIdcIni(idcIni);
+		this.setHisDtIni(dtIni);
+		this.hisAtivo = 1;
+	}
+
+	@Override
+	public Integer getHisAtivo() {
+		this.hisAtivo = super.getHisAtivo();
+		return this.hisAtivo;
+	}
+
+	@Override
+	public void setHisAtivo(Integer hisAtivo) {
+		super.setHisAtivo(hisAtivo);
+		this.hisAtivo = getHisAtivo();
+	}
+
+	@Override
+	public Long getId() {
+		return id;
+	}
+
+	@Override
+	public void setId(Long id) {
+		this.id = id;
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return obj == this;
+	}
+
+	public DpPessoa getTitular() {
+		return titular;
+	}
+
+	public void setTitular(DpPessoa titular) {
+		this.titular = titular;
+	}
+
+	public DpLotacao getLotaTitular() {
+		return lotaTitular;
+	}
+
+	public void setLotaTitular(DpLotacao lotaTitular) {
+		this.lotaTitular = lotaTitular;
+	}
+
+	public WfProcedimento getProcedimento() {
+		return procedimento;
+	}
+
+	public void setProcedimento(WfProcedimento procedimento) {
+		this.procedimento = procedimento;
+	}
+
+	public String getClasseVO() {
+		return this.getClass().getSimpleName() + " " + (this.getHisAtivo() == 1 ? "" : "disabled");
+	}
+
+	public String getDtIniVO() {
+		final SimpleDateFormat df = new SimpleDateFormat("dd/MM/yy HH:mm:ss");
+		if (getHisDtIni() != null) {
+			return df.format(getHisDtIni());
+		}
+		return "";
+	}
+
+	public String getTempoRelativoVO() {
+		if (getHisDtIni() != null) {
+			return Data.calcularTempoRelativo(getHisDtIni());
+		}
+		return "";
+	}
+
+	public abstract String getEvento();
+
+	public abstract String getDescricaoEvento();
+
+	public List<AcaoVO> getAcoes() {
+		List<AcaoVO> set = new ArrayList<>();
+		return set;
+	}
+
+	public String getDescr() {
+		return descr;
+	}
+
+	public void setDescr(String descr) {
+		this.descr = descr;
+	}
+
+	@Override
+	public int compareTo(WfMov o) {
+		return this.getHisDtIni().compareTo(o.getHisDtIni());
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovAnotacao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovAnotacao.java
new file mode 100644
index 0000000000..ef406ced42
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovAnotacao.java
@@ -0,0 +1,51 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.List;
+
+import javax.persistence.DiscriminatorValue;
+import javax.persistence.Entity;
+
+import br.gov.jfrj.siga.base.AcaoVO;
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.wf.logic.PodeSim;
+import br.gov.jfrj.siga.wf.util.WfAcaoHelper;
+import br.gov.jfrj.siga.wf.util.WfAcaoVO;
+
+@Entity
+@DiscriminatorValue("A")
+public class WfMovAnotacao extends WfMov {
+
+	public WfMovAnotacao() {
+		super();
+	}
+
+	public WfMovAnotacao(WfProcedimento procedimento, String descr, Date dtIni, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade identidade) {
+		super(procedimento, descr, dtIni, titular, lotaTitular, identidade);
+	}
+
+	@Override
+	public String getEvento() {
+		return "Anotação";
+	}
+
+	@Override
+	public String getDescricaoEvento() {
+		return getDescr();
+	}
+
+	@Override
+	public List<AcaoVO> getAcoes() {
+		List<AcaoVO> set = new ArrayList<>();
+
+		set.add(WfAcaoVO.builder().nome("Excluir")
+				.acao("/app/procedimento/" + getProcedimento().getId() + "/anotacao/" + getId() + "/excluir")
+				.exp(new PodeSim()).post(true).build());
+
+		return set;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovCancelamento.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovCancelamento.java
new file mode 100644
index 0000000000..3088047a2c
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovCancelamento.java
@@ -0,0 +1,20 @@
+package br.gov.jfrj.siga.wf.model;
+
+import javax.persistence.DiscriminatorValue;
+import javax.persistence.Entity;
+
+@Entity
+@DiscriminatorValue("C")
+public class WfMovCancelamento extends WfMov {
+
+	@Override
+	public String getEvento() {
+		return "Cancelamento";
+	}
+
+	@Override
+	public String getDescricaoEvento() {
+		return null;
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovDesignacao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovDesignacao.java
new file mode 100644
index 0000000000..0831903c32
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovDesignacao.java
@@ -0,0 +1,108 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.Date;
+
+import javax.persistence.Column;
+import javax.persistence.DiscriminatorValue;
+import javax.persistence.Entity;
+import javax.persistence.EnumType;
+import javax.persistence.Enumerated;
+import javax.persistence.FetchType;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeDesignacao;
+
+@Entity
+@DiscriminatorValue("D")
+public class WfMovDesignacao extends WfMov {
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PESS_ID_DE")
+	private DpPessoa pessoaDe;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PESS_ID_PARA")
+	private DpPessoa pessoaPara;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "LOTA_ID_DE")
+	private DpLotacao lotaDe;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "LOTA_ID_PARA")
+	private DpLotacao lotaPara;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "MOVI_TP_DESIGNACAO")
+	private WfTipoDeDesignacao tipo = WfTipoDeDesignacao.TODAS;
+
+	public WfMovDesignacao() {
+		super();
+	}
+
+	public WfMovDesignacao(WfProcedimento pi, Date dtIni, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade identidade, DpPessoa pessoaDe, DpLotacao lotaDe, DpPessoa pessoaPara, DpLotacao lotaPara) {
+		super(pi, null, dtIni, titular, lotaTitular, identidade);
+		this.pessoaDe = pessoaDe;
+		this.lotaDe = lotaDe;
+		this.pessoaPara = pessoaPara;
+		this.lotaPara = lotaPara;
+	}
+
+	@Override
+	public String getEvento() {
+		return "Designação";
+	}
+
+	@Override
+	public String getDescricaoEvento() {
+		return (pessoaDe != null ? pessoaDe.getSigla() : lotaDe != null ? lotaDe.getSigla() : "[não definido]") + " -> "
+				+ (pessoaPara != null ? pessoaPara.getSigla()
+						: lotaPara != null ? lotaPara.getSigla() : "[não definido]")
+				+ " (" + tipo.getDescr().toLowerCase() + ")";
+	}
+
+	public DpPessoa getPessoaDe() {
+		return pessoaDe;
+	}
+
+	public void setPessoaDe(DpPessoa pessoaDe) {
+		this.pessoaDe = pessoaDe;
+	}
+
+	public DpPessoa getPessoaPara() {
+		return pessoaPara;
+	}
+
+	public void setPessoaPara(DpPessoa pessoaPara) {
+		this.pessoaPara = pessoaPara;
+	}
+
+	public DpLotacao getLotaDe() {
+		return lotaDe;
+	}
+
+	public void setLotaDe(DpLotacao lotaDe) {
+		this.lotaDe = lotaDe;
+	}
+
+	public DpLotacao getLotaPara() {
+		return lotaPara;
+	}
+
+	public void setLotaPara(DpLotacao lotaPara) {
+		this.lotaPara = lotaPara;
+	}
+
+	public WfTipoDeDesignacao getTipo() {
+		return tipo;
+	}
+
+	public void setTipo(WfTipoDeDesignacao tipo) {
+		this.tipo = tipo;
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovRedirecionamento.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovRedirecionamento.java
new file mode 100644
index 0000000000..fe36ce27bb
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovRedirecionamento.java
@@ -0,0 +1,31 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.Date;
+
+import javax.persistence.DiscriminatorValue;
+import javax.persistence.Entity;
+
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+
+@Entity
+@DiscriminatorValue("R")
+public class WfMovRedirecionamento extends WfMovTransicao {
+
+	public WfMovRedirecionamento(WfProcedimento pi, Date dtIni, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade identidade, Integer de, Integer para) {
+		super(pi, dtIni, titular, lotaTitular, identidade, de, para);
+	}
+
+	@Override
+	public String getEvento() {
+		return "Redirecionamento";
+	}
+
+	@Override
+	public String getDescricaoEvento() {
+		return null;
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovTransicao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovTransicao.java
new file mode 100644
index 0000000000..b19a1c248a
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfMovTransicao.java
@@ -0,0 +1,58 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.Date;
+
+import javax.persistence.DiscriminatorValue;
+import javax.persistence.Entity;
+import javax.persistence.FetchType;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+
+@Entity
+@DiscriminatorValue("T")
+public class WfMovTransicao extends WfMov {
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFT_ID_DE")
+	private WfDefinicaoDeTarefa definicaoDeTarefaDe;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFT_ID_PARA")
+	private WfDefinicaoDeTarefa definicaoDeTarefaPara;
+
+	public WfMovTransicao() {
+		super();
+	}
+
+	public WfMovTransicao(WfProcedimento pi, Date dtIni, DpPessoa titular, DpLotacao lotaTitular,
+			CpIdentidade identidade, Integer de, Integer para) {
+		super(pi, null, dtIni, titular, lotaTitular, identidade);
+		if (de != null)
+			definicaoDeTarefaDe = pi.getTaskDefinitionByIndex(de);
+		if (para != null)
+			definicaoDeTarefaPara = pi.getTaskDefinitionByIndex(para);
+	}
+
+	@Override
+	public String getEvento() {
+		return "Transição";
+	}
+
+	@Override
+	public String getDescricaoEvento() {
+		return (definicaoDeTarefaDe == null ? "início" : definicaoDeTarefaDe.getNome()) + " -> "
+				+ (definicaoDeTarefaPara == null ? "fim" : definicaoDeTarefaPara.getNome());
+	}
+
+	public WfDefinicaoDeTarefa getDefinicaoDeTarefaDe() {
+		return definicaoDeTarefaDe;
+	}
+
+	public WfDefinicaoDeTarefa getDefinicaoDeTarefaPara() {
+		return definicaoDeTarefaPara;
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfProcedimento.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfProcedimento.java
new file mode 100644
index 0000000000..2862ddcb3a
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfProcedimento.java
@@ -0,0 +1,741 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
+import java.util.TreeMap;
+import java.util.TreeSet;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.EnumType;
+import javax.persistence.Enumerated;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.OneToMany;
+import javax.persistence.PostLoad;
+import javax.persistence.PrePersist;
+import javax.persistence.PreUpdate;
+import javax.persistence.Query;
+import javax.persistence.Table;
+import javax.persistence.Temporal;
+import javax.persistence.TemporalType;
+import javax.persistence.Transient;
+
+import org.hibernate.annotations.BatchSize;
+
+import com.crivano.jflow.model.ProcessInstance;
+import com.crivano.jflow.model.TaskDefinition;
+import com.crivano.jflow.model.enm.ProcessInstanceStatus;
+
+import br.gov.jfrj.siga.Service;
+import br.gov.jfrj.siga.base.AcaoVO;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.Texto;
+import br.gov.jfrj.siga.base.util.Utils;
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.ex.service.ExService;
+import br.gov.jfrj.siga.model.ActiveRecord;
+import br.gov.jfrj.siga.model.Objeto;
+import br.gov.jfrj.siga.parser.PessoaLotacaoParser;
+import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.logic.PodeSim;
+import br.gov.jfrj.siga.wf.logic.WfPodePegar;
+import br.gov.jfrj.siga.wf.model.enm.WfPrioridade;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDePrincipal;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeTarefa;
+import br.gov.jfrj.siga.wf.util.SiglaUtils;
+import br.gov.jfrj.siga.wf.util.SiglaUtils.SiglaDecodificada;
+import br.gov.jfrj.siga.wf.util.WfAcaoVO;
+import br.gov.jfrj.siga.wf.util.WfResp;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_procedimento")
+public class WfProcedimento extends Objeto
+		implements ProcessInstance<WfDefinicaoDeProcedimento, WfDefinicaoDeTarefa, WfResp> {
+	public static ActiveRecord<WfProcedimento> AR = new ActiveRecord<>(WfProcedimento.class);
+
+	@Id
+	@GeneratedValue
+	@Column(name = "PROC_ID", unique = true, nullable = false)
+	private Long id;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFP_ID")
+	private WfDefinicaoDeProcedimento definicaoDeProcedimento;
+
+	@Column(name = "PROC_CD_PRINCIPAL")
+	private String principal;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "PROC_TP_PRINCIPAL")
+	private WfTipoDePrincipal tipoDePrincipal;
+
+	@Column(name = "PROC_NR_CORRENTE")
+	private Integer indiceCorrente = null;
+
+	@Transient
+	private Map<String, Object> variavelMap = new TreeMap<>();
+
+	@BatchSize(size = 1)
+	@OneToMany(fetch = FetchType.LAZY, mappedBy = "procedimento")
+	private List<WfVariavel> variaveis = new ArrayList<>();
+
+	@BatchSize(size = 1)
+	@OneToMany(fetch = FetchType.LAZY, mappedBy = "procedimento")
+	private Set<WfMov> movimentacoes = new TreeSet<>();
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "PROC_ST_CORRENTE")
+	private ProcessInstanceStatus status = ProcessInstanceStatus.INACTIVE;
+
+	@Column(name = "PROC_TS_EVENTO")
+	private Date eventoData;
+
+	@Column(name = "PROC_NM_EVENTO")
+	private String eventoNome;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PESS_ID_EVENTO")
+	private DpPessoa eventoPessoa;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "LOTA_ID_EVENTO")
+	private DpLotacao eventoLotacao;
+
+	@Enumerated(EnumType.STRING)
+	@Column(name = "PROC_TP_PRIORIDADE")
+	private WfPrioridade prioridade = WfPrioridade.MEDIA;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "ORGU_ID")
+	private CpOrgaoUsuario orgaoUsuario;
+
+	@Column(name = "PROC_ANO")
+	private Integer ano;
+
+	@Column(name = "PROC_NR")
+	private Integer numero;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PESS_ID_TITULAR")
+	private DpPessoa titular;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "LOTA_ID_TITULAR")
+	private DpLotacao lotaTitular;
+
+	@Temporal(TemporalType.TIMESTAMP)
+	@Column(name = "HIS_DT_INI")
+	@Desconsiderar
+	private Date hisDtIni;
+
+	@Temporal(TemporalType.TIMESTAMP)
+	@Column(name = "HIS_DT_FIM")
+	@Desconsiderar
+	private Date hisDtFim;
+
+	@Desconsiderar
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "HIS_IDC_INI")
+	private CpIdentidade hisIdcIni;
+
+	public WfProcedimento() {
+	}
+
+	public WfProcedimento(WfDefinicaoDeProcedimento definicao, Map<String, Object> variavel) {
+		this.definicaoDeProcedimento = definicao;
+		if (variavel != null)
+			this.variavelMap.putAll(variavel);
+	}
+
+	@Override
+	public void start() {
+		indiceCorrente = -1;
+		status = ProcessInstanceStatus.STARTED;
+		this.setHisDtIni(WfDao.getInstance().consultarDataEHoraDoServidor());
+	}
+
+	@Override
+	public void pause(String eventoNome, WfResp responsavel) {
+		this.eventoNome = eventoNome;
+		this.eventoPessoa = ((WfResp) responsavel).getPessoa();
+		this.eventoLotacao = ((WfResp) responsavel).getLotacao();
+		this.eventoData = new Date();
+		status = ProcessInstanceStatus.PAUSED;
+	}
+
+	@Override
+	public void resume() {
+		this.eventoNome = null;
+		this.eventoPessoa = null;
+		this.eventoLotacao = null;
+		this.eventoData = null;
+		status = ProcessInstanceStatus.RESUMING;
+	}
+
+	@Override
+	public void end() {
+		indiceCorrente = null;
+		status = ProcessInstanceStatus.FINISHED;
+		this.setHisDtFim(WfDao.getInstance().consultarDataEHoraDoServidor());
+	}
+
+	@Override
+	public WfDefinicaoDeTarefa getCurrentTaskDefinition() {
+		if (indiceCorrente == null)
+			return null;
+		return getTaskDefinitionByIndex(indiceCorrente);
+	}
+
+	@Override
+	public WfDefinicaoDeTarefa getTaskDefinitionByIndex(int i) {
+		if (i < 0 || i >= definicaoDeProcedimento.getTaskDefinition().size())
+			return null;
+		return definicaoDeProcedimento.getTaskDefinition().get(i);
+	}
+
+	// Se for "fim" retorna length + 1
+	@Override
+	public int getIndexById(String id) {
+		if ("finish".equals(id))
+			return definicaoDeProcedimento.getTaskDefinition().size();
+		int i = 0;
+		for (TaskDefinition td : definicaoDeProcedimento.getTaskDefinition()) {
+			if (td.getIdentifier().equals(id))
+				return i;
+			i++;
+		}
+		return i;
+	}
+
+	@PostLoad
+	public void onLoad() {
+		variavelMap.clear();
+		for (WfVariavel v : variaveis) {
+			if (v.number != null)
+				variavelMap.put(v.getIdentifier(), v.number);
+			else if (v.bool != null)
+				variavelMap.put(v.getIdentifier(), v.bool);
+			else if (v.date != null)
+				variavelMap.put(v.getIdentifier(), v.date);
+			else
+				variavelMap.put(v.getIdentifier(), v.string);
+		}
+	}
+
+	@PrePersist
+	private void onPersist() {
+		if (getAno() != null)
+			return;
+		setAno(WfDao.getInstance().dt().getYear() + 1900);
+		Query qry = em().createQuery(
+				"select max(numero) from WfProcedimento pi where ano = :ano and orgaoUsuario.idOrgaoUsu = :ouid");
+		qry.setParameter("ano", getAno());
+		qry.setParameter("ouid", getOrgaoUsuario().getId());
+		Integer i = (Integer) qry.getSingleResult();
+		setNumero((i == null ? 0 : i) + 1);
+	}
+
+	@PreUpdate
+	public void onSave() throws Exception {
+	}
+
+	private void assertPrincipal() throws RuntimeException {
+		if (this.getPrincipal() == null)
+			throw new RuntimeException("Não é possível identificar o responsável porque não há \'principal'");
+	}
+
+	private WfResp assertPrincipalPessoa(String s) {
+		assertPrincipal();
+		PessoaLotacaoParser lpp = new PessoaLotacaoParser(s);
+		if (lpp.getLotacao() == null)
+			return null;
+		return new WfResp(lpp.getPessoa(), lpp.getLotacao());
+	}
+
+	private WfResp assertPrincipalLotacao(String s) {
+		assertPrincipal();
+		PessoaLotacaoParser lpp = new PessoaLotacaoParser(s);
+		if (lpp.getLotacao() == null)
+			return null;
+		return new WfResp(null, lpp.getLotacao());
+	}
+
+	@Override
+	public WfResp calcResponsible(WfDefinicaoDeTarefa tarefa) {
+		return localizarResponsavelAtual(tarefa);
+	}
+
+	public WfResp localizarResponsavelAtual(WfDefinicaoDeTarefa tarefa) {
+		WfResp resp = localizarResponsavelOriginal(tarefa);
+
+		for (WfMov mov : getMovimentacoes()) {
+			if (!mov.isAtivo())
+				continue;
+			if (mov instanceof WfMovDesignacao) {
+				WfMovDesignacao m = (WfMovDesignacao) mov;
+				if ((m.getPessoaDe() != null && m.getPessoaDe().equivale(resp.getPessoa()))
+						|| (m.getPessoaDe() == null && m.getLotaDe().equivale(resp.getLotacao()))) {
+					resp = new WfResp(m.getPessoaPara(), m.getLotaPara());
+				}
+			}
+		}
+
+		return resp;
+	};
+
+	public WfResp localizarResponsavelOriginal(WfDefinicaoDeTarefa tarefa) {
+		ExService service = null;
+		if (this.getPrincipal() != null && this.getTipoDePrincipal() == WfTipoDePrincipal.DOC)
+			service = Service.getExService();
+		try {
+			if (tarefa.getTipoDeTarefa() == WfTipoDeTarefa.AGUARDAR_ASSINATURA_PRINCIPAL)
+				return assertPrincipalPessoa(service.cadastrante(getPrincipal()));
+			if (tarefa.getTipoDeResponsavel() == null)
+				return null;
+			switch (tarefa.getTipoDeResponsavel()) {
+			case PRINCIPAL_CADASTRANTE:
+				return assertPrincipalPessoa(service.cadastrante(getPrincipal()));
+			case PRINCIPAL_LOTA_CADASTRANTE:
+				return assertPrincipalLotacao(service.cadastrante(getPrincipal()));
+			case PRINCIPAL_TITULAR:
+				return assertPrincipalPessoa(service.titular(getPrincipal()));
+			case PRINCIPAL_LOTA_TITULAR:
+				return assertPrincipalLotacao(service.titular(getPrincipal()));
+			case PRINCIPAL_SUBSCRITOR:
+				return assertPrincipalPessoa(service.subscritor(getPrincipal()));
+			case PRINCIPAL_LOTA_SUBSCRITOR:
+				return assertPrincipalLotacao(service.subscritor(getPrincipal()));
+			case PRINCIPAL_DESTINATARIO:
+				return assertPrincipalPessoa(service.destinatario(getPrincipal()));
+			case PRINCIPAL_LOTA_DESTINATARIO:
+				return assertPrincipalLotacao(service.destinatario(getPrincipal()));
+			case PRINCIPAL_GESTOR:
+				return assertPrincipalPessoa(service.gestor(getPrincipal()));
+			case PRINCIPAL_LOTA_GESTOR:
+				return assertPrincipalLotacao(service.gestor(getPrincipal()));
+			case PRINCIPAL_FISCAL_TECNICO:
+				return assertPrincipalPessoa(service.fiscalTecnico(getPrincipal()));
+			case PRINCIPAL_LOTA_FISCAL_TECNICO:
+				return assertPrincipalLotacao(service.fiscalTecnico(getPrincipal()));
+			case PRINCIPAL_FISCAL_ADMINISTRATIVO:
+				return assertPrincipalPessoa(service.fiscalAdministrativo(getPrincipal()));
+			case PRINCIPAL_LOTA_FISCAL_ADMINISTRATIVO:
+				return assertPrincipalLotacao(service.fiscalAdministrativo(getPrincipal()));
+			case PRINCIPAL_INTERESSADO:
+				return assertPrincipalPessoa(service.interessado(getPrincipal()));
+			case PRINCIPAL_LOTA_INTERESSADO:
+				return assertPrincipalLotacao(service.interessado(getPrincipal()));
+			case RESPONSAVEL:
+				WfResponsavel r = WfDao.getInstance().consultarResponsavelPorOrgaoEDefinicaoDeResponsavel(
+						getOrgaoUsuario(), tarefa.getDefinicaoDeResponsavel());
+				return new WfResp(r.getPessoa(), r.getLotacao());
+			case PESSOA:
+			case LOTACAO:
+				return new WfResp(tarefa.getPessoa(), tarefa.getLotacao());
+			default:
+				return null;
+			}
+		} catch (Exception e) {
+			throw new RuntimeException("Não foi possível calcular o responsável pela tarefa " + tarefa.getNome()
+					+ " do procedimento " + this.getSigla(), e);
+		}
+	};
+
+	@Override
+	public WfDefinicaoDeProcedimento getProcessDefinition() {
+		return definicaoDeProcedimento;
+	}
+
+	@Override
+	public Integer getCurrentIndex() {
+		return indiceCorrente;
+	}
+
+	@Override
+	public Map<String, Object> getVariable() {
+		return variavelMap;
+	}
+
+	@Override
+	public ProcessInstanceStatus getStatus() {
+		return status;
+	}
+
+	@Override
+	public WfResp getResponsible() {
+		return new WfResp(eventoPessoa, eventoLotacao);
+	}
+
+	@Override
+	public void setCurrentIndex(int indiceCorrente) {
+		this.indiceCorrente = indiceCorrente;
+	}
+
+	@Override
+	public void setProcessDefinition(WfDefinicaoDeProcedimento definicao) {
+		this.definicaoDeProcedimento = definicao;
+	}
+
+	@Override
+	public void setVariable(Map<String, Object> variavel) {
+		this.variavelMap = variavel;
+	}
+
+	public WfTipoDePrincipal getTipoDePrincipal() {
+		return tipoDePrincipal;
+	}
+
+	public void setTipoDePrincipal(WfTipoDePrincipal tipoDePrincipal) {
+		this.tipoDePrincipal = tipoDePrincipal;
+	}
+
+	public String getPrincipal() {
+		return principal;
+	}
+
+	public void setPrincipal(String principal) {
+		this.principal = principal;
+	}
+
+	public Long getId() {
+		return id;
+	}
+
+	public void setId(Long id) {
+		this.id = id;
+	}
+
+	public WfDefinicaoDeTarefa getDefinicaoDeTarefaCorrente() {
+		return getCurrentTaskDefinition();
+	}
+
+	public WfDefinicaoDeProcedimento getDefinicaoDeProcedimento() {
+		return definicaoDeProcedimento;
+	}
+
+	public void setDefinicaoDeProcedimento(WfDefinicaoDeProcedimento definicao) {
+		this.definicaoDeProcedimento = definicao;
+	}
+
+	public Integer getIndiceCorrente() {
+		return indiceCorrente;
+	}
+
+	public void setIndiceCorrente(Integer indiceCorrente) {
+		this.indiceCorrente = indiceCorrente;
+	}
+
+	public Map<String, Object> getVariavelMap() {
+		return variavelMap;
+	}
+
+	public void setVariavelMap(Map<String, Object> variavelMap) {
+		this.variavelMap = variavelMap;
+	}
+
+	public List<WfVariavel> getVariaveis() {
+		return variaveis;
+	}
+
+	public void setVariaveis(List<WfVariavel> listaDeVariaveis) {
+		this.variaveis = listaDeVariaveis;
+	}
+
+	public void setStatus(ProcessInstanceStatus status) {
+		this.status = status;
+	}
+
+	public WfPrioridade getPrioridade() {
+		return prioridade;
+	}
+
+	public void setPrioridade(WfPrioridade prioridade) {
+		this.prioridade = prioridade;
+	}
+
+	public Set<WfMov> getMovimentacoes() {
+		return movimentacoes;
+	}
+
+	public void setMovimentacoes(Set<WfMov> movimentacoes) {
+		this.movimentacoes = movimentacoes;
+	}
+
+	public String getAtendente() {
+		if (getEventoPessoa() != null)
+			return getEventoPessoa().getSigla();
+		if (getEventoLotacao() != null)
+			return getEventoLotacao().getSigla();
+		return "";
+	}
+
+	public CpOrgaoUsuario getOrgaoUsuario() {
+		return orgaoUsuario;
+	}
+
+	public void setOrgaoUsuario(CpOrgaoUsuario orgaoUsuario) {
+		this.orgaoUsuario = orgaoUsuario;
+	}
+
+	public Integer getAno() {
+		return ano;
+	}
+
+	public void setAno(Integer ano) {
+		this.ano = ano;
+	}
+
+	public Integer getNumero() {
+		return numero;
+	}
+
+	public void setNumero(Integer numero) {
+		this.numero = numero;
+	}
+
+	public String getSigla() {
+		return orgaoUsuario.getAcronimoOrgaoUsu() + "-WF-" + ano + "/" + Utils.completarComZeros(numero, 5);
+	}
+
+	public String getSiglaCompacta() {
+		return getSigla().replace("-", "").replace("/", "");
+	}
+
+	public void setSigla(String sigla) {
+		SiglaDecodificada d = SiglaUtils.parse(sigla, "WF", null);
+		this.ano = d.ano;
+		this.numero = d.numero;
+		this.orgaoUsuario = d.orgaoUsuario;
+	}
+
+	public static WfProcedimento findBySigla(String sigla) throws NumberFormatException, Exception {
+		return findBySigla(sigla, null);
+	}
+
+	public static WfProcedimento findBySigla(String sigla, CpOrgaoUsuario ouDefault)
+			throws NumberFormatException, Exception {
+		SiglaDecodificada d = SiglaUtils.parse(sigla, "WF", null);
+
+		WfProcedimento info = null;
+
+		if (d.id != null) {
+			info = AR.findById(d.id);
+		} else if (d.numero != null) {
+			info = AR.find("ano = ?1 and numero = ?2 and ou.idOrgaoUsu = ?3", d.ano, d.numero, d.orgaoUsuario.getId())
+					.first();
+		}
+
+		if (info == null) {
+			throw new AplicacaoException("Não foi possível encontrar uma instância de procedimento com o código "
+					+ sigla + ". Favor verificá-lo.");
+		} else
+			return info;
+	}
+
+	public List<AcaoVO> getAcoes(DpPessoa titular, DpLotacao lotaTitular) {
+		List<AcaoVO> set = new ArrayList<>();
+
+		set.add(WfAcaoVO.builder().nome("_Anotar").icone("note_add").acao("/app/anotar").modal("anotarModal")
+				.exp(new PodeSim()).build());
+
+		set.add(WfAcaoVO.builder().nome("_Pegar").icone("add")
+				.acao("/app/procedimento/" + getSiglaCompacta() + "/pegar")
+				.exp(new WfPodePegar(this, titular, lotaTitular)).post(true).build());
+
+		return set;
+	}
+
+	public boolean isFormulario() {
+		return status == ProcessInstanceStatus.PAUSED
+				&& getCurrentTaskDefinition().getTipoDeTarefa() == WfTipoDeTarefa.FORMULARIO;
+	}
+
+	public boolean isDesabilitarFormulario(DpPessoa titular, DpLotacao lotaTitular) {
+		if (getDefinicaoDeTarefaCorrente() == null
+				|| getDefinicaoDeTarefaCorrente().getTipoDeTarefa() != WfTipoDeTarefa.FORMULARIO)
+			return true;
+		return !titular.equivale(getEventoPessoa()) && !lotaTitular.equivale(getEventoLotacao());
+	}
+
+	public Object obterValorDeVariavel(WfDefinicaoDeVariavel vd) {
+		return getVariavelMap().get(vd.getIdentificador());
+	}
+
+	public String getMsgAviso(DpPessoa titular, DpLotacao lotaTitular) throws Exception {
+//		WfConhecimento c = WfDao.getInstance().consultarConhecimento(ti.getDefinicaoDeTarefa().getId());
+//		if (c != null) {
+//			this.setDescricao(WfWikiParser.renderXHTML(c.getDescricao()));
+//			this.setConhecimento(c.getDescricao());
+//		}
+
+		if (!titular.equivale(getEventoPessoa()) && !lotaTitular.equivale(getEventoLotacao())) {
+			if (getEventoPessoa() != null && getEventoLotacao() != null)
+				return "Esta tarefa será desempenhada por " + titular.getSigla() + " na lotação "
+						+ getEventoLotacao().getSigla();
+			if (getEventoPessoa() != null)
+				return "Esta tarefa será desempenhada por " + getEventoPessoa().getSigla();
+			if (getEventoLotacao() != null)
+				return "Esta tarefa será desempenhada pela lotação " + getEventoLotacao().getSigla();
+		}
+
+		String siglaTitular = titular.getSigla() + "@" + lotaTitular.getSiglaCompleta();
+		String respWF = null;
+		if (getEventoPessoa() != null)
+			respWF = getEventoPessoa().getSigla();
+		if (respWF == null && getEventoLotacao() != null)
+			respWF = "@" + getEventoLotacao().getSiglaCompleta();
+
+		if (!Utils.empty(getPrincipal()) && getTipoDePrincipal() == WfTipoDePrincipal.DOC) {
+			ExService service = Service.getExService();
+			String respEX = service.getAtendente(getPrincipal(), siglaTitular);
+			DpLotacao lotEX = new PessoaLotacaoParser(respEX).getLotacaoOuLotacaoPrincipalDaPessoa();
+			DpLotacao lotWF = new PessoaLotacaoParser(respWF).getLotacaoOuLotacaoPrincipalDaPessoa();
+			boolean podeMovimentar = service.podeMovimentar(getPrincipal(), siglaTitular);
+			boolean estaComTarefa = titular.equivale(new PessoaLotacaoParser(respWF).getPessoa());
+			respEX = service.getAtendente(getPrincipal(), siglaTitular);
+			lotEX = new PessoaLotacaoParser(respEX).getLotacaoOuLotacaoPrincipalDaPessoa();
+
+			if (podeMovimentar && !estaComTarefa) {
+				if (lotWF == null || !lotWF.equivale(lotEX)) {
+					return "Esta tarefa só poderá prosseguir quando o documento " + getPrincipal()
+							+ " for transferido para " + (lotWF == null ? "Nula" : lotWF.getSigla()) + ".";
+				}
+			}
+			if (!podeMovimentar && estaComTarefa) {
+				return "Esta tarefa só poderá prosseguir quando o documento " + getPrincipal() + ", que está com "
+						+ lotEX.getSigla() + ", for devolvido.";
+			}
+			if (!podeMovimentar && !estaComTarefa) {
+				if (lotWF != null && !lotWF.equivale(lotEX)) {
+					return "Esta tarefa só poderá prosseguir quando o documento " + getPrincipal() + ", que está com "
+							+ lotEX.getSigla() + ", for transferido para " + lotWF.getSigla() + ".";
+				}
+			}
+		}
+
+		if (getDefinicaoDeTarefaCorrente() != null
+				&& getDefinicaoDeTarefaCorrente().getTipoDeTarefa() == WfTipoDeTarefa.INCLUIR_DOCUMENTO) {
+			return "Este workflow prosseguirá automaticamente quando for juntado ou incluído um documento do modelo '"
+					+ getDefinicaoDeTarefaCorrente().getRefSigla() + "' ao documento " + getPrincipal()
+					+ ". Clique <a href=\"http://localhost:8080/sigaex/app/expediente/doc/editar?mobilPaiSel.sigla="
+					+ getPrincipal() + "&criandoAnexo=true&modelo="
+					+ getDefinicaoDeTarefaCorrente().getRefId() + "\">aqui</a> para incluir.";
+		}
+		if (getDefinicaoDeTarefaCorrente() != null
+				&& getDefinicaoDeTarefaCorrente().getTipoDeTarefa() == WfTipoDeTarefa.AGUARDAR_ASSINATURA_PRINCIPAL) {
+			return "Este workflow prosseguirá automaticamente quando o documento " + getPrincipal()
+					+ " estiver assinado. Clique <a href=\"http://localhost:8080/sigaex/app/expediente/mov/assinar?sigla="
+					+ getPrincipal() + "\">aqui</a> para assinar.";
+		}
+		return null;
+	}
+
+	public List<String> getTags() {
+		ArrayList<String> tags = new ArrayList<String>();
+		if (getProcessDefinition() != null)
+			tags.add("@" + Texto.slugify(getProcessDefinition().getNome(), true, true));
+		if (getCurrentTaskDefinition() != null && getCurrentTaskDefinition().getNome() != null)
+			tags.add("@" + Texto.slugify(getCurrentTaskDefinition().getNome(), true, true));
+
+		if (getProcessDefinition().getNome() != null && getCurrentTaskDefinition() != null
+				&& getCurrentTaskDefinition().getNome() != null)
+			tags.add("^wf:" + Texto.slugify(
+					getProcessDefinition().getNome() + "-" + getCurrentTaskDefinition().getNome(), true, true));
+		return tags;
+	}
+
+	public Date getEventoData() {
+		return eventoData;
+	}
+
+	public void setEventoData(Date eventoData) {
+		this.eventoData = eventoData;
+	}
+
+	public String getEventoNome() {
+		return eventoNome;
+	}
+
+	public void setEventoNome(String eventoNome) {
+		this.eventoNome = eventoNome;
+	}
+
+	public DpPessoa getEventoPessoa() {
+		return eventoPessoa;
+	}
+
+	public void setEventoPessoa(DpPessoa eventoPessoa) {
+		this.eventoPessoa = eventoPessoa;
+	}
+
+	public DpLotacao getEventoLotacao() {
+		return eventoLotacao;
+	}
+
+	public void setEventoLotacao(DpLotacao eventoLotacao) {
+		this.eventoLotacao = eventoLotacao;
+	}
+
+	public DpPessoa getTitular() {
+		return titular;
+	}
+
+	public void setTitular(DpPessoa titular) {
+		this.titular = titular;
+	}
+
+	public DpLotacao getLotaTitular() {
+		return lotaTitular;
+	}
+
+	public void setLotaTitular(DpLotacao lotaTitular) {
+		this.lotaTitular = lotaTitular;
+	}
+
+	public Date getHisDtIni() {
+		return hisDtIni;
+	}
+
+	public void setHisDtIni(Date hisDtIni) {
+		this.hisDtIni = hisDtIni;
+	}
+
+	public Date getHisDtFim() {
+		return hisDtFim;
+	}
+
+	public void setHisDtFim(Date hisDtFim) {
+		this.hisDtFim = hisDtFim;
+	}
+
+	public CpIdentidade getHisIdcIni() {
+		return hisIdcIni;
+	}
+
+	public void setHisIdcIni(CpIdentidade hisIdcIni) {
+		this.hisIdcIni = hisIdcIni;
+	}
+
+	@Override
+	public Date getDtEvent() {
+		return getEventoData();
+	}
+
+	@Override
+	public String getEvent() {
+		return getEventoNome();
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfResponsavel.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfResponsavel.java
new file mode 100644
index 0000000000..8663f74ba2
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfResponsavel.java
@@ -0,0 +1,232 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.io.Serializable;
+import java.util.Date;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.PostLoad;
+import javax.persistence.Table;
+import javax.persistence.Transient;
+
+import org.hibernate.annotations.BatchSize;
+
+import com.crivano.jflow.model.ProcessDefinition;
+import com.crivano.jflow.model.Responsible;
+
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavelSuporte;
+import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.model.Selecionavel;
+import br.gov.jfrj.siga.sinc.lib.Desconsiderar;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_responsavel")
+public class WfResponsavel extends HistoricoAuditavelSuporte
+		implements Responsible, Serializable, Sincronizavel, Comparable<Sincronizavel> {
+
+	@Id
+	@GeneratedValue
+	@Column(name = "RESP_ID", unique = true, nullable = false)
+	@Desconsiderar
+	private java.lang.Long id;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "DEFR_ID")
+	private WfDefinicaoDeResponsavel definicaoDeResponsavel;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PESS_ID")
+	private DpPessoa pessoa;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "LOTA_ID")
+	private DpLotacao lotacao;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "ORGU_ID")
+	private CpOrgaoUsuario orgaoUsuario;
+
+	@Transient
+	private java.lang.String hisIde;
+
+	// Solução para não precisar criar HIS_ATIVO em todas as tabelas que herdam
+	// de HistoricoSuporte.
+	//
+	@Column(name = "HIS_ATIVO")
+	@Desconsiderar
+	private Integer hisAtivo;
+
+	@Override
+	public Integer getHisAtivo() {
+		this.hisAtivo = super.getHisAtivo();
+		return this.hisAtivo;
+	}
+
+	@Override
+	public void setHisAtivo(Integer hisAtivo) {
+		this.hisAtivo = hisAtivo;
+	}
+
+	public WfResponsavel() {
+		super();
+	}
+
+	public WfResponsavel(DpPessoa pessoa, DpLotacao lotacao) {
+		super();
+		this.pessoa = pessoa;
+		this.lotacao = lotacao;
+	}
+
+	@Override
+	public String getInitials() {
+		if (pessoa != null)
+			return pessoa.getSigla();
+		if (lotacao != null)
+			return lotacao.getSiglaCompleta();
+		return null;
+	}
+
+	public String getCodigo() {
+		if (pessoa != null)
+			return pessoa.getSiglaCompleta();
+		if (lotacao != null)
+			return "@" + lotacao.getSiglaCompleta();
+		return null;
+	}
+
+	public CpOrgaoUsuario getOrgaoUsuario() {
+		return orgaoUsuario;
+	}
+
+	public void setOrgaoUsuario(CpOrgaoUsuario orgaoUsuario) {
+		this.orgaoUsuario = orgaoUsuario;
+	}
+
+	public java.lang.Long getId() {
+		return id;
+	}
+
+	public void setId(java.lang.Long id) {
+		this.id = id;
+	}
+
+	public WfDefinicaoDeResponsavel getDefinicaoDeResponsavel() {
+		return definicaoDeResponsavel;
+	}
+
+	public void setDefinicaoDeResponsavel(WfDefinicaoDeResponsavel definicaoDeResponsavel) {
+		this.definicaoDeResponsavel = definicaoDeResponsavel;
+	}
+
+	public DpPessoa getPessoa() {
+		return pessoa;
+	}
+
+	public void setPessoa(DpPessoa pessoa) {
+		this.pessoa = pessoa;
+	}
+
+	public DpLotacao getLotacao() {
+		return lotacao;
+	}
+
+	public void setLotacao(DpLotacao lotacao) {
+		this.lotacao = lotacao;
+	}
+
+	public java.lang.String getHisIde() {
+		return hisIde;
+	}
+
+	public void setHisIde(java.lang.String hisIde) {
+		this.hisIde = hisIde;
+	}
+
+	@Override
+	public String getIdExterna() {
+		return getHisIde() != null ? getHisIde() : "novo responsável";
+	}
+
+	@Override
+	public void setIdExterna(String idExterna) {
+		setHisIde(idExterna);
+	}
+
+	@Override
+	public void setIdInicial(Long idInicial) {
+		this.setHisIdIni(idInicial);
+	}
+
+	@Override
+	public Date getDataInicio() {
+		return getHisDtIni();
+	}
+
+	@Override
+	public void setDataInicio(Date dataInicio) {
+		setHisDtIni(dataInicio);
+	}
+
+	@Override
+	public Date getDataFim() {
+		return getHisDtFim();
+	}
+
+	@Override
+	public void setDataFim(Date dataFim) {
+		setHisDtFim(dataFim);
+	}
+
+	@Override
+	public String getLoteDeImportacao() {
+		return null;
+	}
+
+	@Override
+	public void setLoteDeImportacao(String loteDeImportacao) {
+	}
+
+	@Override
+	public int getNivelDeDependencia() {
+		return 0;
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return SincronizavelSuporte.semelhante(this, obj, profundidade);
+	}
+
+	@Override
+	public String getDescricaoExterna() {
+		return getCodigo();
+	}
+
+	@Override
+	public int compareTo(Sincronizavel o) {
+		if (!this.getClass().equals(o.getClass()))
+			return this.getClass().getName().compareTo(o.getClass().getName());
+		return this.getIdExterna().compareTo(o.getIdExterna());
+	}
+
+	@PostLoad
+	public void postLoad() {
+		this.setHisIde(criarIdExterna());
+	}
+
+	public String criarIdExterna() {
+		return Long.toString(this.getDefinicaoDeResponsavel().getIdInicial()) + "-"
+				+ Long.toString(this.getOrgaoUsuario().getId());
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfVariavel.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfVariavel.java
new file mode 100644
index 0000000000..820188f191
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/WfVariavel.java
@@ -0,0 +1,193 @@
+package br.gov.jfrj.siga.wf.model;
+
+import java.util.Date;
+
+import javax.persistence.Column;
+import javax.persistence.Entity;
+import javax.persistence.FetchType;
+import javax.persistence.GeneratedValue;
+import javax.persistence.Id;
+import javax.persistence.JoinColumn;
+import javax.persistence.ManyToOne;
+import javax.persistence.Table;
+
+import org.hibernate.annotations.BatchSize;
+
+import com.crivano.jflow.support.ProcessInstanceVariable;
+
+import br.gov.jfrj.siga.model.Assemelhavel;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.sinc.lib.SincronizavelSuporte;
+
+@Entity
+@BatchSize(size = 500)
+@Table(name = "sigawf.wf_variavel")
+public class WfVariavel implements ProcessInstanceVariable, Sincronizavel, Comparable<Sincronizavel> {
+	@Id
+	@GeneratedValue
+	@Column(name = "VARI_ID", unique = true, nullable = false)
+	private Long id;
+
+	@ManyToOne(fetch = FetchType.LAZY)
+	@JoinColumn(name = "PROC_ID")
+	private WfProcedimento procedimento;
+
+	@Column(name = "VARI_NM", length = 256)
+	private String nome;
+
+	@Column(name = "VARI_TX")
+	String string;
+
+	@Column(name = "VARI_DF")
+	Date date;
+
+	@Column(name = "VARI_FG")
+	Boolean bool;
+
+	@Column(name = "VARI_NR")
+	Double number;
+
+	public String getNome() {
+		return nome;
+	}
+
+	public void setNome(String nome) {
+		this.nome = nome;
+	}
+
+	@Override
+	public String getIdentifier() {
+		return getNome();
+	}
+
+	@Override
+	public void setIdentifier(String identifier) {
+		this.setNome(identifier);
+	}
+
+	@Override
+	public String getString() {
+		return string;
+	}
+
+	@Override
+	public void setString(String string) {
+		this.string = string;
+	}
+
+	@Override
+	public Date getDate() {
+		return date;
+	}
+
+	@Override
+	public void setDate(Date date) {
+		this.date = date;
+	}
+
+	@Override
+	public Boolean getBool() {
+		return bool;
+	}
+
+	@Override
+	public void setBool(Boolean bool) {
+		this.bool = bool;
+	}
+
+	@Override
+	public Double getNumber() {
+		return number;
+	}
+
+	@Override
+	public void setNumber(Double number) {
+		this.number = number;
+	}
+
+	@Override
+	public boolean semelhante(Assemelhavel obj, int profundidade) {
+		return SincronizavelSuporte.semelhante(this, obj, profundidade);
+	}
+
+	@Override
+	public Long getId() {
+		return this.id;
+	}
+
+	@Override
+	public String getIdExterna() {
+		return this.nome;
+	}
+
+	@Override
+	public void setIdExterna(String idExterna) {
+		this.nome = idExterna;
+	}
+
+	@Override
+	public Long getIdInicial() {
+		return null;
+	}
+
+	@Override
+	public void setIdInicial(Long idInicial) {
+	}
+
+	@Override
+	public Date getDataInicio() {
+		return null;
+	}
+
+	@Override
+	public void setDataInicio(Date dataInicio) {
+	}
+
+	@Override
+	public Date getDataFim() {
+		return null;
+	}
+
+	@Override
+	public void setDataFim(Date dataFim) {
+	}
+
+	@Override
+	public String getLoteDeImportacao() {
+		return null;
+	}
+
+	@Override
+	public void setLoteDeImportacao(String loteDeImportacao) {
+	}
+
+	@Override
+	public int getNivelDeDependencia() {
+		return 0;
+	}
+
+	@Override
+	public String getDescricaoExterna() {
+		return this.nome;
+	}
+
+	@Override
+	public int compareTo(Sincronizavel o) {
+		if (!this.getClass().equals(o.getClass()))
+			return this.getClass().getName().compareTo(o.getClass().getName());
+		return this.getIdExterna().compareTo(o.getIdExterna());
+	}
+
+	public WfProcedimento getProcedimento() {
+		return procedimento;
+	}
+
+	public void setProcedimento(WfProcedimento procedimento) {
+		this.procedimento = procedimento;
+	}
+
+	public void setId(Long id) {
+		this.id = id;
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfPrioridade.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfPrioridade.java
new file mode 100644
index 0000000000..7eb4453839
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfPrioridade.java
@@ -0,0 +1,24 @@
+package br.gov.jfrj.siga.wf.model.enm;
+
+public enum WfPrioridade {
+
+	MUITO_ALTA("Muito Alta"),
+	//
+	ALTA("Alta"),
+	//
+	MEDIA("Média"),
+	//
+	BAIXA("Baixa"),
+	//
+	MUITO_BAIXA("Muito Baixa");
+
+	private final String descr;
+
+	WfPrioridade(String descr) {
+		this.descr = descr;
+	}
+
+	public String getDescr() {
+		return this.descr;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeDesignacao.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeDesignacao.java
new file mode 100644
index 0000000000..209a813c75
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeDesignacao.java
@@ -0,0 +1,22 @@
+package br.gov.jfrj.siga.wf.model.enm;
+
+import com.crivano.jflow.model.ResponsibleKind;
+
+public enum WfTipoDeDesignacao implements ResponsibleKind {
+	UNICA("Somente nesta tarefa"),
+	//
+	SEMPRE("Sempre nesta tarefa"),
+	//
+	TODAS("Em todas as tarefas");
+
+	private final String descr;
+
+	WfTipoDeDesignacao(String descr) {
+		this.descr = descr;
+	}
+
+	@Override
+	public String getDescr() {
+		return this.descr;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDePrincipal.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDePrincipal.java
new file mode 100644
index 0000000000..82f3b94982
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDePrincipal.java
@@ -0,0 +1,18 @@
+package br.gov.jfrj.siga.wf.model.enm;
+
+import com.crivano.jflow.model.ResponsibleKind;
+
+public enum WfTipoDePrincipal implements ResponsibleKind {
+	DOC("Documento");
+
+	private final String descr;
+
+	WfTipoDePrincipal(String descr) {
+		this.descr = descr;
+	}
+
+	@Override
+	public String getDescr() {
+		return this.descr;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeResponsavel.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeResponsavel.java
new file mode 100644
index 0000000000..e110e51b73
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeResponsavel.java
@@ -0,0 +1,54 @@
+package br.gov.jfrj.siga.wf.model.enm;
+
+import com.crivano.jflow.model.ResponsibleKind;
+
+public enum WfTipoDeResponsavel implements ResponsibleKind {
+	PRINCIPAL_CADASTRANTE("Principal: Cadastrante"),
+	//
+	PRINCIPAL_LOTA_CADASTRANTE("Principal: Lotação do Cadastrante"),
+	//
+	PRINCIPAL_TITULAR("Principal: Titular"),
+	//
+	PRINCIPAL_LOTA_TITULAR("Principal: Lotação do Titular"),
+	//
+	PRINCIPAL_SUBSCRITOR("Principal: Subscritor"),
+	//
+	PRINCIPAL_LOTA_SUBSCRITOR("Principal: Lotação do Subscritor"),
+	//
+	PRINCIPAL_DESTINATARIO("Principal: Destinatário"),
+	//
+	PRINCIPAL_LOTA_DESTINATARIO("Principal: Lotação do Destinatário"),
+	//
+	PRINCIPAL_GESTOR("Principal: Gestor"),
+	//
+	PRINCIPAL_LOTA_GESTOR("Principal: Lotação do Gestor"),
+	//
+	PRINCIPAL_FISCAL_TECNICO("Principal: Fiscal Técnico"),
+	//
+	PRINCIPAL_LOTA_FISCAL_TECNICO("Principal: Lotação do Fiscal Técnico"),
+	//
+	PRINCIPAL_FISCAL_ADMINISTRATIVO("Principal: Fiscal Administrativo"),
+	//
+	PRINCIPAL_LOTA_FISCAL_ADMINISTRATIVO("Principal: Lotação do Fiscal Administrativo"),
+	//
+	PRINCIPAL_INTERESSADO("Principal: Interessado"),
+	//
+	PRINCIPAL_LOTA_INTERESSADO("Principal: Lotação do Interessado"),
+	//
+	RESPONSAVEL("Cadastrado"),
+	//
+	PESSOA("Pessoa"),
+	//
+	LOTACAO("Lotação");
+
+	private final String descr;
+
+	WfTipoDeResponsavel(String descr) {
+		this.descr = descr;
+	}
+
+	@Override
+	public String getDescr() {
+		return this.descr;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeTarefa.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeTarefa.java
new file mode 100644
index 0000000000..6e1dc7a0a5
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/enm/WfTipoDeTarefa.java
@@ -0,0 +1,60 @@
+package br.gov.jfrj.siga.wf.model.enm;
+
+import com.crivano.jflow.Task;
+import com.crivano.jflow.model.TaskKind;
+import com.crivano.jflow.task.TaskDecision;
+import com.crivano.jflow.task.TaskEmail;
+import com.crivano.jflow.task.TaskEval;
+
+import br.gov.jfrj.siga.wf.model.task.WfTarefaAguardarAssinatura;
+import br.gov.jfrj.siga.wf.model.task.WfTarefaArquivar;
+import br.gov.jfrj.siga.wf.model.task.WfTarefaFormulario;
+import br.gov.jfrj.siga.wf.model.task.WfTarefaIncluirDocumento;
+import br.gov.jfrj.siga.wf.model.task.WfTarefaTramitar;
+
+public enum WfTipoDeTarefa implements TaskKind {
+
+	//
+	AGUARDAR_ASSINATURA_PRINCIPAL("Aguardar Assinatura", "rectangle", WfTarefaAguardarAssinatura.class),
+	//
+	TRAMITAR_PRINCIPAL("Enviar", "rectangle", WfTarefaTramitar.class),
+	//
+	ARQUIVAR_PRINCIPAL("Arquivar", "rectangle", WfTarefaArquivar.class),
+	//
+	INCLUIR_DOCUMENTO("Incluir Documento", "rectangle", WfTarefaIncluirDocumento.class),
+	//
+	FORMULARIO("Formulário", "rectangle", WfTarefaFormulario.class),
+	//
+	DECISAO("Decisão", "diamond", TaskDecision.class),
+	//
+	EXECUTAR("Executar", "rectangle", TaskEval.class),
+	//
+	EMAIL("Email", "folder", TaskEmail.class);
+
+	private final String descr;
+
+	private Class<? extends Task> clazz;
+
+	private String graphKind;
+
+	WfTipoDeTarefa(String descr, String graphKind, Class<? extends Task> clazz) {
+		this.descr = descr;
+		this.graphKind = graphKind;
+		this.clazz = clazz;
+	}
+
+	@Override
+	public String getDescr() {
+		return this.descr;
+	}
+
+	@Override
+	public Class<? extends Task> getClazz() {
+		return this.clazz;
+	}
+
+	@Override
+	public String getGraphKind() {
+		return this.graphKind;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaAguardarAssinatura.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaAguardarAssinatura.java
new file mode 100644
index 0000000000..d8478577e0
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaAguardarAssinatura.java
@@ -0,0 +1,42 @@
+package br.gov.jfrj.siga.wf.model.task;
+
+import java.util.Map;
+
+import com.crivano.jflow.Engine;
+import com.crivano.jflow.TaskResult;
+import com.crivano.jflow.model.enm.TaskResultKind;
+import com.crivano.jflow.task.TaskForm;
+
+import br.gov.jfrj.siga.Service;
+import br.gov.jfrj.siga.base.util.Utils;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeDesvio;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeVariavel;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeTarefa;
+import br.gov.jfrj.siga.wf.util.WfResp;
+
+public class WfTarefaAguardarAssinatura extends
+		TaskForm<WfDefinicaoDeProcedimento, WfDefinicaoDeTarefa, WfResp, WfTipoDeTarefa, WfTipoDeResponsavel, WfDefinicaoDeVariavel, WfDefinicaoDeDesvio, WfProcedimento> {
+
+	@Override
+	public String getEvent(WfDefinicaoDeTarefa tarefa, WfProcedimento pi) {
+		return pi.getPrincipal() + "|" + pi.getId() + "|" + tarefa.getId();
+	}
+
+	@Override
+	public TaskResult execute(WfDefinicaoDeTarefa td, WfProcedimento pi, Engine engine) throws Exception {
+		if (Utils.empty(pi.getPrincipal()) || Service.getExService().isAssinado(pi.getPrincipal(), null))
+			return new TaskResult(TaskResultKind.DONE, null, null, null, null);
+		return new TaskResult(TaskResultKind.PAUSE, null, null, getEvent(td, pi), pi.calcResponsible(td));
+	}
+
+	@Override
+	public TaskResult resume(WfDefinicaoDeTarefa td, WfProcedimento pi, Integer detourIndex, Map<String, Object> param,
+			Engine<?, ?, ?> engine) throws Exception {
+		return execute(td, pi, engine);
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaArquivar.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaArquivar.java
new file mode 100644
index 0000000000..cf611fe576
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaArquivar.java
@@ -0,0 +1,23 @@
+package br.gov.jfrj.siga.wf.model.task;
+
+import com.crivano.jflow.Engine;
+import com.crivano.jflow.Task;
+import com.crivano.jflow.TaskResult;
+import com.crivano.jflow.model.enm.TaskResultKind;
+
+import br.gov.jfrj.siga.Service;
+import br.gov.jfrj.siga.base.util.Utils;
+import br.gov.jfrj.siga.parser.SiglaParser;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+
+public class WfTarefaArquivar implements Task<WfDefinicaoDeTarefa, WfProcedimento> {
+
+	@Override
+	public TaskResult execute(WfDefinicaoDeTarefa td, WfProcedimento pi, Engine engine) throws Exception {
+		if (!Utils.empty(pi.getPrincipal()))
+			Service.getExService().arquivarCorrente(pi.getPrincipal(), null, null);
+		return new TaskResult(TaskResultKind.DONE, null, null, null, null);
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaFormulario.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaFormulario.java
new file mode 100644
index 0000000000..bb71b10249
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaFormulario.java
@@ -0,0 +1,22 @@
+package br.gov.jfrj.siga.wf.model.task;
+
+import com.crivano.jflow.task.TaskForm;
+
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeDesvio;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeVariavel;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeTarefa;
+import br.gov.jfrj.siga.wf.util.WfResp;
+
+public class WfTarefaFormulario extends
+		TaskForm<WfDefinicaoDeProcedimento, WfDefinicaoDeTarefa, WfResp, WfTipoDeTarefa, WfTipoDeResponsavel, WfDefinicaoDeVariavel, WfDefinicaoDeDesvio, WfProcedimento> {
+
+	@Override
+	public String getEvent(WfDefinicaoDeTarefa tarefa, WfProcedimento pi) {
+		return pi.getPrincipal() + "|" + pi.getId() + "|" + tarefa.getId();
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaIncluirDocumento.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaIncluirDocumento.java
new file mode 100644
index 0000000000..2b0c0c3b93
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaIncluirDocumento.java
@@ -0,0 +1,41 @@
+package br.gov.jfrj.siga.wf.model.task;
+
+import java.util.Map;
+
+import com.crivano.jflow.Engine;
+import com.crivano.jflow.TaskResult;
+import com.crivano.jflow.model.enm.TaskResultKind;
+import com.crivano.jflow.task.TaskForm;
+
+import br.gov.jfrj.siga.Service;
+import br.gov.jfrj.siga.base.util.Utils;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeDesvio;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeVariavel;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeTarefa;
+import br.gov.jfrj.siga.wf.util.WfResp;
+
+public class WfTarefaIncluirDocumento extends
+		TaskForm<WfDefinicaoDeProcedimento, WfDefinicaoDeTarefa, WfResp, WfTipoDeTarefa, WfTipoDeResponsavel, WfDefinicaoDeVariavel, WfDefinicaoDeDesvio, WfProcedimento> {
+
+	@Override
+	public String getEvent(WfDefinicaoDeTarefa tarefa, WfProcedimento pi) {
+		return pi.getPrincipal() + "|" + pi.getId() + "|" + tarefa.getId();
+	}
+
+	@Override
+	public TaskResult execute(WfDefinicaoDeTarefa td, WfProcedimento pi, Engine engine) throws Exception {
+		if (Utils.empty(pi.getPrincipal()) || Service.getExService().isModeloIncluso(pi.getPrincipal(), td.getRefId()))
+			return new TaskResult(TaskResultKind.DONE, null, null, null, null);
+		return new TaskResult(TaskResultKind.PAUSE, null, null, getEvent(td, pi), pi.calcResponsible(td));
+	}
+
+	@Override
+	public TaskResult resume(WfDefinicaoDeTarefa td, WfProcedimento pi, Integer detourIndex, Map<String, Object> param,
+			Engine<?, ?, ?> engine) throws Exception {
+		return execute(td, pi, engine);
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaTramitar.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaTramitar.java
new file mode 100644
index 0000000000..1c9bd3170e
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/model/task/WfTarefaTramitar.java
@@ -0,0 +1,27 @@
+package br.gov.jfrj.siga.wf.model.task;
+
+import com.crivano.jflow.Engine;
+import com.crivano.jflow.Task;
+import com.crivano.jflow.TaskResult;
+import com.crivano.jflow.model.enm.TaskResultKind;
+
+import br.gov.jfrj.siga.Service;
+import br.gov.jfrj.siga.base.util.Utils;
+import br.gov.jfrj.siga.parser.SiglaParser;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.util.WfResp;
+
+public class WfTarefaTramitar implements Task<WfDefinicaoDeTarefa, WfProcedimento> {
+
+	@Override
+	public TaskResult execute(WfDefinicaoDeTarefa td, WfProcedimento pi, Engine engine) throws Exception {
+		if (!Utils.empty(pi.getPrincipal())) {
+			WfResp destino = pi.calcResponsible(td);
+			String siglaDestino = SiglaParser.makeSigla(destino.getPessoa(), destino.getLotacao());
+			Service.getExService().transferir(pi.getPrincipal(), siglaDestino, null, true);
+		}
+		return new TaskResult(TaskResultKind.DONE, null, null, null, null);
+	}
+
+}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/WfJobExecutorServlet.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/NaoSerializar.java
similarity index 82%
rename from sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/WfJobExecutorServlet.java
rename to siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/NaoSerializar.java
index a058d60964..044487ec7d 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/WfJobExecutorServlet.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/NaoSerializar.java
@@ -16,8 +16,12 @@
  *     You should have received a copy of the GNU General Public License
  *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
  ******************************************************************************/
-package br.gov.jfrj.siga.wf.servlet;
+package br.gov.jfrj.siga.wf.util;
 
-public class WfJobExecutorServlet {
+import java.lang.annotation.Retention;
+import java.lang.annotation.RetentionPolicy;
+
+@Retention(RetentionPolicy.RUNTIME)
+public @interface NaoSerializar {
 
 }
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/SiglaUtils.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/SiglaUtils.java
new file mode 100644
index 0000000000..bf10e40dac
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/SiglaUtils.java
@@ -0,0 +1,60 @@
+package br.gov.jfrj.siga.wf.util;
+
+import java.util.Calendar;
+import java.util.Map;
+import java.util.TreeMap;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
+
+import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
+import br.gov.jfrj.siga.dp.dao.CpDao;
+
+public class SiglaUtils {
+
+	public static class SiglaDecodificada {
+		public Long id;
+		public Integer ano;
+		public Integer numero;
+		public CpOrgaoUsuario orgaoUsuario;
+	}
+
+	public static SiglaDecodificada parse(String sigla, String tipo, CpOrgaoUsuario ouDefault) {
+		SiglaDecodificada d = new SiglaDecodificada();
+
+		sigla = sigla.trim().toUpperCase();
+
+		Map<String, CpOrgaoUsuario> mapAcronimo = new TreeMap<String, CpOrgaoUsuario>();
+		for (CpOrgaoUsuario ou : CpDao.getInstance().listarOrgaosUsuarios()) {
+			mapAcronimo.put(ou.getAcronimoOrgaoUsu(), ou);
+			mapAcronimo.put(ou.getSiglaOrgaoUsu(), ou);
+		}
+		StringBuilder acronimos = new StringBuilder();
+		for (String s : mapAcronimo.keySet()) {
+			if (acronimos.length() > 0)
+				acronimos.append("|");
+			acronimos.append(s);
+		}
+
+		final Pattern p2 = Pattern.compile("^TMP" + tipo + "-?([0-9]+)");
+		final Pattern p1 = Pattern
+				.compile("^(" + acronimos.toString() + ")?-?(" + tipo + ")?-?(?:(20[0-9]{2})/?)??([0-9]{1,5})$");
+		final Matcher m2 = p2.matcher(sigla);
+		final Matcher m1 = p1.matcher(sigla);
+
+		if (m2.find()) {
+			d.id = Long.parseLong(m2.group(1));
+			return d;
+		} else if (m1.find()) {
+			d.ano = Integer.parseInt(m1.group(3));
+			d.numero = Integer.parseInt(m1.group(4));
+			d.orgaoUsuario = mapAcronimo.get(m1.group(1));
+			if (d.orgaoUsuario == null && ouDefault != null)
+				d.orgaoUsuario = ouDefault;
+			if (d.ano == null)
+				d.ano = (int) Calendar.getInstance().get(Calendar.YEAR);
+			return d;
+		} else
+			throw new NumberFormatException("Formato de sigla inválido");
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAcaoHelper.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAcaoHelper.java
new file mode 100644
index 0000000000..fc3d8e886e
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAcaoHelper.java
@@ -0,0 +1,32 @@
+package br.gov.jfrj.siga.wf.util;
+
+import java.util.TreeMap;
+
+import com.crivano.jlogic.Expression;
+
+import br.gov.jfrj.siga.base.AcaoVO;
+
+public class WfAcaoHelper {
+
+	public static AcaoVO criarAcao(String icone, String nome, String nameSpace, String acao, Expression pode) {
+		boolean f = pode.eval();
+		return new AcaoVO(icone, nome, nameSpace, acao, f, formatarExplicacao(pode, f), null, null, null, null, null,
+				null);
+	}
+
+	public static AcaoVO criarAcao(String icone, String nome, String nameSpace, String acao, Expression pode,
+			String msgConfirmacao, TreeMap<String, String> params, String pre, String pos, String classe,
+			String modal) {
+		boolean f = pode.eval();
+		return new AcaoVO(icone, nome, nameSpace, acao, f, formatarExplicacao(pode, f), msgConfirmacao, params, pre,
+				pos, classe, modal);
+	}
+
+	public static String formatarExplicacao(Expression exp, boolean f) {
+		String s = exp.explain(f).replace("_not_", "não está");
+		s = s.replace("_and_", "e").replace("_or_", "ou");
+		s = "Está " + (f ? "h" : "des") + "abilitado porque " + s;
+		return s;
+	};
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAcaoVO.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAcaoVO.java
new file mode 100644
index 0000000000..b820a67564
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAcaoVO.java
@@ -0,0 +1,119 @@
+package br.gov.jfrj.siga.wf.util;
+
+import java.util.Map;
+
+import com.crivano.jlogic.Expression;
+
+import br.gov.jfrj.siga.base.AcaoVO;
+
+public class WfAcaoVO extends AcaoVO {
+
+	public static WfAcaoVO.Builder builder() {
+		return new WfAcaoVO.Builder();
+	}
+
+	public static class Builder {
+		private String icone;
+		private String nome;
+		private String nameSpace;
+		private String acao;
+		private boolean pode;
+		private String msgConfirmacao;
+		private String pre;
+		private String pos;
+		private String classe;
+		private String modal;
+		private Map<String, String> params;
+		private String explicacao;
+		private boolean post;
+
+		public Builder icone(String icone) {
+			this.icone = icone;
+			return this;
+		}
+
+		public Builder nome(String nome) {
+			this.nome = nome;
+			return this;
+		}
+
+		public Builder nameSpace(String nameSpace) {
+			this.nameSpace = nameSpace;
+			return this;
+		}
+
+		public Builder acao(String acao) {
+			this.acao = acao;
+			return this;
+		}
+
+		public Builder pode(boolean pode) {
+			this.pode = pode;
+			return this;
+		}
+
+		public Builder msgConfirmacao(String msgConfirmacao) {
+			this.msgConfirmacao = msgConfirmacao;
+			return this;
+		}
+
+		public Builder pre(String pre) {
+			this.pre = pre;
+			return this;
+		}
+
+		public Builder pos(String pos) {
+			this.pos = pos;
+			return this;
+		}
+
+		public Builder classe(String classe) {
+			this.classe = classe;
+			return this;
+		}
+
+		public Builder modal(String modal) {
+			this.modal = modal;
+			return this;
+		}
+
+		public Builder params(Map<String, String> params) {
+			this.params = params;
+			return this;
+		}
+
+		public Builder explicacao(String explicacao) {
+			this.explicacao = explicacao;
+			return this;
+		}
+
+		public Builder post(boolean post) {
+			this.post = post;
+			return this;
+		}
+
+		public Builder exp(Expression exp) {
+			this.pode = exp.eval();
+			this.explicacao = WfAcaoHelper.formatarExplicacao(exp, this.pode);
+			return this;
+		}
+
+		public AcaoVO build() {
+			AcaoVO acaoVO = new AcaoVO();
+			acaoVO.setIcone(icone);
+			acaoVO.setNome(nome);
+			acaoVO.setNameSpace(nameSpace);
+			acaoVO.setAcao(acao);
+			acaoVO.setPode(pode);
+			acaoVO.setMsgConfirmacao(msgConfirmacao);
+			acaoVO.setPre(pre);
+			acaoVO.setPos(pos);
+			acaoVO.setClasse(classe);
+			acaoVO.setModal(modal);
+			acaoVO.setParams(params);
+			acaoVO.setExplicacao(explicacao);
+			acaoVO.setPost(post);
+			return acaoVO;
+		}
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAddressResolver.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAddressResolver.java
deleted file mode 100644
index 8b136902ce..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAddressResolver.java
+++ /dev/null
@@ -1,71 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.util.ArrayList;
-import java.util.List;
-
-import org.jbpm.mail.AddressResolver;
-
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-/**
- * Classe utilizada para descobrir o endereço de e-mail baseado na sigla de uma
- * pessoa. Esta classe é definida em siga-wf/src/jbpm.cfg.xml.
- * 
- * @author kpf
- * 
- */
-public class WfAddressResolver implements AddressResolver {
-
-	/**
-	 * Retorna o e-mail do ator, caso exista.
-	 */
-	// Retornar uma string, string[] ou list<string>. Ou null se o usuário não
-	// existir
-	public Object resolveAddress(String actorId) {
-		if (actorId == null || actorId.trim().length() == 0)
-			return null;
-
-		DpPessoa ator = WfDao.getInstance().getPessoaFromSigla(actorId);
-		if (ator != null) {
-			return ator.getEmailPessoaAtual();
-		}
-
-		DpLotacao lota = WfDao.getInstance().getLotacaoFromSigla(actorId);
-		if (lota != null) {
-			List<DpPessoa> l = null;
-			try {
-				l = WfDao.getInstance().pessoasPorLotacao(lota.getId(), false,true);
-			} catch (AplicacaoException e) {
-				e.printStackTrace();
-				return null;
-			}
-			List<String> emails = new ArrayList<String>();
-			for (DpPessoa pessoa : l) {
-				emails.add(pessoa.getEmailPessoaAtual());
-			}
-			return emails;
-		}
-		return null;
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAssignable.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAssignable.java
deleted file mode 100644
index f39c42b5c3..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAssignable.java
+++ /dev/null
@@ -1,45 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.taskmgmt.exe.Assignable;
-
-public class WfAssignable implements Assignable {
-	private static final long serialVersionUID = -4506693490654427358L;
-
-	String actorId;
-	String[] pooledActors;
-
-	public String getActorId() {
-		return actorId;
-	}
-
-	public void setActorId(String actorId) {
-		this.actorId = actorId;
-	}
-
-	public String[] getPooledActors() {
-		return pooledActors;
-	}
-
-	public void setPooledActors(String[] pooledActors) {
-		this.pooledActors = pooledActors;
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAssignmentHandler.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAssignmentHandler.java
deleted file mode 100644
index 5affc631df..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAssignmentHandler.java
+++ /dev/null
@@ -1,155 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.hibernate.LockMode;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.taskmgmt.def.AssignmentHandler;
-import org.jbpm.taskmgmt.def.Swimlane;
-import org.jbpm.taskmgmt.def.Task;
-import org.jbpm.taskmgmt.exe.Assignable;
-import org.jbpm.taskmgmt.exe.SwimlaneInstance;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.dao.DpLotacaoDaoFiltro;
-import br.gov.jfrj.siga.dp.dao.DpPessoaDaoFiltro;
-import br.gov.jfrj.siga.wf.WfConfiguracao;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-/**
- * Classe utilizada para designar um responsável para uma raia ou tarefa. Esta
- * classe é definida em siga-wf/src/jbpm.cfg.xml.
- * 
- * @author kpf
- * 
- */
-public class WfAssignmentHandler implements AssignmentHandler {
-
-	private static final long serialVersionUID = -5731439604710820114L;
-
-	/**
-	 * Designa um responsável.
-	 * 
-	 * @param assignable - raia ou tarefa 
-	 * @param ctx - Contexto de execução. Contém as informações do processo, token, etc.
-	 */
-	public void assign(Assignable assignable, ExecutionContext ctx)
-			throws Exception {
-
-		ProcessDefinition pd;
-		String procedimento;
-		String raia;
-		String tarefa;
-		if (assignable instanceof TaskInstance) {
-			TaskInstance t = (TaskInstance) assignable;
-			pd = t.getTask().getProcessDefinition();
-			raia = null;
-			tarefa = t.getName();
-		} else if (assignable instanceof SwimlaneInstance) {
-			SwimlaneInstance s = (SwimlaneInstance) assignable;
-			pd = s.getSwimlane().getTaskMgmtDefinition().getProcessDefinition();
-			raia = s.getName();
-			tarefa = null;
-		} else
-			return;
-		procedimento = pd.getName();
-
-		String iniciador = null;
-		String lotaIniciador = null;
-		DpPessoa titularIniciador = null;
-		DpLotacao lotaTitularIniciador = null;
-		iniciador = (String) ctx.getContextInstance().getVariable(
-				Wf.getInstance().getBL().WF_TITULAR);
-		ProcessInstance piTop = ctx.getProcessInstance();
-		while (iniciador == null && piTop.getSuperProcessToken() != null) {
-			piTop = piTop.getSuperProcessToken()
-					.getProcessInstance();
-			iniciador = (String) piTop.getContextInstance().getVariable(
-					Wf.getInstance().getBL().WF_TITULAR);
-		}
-		if (iniciador != null) {
-			DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-			flt.setSigla(iniciador);
-			titularIniciador = (DpPessoa) WfDao.getInstance()
-					.consultarPorSigla(flt);
-			lotaIniciador = (String) piTop.getContextInstance().getVariable(
-					Wf.getInstance().getBL().WF_LOTA_TITULAR);
-			DpLotacaoDaoFiltro fltLota = new DpLotacaoDaoFiltro();
-			fltLota.setSiglaCompleta(lotaIniciador);
-			lotaTitularIniciador = (DpLotacao) WfDao.getInstance()
-					.consultarPorSigla(fltLota);
-		} else {
-			Swimlane s = ctx.getTaskMgmtInstance().getTaskMgmtDefinition()
-					.getStartTask().getSwimlane();
-			if (s != null) {
-				SwimlaneInstance si = ctx.getTaskMgmtInstance()
-						.getSwimlaneInstance(s.getName());
-				if (si!=null){
-					iniciador = si.getActorId();
-				}
-				if (iniciador != null) {
-					DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-					flt.setSigla(iniciador);
-					titularIniciador = (DpPessoa) WfDao.getInstance()
-							.consultarPorSigla(flt);
-					lotaTitularIniciador = titularIniciador.getLotacao();
-				}
-			}
-		}
-
-		DpPessoa titularAnterior = null;
-		DpLotacao lotaTitularAnterior = null;
-		String anterior = ctx.getTaskInstance().getActorId();
-		if (anterior != null) {
-			DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-			flt.setSigla(anterior);
-			titularAnterior = (DpPessoa) WfDao.getInstance().consultarPorSigla(
-					flt);
-			lotaTitularAnterior = titularAnterior.getLotacao();
-		}
-
-		WfConfiguracao cfg = Wf.getInstance().getComp().designar(
-				titularIniciador, lotaTitularIniciador, titularAnterior,
-				lotaTitularAnterior, procedimento, raia, tarefa);
-
-		if (cfg == null) {
-			throw new AplicacaoException(
-					"Não foi possível localizar uma configuração para designar o responsável.");
-		}
-
-		if (cfg.getAtor() != null) {
-			assignable.setActorId(cfg.getAtor().getSigla());
-		}
-		if (cfg.getLotaAtor() != null) {
-			String[] a = new String[] { cfg.getLotaAtor().getSiglaCompleta() };
-			assignable.setPooledActors(a);
-		}
-		if (cfg.getExpressao() != null) {
-			WfExpressionAssignmentHandler expah = new WfExpressionAssignmentHandler();
-			expah.assign(cfg.getExpressao(), assignable, ctx);
-		}
-		return;
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAuthenticationService.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAuthenticationService.java
deleted file mode 100644
index d1aa7696b6..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAuthenticationService.java
+++ /dev/null
@@ -1,128 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.security.authentication.DefaultAuthenticationService;
-
-import br.gov.jfrj.siga.acesso.ConheceUsuario;
-import br.gov.jfrj.siga.acesso.UsuarioAutenticado;
-import br.gov.jfrj.siga.cp.CpIdentidade;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.model.ContextoPersistencia;
-
-/**
- * Classe que representa o serviço de autenticação do sistema de workflow. Esta
- * classe é definida em siga-wf/src/jbpm.cfg.xml.
- * 
- * @author kpf
- * 
- */
-public class WfAuthenticationService extends DefaultAuthenticationService
-		implements ConheceUsuario {
-
-	String actorId = null;
-
-	DpPessoa cadastrante = null;
-	DpPessoa titular = null;
-	DpLotacao lotaTitular = null;
-	CpIdentidade identidadeCadastrante = null;
-
-	/**
-	 * Retorna o id do ator.
-	 */
-	@Override
-	public String getActorId() {
-		if (this.actorId == null) {
-			if (ContextoPersistencia.getUserPrincipal() == null)
-				return null;
-			try {
-				String principal = ContextoPersistencia.getUserPrincipal();
-				UsuarioAutenticado.carregarUsuarioAutenticado(principal, this);
-			} catch (Exception e) {
-				e.printStackTrace();
-				return null;
-			}
-
-			if (getCadastrante() == null)
-				return null;
-
-			this.actorId = getCadastrante().getSigla();
-		}
-		return this.actorId;
-	}
-
-	/**
-	 * Define o id do ator.
-	 */
-	@Override
-	public void setActorId(String actorId) {
-		this.actorId = actorId;
-	}
-
-	/**
-	 * Retorna o cadastrante, ou seja, a pessoa que está operando o sistema.
-	 */
-	public DpPessoa getCadastrante() {
-		return cadastrante;
-	}
-
-	/**
-	 * Define o cadastrante, ou seja, a pessoa que está operando o sistema.
-	 */
-	public void setCadastrante(DpPessoa cadastrante) {
-		this.cadastrante = cadastrante;
-	}
-
-	/**
-	 * Retorna o titular, ou seja, quem é responsável oficial.
-	 */
-	public DpPessoa getTitular() {
-		return titular;
-	}
-
-	/**
-	 * Define o titular, ou seja, quem é responsável oficial.
-	 */
-	public void setTitular(DpPessoa titular) {
-		this.titular = titular;
-	}
-
-	/**
-	 * Retorna a lotação do titular
-	 */
-	public DpLotacao getLotaTitular() {
-		return lotaTitular;
-	}
-
-	/**
-	 * Define a lotação do titular.
-	 */
-	public void setLotaTitular(DpLotacao lotaTitular) {
-		this.lotaTitular = lotaTitular;
-	}
-
-	public CpIdentidade getIdentidadeCadastrante() {
-		return identidadeCadastrante;
-	}
-
-	public void setIdentidadeCadastrante(CpIdentidade identidadeCadastrante) {
-		this.identidadeCadastrante = identidadeCadastrante;
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAuthenticationServiceFactory.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAuthenticationServiceFactory.java
deleted file mode 100644
index 7345d89618..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfAuthenticationServiceFactory.java
+++ /dev/null
@@ -1,52 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.security.authentication.DefaultAuthenticationServiceFactory;
-import org.jbpm.svc.Service;
-
-/**
- * Classe que representa uma fábrica de serviços de autenticação.
- * @author kpf
- *
- */
-public class WfAuthenticationServiceFactory extends
-		DefaultAuthenticationServiceFactory {
-
-	WfAuthenticationService as = null;
-
-	/**
-	 * Fecha a fábrica.
-	 */
-	@Override
-	public void close() {
-		// TODO Auto-generated method stub
-		super.close();
-	}
-
-	/**
-	 * Retorna um serviço de autenticação WfAuthenticationService.
-	 */
-	@Override
-	public Service openService() {
-		as = new WfAuthenticationService();
-		return as;
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContext.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContext.java
new file mode 100644
index 0000000000..5610824a1c
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContext.java
@@ -0,0 +1,16 @@
+package br.gov.jfrj.siga.wf.util;
+
+import com.crivano.jflow.model.ProcessInstance;
+
+public class WfContext {
+	ProcessInstance pi;
+
+	WfContext(ProcessInstance pi) {
+		this.pi = pi;
+	}
+
+	public void set(String var, Object value) {
+		pi.getVariable().put(var, value);
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContextBuilder.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContextBuilder.java
deleted file mode 100644
index c4e800f0f3..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContextBuilder.java
+++ /dev/null
@@ -1,86 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.JbpmConfiguration;
-import org.jbpm.persistence.JbpmPersistenceException;
-
-/**
- * Classe que representa um construtor de contexto do sistema de workflow.
- * 
- * @author kpf
- * 
- */
-public class WfContextBuilder {
-
-	private static final ThreadLocal<WfJbpmContext> localContext = new ThreadLocal<WfJbpmContext>();
-	private static JbpmConfiguration configuration = null;
-
-	/**
-	 * Retorna uma configuração do JBPM.
-	 * 
-	 * @return
-	 */
-	public static JbpmConfiguration getConfiguration() {
-		return configuration;
-	}
-
-	public static void setConfiguration(JbpmConfiguration config) {
-		if (configuration == null)
-			configuration = config;
-	}
-
-	/**
-	 * Cria uma nova configuração do JBPM.
-	 */
-	public static void createJbpmContext() {
-		if (localContext.get() == null)
-			localContext.set(new WfJbpmContext());
-	}
-
-	/**
-	 * Retorna o contexto do JBPM.
-	 * 
-	 * @return
-	 */
-	public static WfJbpmContext getJbpmContext() {
-		createJbpmContext();
-		return localContext.get();
-	}
-
-	/**
-	 * Fecha o contexto do JBPM.
-	 */
-	public static void closeContext() {
-		WfJbpmContext context = getJbpmContext();
-		try {
-			context.getJbpmContext().close();
-		} catch (JbpmPersistenceException e) {
-			// Nato: swallow can't rollback exception
-			if (!"cannot honor rollback request under external transaction manager"
-					.equals(e.getMessage())) {
-				throw e;
-			}
-		} catch (Exception ex) {
-			ex.printStackTrace();
-		}
-		localContext.remove();
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContextTest.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContextTest.java
deleted file mode 100644
index 8fc35cc186..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfContextTest.java
+++ /dev/null
@@ -1,60 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.util.List;
-
-import org.jbpm.JbpmConfiguration;
-import org.jbpm.graph.def.ProcessDefinition;
-
-/**
- * Classe utilitária utilizada para testar o contexto do JBPM.
- * 
- * @author kpf
- * 
- */
-public class WfContextTest {
-
-	private static final String PROCEDIMENTO_A_REMOVER = "testeNovo";
-
-	/**
-	 * Remove um procedimento com todas as suas versões. CUIDADO AO USAR ESTE
-	 * MÉTODO!.
-	 * 
-	 * @param args
-	 */
-	public static void main(String[] args) {
-
-		JbpmConfiguration conf = WfContextBuilder.getConfiguration();
-		WfJbpmContext ctx = WfContextBuilder.getJbpmContext();
-
-		// Rotina para remover procedimentos. Utilizar com muito cuidado!
-		System.out.println("Removendo procedimento: " + PROCEDIMENTO_A_REMOVER);
-		for (ProcessDefinition pd : (List<ProcessDefinition>) ctx
-				.getGraphSession().findAllProcessDefinitionVersions(
-						PROCEDIMENTO_A_REMOVER)) {
-			if (pd.getVersion() != 19 && pd.getVersion() != 16) {
-				System.out.println("Removendo versão: " + pd.getVersion());
-				ctx.getGraphSession().deleteProcessDefinition(pd);
-			}
-		}
-		System.out.println("Removido: " + PROCEDIMENTO_A_REMOVER);
-		ctx.getJbpmContext().close();
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfEngine.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfEngine.java
new file mode 100644
index 0000000000..4c514577a8
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfEngine.java
@@ -0,0 +1,21 @@
+package br.gov.jfrj.siga.wf.util;
+
+import com.crivano.jflow.EngineImpl;
+
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeDesvio;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeVariavel;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDeTarefa;
+
+public class WfEngine extends
+		EngineImpl<WfDefinicaoDeProcedimento, WfDefinicaoDeTarefa, WfResp, WfTipoDeTarefa, WfTipoDeResponsavel, WfDefinicaoDeVariavel, WfDefinicaoDeDesvio, WfProcedimento, WfHandler, WfDao> {
+
+	public WfEngine(WfDao dao, WfHandler handler) {
+		super(dao, handler);
+	}
+
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfExecutionEnvironment.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfExecutionEnvironment.java
deleted file mode 100644
index 8e788ad909..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfExecutionEnvironment.java
+++ /dev/null
@@ -1,111 +0,0 @@
-package br.gov.jfrj.siga.wf.util;
-
-import org.apache.log4j.Logger;
-import org.hibernate.Session;
-import org.hibernate.cfg.Configuration;
-
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.model.dao.ModeloDao;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-public class WfExecutionEnvironment {
-	private static final Logger log = Logger
-			.getLogger(WfExecutionEnvironment.class);
-
-	private void fechaContextoWorkflow() {
-		try {
-			WfContextBuilder.closeContext();
-		} catch (Exception ex) {
-			log.error(
-					"[fechaContextoWorkflow] - Ocorreu um erro ao fechar o contexto do Workflow",
-					ex);
-			// ex.printStackTrace();
-		}
-	}
-
-	private void fechaSessaoHibernate() {
-		try {
-			WfHibernateUtil.fechaSessaoSeEstiverAberta();
-		} catch (Exception ex) {
-			log.error(
-					"[fechaSessaoHibernate] - Ocorreu um erro ao fechar uma sessï¿½o do Hibernate",
-					ex);
-			// ex.printStackTrace();
-		}
-	}
-
-	private void liberaInstanciaDao() {
-		try {
-			ModeloDao.freeInstance();
-		} catch (Exception ex) {
-			log.error(ex.getMessage(), ex);
-			// ex.printStackTrace();
-		}
-	}
-
-	public void registerTransactionClasses(Configuration cfg) {
-		// bruno.lacerda@avantiprima.com.br
-		this.registerTransactionClass("hibernate.transaction.factory_class",
-				cfg);
-		this.registerTransactionClass(
-				"hibernate.transaction.manager_lookup_class", cfg);
-	}
-
-	private void registerTransactionClass(String propertyName, Configuration cfg) {
-		String transactionFactoryClassName = System.getProperty(propertyName);
-		if (transactionFactoryClassName != null
-				&& transactionFactoryClassName.trim().length() > 0) {
-			cfg.setProperty(propertyName, transactionFactoryClassName);
-		}
-	}
-
-	public void finalmente() {
-		this.fechaContextoWorkflow();
-		this.fechaSessaoHibernate();
-		this.liberaInstanciaDao();
-	}
-
-	public void excecao() {
-		WfDao.rollbackTransacao();
-	}
-
-	public void depois() {
-		WfDao.commitTransacao();
-	}
-
-	public void antes() throws Exception {
-		WfHibernateUtil.getSessao();
-		ModeloDao.freeInstance();
-		WfDao.getInstance();
-		Wf.getInstance().getConf().limparCacheSeNecessario();
-
-		WfContextBuilder.getConfiguration();
-		WfContextBuilder.createJbpmContext();
-
-		if (!WfDao.getInstance().sessaoEstahAberta())
-			throw new AplicacaoException(
-					"Erro: sessï¿½o do Hibernate estï¿½ fechada.");
-
-		WfContextBuilder.getJbpmContext().getJbpmContext()
-				.setSession(WfDao.getInstance().getSessao());
-
-		// Velho
-		// GraphSession s = WfContextBuilder.getJbpmContext()
-		// .getGraphSession();
-		// Field fld = GraphSession.class.getDeclaredField("session");
-		// fld.setAccessible(true);
-		// Session session = (Session) fld.get(s);
-		// if (!session.isOpen())
-		// throw new AplicacaoException(
-		// "Erro: sessï¿½o do Hibernate estï¿½ fechada.");
-		// HibernateUtil.setSessao(session);
-		// WfDao.getInstance();
-
-		// if (session.getTransaction() != null)
-		// return;
-
-		WfDao.iniciarTransacao();
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfExpressionAssignmentHandler.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfExpressionAssignmentHandler.java
deleted file mode 100644
index e986fc2a2c..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfExpressionAssignmentHandler.java
+++ /dev/null
@@ -1,478 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.util.List;
-
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.identity.assignment.ExpressionAssignmentException;
-import org.jbpm.identity.assignment.ExpressionAssignmentHandler;
-import org.jbpm.identity.assignment.TermTokenizer;
-import org.jbpm.jpdl.el.ExpressionEvaluator;
-import org.jbpm.jpdl.el.FunctionMapper;
-import org.jbpm.jpdl.el.VariableResolver;
-import org.jbpm.jpdl.el.impl.ExpressionEvaluatorImpl;
-import org.jbpm.security.SecurityHelper;
-import org.jbpm.taskmgmt.exe.Assignable;
-import org.jbpm.taskmgmt.exe.SwimlaneInstance;
-
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.base.Texto;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.DpResponsavel;
-import br.gov.jfrj.siga.dp.dao.DpLotacaoDaoFiltro;
-import br.gov.jfrj.siga.dp.dao.DpPessoaDaoFiltro;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-/**
- * Implementa a linguagem de designação de atores para realizar as tarefas,
- * baseado no componente de controle de identidade presente no siga-cp.
- * 
- * <pre>
- * syntax : first-term --&gt; next-term --&gt; next-term --&gt; ... --&gt; next-term
- * 
- * first-term ::= previous |
- *                swimlane(swimlane-name) |
- *                variable(variable-name) |
- *                user(user-name) |
- *                group(group-name)
- * 
- * next-term ::= group(group-type) |
- *               member(role-name)
- * </pre>
- */
-
-public class WfExpressionAssignmentHandler {
-	private static final long serialVersionUID = 1L;
-
-	protected String expression;
-	protected ExecutionContext executionContext = null;
-	protected TermTokenizer tokenizer;
-	protected DpResponsavel entity = null;
-
-	/**
-	 * Designa uma pessoa ou lotação a uma tarefa ou raia (assignable). A pessoa
-	 * ou lotação é o resultado de uma expressão.
-	 * 
-	 * @param expression
-	 * @param assignable
-	 * @param executionContext
-	 */
-	public void assign(String expression, Assignable assignable,
-			ExecutionContext executionContext) {
-
-		try {
-			this.tokenizer = new TermTokenizer(expression);
-			this.executionContext = executionContext;
-			entity = resolveFirstTerm(tokenizer.nextTerm());
-			while (tokenizer.hasMoreTerms() && (entity != null)) {
-				entity = resolveNextTerm(tokenizer.nextTerm());
-			}
-			// if the expression did not resolve to an actor
-			if (entity == null) {
-				// throw an exception
-				throw new RuntimeException(
-						"couldn't resolve assignment expression '" + expression
-								+ "'");
-
-				// else if the expression evaluated to a user
-			} else if (entity instanceof DpPessoa) {
-				// do direct assignment
-				assignable.setActorId(entity.getSiglaCompleta());
-
-				// else if the expression evaluated to a group
-			} else if (entity instanceof DpLotacao) {
-				// put the group in the pool
-				assignable.setPooledActors(new String[] { entity
-						.getSiglaCompleta() });
-			}
-
-		} catch (RuntimeException e) {
-			throw new ExpressionAssignmentException(
-					"couldn't resolve assignment expression '" + expression
-							+ "'", e);
-		}
-	}
-
-	/**
-	 * Resolve o primeiro termo da expressão.
-	 * 
-	 * @param term
-	 * @return
-	 */
-	protected DpResponsavel resolveFirstTerm(String term) {
-		DpResponsavel entity = null;
-
-		log.debug("resolving first term '" + term + "'");
-
-		if (term.equalsIgnoreCase("previous")) {
-			String userName = SecurityHelper.getAuthenticatedActorId();
-			entity = getUserByName(userName);
-
-		} else if ((term.startsWith("swimlane(")) && (term.endsWith(")"))) {
-			String swimlaneName = term.substring(9, term.length() - 1).trim();
-			String userName = getSwimlaneActorId(swimlaneName);
-			entity = getUserByName(userName);
-
-		} else if ((term.startsWith("variable(")) && (term.endsWith(")"))) {
-			String variableName = term.substring(9, term.length() - 1).trim();
-			Object value = getVariable(variableName);
-
-			if (value == null) {
-				throw new ExpressionAssignmentException("variable '"
-						+ variableName + "' is null");
-
-			} else if (value instanceof String) {
-				try {
-					entity = getUserByName((String) value);
-				} catch (Exception ex) {
-					entity = getGroupByName((String) value);
-				}
-			} else if (value instanceof DpResponsavel) {
-				entity = (DpResponsavel) value;
-			}
-
-		} else if ((term.startsWith("expression(")) && (term.endsWith(")"))) {
-			String expressionName = term.substring(11, term.length() - 1).trim();
-			Object value = getExpression(expressionName);
-
-			if (value == null) {
-				throw new ExpressionAssignmentException("expression '"
-						+ expressionName + "' is null");
-
-			} else if (value instanceof String) {
-				try {
-					entity = getUserByName((String) value);
-				} catch (Exception ex) {
-					entity = getGroupByName((String) value);
-				}
-			} else if (value instanceof DpResponsavel) {
-				entity = (DpResponsavel) value;
-			}
-
-		} else if ((term.startsWith("user(")) && (term.endsWith(")"))) {
-			String userName = term.substring(5, term.length() - 1).trim();
-			entity = getUserByName(userName);
-
-		} else if ((term.startsWith("group(")) && (term.endsWith(")"))) {
-			String groupName = term.substring(6, term.length() - 1).trim();
-			entity = getGroupByName(groupName);
-
-		} else if ((term.startsWith("function(")) && (term.endsWith(")"))) {
-			String functionName = term.substring(9, term.length() - 1).trim();
-			entity = getUserByFunctionName(functionName);
-
-		} else if ((term.startsWith("category(")) && (term.endsWith(")"))) {
-			String categoryName = term.substring(9, term.length() - 1).trim();
-			entity = getUserByCategoryName(categoryName);
-
-		} else {
-			throw new ExpressionAssignmentException(
-					"couldn't interpret first term in expression '"
-							+ expression + "'");
-		}
-
-		return entity;
-	}
-
-	/**
-	 * Verifica se uma pessoa é chefe.
-	 * 
-	 * @param pes
-	 * @return
-	 */
-	protected boolean isChief(DpPessoa pes) {
-		final String[] chiefs = new String[] { "diretor", "chefe",
-				"coordenador", "oficial de gabinete", "supervisor",
-				"secretario geral da presidencia" };
-
-		for (String role : chiefs) {
-			if ((pes.getCargo() != null && Texto.removeAcento(
-					pes.getCargo().getDescricao().trim().replace("  ", " "))
-					.toLowerCase().contains(role))
-					|| (pes.getFuncaoConfianca() != null && Texto.removeAcento(
-							pes.getFuncaoConfianca().getDescricao().trim()
-									.replace("  ", " ")).toLowerCase()
-							.contains(role))) {
-				entity = pes;
-				return true;
-			}
-		}
-		return false;
-	}
-
-	/**
-	 * Resolve o próximo termo da expressão.
-	 * 
-	 * @param term
-	 * @return
-	 */
-	protected DpResponsavel resolveNextTerm(String term) {
-
-		log.debug("resolving next term '" + term + "'");
-
-		if (term.equalsIgnoreCase("chief")) {
-			DpPessoa user = (DpPessoa) entity;
-			DpLotacao group = user.getLotacao();
-			if (isChief(user)) {
-				group = group.getLotacaoPai();
-			}
-			while (group != null) {
-				try {
-					for (DpPessoa pes : WfDao.getInstance().pessoasPorLotacao(
-							group.getIdLotacao(), false,true)) {
-						if (isChief(pes)) {
-							entity = pes;
-							return entity;
-						}
-					}
-				} catch (AplicacaoException e) {
-					throw new ExpressionAssignmentException(
-							"couldn't interpret term '" + term
-									+ "' in expression '" + expression + "'", e);
-				}
-				group = group.getLotacaoPai();
-			}
-			throw new ExpressionAssignmentException("Can't find a chief for '"
-					+ user.getSigla() + "'");
-		} else if (term.equalsIgnoreCase("superior_group")) {
-			DpLotacao group = (DpLotacao) entity;
-			entity = group.getLotacaoPai();
-			return entity;
-		} else if ((term.startsWith("group(")) && (term.endsWith(")"))) {
-			String groupType = term.substring(6, term.length() - 1).trim();
-			DpPessoa user = (DpPessoa) entity;
-			entity = user.getLotacao();
-
-			// Set groups = user.getGroupsForGroupType(groupType);
-			// if (groups.size() == 0) {
-			// throw new ExpressionAssignmentException(
-			// "no groups for group-type '" + groupType + "'");
-			// }
-			// entity = (DpResponsavel) groups.iterator().next();
-
-		} else if ((term.startsWith("member(")) && (term.endsWith(")"))) {
-			String role = term.substring(7, term.length() - 1).trim();
-			DpLotacao group = (DpLotacao) entity;
-
-			try {
-				for (DpPessoa pes : WfDao.getInstance().pessoasPorLotacao(
-						group.getIdLotacao(), false,true)) {
-					if ((pes.getCargo() != null && Texto.removeAcento(
-							pes.getCargo().getDescricao().trim())
-							.contains(role))
-							|| (pes.getFuncaoConfianca() != null && Texto
-									.removeAcento(
-											pes.getFuncaoConfianca()
-													.getDescricao().trim())
-									.contains(role))) {
-						entity = pes;
-						break;
-					}
-				}
-			} catch (AplicacaoException e) {
-				throw new ExpressionAssignmentException(
-						"couldn't interpret term '" + term
-								+ "' in expression '" + expression + "'", e);
-			}
-
-			// entity = expressionSession.getUserByGroupAndRole(group.getName(),
-			// role);
-
-			if (entity == null) {
-				throw new ExpressionAssignmentException("no users in role '"
-						+ role + "'");
-			}
-
-		} else {
-			throw new ExpressionAssignmentException("couldn't interpret term '"
-					+ term + "' in expression '" + expression + "'");
-		}
-
-		return entity;
-	}
-
-	/**
-	 * Retorna a variável do contexto de execução, caso exista.
-	 * 
-	 * @param variableName
-	 * @return
-	 */
-	protected Object getVariable(String variableName) {
-		Token token = executionContext.getToken();
-		return executionContext.getContextInstance().getVariable(variableName,
-				token);
-	}
-
-	/**
-	 * Retorna a variável do contexto de execução, caso exista.
-	 * 
-	 * @param variableName
-	 * @return
-	 */
-	protected Object getExpression(String expression) {
-		FunctionMapper fm = new WfFunctionMapper();
-		VariableResolver vr = new WfVariableResolver(executionContext);
-		ExpressionEvaluator ee = new ExpressionEvaluatorImpl();
-		Object result = ee.evaluate("${" + expression + "}", String.class, vr, fm);
-		return result;
-	}
-
-	/**
-	 * Retorna a lotação referente ao nome passado como parâmetro.
-	 * 
-	 * @param groupName
-	 *            - nome da lotação
-	 * @return
-	 */
-	protected DpResponsavel getGroupByName(String groupName) {
-		DpLotacao group = null;
-
-		DpLotacaoDaoFiltro fltLota = new DpLotacaoDaoFiltro();
-		fltLota.setSiglaCompleta(groupName);
-		group = (DpLotacao) WfDao.getInstance().consultarPorSigla(fltLota);
-
-		if (group == null) {
-			throw new ExpressionAssignmentException("group '" + groupName
-					+ "' couldn't be fetched from the user db");
-		}
-		return group;
-	}
-
-	/**
-	 * Retorna a pessoa referente ao nome passado como parâmetro.
-	 * 
-	 * @param userName
-	 *            - Nome do usuário
-	 * @return
-	 */
-	protected DpResponsavel getUserByName(String userName) {
-		DpPessoa user = null;
-
-		DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-		flt.setSigla(userName);
-		user = (DpPessoa) WfDao.getInstance().consultarPorSigla(flt);
-
-		if (user == null) {
-			throw new ExpressionAssignmentException("user '" + userName
-					+ "' couldn't be fetched from the user db");
-		}
-		return user;
-	}
-
-	/**
-	 * Retorna a pessoa referente a função passada como parâmetro, se o usuário
-	 * não for encontrado na lotação, escala para a lotação superior e assim por
-	 * diante até encontrar um usuário que possua a função especificada. Utiliza
-	 * uma expressão regular para fazer o match do nome da função.
-	 * 
-	 * @param userName
-	 *            - Nome do usuário
-	 * @return
-	 */
-	protected DpResponsavel getUserByFunctionName(String regex) {
-		DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-		DpLotacao lot = null;
-		lot = entity instanceof DpPessoa ? ((DpPessoa) entity).getLotacao()
-				: ((DpLotacao) entity);
-		while (lot != null) {
-			flt.setLotacao(lot);
-			flt.setNome("");
-			List<DpPessoa> users = WfDao.getInstance().consultarPorFiltro(flt);
-			for (DpPessoa user : users) {
-				if (user.getFuncaoConfianca() != null
-						&& user.getFuncaoConfianca().getNomeFuncao() != null
-						&& user.getFuncaoConfianca().getNomeFuncao()
-								.toLowerCase().matches(regex))
-					return user;
-			}
-			lot = lot.getLotacaoPai();
-		}
-
-		throw new ExpressionAssignmentException(
-				"user with a function name that matches the regular expression = '"
-						+ regex
-						+ "' couldn't be fetched from the user db following the chain of '"
-						+ entity.getSiglaCompleta() + "'");
-	}
-
-	/**
-	 * Retorna a pessoa referente a função passada como parâmetro, se o usuário
-	 * não for encontrado na lotação, escala para a lotação superior e assim por
-	 * diante até encontrar um usuário que possua a função especificada. Utiliza
-	 * uma expressão regular para fazer o match do nome da função.
-	 * 
-	 * @param userName
-	 *            - Nome do usuário
-	 * @return
-	 */
-	protected DpResponsavel getUserByCategoryName(String regex) {
-		DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-		DpLotacao lot = null;
-		lot = entity instanceof DpPessoa ? ((DpPessoa) entity).getLotacao()
-				: ((DpLotacao) entity);
-		while (lot != null) {
-			flt.setLotacao(lot);
-			flt.setNome("");
-			List<DpPessoa> users = WfDao.getInstance().consultarPorFiltro(flt);
-			for (DpPessoa user : users) {
-				if (user.getCargo() != null
-						&& user.getCargo().getNomeCargo() != null
-						&& user.getCargo().getNomeCargo().toLowerCase()
-								.matches(regex))
-					return user;
-			}
-			lot = lot.getLotacaoPai();
-		}
-
-		throw new ExpressionAssignmentException(
-				"user with a category name that matches the regular expression = '"
-						+ regex
-						+ "' couldn't be fetched from the user db following the chain of '"
-						+ entity.getSiglaCompleta() + "'");
-	}
-
-	/**
-	 * Retorna o id do ator designado para a raia (swimlane).
-	 * 
-	 * @param swimlaneName
-	 * @return
-	 */
-	protected String getSwimlaneActorId(String swimlaneName) {
-		SwimlaneInstance swimlaneInstance = executionContext
-				.getTaskMgmtInstance().getSwimlaneInstance(swimlaneName);
-		if (swimlaneInstance == null) {
-			throw new ExpressionAssignmentException("no swimlane instance '"
-					+ swimlaneName + "'");
-		}
-		return swimlaneInstance.getActorId();
-	}
-
-	private static final Log log = LogFactory
-			.getLog(ExpressionAssignmentHandler.class);
-
-	// Just for the unit tests
-	public void setEntity(DpResponsavel entity) {
-		this.entity = entity;
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfFunctionMapper.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfFunctionMapper.java
deleted file mode 100644
index f98edf789a..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfFunctionMapper.java
+++ /dev/null
@@ -1,110 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.lang.reflect.Method;
-import java.util.ArrayList;
-import java.util.List;
-import java.util.logging.Level;
-import java.util.logging.Logger;
-
-import org.jbpm.graph.def.Transition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.jpdl.el.FunctionMapper;
-import org.jbpm.taskmgmt.exe.PooledActor;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.gov.jfrj.siga.Service;
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.base.SigaCalendar;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-public class WfFunctionMapper implements FunctionMapper {
-
-	public Method resolveFunction(String namespace, String function) {
-		if (namespace.equals("ex") || namespace.equals("wf")) {
-			for (Method m : this.getClass().getDeclaredMethods()) {
-				if (m.getName().equals(namespace + "_" + function))
-					return m;
-			}
-		}
-		return null;
-	}
-
-	public static boolean ex_isAssinado(String codigoDocumento)
-			throws Exception {
-		if (codigoDocumento == null || codigoDocumento.length() == 0)
-			throw new AplicacaoException(
-					"Código do documento precisa ser informado quando é feita uma chamada para ex:isAssinado.");
-		Boolean b = Service.getExService().isAssinado(codigoDocumento, null);
-		return b;
-	}
-
-	public static String ex_form(String codigoDocumento, String variavel)
-			throws Exception {
-		if (codigoDocumento == null || codigoDocumento.length() == 0)
-			throw new AplicacaoException(
-					"Código do documento precisa ser informado quando é feita uma chamada para ex:form.");
-		String s = Service.getExService().form(codigoDocumento, variavel);
-		return s;
-	}
-
-	public static String wf_prosseguirCondicional() {
-		return "br.gov.jfrj.siga.wf.util.WfProsseguirCondicionalActionHandler";
-	}
-
-	public static Long wf_getDays(TaskInstance ti) throws Exception {
-		if (ti.getCreate() == null)
-			return null;
-
-		SigaCalendar lIni = new SigaCalendar(ti.getCreate().getTime());
-		SigaCalendar lFim = new SigaCalendar(WfDao.getInstance().dt().getTime());
-		long l = lFim.getUnixDay() - lIni.getUnixDay();
-
-		return l;
-	}
-
-	public static String wf_getGroup(TaskInstance ti) {
-		DpLotacao lota = null;
-		if (ti.getActorId() != null) {
-			DpPessoa ator = WfDao.getInstance().getPessoaFromSigla(
-					ti.getActorId());
-			if (ator == null)
-				return null;
-			lota = ator.getLotacao();
-		} else if (ti.getPooledActors() != null && ti.getPooledActors().size() != 0) {
-			String groupId = (String) ((PooledActor) (ti.getPooledActors()
-					.toArray()[0])).getActorId();
-			lota = WfDao.getInstance().getLotacaoFromSigla(groupId);
-		}
-		
-		if (lota == null){
-			String msg = "Nenhum ator está definido ou é candidato a executar a taskInstance " + ti.getId();
-			Logger.getLogger("siga.wf.mail").log(Level.SEVERE,msg);
-			throw new AplicacaoException(msg);
-		}
-		
-
-		return lota.getSiglaCompleta();
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfGraphFactory.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfGraphFactory.java
deleted file mode 100644
index e4ad01458f..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfGraphFactory.java
+++ /dev/null
@@ -1,182 +0,0 @@
-package br.gov.jfrj.siga.wf.util;
-
-import java.io.DataInputStream;
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.io.StringReader;
-import java.util.Map;
-import java.util.Scanner;
-
-import org.kxml2.io.KXmlParser;
-import org.kxml2.io.KXmlSerializer;
-import org.xmlpull.v1.XmlPullParser;
-import org.xmlpull.v1.XmlSerializer;
-
-public class WfGraphFactory {
-	XmlPullParser parser;
-
-	XmlSerializer serializer;
-
-	public WfGraphFactory() {
-		parser = new KXmlParser();
-		serializer = new KXmlSerializer();
-	}
-
-	public String gerarDOT(final String sXML, final String currentNode,
-			final Map<String, String> map) throws Exception {
-		final StringBuilder sbTransition = new StringBuilder();
-		// final StringBuilder sbStart = new StringBuilder();
-		// final StringBuilder sbEnd = new StringBuilder();
-		// final StringBuilder sbFork = new StringBuilder();
-		// final StringBuilder sbJoin = new StringBuilder();
-		// final Writer os = new StringWriter();
-		sbTransition.append("node[shape=rectangle];");
-
-		try {
-			parser.setFeature(XmlPullParser.FEATURE_PROCESS_NAMESPACES, false);
-
-			parser.setInput(new StringReader(sXML));
-
-			String current = null;
-
-			while (parser.getEventType() != XmlPullParser.END_DOCUMENT) {
-				switch (parser.getEventType()) {
-				case XmlPullParser.START_DOCUMENT:
-					final String sGraphName = parser.getName();
-					// sbTransition.append(sGraphName);
-					break;
-
-				case XmlPullParser.START_TAG:
-					String sElement = parser.getName();
-
-					if ("swimlane".equals(sElement)) {
-					} else if ("start-state".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, map, "oval", sbTransition);
-					} else if ("transition".equals(sElement)) {
-						String to = parser.getAttributeValue(null, "to");
-						String name = parser.getAttributeValue(null, "name");
-						sbTransition.append("\n\"");
-						sbTransition.append(current);
-						sbTransition.append("\"->\"");
-						sbTransition.append(to);
-						sbTransition.append("\"");
-						if (name != null && !name.startsWith("_")) {
-							sbTransition.append("[edgetooltip=\"");
-							sbTransition.append(name);
-							sbTransition.append("\"]");
-						}
-						sbTransition.append(";");
-					} else if ("node".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, null, "octagon",
-								sbTransition);
-					} else if ("decision".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, null, "diamond",
-								sbTransition);
-					} else if ("task-node".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, map, "rectangle",
-								sbTransition);
-					} else if ("mail-node".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, map, "note",
-								sbTransition);
-					} else if ("fork".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, null, "trapezium",
-								sbTransition);
-					} else if ("join".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, null, "invtrapezium",
-								sbTransition);
-					} else if ("end-state".equals(sElement)) {
-						current = parser.getAttributeValue(null, "name");
-						gerarNode(current, currentNode, null, "oval",
-								sbTransition);
-					}
-					break;
-				}
-				parser.nextToken();
-			}
-
-			String s = sbTransition.toString();
-			return s;
-		} catch (final Exception ex) {
-			throw new Exception(ex);
-		}
-	}
-
-	private void gerarNode(String current, final String currentNode,
-			Map<String, String> map, final String shape, final StringBuilder sb) {
-		sb.append("\n\"");
-		sb.append(current);
-		sb.append("\"");
-		sb.append("[shape=\"");
-		sb.append(shape);
-		sb.append("\"]");
-		sb.append("[label=<<font>");
-		sb.append(current);
-		sb.append("</font>");
-		if (map != null && map.get(current) != null) {
-			sb.append("<br/><font point-size=\"9\" color=\"gray\">");
-			sb.append(map.get(current));
-			sb.append("</font>");
-		}
-		sb.append(">]");
-		if (current.equals(currentNode))
-			sb.append("[color=\"red\"]");
-		// "Início"[shape="oval"][label=<<font>Início</font><br/><font
-		// point-size="9" color="gray">OI!</font>>];
-		sb.append(";");
-	}
-
-	private static String readFile(String pathname) throws IOException {
-
-		File file = new File(pathname);
-		StringBuilder fileContents = new StringBuilder((int) file.length());
-		Scanner scanner = new Scanner(file, "UTF-8");
-		String lineSeparator = System.getProperty("line.separator");
-
-		try {
-			while (scanner.hasNextLine()) {
-				fileContents.append(scanner.nextLine() + lineSeparator);
-			}
-			return fileContents.toString();
-		} finally {
-			scanner.close();
-		}
-	}
-
-	public static String readFileDel(String filePath) throws IOException {
-		try (DataInputStream dis = new DataInputStream(new FileInputStream(filePath))) {
-			long len = new File(filePath).length();
-			if (len > Integer.MAX_VALUE)
-				throw new IOException("File " + filePath + " too large, was "
-						+ len + " bytes.");
-			byte[] bytes = new byte[(int) len];
-			dis.readFully(bytes);
-			return new String(bytes, "UTF-8");
-		}
-	}
-
-	public String gerarURL(String sDOT) {
-		StringBuilder sb = new StringBuilder();
-
-		sb.append("https://chart.googleapis.com/chart?cht=gv&chs=600x450&chl=digraph{");
-		sb.append(sDOT);
-		sb.append("}");
-		String s = sb.toString();
-		return s;
-	}
-
-	public static void main(String[] args) throws Exception {
-		String sXML = readFile("C:/Trabalhos/Java/siga-wf-pd/src/main/jpdl/AutorizacaoAusencia/processdefinition.xml");
-		WfGraphFactory graph = new WfGraphFactory();
-		String sDOT = graph.gerarDOT(sXML, "Início", null);
-		String sURL = graph.gerarURL(sDOT);
-		return;
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfHandler.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfHandler.java
new file mode 100644
index 0000000000..df1beced61
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfHandler.java
@@ -0,0 +1,96 @@
+package br.gov.jfrj.siga.wf.util;
+
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+
+import org.mvel2.MVEL;
+import org.mvel2.templates.TemplateRuntime;
+
+import com.crivano.jflow.Handler;
+import com.crivano.jflow.TaskResult;
+
+import br.gov.jfrj.siga.base.Correio;
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.wf.bl.Wf;
+import br.gov.jfrj.siga.wf.bl.WfBL;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+
+public class WfHandler implements Handler<WfProcedimento, WfResp> {
+
+	DpPessoa titular;
+	DpLotacao lotaTitular;
+	CpIdentidade identidade;
+
+	public WfHandler(DpPessoa titular, DpLotacao lotaTitular, CpIdentidade identidade) {
+		this.titular = titular;
+		this.lotaTitular = lotaTitular;
+		this.identidade = identidade;
+	}
+
+	public static Object eval(WfProcedimento pi, String expression) {
+		return MVEL.eval(expression, pi.getVariable());
+	}
+
+	@Override
+	public boolean evalCondition(WfProcedimento pi, String expression) {
+		return MVEL.eval(expression, pi.getVariable(), Boolean.class);
+	}
+
+	@Override
+	public TaskResult evalTask(WfProcedimento pi, String expression) {
+		HashMap<String, Object> m = new HashMap<>();
+		m.putAll(pi.getVariable());
+		m.put("context", new WfContext(pi));
+		return MVEL.eval(expression, m, TaskResult.class);
+	}
+
+	@Override
+	public String evalTemplate(WfProcedimento pi, String template) {
+		HashMap<String, Object> m = new HashMap<>();
+		m.putAll(pi.getVariable());
+		m.put("context", new WfContext(pi));
+		m.put("td", pi.getCurrentTaskDefinition());
+		m.put("to", pi.calcResponsible(pi.getCurrentTaskDefinition()));
+		return (String) TemplateRuntime.eval(template, m);
+	}
+
+	@Override
+	public void sendEmail(WfResp responsible, String subject, String text) {
+		List<String> destinatarios = new ArrayList<>();
+		if (responsible.getPessoa() != null) {
+			destinatarios.add(responsible.getPessoa().getEmailPessoaAtual());
+		} else if (responsible.getLotacao() != null) {
+			List<DpPessoa> l = null;
+			l = WfDao.getInstance().pessoasPorLotacao(responsible.getLotacao().getId(), false, true);
+			for (DpPessoa pessoa : l) {
+				destinatarios.add(pessoa.getEmailPessoaAtual());
+			}
+		}
+		try {
+			Correio.enviar(destinatarios.toArray(new String[destinatarios.size()]), subject, text);
+		} catch (Exception ex) {
+			throw new RuntimeException(ex);
+		}
+	}
+
+	@Override
+	public void afterPause(WfProcedimento pi, TaskResult result) {
+		String siglaTitular = null;
+		if (titular != null && lotaTitular != null)
+			siglaTitular = titular.getSigla() + "@" + lotaTitular.getSiglaCompleta();
+		try {
+			WfBL.transferirDocumentosVinculados(pi, siglaTitular);
+		} catch (Exception e) {
+			throw new RuntimeException(e);
+		}
+	}
+
+	@Override
+	public void afterTransition(WfProcedimento pi, Integer de, Integer para) {
+		Wf.getInstance().getBL().registrarTransicao(pi, de, para, titular, lotaTitular, identidade);
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfHibernateUtil.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfHibernateUtil.java
deleted file mode 100644
index 6abc9f6b5e..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfHibernateUtil.java
+++ /dev/null
@@ -1,341 +0,0 @@
-package br.gov.jfrj.siga.wf.util;
-
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-
-import org.apache.commons.lang.StringUtils;
-import org.hibernate.HibernateException;
-import org.hibernate.Session;
-import org.hibernate.SessionFactory;
-import org.hibernate.Transaction;
-import org.hibernate.cfg.Configuration;
-import org.hibernate.service.ServiceRegistry;
-import org.hibernate.service.ServiceRegistryBuilder;
-import org.jboss.logging.Logger;
-
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.base.SigaBaseProperties;
-
-public class WfHibernateUtil {
-
-	private static Logger logger = Logger.getLogger(WfHibernateUtil.class);
-
-	private static SessionFactory sessionFactory = null;
-	private static ServiceRegistry serviceRegistry = null;
-
-	public static Configuration conf = null;
-
-	private static final ThreadLocal<Session> threadSession = new ThreadLocal<Session>();
-
-	private static final ThreadLocal<Transaction> threadTransaction = new ThreadLocal<Transaction>();
-
-	private WfHibernateUtil() {
-	}
-
-	public static Session getSessao() {
-
-		Session s = WfHibernateUtil.threadSession.get();
-
-		try {
-			if (s == null) {
-				s = WfHibernateUtil.sessionFactory.openSession();
-				WfHibernateUtil.threadSession.set(s);
-				WfHibernateUtil.logger
-						.debug("Nova sessão do hibernate aberta.");
-			} else {
-				WfHibernateUtil.logger
-						.debug("Retornada sessão do hibernate aberta anteriormente.");
-			}
-
-		} catch (final HibernateException he) {
-			WfHibernateUtil.logger.error("erro do hibernate ao obter a sessão");
-		}
-
-		return s;
-	}
-
-	public static void setSessao(Session s) {
-		WfHibernateUtil.threadSession.set(s);
-	}
-
-	public static void iniciarTransacao() {
-
-		// bruno.lacerda@avantiprima.com.br
-		// Resolucao do erro Session is Closed ao comitar uma transacao pois se
-		// o ThreadTransaction
-		// nao for nulo a threadTransaction pode ter sido obtida em uma sessao
-		// do hibernate diferente
-		// da atual e por este motivo a sessao pode estar fechada.
-
-		Transaction tx = WfHibernateUtil.threadTransaction.get();
-		// Transaction tx = WfHibernateUtil.getSessao().beginTransaction();
-
-		if (tx == null) {
-			tx = WfHibernateUtil.getSessao().beginTransaction();
-
-			// bruno.lacerda@avantiprima.com.br
-			try {
-				String strTimeout = SigaBaseProperties
-						.getString("jta.transaction.timeout.value");
-				if (StringUtils.isNumeric(strTimeout)) {
-					tx.setTimeout(Integer.parseInt(strTimeout));
-				}
-			} catch (Exception e) {
-				tx.setTimeout(120);
-			}
-
-		}
-		WfHibernateUtil.threadTransaction.set(tx);
-	}
-
-	public static void commitTransacao() throws AplicacaoException {
-		final Transaction tx = WfHibernateUtil.threadTransaction.get();
-		try {
-			if ((tx != null && !tx.wasCommitted() && !tx.wasRolledBack())) {
-				tx.commit();
-				WfHibernateUtil.threadTransaction.set(null);
-				// fechaSessao();
-			}
-
-		} catch (final HibernateException hbex) {
-			WfHibernateUtil.rollbackTransacao();
-			throw new AplicacaoException(
-					"Erro gravando transação no banco de dados", 0, hbex);
-		}
-	}
-
-	public static void rollbackTransacao() {
-		final Transaction tx = WfHibernateUtil.threadTransaction.get();
-		try {
-			WfHibernateUtil.threadTransaction.set(null);
-			if ((tx != null && !tx.wasCommitted() && !tx.wasRolledBack())) {
-				tx.rollback();
-			}
-		} finally {
-			WfHibernateUtil.fechaSessao();
-		}
-
-	}
-
-	public synchronized static void fechaSessao() {
-
-		final Session s = WfHibernateUtil.threadSession.get();
-
-		if (s != null) {
-			try {
-				s.close();
-			} catch (final HibernateException he) {
-				WfHibernateUtil.logger
-						.error("erro ao fechar a sessão hibernate");
-				WfHibernateUtil.logger.error(he.getMessage());
-			}
-			try {
-				WfHibernateUtil.threadSession.remove();
-			} catch (final Exception he) {
-				WfHibernateUtil.logger
-						.error("erro ao remover a sessão hibernate");
-				WfHibernateUtil.logger.error(he.getMessage());
-			}
-		}
-
-	}
-
-	public static void removeSessao() {
-		WfHibernateUtil.threadSession.remove();
-	}
-
-	public static void fechaSessaoSeEstiverAberta() {
-		final Session s = WfHibernateUtil.threadSession.get();
-		if (s != null && s.isOpen())
-			fechaSessao();
-	}
-
-	public static Configuration getConf() {
-		return conf;
-	}
-
-	public static void configurarHibernate(String resource) {
-		Class<?> c = null;
-		configurarHibernate(resource, c);
-	}
-
-	public static void configurarHibernate(String resource,
-			Class<?>... classesAnotadas) {
-		configurarHibernate(resource, null, classesAnotadas);
-	}
-
-	public static void configurarHibernate(String resource,
-			String hibernateConnectionUrl, Class<?>... classesAnotadas) {
-
-		try {
-
-			Boolean fUseDatasource = null;
-			String sUseDatasource = System.getProperty("siga.use.datasource");
-
-			if (sUseDatasource != null) {
-				fUseDatasource = Boolean.valueOf(sUseDatasource);
-			}
-
-			if (classesAnotadas != null)
-				conf = criarConfiguracao(resource, classesAnotadas);
-			else
-				conf = criarConfiguracao(resource);
-
-			if (hibernateConnectionUrl != null)
-				conf.setProperty("hibernate.connection.url",
-						hibernateConnectionUrl);
-
-			if (fUseDatasource != null) {
-
-				if (fUseDatasource) {
-
-					conf.setProperty("connection.datasource",
-							conf.getProperty("siga.connection.datasource"));
-
-					conf.getProperties().remove("hibernate.connection.url");
-					conf.getProperties()
-							.remove("hibernate.connection.username");
-					conf.getProperties()
-							.remove("hibernate.connection.password");
-					conf.getProperties().remove(
-							"hibernate.connection.driver_class");
-
-				} else {
-
-					conf.getProperties().remove("connection.datasource");
-
-					conf.setProperty("hibernate.connection.url",
-							conf.getProperty("siga.hibernate.connection.url"));
-					conf.setProperty("hibernate.connection.username", conf
-							.getProperty("siga.hibernate.connection.username"));
-					conf.setProperty("hibernate.connection.password", conf
-							.getProperty("siga.hibernate.connection.password"));
-					conf.setProperty(
-							"hibernate.connection.driver_class",
-							conf.getProperty("siga.hibernate.connection.driver_class"));
-				}
-			}
-
-			if (hibernateConnectionUrl != null
-					&& hibernateConnectionUrl.equals("test")) {
-
-				conf.getProperties().remove("connection.datasource");
-
-				conf.setProperty("hibernate.connection.url",
-						conf.getProperty("siga.test.hibernate.connection.url"));
-				conf.setProperty("hibernate.connection.username", conf
-						.getProperty("siga.test.hibernate.connection.username"));
-				conf.setProperty("hibernate.connection.password", conf
-						.getProperty("siga.test.hibernate.connection.password"));
-				conf.setProperty(
-						"hibernate.connection.driver_class",
-						conf.getProperty("siga.test.hibernate.connection.driver_class"));
-			}
-
-			sessionFactory = conf.buildSessionFactory();
-
-		} catch (final Throwable ex) {
-
-			// Make sure you log the exception, as it might be swallowed
-			System.out.println("WfHibernateUtil");
-			ex.printStackTrace();
-			WfHibernateUtil.logger.error(
-					"Não foi possível configurar o hibernate.", ex);
-
-			throw new ExceptionInInitializerError(ex);
-		}
-	}
-
-	public static void configurarHibernate(Configuration configuration) {
-
-		try {
-			conf = configuration;
-			serviceRegistry = new ServiceRegistryBuilder().applySettings(
-					configuration.getProperties()).buildServiceRegistry();
-			sessionFactory = configuration.buildSessionFactory(serviceRegistry);
-		} catch (final Throwable ex) {
-
-			// Make sure you log the exception, as it might be swallowed
-			System.out.println("WfHibernateUtil");
-			ex.printStackTrace();
-			WfHibernateUtil.logger.error(
-					"Não foi possível configurar o hibernate.", ex);
-
-			throw new ExceptionInInitializerError(ex);
-		}
-	}
-
-	/**
-	 * @param resource
-	 * @return
-	 */
-	public static Configuration criarConfiguracao(String resource) {
-		Configuration conf = new Configuration();
-		conf.configure(resource);
-
-		return conf;
-	}
-
-	public static Configuration criarConfiguracao(String resource,
-			Class<?>... classesAnotadas) {
-
-		Configuration conf = new Configuration();
-
-		for (Class<?> clazz : classesAnotadas) {
-			conf.addAnnotatedClass(clazz);
-		}
-
-		// conf.addResource(resource);
-		conf.configure(resource);
-
-		return conf;
-	}
-
-	public static void configurarHibernate(Session session) {
-
-		try {
-			sessionFactory = session.getSessionFactory();
-		} catch (final Throwable ex) {
-
-			// Make sure you log the exception, as it might be swallowed
-			WfHibernateUtil.logger.error(
-					"Não foi possível configurar o hibernate.", ex);
-
-			throw new ExceptionInInitializerError(ex);
-		}
-	}
-
-	public static SessionFactory getSessionFactory() {
-		if (sessionFactory == null && getSessao() != null) {
-			configurarHibernate(WfHibernateUtil.getSessao()); // Corrigindo erro
-																// de
-																// nullpointer
-		}
-		return sessionFactory;
-	}
-
-	// private static void configurarHibernateParaDebug(Configuration cfg) {
-	// boolean isDebugHibernateHabilitado =
-	// SigaBaseProperties.getBooleanValue("configura.hibernate.para.debug");
-	// if ( isDebugHibernateHabilitado ) {
-	// ModeloDao.configurarHibernateParaDebug( cfg );
-	// }
-	// }
-
-}
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJbpmContext.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJbpmContext.java
deleted file mode 100644
index 14e7ece931..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJbpmContext.java
+++ /dev/null
@@ -1,64 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-
-
-
-import org.jbpm.JbpmContext;
-import org.jbpm.db.GraphSession;
-
-/**
- * Classe que representa o contexto do JBPM.
- * @author kpf
- *
- */
-public class WfJbpmContext {
-
-	protected JbpmContext jbpmContext;
-	protected GraphSession graphSession;
-
-	/**
-	 * Construtor.
-	 */
-	public WfJbpmContext() {
-		super();
-	}
-
-	/**
-	 * Retorna o contexto do JBPM.
-	 * @return
-	 */
-	public JbpmContext getJbpmContext() {
-		if (jbpmContext == null)
-			jbpmContext = WfContextBuilder.getConfiguration().createJbpmContext();
-		return jbpmContext;
-	}
-
-	/**
-	 * Retorna a sessão do grafo.
-	 * @return
-	 */
-	public GraphSession getGraphSession() {
-		if (graphSession == null)
-			graphSession = getJbpmContext().getGraphSession();
-		return graphSession;
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJobExecutor.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJobExecutor.java
deleted file mode 100644
index 4147a77601..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJobExecutor.java
+++ /dev/null
@@ -1,45 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.JbpmConfiguration;
-import org.jbpm.job.executor.JobExecutor;
-
-/**
- * Classe que representa o executor de jobs do JBPM. Esta classe é definida em
- * siga-wf/src/jbpm.cfg.xml.
- * 
- * @author kpf
- * 
- */
-public class WfJobExecutor extends JobExecutor {
-
-	/**
-	 * Cria uma thread para a execução de job.
-	 */
-	@Override
-	protected Thread createThread(String threadName) {
-		Thread t = new WfJobExecutorThread(threadName, this);
-		
-		if (t.getContextClassLoader() != Thread.currentThread().getContextClassLoader())
-			t.setContextClassLoader(Thread.currentThread().getContextClassLoader());
-		return t;
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJobExecutorThread.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJobExecutorThread.java
deleted file mode 100644
index dac5da8097..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfJobExecutorThread.java
+++ /dev/null
@@ -1,108 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import javax.servlet.ServletException;
-
-import org.apache.log4j.Logger;
-import org.jbpm.JbpmContext;
-import org.jbpm.db.JobSession;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.job.Job;
-import org.jbpm.job.executor.JobExecutorThread;
-
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-/**
- * Classe que representa um thread de execuï¿½ï¿½o de job
- * 
- * @author kpf
- * 
- */
-public class WfJobExecutorThread extends JobExecutorThread {
-	private static final Logger log = Logger
-			.getLogger(WfJobExecutorThread.class);
-
-	/**
-	 * Construtor.
-	 * 
-	 * @param name
-	 * @param jobExecutor
-	 */
-	public WfJobExecutorThread(String threadName, WfJobExecutor wfJobExecutor) {
-		super(threadName, wfJobExecutor);
-	}
-
-	/**
-	 * Executa o job.
-	 * 
-	 * @throws Exception
-	 */
-	@Override
-	protected void executeJob(Job j) throws Exception {
-		WfExecutionEnvironment ee = new WfExecutionEnvironment();
-		JbpmContext jbpmContext = null;
-		try {
-			Wf.setInstance(null);
-			ee.antes();
-			WfDao.getInstance().getSessao().merge(j);
-
-			jbpmContext = WfContextBuilder.getJbpmContext().getJbpmContext();
-
-			try {
-				JobSession jobSession = jbpmContext.getJobSession();
-				Job job = jobSession.getJob(j.getId());
-				// register process instance for automatic save
-				// https://jira.jboss.org/browse/JBPM-1015
-				ProcessInstance processInstance = job.getProcessInstance();
-				jbpmContext.addAutoSaveProcessInstance(processInstance);
-
-				// if job is exclusive, lock process instance
-				if (job.isExclusive()) {
-					jbpmContext.getGraphSession().lockProcessInstance(
-							processInstance);
-				}
-
-				if (log.isDebugEnabled())
-					log.debug("executing " + job);
-				job.execute(jbpmContext);
-				jobSession.deleteJob(job);
-			} catch (Exception e) {
-				jbpmContext.setRollbackOnly();
-				throw e;
-			} catch (Error e) {
-				jbpmContext.setRollbackOnly();
-				throw e;
-			}
-			ee.depois();
-		} catch (Exception e) {
-			ee.excecao();
-			if (!jbpmContext.isClosed()) {
-				jbpmContext.close();
-			}
-			throw new ServletException(e);
-		} finally {
-			((org.hibernate.proxy.HibernateProxy) j.getProcessInstance())
-					.getHibernateLazyInitializer().getSession().connection()
-					.close();
-			ee.finalmente();
-		}
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfMail.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfMail.java
deleted file mode 100644
index 27a6926ecd..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfMail.java
+++ /dev/null
@@ -1,131 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.net.InetAddress;
-import java.net.UnknownHostException;
-import java.util.List;
-import java.util.Map;
-import java.util.logging.Level;
-import java.util.logging.Logger;
-
-import org.jbpm.context.def.VariableAccess;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.mail.Mail;
-import org.jbpm.taskmgmt.def.TaskController;
-
-import br.gov.jfrj.siga.wf.bl.Wf;
-
-/**
- * Classe que representa o serviço de e-mail. Esta classe é definida em
- * siga-wf/src/jbpm.cfg.xml.
- * 
- * @author kpf
- * 
- */
-public class WfMail extends Mail {
-
-	private Long tiId;
-	private List<VariableAccess> docAccessVariables;
-	private Map docVariables;
-	Logger logger = Logger.getLogger("br.gov.jfrj.siga.wf.email");
-
-	private static final long serialVersionUID = -1530708539893196841L;
-
-	/**
-	 * Retorna o texto do e-mail. Esse método inclui automaticamente rodapé com
-	 * informações da tarefa correspondente ao e-mail.
-	 */
-	@Override
-	public String getText() {
-		if (Wf.getInstance().getProp().getMailLinkTarefa() == null){
-			logger.log(Level.WARNING,"A propriedade mail.link.tarefa não está definida! Os e-mails enviados para o usuário não conterão o link correto para a tarefa");
-		}
-		if (Wf.getInstance().getProp().getMailLinkTarefa() == null){
-			logger.log(Level.WARNING,"A propriedade mail.link.documento não está definida! Os e-mails enviados para o usuário não conterão o link correto para o documento");
-		}
-		
-		String rodape = "\n\n----------\n";
-		if (tiId != null) {
-			rodape += "Link para a tarefa no SIGA-WF: " + Wf.getInstance().getProp().getMailLinkTarefa()
-					+ this.tiId + "\n";
-		}
-
-		if (docAccessVariables != null) {
-			for (VariableAccess v : docAccessVariables) {
-				if (v.getMappedName().startsWith("doc_") && !v.isWritable()
-						&& v.isReadable()
-						&& docVariables.get(v.getMappedName()) != null) {
-					
-					rodape += "Link para o "
-							+ v.getVariableName()
-							+ " no SIGA: " + Wf.getInstance().getProp().getMailLinkDocumento()
-							+ docVariables.get(v.getMappedName()) + "\n";
-				}
-
-			}
-		}
-		rodape += "Mensagem gerada automaticamente pelo sistema SIGA.";
-		return super.getText() + rodape;
-	}
-
-
-	/**
-	 * Ao iniciar a manipulação do e-mail, esse método captura as informações
-	 * sobre os documentos do SIGA-DOC que se referem à tarefa que enviou o
-	 * e-mail.
-	 */
-	@Override
-	public void execute(ExecutionContext executionContext) {
-		if (executionContext.getTaskInstance() != null) {
-			tiId = executionContext.getTaskInstance().getId();
-			TaskController tc = executionContext.getTaskInstance().getTask()
-					.getTaskController();
-			if (tc != null) {
-				this.docAccessVariables = executionContext.getTaskInstance()
-						.getTask().getTaskController().getVariableAccesses();
-
-				this.docVariables = executionContext.getTaskInstance()
-						.getContextInstance().getVariables();
-			}
-
-		}
-		super.execute(executionContext);
-	}
-
-	/**
-	 * Envia o e-mail.
-	 */
-	@Override
-	public void send() {
-		// Para debugar o workflow, o ideal e desabilitar os emails e apenas
-		// logá-los no System.out.
-//		super.getBccRecipients().add("xxx@xxx.com.br");
-		super.send();
-
-		logger.log(Level.INFO,"Email enviado para " + super.getRecipients() + "[" + super.getSubject() + "]");
-		logger.log(Level.FINE,"Detalhes do e-mail enviado:"
-					+ "\nAssunto: " + getSubject()
-					+ "\nDe: " + getFromAddress()
-					+ "\nPara: " + getRecipients()
-					+ "\nTexto: " + getText());
-
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfProsseguirCondicionalActionHandler.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfProsseguirCondicionalActionHandler.java
deleted file mode 100644
index 2449238f02..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfProsseguirCondicionalActionHandler.java
+++ /dev/null
@@ -1,54 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.util.Collection;
-import java.util.List;
-
-import org.jbpm.graph.def.ActionHandler;
-import org.jbpm.graph.def.Transition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-public class WfProsseguirCondicionalActionHandler implements ActionHandler {
-
-	/**
-	 * Faz um 'sinal' na transição de saída que estiver habilitada. Caso não
-	 * exista nenhuma condição de saída com 'condition' == true, permanece na
-	 * mesma tarefa.
-	 * 
-	 * @param executionContext
-	 * @throws Exception
-	 */
-	public void execute(ExecutionContext executionContext) throws Exception {
-		Token to = executionContext.getToken();
-		for (TaskInstance ti : (Collection<TaskInstance>) (executionContext
-				.getTaskMgmtInstance().getUnfinishedTasks(to))) {
-			for (Transition t : (List<Transition>) ti.getAvailableTransitions()) {
-				if (t.getCondition() != null) {
-					if (to.isLocked())
-						to.unlock("token[" + to.getId() + "]");
-					ti.end(t);
-				}
-			}
-		}
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfResp.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfResp.java
new file mode 100644
index 0000000000..d9f40dd9f3
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfResp.java
@@ -0,0 +1,52 @@
+package br.gov.jfrj.siga.wf.util;
+
+import com.crivano.jflow.model.Responsible;
+
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+
+public class WfResp implements Responsible {
+
+	private DpPessoa pessoa;
+
+	private DpLotacao lotacao;
+
+	public WfResp(DpPessoa pessoa, DpLotacao lotacao) {
+		super();
+		this.pessoa = pessoa;
+		this.lotacao = lotacao;
+	}
+
+	@Override
+	public String getInitials() {
+		if (pessoa != null)
+			return pessoa.getSigla();
+		if (lotacao != null)
+			return lotacao.getSiglaCompleta();
+		return null;
+	}
+
+	public String getCodigo() {
+		if (pessoa != null)
+			return pessoa.getSiglaCompleta();
+		if (lotacao != null)
+			return "@" + lotacao.getSiglaCompleta();
+		return null;
+	}
+
+	public DpPessoa getPessoa() {
+		return pessoa;
+	}
+
+	public void setPessoa(DpPessoa pessoa) {
+		this.pessoa = pessoa;
+	}
+
+	public DpLotacao getLotacao() {
+		return lotacao;
+	}
+
+	public void setLotacao(DpLotacao lotacao) {
+		this.lotacao = lotacao;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTarefa.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTarefa.java
new file mode 100644
index 0000000000..6adba6a1ac
--- /dev/null
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTarefa.java
@@ -0,0 +1,62 @@
+package br.gov.jfrj.siga.wf.util;
+
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+
+public class WfTarefa implements Comparable<WfTarefa> {
+	WfDefinicaoDeTarefa td;
+
+	public WfTarefa(WfDefinicaoDeTarefa td, WfProcedimento pi) {
+		super();
+		this.td = td;
+		this.pi = pi;
+	}
+
+	public WfTarefa(WfProcedimento pi) {
+		super();
+		this.td = pi.getCurrentTaskDefinition();
+		this.pi = pi;
+	}
+
+	WfProcedimento pi;
+
+	public WfDefinicaoDeTarefa getDefinicaoDeTarefa() {
+		return td;
+	}
+
+	public void setDefinicaoDeTarefa(WfDefinicaoDeTarefa td) {
+		this.td = td;
+	}
+
+	public WfProcedimento getInstanciaDeProcedimento() {
+		return pi;
+	}
+
+	public void setInstanciaDeProcesso(WfProcedimento pi) {
+		this.pi = pi;
+	}
+
+	@Override
+	public int compareTo(WfTarefa o) {
+		int i = 0;
+		if (o == null)
+			return 1;
+		if (getInstanciaDeProcedimento().getEventoData() != null
+				&& o.getInstanciaDeProcedimento().getEventoData() == null)
+			return 1;
+		if (getInstanciaDeProcedimento().getEventoData() != null
+				&& o.getInstanciaDeProcedimento().getEventoData() != null) {
+			i = getInstanciaDeProcedimento().getEventoData().compareTo(o.getInstanciaDeProcedimento().getEventoData());
+			if (i != 0)
+				return i;
+		}
+		if (getInstanciaDeProcedimento().getId() != null && o.getInstanciaDeProcedimento().getId() == null)
+			return 1;
+		if (getInstanciaDeProcedimento().getId() != null && o.getInstanciaDeProcedimento().getId() != null) {
+			i = getInstanciaDeProcedimento().getId().compareTo(o.getInstanciaDeProcedimento().getId());
+			if (i != 0)
+				return i;
+		}
+		return 0;
+	}
+}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/TaskInstanceComparator.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTarefaComparator.java
similarity index 66%
rename from siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/TaskInstanceComparator.java
rename to siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTarefaComparator.java
index 22dd826da9..329cc68f94 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/bl/TaskInstanceComparator.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTarefaComparator.java
@@ -16,29 +16,23 @@
  *     You should have received a copy of the GNU General Public License
  *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
  ******************************************************************************/
-package br.gov.jfrj.siga.wf.bl;
+package br.gov.jfrj.siga.wf.util;
 
 import java.util.Comparator;
 
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-public class TaskInstanceComparator implements Comparator<TaskInstance> {
+public class WfTarefaComparator implements Comparator<WfTarefa> {
 
 	/**
 	 * Compara dois objetos TaskInstance. Retorna zero (0) se os objetos são
-	 * "iguais", retorna (1) se a PRIORIDADE ou ID do primeiro objeto (o1) for
-	 * maior doque o segundo objeto (o2). Retorna (-1), caso contrário. ESTE
-	 * CÓDIGO ESTÁ DUPLICADO EM WfDocumentoAction.java.
+	 * "iguais", retorna (1) se a PRIORIDADE ou ID do primeiro objeto (o1) for maior
+	 * doque o segundo objeto (o2). Retorna (-1), caso contrário. ESTE CÓDIGO ESTÁ
+	 * DUPLICADO EM WfDocumentoAction.java.
 	 */
-	public int compare(TaskInstance o1, TaskInstance o2) {
-		if (o1.getPriority() > o2.getPriority())
-			return 1;
-		if (o1.getPriority() < o2.getPriority())
-			return -1;
-		if (o1.getId() > o2.getId())
-			return 1;
-		if (o1.getId() < o2.getId())
-			return -1;
+	public int compare(WfTarefa o1, WfTarefa o2) {
+//		if (o1.getId() > o2.getId())
+//			return 1;
+//		if (o1.getId() < o2.getId())
+//			return -1;
 		return 0;
 	}
 }
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskInstance.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskInstance.java
deleted file mode 100644
index 8e2f57ed6e..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskInstance.java
+++ /dev/null
@@ -1,39 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.gov.jfrj.siga.base.SigaCalendar;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-public class WfTaskInstance extends TaskInstance {
-	private static final long serialVersionUID = 4328916761067641066L;
-
-	public Long getDays() throws Exception {
-		if (getCreate() == null)
-			return null;
-
-		SigaCalendar lIni = new SigaCalendar(getCreate().getTime());
-		SigaCalendar lFim = new SigaCalendar(WfDao.getInstance().dt().getTime());
-		long l = lFim.getUnixDay() - lIni.getUnixDay();
-
-		return l;
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskInstanceFactory.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskInstanceFactory.java
deleted file mode 100644
index 47db5ec3c2..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskInstanceFactory.java
+++ /dev/null
@@ -1,32 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.taskmgmt.TaskInstanceFactory;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-public class WfTaskInstanceFactory implements TaskInstanceFactory {
-	private static final long serialVersionUID = 7623252090107973823L;
-
-	public TaskInstance createTaskInstance(ExecutionContext executionContext) {
-		return new WfTaskInstance();
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskMgmtDefinition.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskMgmtDefinition.java
deleted file mode 100644
index e073ea2aec..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskMgmtDefinition.java
+++ /dev/null
@@ -1,43 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.module.exe.ModuleInstance;
-import org.jbpm.taskmgmt.def.TaskMgmtDefinition;
-
-/**
- * Redefine um TaskMgmtDefinition. Atualmente não está com as definições
- * personalizada, ou seja, está com o comportamento padrão do JBPM.
- * 
- * @author kpf
- * 
- */
-public class WfTaskMgmtDefinition extends TaskMgmtDefinition {
-
-	/**
-	 * Cria uma instância do módulo.
-	 */
-	@Override
-	public ModuleInstance createInstance() {
-		// return new TaskMgmtInstance(this);
-		// TODO Auto-generated method stub
-		return super.createInstance();
-	}
-
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTimeOutActionHandler.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTimeOutActionHandler.java
deleted file mode 100644
index 21c431708c..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfTimeOutActionHandler.java
+++ /dev/null
@@ -1,65 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.util.Collection;
-import java.util.List;
-
-import org.jbpm.graph.def.ActionHandler;
-import org.jbpm.graph.def.Transition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-public class WfTimeOutActionHandler implements ActionHandler {
-
-	/**
-	 * Termina a tarefa e sai para a terefa definita no atributo "transition="
-	 * do timer especificado no process definition.
-	 * 
-	 * @param executionContext
-	 * @throws Exception
-	 */
-	public void execute(ExecutionContext executionContext) throws Exception {
-		WfHibernateUtil.setSessao(executionContext.getJbpmContext()
-				.getSession());
-
-		WfDao.getInstance();
-
-		Token to = executionContext.getToken();
-
-		for (TaskInstance ti : (Collection<TaskInstance>) (executionContext
-				.getTaskMgmtInstance().getUnfinishedTasks(to))) {
-
-			for (Transition t : (List<Transition>) ti.getAvailableTransitions()) {
-				if (t.getName().equalsIgnoreCase(
-						executionContext.getTimer().getTransitionName())) {
-					WfDao.iniciarTransacao();
-					ti.end(t);
-					WfDao.commitTransacao();
-					return;
-				}
-			}
-
-		}
-
-	}
-}
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfVariableResolver.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfVariableResolver.java
deleted file mode 100644
index 89de8c6d4a..0000000000
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfVariableResolver.java
+++ /dev/null
@@ -1,55 +0,0 @@
-package br.gov.jfrj.siga.wf.util;
-
-import org.jbpm.JbpmConfiguration.Configs;
-import org.jbpm.context.exe.ContextInstance;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.jpdl.el.ELException;
-import org.jbpm.jpdl.el.VariableResolver;
-import org.jbpm.taskmgmt.exe.SwimlaneInstance;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-import org.jbpm.taskmgmt.exe.TaskMgmtInstance;
-
-public class WfVariableResolver implements VariableResolver {
-	
-  private ExecutionContext executionContext;
-
-  public WfVariableResolver(ExecutionContext executionContext) {
-	  this.executionContext = executionContext;
-  }
-
-  public Object resolveVariable(String name) throws ELException {
-    ExecutionContext executionContext = this.executionContext;
-
-    if ("taskInstance".equals(name)) return executionContext.getTaskInstance();
-    if ("processInstance".equals(name)) return executionContext.getProcessInstance();
-    if ("processDefinition".equals(name)) return executionContext.getProcessDefinition();
-    if ("token".equals(name)) return executionContext.getToken();
-    if ("taskMgmtInstance".equals(name)) return executionContext.getTaskMgmtInstance();
-    if ("contextInstance".equals(name)) return executionContext.getContextInstance();
-
-//    TaskInstance taskInstance = executionContext.getTaskInstance();
-//    if (taskInstance != null && taskInstance.hasVariableLocally(name)) {
-//      return taskInstance.getVariable(name);
-//    }
-
-    ContextInstance contextInstance = executionContext.getContextInstance();
-    if (contextInstance != null) {
-      Token token = executionContext.getToken();
-      if (contextInstance.hasVariable(name, token)) {
-        return contextInstance.getVariable(name);
-      }
-      if (contextInstance.hasTransientVariable(name)) {
-        return contextInstance.getTransientVariable(name);
-      }
-    }
-
-    TaskMgmtInstance taskMgmtInstance = executionContext.getTaskMgmtInstance();
-    if (taskMgmtInstance != null) {
-      SwimlaneInstance swimlaneInstance = taskMgmtInstance.getSwimlaneInstance(name);
-      if (swimlaneInstance != null) return swimlaneInstance.getActorId();
-    }
-
-    return Configs.hasObject(name) ? Configs.getObject(name) : null;
-  }
-}
\ No newline at end of file
diff --git a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfWikiParser.java b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfWikiParser.java
index 16d0d844cd..c9976c4f4c 100644
--- a/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfWikiParser.java
+++ b/siga-wf/src/main/java/br/gov/jfrj/siga/wf/util/WfWikiParser.java
@@ -18,7 +18,7 @@
  ******************************************************************************/
 package br.gov.jfrj.siga.wf.util;
 
-import info.bliki.wiki.model.WikiModel;
+// import info.bliki.wiki.model.WikiModel;
 
 
 /**
@@ -41,7 +41,8 @@ public class WfWikiParser {
 						" **** ", "\n**** ").replace(" ==", "\n==");
 		
 	//	String fragment = WikiParser.renderXHTML(s);
-		String fragment = WikiModel.toHtml(s);
-		return fragment;
+	//	String fragment = WikiModel.toHtml(s);
+	//	return fragment;
+		return s;
 	}
 }
diff --git a/sigawf/src/main/webapp/META-INF/persistence.xml b/siga-wf/src/main/resources/META-INF/persistence.xml
similarity index 56%
rename from sigawf/src/main/webapp/META-INF/persistence.xml
rename to siga-wf/src/main/resources/META-INF/persistence.xml
index 307987a6c2..78c7b7630b 100644
--- a/sigawf/src/main/webapp/META-INF/persistence.xml
+++ b/siga-wf/src/main/resources/META-INF/persistence.xml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<persistence version="1.0"
-	xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd">
-
-	<persistence-unit name="default" transaction-type="RESOURCE_LOCAL">
+<persistence xmlns="http://java.sun.com/xml/ns/persistence"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"
+	version="2.0">
+	<persistence-unit name="default"
+		transaction-type="RESOURCE_LOCAL">
 		<provider>org.hibernate.ejb.HibernatePersistence</provider>
-		<non-jta-data-source>java:/jboss/datasources/SigaGcDS</non-jta-data-source>
-
+		<non-jta-data-source>java:/jboss/datasources/SigaWfDS</non-jta-data-source>
 
 		<class>br.gov.jfrj.siga.dp.DpCargo</class>
 		<class>br.gov.jfrj.siga.dp.DpFuncaoConfianca</class>
@@ -44,28 +44,51 @@
 		<class>br.gov.jfrj.siga.dp.CpTipoMarcador</class>
 		<class>br.gov.jfrj.siga.dp.CpMarca</class>
 		<class>br.gov.jfrj.siga.dp.CpTipoMarca</class>
+		<class>br.gov.jfrj.siga.cp.CpAcesso</class>
+
+		<class>br.gov.jfrj.siga.cp.CpArquivo</class>
+		<class>br.gov.jfrj.siga.cp.CpArquivoBlob</class>
+
+		<class>br.gov.jfrj.siga.wf.model.WfDefinicaoDeDesvio</class>
+		<class>br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento</class>
+		<class>br.gov.jfrj.siga.wf.model.WfDefinicaoDeResponsavel</class>
+		<class>br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa</class>
+		<class>br.gov.jfrj.siga.wf.model.WfDefinicaoDeVariavel</class>
+		<class>br.gov.jfrj.siga.wf.model.WfMov</class>
+		<class>br.gov.jfrj.siga.wf.model.WfMovAnotacao</class>
+		<class>br.gov.jfrj.siga.wf.model.WfMovCancelamento</class>
+		<class>br.gov.jfrj.siga.wf.model.WfMovDesignacao</class>
+		<class>br.gov.jfrj.siga.wf.model.WfMovRedirecionamento</class>
+		<class>br.gov.jfrj.siga.wf.model.WfMovTransicao</class>
+		<class>br.gov.jfrj.siga.wf.model.WfProcedimento</class>
+		<class>br.gov.jfrj.siga.wf.model.WfResponsavel</class>
+		<class>br.gov.jfrj.siga.wf.model.WfVariavel</class>
 
 		<properties>
-			<property name="hibernate.current_session_context_class"
-				value="thread" />
-			<property name="hibernate.query.substitutions" value="true 1, false 0" />
+			<property
+				name="hibernate.jpa.compliance.global_id_generators" value="false" />
+			<property name="hibernate.cache.use_query_cache"
+				value="true" />
 			<property name="hibernate.cache.use_second_level_cache"
 				value="true" />
-			<property name="hibernate.cache.infinispan.cachemanager"
-				value="java:jboss/infinispan/container/hibernate" />
-			<property name="hibernate.transaction.manager_lookup_class"
-				value="org.hibernate.transaction.JBossTransactionManagerLookup" />
-			<property name="hibernate.cache.use_query_cache" value="true" />
-			<property name="hibernate.cache.use_minimal_puts" value="false" />
+
+			<property name="hibernate.current_session_context_class"
+				value="thread" />
+
+			<property name="hibernate.query.substitutions"
+				value="true 1, false 0" />
 			<property name="hibernate.max_fetch_depth" value="3" />
-			<property name="hibernate.default_batch_fetch_size" value="1000" />
-			<property name="hibernate.cache.provider_configuration_file_resource_path"
-				value="classpath:ehcache.xml" />
-			<property name="hibernate.cache.region.factory_class"
-				value="org.jboss.as.jpa.hibernate4.infinispan.InfinispanRegionFactory" />
-			<property name="hibernate.dialect" value="org.hibernate.dialect.Oracle10gDialect" />
+			<property name="hibernate.default_batch_fetch_size"
+				value="1000" />
+			<property name="hibernate.dialect"
+				value="${siga.hibernate.dialect}" />
 			<property name="hibernate.hbm2ddl.auto" value="none" />
 			<property name="hibernate.show_sql" value="false" />
+
+			<!-- Desabilita o novo gerador de IDs para manter a compatibilidade -->
+			<property name="hibernate.id.new_generator_mappings"
+				value="false" />
 		</properties>
 	</persistence-unit>
-</persistence>
\ No newline at end of file
+</persistence>
+
diff --git a/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/WfConfiguracao.hbm.xml b/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/WfConfiguracao.hbm.xml
deleted file mode 100644
index dd00c90517..0000000000
--- a/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/WfConfiguracao.hbm.xml
+++ /dev/null
@@ -1,39 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE hibernate-mapping PUBLIC
-                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
-                            "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd" >
-
-<hibernate-mapping package="br.gov.jfrj.siga.wf">
-	<joined-subclass name="WfConfiguracao" table="WF_CONFIGURACAO"
-		extends="br.gov.jfrj.siga.cp.CpConfiguracao">
-		<key column="ID_CONFIGURACAO_WF" />
-		<property name="procedimento" column="NM_PROCEDIMENTO"
-			type="java.lang.String" />
-		<property name="raia" column="NM_RAIA" type="java.lang.String" />
-		<property name="tarefa" column="NM_TAREFA"
-			type="java.lang.String" />
-		<property name="expressao" column="NM_EXPRESSAO"
-			type="java.lang.String" />
-		<many-to-one name="lotaAtor" column="ID_LOTA_ATOR"
-			class="br.gov.jfrj.siga.dp.DpLotacao" lazy="false" />
-		<many-to-one name="ator" column="ID_ATOR"
-			class="br.gov.jfrj.siga.dp.DpPessoa" lazy="false" />
-	</joined-subclass>
-	
-		<query name="consultarWfConfiguracoes">
-		<![CDATA[
-			from WfConfiguracao wfcfg
-			where (:idTpConfiguracao is null or wfcfg.cpTipoConfiguracao.idTpConfiguracao = :idTpConfiguracao)
-		]]>
-	</query>
-	
-			<sql-query name="consultarTarefasAtivasPorDocumento">
-			<return class="org.jbpm.taskmgmt.exe.TaskInstance"></return>
-		<![CDATA[
-			select ti.* from jbpm_variableaccess va, jbpm_task ta, jbpm_taskinstance ti, jbpm_processinstance pi, jbpm_variableinstance vi
-			where va.taskcontroller_ = ta.taskcontroller_ and ti.task_ = ta.id_ and pi.id_ = ti.procinst_ and vi.processinstance_ = pi.id_
-			and ti.issignalling_ = 1 and va.mappedname_ like 'doc_%' and vi.stringvalue_ like :siglaDoc	
-		]]>
-	</sql-query>
-</hibernate-mapping>
-
diff --git a/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/WfConhecimento.hbm.xml b/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/WfConhecimento.hbm.xml
deleted file mode 100644
index d1715dfb9f..0000000000
--- a/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/WfConhecimento.hbm.xml
+++ /dev/null
@@ -1,36 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
-                                   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
-<hibernate-mapping auto-import="false" package="br.gov.jfrj.siga.wf">
-	<class name="WfConhecimento" table="WF_CONHECIMENTO">
-		<id column="ID_CONHECIMENTO" name="id" type="java.lang.Long">
-			<generator class="native">
-				<param name="sequence">WF_CONHECIMENTO_SEQ</param>
-			</generator>
-		</id>
-
-		<property name="procedimento" type="java.lang.String" column="NM_PROCEDIMENTO" />
-		<property name="tarefa" type="java.lang.String" column="NM_TAREFA" />
-		<property name="descricao" type="java.lang.String" column="DESC_CONHECIMENTO" />
-
-		<!-- Campos padronizados para armazenar dados histórios -->
-		<property name="hisIdIni" column="HIS_ID_INI" type="java.lang.Long" />
-		<property name="hisDtIni" column="HIS_DT_INI" type="java.util.Date" />
-		<many-to-one name="hisIdcIni" column="HIS_IDC_INI"
-			class="br.gov.jfrj.siga.cp.CpIdentidade" />
-		<property name="hisDtFim" column="HIS_DT_FIM" type="java.util.Date" />
-		<many-to-one name="hisIdcFim" column="HIS_IDC_FIM"
-			class="br.gov.jfrj.siga.cp.CpIdentidade" />
-		<property name="hisAtivo" column="HIS_ATIVO" type="java.lang.Integer" />
-	</class>
-
-	<query name="consultarConhecimento">
-		<![CDATA[
-			from br.gov.jfrj.siga.wf.WfConhecimento c
-			where (c.procedimento = :procedimento)
-			and (c.tarefa = :tarefa)
-			and (c.hisAtivo = 1)
-		]]>
-	</query>
-
-</hibernate-mapping>
diff --git a/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/util/WfTaskInstance.hbm.xml b/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/util/WfTaskInstance.hbm.xml
deleted file mode 100644
index b03ad01989..0000000000
--- a/siga-wf/src/main/resources/br/gov/jfrj/siga/wf/util/WfTaskInstance.hbm.xml
+++ /dev/null
@@ -1,15 +0,0 @@
-<?xml version="1.0"?>
-
-<!DOCTYPE hibernate-mapping PUBLIC
-    "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
-    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
-
-<hibernate-mapping>
-	<subclass name="br.gov.jfrj.siga.wf.util.WfTaskInstance"
-		extends="org.jbpm.taskmgmt.exe.TaskInstance" discriminator-value="S">
-	</subclass>
-	
-	
-</hibernate-mapping>
-
-
diff --git a/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V1_0__Description.sql b/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V1_0__Description.sql
deleted file mode 100644
index fde55ce7dd..0000000000
--- a/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V1_0__Description.sql
+++ /dev/null
@@ -1,297 +0,0 @@
--------------------------------------------
---	SCRIPT:CRIACAO DO BANCO
--------------------------------------------
-
---SET DEFINE OFF;
-
-ALTER SESSION SET CURRENT_SCHEMA=sigawf;
-
-CREATE SEQUENCE  "SIGAWF"."WF_CONHECIMENTO_SEQ"  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;
-
-  CREATE TABLE "SIGAWF"."WF_CONFIGURACAO" 
-   (	"ID_CONFIGURACAO_WF" NUMBER(19,0), 
-	"NM_PROCEDIMENTO" VARCHAR2(255 CHAR), 
-	"NM_RAIA" VARCHAR2(255 CHAR), 
-	"NM_TAREFA" VARCHAR2(255 CHAR), 
-	"NM_EXPRESSAO" VARCHAR2(255 CHAR), 
-	"ID_LOTA_ATOR" NUMBER(19,0), 
-	"ID_ATOR" NUMBER(19,0)
-   ) ;
---------------------------------------------------------
---  DDL for Table WF_CONHECIMENTO
---------------------------------------------------------
-
-  CREATE TABLE "SIGAWF"."WF_CONHECIMENTO" 
-   (	"ID_CONHECIMENTO" NUMBER, 
-	"NM_PROCEDIMENTO" VARCHAR2(255), 
-	"NM_TAREFA" VARCHAR2(255), 
-	"DESC_CONHECIMENTO" VARCHAR2(2000), 
-	"HIS_ID_INI" NUMBER, 
-	"HIS_DT_INI" DATE, 
-	"HIS_IDC_INI" NUMBER, 
-	"HIS_DT_FIM" DATE, 
-	"HIS_IDC_FIM" NUMBER, 
-	"HIS_ATIVO" NUMBER(1,0)
-   ) ;
-   
-   
-   --------------------------------------------------------
---  DDL for Function REMOVE_ACENTO
---------------------------------------------------------
-
-  CREATE OR REPLACE FUNCTION "SIGAWF"."REMOVE_ACENTO" 
-    (acentuado in
-    VARCHAR2)
-
---	Enter the parameters for the function in
---	the brackets above.  If this function has
---	no parameters then delete the line
-
---  ***************************************************
---	*                                                 *
---	*   Author                                        *
---	*   Creation Date                                 *
---	*   Comments                                      *
---	*                                                 *
---  ***************************************************
-
-RETURN  VARCHAR2
-
-IS
-
---	Enter all variables cursors and constants following
---	this line
-sem_acento VARCHAR2(4000);
-
-begin
-
---	Enter the code for the function following
---	this line
-
-      sem_acento := CONVERT(TRANSLATE(UPPER( acentuado ),'ÃÕÑ','AON'),'US7ASCII');
-
-	return	sem_acento;
-			
-exception
-
---	Enter the code to handle exception conditions
---	following this line
-
-
-	when others then
-		null;
-			
-end;
- 
-/
-
-   ---
-   --- JBPM
-   ---
-   
-   
-create table JBPM_ACTION (ID_ number(19,0) not null, class char(1 char) not null, NAME_ varchar2(255 char), ISPROPAGATIONALLOWED_ number(1,0), ACTIONEXPRESSION_ varchar2(255 char), ISASYNC_ number(1,0), REFERENCEDACTION_ number(19,0), ACTIONDELEGATION_ number(19,0), EVENT_ number(19,0), PROCESSDEFINITION_ number(19,0), EXPRESSION_ clob, TIMERNAME_ varchar2(255 char), DUEDATE_ varchar2(255 char), REPEAT_ varchar2(255 char), TRANSITIONNAME_ varchar2(255 char), TIMERACTION_ number(19,0), EVENTINDEX_ number(10,0), EXCEPTIONHANDLER_ number(19,0), EXCEPTIONHANDLERINDEX_ number(10,0), primary key (ID_));
-create table JBPM_BYTEARRAY (ID_ number(19,0) not null, NAME_ varchar2(255 char), FILEDEFINITION_ number(19,0), primary key (ID_));
-create table JBPM_BYTEBLOCK (PROCESSFILE_ number(19,0) not null, BYTES_ raw(1024), INDEX_ number(10,0) not null, primary key (PROCESSFILE_, INDEX_));
-create table JBPM_COMMENT (ID_ number(19,0) not null, VERSION_ number(10,0) not null, ACTORID_ varchar2(255 char), TIME_ timestamp, MESSAGE_ clob, TOKEN_ number(19,0), TASKINSTANCE_ number(19,0), TOKENINDEX_ number(10,0), TASKINSTANCEINDEX_ number(10,0), primary key (ID_));
-create table JBPM_DECISIONCONDITIONS (DECISION_ number(19,0) not null, TRANSITIONNAME_ varchar2(255 char), EXPRESSION_ varchar2(255 char), INDEX_ number(10,0) not null, primary key (DECISION_, INDEX_));
-create table JBPM_DELEGATION (ID_ number(19,0) not null, CLASSNAME_ clob, CONFIGURATION_ clob, CONFIGTYPE_ varchar2(255 char), PROCESSDEFINITION_ number(19,0), primary key (ID_));
-create table JBPM_EVENT (ID_ number(19,0) not null, EVENTTYPE_ varchar2(255 char), TYPE_ char(1 char), GRAPHELEMENT_ number(19,0), PROCESSDEFINITION_ number(19,0), NODE_ number(19,0), TRANSITION_ number(19,0), TASK_ number(19,0), primary key (ID_));
-create table JBPM_EXCEPTIONHANDLER (ID_ number(19,0) not null, EXCEPTIONCLASSNAME_ clob, TYPE_ char(1 char), GRAPHELEMENT_ number(19,0), PROCESSDEFINITION_ number(19,0), GRAPHELEMENTINDEX_ number(10,0), NODE_ number(19,0), TRANSITION_ number(19,0), TASK_ number(19,0), primary key (ID_));
-create table JBPM_ID_GROUP (ID_ number(19,0) not null, CLASS_ char(1 char) not null, NAME_ varchar2(255 char), TYPE_ varchar2(255 char), PARENT_ number(19,0), primary key (ID_));
-create table JBPM_ID_MEMBERSHIP (ID_ number(19,0) not null, CLASS_ char(1 char) not null, NAME_ varchar2(255 char), ROLE_ varchar2(255 char), USER_ number(19,0), GROUP_ number(19,0), primary key (ID_));
-create table JBPM_ID_PERMISSIONS (ENTITY_ number(19,0) not null, CLASS_ varchar2(255 char), NAME_ varchar2(255 char), ACTION_ varchar2(255 char));
-create table JBPM_ID_USER (ID_ number(19,0) not null, CLASS_ char(1 char) not null, NAME_ varchar2(255 char), EMAIL_ varchar2(255 char), PASSWORD_ varchar2(255 char), primary key (ID_));
-create table JBPM_JOB (ID_ number(19,0) not null, CLASS_ char(1 char) not null, VERSION_ number(10,0) not null, DUEDATE_ timestamp, PROCESSINSTANCE_ number(19,0), TOKEN_ number(19,0), TASKINSTANCE_ number(19,0), ISSUSPENDED_ number(1,0), ISEXCLUSIVE_ number(1,0), LOCKOWNER_ varchar2(255 char), LOCKTIME_ timestamp, EXCEPTION_ clob, RETRIES_ number(10,0), NAME_ varchar2(255 char), REPEAT_ varchar2(255 char), TRANSITIONNAME_ varchar2(255 char), ACTION_ number(19,0), GRAPHELEMENTTYPE_ varchar2(255 char), GRAPHELEMENT_ number(19,0), NODE_ number(19,0), primary key (ID_));
-create table JBPM_LOG (ID_ number(19,0) not null, CLASS_ char(1 char) not null, INDEX_ number(10,0), DATE_ timestamp, TOKEN_ number(19,0), PARENT_ number(19,0), MESSAGE_ clob, EXCEPTION_ clob, ACTION_ number(19,0), NODE_ number(19,0), ENTER_ timestamp, LEAVE_ timestamp, DURATION_ number(19,0), NEWLONGVALUE_ number(19,0), TRANSITION_ number(19,0), CHILD_ number(19,0), SOURCENODE_ number(19,0), DESTINATIONNODE_ number(19,0), VARIABLEINSTANCE_ number(19,0), OLDBYTEARRAY_ number(19,0), NEWBYTEARRAY_ number(19,0), OLDDATEVALUE_ timestamp, NEWDATEVALUE_ timestamp, OLDDOUBLEVALUE_ double precision, NEWDOUBLEVALUE_ double precision, OLDLONGIDCLASS_ varchar2(255 char), OLDLONGIDVALUE_ number(19,0), NEWLONGIDCLASS_ varchar2(255 char), NEWLONGIDVALUE_ number(19,0), OLDSTRINGIDCLASS_ varchar2(255 char), OLDSTRINGIDVALUE_ varchar2(255 char), NEWSTRINGIDCLASS_ varchar2(255 char), NEWSTRINGIDVALUE_ varchar2(255 char), OLDLONGVALUE_ number(19,0), OLDSTRINGVALUE_ clob, NEWSTRINGVALUE_ clob, TASKINSTANCE_ number(19,0), TASKACTORID_ varchar2(255 char), TASKOLDACTORID_ varchar2(255 char), SWIMLANEINSTANCE_ number(19,0), primary key (ID_));
-create table JBPM_MODULEDEFINITION (ID_ number(19,0) not null, CLASS_ char(1 char) not null, NAME_ varchar2(255 char), PROCESSDEFINITION_ number(19,0), STARTTASK_ number(19,0), primary key (ID_));
-create table JBPM_MODULEINSTANCE (ID_ number(19,0) not null, CLASS_ char(1 char) not null, VERSION_ number(10,0) not null, PROCESSINSTANCE_ number(19,0), TASKMGMTDEFINITION_ number(19,0), NAME_ varchar2(255 char), primary key (ID_));
-create table JBPM_NODE (ID_ number(19,0) not null, CLASS_ char(1 char) not null, NAME_ varchar2(255 char), DESCRIPTION_ clob, PROCESSDEFINITION_ number(19,0), ISASYNC_ number(1,0), ISASYNCEXCL_ number(1,0), ACTION_ number(19,0), SUPERSTATE_ number(19,0), SUBPROCNAME_ varchar2(255 char), SUBPROCESSDEFINITION_ number(19,0), DECISIONEXPRESSION_ varchar2(255 char), DECISIONDELEGATION number(19,0), SCRIPT_ number(19,0), PARENTLOCKMODE_ varchar2(255 char), SIGNAL_ number(10,0), CREATETASKS_ number(1,0), ENDTASKS_ number(1,0), NODECOLLECTIONINDEX_ number(10,0), primary key (ID_));
-create table JBPM_POOLEDACTOR (ID_ number(19,0) not null, VERSION_ number(10,0) not null, ACTORID_ varchar2(255 char), SWIMLANEINSTANCE_ number(19,0), primary key (ID_));
-create table JBPM_PROCESSDEFINITION (ID_ number(19,0) not null, CLASS_ char(1 char) not null, NAME_ varchar2(255 char), DESCRIPTION_ clob, VERSION_ number(10,0), ISTERMINATIONIMPLICIT_ number(1,0), STARTSTATE_ number(19,0), primary key (ID_));
-create table JBPM_PROCESSINSTANCE (ID_ number(19,0) not null, VERSION_ number(10,0) not null, KEY_ varchar2(255 char), START_ timestamp, END_ timestamp, ISSUSPENDED_ number(1,0), PROCESSDEFINITION_ number(19,0), ROOTTOKEN_ number(19,0), SUPERPROCESSTOKEN_ number(19,0), primary key (ID_));
-create table JBPM_RUNTIMEACTION (ID_ number(19,0) not null, VERSION_ number(10,0) not null, EVENTTYPE_ varchar2(255 char), TYPE_ char(1 char), GRAPHELEMENT_ number(19,0), PROCESSINSTANCE_ number(19,0), ACTION_ number(19,0), PROCESSINSTANCEINDEX_ number(10,0), primary key (ID_));
-create table JBPM_SWIMLANE (ID_ number(19,0) not null, NAME_ varchar2(255 char), ACTORIDEXPRESSION_ varchar2(255 char), POOLEDACTORSEXPRESSION_ varchar2(255 char), ASSIGNMENTDELEGATION_ number(19,0), TASKMGMTDEFINITION_ number(19,0), primary key (ID_));
-create table JBPM_SWIMLANEINSTANCE (ID_ number(19,0) not null, VERSION_ number(10,0) not null, NAME_ varchar2(255 char), ACTORID_ varchar2(255 char), SWIMLANE_ number(19,0), TASKMGMTINSTANCE_ number(19,0), primary key (ID_));
-create table JBPM_TASK (ID_ number(19,0) not null, NAME_ varchar2(255 char), DESCRIPTION_ clob, PROCESSDEFINITION_ number(19,0), ISBLOCKING_ number(1,0), ISSIGNALLING_ number(1,0), CONDITION_ varchar2(255 char), DUEDATE_ varchar2(255 char), PRIORITY_ number(10,0), ACTORIDEXPRESSION_ varchar2(255 char), POOLEDACTORSEXPRESSION_ varchar2(255 char), TASKMGMTDEFINITION_ number(19,0), TASKNODE_ number(19,0), STARTSTATE_ number(19,0), ASSIGNMENTDELEGATION_ number(19,0), SWIMLANE_ number(19,0), TASKCONTROLLER_ number(19,0), primary key (ID_));
-create table JBPM_TASKACTORPOOL (TASKINSTANCE_ number(19,0) not null, POOLEDACTOR_ number(19,0) not null, primary key (TASKINSTANCE_, POOLEDACTOR_));
-create table JBPM_TASKCONTROLLER (ID_ number(19,0) not null, TASKCONTROLLERDELEGATION_ number(19,0), primary key (ID_));
-create table JBPM_TASKINSTANCE (ID_ number(19,0) not null, CLASS_ char(1 char) not null, VERSION_ number(10,0) not null, NAME_ varchar2(255 char), DESCRIPTION_ clob, ACTORID_ varchar2(255 char), CREATE_ timestamp, START_ timestamp, END_ timestamp, DUEDATE_ timestamp, PRIORITY_ number(10,0), ISCANCELLED_ number(1,0), ISSUSPENDED_ number(1,0), ISOPEN_ number(1,0), ISSIGNALLING_ number(1,0), ISBLOCKING_ number(1,0), TASK_ number(19,0), TOKEN_ number(19,0), PROCINST_ number(19,0), SWIMLANINSTANCE_ number(19,0), TASKMGMTINSTANCE_ number(19,0), primary key (ID_));
-create table JBPM_TOKEN (ID_ number(19,0) not null, VERSION_ number(10,0) not null, NAME_ varchar2(255 char), START_ timestamp, END_ timestamp, NODEENTER_ timestamp, NEXTLOGINDEX_ number(10,0), ISABLETOREACTIVATEPARENT_ number(1,0), ISTERMINATIONIMPLICIT_ number(1,0), ISSUSPENDED_ number(1,0), LOCK_ varchar2(255 char), NODE_ number(19,0), PROCESSINSTANCE_ number(19,0), PARENT_ number(19,0), SUBPROCESSINSTANCE_ number(19,0), primary key (ID_));
-create table JBPM_TOKENVARIABLEMAP (ID_ number(19,0) not null, VERSION_ number(10,0) not null, TOKEN_ number(19,0), CONTEXTINSTANCE_ number(19,0), primary key (ID_));
-create table JBPM_TRANSITION (ID_ number(19,0) not null, NAME_ varchar2(255 char), DESCRIPTION_ clob, PROCESSDEFINITION_ number(19,0), FROM_ number(19,0), TO_ number(19,0), CONDITION_ varchar2(255 char), FROMINDEX_ number(10,0), primary key (ID_));
-create table JBPM_VARIABLEACCESS (ID_ number(19,0) not null, VARIABLENAME_ varchar2(255 char), ACCESS_ varchar2(255 char), MAPPEDNAME_ varchar2(255 char), SCRIPT_ number(19,0), PROCESSSTATE_ number(19,0), TASKCONTROLLER_ number(19,0), INDEX_ number(10,0), primary key (ID_));
-create table JBPM_VARIABLEINSTANCE (ID_ number(19,0) not null, CLASS_ char(1 char) not null, VERSION_ number(10,0) not null, NAME_ varchar2(255 char), CONVERTER_ char(1 char), TOKEN_ number(19,0), TOKENVARIABLEMAP_ number(19,0), PROCESSINSTANCE_ number(19,0), BYTEARRAYVALUE_ number(19,0), DATEVALUE_ timestamp, DOUBLEVALUE_ double precision, LONGIDCLASS_ varchar2(255 char), LONGVALUE_ number(19,0), STRINGIDCLASS_ varchar2(255 char), STRINGVALUE_ varchar2(255 char), TASKINSTANCE_ number(19,0), primary key (ID_));
-create index IDX_ACTION_EVENT on JBPM_ACTION (EVENT_);
-create index IDX_ACTION_ACTNDL on JBPM_ACTION (ACTIONDELEGATION_);
-create index IDX_ACTION_PROCDF on JBPM_ACTION (PROCESSDEFINITION_);
-create index IDX_COMMENT_TOKEN on JBPM_COMMENT (TOKEN_);
-create index IDX_COMMENT_TSK on JBPM_COMMENT (TASKINSTANCE_);
-create index IDX_DELEG_PRCD on JBPM_DELEGATION (PROCESSDEFINITION_);
-create index IDX_JOB_TSKINST on JBPM_JOB (TASKINSTANCE_);
-create index IDX_JOB_PRINST on JBPM_JOB (PROCESSINSTANCE_);
-create index IDX_JOB_TOKEN on JBPM_JOB (TOKEN_);
-create index IDX_MODDEF_PROCDF on JBPM_MODULEDEFINITION (PROCESSDEFINITION_);
-create index IDX_MODINST_PRINST on JBPM_MODULEINSTANCE (PROCESSINSTANCE_);
-create index IDX_PSTATE_SBPRCDEF on JBPM_NODE (SUBPROCESSDEFINITION_);
-create index IDX_NODE_SUPRSTATE on JBPM_NODE (SUPERSTATE_);
-create index IDX_NODE_PROCDEF on JBPM_NODE (PROCESSDEFINITION_);
-create index IDX_NODE_ACTION on JBPM_NODE (ACTION_);
-create index IDX_PLDACTR_ACTID on JBPM_POOLEDACTOR (ACTORID_);
-create index IDX_TSKINST_SWLANE on JBPM_POOLEDACTOR (SWIMLANEINSTANCE_);
-create index IDX_PROCDEF_STRTST on JBPM_PROCESSDEFINITION (STARTSTATE_);
-create index IDX_PROCIN_ROOTTK on JBPM_PROCESSINSTANCE (ROOTTOKEN_);
-create index IDX_PROCIN_SPROCTK on JBPM_PROCESSINSTANCE (SUPERPROCESSTOKEN_);
-create index IDX_PROCIN_KEY on JBPM_PROCESSINSTANCE (KEY_);
-create index IDX_PROCIN_PROCDEF on JBPM_PROCESSINSTANCE (PROCESSDEFINITION_);
-create index IDX_RTACTN_PRCINST on JBPM_RUNTIMEACTION (PROCESSINSTANCE_);
-create index IDX_RTACTN_ACTION on JBPM_RUNTIMEACTION (ACTION_);
-create index IDX_SWIMLINST_SL on JBPM_SWIMLANEINSTANCE (SWIMLANE_);
-create index IDX_TASK_TSKNODE on JBPM_TASK (TASKNODE_);
-create index IDX_TASK_PROCDEF on JBPM_TASK (PROCESSDEFINITION_);
-create index IDX_TASK_TASKMGTDF on JBPM_TASK (TASKMGMTDEFINITION_);
-create index IDX_TASKINST_TOKN on JBPM_TASKINSTANCE (TOKEN_);
-create index IDX_TASKINST_TSK on JBPM_TASKINSTANCE (TASK_, PROCINST_);
-create index IDX_TSKINST_TMINST on JBPM_TASKINSTANCE (TASKMGMTINSTANCE_);
-create index IDX_TSKINST_SLINST on JBPM_TASKINSTANCE (SWIMLANINSTANCE_);
-create index IDX_TASK_ACTORID on JBPM_TASKINSTANCE (ACTORID_);
-create index IDX_TOKEN_PROCIN on JBPM_TOKEN (PROCESSINSTANCE_);
-create index IDX_TOKEN_SUBPI on JBPM_TOKEN (SUBPROCESSINSTANCE_);
-create index IDX_TOKEN_NODE on JBPM_TOKEN (NODE_);
-create index IDX_TOKEN_PARENT on JBPM_TOKEN (PARENT_);
-create index IDX_TKVARMAP_CTXT on JBPM_TOKENVARIABLEMAP (CONTEXTINSTANCE_);
-create index IDX_TKVVARMP_TOKEN on JBPM_TOKENVARIABLEMAP (TOKEN_);
-create index IDX_TRANSIT_TO on JBPM_TRANSITION (TO_);
-create index IDX_TRANSIT_FROM on JBPM_TRANSITION (FROM_);
-create index IDX_TRANS_PROCDEF on JBPM_TRANSITION (PROCESSDEFINITION_);
-create index IDX_VARINST_TKVARMP on JBPM_VARIABLEINSTANCE (TOKENVARIABLEMAP_);
-create index IDX_VARINST_PRCINS on JBPM_VARIABLEINSTANCE (PROCESSINSTANCE_);
-create index IDX_VARINST_TK on JBPM_VARIABLEINSTANCE (TOKEN_);
-alter table JBPM_ACTION add constraint FK_ACTION_EVENT foreign key (EVENT_) references JBPM_EVENT;
-alter table JBPM_ACTION add constraint FK_ACTION_EXPTHDL foreign key (EXCEPTIONHANDLER_) references JBPM_EXCEPTIONHANDLER;
-alter table JBPM_ACTION add constraint FK_ACTION_PROCDEF foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_ACTION add constraint FK_CRTETIMERACT_TA foreign key (TIMERACTION_) references JBPM_ACTION;
-alter table JBPM_ACTION add constraint FK_ACTION_ACTNDEL foreign key (ACTIONDELEGATION_) references JBPM_DELEGATION;
-alter table JBPM_ACTION add constraint FK_ACTION_REFACT foreign key (REFERENCEDACTION_) references JBPM_ACTION;
-alter table JBPM_BYTEARRAY add constraint FK_BYTEARR_FILDEF foreign key (FILEDEFINITION_) references JBPM_MODULEDEFINITION;
-alter table JBPM_BYTEBLOCK add constraint FK_BYTEBLOCK_FILE foreign key (PROCESSFILE_) references JBPM_BYTEARRAY;
-alter table JBPM_COMMENT add constraint FK_COMMENT_TOKEN foreign key (TOKEN_) references JBPM_TOKEN;
-alter table JBPM_COMMENT add constraint FK_COMMENT_TSK foreign key (TASKINSTANCE_) references JBPM_TASKINSTANCE;
-alter table JBPM_DECISIONCONDITIONS add constraint FK_DECCOND_DEC foreign key (DECISION_) references JBPM_NODE;
-alter table JBPM_DELEGATION add constraint FK_DELEGATION_PRCD foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_EVENT add constraint FK_EVENT_PROCDEF foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_EVENT add constraint FK_EVENT_NODE foreign key (NODE_) references JBPM_NODE;
-alter table JBPM_EVENT add constraint FK_EVENT_TRANS foreign key (TRANSITION_) references JBPM_TRANSITION;
-alter table JBPM_EVENT add constraint FK_EVENT_TASK foreign key (TASK_) references JBPM_TASK;
-alter table JBPM_ID_GROUP add constraint FK_ID_GRP_PARENT foreign key (PARENT_) references JBPM_ID_GROUP;
-alter table JBPM_ID_MEMBERSHIP add constraint FK_ID_MEMSHIP_GRP foreign key (GROUP_) references JBPM_ID_GROUP;
-alter table JBPM_ID_MEMBERSHIP add constraint FK_ID_MEMSHIP_USR foreign key (USER_) references JBPM_ID_USER;
-alter table JBPM_JOB add constraint FK_JOB_TOKEN foreign key (TOKEN_) references JBPM_TOKEN;
-alter table JBPM_JOB add constraint FK_JOB_NODE foreign key (NODE_) references JBPM_NODE;
-alter table JBPM_JOB add constraint FK_JOB_PRINST foreign key (PROCESSINSTANCE_) references JBPM_PROCESSINSTANCE;
-alter table JBPM_JOB add constraint FK_JOB_ACTION foreign key (ACTION_) references JBPM_ACTION;
-alter table JBPM_JOB add constraint FK_JOB_TSKINST foreign key (TASKINSTANCE_) references JBPM_TASKINSTANCE;
-alter table JBPM_LOG add constraint FK_LOG_SOURCENODE foreign key (SOURCENODE_) references JBPM_NODE;
-alter table JBPM_LOG add constraint FK_LOG_TOKEN foreign key (TOKEN_) references JBPM_TOKEN;
-alter table JBPM_LOG add constraint FK_LOG_OLDBYTES foreign key (OLDBYTEARRAY_) references JBPM_BYTEARRAY;
-alter table JBPM_LOG add constraint FK_LOG_NEWBYTES foreign key (NEWBYTEARRAY_) references JBPM_BYTEARRAY;
-alter table JBPM_LOG add constraint FK_LOG_CHILDTOKEN foreign key (CHILD_) references JBPM_TOKEN;
-alter table JBPM_LOG add constraint FK_LOG_DESTNODE foreign key (DESTINATIONNODE_) references JBPM_NODE;
-alter table JBPM_LOG add constraint FK_LOG_TASKINST foreign key (TASKINSTANCE_) references JBPM_TASKINSTANCE;
-alter table JBPM_LOG add constraint FK_LOG_SWIMINST foreign key (SWIMLANEINSTANCE_) references JBPM_SWIMLANEINSTANCE;
-alter table JBPM_LOG add constraint FK_LOG_PARENT foreign key (PARENT_) references JBPM_LOG;
-alter table JBPM_LOG add constraint FK_LOG_NODE foreign key (NODE_) references JBPM_NODE;
-alter table JBPM_LOG add constraint FK_LOG_ACTION foreign key (ACTION_) references JBPM_ACTION;
-alter table JBPM_LOG add constraint FK_LOG_VARINST foreign key (VARIABLEINSTANCE_) references JBPM_VARIABLEINSTANCE;
-alter table JBPM_LOG add constraint FK_LOG_TRANSITION foreign key (TRANSITION_) references JBPM_TRANSITION;
-alter table JBPM_MODULEDEFINITION add constraint FK_TSKDEF_START foreign key (STARTTASK_) references JBPM_TASK;
-alter table JBPM_MODULEDEFINITION add constraint FK_MODDEF_PROCDEF foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_MODULEINSTANCE add constraint FK_TASKMGTINST_TMD foreign key (TASKMGMTDEFINITION_) references JBPM_MODULEDEFINITION;
-alter table JBPM_MODULEINSTANCE add constraint FK_MODINST_PRCINST foreign key (PROCESSINSTANCE_) references JBPM_PROCESSINSTANCE;
-alter table JBPM_NODE add constraint FK_PROCST_SBPRCDEF foreign key (SUBPROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_NODE add constraint FK_NODE_PROCDEF foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_NODE add constraint FK_NODE_SCRIPT foreign key (SCRIPT_) references JBPM_ACTION;
-alter table JBPM_NODE add constraint FK_NODE_ACTION foreign key (ACTION_) references JBPM_ACTION;
-alter table JBPM_NODE add constraint FK_DECISION_DELEG foreign key (DECISIONDELEGATION) references JBPM_DELEGATION;
-alter table JBPM_NODE add constraint FK_NODE_SUPERSTATE foreign key (SUPERSTATE_) references JBPM_NODE;
-alter table JBPM_POOLEDACTOR add constraint FK_POOLEDACTOR_SLI foreign key (SWIMLANEINSTANCE_) references JBPM_SWIMLANEINSTANCE;
-alter table JBPM_PROCESSDEFINITION add constraint FK_PROCDEF_STRTSTA foreign key (STARTSTATE_) references JBPM_NODE;
-alter table JBPM_PROCESSINSTANCE add constraint FK_PROCIN_PROCDEF foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_PROCESSINSTANCE add constraint FK_PROCIN_ROOTTKN foreign key (ROOTTOKEN_) references JBPM_TOKEN;
-alter table JBPM_PROCESSINSTANCE add constraint FK_PROCIN_SPROCTKN foreign key (SUPERPROCESSTOKEN_) references JBPM_TOKEN;
-alter table JBPM_RUNTIMEACTION add constraint FK_RTACTN_PROCINST foreign key (PROCESSINSTANCE_) references JBPM_PROCESSINSTANCE;
-alter table JBPM_RUNTIMEACTION add constraint FK_RTACTN_ACTION foreign key (ACTION_) references JBPM_ACTION;
-alter table JBPM_SWIMLANE add constraint FK_SWL_ASSDEL foreign key (ASSIGNMENTDELEGATION_) references JBPM_DELEGATION;
-alter table JBPM_SWIMLANE add constraint FK_SWL_TSKMGMTDEF foreign key (TASKMGMTDEFINITION_) references JBPM_MODULEDEFINITION;
-alter table JBPM_SWIMLANEINSTANCE add constraint FK_SWIMLANEINST_TM foreign key (TASKMGMTINSTANCE_) references JBPM_MODULEINSTANCE;
-alter table JBPM_SWIMLANEINSTANCE add constraint FK_SWIMLANEINST_SL foreign key (SWIMLANE_) references JBPM_SWIMLANE;
-alter table JBPM_TASK add constraint FK_TSK_TSKCTRL foreign key (TASKCONTROLLER_) references JBPM_TASKCONTROLLER;
-alter table JBPM_TASK add constraint FK_TASK_ASSDEL foreign key (ASSIGNMENTDELEGATION_) references JBPM_DELEGATION;
-alter table JBPM_TASK add constraint FK_TASK_TASKNODE foreign key (TASKNODE_) references JBPM_NODE;
-alter table JBPM_TASK add constraint FK_TASK_PROCDEF foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_TASK add constraint FK_TASK_STARTST foreign key (STARTSTATE_) references JBPM_NODE;
-alter table JBPM_TASK add constraint FK_TASK_TASKMGTDEF foreign key (TASKMGMTDEFINITION_) references JBPM_MODULEDEFINITION;
-alter table JBPM_TASK add constraint FK_TASK_SWIMLANE foreign key (SWIMLANE_) references JBPM_SWIMLANE;
-alter table JBPM_TASKACTORPOOL add constraint FK_TSKACTPOL_PLACT foreign key (POOLEDACTOR_) references JBPM_POOLEDACTOR;
-alter table JBPM_TASKACTORPOOL add constraint FK_TASKACTPL_TSKI foreign key (TASKINSTANCE_) references JBPM_TASKINSTANCE;
-alter table JBPM_TASKCONTROLLER add constraint FK_TSKCTRL_DELEG foreign key (TASKCONTROLLERDELEGATION_) references JBPM_DELEGATION;
-alter table JBPM_TASKINSTANCE add constraint FK_TSKINS_PRCINS foreign key (PROCINST_) references JBPM_PROCESSINSTANCE;
-alter table JBPM_TASKINSTANCE add constraint FK_TASKINST_TMINST foreign key (TASKMGMTINSTANCE_) references JBPM_MODULEINSTANCE;
-alter table JBPM_TASKINSTANCE add constraint FK_TASKINST_TOKEN foreign key (TOKEN_) references JBPM_TOKEN;
-alter table JBPM_TASKINSTANCE add constraint FK_TASKINST_SLINST foreign key (SWIMLANINSTANCE_) references JBPM_SWIMLANEINSTANCE;
-alter table JBPM_TASKINSTANCE add constraint FK_TASKINST_TASK foreign key (TASK_) references JBPM_TASK;
-alter table JBPM_TOKEN add constraint FK_TOKEN_PARENT foreign key (PARENT_) references JBPM_TOKEN;
-alter table JBPM_TOKEN add constraint FK_TOKEN_NODE foreign key (NODE_) references JBPM_NODE;
-alter table JBPM_TOKEN add constraint FK_TOKEN_PROCINST foreign key (PROCESSINSTANCE_) references JBPM_PROCESSINSTANCE;
-alter table JBPM_TOKEN add constraint FK_TOKEN_SUBPI foreign key (SUBPROCESSINSTANCE_) references JBPM_PROCESSINSTANCE;
-alter table JBPM_TOKENVARIABLEMAP add constraint FK_TKVARMAP_CTXT foreign key (CONTEXTINSTANCE_) references JBPM_MODULEINSTANCE;
-alter table JBPM_TOKENVARIABLEMAP add constraint FK_TKVARMAP_TOKEN foreign key (TOKEN_) references JBPM_TOKEN;
-alter table JBPM_TRANSITION add constraint FK_TRANSITION_TO foreign key (TO_) references JBPM_NODE;
-alter table JBPM_TRANSITION add constraint FK_TRANS_PROCDEF foreign key (PROCESSDEFINITION_) references JBPM_PROCESSDEFINITION;
-alter table JBPM_TRANSITION add constraint FK_TRANSITION_FROM foreign key (FROM_) references JBPM_NODE;
-alter table JBPM_VARIABLEACCESS add constraint FK_VARACC_TSKCTRL foreign key (TASKCONTROLLER_) references JBPM_TASKCONTROLLER;
-alter table JBPM_VARIABLEACCESS add constraint FK_VARACC_SCRIPT foreign key (SCRIPT_) references JBPM_ACTION;
-alter table JBPM_VARIABLEACCESS add constraint FK_VARACC_PROCST foreign key (PROCESSSTATE_) references JBPM_NODE;
-alter table JBPM_VARIABLEINSTANCE add constraint FK_VARINST_TK foreign key (TOKEN_) references JBPM_TOKEN;
-alter table JBPM_VARIABLEINSTANCE add constraint FK_VARINST_TKVARMP foreign key (TOKENVARIABLEMAP_) references JBPM_TOKENVARIABLEMAP;
-alter table JBPM_VARIABLEINSTANCE add constraint FK_VARINST_PRCINST foreign key (PROCESSINSTANCE_) references JBPM_PROCESSINSTANCE;
-alter table JBPM_VARIABLEINSTANCE add constraint FK_VAR_TSKINST foreign key (TASKINSTANCE_) references JBPM_TASKINSTANCE;
-alter table JBPM_VARIABLEINSTANCE add constraint FK_BYTEINST_ARRAY foreign key (BYTEARRAYVALUE_) references JBPM_BYTEARRAY;
-create sequence hibernate_sequence;
-
-
-commit;
-
-GRANT DELETE ON "CORPORATIVO"."CP_CONFIGURACAO" TO "SIGAWF";
-GRANT INSERT ON "CORPORATIVO"."CP_CONFIGURACAO" TO "SIGAWF";
-GRANT REFERENCES ON "CORPORATIVO"."CP_CONFIGURACAO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_CONFIGURACAO" TO "SIGAWF";
-GRANT UPDATE ON "CORPORATIVO"."CP_CONFIGURACAO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_CONFIGURACAO_SEQ" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_GRUPO" TO "SIGAWF";
-GRANT REFERENCES ON "CORPORATIVO"."CP_IDENTIDADE" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_IDENTIDADE" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_ORGAO_USUARIO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_PAPEL" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_PERSONALIZACAO" TO "SIGAWF";
-GRANT INSERT ON "CORPORATIVO"."CP_SERVICO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_SERVICO" TO "SIGAWF";
-GRANT UPDATE ON "CORPORATIVO"."CP_SERVICO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_SERVICO_SEQ" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_SITUACAO_CONFIGURACAO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_TIPO_CONFIGURACAO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_TIPO_GRUPO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_TIPO_IDENTIDADE" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_TIPO_LOTACAO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."CP_TIPO_PAPEL" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."DP_CARGO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."DP_FUNCAO_CONFIANCA" TO "SIGAWF";
-GRANT REFERENCES ON "CORPORATIVO"."DP_LOTACAO" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."DP_LOTACAO" TO "SIGAWF";
-GRANT REFERENCES ON "CORPORATIVO"."DP_PESSOA" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."DP_PESSOA" TO "SIGAWF";
-GRANT SELECT ON "CORPORATIVO"."DP_SUBSTITUICAO" TO "SIGAWF";
-GRANT "CONNECT" TO "SIGAWF";
-
-
-/*FIM DOS GRANTS*/
diff --git a/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V1_0__NovoSigaWF.sql b/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V1_0__NovoSigaWF.sql
new file mode 100644
index 0000000000..6ded6533b8
--- /dev/null
+++ b/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V1_0__NovoSigaWF.sql
@@ -0,0 +1,431 @@
+ALTER SESSION SET CURRENT_SCHEMA=sigawf;
+
+-- DROP TABLE wf_responsavel;
+-- DROP TABLE wf_variavel;
+-- DROP TABLE wf_movimentacao;
+-- DROP TABLE wf_procedimento;
+-- DROP TABLE wf_def_variavel;
+-- DROP TABLE wf_def_desvio;
+-- DROP TABLE wf_def_tarefa;
+-- DROP TABLE wf_def_responsavel;
+-- DROP TABLE wf_def_procedimento;
+-- DROP FUNCTION remove_acento;
+
+CREATE SEQUENCE  sigawf.hibernate_sequence  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;
+
+--
+-- Table structure for table wf_def_procedimento
+--
+CREATE TABLE sigawf.wf_def_procedimento (
+  DEFP_ID NUMBER,
+  ORGU_ID NUMBER NULL,
+  DEFP_ANO int NULL,
+  DEFP_DS varchar(256) NOT NULL,
+  DEFP_NM varchar(256) NOT NULL,
+  DEFP_NR int NULL,
+  HIS_ID_INI NUMBER NULL,
+  HIS_ATIVO NUMBER(1,0) NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_IDC_INI NUMBER NULL,
+  HIS_IDC_FIM NUMBER NULL,
+  CONSTRAINT PK_DEF_ID PRIMARY KEY (DEFP_ID)
+);
+
+COMMENT ON COLUMN wf_def_procedimento.DEFP_ID IS 'Identificador da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.ORGU_ID IS 'Identificador do órgao usuário ao qual se vincula a definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.DEFP_ANO IS 'Ano da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.DEFP_DS IS 'Descrição da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.DEFP_NM IS 'Nome da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.DEFP_NR IS 'Número da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.HIS_ID_INI IS 'Identificador inicial da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.HIS_ATIVO IS 'Indica se está ativa a definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.HIS_DT_INI IS 'Data de início da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.HIS_DT_FIM IS 'Data de fim da definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.HIS_IDC_INI IS 'Identificador do cadastrante que criou a definição de procedimento';
+COMMENT ON COLUMN wf_def_procedimento.HIS_IDC_FIM IS 'Identificador do cadastrante que finalizou a definição de procedimento';
+
+--
+-- Table structure for table wf_def_responsavel
+--
+CREATE TABLE sigawf.wf_def_responsavel (
+  DEFR_ID NUMBER,
+  DEFR_DS varchar(256) NULL,
+  DEFR_NM varchar(256) NULL,
+  DEFR_TP varchar(255) NULL,
+  HIS_ID_INI NUMBER NULL,
+  HIS_ATIVO NUMBER(1,0) NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_IDC_INI NUMBER NULL,
+  HIS_IDC_FIM NUMBER NULL,
+  CONSTRAINT DEFR PRIMARY KEY (DEFR_ID)
+) ;
+
+COMMENT ON COLUMN wf_def_responsavel.DEFR_ID IS 'Identificador da definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.DEFR_DS IS 'Descrição da definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.DEFR_NM IS 'Nome da definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.DEFR_TP IS 'Tipo da definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.HIS_ID_INI IS 'Identificador inicial da definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.HIS_ATIVO IS 'Indica se está ativa a definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.HIS_DT_INI IS 'Data de início da definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.HIS_DT_FIM IS 'Data de fim da definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.HIS_IDC_INI IS 'Identificador do cadastrante que criou a definição de responsável';
+COMMENT ON COLUMN wf_def_responsavel.HIS_IDC_FIM IS 'Identificador do cadastrante que finalizou a definição de responsável';
+
+--
+-- Table structure for table wf_def_tarefa
+--
+CREATE TABLE sigawf.wf_def_tarefa (
+  DEFT_ID NUMBER,
+  DEFP_ID NUMBER NULL,
+  DEFR_ID NUMBER NULL,
+  LOTA_ID NUMBER NULL,
+  PESS_ID NUMBER NULL,
+  DEFT_ID_SEGUINTE NUMBER NULL,
+  DEFT_TX_ASSUNTO varchar(256) NULL,
+  DEFT_TX_CONTEUDO varchar(2048) NULL,
+  DEFT_NM varchar(256) NULL,
+  DEFT_DS_REF varchar(256) NULL,
+  DEFT_ID_REF NUMBER NULL,
+  DEFT_SG_REF varchar(32) NULL,
+  DEFT_TP_RESPONSAVEL varchar(255) NULL,
+  DEFT_TP_TAREFA varchar(255) NULL,
+  DEFT_FG_ULTIMO NUMBER(1,0) NULL,
+  DEFT_NR_ORDEM int NULL,
+  HIS_ID_INI NUMBER NULL,
+  HIS_ATIVO NUMBER(1,0) NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_IDC_INI NUMBER NULL,
+  HIS_IDC_FIM NUMBER NULL,
+  PRIMARY KEY (DEFT_ID),
+  CONSTRAINT FK_DEFT_DEFT_ID_SEGUINTE FOREIGN KEY (DEFT_ID_SEGUINTE) REFERENCES wf_def_tarefa (DEFT_ID),
+  CONSTRAINT FK_DEFT_DEFP_ID FOREIGN KEY (DEFP_ID) REFERENCES wf_def_procedimento (DEFP_ID),
+  CONSTRAINT FK_DEFT_DEFR_ID FOREIGN KEY (DEFR_ID) REFERENCES wf_def_responsavel (DEFR_ID)
+) ;
+
+COMMENT ON COLUMN wf_def_tarefa.DEFT_ID IS 'Identificador da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFP_ID IS 'Identificador do procedimento ao qual se liga a definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFR_ID IS 'Identificador do responsável pela execução da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.LOTA_ID IS 'Identificador da lotação responsável da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.PESS_ID IS 'Identificador da pessoa responsável dadefinição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_ID_SEGUINTE IS 'Identificador definição de tarefa seguinte a definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_TX_ASSUNTO IS 'Assunto da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_TX_CONTEUDO IS 'Conteúdo da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_NM IS 'Nome da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_DS_REF IS 'Descrição de alguma entidade externa relacionada a definição de tarefa usado por exemplo para referenciar modelos';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_ID_REF IS 'Identificador de alguma entidade externa relacionada a definição de tarefa usado por exemplo para referenciar modelos';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_SG_REF IS 'Sigla de alguma entidade externa relacionada a definição de tarefa usado por exemplo para referenciar modelos';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_TP_RESPONSAVEL IS 'Tipo do responsável na definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_TP_TAREFA IS 'Tipo de tarefa da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_FG_ULTIMO IS 'Indica que é a última da definição de tarefa do procedimento';
+COMMENT ON COLUMN wf_def_tarefa.DEFT_NR_ORDEM IS 'Número usado para ordenar a definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.HIS_ID_INI IS 'Identificador inicial da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.HIS_ATIVO IS 'Indica se está ativa a definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.HIS_DT_INI IS 'Data de início da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.HIS_DT_FIM IS 'Data de fim da definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.HIS_IDC_INI IS 'Identificador do cadastrante que criou a definição de tarefa';
+COMMENT ON COLUMN wf_def_tarefa.HIS_IDC_FIM IS 'Identificador do cadastrante que finalizou aa definição de tarefa';
+
+CREATE TABLE sigawf.wf_def_desvio (
+  DEFD_ID NUMBER,
+  DEFD_TX_CONDICAO varchar(256) NULL,
+  DEFD_NM varchar(256) NULL,
+  DEFD_NR_ORDEM NUMBER(3,0) NULL,
+  DEFD_FG_ULTIMO NUMBER(1,0) NULL,
+  DEFT_ID NUMBER NULL,
+  DEFT_ID_SEGUINTE NUMBER NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_ID_INI NUMBER NULL,
+  HIS_ATIVO NUMBER(1,0) NULL,
+  HIS_IDC_FIM NUMBER NULL,
+  HIS_IDC_INI NUMBER NULL,
+  CONSTRAINT PK_DEFD_ID PRIMARY KEY (DEFD_ID),
+  CONSTRAINT FK_DEFD_DEFT_ID FOREIGN KEY (DEFT_ID) REFERENCES wf_def_tarefa (DEFT_ID),
+  CONSTRAINT FK_DEFD_DEFT_ID_SEGUINTE FOREIGN KEY (DEFT_ID_SEGUINTE) REFERENCES wf_def_tarefa (DEFT_ID)
+);
+
+COMMENT ON COLUMN wf_def_desvio.DEFD_ID IS 'Identificador da definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.DEFD_TX_CONDICAO IS 'Fórmula matemática para habilitar a definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.DEFD_NM IS 'Nome da definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.DEFD_NR_ORDEM IS 'Número para ordenação da definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.DEFD_FG_ULTIMO IS 'Indica se essa é a última definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.DEFT_ID IS 'Identificador da definição de tarefa ligada a definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.DEFT_ID_SEGUINTE IS 'Identificador da definição de tarefa alvo desta definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.HIS_DT_FIM IS 'Data de fim da definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.HIS_DT_INI IS 'Data de início da definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.HIS_ID_INI IS 'Identificador inicial da definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.HIS_ATIVO IS 'Indica se está ativa a definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.HIS_IDC_FIM IS 'Identificador do cadastrante que finalizou a definição de desvio';
+COMMENT ON COLUMN wf_def_desvio.HIS_IDC_INI IS 'Identificador do cadastrante que criou a definição de desvio';
+
+
+--
+-- Table structure for table wf_def_variavel
+--
+CREATE TABLE sigawf.wf_def_variavel (
+  DEFV_ID NUMBER,
+  DEFT_ID NUMBER NULL,
+  DEFV_CD varchar(32) NULL,
+  DEFV_NM varchar(256) NULL,
+  DEFV_TP varchar(255) NULL,
+  DEFV_TP_ACESSO varchar(255) NULL,
+  DEFV_NR_ORDEM int NULL,
+  HIS_ID_INI NUMBER NULL,
+  HIS_ATIVO NUMBER(1,0) NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_IDC_INI NUMBER NULL,
+  HIS_IDC_FIM NUMBER NULL,
+  CONSTRAINT DEFV PRIMARY KEY (DEFV_ID),
+  CONSTRAINT FK_DEFV_DEFT_ID FOREIGN KEY (DEFT_ID) REFERENCES wf_def_tarefa (DEFT_ID)
+) ;
+
+COMMENT ON COLUMN wf_def_variavel.DEFV_ID IS 'Identificador da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.DEFT_ID IS 'Identificador definição de tarefa a qual se relaciona a definição de variável';
+COMMENT ON COLUMN wf_def_variavel.DEFV_CD IS 'Código da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.DEFV_NM IS 'Nome da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.DEFV_TP IS 'Tipo da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.DEFV_TP_ACESSO IS 'Tipo de acesso da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.DEFV_NR_ORDEM IS 'Número para ordenar a definição de variável';
+COMMENT ON COLUMN wf_def_variavel.HIS_ID_INI IS 'Identificador inicial da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.HIS_ATIVO IS 'Indica se está ativa a definição de variável';
+COMMENT ON COLUMN wf_def_variavel.HIS_DT_INI IS 'Data de início da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.HIS_DT_FIM IS 'Data de fim da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.HIS_IDC_INI IS 'Identificador do cadastrante da criação da definição de variável';
+COMMENT ON COLUMN wf_def_variavel.HIS_IDC_FIM IS 'Identificador do cadastrante da finalização da definição de variável';
+
+--
+-- Table structure for table wf_procedimento
+--
+CREATE TABLE sigawf.wf_procedimento (
+  PROC_ID NUMBER,
+  ORGU_ID NUMBER NULL,
+  DEFP_ID NUMBER NULL,
+  LOTA_ID_EVENTO NUMBER NULL,
+  PESS_ID_EVENTO NUMBER NULL,
+  LOTA_ID_TITULAR NUMBER NULL,
+  PESS_ID_TITULAR NUMBER NULL,
+  PROC_ANO int NULL,
+  PROC_NR int NULL,
+  PROC_TP_PRIORIDADE varchar(255) NULL,
+  PROC_NR_CORRENTE int NULL,
+  PROC_ST_CORRENTE varchar(255) NULL,
+  PROC_TS_EVENTO DATE NULL,
+  PROC_NM_EVENTO varchar(255) NULL,
+  PROC_CD_PRINCIPAL varchar(255) NULL,
+  PROC_TP_PRINCIPAL varchar(255) NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_IDC_INI NUMBER NULL,
+  CONSTRAINT PROC PRIMARY KEY (PROC_ID),
+  CONSTRAINT FK_PROC_DEFP_ID FOREIGN KEY (DEFP_ID) REFERENCES wf_def_procedimento (DEFP_ID)
+) ;
+COMMENT ON COLUMN wf_procedimento.PROC_ID IS 'Identificador do procedimento';
+COMMENT ON COLUMN wf_procedimento.ORGU_ID IS 'Identificador do órgão usuário ao qual se relaciona o procedimento';
+COMMENT ON COLUMN wf_procedimento.DEFP_ID IS 'Identificador da definição do procedimento';
+COMMENT ON COLUMN wf_procedimento.LOTA_ID_EVENTO IS 'Identificador da lotação responsável pelo evento atual do procedimento';
+COMMENT ON COLUMN wf_procedimento.PESS_ID_EVENTO IS 'Identificador da pessoa responsável pelo evento atual do procedimento';
+COMMENT ON COLUMN wf_procedimento.LOTA_ID_TITULAR IS 'Identificador da lotação do titular que criou o procedimento';
+COMMENT ON COLUMN wf_procedimento.PESS_ID_TITULAR IS 'Identificador da pessoa que criou o procedimento do procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_ANO IS 'Ano do procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_NR IS 'Número do procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_TP_PRIORIDADE IS 'Prioridade do procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_NR_CORRENTE IS 'Número do passo em que se encontra o procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_ST_CORRENTE IS 'Status atual do procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_TS_EVENTO IS 'Data e hora do evento do procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_NM_EVENTO IS 'Nome do evento do procedimento';
+COMMENT ON COLUMN wf_procedimento.PROC_CD_PRINCIPAL IS 'Código do principal relacionado ao procedimento, no caso de um documento, é algo do tipo JFRJ-MEM-2020/000001';
+COMMENT ON COLUMN wf_procedimento.PROC_TP_PRINCIPAL IS 'Tipo do principal do procedimento';
+COMMENT ON COLUMN wf_procedimento.HIS_DT_INI IS 'Data de fim do procedimento';
+COMMENT ON COLUMN wf_procedimento.HIS_DT_FIM IS 'Data de início do procedimento';
+COMMENT ON COLUMN wf_procedimento.HIS_IDC_INI IS 'Identificador do cadastrante da criação do procedimento';
+
+
+--
+-- Table structure for table wf_movimentacao
+--
+CREATE TABLE sigawf.wf_movimentacao (
+  MOVI_ID NUMBER,
+  MOVI_TP varchar(31) NOT NULL,
+  PROC_ID NUMBER NULL,
+  LOTA_ID_TITULAR NUMBER NULL,
+  PESS_ID_TITULAR NUMBER NULL,
+  DEFT_ID_DE NUMBER NULL,
+  DEFT_ID_PARA NUMBER NULL,
+  LOTA_ID_DE NUMBER NULL,
+  LOTA_ID_PARA NUMBER NULL,
+  PESS_ID_DE NUMBER NULL,
+  PESS_ID_PARA NUMBER NULL,
+  MOVI_DS varchar(400) NULL,
+  MOVI_TP_DESIGNACAO varchar(255) NULL,
+  HIS_ID_INI NUMBER NULL,
+  HIS_ATIVO NUMBER(1,0) NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_IDC_INI NUMBER NULL,
+  HIS_IDC_FIM NUMBER NULL,
+  CONSTRAINT MOVI PRIMARY KEY (MOVI_ID),
+  CONSTRAINT FK_MOVI_DEFT_ID_DE FOREIGN KEY (DEFT_ID_DE) REFERENCES wf_def_tarefa (DEFT_ID),
+  CONSTRAINT FK_MOVI_DEFT_ID_PARA FOREIGN KEY (DEFT_ID_PARA) REFERENCES wf_def_tarefa (DEFT_ID),
+  CONSTRAINT FK_MOVI_PROC_ID FOREIGN KEY (PROC_ID) REFERENCES wf_procedimento (PROC_ID)
+) ;
+
+COMMENT ON COLUMN wf_movimentacao.MOVI_ID IS 'Identificador da movimentação';
+COMMENT ON COLUMN wf_movimentacao.MOVI_TP IS 'Tipo da movimentação';
+COMMENT ON COLUMN wf_movimentacao.PROC_ID IS 'Identificador do procedimento ao qual se relaciona a movimentação';
+COMMENT ON COLUMN wf_movimentacao.LOTA_ID_TITULAR IS 'Identificador da lotação do titular da movimentação';
+COMMENT ON COLUMN wf_movimentacao.PESS_ID_TITULAR IS 'Identificador da pessoa do titular da movimentação';
+COMMENT ON COLUMN wf_movimentacao.DEFT_ID_DE IS 'Identificador da definição de tarefa origem da movimentação';
+COMMENT ON COLUMN wf_movimentacao.DEFT_ID_PARA IS 'Identificador da definição de tarefa destino da movimentação';
+COMMENT ON COLUMN wf_movimentacao.LOTA_ID_DE IS 'Identificador da lotação origem da movimentação';
+COMMENT ON COLUMN wf_movimentacao.LOTA_ID_PARA IS 'Identificador da lotação destino da movimentação';
+COMMENT ON COLUMN wf_movimentacao.PESS_ID_DE IS 'Identificador da pessoa origem da movimentação';
+COMMENT ON COLUMN wf_movimentacao.PESS_ID_PARA IS 'Identificador da pessoa destino da movimentação';
+COMMENT ON COLUMN wf_movimentacao.MOVI_DS IS 'Descrição da movimentação';
+COMMENT ON COLUMN wf_movimentacao.MOVI_TP_DESIGNACAO IS 'Numa designação, indica o tipo de designação da movimentação';
+COMMENT ON COLUMN wf_movimentacao.HIS_ID_INI IS 'Identificador inicial da movimentação';
+COMMENT ON COLUMN wf_movimentacao.HIS_ATIVO IS 'Indica se a movimentação está ativa';
+COMMENT ON COLUMN wf_movimentacao.HIS_DT_INI IS 'Data de início da movimentação';
+COMMENT ON COLUMN wf_movimentacao.HIS_DT_FIM IS 'Data de fim da movimentação';
+COMMENT ON COLUMN wf_movimentacao.HIS_IDC_INI IS 'Identificador do cadastrante que criou a movimentação';
+COMMENT ON COLUMN wf_movimentacao.HIS_IDC_FIM IS 'Identificador do cadastrante que finalizou a movimentação';
+
+
+--
+-- Table structure for table wf_responsavel
+--
+CREATE TABLE sigawf.wf_responsavel (
+  RESP_ID NUMBER,
+  DEFR_ID NUMBER NULL,
+  ORGU_ID NUMBER NULL,
+  LOTA_ID NUMBER NULL,
+  PESS_ID NUMBER NULL,
+  HIS_ID_INI NUMBER NULL,
+  HIS_ATIVO NUMBER(1,0) NULL,
+  HIS_DT_INI DATE NULL,
+  HIS_DT_FIM DATE NULL,
+  HIS_IDC_INI NUMBER NULL,
+  HIS_IDC_FIM NUMBER NULL,
+  CONSTRAINT RESP PRIMARY KEY (RESP_ID),
+  CONSTRAINT FK_RESP_DEFR_ID FOREIGN KEY (DEFR_ID) REFERENCES wf_def_responsavel (DEFR_ID)
+) ;
+COMMENT ON COLUMN wf_responsavel.RESP_ID IS 'Identificador do responsável';
+COMMENT ON COLUMN wf_responsavel.DEFR_ID IS 'Identificador da definição do responsável';
+COMMENT ON COLUMN wf_responsavel.ORGU_ID IS 'Identificador do órgão vinculado ao responsável';
+COMMENT ON COLUMN wf_responsavel.LOTA_ID IS 'Identificador da lotação vinculada ao responsável';
+COMMENT ON COLUMN wf_responsavel.PESS_ID IS 'Identificador da pessoa vinculada ao responsável';
+COMMENT ON COLUMN wf_responsavel.HIS_ID_INI IS 'Identificador inicial do responsável';
+COMMENT ON COLUMN wf_responsavel.HIS_ATIVO IS 'Indica se está ativo o responsável';
+COMMENT ON COLUMN wf_responsavel.HIS_DT_INI IS 'Data de início do responsável';
+COMMENT ON COLUMN wf_responsavel.HIS_DT_FIM IS 'Data de fim do responsável';
+COMMENT ON COLUMN wf_responsavel.HIS_IDC_INI IS 'Identificador do cadastrante que criou o responsável';
+COMMENT ON COLUMN wf_responsavel.HIS_IDC_FIM IS 'Identificador do cadastrante que finalizou o responsável';
+
+
+--
+-- Table structure for table wf_variavel
+--
+CREATE TABLE sigawf.wf_variavel (
+  VARI_ID NUMBER,
+  PROC_ID NUMBER NULL,
+  VARI_FG NUMBER(1,0) NULL,
+  VARI_DF DATE NULL,
+  VARI_NM varchar(256) NULL,
+  VARI_NR NUMBER(19,10) NULL,
+  VARI_TX varchar(255) NULL,
+  CONSTRAINT VARI PRIMARY KEY (VARI_ID),
+  CONSTRAINT FK_VARI_PROC_ID FOREIGN KEY (PROC_ID) REFERENCES wf_procedimento (PROC_ID)
+) ;
+COMMENT ON COLUMN wf_variavel.VARI_ID IS 'Identificador da variável';
+COMMENT ON COLUMN wf_variavel.PROC_ID IS 'Identificador do procedimento relacionado a variável';
+COMMENT ON COLUMN wf_variavel.VARI_FG IS 'Conteúdo da variável quando é um booleano';
+COMMENT ON COLUMN wf_variavel.VARI_DF IS 'Conteúdo da variável quando é uma data';
+COMMENT ON COLUMN wf_variavel.VARI_NM IS 'Nome da variável';
+COMMENT ON COLUMN wf_variavel.VARI_NR IS 'Conteúdo da variável quando é um número';
+COMMENT ON COLUMN wf_variavel.VARI_TX IS 'Conteúdo da variável quando é um texto';
+
+--------------------------------------------------------
+--  DDL for Function REMOVE_ACENTO
+--------------------------------------------------------
+
+  CREATE OR REPLACE FUNCTION SIGAWF.REMOVE_ACENTO 
+    (acentuado in
+    VARCHAR2)
+
+--	Enter the parameters for the function in
+--	the brackets above.  If this function has
+--	no parameters then delete the line
+
+--  ***************************************************
+--	*                                                 *
+--	*   Author                                        *
+--	*   Creation Date                                 *
+--	*   Comments                                      *
+--	*                                                 *
+--  ***************************************************
+
+RETURN  VARCHAR2
+
+IS
+
+--	Enter all variables cursors and constants following
+--	this line
+sem_acento VARCHAR2(4000);
+
+begin
+
+--	Enter the code for the function following
+--	this line
+
+      sem_acento := CONVERT(TRANSLATE(UPPER( acentuado ),'ÃÕÑ','AON'),'US7ASCII');
+
+	return	sem_acento;
+			
+exception
+
+--	Enter the code to handle exception conditions
+--	following this line
+
+
+	when others then
+		null;
+			
+end;
+ 
+/
+
+
+GRANT DELETE ON CORPORATIVO.CP_CONFIGURACAO TO SIGAWF;
+GRANT INSERT ON CORPORATIVO.CP_CONFIGURACAO TO SIGAWF;
+GRANT REFERENCES ON CORPORATIVO.CP_CONFIGURACAO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_CONFIGURACAO TO SIGAWF;
+GRANT UPDATE ON CORPORATIVO.CP_CONFIGURACAO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_CONFIGURACAO_SEQ TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_GRUPO TO SIGAWF;
+GRANT REFERENCES ON CORPORATIVO.CP_IDENTIDADE TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_IDENTIDADE TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_ORGAO_USUARIO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_PAPEL TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_PERSONALIZACAO TO SIGAWF;
+GRANT INSERT ON CORPORATIVO.CP_SERVICO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_SERVICO TO SIGAWF;
+GRANT UPDATE ON CORPORATIVO.CP_SERVICO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_SERVICO_SEQ TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_SITUACAO_CONFIGURACAO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_TIPO_CONFIGURACAO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_TIPO_GRUPO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_TIPO_IDENTIDADE TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_TIPO_LOTACAO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_TIPO_PAPEL TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.DP_CARGO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.DP_FUNCAO_CONFIANCA TO SIGAWF;
+GRANT REFERENCES ON CORPORATIVO.DP_LOTACAO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.DP_LOTACAO TO SIGAWF;
+GRANT REFERENCES ON CORPORATIVO.DP_PESSOA TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.DP_PESSOA TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.DP_SUBSTITUICAO TO SIGAWF;
+GRANT SELECT ON CORPORATIVO.CP_TIPO_PESSOA TO SIGAWF;
+GRANT CONNECT TO SIGAWF;
\ No newline at end of file
diff --git a/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V2_0__Description.sql b/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V2_0__Description.sql
deleted file mode 100644
index 99f541bacc..0000000000
--- a/siga-wf/src/main/resources/db/migration/SIGAWF_UTF8_V2_0__Description.sql
+++ /dev/null
@@ -1,9 +0,0 @@
--------------------------------------------
---	SCRIPT:Grant para CP_TIPO_PESSOA
--------------------------------------------
-
---SET DEFINE OFF;
-
-ALTER SESSION SET CURRENT_SCHEMA=corporativo;
-
-GRANT SELECT ON "CORPORATIVO"."CP_TIPO_PESSOA" TO "SIGAWF";
\ No newline at end of file
diff --git a/siga-wf/src/main/resources/db/mysql/sigawf/V1.0__Inicial.sql b/siga-wf/src/main/resources/db/mysql/sigawf/V1.0__Inicial.sql
new file mode 100644
index 0000000000..09fa6dcfd5
--- /dev/null
+++ b/siga-wf/src/main/resources/db/mysql/sigawf/V1.0__Inicial.sql
@@ -0,0 +1,408 @@
+CREATE DATABASE  IF NOT EXISTS `sigawf` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci */ /*!80016 DEFAULT ENCRYPTION='N' */;
+USE `sigawf`;
+-- MySQL dump 10.13  Distrib 8.0.19, for macos10.15 (x86_64)
+--
+-- Host: 127.0.0.1    Database: sigawf
+-- ------------------------------------------------------
+-- Server version	8.0.19
+
+/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
+/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
+/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
+/*!50503 SET NAMES utf8 */;
+/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
+/*!40103 SET TIME_ZONE='+00:00' */;
+/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
+/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
+/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
+/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
+
+--
+-- Table structure for table `wf_def_desvio`
+--
+
+DROP TABLE IF EXISTS `wf_def_desvio`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_def_desvio` (
+  `DEFD_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador da definição de desvio',
+  `DEFD_TX_CONDICAO` varchar(256) DEFAULT NULL COMMENT 'Fórmula matemática para habilitar a definição de desvio',
+  `DEFD_NM` varchar(256) DEFAULT NULL COMMENT 'Nome da definição de desvio',
+  `DEFD_NR_ORDEM` int DEFAULT NULL COMMENT 'Número para ordenação da definição de desvio',
+  `DEFD_FG_ULTIMO` bit(1) DEFAULT NULL COMMENT 'Indica se essa é a última definição de desvio',
+  `DEFT_ID` bigint DEFAULT NULL COMMENT 'Identificador da definição de tarefa ligada a definição de desvio',
+  `DEFT_ID_SEGUINTE` bigint DEFAULT NULL COMMENT 'Identificador da definição de tarefa alvo desta definição de desvio',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de fim da definição de desvio',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de início da definição de desvio',
+  `HIS_ID_INI` bigint DEFAULT NULL COMMENT 'Identificador inicial da definição de desvio',
+  `HIS_ATIVO` int DEFAULT NULL COMMENT 'Indica se está ativa a definição de desvio',
+  `HIS_IDC_FIM` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que finalizou a definição de desvio',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que criou a definição de desvio',
+  PRIMARY KEY (`DEFD_ID`),
+  KEY `FK_DEFD_DEFT_ID` (`DEFT_ID`),
+  KEY `FK_DEFD_DEFT_ID_SEGUINTE` (`DEFT_ID_SEGUINTE`),
+  CONSTRAINT `FK_DEFD_DEFT_ID` FOREIGN KEY (`DEFT_ID`) REFERENCES `wf_def_tarefa` (`DEFT_ID`),
+  CONSTRAINT `FK_DEFD_DEFT_ID_SEGUINTE` FOREIGN KEY (`DEFT_ID_SEGUINTE`) REFERENCES `wf_def_tarefa` (`DEFT_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_def_desvio`
+--
+
+LOCK TABLES `wf_def_desvio` WRITE;
+/*!40000 ALTER TABLE `wf_def_desvio` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_def_desvio` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_def_procedimento`
+--
+
+DROP TABLE IF EXISTS `wf_def_procedimento`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_def_procedimento` (
+  `DEFP_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador da definição de procedimento',
+  `ORGU_ID` bigint DEFAULT NULL COMMENT 'Identificador do órgao usuário ao qual se vincula a definição de procedimento',
+  `DEFP_ANO` int DEFAULT NULL COMMENT 'Ano da definição de procedimento',
+  `DEFP_DS` varchar(256) NOT NULL COMMENT 'Descrição da definição de procedimento',
+  `DEFP_NM` varchar(256) NOT NULL COMMENT 'Nome da definição de procedimento',
+  `DEFP_NR` int DEFAULT NULL COMMENT 'Número da definição de procedimento',
+  `HIS_ID_INI` bigint DEFAULT NULL COMMENT 'Identificador inicial da definição de procedimento',
+  `HIS_ATIVO` int DEFAULT NULL COMMENT 'Indica se está ativa a definição de procedimento',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de início da definição de procedimento',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de fim da definição de procedimento',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que criou a definição de procedimento',
+  `HIS_IDC_FIM` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que finalizou a definição de procedimento',
+  PRIMARY KEY (`DEFP_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_def_procedimento`
+--
+
+LOCK TABLES `wf_def_procedimento` WRITE;
+/*!40000 ALTER TABLE `wf_def_procedimento` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_def_procedimento` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_def_responsavel`
+--
+
+DROP TABLE IF EXISTS `wf_def_responsavel`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_def_responsavel` (
+  `DEFR_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador da definição de responsável',
+  `DEFR_DS` varchar(256) DEFAULT NULL COMMENT 'Descrição da definição de responsável',
+  `DEFR_NM` varchar(256) DEFAULT NULL COMMENT 'Nome da definição de responsável',
+  `DEFR_TP` varchar(255) DEFAULT NULL COMMENT 'Tipo da definição de responsável',
+  `HIS_ID_INI` bigint DEFAULT NULL COMMENT 'Identificador inicial da definição de responsável',
+  `HIS_ATIVO` int DEFAULT NULL COMMENT 'Indica se está ativa a definição de responsável',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de início da definição de responsável',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de fim da definição de responsável',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que criou a definição de responsável',
+  `HIS_IDC_FIM` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que finalizou a definição de responsável',
+  PRIMARY KEY (`DEFR_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_def_responsavel`
+--
+
+LOCK TABLES `wf_def_responsavel` WRITE;
+/*!40000 ALTER TABLE `wf_def_responsavel` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_def_responsavel` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_def_tarefa`
+--
+
+DROP TABLE IF EXISTS `wf_def_tarefa`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_def_tarefa` (
+  `DEFT_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador da definição de tarefa',
+  `DEFP_ID` bigint DEFAULT NULL COMMENT 'Identificador do procedimento ao qual se liga a definição de tarefa',
+  `DEFR_ID` bigint DEFAULT NULL COMMENT 'Identificador do responsável pela execução da definição de tarefa',
+  `LOTA_ID` bigint DEFAULT NULL COMMENT 'Identificador da lotação responsável da definição de tarefa',
+  `PESS_ID` bigint DEFAULT NULL COMMENT 'Identificador da pessoa responsável dadefinição de tarefa',
+  `DEFT_ID_SEGUINTE` bigint DEFAULT NULL COMMENT 'Identificador definição de tarefa seguinte a definição de tarefa',
+  `DEFT_TX_ASSUNTO` varchar(256) DEFAULT NULL COMMENT 'Assunto da definição de tarefa',
+  `DEFT_TX_CONTEUDO` varchar(2048) DEFAULT NULL COMMENT 'Conteúdo da definição de tarefa',
+  `DEFT_NM` varchar(256) DEFAULT NULL COMMENT 'Nome da definição de tarefa',
+  `DEFT_DS_REF` varchar(256) DEFAULT NULL COMMENT 'Descrição de alguma entidade externa relacionada a definição de tarefa usado por exemplo para referenciar modelos',
+  `DEFT_ID_REF` bigint DEFAULT NULL COMMENT 'Identificador de alguma entidade externa relacionada a definição de tarefa usado por exemplo para referenciar modelos',
+  `DEFT_SG_REF` varchar(32) DEFAULT NULL COMMENT 'Sigla de alguma entidade externa relacionada a definição de tarefa usado por exemplo para referenciar modelos',
+  `DEFT_TP_RESPONSAVEL` varchar(255) DEFAULT NULL COMMENT 'Tipo do responsável na definição de tarefa',
+  `DEFT_TP_TAREFA` varchar(255) DEFAULT NULL COMMENT 'Tipo de tarefa da definição de tarefa',
+  `DEFT_FG_ULTIMO` bit(1) DEFAULT NULL COMMENT 'Indica que é a última da definição de tarefa do procedimento',
+  `DEFT_NR_ORDEM` int DEFAULT NULL COMMENT 'Número usado para ordenar a definição de tarefa',
+  `HIS_ID_INI` bigint DEFAULT NULL COMMENT 'Identificador inicial da definição de tarefa',
+  `HIS_ATIVO` int DEFAULT NULL COMMENT 'Indica se está ativa a definição de tarefa',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de início da definição de tarefa',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de fim da definição de tarefa',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que criou a definição de tarefa',
+  `HIS_IDC_FIM` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que finalizou aa definição de tarefa',
+  PRIMARY KEY (`DEFT_ID`),
+  KEY `FK_DEFT_DEFP_ID` (`DEFP_ID`),
+  KEY `FK_DEFT_DEFR_ID` (`DEFR_ID`),
+  KEY `FK_DEFT_DEFT_ID_SEGUINTE` (`DEFT_ID_SEGUINTE`),
+  CONSTRAINT `FK_DEFT_DEFT_ID_SEGUINTE` FOREIGN KEY (`DEFT_ID_SEGUINTE`) REFERENCES `wf_def_tarefa` (`DEFT_ID`),
+  CONSTRAINT `FK_DEFT_DEFP_ID` FOREIGN KEY (`DEFP_ID`) REFERENCES `wf_def_procedimento` (`DEFP_ID`),
+  CONSTRAINT `FK_DEFT_DEFR_ID` FOREIGN KEY (`DEFR_ID`) REFERENCES `wf_def_responsavel` (`DEFR_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_def_tarefa`
+--
+
+LOCK TABLES `wf_def_tarefa` WRITE;
+/*!40000 ALTER TABLE `wf_def_tarefa` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_def_tarefa` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_def_variavel`
+--
+
+DROP TABLE IF EXISTS `wf_def_variavel`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_def_variavel` (
+  `DEFV_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador da definição de variável',
+  `DEFT_ID` bigint DEFAULT NULL COMMENT 'Identificador definição de tarefa a qual se relaciona a definição de variável',
+  `DEFV_CD` varchar(32) DEFAULT NULL COMMENT 'Código da definição de variável',
+  `DEFV_NM` varchar(256) DEFAULT NULL COMMENT 'Nome da definição de variável',
+  `DEFV_TP` varchar(255) DEFAULT NULL COMMENT 'Tipo da definição de variável',
+  `DEFV_TP_ACESSO` varchar(255) DEFAULT NULL COMMENT 'Tipo de acesso da definição de variável',
+  `DEFV_NR_ORDEM` int DEFAULT NULL COMMENT 'Número para ordenar a definição de variável',
+  `HIS_ID_INI` bigint DEFAULT NULL COMMENT 'Identificador inicial da definição de variável',
+  `HIS_ATIVO` int DEFAULT NULL COMMENT 'Indica se está ativa a definição de variável',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de início da definição de variável',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de fim da definição de variável',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante da criação da definição de variável',
+  `HIS_IDC_FIM` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante da finalização da definição de variável',
+  PRIMARY KEY (`DEFV_ID`),
+  KEY `FK_DEFV_DEFT_ID` (`DEFT_ID`),
+  CONSTRAINT `FK_DEFV_DEFT_ID` FOREIGN KEY (`DEFT_ID`) REFERENCES `wf_def_tarefa` (`DEFT_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_def_variavel`
+--
+
+LOCK TABLES `wf_def_variavel` WRITE;
+/*!40000 ALTER TABLE `wf_def_variavel` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_def_variavel` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_movimentacao`
+--
+
+DROP TABLE IF EXISTS `wf_movimentacao`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_movimentacao` (
+  `MOVI_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador da movimentação',
+  `MOVI_TP` varchar(31) NOT NULL COMMENT 'Tipo da movimentação',
+  `PROC_ID` bigint DEFAULT NULL COMMENT 'Identificador do procedimento ao qual se relaciona a movimentação',
+  `LOTA_ID_TITULAR` bigint DEFAULT NULL COMMENT 'Identificador da lotação do titular da movimentação',
+  `PESS_ID_TITULAR` bigint DEFAULT NULL COMMENT 'Identificador da pessoa do titular da movimentação',
+  `DEFT_ID_DE` bigint DEFAULT NULL COMMENT 'Identificador da definição de tarefa origem da movimentação',
+  `DEFT_ID_PARA` bigint DEFAULT NULL COMMENT 'Identificador da definição de tarefa destino da movimentação',
+  `LOTA_ID_DE` bigint DEFAULT NULL COMMENT 'Identificador da lotação origem da movimentação',
+  `LOTA_ID_PARA` bigint DEFAULT NULL COMMENT 'Identificador da lotação destino da movimentação',
+  `PESS_ID_DE` bigint DEFAULT NULL COMMENT 'Identificador da pessoa origem da movimentação',
+  `PESS_ID_PARA` bigint DEFAULT NULL COMMENT 'Identificador da pessoa destino da movimentação',
+  `MOVI_DS` varchar(400) DEFAULT NULL COMMENT 'Descrição da movimentação',
+  `MOVI_TP_DESIGNACAO` varchar(255) DEFAULT NULL COMMENT 'Numa designação, indica o tipo de designação da movimentação',
+  `HIS_ID_INI` bigint DEFAULT NULL COMMENT 'Identificador inicial da movimentação',
+  `HIS_ATIVO` int DEFAULT NULL COMMENT 'Indica se a movimentação está ativa',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de início da movimentação',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de fim da movimentação',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que criou a movimentação',
+  `HIS_IDC_FIM` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que finalizou a movimentação',
+  PRIMARY KEY (`MOVI_ID`),
+  KEY `FK_MOVI_PROC_ID` (`PROC_ID`),
+  KEY `FK_MOVI_DEFT_ID_DE` (`DEFT_ID_DE`),
+  KEY `FK_MOVI_DEFT_ID_PARA` (`DEFT_ID_PARA`),
+  CONSTRAINT `FK_MOVI_DEFT_ID_DE` FOREIGN KEY (`DEFT_ID_DE`) REFERENCES `wf_def_tarefa` (`DEFT_ID`),
+  CONSTRAINT `FK_MOVI_DEFT_ID_PARA` FOREIGN KEY (`DEFT_ID_PARA`) REFERENCES `wf_def_tarefa` (`DEFT_ID`),
+  CONSTRAINT `FK_MOVI_PROC_ID` FOREIGN KEY (`PROC_ID`) REFERENCES `wf_procedimento` (`PROC_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_movimentacao`
+--
+
+LOCK TABLES `wf_movimentacao` WRITE;
+/*!40000 ALTER TABLE `wf_movimentacao` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_movimentacao` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_procedimento`
+--
+
+DROP TABLE IF EXISTS `wf_procedimento`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_procedimento` (
+  `PROC_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador do procedimento',
+  `ORGU_ID` bigint DEFAULT NULL COMMENT 'Identificador do órgão usuário ao qual se relaciona o procedimento',
+  `DEFP_ID` bigint DEFAULT NULL COMMENT 'Identificador da definição do procedimento',
+  `LOTA_ID_EVENTO` bigint DEFAULT NULL COMMENT 'Identificador da lotação responsável pelo evento atual do procedimento',
+  `PESS_ID_EVENTO` bigint DEFAULT NULL COMMENT 'Identificador da pessoa responsável pelo evento atual do procedimento',
+  `LOTA_ID_TITULAR` bigint DEFAULT NULL COMMENT 'Identificador da lotação do titular que criou o procedimento',
+  `PESS_ID_TITULAR` bigint DEFAULT NULL COMMENT 'Identificador da pessoa que criou o procedimento do procedimento',
+  `PROC_ANO` int DEFAULT NULL COMMENT 'Ano do procedimento',
+  `PROC_NR` int DEFAULT NULL COMMENT 'Número do procedimento',
+  `PROC_TP_PRIORIDADE` varchar(255) DEFAULT NULL COMMENT 'Prioridade do procedimento',
+  `PROC_NR_CORRENTE` int DEFAULT NULL COMMENT 'Número do passo em que se encontra o procedimento',
+  `PROC_ST_CORRENTE` varchar(255) DEFAULT NULL COMMENT 'Status atual do procedimento',
+  `PROC_TS_EVENTO` datetime(6) DEFAULT NULL COMMENT 'Data e hora do evento do procedimento',
+  `PROC_NM_EVENTO` varchar(255) DEFAULT NULL COMMENT 'Nome do evento do procedimento',
+  `PROC_CD_PRINCIPAL` varchar(255) DEFAULT NULL COMMENT 'Código do principal relacionado ao procedimento, no caso de um documento, é algo do tipo JFRJ-MEM-2020/000001',
+  `PROC_TP_PRINCIPAL` varchar(255) DEFAULT NULL COMMENT 'Tipo do principal do procedimento',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de fim do procedimento',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de início do procedimento',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante da criação do procedimento',
+  PRIMARY KEY (`PROC_ID`),
+  KEY `FK_PROC_DEFP_ID` (`DEFP_ID`),
+  CONSTRAINT `FK_PROC_DEFP_ID` FOREIGN KEY (`DEFP_ID`) REFERENCES `wf_def_procedimento` (`DEFP_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_procedimento`
+--
+
+LOCK TABLES `wf_procedimento` WRITE;
+/*!40000 ALTER TABLE `wf_procedimento` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_procedimento` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_responsavel`
+--
+
+DROP TABLE IF EXISTS `wf_responsavel`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_responsavel` (
+  `RESP_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador do responsável',
+  `DEFR_ID` bigint DEFAULT NULL COMMENT 'Identificador da definição do responsável',
+  `ORGU_ID` bigint DEFAULT NULL COMMENT 'Identificador do órgão vinculado ao responsável',
+  `LOTA_ID` bigint DEFAULT NULL COMMENT 'Identificador da lotação vinculada ao responsável',
+  `PESS_ID` bigint DEFAULT NULL COMMENT 'Identificador da pessoa vinculada ao responsável',
+  `HIS_ID_INI` bigint DEFAULT NULL COMMENT 'Identificador inicial do responsável',
+  `HIS_ATIVO` int DEFAULT NULL COMMENT 'Indica se está ativo o responsável',
+  `HIS_DT_INI` datetime(6) DEFAULT NULL COMMENT 'Data de início do responsável',
+  `HIS_DT_FIM` datetime(6) DEFAULT NULL COMMENT 'Data de fim do responsável',
+  `HIS_IDC_INI` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que criou o responsável',
+  `HIS_IDC_FIM` bigint DEFAULT NULL COMMENT 'Identificador do cadastrante que finalizou o responsável',
+  PRIMARY KEY (`RESP_ID`),
+  KEY `FK_RESP_DEFR_ID` (`DEFR_ID`),
+  CONSTRAINT `FK_RESP_DEFR_ID` FOREIGN KEY (`DEFR_ID`) REFERENCES `wf_def_responsavel` (`DEFR_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_responsavel`
+--
+
+LOCK TABLES `wf_responsavel` WRITE;
+/*!40000 ALTER TABLE `wf_responsavel` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_responsavel` ENABLE KEYS */;
+UNLOCK TABLES;
+
+--
+-- Table structure for table `wf_variavel`
+--
+
+DROP TABLE IF EXISTS `wf_variavel`;
+/*!40101 SET @saved_cs_client     = @@character_set_client */;
+/*!50503 SET character_set_client = utf8mb4 */;
+CREATE TABLE `wf_variavel` (
+  `VARI_ID` bigint NOT NULL AUTO_INCREMENT COMMENT 'Identificador da variável',
+  `PROC_ID` bigint DEFAULT NULL COMMENT 'Identificador do procedimento relacionado a variável',
+  `VARI_FG` bit(1) DEFAULT NULL COMMENT 'Conteúdo da variável quando é um booleano',
+  `VARI_DF` datetime(6) DEFAULT NULL COMMENT 'Conteúdo da variável quando é uma data',
+  `VARI_NM` varchar(256) DEFAULT NULL COMMENT 'Nome da variável',
+  `VARI_NR` double DEFAULT NULL COMMENT 'Conteúdo da variável quando é um número',
+  `VARI_TX` varchar(255) DEFAULT NULL COMMENT 'Conteúdo da variável quando é um texto',
+  PRIMARY KEY (`VARI_ID`),
+  KEY `FK_VARI_PROC_ID` (`PROC_ID`),
+  CONSTRAINT `FK_VARI_PROC_ID` FOREIGN KEY (`PROC_ID`) REFERENCES `wf_procedimento` (`PROC_ID`)
+) ENGINE=InnoDB DEFAULT CHARSET=utf8;
+/*!40101 SET character_set_client = @saved_cs_client */;
+
+--
+-- Dumping data for table `wf_variavel`
+--
+
+LOCK TABLES `wf_variavel` WRITE;
+/*!40000 ALTER TABLE `wf_variavel` DISABLE KEYS */;
+/*!40000 ALTER TABLE `wf_variavel` ENABLE KEYS */;
+UNLOCK TABLES;
+
+drop function if exists remove_acento;
+delimiter //
+create function remove_acento( textvalue varchar(10000) )
+returns varchar(10000) DETERMINISTIC
+begin
+
+set @textvalue = textvalue;
+
+-- ACCENTS
+set @withaccents = 'ŠšŽžÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÑÒÓÔÕÖØÙÚÛÜÝŸÞàáâãäåæçèéêëìíîïñòóôõöøùúûüýÿþƒ';
+set @withoutaccents = 'SsZzAAAAAAACEEEEIIIINOOOOOOUUUUYYBaaaaaaaceeeeiiiinoooooouuuuyybf';
+set @count = length(@withaccents);
+
+while @count > 0 do
+    set @textvalue = replace(@textvalue, substring(@withaccents, @count, 1), substring(@withoutaccents, @count, 1));
+    set @count = @count - 1;
+end while;
+
+-- SPECIAL CHARS
+set @special = '!@#$%¨&*()_+=§¹²³£¢¬"`´{[^~}]<,>.:;?/°ºª+*|\\''';
+set @count = length(@special);
+while @count > 0 do
+    set @textvalue = replace(@textvalue, substring(@special, @count, 1), '');
+    set @count = @count - 1;
+end while;
+
+return @textvalue;
+
+end;//
+DELIMITER ;
+
+
+--
+-- Dumping events for database 'sigawf'
+--
+
+--
+-- Dumping routines for database 'sigawf'
+--
+/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;
+
+/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
+/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
+/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
+/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
+/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
+/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
+/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
+
+-- Dump completed on 2020-04-06 14:57:41
diff --git a/siga-wf/src/main/resources/jbpm.business.calendar.properties b/siga-wf/src/main/resources/jbpm.business.calendar.properties
deleted file mode 100644
index 53c0e49860..0000000000
--- a/siga-wf/src/main/resources/jbpm.business.calendar.properties
+++ /dev/null
@@ -1,65 +0,0 @@
-hour.format=HH:mm
-#weekday ::= [<daypart> [& <daypart>]*]
-#daypart ::= <start-hour>-<to-hour>
-#start-hour and to-hour must be in the hour.format
-#dayparts have to be ordered
-weekday.monday=    11:00-13:00 & 14:00-19:00
-weekday.tuesday=   11:00-13:00 & 14:00-19:00
-weekday.wednesday= 11:00-13:00 & 14:00-19:00
-weekday.thursday=  11:00-13:00 & 14:00-19:00
-weekday.friday=    11:00-13:00 & 14:00-19:00
-weekday.saturday=
-weekday.sunday=
-
-day.format=dd/MM/yyyy
-# holiday syntax: <holiday>
-# holiday period syntax: <start-day>-<end-day>
-# below are the belgian official holidays
-
- 
-#holiday.1=  01/01/2010 # Confraternizacao universal
-holiday.2=20/01/2012
-# Dia de Sao Sebastiao (Capital)
-holiday.3=20/02/2012
-# Carnaval 
-holiday.4=21/02/2012
-# Carnaval
-holiday.5=04/04/2012-08/04/2012
-# Semana Santa
-holiday.6=21/04/2012
-# Tiradentes 
-holiday.7=23/04/2012
-# Sao Jorge (Capital) 
-holiday.8= 01/05/2012
-# Dia do trabalhador 
-holiday.9= 07/06/2012
-# Corpus Christi
-holiday.10= 11/08/2012
-# Dia do advogado
-holiday.11= 07/09/2012
-# Dia da independencia
-holiday.12= 12/10/2012
-# N. Senhora de Aparecida 
-holiday.13= 28/10/2012
-# Dia do servidor publico
-holiday.14= 01/11/2012
-# Todos os santos 
-holiday.15= 02/11/2012
-# Finados
-holiday.16= 15/11/2012
-# Proc. da republica
-holiday.17= 20/11/2012
-# Consciencia negra (Capital)
-holiday.18= 08/12/2012
-# Dia da justica
-holiday.19= 20/12/2012-06/01/2013 # Recesso
-
-#holiday.18= 24/12/2010 # Natal
-#holiday.19= 25/12/2010 # Natal
-#holiday.20= 31/12/2010 # Revellon
-
-
-business.day.expressed.in.hours=             7
-business.week.expressed.in.hours=           35
-business.month.expressed.in.business.days=  21
-business.year.expressed.in.business.days=  220
\ No newline at end of file
diff --git a/siga-wf/src/main/resources/jbpm.cfg.xml b/siga-wf/src/main/resources/jbpm.cfg.xml
deleted file mode 100644
index 7afe73dac9..0000000000
--- a/siga-wf/src/main/resources/jbpm.cfg.xml
+++ /dev/null
@@ -1,100 +0,0 @@
-<jbpm-configuration>
-	<!-- 
-		<bean name='jbpm.mail.address.resolver'
-		class='br.gov.jfrj.siga.wf.util.WfAddressResolver' singleton='true' />
-		<string name="resource.mail.templates"
-		value="jbpm.mail.templates.xml" />
-		<string name="jbpm.mail.smtp.host" value="localhost" />
-		<string name='jbpm.mail.from.address' value='jbpm@yourcompany.com' />
-	-->
-
-	<!-- 
-		This configuration is used when there is no jbpm.cfg.xml file found in the 
-		root of the classpath.  It is a very basic configuration without persistence
-		and message services.  Only the authorization service installed.
-		You can parse and create processes, but when you try to use one of the 
-		unavailable services, you'll get an exception.
-	-->
-
-	<jbpm-context>
-		<service name="authentication" factory="br.gov.jfrj.siga.wf.util.WfAuthenticationServiceFactory" />
-		<service name="logging"        factory="org.jbpm.logging.db.DbLoggingServiceFactory" />
-		<service name="message" 	   factory="org.jbpm.msg.db.DbMessageServiceFactory" />
-		<service name="persistence"    factory="org.jbpm.persistence.db.DbPersistenceServiceFactory" />
-		<service name="scheduler"	   factory="org.jbpm.scheduler.db.DbSchedulerServiceFactory" />
-		<service name="tx" 			   factory="org.jbpm.tx.TxServiceFactory" />
-	</jbpm-context>
-
-	<!-- configuration property used by persistence service impl org.jbpm.persistence.db.DbPersistenceServiceFactory -->
-	<string name="resource.hibernate.cfg.xml" value="hibernate.cfg.xml" />
-
-	<!-- configuration resource files pointing to default configuration files in jbpm-{version}.jar -->
-	<string name="resource.business.calendar" 	value="jbpm.business.calendar.properties" />
-	<string name="resource.default.modules" 	value="org/jbpm/graph/def/jbpm.default.modules.properties" />
-	<string name="resource.converter" 			value="org/jbpm/db/hibernate/jbpm.converter.properties" />
-	<string name="resource.action.types"		value="org/jbpm/graph/action/action.types.xml" />
-	<string name="resource.node.types"			value="org/jbpm/graph/node/node.types.xml" />
-	<string name="resource.parsers"				value="org/jbpm/jpdl/par/jbpm.parsers.xml" />
-	<string name="resource.varmapping" 			value="org/jbpm/context/exe/jbpm.varmapping.xml" />
-	<string name="resource.mail.templates"		value="jbpm.mail.templates.xml" />
-
-	<!-- class loading -->
-	<!-- <string name="jbpm.classLoader" value="jbpm" />
-		<string name="jbpm.customClassLoader.className" value="com...MyClassLoaderUtil" /> 
-		<bean name="jbpm.processClassLoader" class="org.jbpm.instantiation.DefaultProcessClassLoaderFactory" singelton="true" />-->
-
-	<bean name="jbpm.task.instance.factory" class="org.jbpm.taskmgmt.impl.DefaultTaskInstanceFactoryImpl" singleton="true" />
-	<bean name="jbpm.variable.resolver"     class="org.jbpm.jpdl.el.impl.JbpmVariableResolver" singleton="true" />
-	<bean name="jbpm.mail.address.resolver" class="br.gov.jfrj.siga.wf.util.WfAddressResolver" singleton="true" />
-	
-	<!-- make sure the block size matches the length in ByteArray.hbm.xml -->
-	<int name="jbpm.byte.block.size" value="1024" singleton="true" />
-	
-	<string name="jbpm.mail.smtp.host" 	  value="mail.corp.jfrj.gov.br" />
-	<int name="jbpm.mail.smtp.port" 	  value="25" />
-	<string name='jbpm.mail.class.name'   value='br.gov.jfrj.siga.wf.util.WfMail' />
-	<string name="jbpm.mail.from.address" value="siga-wf@jfrj.jus.br" />
-
-	<!-- <bean name="jbpm.job.executor" class="org.jbpm.job.executor.JobExecutorbr.gov.jfrj.siga.wf.util.WfJobExecutor"> -->
-	<bean name="jbpm.job.executor"
-		class="br.gov.jfrj.siga.wf.util.WfJobExecutor">
-		<field name="jbpmConfiguration">
-			<ref bean="jbpmConfiguration" />
-		</field>
-		<field name="name">
-			<string value="JbpmJobExecutor" />
-		</field>
-		<field name="nbrOfThreads">
-			<int value="1" />
-		</field>
-		<field name="idleInterval">
-			<int value="5000" />
-		</field>
-		<field name="maxIdleInterval">
-			<int value="3600000" />
-		</field>
-		<!-- 1 hour -->
-		<field name="historyMaxSize">
-			<int value="20" />
-		</field>
-		<field name="maxLockTime">
-			<int value="600000" />
-		</field>
-		<!-- 10 minutes -->
-		<field name="lockMonitorInterval">
-			<int value="60000" />
-		</field>
-		<!-- 1 minute -->
-		<field name="lockBufferTime">
-			<int value="5000" />
-		</field>
-		<!-- 1 minute -->
-		<field name="retryInterval">
-			<int value="6000" />
-		</field>
-		<!-- 5 seconds -->
-	</bean>
-
-	<bean name="jbpm.function.mapper" class="br.gov.jfrj.siga.wf.util.WfFunctionMapper" singleton="true" />
-
-</jbpm-configuration>
\ No newline at end of file
diff --git a/siga-wf/src/main/resources/jbpm.mail.templates.xml b/siga-wf/src/main/resources/jbpm.mail.templates.xml
deleted file mode 100644
index 26b6a24bc5..0000000000
--- a/siga-wf/src/main/resources/jbpm.mail.templates.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<mail-templates>
-
-  <variable name="BaseTaskListURL" value="http://localhost:8080/sigawf/app/task?tiId=" />
-
-  <mail-template name='task-assign'>
-    <actors>#{taskInstance.actorId}</actors>
-    <subject>Tarefa '#{taskInstance.name}'</subject>
-    <text><![CDATA[
-A Tarefa '#{taskInstance.name}' foi atribuída a você.
-Você pode acessá-la em: #{BaseTaskListURL}#{taskInstance.id}
----powered by JBoss jBPM---]]></text>
-  </mail-template>
-
-  <mail-template name='task-reminder'>
-    <actors>#{taskInstance.actorId}</actors>
-    <subject>Tarefa '#{taskInstance.name}' !</subject>
-    <text><![CDATA[
-Lembrete da tarefa: #{BaseTaskListURL}#{taskInstance.id}
----powered by JBoss jBPM---]]></text>
-  </mail-template>
-
-</mail-templates> 
\ No newline at end of file
diff --git a/siga-wf/src/test/java/br/gov/jfrj/siga/wf/dao/WfDaoTest.java b/siga-wf/src/test/java/br/gov/jfrj/siga/wf/dao/WfDaoTest.java
deleted file mode 100644
index 8cf46d54a4..0000000000
--- a/siga-wf/src/test/java/br/gov/jfrj/siga/wf/dao/WfDaoTest.java
+++ /dev/null
@@ -1,172 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.dao;
-
-import junit.framework.TestCase;
-
-import org.hibernate.cfg.Configuration;
-import org.jbpm.taskmgmt.exe.Assignable;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.cp.CpGrupo;
-import br.gov.jfrj.siga.cp.bl.Cp;
-import br.gov.jfrj.siga.cp.bl.CpAmbienteEnumBL;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.dao.CpDao;
-import br.gov.jfrj.siga.model.Objeto;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.util.WfExpressionAssignmentHandler;
-import br.gov.jfrj.siga.wf.util.WfHibernateUtil;
-import br.gov.jfrj.siga.wf.util.WfTaskInstance;
-
-/**
- * Classe utilitária para testar o DAO do workflow.
- * 
- * @author kpf
- * 
- */
-public class WfDaoTest extends TestCase {
-	private WfDao dao;
-
-	public WfDaoTest() throws Exception {
-		if (false) {
-			CpAmbienteEnumBL ambiente = CpAmbienteEnumBL.DESENVOLVIMENTO;
-			Cp.getInstance().getProp().setPrefixo(ambiente.getSigla());
-			Configuration cfg = CpDao.criarHibernateCfg(ambiente);
-			// ModeloDao.configurarHibernateParaDebug(cfg);
-			WfHibernateUtil.configurarHibernate(cfg);
-
-			dao = WfDao.getInstance();
-		}
-	}
-
-	/**
-	 * @param args
-	 * @throws AplicacaoException
-	 */
-	public void testDataUltimaAtualizacao() throws AplicacaoException {
-		if (true)
-			return;
-		System.out.println("Data e hora da ultima atualização - "
-				+ dao.consultarDataUltimaAtualizacao());
-	}
-
-	/**
-	 * @param args
-	 * @throws Exception
-	 */
-	public void testPodeInstanciarProcedimento() throws Exception {
-		if (true)
-			return;
-		DpPessoa pesSigla1 = new DpPessoa();
-		pesSigla1.setSesbPessoa("RJ");
-		pesSigla1.setMatricula(13635L);
-		DpPessoa pes1 = dao.consultarPorSigla(pesSigla1);
-
-		Boolean b = Wf
-				.getInstance()
-				.getComp()
-				.podeInstanciarProcedimento(pes1, pes1.getLotacao(),
-						"ProcessDefinition(Contratação: fase de análise)");
-
-		System.out.println("Pode instanciar procedimento - " + b);
-	}
-
-	/**
-	 * @param args
-	 * @throws Exception
-	 */
-	public void testPodeUtilizarServicoPorConfiguracao() throws Exception {
-		if (true)
-			return;
-		DpPessoa pesSigla1 = new DpPessoa();
-		pesSigla1.setSesbPessoa("RJ");
-		pesSigla1.setMatricula(13635L);
-		DpPessoa pes1 = dao.consultarPorSigla(pesSigla1);
-
-		Boolean b = Wf
-				.getInstance()
-				.getConf()
-				.podeUtilizarServicoPorConfiguracao(
-						pes1,
-						pes1.getLotacao(),
-						"SIGA:Sistema Integrado de Gestão Administrativa;WF:Módulo de Workflow;OPERAR:Executar comandos da tela inicial");
-
-		System.out.println("Pode utilizar servico por configuracao - " + b);
-	}
-
-	/**
-	 * @param args
-	 * @throws Exception
-	 */
-	public void testLerGrupo() throws Exception {
-		if (true)
-			return;
-		CpGrupo g = dao.consultar(169L, CpGrupo.class, false);
-	}
-
-	private class AssignableMock implements Assignable {
-		private String actorId;
-		private String[] pooledActors;
-
-		public String getActorId() {
-			return actorId;
-		}
-
-		public void setActorId(String actorId) {
-			this.actorId = actorId;
-		}
-
-		public String[] getPooledActors() {
-			return pooledActors;
-		}
-
-		public void setPooledActors(String[] pooledActors) {
-			this.pooledActors = pooledActors;
-		}
-	}
-
-	public void testExpressionAssignmentHandler() throws Exception {
-		if (true)
-			return;
-		DpPessoa pesSigla1 = new DpPessoa();
-		pesSigla1.setSesbPessoa("RJ");
-		pesSigla1.setMatricula(13635L);
-		DpPessoa pes1 = dao.consultarPorSigla(pesSigla1);
-
-		AssignableMock a = new AssignableMock();
-
-		WfExpressionAssignmentHandler eah = new WfExpressionAssignmentHandler();
-		eah.setEntity(pes1);
-		eah.assign("function(diretor.*)", a, null);
-		assertEquals(a.getActorId(), "RJ13293");
-
-		// TaskInstance ti = WfContextBuilder.getJbpmContext().getJbpmContext()
-		// .getTaskInstance(12805);
-		TaskInstance ti = dao.consultar(12805L, TaskInstance.class, false);
-		System.out.println(ti.getName());
-		ti = (TaskInstance) Objeto.getImplementation(ti);
-		System.out.println(((WfTaskInstance) ti).getDays());
-		assertTrue(ti instanceof WfTaskInstance);
-		// if (ti instanceof WfTaskInstance)
-		// System.out.println(((WfTaskInstance)ti).getDays());
-	}
-
-}
diff --git a/siga-wf/tools/jbpm-jpdl-suite-3.2.3.zip b/siga-wf/tools/jbpm-jpdl-suite-3.2.3.zip
deleted file mode 100644
index 13d2f59a25..0000000000
Binary files a/siga-wf/tools/jbpm-jpdl-suite-3.2.3.zip and /dev/null differ
diff --git a/siga-ws/src/main/java/br/gov/jfrj/siga/ex/service/ExService.java b/siga-ws/src/main/java/br/gov/jfrj/siga/ex/service/ExService.java
index 59fac7844a..de4b36f822 100644
--- a/siga-ws/src/main/java/br/gov/jfrj/siga/ex/service/ExService.java
+++ b/siga-ws/src/main/java/br/gov/jfrj/siga/ex/service/ExService.java
@@ -18,13 +18,11 @@
  ******************************************************************************/
 package br.gov.jfrj.siga.ex.service;
 
-import br.gov.jfrj.siga.Remote;
-
 import javax.jws.WebMethod;
-import java.util.Date;
-
 import javax.jws.WebService;
 
+import br.gov.jfrj.siga.Remote;
+
 @WebService(targetNamespace = "http://impl.service.ex.siga.jfrj.gov.br/")
 public interface ExService extends Remote {
 
@@ -80,7 +78,43 @@ public interface ExService extends Remote {
 	public Boolean exigirAnexo(String codigoDocumentoVia, String siglaCadastrante,
 			String descricaoDoAnexo) throws Exception;
 	
+    @WebMethod
 	public String criarDocumento(String cadastranteStr, String subscritorStr, String destinatarioStr, String destinatarioCampoExtraStr, String descricaoTipoDeDocumento, String nomeForma ,String nomeModelo, String classificacaoStr, 
 			String descricaoStr, Boolean eletronico, String nomeNivelDeAcesso, String conteudo, String siglaMobilPai, Boolean finalizar) throws Exception;
+	
+    @WebMethod
+	public String cadastrante(String codigoDocumentoVia) throws Exception;
 
+    @WebMethod
+	public String titular(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String subscritor(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String destinatario(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String gestor(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String fiscalTecnico(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String fiscalAdministrativo(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String interessado(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String autorizador(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String revisor(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public String liquidante(String codigoDocumentoVia) throws Exception;
+
+    @WebMethod
+	public Boolean isModeloIncluso(String codigoDocumentoVia, Long idModelo) throws Exception;
 }
diff --git a/siga/pom.xml b/siga/pom.xml
index a954540ef9..a9856d9a58 100644
--- a/siga/pom.xml
+++ b/siga/pom.xml
@@ -22,72 +22,6 @@
 
 	<build>
 		<plugins>
-			<!-- vraptor static scan -->
-			<plugin>
-				<groupId>org.apache.maven.plugins</groupId>
-				<artifactId>maven-antrun-plugin</artifactId>
-				<version>1.7</version>
-				<dependencies>
-					<dependency>
-						<groupId>org.javassist</groupId>
-						<artifactId>javassist</artifactId>
-						<version>3.15.0-GA</version>
-					</dependency>
-				</dependencies>
-				<executions>
-					<execution>
-						<id>static-scanning</id>
-						<phase>package</phase>
-						<configuration>
-							<target>
-								<echo message="Starting static scanning process..." />
-								<path id="build.classpath">
-									<fileset
-										dir="${project.build.directory}/${project.build.finalName}/WEB-INF/lib"
-										includes="*.jar" />
-									<fileset
-										dir="${project.build.directory}/../../lib/static_scan_vraptor/"
-										includes="*.jar" />
-								</path>
-								<manifest
-									file="${project.build.directory}//${project.build.finalName}/META-INF/VERSION.MF">
-									<attribute name="Built-By" value="${user.name}" />
-									<attribute name="Build-Time" value="${maven.build.timestamp}" />
-									<attribute name="Build-Label" value="${project.version}" />
-									<attribute name="Siga-Versao" value="${siga.versao}" />
-									<attribute name="Specification-Title" value="Example" />
-									<attribute name="Specification-Version" value="${version}" />
-									<attribute name="Specification-Vendor" value="Example Organization" />
-									<attribute name="Implementation-Title" value="common" />
-									<attribute name="Implementation-Version" value="${version} ${TODAY}" />
-									<attribute name="Implementation-Vendor" value="Example Corp." />
-								</manifest>
-								<java classpathref="build.classpath"
-									classname="br.com.caelum.vraptor.scan.VRaptorStaticScanning"
-									fork="true">
-									<arg
-										value="${project.build.directory}/${project.build.finalName}/WEB-INF/web.xml" />
-									<classpath refid="build.classpath" />
-									<classpath
-										path="${project.build.directory}/${project.build.finalName}/WEB-INF/classes" />
-								</java>
-
-								<war destfile="${project.build.directory}/${project.build.finalName}.war"
-									webxml="${project.build.directory}/${project.build.finalName}/WEB-INF/web.xml">
-									<fileset
-										dir="${project.build.directory}/${project.build.finalName}" />
-								</war>
-								<echo message="Static scanning process finished!" />
-							</target>
-						</configuration>
-						<goals>
-							<goal>run</goal>
-						</goals>
-					</execution>
-				</executions>
-			</plugin>
-			<!-- end vraptor static scan -->
-
 			<plugin>
 				<groupId>org.apache.maven.plugins</groupId>
 				<artifactId>maven-dependency-plugin</artifactId>
@@ -117,9 +51,6 @@
 			<plugin>
 				<artifactId>maven-war-plugin</artifactId>
 				<configuration>
-					<packagingExcludes>
-						WEB-INF/lib/siga-ext-*.jar
-					</packagingExcludes>
 				</configuration>
 			</plugin>
 		</plugins>
@@ -237,7 +168,7 @@
 			<groupId>org.eclipse.birt.runtime.3_7_1</groupId>
 			<artifactId>Tidy</artifactId>
 		</dependency>
-
+		
 		<!-- https://mvnrepository.com/artifact/javax.enterprise/cdi-api -->
 		<dependency>
 			<groupId>javax.enterprise</groupId>
diff --git a/siga/src/main/java/br/gov/jfrj/siga/util/SigaStarter.java b/siga/src/main/java/br/gov/jfrj/siga/util/SigaStarter.java
index d1fc0ab3cc..87a1579583 100644
--- a/siga/src/main/java/br/gov/jfrj/siga/util/SigaStarter.java
+++ b/siga/src/main/java/br/gov/jfrj/siga/util/SigaStarter.java
@@ -3,22 +3,24 @@ package br.gov.jfrj.siga.util;
 import javax.annotation.PostConstruct;
 import javax.ejb.Singleton;
 import javax.ejb.Startup;
+import javax.ejb.TransactionManagement;
+import javax.ejb.TransactionManagementType;
+import javax.naming.NamingException;
 import javax.persistence.EntityManagerFactory;
 import javax.persistence.Persistence;
 
-/**
- * 
- * @author Rodrigo Ramalho hodrigohamalho@gmail.com
- *
- */
+import br.gov.jfrj.siga.cp.util.SigaFlyway;
+
 @Startup
 @Singleton
+@TransactionManagement(value = TransactionManagementType.BEAN)
 public class SigaStarter {
 
 	public static EntityManagerFactory emf;
 
 	@PostConstruct
-	public void init() {
+	public void init() throws NamingException {
+		SigaFlyway.migrate("java:/jboss/datasources/SigaCpDS", "classpath:db/mysql/sigacp");
 		emf = Persistence.createEntityManagerFactory("default");
 	}
 }
\ No newline at end of file
diff --git a/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpLotacaoController.java b/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpLotacaoController.java
index 89c3d8dd8b..7f4623a9e2 100644
--- a/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpLotacaoController.java
+++ b/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpLotacaoController.java
@@ -59,6 +59,12 @@ public class DpLotacaoController extends SigaSelecionavelControllerSupport<DpLot
 		setItemPagina(10);
 	}
 	
+	@Get
+	@Path({"/app/lotacao/buscar-json/{sigla}"})
+	public void busca(String sigla) throws Exception{
+		aBuscarJson(sigla);
+	}
+
 	@Get
 	@Post
 	@Path({"/app/lotacao/buscar", "/lotacao/buscar.action"})
diff --git a/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpPessoaController.java b/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpPessoaController.java
index ac02500a88..79e87b197b 100644
--- a/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpPessoaController.java
+++ b/siga/src/main/java/br/gov/jfrj/siga/vraptor/DpPessoaController.java
@@ -88,6 +88,12 @@ public class DpPessoaController extends SigaSelecionavelControllerSupport<DpPess
 		setItemPagina(10);
 	}
 
+	@Get
+	@Path({"/app/pessoa/buscar-json/{sigla}"})
+	public void busca(String sigla) throws Exception{
+		aBuscarJson(sigla);
+	}
+
 	@Get
 	@Post
 	@Path({"/app/pessoa/buscar","/app/cosignatario/buscar", "/pessoa/buscar.action", "/cosignatario/buscar.action"})
diff --git a/siga/src/main/java/br/gov/jfrj/siga/vraptor/GrupoController.java b/siga/src/main/java/br/gov/jfrj/siga/vraptor/GrupoController.java
index 050a1a8bc1..7dee72a5d8 100644
--- a/siga/src/main/java/br/gov/jfrj/siga/vraptor/GrupoController.java
+++ b/siga/src/main/java/br/gov/jfrj/siga/vraptor/GrupoController.java
@@ -218,10 +218,12 @@ public abstract class GrupoController<T extends CpGrupo> extends
 				CpConfiguracao t_cpcConfiguracao = t_cfgConfiguracaoGrupo
 						.getCpConfiguracao();
 				t_cpcConfiguracao.setHisDtFim(dt);
+				t_cpcConfiguracao = dao().carregar(t_cpcConfiguracao);
 				dao().gravarComHistorico(t_cpcConfiguracao,
 						getIdentidadeCadastrante());
 			}
 			grp.setHisDtFim(dt);
+			grp = dao().carregar(grp);
 			dao().gravarComHistorico(grp, getIdentidadeCadastrante());
 			ModeloDao.commitTransacao();
 		} catch (Exception e) {
@@ -369,10 +371,10 @@ public abstract class GrupoController<T extends CpGrupo> extends
 												+ ". Por favor, entre em contato com o suporte técnico para realizar tal configuração.");
 							}
 !!!!!!
-							cfgGrpGravada.getCpConfiguracao().setHisDtFim(dt);
-							dao().gravarComHistorico(
-									cfgGrpGravada.getCpConfiguracao(),
-									getIdentidadeCadastrante());
+							CpConfiguracao t_cpcConfiguracao = cfgGrpGravada.getCpConfiguracao();
+							t_cpcConfiguracao.setHisDtFim(dt);
+							t_cpcConfiguracao = dao().carregar(t_cpcConfiguracao);
+							dao().gravarComHistorico(t_cpcConfiguracao,getIdentidadeCadastrante());
 						} else {
 							String cfgConteudo = conteudoConfiguracao.get(i);
 							// Nato: o ideal seria se pudéssemos utilizar o
diff --git a/siga/src/main/java/br/gov/jfrj/siga/vraptor/PerfilJEEController.java b/siga/src/main/java/br/gov/jfrj/siga/vraptor/PerfilJEEController.java
index 1b394d77cc..e93dd9d2a2 100644
--- a/siga/src/main/java/br/gov/jfrj/siga/vraptor/PerfilJEEController.java
+++ b/siga/src/main/java/br/gov/jfrj/siga/vraptor/PerfilJEEController.java
@@ -120,6 +120,7 @@ public class PerfilJEEController extends GrupoController {
 		result.redirectTo(MessageFormat.format("/app/gi/perfilJEE/editar?idCpGrupo={0}", novoIdCpGrupo.toString()));
 	}	
 !!!!!! Vou ter que pesquisar todos os POSTs para botar esse @Transacional
+	@Transacional
 	@Post("/app/gi/perfilJEE/excluir")
 	public void excluir(Long idCpGrupo) throws Exception {
 		assertAcesso("PERFILJEE:Gerenciar grupos de email");
diff --git a/siga/src/main/java/br/gov/jfrj/siga/vraptor/SincController.java b/siga/src/main/java/br/gov/jfrj/siga/vraptor/SincController.java
new file mode 100644
index 0000000000..c58d0321c8
--- /dev/null
+++ b/siga/src/main/java/br/gov/jfrj/siga/vraptor/SincController.java
@@ -0,0 +1,75 @@
+package br.gov.jfrj.siga.vraptor;
+
+import javax.inject.Inject;
+import javax.persistence.EntityManager;
+import javax.servlet.http.HttpServletRequest;
+
+import org.json.JSONArray;
+import org.json.JSONObject;
+
+import br.com.caelum.vraptor.Controller;
+import br.com.caelum.vraptor.Post;
+import br.com.caelum.vraptor.Result;
+import br.com.caelum.vraptor.observer.upload.UploadSizeLimit;
+import br.com.caelum.vraptor.observer.upload.UploadedFile;
+import br.com.caelum.vraptor.view.Results;
+import br.gov.jfrj.siga.cp.bl.Cp;
+import br.gov.jfrj.siga.cp.util.SigaCpSinc;
+import br.gov.jfrj.siga.dp.dao.CpDao;
+
+@Controller
+public class SincController extends SigaController {
+
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	public SincController() {
+		super();
+	}
+
+	@Inject
+	public SincController(HttpServletRequest request, Result result, CpDao dao, SigaObjects so, EntityManager em) {
+		super(request, result, dao, so, em);
+	}
+
+	// A ideia aqui é usar o curl para enviar um arquivo xml, da forma:
+	// curl -F file=@/some/file/on/your/local/disk
+	// http://localhost:8080/siga/app/admin/sinc?sigla=TRF2&maxSinc=100&modoLog=true
+
+	@Transacional
+	@Post("public/app/admin/sinc")
+	@UploadSizeLimit(sizeLimit=10 * 1024 * 1024, fileSizeLimit=10 * 1024 * 1024)
+	public void sinc(String sigla, int maxSinc, boolean modoLog, UploadedFile file) throws Exception {
+		try {
+			String pwd = Cp.getInstance().getProp().sincPassword();
+			if (pwd == null)
+				throw new Exception(
+						"Para utilizar o webservice de sincronismo é necessário protegê-lo com a propriedade siga.sinc.password");
+			if (request.getHeader("Authorization") == null)
+				throw new Exception(
+						"Para utilizar o webservice de sincronismo é necessário enviar o Authorization HTTP Header");
+			if (!pwd.equals(request.getHeader("Authorization")))
+				throw new Exception(
+						"Para utilizar o webservice de sincronismo é necessário que o Authorization HTTP Header enviado contenha o mesmo valor que a propriedade siga.sinc.password");
+			SigaCpSinc sinc = new SigaCpSinc();
+			String log = sinc.importxml(sigla, maxSinc, modoLog, file.getFile());
+
+			// result.use(Results.http()).body(log);
+
+			JSONObject json = new JSONObject();
+			json.put("sigla", sigla);
+			json.put("maxSinc", maxSinc);
+			json.put("modoLog", modoLog);
+			JSONArray arr = new JSONArray();
+			for (String s : log.split("\n"))
+				arr.put(s);
+			json.put("log", arr);
+			String s = json.toString(4);
+			result.use(Results.http()).addHeader("Content-Type", "application/json").body(s).setStatusCode(500);
+
+		} catch (Exception ex) {
+			jsonError(ex);
+		}
+	}
+
+}
\ No newline at end of file
diff --git a/siga/src/main/java/br/gov/jfrj/siga/vraptor/SubstituicaoController.java b/siga/src/main/java/br/gov/jfrj/siga/vraptor/SubstituicaoController.java
index 8893cba360..f0d6d5f06a 100644
--- a/siga/src/main/java/br/gov/jfrj/siga/vraptor/SubstituicaoController.java
+++ b/siga/src/main/java/br/gov/jfrj/siga/vraptor/SubstituicaoController.java
@@ -47,7 +47,7 @@ public class SubstituicaoController extends SigaController {
 	private Map<Integer, String> getListaTipo() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, "Usuário");
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		return map;
 	}	
 		
@@ -203,7 +203,7 @@ public class SubstituicaoController extends SigaController {
 		
 		
 		Long lotacaoIniPai;
-		Long lotacaoIniAvo;
+		Long lotacaoIniAvo = null;
 
 		DpSubstituicao subst = new DpSubstituicao();
 		
@@ -235,7 +235,8 @@ public class SubstituicaoController extends SigaController {
 				
 				subst.setLotaTitular(dao().consultar(this.lotaTitularSel.getId(), DpLotacao.class, false));
 				lotacaoIniPai = subst.getLotaTitular().getIdLotacaoIniPai();
-				lotacaoIniAvo = subst.getLotaTitular().getLotacaoPai().getIdLotacaoIniPai();
+				if (lotacaoIniPai != null)
+					lotacaoIniAvo = subst.getLotaTitular().getLotacaoPai().getIdLotacaoIniPai();
 				
 				
 				if (!subst.getLotaTitular().getIdLotacao().equals(getCadastrante().getIdLotacao()) 
diff --git a/siga/src/main/webapp/META-INF/jboss-deployment-structure.xml b/siga/src/main/webapp/META-INF/jboss-deployment-structure.xml
index 2fd4fef008..fcb82d957a 100644
--- a/siga/src/main/webapp/META-INF/jboss-deployment-structure.xml
+++ b/siga/src/main/webapp/META-INF/jboss-deployment-structure.xml
@@ -13,8 +13,6 @@
 			<module name="org.apache.commons.logging" />
 			<module name="org.apache.xalan" />
 			<module name="asm.asm" />
-			<module name="sigadoc.org.bouncycastle" export="true"/>
-
             <module name="org.javassist" />
 		</dependencies>
 	</deployment>
diff --git a/siga/src/main/webapp/WEB-INF/page/erroGeral.jsp b/siga/src/main/webapp/WEB-INF/page/erroGeral.jsp
index 8dc3012da8..9d411ed2f3 100644
--- a/siga/src/main/webapp/WEB-INF/page/erroGeral.jsp
+++ b/siga/src/main/webapp/WEB-INF/page/erroGeral.jsp
@@ -1,116 +1,92 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<%@ page isErrorPage="true"%>
-<%@ page language="java" contentType="text/html; charset=UTF-8"
-	buffer="64kb"%>
+<%@ page isErrorPage="true" import="java.io.*" contentType="text/html"%>
 <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
 <%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+
 <c:catch var="selectException">
 	<c:if test="${empty exceptionGeral or empty exceptionStackGeral}">
 		<%
- 			java.lang.Throwable t = (Throwable) pageContext.getRequest().getAttribute("exception");
-			if (t == null){
-				t = (Throwable) exception;
-			}
- 			if (t != null) {
- 				while (t.getCause() != null && t != t.getCause()) {
- 					if (t.getClass().getSimpleName().equals("AplicacaoException"))
-						break;
- 					t = t.getCause();
- 				}
- 				pageContext.getRequest().setAttribute("exceptionGeral", t);
- 				java.io.StringWriter sw = new java.io.StringWriter();
- 				java.io.PrintWriter pw = new java.io.PrintWriter(sw);
- 				t.printStackTrace(pw);
- 				String s = sw.toString();
- 				String[] lines = s.split(System.getProperty("line.separator"));
- 				for (int i=0; i<lines.length; i++) {
- 					if (lines[i].contains("br.com.caelum.vraptor.core.DefaultReflectionProvider.invoke")) {
- 						for (int j=i-1; j>0; j--) {
- 							if (lines[j].trim().startsWith("at br.") && !lines[j].contains("$Proxy$_$$_WeldClientProxy")) {
-				 				StringBuilder sb = new StringBuilder();
- 								for (int k=0; k<=j; k++) {
- 				 					sb.append(lines[k]);
- 				 					sb.append(System.getProperty("line.separator"));
- 								}
- 								s = sb.toString();
- 								break;
- 							}			
- 						}
- 						break;
- 					}
- 				}
- 				pageContext.getRequest().setAttribute("exceptionStackGeral", s);
- 			}
+			java.lang.Throwable t = (Throwable) pageContext.getRequest().getAttribute("exception");
+					if (t == null) {
+						t = (Throwable) exception;
+					}
+					if (t != null) {
+						while ((t.getClass().getSimpleName().equals("ServletException")
+								|| t.getClass().getSimpleName().equals("InterceptionException")
+								|| t.getClass().getSimpleName().equals("InvocationTargetException")
+								|| t.getClass().getSimpleName().equals("ProxyInvocationException"))
+								&& t.getCause() != null && t != t.getCause()) {
+							t = t.getCause();
+						}
+
+						pageContext.getRequest().setAttribute("exceptionApp",
+								t instanceof br.gov.jfrj.siga.base.AplicacaoException);
+						pageContext.getRequest().setAttribute("exceptionMsg", t.getMessage());
+						pageContext.getRequest().setAttribute("exceptionGeral", t);
+						pageContext.getRequest().setAttribute("exceptionStackGeral",
+								br.gov.jfrj.siga.base.log.RequestExceptionLogger.simplificarStackTrace(t));
+					}
 		%>
 	</c:if>
 </c:catch>
-
 <c:catch var="catchException">
-	<siga:pagina titulo="Erro Geral" desabilitarbusca="sim" desabilitarmenu="sim" desabilitarComplementoHEAD="sim">
-	<!--
-	Unless this text is here, if your page is less than 513 bytes, Internet Explorer will display it's "Friendly HTTP Error Message",
-	and your custom error will never be displayed.  This text is just used as filler.
-	This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
-	This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
-	This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
-	-->
+	<siga:pagina titulo="Erro Geral" desabilitarbusca="sim"
+		desabilitarmenu="sim" desabilitarComplementoHEAD="sim">
+		<div class="container content">
 
-		<div class="container-fluid">
-			<div class="card bg-light mb-3" >
-				<div class="card-header">
-					<h5>
-						Não Foi Possível Completar a Operação (${pageContext.request.serverName})
-					</h5>
-				</div>
+			<!--
+Unless this text is here, if your page is less than 513 bytes, Internet Explorer will display it's "Friendly HTTP Error Message",
+and your custom error will never be displayed.  This text is just used as filler.
+This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
+This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
+This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
+-->
 
-				<div class="card-body">
-					<div class="row">
-						<div class="col">
-							<div class="form-group">
-									<c:catch>
-										<c:if test="${not empty exceptionGeral}">
-											<c:if test="${not empty exceptionGeral.message}">
-												<h3>${exceptionGeral.message}</h3>
-											</c:if>
-											<c:if test="${not empty exceptionGeral.cause}">
-												<h4>${exceptionGeral.cause.message}</h4>
-											</c:if>
-										</c:if>
-									</c:catch>
-								</div>
+			<div class="gt-bd clearfix">
+				<div class="gt-content clearfix">
+
+					<c:choose>
+						<c:when test="${exceptionApp}">
+							<p class="mb-2 mt-5">Operação Inválida:</p>
+							<h2 class="mt-0">${exceptionMsg}</h2>
+						</c:when>
+						<c:otherwise>
+							<div id="caption">
+								${t.exceptionStackGeral }
+								<h2>Não Foi Possível Completar a Operação
+									(${pageContext.request.serverName})</h2>
 							</div>
-						</div>
-						<div class="row">
-							<div class="col">
-								<div class="form-group">
-									<div style="display: none; padding: 8pt;" align="left" id="stack">
-										<pre style="font-size: 8pt;">${exceptionStackGeral}</pre>
-									</div>
-								</div>
+							<div align="left" id="stack">
+								<pre style="font-size: 8pt;"><c:out value="${exceptionStackGeral}" /></pre>
 							</div>
-						</div>
-						<div class="row">
-							<div class="col">
-								<div class="form-group">		
-									<input type="button" value="Voltar" class="btn btn-primary"  onclick="javascript:history.back();" />
-									<c:if test="${siga_cliente != 'GOVSP'}">
-										<input type="button" id="show_stack" value="Mais detalhes" class="btn btn-primary" onclick="javascript: document.getElementById('stack').style.display=''; document.getElementById('show_stack').style.display='none';" />
-									</c:if>
-								</div>
+						</c:otherwise>
+					</c:choose>
+
+					<div class="row mt-3">
+						<div class="col">
+							<div class="form-group">
+							<c:if test="${newWindow != 1}">
+								<input type="button" value="Voltar"
+									onclick="javascript:history.back();" class="btn btn-secondary btn-sm" />
+							</c:if>
+							<c:if test="${newWindow eq 1}">
+								<input type="button" value="Fechar"
+									onclick="javascript:window.close();" class="btn btn-secondary btn-sm" />
+							</c:if>
 							</div>
 						</div>
+					</div>
+
 				</div>
 			</div>
+
 		</div>
-</siga:pagina>
+
+	</siga:pagina>
 </c:catch>
 
 <c:if test="${catchException!=null}">
-Erro: ${catchException.message}<br>
-	<br>
-	<br>
-
-	<pre>
+Erro: ${catchException.message}<br> <br> <br> <pre>
 Erro original:
 ${exceptionStack}</pre>
-</c:if>
\ No newline at end of file
+</c:if>
diff --git a/siga/src/main/webapp/WEB-INF/page/grupoDeEmail/lista.jsp b/siga/src/main/webapp/WEB-INF/page/grupoDeEmail/lista.jsp
index 9febe373cf..79d7906123 100644
--- a/siga/src/main/webapp/WEB-INF/page/grupoDeEmail/lista.jsp
+++ b/siga/src/main/webapp/WEB-INF/page/grupoDeEmail/lista.jsp
@@ -25,7 +25,7 @@
 						<thead class="thead-dark">
 							<th align="left">Sigla</th>
 							<th align="left">Descrição</th>
-							<th align="left">Sigla Grupo Pai aaaaaa</th>
+							<th align="left">Sigla Grupo Pai</th>
 						</thead>
 						<c:set var="evenorodd" value="" />
 						<c:set var="tamanho" value="0" />
diff --git a/siga/src/main/webapp/WEB-INF/page/principal/principal.jsp b/siga/src/main/webapp/WEB-INF/page/principal/principal.jsp
index 2a02030495..6b5d7cfcbe 100644
--- a/siga/src/main/webapp/WEB-INF/page/principal/principal.jsp
+++ b/siga/src/main/webapp/WEB-INF/page/principal/principal.jsp
@@ -82,7 +82,7 @@
 				test="${(f:resource('isWorkflowEnabled') and f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA:Sistema Integrado de Gestão Administrativa;WF:Módulo de Workflow')) or f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;SR') or f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC:Módulo de Gestão de Conhecimento') or f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;TP:Módulo de Transportes')}">
 				<div class="col col-sm-12 col-md-6">
 					<c:if
-						test="${(f:resource('isWorkflowEnabled') and f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA:Sistema Integrado de Gestão Administrativa;WF:Módulo de Workflow'))}">
+						test="${(f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA:Sistema Integrado de Gestão Administrativa;WF:Módulo de Workflow'))}">
 						<div class="card bg-light mb-3">
 							<div class="card-header">Tarefas</div>
 							<div class="card-body">
diff --git a/siga/src/main/webapp/WEB-INF/page/substituicao/edita.jsp b/siga/src/main/webapp/WEB-INF/page/substituicao/edita.jsp
index 4095878ee7..572fa80475 100644
--- a/siga/src/main/webapp/WEB-INF/page/substituicao/edita.jsp
+++ b/siga/src/main/webapp/WEB-INF/page/substituicao/edita.jsp
@@ -43,7 +43,7 @@
 	function aviso() {
 		var dataFim = document.getElementById("dtFimSubst").value;
 		var dataInicio = document.getElementById("dtIniSubst").value;
-		var mensagem = "Caso a 'Data de Início' não seja informada, será assumida a data atual.<br/>Caso a 'Data de Fim' não seja informada, a substituição ficará valendo até que seja manualmente cancelada.";
+		var mensagem = "Caso a 'Data de Início' não seja informada, será assumida a data atual.";
 		var atencao = "Importante";
 		document.getElementById("dataFim").innerHTML = mensagem;
 		document.getElementById("dataFim").value = mensagem;
@@ -151,13 +151,12 @@
 								<label for="tipoTitular">Data de Fim</label>
 								<input type="text" id="dtFimSubst" name="dtFimSubst" label="Data de Fim" value="${dtFimSubst}"
 									onblur="javascript:verifica_data(this, true);" theme="simple" class="form-control" />
-									<small id="emailHelp" class="form-text text-muted">(opcional)</small>
 							</div>
 						</div>
 					</div>
 					<c:if test="${ empty dataFim }">
 					<div class="row">
-						<div class="col-sm-1">
+						<div class="col-sm-2">
 							<div class="form-group">
 								<b><span id="atencao" ></span></b>
 							</div>
diff --git a/siga/src/main/webapp/WEB-INF/web.xml b/siga/src/main/webapp/WEB-INF/web.xml
index 12cb4fe942..03165c8c6f 100644
--- a/siga/src/main/webapp/WEB-INF/web.xml
+++ b/siga/src/main/webapp/WEB-INF/web.xml
@@ -130,8 +130,24 @@
 		<url-pattern>/servicos/GiService</url-pattern>
 	</servlet-mapping>
  	
+	<servlet>
+		<servlet-name>ErrorHandler</servlet-name>
+		<servlet-class>br.gov.jfrj.siga.jee.SigaErrorHandlerServlet</servlet-class>
+	</servlet>
+
+	<!-- servlet mappings -->
+	<servlet-mapping>
+		<servlet-name>ErrorHandler</servlet-name>
+		<url-pattern>/ErrorHandler</url-pattern>
+	</servlet-mapping>
+
 	<error-page>
-		<location>/WEB-INF/page/erroGeral.jsp</location>
+		<error-code>404</error-code>
+		<location>/ErrorHandler</location>
 	</error-page>
 
+	<error-page>
+		<exception-type>java.lang.Throwable</exception-type>
+		<location>/ErrorHandler</location>
+	</error-page>
 </web-app>
diff --git a/siga/src/main/webapp/imagens/logo-trf2-38px.png b/siga/src/main/webapp/imagens/logo-trf2-38px.png
new file mode 100644
index 0000000000..11a3f296f2
Binary files /dev/null and b/siga/src/main/webapp/imagens/logo-trf2-38px.png differ
diff --git a/siga/src/main/webapp/javascript/siga.js b/siga/src/main/webapp/javascript/siga.js
index 60f36d2c81..d04ef06884 100644
--- a/siga/src/main/webapp/javascript/siga.js
+++ b/siga/src/main/webapp/javascript/siga.js
@@ -1526,4 +1526,20 @@ function RespostaAjax() {
 		if(errorCallback)
 			errorCallback(responseText);
 	}
+}
+
+function postToUrl(url) {
+	var f = document.createElement('form');
+	f.action=url;
+	f.method='POST';
+	//f.target='_blank';
+
+//	var i=document.createElement('input');
+//	i.type='hidden';
+//	i.name='fragment';
+//	i.value='<!DOCTYPE html>'+document.documentElement.outerHTML;
+//	f.appendChild(i);
+
+	document.body.appendChild(f);
+	f.submit();
 }
\ No newline at end of file
diff --git a/sigaex/pom.xml b/sigaex/pom.xml
index 96daaba469..200c3bc5f0 100644
--- a/sigaex/pom.xml
+++ b/sigaex/pom.xml
@@ -12,93 +12,6 @@
 	<packaging>war</packaging>
 	<modelVersion>4.0.0</modelVersion>
 
-	<build>
-		<plugins>
-			<!-- vraptor static scan -->
-			<plugin>
-				<groupId>org.apache.maven.plugins</groupId>
-				<artifactId>maven-antrun-plugin</artifactId>
-				<version>1.7</version>
-				<dependencies>
-					<dependency>
-						<groupId>org.javassist</groupId>
-						<artifactId>javassist</artifactId>
-						<version>3.15.0-GA</version>
-					</dependency>
-				</dependencies>
-				<executions>
-					<execution>
-						<id>static-scanning</id>
-						<phase>package</phase>
-						<configuration>
-							<target>
-								<echo message="Starting static scanning process..." />
-								<path id="build.classpath">
-									<fileset
-										dir="${project.build.directory}/${project.build.finalName}/WEB-INF/lib"
-										includes="*.jar" />
-									<fileset dir="${project.build.directory}/../../lib/static_scan_vraptor/" includes="*.jar" />
-								</path>
-								<java classpathref="build.classpath"
-									classname="br.com.caelum.vraptor.scan.VRaptorStaticScanning"
-									fork="true">
-									<arg
-										value="${project.build.directory}/${project.build.finalName}/WEB-INF/web.xml" />
-									<classpath refid="build.classpath" />
-									<classpath
-										path="${project.build.directory}/${project.build.finalName}/WEB-INF/classes" />
-								</java>
-								<war destfile="${project.build.directory}/${project.build.finalName}.war"
-									webxml="${project.build.directory}/${project.build.finalName}/WEB-INF/web.xml">
-									<fileset
-										dir="${project.build.directory}/${project.build.finalName}" />
-								</war>
-								<echo message="Static scanning process finished!" />
-							</target>
-						</configuration>
-						<goals>
-							<goal>run</goal>
-						</goals>
-					</execution>
-				</executions>
-			</plugin>
-			<!-- end vraptor static scan -->
-
-
-			<plugin>
-				<groupId>org.apache.maven.plugins</groupId>
-				<artifactId>maven-surefire-plugin</artifactId>
-				<version>2.11</version>
-			</plugin>
-			<plugin>
-				<groupId>org.apache.maven.plugins</groupId>
-				<artifactId>maven-dependency-plugin</artifactId>
-				<version>2.8</version>
-				<executions>
-					<execution>
-						<id>copy-artifact</id>
-						<phase>package</phase>
-						<goals>
-							<goal>copy</goal>
-						</goals>
-						<configuration>
-							<artifactItems>
-								<artifactItem>
-									<groupId>${project.groupId}</groupId>
-									<artifactId>${project.artifactId}</artifactId>
-									<version>${project.version}</version>
-									<type>${project.packaging}</type>
-								</artifactItem>
-							</artifactItems>
-							<outputDirectory>../target</outputDirectory>
-							<stripVersion>true</stripVersion>
-						</configuration>
-					</execution>
-				</executions>
-			</plugin>
-		</plugins>
-	</build>
-
 	<reporting>
 		<plugins>
 			<plugin>
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelConsultaDocEntreDatas.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelConsultaDocEntreDatas.java
index dad621cfc0..0a025795e3 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelConsultaDocEntreDatas.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelConsultaDocEntreDatas.java
@@ -37,6 +37,7 @@ import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.dp.dao.CpDao;
@@ -60,19 +61,19 @@ public class RelConsultaDocEntreDatas extends RelatorioTemplate {
 	public RelConsultaDocEntreDatas(Map<String, String> parametros) throws Exception {
 		super(parametros);
 		
-		if (!isPreenchido(parametros.get("secaoUsuario"))) {
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
 			throw new AplicacaoException("Parâmetro secaoUsuario não informado!");
 		}
-		if (!isPreenchido(parametros.get("lotacao"))) {
+		if (Utils.empty(parametros.get("lotacao"))) {
 			throw new AplicacaoException("Parâmetro lotação não informado!");
 		}
-		if (!isPreenchido(parametros.get("dataInicial"))) {
+		if (Utils.empty(parametros.get("dataInicial"))) {
 			throw new AplicacaoException("Parâmetro data inicial não informado!");
 		}
-		if (!isPreenchido(parametros.get("dataFinal"))) {
+		if (Utils.empty(parametros.get("dataFinal"))) {
 			throw new AplicacaoException("Parâmetro data final não informado!");
 		}
-		if (!isPreenchido(parametros.get("link_siga"))) {
+		if (Utils.empty(parametros.get("link_siga"))) {
 			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
 		
@@ -90,10 +91,6 @@ public class RelConsultaDocEntreDatas extends RelatorioTemplate {
 		this.link = parametros.get("link_siga"); 
 	}
 	
-	private boolean isPreenchido(String texto) {
-		return texto != null && !"".equals(texto);
-	}
-	
 	private DpLotacao buscarLotacaoPor(Long id) {
 		CpDao dao = CpDao.getInstance();
 		DpLotacao lotacao = dao.consultar(id, DpLotacao.class, false);
@@ -114,10 +111,30 @@ public class RelConsultaDocEntreDatas extends RelatorioTemplate {
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException, JRException {
 
-		String titulo = "Relação de Documentos do(a) " + lotacao.getSiglaCompleta() 
-				+ " de " + dateToString(dataInicial) + " a " + dateToString(dataFinal);
+		String origemtext = "";
 		
+		switch (tipoDoDocumento.intValue()) {
+		case 1:
+			origemtext = "Interno Produzido ";
+			break;
+		case 2:
+			origemtext = "Interno Folha de Rosto ";
+			break;
+		case 3:
+			origemtext = "Externo Folha de Rosto ";
+			break;
+		case 4:
+			origemtext = "Externo Capturado ";
+			break;
+		case 5:
+			origemtext = "Interno Capturado ";
+			break;
+		}
+		String titulo = "Relação de Documento(s) " + origemtext + " de " + dateToString(dataInicial) + " a " + dateToString(dataFinal);
+		String titulo = "Relação de Documento(s) " + origemtext + " de " + dateToString(dataInicial) + " a " + dateToString(dataFinal);
+		String subtitulo = "Do(a) " + lotacao.getNomeLotacao();
+
 		this.setTitle(titulo);
+		this.setSubtitle(subtitulo);
 		this.addColuna("Código do Documento", 140, RelatorioRapido.ESQUERDA, true, true);
 		this.addColuna("Descrição do documento", 140, RelatorioRapido.ESQUERDA, false);
 
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocSubordinadosCriados.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocSubordinadosCriados.java
index 18d491e4e9..e83ab9f9f9 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocSubordinadosCriados.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocSubordinadosCriados.java
@@ -21,7 +21,6 @@ package br.gov.jfrj.siga.ex.relatorio.dinamico.relatorios;
 import java.util.ArrayList;
 import java.util.Collection;
 import java.util.HashSet;
-import java.util.Iterator;
 import java.util.LinkedList;
 import java.util.List;
 import java.util.Map;
@@ -33,6 +32,8 @@ import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.ex.ExDocumento;
@@ -43,29 +44,28 @@ import br.gov.jfrj.siga.ex.ExTipoFormaDoc;
 import br.gov.jfrj.siga.ex.bl.Ex;
 import br.gov.jfrj.siga.hibernate.ExDao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import net.sf.jasperreports.engine.JRException;
 
 public class RelDocSubordinadosCriados extends RelatorioTemplate {
 
-	public RelDocSubordinadosCriados(Map parametros)
-			throws DJBuilderException {
+	public RelDocSubordinadosCriados(Map<String, String> parametros) throws Exception {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
-					"Parâmetro secaoUsuario não informado!");
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException("Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+		if (Utils.empty(parametros.get("lotacao"))) {
+			throw new AplicacaoException("Parâmetro lotacao não informado!");
+		}
+		if (Utils.empty(parametros.get("link_siga"))) {
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
 
 	}
 
 	@Override
-	public AbstractRelatorioBaseBuilder configurarRelatorio()
-			throws DJBuilderException, JRException {
+	public AbstractRelatorioBaseBuilder configurarRelatorio() throws DJBuilderException, JRException {
 
-		this.setTitle("Relatório de Movimentação de Documentos em Setores Subordinados");
+		this.setTitle("Relatório de Criação de Documentos em Setores Subordinados");
 		this.addColuna("Setor", 0, RelatorioRapido.ESQUERDA, true);
 		this.addColuna("Documento", 25, RelatorioRapido.CENTRO, false);
 		this.addColuna("Criação", 15, RelatorioRapido.CENTRO, false);
@@ -77,15 +77,14 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 		return this;
 
 	}
-	
+
 	public Collection processarDados() throws Exception {
 
 		// Obtém uma formaDoc a partir da sigla passada e monta trecho da query
 		// para a forma
 		Query qryTipoForma = ContextoPersistencia.em().createQuery(
-				"from ExTipoFormaDoc tf where " + "tf.descTipoFormaDoc = '"
-						+ parametros.get("tipoFormaDoc") + "'");
-		
+				"from ExTipoFormaDoc tf where " + "tf.descTipoFormaDoc = '" + parametros.get("tipoFormaDoc") + "'");
+
 		ExTipoFormaDoc tipoFormaDoc = null;
 		try {
 			tipoFormaDoc = (ExTipoFormaDoc) qryTipoForma.getSingleResult();
@@ -93,17 +92,14 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 		}
 
 		String trechoQryTipoForma = tipoFormaDoc == null ? ""
-				: " and tipoForma.idTipoFormaDoc = "
-						+ tipoFormaDoc.getIdTipoFormaDoc();
+				: " and tipoForma.idTipoFormaDoc = " + tipoFormaDoc.getIdTipoFormaDoc();
 
-			
 		// Obtém a lotação com o id passado...
-		DpLotacao lotacao = ContextoPersistencia.em().find(DpLotacao.class, Long.parseLong((String) parametros.get("lotacao")));
-			
+		DpLotacao lotacao = ContextoPersistencia.em().find(DpLotacao.class,
+				Long.parseLong((String) parametros.get("lotacao")));
+
 		Set<DpLotacao> lotacaoSet = new HashSet<DpLotacao>();
 		lotacaoSet.add(lotacao);
-		
-	
 
 		// ... e monta trecho da query para as lotações
 		String listaLotacoes = "";
@@ -120,19 +116,17 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 
 		// Monta trecho da query para ocultar seletivamente a descrição do
 		// documento
-		String trechoQryDescrDocumento = "(case when ("
-				+ "	nivel.idNivelAcesso <> 1 "
-				+ "	and nivel.idNivelAcesso <> 6"
-				+ ") then 'CONFIDENCIAL' else doc.descrDocumento end)";
+		String trechoQryDescrDocumento = "(case when (" + "	nivel.idNivelAcesso <> 1 "
+				+ "	and nivel.idNivelAcesso <> 6" + ") then 'CONFIDENCIAL' else doc.descrDocumento end)";
 
 		// Monta trecho da query para retornar o código do documento
-		/*String trechoQryCodigoDoc = " orgao.siglaOrgaoUsu "
-				+ "|| '-' || " + "forma.siglaFormaDoc "
-				+ "|| '-' || " + "doc.anoEmissao " + "|| '/' || "
-				+ "doc.numExpediente " + "|| "
-				+ "(case when (tipoMob.idTipoMobil = 4) "
-				+ "then ('-V' || marca.exMobil.numSequencia) " +
-						"else ('-' || chr(marca.exMobil.numSequencia+64)) end)";*/
+		/*
+		 * String trechoQryCodigoDoc = " orgao.siglaOrgaoUsu " + "|| '-' || " +
+		 * "forma.siglaFormaDoc " + "|| '-' || " + "doc.anoEmissao " + "|| '/' || " +
+		 * "doc.numExpediente " + "|| " + "(case when (tipoMob.idTipoMobil = 4) " +
+		 * "then ('-V' || marca.exMobil.numSequencia) " +
+		 * "else ('-' || chr(marca.exMobil.numSequencia+64)) end)";
+		 */
 
 		// Monta query definitiva
 		String listaMarcadoresRelevantes = "2, 3, 5, 7, 14, 15"; // Ativos
@@ -141,50 +135,27 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 		} else if (parametros.get("tipoRel").equals("3")) {
 			listaMarcadoresRelevantes = "28"; // Como interessado
 		}
-		
+
 		// bruno.lacerda@avantiprima.com.br
 		// int timeout = 1;
-		Query qryMarcas = ContextoPersistencia.em()
-				.createQuery(
-						"select doc.idDoc, marca.dpLotacaoIni.nomeLotacao, "
-								+ "mov, mob, " 
-								+ "orgao.siglaOrgaoUsu, orgao.acronimoOrgaoUsu, forma.siglaFormaDoc, doc.anoEmissao, doc.numExpediente, doc.numSequencia, tipoMob.idTipoMobil, mob.numSequencia,  "
-								+ "docPai.idDoc, orgaoDocPai.siglaOrgaoUsu, orgaoDocPai.acronimoOrgaoUsu, formaDocPai.siglaFormaDoc, docPai.anoEmissao, docPai.numExpediente, docPai.numSequencia, tipoMobPai.idTipoMobil, mobPai.numSequencia, "
-								+ " '"
-								+ parametros.get("link_siga")
-								+ " '"
-								+ ","
-								+ trechoQryDescrDocumento
-								+ ","
-								+ "	pes.nomePessoa,"
-								+ "	marca.cpMarcador.descrMarcador "
-								+ "from ExMarca marca "
-								+ "inner join marca.exMobil as mob "
-								+ "inner join mob.exTipoMobil as tipoMob "
-								+ "inner join mob.exDocumento as doc "
-								+ "inner join mob.exMovimentacaoSet as mov "
-								+ "inner join mov.lotaResp as dplot "
-								+ "inner join doc.exNivelAcesso as nivel "
-								+ "inner join doc.orgaoUsuario as orgao "
-								+ "inner join doc.exFormaDocumento as forma "
-								+ "inner join forma.exTipoFormaDoc as tipoForma "
-								+ "inner join marca.dpLotacaoIni as lot "
-								+ "inner join marca.cpMarcador as marcador "
-								+ "left outer join marca.dpPessoaIni as pes "
-								+ "left outer join doc.exMobilPai as mobPai "
-								+ "left outer join mobPai.exDocumento docPai "
-								+ "left outer join docPai.orgaoUsuario orgaoDocPai "
-								+ "left outer join docPai.exFormaDocumento formaDocPai "
-								+ "left outer join mobPai.exTipoMobil tipoMobPai "
-								+ "where lot.idLotacao in ("
-								+ listaLotacoes
-								+ ") "
-								+ "and marcador.idMarcador in ("
-								+ listaMarcadoresRelevantes
-								+ ")"
-								+ trechoQryTipoForma
-								+ " and mov.dtMov = (select min(movim.dtMov) from ExMovimentacao movim where movim.exMobil = mov.exMobil) "
-								+ " order by lot.siglaLotacao, doc.idDoc, mov.dtMov"/*, timeout*/);
+		Query qryMarcas = ContextoPersistencia.em().createQuery("select doc.idDoc, marca.dpLotacaoIni.nomeLotacao, "
+				+ "mov, mob, "
+				+ "orgao.siglaOrgaoUsu, orgao.acronimoOrgaoUsu, forma.siglaFormaDoc, doc.anoEmissao, doc.numExpediente, doc.numSequencia, tipoMob.idTipoMobil, mob.numSequencia,  "
+				+ "docPai.idDoc, orgaoDocPai.siglaOrgaoUsu, orgaoDocPai.acronimoOrgaoUsu, formaDocPai.siglaFormaDoc, docPai.anoEmissao, docPai.numExpediente, docPai.numSequencia, tipoMobPai.idTipoMobil, mobPai.numSequencia, "
+				+ " '" + parametros.get("link_siga") + " '" + "," + trechoQryDescrDocumento + "," + "	pes.nomePessoa,"
+				+ "	marca.cpMarcador.descrMarcador " + "from ExMarca marca " + "inner join marca.exMobil as mob "
+				+ "inner join mob.exTipoMobil as tipoMob " + "inner join mob.exDocumento as doc "
+				+ "inner join mob.exMovimentacaoSet as mov " + "inner join mov.lotaResp as dplot "
+				+ "inner join doc.exNivelAcesso as nivel " + "inner join doc.orgaoUsuario as orgao "
+				+ "inner join doc.exFormaDocumento as forma " + "inner join forma.exTipoFormaDoc as tipoForma "
+				+ "inner join marca.dpLotacaoIni as lot " + "inner join marca.cpMarcador as marcador "
+				+ "left outer join marca.dpPessoaIni as pes " + "left outer join doc.exMobilPai as mobPai "
+				+ "left outer join mobPai.exDocumento docPai " + "left outer join docPai.orgaoUsuario orgaoDocPai "
+				+ "left outer join docPai.exFormaDocumento formaDocPai "
+				+ "left outer join mobPai.exTipoMobil tipoMobPai " + "where lot.idLotacao in (" + listaLotacoes + ") "
+				+ "and marcador.idMarcador in (" + listaMarcadoresRelevantes + ")" + trechoQryTipoForma
+				+ " and mov.dtMov = (select min(movim.dtMov) from ExMovimentacao movim where movim.exMobil = mov.exMobil) "
+				+ " order by lot.siglaLotacao, doc.idDoc, mov.dtMov"/* , timeout */);
 
 		// Retorna
 		List<Object[]> lista = qryMarcas.getResultList();
@@ -192,60 +163,62 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 		long dataant = 0;
 		long durentrelots = 0;
 		List<String> listaFinal = new ArrayList<String>();
-		
+
 		for (Object[] array : lista) {
-			Long idDoc = (Long)array[0];
-			String nomeLotacao = (String)array[1]; 
+			Long idDoc = (Long) array[0];
+			String nomeLotacao = (String) array[1];
 			ExMovimentacao mov = (ExMovimentacao) array[2];
-			ExMobil mob = (ExMobil)array[3];
-			String siglaOrgaoUsu = (String)array[4];
-			String acronimoOrgaoUsu = (String)array[5];
-			String siglaFormaDoc = (String)array[6];
-			Long anoEmissao = (Long)array[7];
-			Long numExpediente = (Long)array[8];
-			Integer docNumSequencia = (Integer)array[9];
-			Long idTipoMobil = (Long)array[10];
-			Integer mobilNumSequencia = (Integer)array[11];
-			Long pai_idDoc = (Long)array[12];
-			String pai_siglaOrgaoUsu = (String)array[13];
-			String pai_acronimoOrgaoUsu = (String)array[14];
-			String pai_siglaFormaDoc = (String)array[15];
-			Long pai_anoEmissao = (Long)array[16];
-			Long pai_numExpediente = (Long)array[17];
-			Integer pai_numSequencia = (Integer)array[18];
-			Long pai_idTipoMobil = (Long)array[19];
-			Integer pai_mobilNumSequencia = (Integer)array[20];
-			
-			String codigoDocumento = ExDocumento.getCodigo(idDoc, siglaOrgaoUsu, acronimoOrgaoUsu, siglaFormaDoc, anoEmissao, numExpediente, docNumSequencia, idTipoMobil, mobilNumSequencia, 
-					pai_idDoc, pai_siglaOrgaoUsu, pai_acronimoOrgaoUsu, pai_siglaFormaDoc, pai_anoEmissao, pai_numExpediente, pai_numSequencia, pai_idTipoMobil, pai_mobilNumSequencia);
-			
+			ExMobil mob = (ExMobil) array[3];
+			String siglaOrgaoUsu = (String) array[4];
+			String acronimoOrgaoUsu = (String) array[5];
+			String siglaFormaDoc = (String) array[6];
+			Long anoEmissao = (Long) array[7];
+			Long numExpediente = (Long) array[8];
+			Integer docNumSequencia = (Integer) array[9];
+			Long idTipoMobil = (Long) array[10];
+			Integer mobilNumSequencia = (Integer) array[11];
+			Long pai_idDoc = (Long) array[12];
+			String pai_siglaOrgaoUsu = (String) array[13];
+			String pai_acronimoOrgaoUsu = (String) array[14];
+			String pai_siglaFormaDoc = (String) array[15];
+			Long pai_anoEmissao = (Long) array[16];
+			Long pai_numExpediente = (Long) array[17];
+			Integer pai_numSequencia = (Integer) array[18];
+			Long pai_idTipoMobil = (Long) array[19];
+			Integer pai_mobilNumSequencia = (Integer) array[20];
+
+			String codigoDocumento = ExDocumento.getCodigo(idDoc, siglaOrgaoUsu, acronimoOrgaoUsu, siglaFormaDoc,
+					anoEmissao, numExpediente, docNumSequencia, idTipoMobil, mobilNumSequencia, pai_idDoc,
+					pai_siglaOrgaoUsu, pai_acronimoOrgaoUsu, pai_siglaFormaDoc, pai_anoEmissao, pai_numExpediente,
+					pai_numSequencia, pai_idTipoMobil, pai_mobilNumSequencia);
+
 			String codigoMobil = ExMobil.getSigla(codigoDocumento, mobilNumSequencia, idTipoMobil);
-			
-			String url = ((String)array[21]).trim() + codigoMobil;
-			
-			String descricao = (String)array[22];
-			
-			String nomePessoa = (String)array[23];
-			
-			String descrMarcador =  (String)array[24];
-			
+
+			String url = ((String) array[21]).trim() + codigoMobil;
+
+			String descricao = (String) array[22];
+
+			String nomePessoa = (String) array[23];
+
+			String descrMarcador = (String) array[24];
+
 			long identificador = mov.getExMobil().getId();
-			
+
 			listaFinal.add(nomeLotacao);
 			listaFinal.add(codigoMobil);
-			//testar se a criação foi cancelada
-			//if (mob.getUltimaMovimentacao(1).isCancelada() == false)
+			// testar se a criação foi cancelada
+			// if (mob.getUltimaMovimentacao(1).isCancelada() == false)
 			listaFinal.add(mob.getUltimaMovimentacao(1).getDtMovDDMMYY().toString());
 			listaFinal.add(mob.getUltimaMovimentacao(1).getLotaCadastrante().getSiglaLotacao().toString());
 			listaFinal.add(descrMarcador);
 			listaFinal.add(mov.getLotaResp().getSigla().toString());
-			if (mob.getUltimaMovimentacao(28)  != null) {
+			if (mob.getUltimaMovimentacao(28) != null) {
 				listaFinal.add(mob.getUltimaMovimentacao(28).toString());
 			} else {
 				listaFinal.add("");
 			}
 			listaFinal.add(descricao);
-		
+
 		}
 		return listaFinal;
 	}
@@ -260,28 +233,24 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 		// Obtém uma formaDoc a partir da sigla passada e monta trecho da query
 		// para a forma
 		Query qryTipoForma = ContextoPersistencia.em().createQuery(
-				"from ExTipoFormaDoc tf where " + "tf.descTipoFormaDoc = '"
-						+ parametros.get("tipoFormaDoc") + "'");
-		
+				"from ExTipoFormaDoc tf where " + "tf.descTipoFormaDoc = '" + parametros.get("tipoFormaDoc") + "'");
+
 		ExTipoFormaDoc tipoFormaDoc = null;
 		try {
 			tipoFormaDoc = (ExTipoFormaDoc) qryTipoForma.getSingleResult();
-		} catch (Exception ex) {}
-		
+		} catch (Exception ex) {
+		}
+
 		String trechoQryTipoForma = tipoFormaDoc == null ? ""
-				: " and tipoForma.idTipoFormaDoc = "
-						+ tipoFormaDoc.getIdTipoFormaDoc();
+				: " and tipoForma.idTipoFormaDoc = " + tipoFormaDoc.getIdTipoFormaDoc();
 
-			
 		// Obtém a lotação com o id passado...
-		Query qrySetor = ContextoPersistencia.em().createQuery(
-				"from DpLotacao lot where lot.idLotacao = " + parametros.get("lotacao"));
-			
+		Query qrySetor = ContextoPersistencia.em()
+				.createQuery("from DpLotacao lot where lot.idLotacao = " + parametros.get("lotacao"));
+
 		Set<DpLotacao> lotacaoSet = new HashSet<DpLotacao>();
-		DpLotacao lotacao = (DpLotacao)qrySetor.getSingleResult();
+		DpLotacao lotacao = (DpLotacao) qrySetor.getSingleResult();
 		lotacaoSet.add(lotacao);
-		
-	
 
 		// ... e monta trecho da query para as lotações
 		String listaLotacoes = "";
@@ -298,19 +267,14 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 
 		// Monta trecho da query para ocultar seletivamente a descrição do
 		// documento
-		String trechoQryDescrDocumento = "(case when ("
-				+ "	nivel.idNivelAcesso <> 1 "
-				+ "	and nivel.idNivelAcesso <> 6"
-				+ ") then 'CONFIDENCIAL' else doc.descrDocumento end)";
+		String trechoQryDescrDocumento = "(case when (" + "	nivel.idNivelAcesso <> 1 "
+				+ "	and nivel.idNivelAcesso <> 6" + ") then 'CONFIDENCIAL' else doc.descrDocumento end)";
 
 		// Monta trecho da query para retornar o código do documento
-		String trechoQryCodigoDoc = " orgao.siglaOrgaoUsu "
-				+ "|| '-' || " + "forma.siglaFormaDoc "
-				+ "|| '-' || " + "doc.anoEmissao " + "|| '/' || "
-				+ "doc.numExpediente " + "|| "
-				+ "(case when (tipoMob.idTipoMobil = 4) "
-				+ "then ('-V' || marca.exMobil.numSequencia) " +
-						"else ('-' || chr(marca.exMobil.numSequencia+64)) end)";
+		String trechoQryCodigoDoc = " orgao.siglaOrgaoUsu " + "|| '-' || " + "forma.siglaFormaDoc " + "|| '-' || "
+				+ "doc.anoEmissao " + "|| '/' || " + "doc.numExpediente " + "|| "
+				+ "(case when (tipoMob.idTipoMobil = 4) " + "then ('-V' || marca.exMobil.numSequencia) "
+				+ "else ('-' || chr(marca.exMobil.numSequencia+64)) end)";
 
 		// Monta query definitiva
 		String listaMarcadoresRelevantes = "2, 3, 5, 7, 14, 15"; // Ativos
@@ -319,46 +283,23 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 		} else if (parametros.get("tipoRel").equals("3")) {
 			listaMarcadoresRelevantes = "28"; // Como interessado
 		}
-		
+
 		// bruno.lacerda@avantiprima.com.br
 		// int timeout = 1;
-		Query qryMarcas = ContextoPersistencia.em()
-				.createQuery(
-						"select " + "	marca.dpLotacaoIni.nomeLotacao, " 
-								+ " mov.dtMov, mov.descrMov, dplot.siglaLotacao, "
-								+ trechoQryCodigoDoc
-								+ ","
-								+ " '"
-								+ parametros.get("link_siga")
-								+ "' ||"
-								+ trechoQryCodigoDoc
-								+ ","
-								+ trechoQryDescrDocumento
-								+ ","
-								+ "	pes.nomePessoa,"
-								+ "	marca.cpMarcador.descrMarcador "
-								+ "from ExMarca marca "
-								+ "inner join marca.exMobil as mob "
-								+ "inner join mob.exTipoMobil as tipoMob "
-								+ "inner join mob.exDocumento as doc "
-								+ "inner join mob.exMovimentacaoSet as mov "
-								+ "inner join mov.lotaResp as dplot "
-								+ "inner join doc.exNivelAcesso as nivel "
-								+ "inner join doc.orgaoUsuario as orgao "
-								+ "inner join doc.exFormaDocumento as forma "
-								+ "inner join forma.exTipoFormaDoc as tipoForma "
-								+ "inner join marca.dpLotacaoIni as lot "
-								+ "inner join marca.cpMarcador as marcador "
-								+ "left outer join marca.dpPessoaIni as pes "
-								+ "where lot.idLotacao in ("
-								+ listaLotacoes
-								+ ") "
-								+ "and marcador.idMarcador in ("
-								+ listaMarcadoresRelevantes
-								+ ")"
-								+ trechoQryTipoForma
-								+ " and mov.dtMov = (select max(movim.dtMov) from ExMovimentacao movim where movim.exMobil = mov.exMobil) "
-								+ " order by lot.siglaLotacao, doc.idDoc"/*, timeout*/);
+		Query qryMarcas = ContextoPersistencia.em().createQuery("select " + "	marca.dpLotacaoIni.nomeLotacao, "
+				+ " mov.dtMov, mov.descrMov, dplot.siglaLotacao, " + trechoQryCodigoDoc + "," + " '"
+				+ parametros.get("link_siga") + "' ||" + trechoQryCodigoDoc + "," + trechoQryDescrDocumento + ","
+				+ "	pes.nomePessoa," + "	marca.cpMarcador.descrMarcador " + "from ExMarca marca "
+				+ "inner join marca.exMobil as mob " + "inner join mob.exTipoMobil as tipoMob "
+				+ "inner join mob.exDocumento as doc " + "inner join mob.exMovimentacaoSet as mov "
+				+ "inner join mov.lotaResp as dplot " + "inner join doc.exNivelAcesso as nivel "
+				+ "inner join doc.orgaoUsuario as orgao " + "inner join doc.exFormaDocumento as forma "
+				+ "inner join forma.exTipoFormaDoc as tipoForma " + "inner join marca.dpLotacaoIni as lot "
+				+ "inner join marca.cpMarcador as marcador " + "left outer join marca.dpPessoaIni as pes "
+				+ "where lot.idLotacao in (" + listaLotacoes + ") " + "and marcador.idMarcador in ("
+				+ listaMarcadoresRelevantes + ")" + trechoQryTipoForma
+				+ " and mov.dtMov = (select max(movim.dtMov) from ExMovimentacao movim where movim.exMobil = mov.exMobil) "
+				+ " order by lot.siglaLotacao, doc.idDoc"/* , timeout */);
 
 		// Retorna
 		List<Object[]> lista = qryMarcas.getResultList();
@@ -379,20 +320,18 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 
 		String consulta = null;
 		Query qryTipoForma = ContextoPersistencia.em().createQuery(
-				"from ExTipoFormaDoc tf where " + "tf.descTipoFormaDoc = '"
-						+ parametros.get("tipoFormaDoc") + "'");
+				"from ExTipoFormaDoc tf where " + "tf.descTipoFormaDoc = '" + parametros.get("tipoFormaDoc") + "'");
 
 		ExTipoFormaDoc tipoFormaDoc = null;
 		try {
 			tipoFormaDoc = (ExTipoFormaDoc) qryTipoForma.getSingleResult();
-		} catch (Exception ex) {}
+		} catch (Exception ex) {
+		}
 
-		Query qrySetor = ContextoPersistencia.em().createQuery(
-				"from DpLotacao lot where " + "lot.dataFimLotacao is null "
-						+ "and lot.orgaoUsuario = "
-						+ parametros.get("orgaoUsuario") + " "
-						+ "and lot.siglaLotacao = '"
-						+ parametros.get("lotacao") + "'");
+		Query qrySetor = ContextoPersistencia.em()
+				.createQuery("from DpLotacao lot where " + "lot.dataFimLotacao is null " + "and lot.orgaoUsuario = "
+						+ parametros.get("orgaoUsuario") + " " + "and lot.siglaLotacao = '" + parametros.get("lotacao")
+						+ "'");
 
 		Set<DpLotacao> lotacaoSet = new HashSet<DpLotacao>();
 		for (DpLotacao lot : (List<DpLotacao>) qrySetor.getResultList()) {
@@ -433,45 +372,30 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 
 		if (tipoFormaDoc != null) {
 			qryMovimentacao = ContextoPersistencia.em()
-					.createQuery(
-							"select mc from ExMarca mc "
-									+ "inner join fetch mc.exMobil mob "
-									+ "inner join mc.dpLotacaoIni lot "
-									+ "inner join fetch mob.exDocumento doc where "
-									+ "mc.cpMarcador.idMarcador in ("
-									+ marcadoresRelevantes
-									+ ") and "
-									+ "doc.exFormaDocumento.exTipoFormaDoc.idTipoFormaDoc = "
-									+ tipoFormaDoc.getIdTipoFormaDoc()
-									+ lotacoes
-									+ " order by lot.siglaLotacao,doc.idDoc");
+					.createQuery("select mc from ExMarca mc " + "inner join fetch mc.exMobil mob "
+							+ "inner join mc.dpLotacaoIni lot " + "inner join fetch mob.exDocumento doc where "
+							+ "mc.cpMarcador.idMarcador in (" + marcadoresRelevantes + ") and "
+							+ "doc.exFormaDocumento.exTipoFormaDoc.idTipoFormaDoc = " + tipoFormaDoc.getIdTipoFormaDoc()
+							+ lotacoes + " order by lot.siglaLotacao,doc.idDoc");
 		} else {
 			qryMovimentacao = ContextoPersistencia.em()
-					.createQuery(
-							"select mc from ExMarca mc "
-									+ "inner join fetch mc.exMobil mob "
-									+ "inner join mc.dpLotacaoIni lot "
-									+ "inner join fetch mob.exDocumento doc where "
-									+ "mc.cpMarcador.idMarcador in ("
-									+ marcadoresRelevantes + ") " + lotacoes
-									+ " order by lot.siglaLotacao,doc.idDoc");
+					.createQuery("select mc from ExMarca mc " + "inner join fetch mc.exMobil mob "
+							+ "inner join mc.dpLotacaoIni lot " + "inner join fetch mob.exDocumento doc where "
+							+ "mc.cpMarcador.idMarcador in (" + marcadoresRelevantes + ") " + lotacoes
+							+ " order by lot.siglaLotacao,doc.idDoc");
 		}
 		int indice = 0;
 		qryMovimentacao.setFirstResult(indice);
-		java.util.List<ExMarca> listaMarcas = (List<ExMarca>) qryMovimentacao
-				.getResultList();
-
-		Query qryLotacaoTitular = ContextoPersistencia.em().createQuery(
-				"from DpLotacao lot " + "where lot.dataFimLotacao is null "
-						+ "and lot.orgaoUsuario = "
-						+ parametros.get("orgaoUsuario")
-						+ " and lot.siglaLotacao = '"
+		java.util.List<ExMarca> listaMarcas = (List<ExMarca>) qryMovimentacao.getResultList();
+
+		Query qryLotacaoTitular = ContextoPersistencia.em()
+				.createQuery("from DpLotacao lot " + "where lot.dataFimLotacao is null " + "and lot.orgaoUsuario = "
+						+ parametros.get("orgaoUsuario") + " and lot.siglaLotacao = '"
 						+ parametros.get("lotacaoTitular") + "'");
 
 		DpLotacao lotaTitular = (DpLotacao) qryLotacaoTitular.getSingleResult();
 
-		DpPessoa titular = ExDao.getInstance().consultar(
-				new Long((String) parametros.get("idTit")), DpPessoa.class,
+		DpPessoa titular = ExDao.getInstance().consultar(new Long((String) parametros.get("idTit")), DpPessoa.class,
 				false);
 
 		String resp = "";
@@ -480,12 +404,8 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 
 				d.add(mc.getDpLotacaoIni().getNomeLotacao());
 				d.add(mc.getExMobil().getSigla());
-				d.add((String) parametros.get("link_siga")
-						+ mc.getExMobil().getSigla());
-				d.add(Ex.getInstance()
-						.getBL()
-						.descricaoConfidencialDoDocumento(mc.getExMobil(),
-								titular, lotaTitular));
+				d.add((String) parametros.get("link_siga") + mc.getExMobil().getSigla());
+				d.add(Ex.getInstance().getBL().descricaoConfidencialDoDocumento(mc.getExMobil(), titular, lotaTitular));
 				// d.add("");
 				// d.add(getResponsavel(mc.getExMobil().getExDocumento()).getNomePessoa());
 				if (mc.getDpPessoaIni() != null) {
@@ -503,9 +423,8 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 			/*
 			 * if (indice < MAX_RESULTS) { break; } else {
 			 * System.out.println("Tamanho do resultado:" + d.size());
-			 * qryMovimentacao.setFirstResult(indice);
-			 * HibernateUtil.getSessao().clear(); listaMarcas =
-			 * qryMovimentacao.list(); }
+			 * qryMovimentacao.setFirstResult(indice); HibernateUtil.getSessao().clear();
+			 * listaMarcas = qryMovimentacao.list(); }
 			 */
 		}
 
@@ -523,8 +442,7 @@ public class RelDocSubordinadosCriados extends RelatorioTemplate {
 				continue;
 			} else {
 				todosSubordinados.add(pai);
-				todosSubordinados.addAll(getSetoresSubordinados(pai
-						.getDpLotacaoSubordinadosSet()));
+				todosSubordinados.addAll(getSetoresSubordinados(pai.getDpLotacaoSubordinadosSet()));
 			}
 		}
 
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocsClassificados.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocsClassificados.java
index c4f99dde2f..939cfc4803 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocsClassificados.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelDocsClassificados.java
@@ -47,7 +47,19 @@ public class RelDocsClassificados extends RelatorioTemplate {
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException, JRException {
-		this.setTitle("Relação de Documentos Classificados");
+		//this.setTitle("Relação de Documentos Classificados");
+		
+		String titulo = "Relação de Documentos Classificados";
+			
+		if (this.codificacao!=null && this.codificacao.length()>0){
+			titulo = titulo + " da: " + this.codificacao;
+		}
+		this.setTitle(titulo);
+		if (this.lotacao!=null){
+			String subtitulo = "Do(a) " + lotacao.getNomeLotacao();
+			this.setSubtitle(subtitulo);
+		}
+
 		this.addColuna("Documento", 20, RelatorioRapido.CENTRO,
 				false, false);
 		this.addColuna("Classificação", 80, RelatorioRapido.ESQUERDA,
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovCad.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovCad.java
index bda4eebf02..f5da6cd89b 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovCad.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovCad.java
@@ -17,7 +17,10 @@ import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.ex.ExDocumento;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.ex.ExMobil;
 import br.gov.jfrj.siga.ex.ExMovimentacao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
@@ -25,31 +28,46 @@ import net.sf.jasperreports.engine.JRException;
 
 public class RelMovCad extends RelatorioTemplate {
 
-	public RelMovCad(Map parametros) throws DJBuilderException {
+	private DpLotacao lotacao;
+	
+	public RelMovCad(Map<String, String> parametros) throws Exception {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
-					"Parâmetro secaoUsuario não informado!");
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException("Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("lotacaoTitular") == null) {
-			throw new DJBuilderException("Parâmetro lotação não informado!");
+		if (Utils.empty(parametros.get("lotacao"))) {
+			throw new AplicacaoException("Parâmetro lotação não informado!");
 		}
-		if (parametros.get("dataInicial") == null) {
-			throw new DJBuilderException("Parâmetro dataInicial não informado!");
+		if (Utils.empty(parametros.get("dataInicial"))) {
+			throw new AplicacaoException("Parâmetro dataInicial não informado!");
 		}
-		if (parametros.get("dataFinal") == null) {
-			throw new DJBuilderException("Parâmetro dataFinal não informado!");
+		if (Utils.empty(parametros.get("dataFinal"))) {
+			throw new AplicacaoException("Parâmetro dataFinal não informado!");
 		}
 		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
+		this.lotacao = buscarLotacaoPor(Long.valueOf(parametros.get("lotacao")));
+	}
+	
+	private DpLotacao buscarLotacaoPor(Long id) {
+		CpDao dao = CpDao.getInstance();
+		DpLotacao lotacao = dao.consultar(id, DpLotacao.class, false);
+		return lotacao;
 	}
 
 	@Override
-	public AbstractRelatorioBaseBuilder configurarRelatorio()
-			throws DJBuilderException, JRException {
-		this.addAutoText("Período: " + parametros.get("dataInicial").toString() + " a " + parametros.get("dataFinal").toString(), AutoText.POSITION_HEADER,(byte) RelatorioRapido.ESQUERDA,200);
-		this.setTitle("Relatório de Movimentações por Cadastrante");
+	public AbstractRelatorioBaseBuilder configurarRelatorio() throws DJBuilderException, JRException {
+		//this.addAutoText(
+		//		"Período: " + parametros.get("dataInicial").toString() + " a " + //parametros.get("dataFinal").toString(),
+		//		AutoText.POSITION_HEADER, (byte) RelatorioRapido.ESQUERDA, 200);
+		//this.setTitle("Relatório de Movimentações por Cadastrante");
+		String titulo = "Relatório de Movimentações por Cadastrante de " + parametros.get("dataInicial").toString() + " a " + parametros.get("dataFinal").toString();
+		String subtitulo = "Do(a) " + lotacao.getNomeLotacao();
+		
+		this.setTitle(titulo);
+		this.setSubtitle(subtitulo);
+		
 		this.addColuna("Cadastrante", 100, RelatorioRapido.ESQUERDA, true);
 		this.addColuna("Documento", 40, RelatorioRapido.ESQUERDA, false);
 		this.addColuna("Data da Movimentação", 50, RelatorioRapido.ESQUERDA, false);
@@ -66,28 +84,20 @@ public class RelMovCad extends RelatorioTemplate {
 		List<String> d = new ArrayList<String>(); // new LinkedList<String>();
 
 		Query query = ContextoPersistencia.em()
-				.createQuery(
-						"select  mov, mob, doc "
-								+ "from ExMovimentacao mov "
-								+ "inner join mov.exMobil mob "
-								+ "inner join mob.exDocumento doc "
-								+ "where mob.idMobil=mov.exMobil.idMobil "
-								+ "and mov.lotaCadastrante.idLotacao = :id "
-								+ "and mov.dtIniMov >= :dtini "
-								+ "and mov.dtIniMov <= :dtfim "
-								+ "order by mov.cadastrante.idPessoaIni, mob.idMobil, mov.dtIniMov");
+				.createQuery("select  mov, mob, doc " + "from ExMovimentacao mov " + "inner join mov.exMobil mob "
+						+ "inner join mob.exDocumento doc " + "where mob.idMobil=mov.exMobil.idMobil "
+						+ "and mov.lotaCadastrante.idLotacao = :id " + "and mov.dtIniMov >= :dtini "
+						+ "and mov.dtIniMov <= :dtfim "
+						+ "order by mov.cadastrante.idPessoaIni, mob.idMobil, mov.dtIniMov");
 
-		query.setParameter("id",
-				Long.valueOf((String) parametros.get("lotacao")));
+		query.setParameter("id", Long.valueOf((String) parametros.get("lotacao")));
 		try {
-			query.setParameter("dtini",
-					formatter.parse((String) parametros.get("dataInicial")));
+			query.setParameter("dtini", formatter.parse((String) parametros.get("dataInicial")));
 		} catch (ParseException e) {
 			throw new AplicacaoException("Data Inicial inválida.", 0, e);
 		}
 		try {
-			query.setParameter("dtfim",
-					formatter.parse((String) parametros.get("dataFinal")));
+			query.setParameter("dtfim", formatter.parse((String) parametros.get("dataFinal")));
 		} catch (ParseException e) {
 			throw new AplicacaoException("Data Final inválida.", 0, e);
 		}
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovProcesso.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovProcesso.java
index 7cf5debfec..dc18c1ddae 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovProcesso.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovProcesso.java
@@ -16,6 +16,8 @@ import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
 import br.gov.jfrj.siga.ex.ExDocumento;
 import br.gov.jfrj.siga.ex.ExMobil;
@@ -23,45 +25,42 @@ import br.gov.jfrj.siga.ex.ExMovimentacao;
 import br.gov.jfrj.siga.hibernate.ExDao;
 import net.sf.jasperreports.engine.JRException;
 
+// Nato: Este relatório não tem um código completo, portanto será temporariamente removido.
 public class RelMovProcesso extends RelatorioTemplate {
 
-	public RelMovProcesso(Map parametros) throws DJBuilderException {
+	public RelMovProcesso(Map<String, String> parametros) throws AplicacaoException {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
-					"Parâmetro secaoUsuario não informado!");
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException("Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("lotacao") == null) {
-			throw new DJBuilderException("Parâmetro lotação não informado!");
+		if (Utils.empty(parametros.get("lotacao"))) {
+			throw new AplicacaoException("Parâmetro lotação não informado!");
 		}
-		//if (parametros.get("orgao") == null) {
-		//	throw new DJBuilderException("Parâmetro órgão não informado!");
-		//}
-		if (parametros.get("processo") == null) {
-			throw new DJBuilderException("Parâmetro número do processo não informado!");
+		// if (parametros.get("orgao"))) {
+		// throw new AplicacaoException("Parâmetro órgão não informado!");
+		// }
+		if (Utils.empty(parametros.get("processo"))) {
+			throw new AplicacaoException("Parâmetro número do processo não informado!");
 		}
-		if (parametros.get("dataInicial") == null) {
-			throw new DJBuilderException("Parâmetro dataInicial não informado!");
+		if (Utils.empty(parametros.get("dataInicial"))) {
+			throw new AplicacaoException("Parâmetro dataInicial não informado!");
 		}
-		if (parametros.get("dataFinal") == null) {
-			throw new DJBuilderException("Parâmetro dataFinal não informado!");
+		if (Utils.empty(parametros.get("dataFinal"))) {
+			throw new AplicacaoException("Parâmetro dataFinal não informado!");
 		}
-		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+		if (Utils.empty(parametros.get("link_siga"))) {
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
 	}
 
 	@Override
-	public AbstractRelatorioBaseBuilder configurarRelatorio()
-			throws DJBuilderException, JRException {
-		
+	public AbstractRelatorioBaseBuilder configurarRelatorio() throws DJBuilderException, JRException {
+
 		this.setTitle("Relatório de Movimentações de Processos");
 		this.addColuna("Lotação", 10, RelatorioRapido.CENTRO, false);
-		this.addColuna("Processo", 40, RelatorioRapido.CENTRO,
-				false);
-		this.addColuna("Movimentações", 50,
-				RelatorioRapido.CENTRO, false);
-			return this;
+		this.addColuna("Processo", 40, RelatorioRapido.CENTRO, false);
+		this.addColuna("Movimentações", 50, RelatorioRapido.CENTRO, false);
+		return this;
 	}
 
 	@Override
@@ -70,9 +69,9 @@ public class RelMovProcesso extends RelatorioTemplate {
 		DateFormat formatter = new SimpleDateFormat("dd/MM/yyyy");
 
 		List<String> d = new ArrayList<String>();
-		
+
 		String processo = (String) parametros.get("processo");
-				
+
 		Map<String, CpOrgaoUsuario> mapAcronimo = new TreeMap<String, CpOrgaoUsuario>();
 		for (CpOrgaoUsuario ou : ExDao.getInstance().listarOrgaosUsuarios()) {
 			mapAcronimo.put(ou.getAcronimoOrgaoUsu(), ou);
@@ -83,13 +82,11 @@ public class RelMovProcesso extends RelatorioTemplate {
 		}
 
 		final Pattern p2 = Pattern.compile("^TMP-?([0-9]{1,7})");
-		final Pattern p1 = Pattern
-				.compile("^("
-						+ acronimos
-						+ ")?-?([A-Za-z]{3})?-?(?:([0-9]{4})/?)??([0-9]{1,5})(\\.?[0-9]{1,3})?(?:((?:-?[a-zA-Z]{1})|(?:-[0-9]{1,2}))|((?:-?V[0-9]{1,2})))?$");
+		final Pattern p1 = Pattern.compile("^(" + acronimos
+				+ ")?-?([A-Za-z]{3})?-?(?:([0-9]{4})/?)??([0-9]{1,5})(\\.?[0-9]{1,3})?(?:((?:-?[a-zA-Z]{1})|(?:-[0-9]{1,2}))|((?:-?V[0-9]{1,2})))?$");
 		final Matcher m2 = p2.matcher(processo.trim().toUpperCase());
 		final Matcher m1 = p1.matcher(processo.trim().toUpperCase());
-		
+
 		TreeSet<ExMovimentacao> listaCompleta = new TreeSet<ExMovimentacao>();
 
 		ExMovimentacao mov = null;
@@ -100,14 +97,13 @@ public class RelMovProcesso extends RelatorioTemplate {
 				listaCompleta.add(movAux);
 		}
 
-		
 		Iterator it = listaCompleta.iterator();
 		while (it.hasNext()) {
 			Object[] obj = (Object[]) it.next();
 			ExMovimentacao movim = (ExMovimentacao) obj[0];
 			ExMobil mobile = (ExMobil) obj[1];
 			ExDocumento doc = (ExDocumento) obj[2];
-			if (mov.getExMobil().getSigla()  != null) {
+			if (mov.getExMobil().getSigla() != null) {
 				d.add(mov.getExMobil().getSigla());
 			} else {
 				d.add("");
@@ -138,5 +134,6 @@ public class RelMovProcesso extends RelatorioTemplate {
 				d.add("");
 			}
 		}
-		return d;	}
+		return d;
+	}
 }
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacao.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacao.java
index f52a5b7f92..d93effc6c5 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacao.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacao.java
@@ -17,38 +17,56 @@ import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.ex.ExMovimentacao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import net.sf.jasperreports.engine.JRException;
 
 public class RelMovimentacao extends RelatorioTemplate {
 
-	public RelMovimentacao(Map parametros) throws DJBuilderException {
+	private DpLotacao lotacao;
+	
+	public RelMovimentacao(Map<String, String> parametros) throws AplicacaoException {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException(
 					"Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("lotacaoTitular") == null) {
-			throw new DJBuilderException("Parâmetro lotação não informado!");
+		if (Utils.empty(parametros.get("lotacao"))) {
+			throw new AplicacaoException("Parâmetro lotação não informado!");
 		}
-		if (parametros.get("dataInicial") == null) {
-			throw new DJBuilderException("Parâmetro dataInicial não informado!");
+		if (Utils.empty(parametros.get("dataInicial"))) {
+			throw new AplicacaoException("Parâmetro dataInicial não informado!");
 		}
-		if (parametros.get("dataFinal") == null) {
-			throw new DJBuilderException("Parâmetro dataFinal não informado!");
+		if (Utils.empty(parametros.get("dataFinal"))) {
+			throw new AplicacaoException("Parâmetro dataFinal não informado!");
 		}
-		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+		if (Utils.empty(parametros.get("link_siga"))) {
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
+		this.lotacao = buscarLotacaoPor(Long.valueOf(parametros.get("lotacao")));
+	}
+
+	private DpLotacao buscarLotacaoPor(Long id) {
+		CpDao dao = CpDao.getInstance();
+		DpLotacao lotacao = dao.consultar(id, DpLotacao.class, false);
+		return lotacao;
 	}
 
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException, JRException {
-		this.addAutoText("Período: " + parametros.get("dataInicial").toString() + " a " + parametros.get("dataFinal").toString(), AutoText.POSITION_HEADER,(byte) RelatorioRapido.ESQUERDA,200);
-		this.setTitle("Relatório de Movimentações");
+				
+		//this.addAutoText("Período: " + parametros.get("dataInicial").toString() + " a " + parametros.get("dataFinal").toString(), AutoText.POSITION_HEADER,(byte) RelatorioRapido.ESQUERDA,200);
+		//this.setTitle("Relatório de Movimentações");
+		String titulo = "Relatório de Movimentações de " + parametros.get("dataInicial").toString() + " a " + parametros.get("dataFinal").toString();
+		String subtitulo = "Do(a) " + lotacao.getNomeLotacao();
+
+		this.setTitle(titulo);
+		this.setSubtitle(subtitulo);
+
 		this.addColuna("Documento", 25, RelatorioRapido.ESQUERDA, false);
 		this.addColuna("Data de Movimento", 15, RelatorioRapido.ESQUERDA, false);
 		this.addColuna("Descrição", 15, RelatorioRapido.ESQUERDA, false);
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacaoDocSubordinados.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacaoDocSubordinados.java
index cd57927249..064024bbdb 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacaoDocSubordinados.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelMovimentacaoDocSubordinados.java
@@ -33,6 +33,8 @@ import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.ex.ExDocumento;
@@ -43,20 +45,23 @@ import br.gov.jfrj.siga.ex.ExTipoFormaDoc;
 import br.gov.jfrj.siga.ex.bl.Ex;
 import br.gov.jfrj.siga.hibernate.ExDao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import net.sf.jasperreports.engine.JRException;
 
 public class RelMovimentacaoDocSubordinados extends RelatorioTemplate {
 
-	public RelMovimentacaoDocSubordinados(Map parametros)
-			throws DJBuilderException {
+	public RelMovimentacaoDocSubordinados(Map<String, String> parametros)
+			throws Exception {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException(
 					"Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+		if (Utils.empty(parametros.get("lotacao"))) {
+			throw new AplicacaoException(
+					"Parâmetro lotacao não informado!");
+		}
+		if (Utils.empty(parametros.get("link_siga"))) {
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
 
 	}
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelOrgao.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelOrgao.java
index 902913a834..183bac9951 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelOrgao.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelOrgao.java
@@ -21,44 +21,64 @@ import ar.com.fdvs.dj.domain.constants.Font;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import net.sf.jasperreports.engine.JRException;
 
 public class RelOrgao extends RelatorioTemplate {
 
-	public RelOrgao(Map parametros) throws DJBuilderException {
+	private String nomelotacao;
+	
+	public RelOrgao(Map<String, String> parametros) throws Exception {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException(
 					"Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("lotacaoTitular") == null) {
-			throw new DJBuilderException("Parâmetro lotação não informado!");
+		if (Utils.empty(parametros.get("lotacaoTitular"))) {
+			throw new AplicacaoException("Parâmetro lotação não informado!");
 		}
-		if (parametros.get("orgao") == null) {
-			throw new DJBuilderException("Parâmetro órgão não informado!");
+		if (Utils.empty(parametros.get("orgao"))) {
+			throw new AplicacaoException("Parâmetro órgão não informado!");
 		}
-		//if (parametros.get("lotacao") == null) {
-		//	throw new DJBuilderException("Parâmetro órgão não informado!");
+		//if (parametros.get("lotacao"))) {
+		//	throw new AplicacaoException("Parâmetro órgão não informado!");
 		//}
-		if (parametros.get("dataInicial") == null) {
-			throw new DJBuilderException("Parâmetro dataInicial não informado!");
+		if (Utils.empty(parametros.get("dataInicial"))) {
+			throw new AplicacaoException("Parâmetro dataInicial não informado!");
+		}
+		if (Utils.empty(parametros.get("dataFinal"))) {
+			throw new AplicacaoException("Parâmetro dataFinal não informado!");
 		}
-		if (parametros.get("dataFinal") == null) {
-			throw new DJBuilderException("Parâmetro dataFinal não informado!");
+		if (Utils.empty(parametros.get("link_siga"))) {
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
-		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+		this.nomelotacao = "";
+		if (!Utils.empty(parametros.get("lotacao"))) {
+			this.nomelotacao = buscarLotacaoPor(Long.valueOf(parametros.get("lotacao")));
 		}
 	}
 
+	private String buscarLotacaoPor(Long id) {
+		CpDao dao = CpDao.getInstance();
+		DpLotacao lotacao = dao.consultar(id, DpLotacao.class, false);
+		return lotacao.getNomeLotacao();
+	}
+
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException, JRException {
 		
-		this.setTitle("Relatório de Despachos e Transferências");
+		String titulo = "Relatório de Despachos e Transferências de " + parametros.get("dataInicial").toString() + " a " + parametros.get("dataFinal").toString();
+		this.setTitle(titulo);
+		if (this.nomelotacao != "") {
+			String subtitulo = "Do(a) " + this.nomelotacao;
+			this.setSubtitle(subtitulo);
+		}
+		
 		estiloTituloColuna.setFont(new Font(8,"Arial",true));
 		this.addColuna("Lotação", 10, RelatorioRapido.CENTRO, false);
 		this.addColuna("Expedientes recebidos", 10, RelatorioRapido.CENTRO,
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelTipoDoc.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelTipoDoc.java
index 89567636d4..ddee5f0d98 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelTipoDoc.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelTipoDoc.java
@@ -18,42 +18,58 @@ import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import net.sf.jasperreports.engine.JRException;
 
 public class RelTipoDoc extends RelatorioTemplate {
 
-	public RelTipoDoc(Map parametros) throws DJBuilderException {
+	private DpLotacao lotacao;
+	
+	public RelTipoDoc(Map<String, String> parametros) throws Exception {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
+		if (Utils.empty(parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException(
 					"Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("lotacaoTitular") == null) {
-			throw new DJBuilderException("Parâmetro lotação não informado!");
+		if (Utils.empty(parametros.get("lotacao"))) {
+			throw new AplicacaoException("Parâmetro lotação não informado!");
 		}
 		/*
-		 * if (parametros.get("orgao") == null) { throw new
-		 * DJBuilderException("Parâmetro órgão não informado!"); }
+		 * if (Utils.empty(parametros.get("orgao"))) { throw new
+		 * AplicacaoException("Parâmetro órgão não informado!"); }
 		 */
-		if (parametros.get("dataInicial") == null) {
-			throw new DJBuilderException("Parâmetro dataInicial não informado!");
+		if (Utils.empty(parametros.get("dataInicial"))) {
+			throw new AplicacaoException("Parâmetro dataInicial não informado!");
 		}
-		if (parametros.get("dataFinal") == null) {
-			throw new DJBuilderException("Parâmetro dataFinal não informado!");
+		if (Utils.empty(parametros.get("dataFinal"))) {
+			throw new AplicacaoException("Parâmetro dataFinal não informado!");
 		}
-		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+		if (Utils.empty(parametros.get("link_siga"))) {
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
+		this.lotacao = buscarLotacaoPor(Long.valueOf(parametros.get("lotacao")));
 	}
 
+	private DpLotacao buscarLotacaoPor(Long id) {
+		CpDao dao = CpDao.getInstance();
+		DpLotacao lotacao = dao.consultar(id, DpLotacao.class, false);
+		return lotacao;
+	}
+	
 	@Override
 	public AbstractRelatorioBaseBuilder configurarRelatorio()
 			throws DJBuilderException, JRException {
 
-		this.setTitle("Relação de Documentos Criados");
+		String titulo = "Relação de Documentos Criados de " + parametros.get("dataInicial").toString() + " a " + parametros.get("dataFinal").toString();
+		String subtitulo = "Do(a) " + lotacao.getNomeLotacao();
+		
+		this.setTitle(titulo);
+		this.setSubtitle(subtitulo);
+		
 		this.addColuna("Tipo de Documento", 35, RelatorioRapido.ESQUERDA, false);
 		this.addColuna("Forma do Documento", 40, RelatorioRapido.ESQUERDA, false);
 		this.addColuna("Total", 25, RelatorioRapido.CENTRO, false);
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelatorioDocumentosSubordinados.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelatorioDocumentosSubordinados.java
index cdf572e028..a123b45922 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelatorioDocumentosSubordinados.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/relatorio/dinamico/relatorios/RelatorioDocumentosSubordinados.java
@@ -21,7 +21,6 @@ package br.gov.jfrj.siga.ex.relatorio.dinamico.relatorios;
 import java.util.ArrayList;
 import java.util.Collection;
 import java.util.HashSet;
-import java.util.Iterator;
 import java.util.LinkedList;
 import java.util.List;
 import java.util.Map;
@@ -33,6 +32,8 @@ import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.ex.ExDocumento;
@@ -42,24 +43,23 @@ import br.gov.jfrj.siga.ex.ExTipoFormaDoc;
 import br.gov.jfrj.siga.ex.bl.Ex;
 import br.gov.jfrj.siga.hibernate.ExDao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import net.sf.jasperreports.engine.JRException;
 
 public class RelatorioDocumentosSubordinados extends RelatorioTemplate {
 
 	public RelatorioDocumentosSubordinados(Map parametros)
-			throws DJBuilderException {
+			throws Exception {
 		super(parametros);
-		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
+		if (Utils.empty((String) parametros.get("secaoUsuario"))) {
+			throw new AplicacaoException(
 					"Parâmetro secaoUsuario não informado!");
 		}
-		if (parametros.get("lotacao") == null) {
-			throw new DJBuilderException(
+		if (Utils.empty((String) parametros.get("lotacao"))) {
+			throw new AplicacaoException(
 					"Parâmetro lotação não informado!");
 		}
-		if (parametros.get("link_siga") == null) {
-			throw new DJBuilderException("Parâmetro link_siga não informado!");
+		if (Utils.empty((String) parametros.get("link_siga"))) {
+			throw new AplicacaoException("Parâmetro link_siga não informado!");
 		}
 
 	}
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/service/impl/ExServiceImpl.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/service/impl/ExServiceImpl.java
index cb470facb8..bd96e5f350 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/service/impl/ExServiceImpl.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/service/impl/ExServiceImpl.java
@@ -20,6 +20,8 @@
 package br.gov.jfrj.siga.ex.service.impl;
 
 import java.io.ByteArrayOutputStream;
+import java.io.Closeable;
+import java.io.IOException;
 import java.lang.reflect.InvocationTargetException;
 import java.util.ArrayList;
 import java.util.Date;
@@ -28,11 +30,17 @@ import java.util.TreeSet;
 
 import javax.annotation.Resource;
 import javax.jws.WebService;
+import javax.persistence.EntityManager;
 import javax.servlet.ServletContext;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
 import javax.xml.ws.WebServiceContext;
 import javax.xml.ws.handler.MessageContext;
 
+import org.jboss.logging.Logger;
+
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.log.RequestLoggerFilter;
 import br.gov.jfrj.siga.cp.CpSituacaoConfiguracao;
 import br.gov.jfrj.siga.cp.CpTipoConfiguracao;
 import br.gov.jfrj.siga.dp.CpOrgao;
@@ -47,9 +55,11 @@ import br.gov.jfrj.siga.ex.ExMobil;
 import br.gov.jfrj.siga.ex.ExModelo;
 import br.gov.jfrj.siga.ex.ExMovimentacao;
 import br.gov.jfrj.siga.ex.ExNivelAcesso;
+import br.gov.jfrj.siga.ex.ExPapel;
 import br.gov.jfrj.siga.ex.ExSituacaoConfiguracao;
 import br.gov.jfrj.siga.ex.ExTipoDocumento;
 import br.gov.jfrj.siga.ex.ExTipoMobil;
+import br.gov.jfrj.siga.ex.ExTipoMovimentacao;
 import br.gov.jfrj.siga.ex.bl.CurrentRequest;
 import br.gov.jfrj.siga.ex.bl.Ex;
 import br.gov.jfrj.siga.ex.bl.ExCompetenciaBL;
@@ -57,217 +67,233 @@ import br.gov.jfrj.siga.ex.bl.ExConfiguracaoBL;
 import br.gov.jfrj.siga.ex.bl.RequestInfo;
 import br.gov.jfrj.siga.ex.service.ExService;
 import br.gov.jfrj.siga.hibernate.ExDao;
+import br.gov.jfrj.siga.hibernate.ExStarter;
+import br.gov.jfrj.siga.model.ContextoPersistencia;
+import br.gov.jfrj.siga.model.dao.ModeloDao;
 import br.gov.jfrj.siga.parser.PessoaLotacaoParser;
+import br.gov.jfrj.siga.parser.SiglaParser;
 import br.gov.jfrj.siga.persistencia.ExMobilDaoFiltro;
 import br.gov.jfrj.siga.vraptor.ExMobilSelecao;
 
-
 @WebService(serviceName = "ExService", endpointInterface = "br.gov.jfrj.siga.ex.service.ExService", targetNamespace = "http://impl.service.ex.siga.jfrj.gov.br/")
 public class ExServiceImpl implements ExService {
+	private final static Logger log = Logger.getLogger(ExService.class);
+
+	private class SoapContext implements Closeable {
+		EntityManager em;
+		boolean transacional;
+		long inicio = System.currentTimeMillis();
+
+		public SoapContext(boolean transacional) {
+			this.transacional = transacional;
+			em = ExStarter.emf.createEntityManager();
+			ContextoPersistencia.setEntityManager(em);
+
+			ServletContext ctx = (ServletContext) context.getMessageContext().get(MessageContext.SERVLET_CONTEXT);
+			HttpServletRequest request = (HttpServletRequest) context.getMessageContext()
+					.get(MessageContext.SERVLET_REQUEST);
+			HttpServletResponse response = (HttpServletResponse) context.getMessageContext()
+					.get(MessageContext.SERVLET_RESPONSE);
+			CurrentRequest.set(new RequestInfo(ctx, request, response));
+
+			ModeloDao.freeInstance();
+			ExDao.getInstance();
+			try {
+				Ex.getInstance().getConf().limparCacheSeNecessario();
+			} catch (Exception e1) {
+				throw new RuntimeException("Não foi possível atualizar o cache de configurações", e1);
+			}
+			if (this.transacional)
+				em.getTransaction().begin();
+		}
 
-	private boolean hideStackTrace = false;
-	@Resource
-	private WebServiceContext context;
+		public void rollback(Exception e) {
+			if (em.getTransaction().isActive())
+				em.getTransaction().rollback();
+			if (!RequestLoggerFilter.isAplicacaoException(e)) {
+				RequestLoggerFilter.logException(null, inicio, e);
+			}
+		}
 
-	public boolean isHideStackTrace() {
-		return hideStackTrace;
+		@Override
+		public void close() throws IOException {
+			try {
+				if (this.transacional)
+					em.getTransaction().commit();
+			} catch (Exception e) {
+				if (em.getTransaction().isActive())
+					em.getTransaction().rollback();
+				throw new RuntimeException(e);
+			} finally {
+				em.close();
+				ContextoPersistencia.setEntityManager(null);
+			}
+		}
 	}
 
-	public void setHideStackTrace(boolean hideStackTrace) {
-		this.hideStackTrace = hideStackTrace;
-	}
+	@Resource
+	private WebServiceContext context;
 
 	private ExDao dao() {
 		return ExDao.getInstance();
 	}
 
-	public Boolean transferir(String codigoDocumentoVia, String siglaDestino,
-			String siglaCadastrante, Boolean forcarTransferencia) throws Exception {
-		if (codigoDocumentoVia == null)
-			return false;
-		try {
-			ExMobil mob = buscarMobil(codigoDocumentoVia);
-			if (mob.doc().isProcesso())
-				mob = mob.doc().getUltimoVolume();
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			PessoaLotacaoParser destinoParser = new PessoaLotacaoParser(
-					siglaDestino);
-			if (destinoParser.getLotacao() == null
-					&& destinoParser.getPessoa() == null)
-				return false;
-			if (destinoParser.getLotacao() == null)
-				destinoParser
-						.setLotacao(destinoParser.getPessoa().getLotacao());
-			if (mob.getUltimaMovimentacaoNaoCancelada() != null
-					&& ((destinoParser.getLotacao() == null || !destinoParser
-							.getLotacao().equivale(
-									mob.getUltimaMovimentacaoNaoCancelada()
-											.getLotaResp())) || (destinoParser
-							.getPessoa() == null || !destinoParser.getPessoa()
-							.equivale(
-									mob.getUltimaMovimentacaoNaoCancelada()
-											.getResp())))) {
-				Ex.getInstance()
-						.getBL()
-						.transferir(null, null, cadastranteParser.getPessoa(),
-								cadastranteParser.getLotacao(), mob, null,
-								null, null, destinoParser.getLotacao(),
-								destinoParser.getPessoa(), null, null, null,
-								null, null, false, null, null, null, forcarTransferencia, false);
+	public Boolean transferir(String codigoDocumentoVia, String siglaDestino, String siglaCadastrante,
+			Boolean forcarTransferencia) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				if (codigoDocumentoVia == null)
+					return false;
+				ExMobil mob = buscarMobil(codigoDocumentoVia);
+				if (mob.doc().isProcesso()) {
+					mob = mob.doc().getUltimoVolume();
+				} else if (contemApenasUmaVia(mob)) {
+					mob = mob.doc().getPrimeiraVia();
+				}
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				PessoaLotacaoParser destinoParser = new PessoaLotacaoParser(siglaDestino);
+				if (destinoParser.getLotacao() == null && destinoParser.getPessoa() == null)
+					return false;
+				if (destinoParser.getLotacao() == null)
+					destinoParser.setLotacao(destinoParser.getPessoa().getLotacao());
+				if (mob.getUltimaMovimentacaoNaoCancelada() != null && ((destinoParser.getLotacao() == null
+						|| !destinoParser.getLotacao().equivale(mob.getUltimaMovimentacaoNaoCancelada().getLotaResp()))
+						|| (destinoParser.getPessoa() != null && !destinoParser.getPessoa()
+								.equivale(mob.getUltimaMovimentacaoNaoCancelada().getResp())))) {
+					Ex.getInstance().getBL().transferir(null, null, cadastranteParser.getPessoa(),
+							cadastranteParser.getLotacao(), mob, null, null, null, destinoParser.getLotacao(),
+							destinoParser.getPessoa(), null, null, null, null, null, false, null, null, null,
+							forcarTransferencia, false);
+				}
+				return true;
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
 			}
-			return true;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			return false;
 		}
 	}
 
-	private ExMobil buscarMobil(String codigoDocumentoVia) throws Exception,
-			IllegalAccessException, InvocationTargetException,
-			NoSuchMethodException {
-		try {
-			ExMobil mob = null;
-			{
-				final ExMobilDaoFiltro filter = new ExMobilDaoFiltro();
-				filter.setSigla(codigoDocumentoVia);
-				mob = (ExMobil) dao().consultarPorSigla(filter);
-			}
-			return mob;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
-		}
+	private ExMobil buscarMobil(String codigoDocumentoVia)
+			throws Exception, IllegalAccessException, InvocationTargetException, NoSuchMethodException {
+		ExMobil mob = null;
+		final ExMobilDaoFiltro filter = new ExMobilDaoFiltro();
+		filter.setSigla(codigoDocumentoVia);
+		mob = (ExMobil) dao().consultarPorSigla(filter);
+		return mob;
 	}
 
-	public Boolean arquivarCorrente(String codigoDocumentoVia,
-			String siglaDestino, String siglaCadastrante) throws Exception {
-		try {
-			ExMobil mob = buscarMobil(codigoDocumentoVia);
-
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			PessoaLotacaoParser destinoParser = new PessoaLotacaoParser(
-					siglaDestino);
-			Ex.getInstance()
-					.getBL()
-					.arquivarCorrente(cadastranteParser.getPessoa(),
-							cadastranteParser.getLotacao(), mob, null, null,
-							destinoParser.getPessoa(), false);
-			return true;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+	public Boolean arquivarCorrente(String codigoDocumentoVia, String siglaDestino, String siglaCadastrante)
+			throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobil mob = buscarMobil(codigoDocumentoVia);
+				if (mob.doc().isProcesso()) {
+					mob = mob.doc().getUltimoVolume();
+				} else if (contemApenasUmaVia(mob)) {
+					mob = mob.doc().getPrimeiraVia();
+				}
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				PessoaLotacaoParser destinoParser = new PessoaLotacaoParser(siglaDestino);
+				Ex.getInstance().getBL().arquivarCorrente(cadastranteParser.getPessoa(), cadastranteParser.getLotacao(),
+						mob, null, null, destinoParser.getPessoa(), false);
+				return true;
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
-	public Boolean juntar(String codigoDocumentoViaFilho,
-			String codigoDocumentoViaPai, String siglaDestino,
+	public Boolean juntar(String codigoDocumentoViaFilho, String codigoDocumentoViaPai, String siglaDestino,
 			String siglaCadastrante) throws Exception {
-		try {
-			ExMobil mobFilho = buscarMobil(codigoDocumentoViaFilho);
-			ExMobil mobPai = buscarMobil(codigoDocumentoViaPai);
-
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			PessoaLotacaoParser destinoParser = new PessoaLotacaoParser(
-					siglaDestino);
-
-			Ex.getInstance()
-					.getBL()
-					.juntarDocumento(cadastranteParser.getPessoa(),
-							cadastranteParser.getPessoa(),
-							cadastranteParser.getLotacao(), null, mobFilho,
-							mobPai, null, destinoParser.getPessoa(),
-							destinoParser.getPessoa(), "1");
-			return true;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobil mobFilho = buscarMobil(codigoDocumentoViaFilho);
+				ExMobil mobPai = buscarMobil(codigoDocumentoViaPai);
+
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				PessoaLotacaoParser destinoParser = new PessoaLotacaoParser(siglaDestino);
+
+				Ex.getInstance().getBL().juntarDocumento(cadastranteParser.getPessoa(), cadastranteParser.getPessoa(),
+						cadastranteParser.getLotacao(), null, mobFilho, mobPai, null, destinoParser.getPessoa(),
+						destinoParser.getPessoa(), "1");
+				return true;
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
-	public Boolean isAssinado(String codigoDocumento, String siglaCadastrante)
-			throws Exception {
-		try {
-			ExMobil mob = buscarMobil(codigoDocumento);
-			return !mob.getExDocumento().isPendenteDeAssinatura();
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+	public Boolean isAssinado(String codigoDocumento, String siglaCadastrante) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobil mob = buscarMobil(codigoDocumento);
+				return !mob.getExDocumento().isPendenteDeAssinatura();
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
 	public Boolean isSemEfeito(String codigoDocumento) throws Exception {
-		try {
-			ExMobil mob = buscarMobil(codigoDocumento);
-			return mob.getExDocumento().isSemEfeito();
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobil mob = buscarMobil(codigoDocumento);
+				if (mob == null)
+					return null;
+				return mob.getExDocumento().isSemEfeito();
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
-	public Boolean podeMovimentar(String codigoDocumento,
-			String siglaCadastrante) throws Exception {
-		try {
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			ExMobil mob = buscarMobil(codigoDocumento);
-			return Ex
-					.getInstance()
-					.getComp()
-					.podeMovimentar(
-							cadastranteParser.getPessoa(),
-							cadastranteParser.getLotacao() == null ? cadastranteParser
-									.getPessoa().getLotacao()
-									: cadastranteParser.getLotacao(), mob);
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+	public Boolean podeMovimentar(String codigoDocumento, String siglaCadastrante) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				ExMobil mob = buscarMobil(codigoDocumento);
+				return Ex.getInstance().getComp().podeMovimentar(cadastranteParser.getPessoa(),
+						cadastranteParser.getLotacao() == null ? cadastranteParser.getPessoa().getLotacao()
+								: cadastranteParser.getLotacao(),
+						mob);
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
-	public Boolean podeTransferir(String codigoDocumento,
-			String siglaCadastrante, Boolean forcarTransferencia) throws Exception {
-		try {
-			
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			ExMobil mob = buscarMobil(codigoDocumento);
-			if (mob.doc().isProcesso()){
-				mob = mob.doc().getUltimoVolume();
-			}else if (contemApenasUmaVia(mob)){
-				mob = mob.doc().getPrimeiraVia();
+	public Boolean podeTransferir(String codigoDocumento, String siglaCadastrante, Boolean forcarTransferencia)
+			throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				ExMobil mob = buscarMobil(codigoDocumento);
+				if (mob.doc().isProcesso()) {
+					mob = mob.doc().getUltimoVolume();
+				} else if (contemApenasUmaVia(mob)) {
+					mob = mob.doc().getPrimeiraVia();
+				}
+				if (forcarTransferencia)
+					return Ex.getInstance().getComp().podeSerTransferido(mob);
+				else
+					return Ex.getInstance().getComp().podeTransferir(cadastranteParser.getPessoa(),
+							cadastranteParser.getLotacao(), mob);
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
 			}
-			if (forcarTransferencia)
-				return Ex
-						.getInstance()
-						.getComp()
-						.podeSerTransferido(mob);
-			else
-				return Ex
-						.getInstance()
-						.getComp()
-						.podeTransferir(cadastranteParser.getPessoa(),
-								cadastranteParser.getLotacao(), mob);
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
 		}
 	}
 
 	/**
-	 * Verifica se o móbil contém 1 e apenas 1 via. Se houver mais de uma via
-	 * não há como determinar qual via deve ser transferida.
+	 * Verifica se o móbil contém 1 e apenas 1 via. Se houver mais de uma via não há
+	 * como determinar qual via deve ser transferida.
+	 * 
 	 * @param mob
 	 * @return
 	 */
@@ -275,414 +301,492 @@ public class ExServiceImpl implements ExService {
 		return mob.doc().getPrimeiraVia() != null && mob.doc().getSetVias().size() == 1;
 	}
 
-	public Boolean isAtendente(String codigoDocumento, String siglaTitular)
-			throws Exception {
-		try {
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaTitular);
-			ExMobil mob = buscarMobil(codigoDocumento);
-			return ExCompetenciaBL.isAtendente(cadastranteParser.getPessoa(),
-					cadastranteParser.getLotacao(), mob);
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+	public Boolean isAtendente(String codigoDocumento, String siglaTitular) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaTitular);
+				ExMobil mob = buscarMobil(codigoDocumento);
+				return ExCompetenciaBL.isAtendente(cadastranteParser.getPessoa(), cadastranteParser.getLotacao(), mob);
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
-	public String getAtendente(String codigoDocumento, String siglaTitular)
-			throws Exception {
-		try {
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaTitular);
-			ExMobil mob = buscarMobil(codigoDocumento);
-			
-			if(mob.getDoc().isProcesso())
-				mob = mob.getDoc().getUltimoVolume();
-			
-			DpResponsavel resp = ExCompetenciaBL.getAtendente(mob);
-			if (resp == null)
-				return null;
+	public String getAtendente(String codigoDocumento, String siglaTitular) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaTitular);
+				ExMobil mob = buscarMobil(codigoDocumento);
+
+				if (mob.getDoc().isProcesso())
+					mob = mob.getDoc().getUltimoVolume();
 
-			if (resp instanceof DpPessoa) {
-				return resp.getSiglaCompleta() + "@"
-						+ ((DpPessoa) resp).getLotacao().getSiglaCompleta();
-			} else {
-				return "@" + resp.getSiglaCompleta();
+				DpResponsavel resp = ExCompetenciaBL.getAtendente(mob);
+				if (resp == null)
+					return null;
+
+				if (resp instanceof DpPessoa) {
+					return resp.getSiglaCompleta() + "@" + ((DpPessoa) resp).getLotacao().getSiglaCompleta();
+				} else {
+					return "@" + resp.getSiglaCompleta();
+				}
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
 			}
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
 		}
 	}
 
 	public byte[] obterPdfPorNumeroAssinatura(String num) throws Exception {
-		return Ex.getInstance().getBL().obterPdfPorNumeroAssinatura(num);
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				return Ex.getInstance().getBL().obterPdfPorNumeroAssinatura(num);
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
+		}
 	}
 
 	public String buscarPorCodigo(String codigo) throws Exception {
-		ExMobilSelecao sel = new ExMobilSelecao();
-		sel.setSigla(codigo);
-		sel.buscarPorSigla();
-		String s = sel.getSigla();
-		if (s != null && s.length() > 0)
-			return s;
-		return null;
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobilSelecao sel = new ExMobilSelecao();
+				sel.setSigla(codigo);
+				sel.buscarPorSigla();
+				String s = sel.getSigla();
+				if (s != null && s.length() > 0)
+					return s;
+				return null;
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
+		}
 	}
 
-	public String criarVia(String codigoDocumento, String siglaCadastrante)
-			throws Exception {
-		if (codigoDocumento == null)
-			return null;
-		try {
-			ExMobil mob = buscarMobil(codigoDocumento);
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			if (cadastranteParser.getLotacao() == null
-					&& cadastranteParser.getPessoa() == null)
-				return null;
-			Ex.getInstance()
-					.getBL()
-					.criarVia(
-							cadastranteParser.getPessoa(),
-							cadastranteParser
-									.getLotacaoOuLotacaoPrincipalDaPessoa(),
-							mob.doc());
-			return mob.doc().getUltimaVia().getSigla();
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			return null;
+	public String criarVia(String codigoDocumento, String siglaCadastrante) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				if (codigoDocumento == null)
+					return null;
+				ExMobil mob = buscarMobil(codigoDocumento);
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				if (cadastranteParser.getLotacao() == null && cadastranteParser.getPessoa() == null)
+					return null;
+				Ex.getInstance().getBL().criarVia(cadastranteParser.getPessoa(),
+						cadastranteParser.getLotacaoOuLotacaoPrincipalDaPessoa(), mob.doc());
+				return mob.doc().getUltimaVia().getSigla();
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
-	public String form(String codigoDocumento, String variavel)
-			throws Exception {
-		if (codigoDocumento == null)
-			return null;
-		try {
-			ExMobil mob = buscarMobil(codigoDocumento);
-			return mob.doc().getForm().get(variavel);
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			return null;
+	public String form(String codigoDocumento, String variavel) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				if (codigoDocumento == null)
+					return null;
+				ExMobil mob = buscarMobil(codigoDocumento);
+				return mob.doc().getForm().get(variavel);
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
 	@Override
-	public Boolean exigirAnexo(String codigoDocumentoVia, String siglaCadastrante, String descricaoDoAnexo) throws Exception {
-		try {
-			ExMobil mob = buscarMobil(codigoDocumentoVia);
-
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			Ex.getInstance()
-					.getBL()
-					.exigirAnexo(cadastranteParser.getPessoa(),
-							cadastranteParser.getLotacao(), mob, descricaoDoAnexo);
-			return true;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+	public Boolean exigirAnexo(String codigoDocumentoVia, String siglaCadastrante, String descricaoDoAnexo)
+			throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobil mob = buscarMobil(codigoDocumentoVia);
+
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				Ex.getInstance().getBL().exigirAnexo(cadastranteParser.getPessoa(), cadastranteParser.getLotacao(), mob,
+						descricaoDoAnexo);
+				return true;
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
 	public String toJSON(String codigo) throws Exception {
-		try {
-			ExMobil mob = null;
-			{
-				final ExMobilDaoFiltro filter = new ExMobilDaoFiltro();
-				filter.setSigla(codigo);
-				mob = (ExMobil) dao().consultarPorSigla(filter);
-				//return Ex.getInstance().getBL().toJSON(mob);
-				return "";
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobil mob = null;
+				{
+					final ExMobilDaoFiltro filter = new ExMobilDaoFiltro();
+					filter.setSigla(codigo);
+					mob = (ExMobil) dao().consultarPorSigla(filter);
+					// return Ex.getInstance().getBL().toJSON(mob);
+					return "";
+				}
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
 			}
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
 		}
 	}
-	
-	public String criarDocumento(String cadastranteStr, String subscritorStr, String destinatarioStr, String destinatarioCampoExtraStr, String descricaoTipoDeDocumento, String nomeForma ,String nomeModelo, String classificacaoStr, 
-			String descricaoStr, Boolean eletronico, String nomeNivelDeAcesso, String conteudo, String siglaMobilPai, Boolean finalizar) throws Exception {
-    	try {
-    		DpPessoa cadastrante = null;
-    		DpPessoa subscritor = null;
-    		ExModelo modelo = null;
-    		ExFormaDocumento forma = null;
-    		ExTipoDocumento tipoDocumento = null;
-    		ExClassificacao classificacao = null;
-    		ExNivelAcesso nivelDeAcesso = null;
-    		DpLotacao destinatarioLotacao = null;
-    		DpPessoa destinatarioPessoa = null;
-    		CpOrgao destinatarioOrgaoExterno = null;
-    		
-    		ExDocumento doc = new ExDocumento();
-    		
-    		if(cadastranteStr == null || cadastranteStr.isEmpty())
-    			throw new AplicacaoException("A matrícula do cadastrante não foi informada.");
-    		
-    		if(subscritorStr == null || subscritorStr.isEmpty())
-    			throw new AplicacaoException("A matrícula do subscritor não foi informada.");
-
-    		cadastrante = dao().getPessoaFromSigla(cadastranteStr);
-    		
-    		if(cadastrante == null)
-    			throw new AplicacaoException("Não foi possível encontrar um cadastrante com a matrícula informada.");
-    		
-    		if(cadastrante.isFechada())
-    			throw new AplicacaoException("O cadastrante não está mais ativo.");
-    		
-    		subscritor = dao().getPessoaFromSigla(subscritorStr);
-    		
-    		if(subscritor == null)
-    			throw new AplicacaoException("Não foi possível encontrar um subscritor com a matrícula informada.");
- 
-    		if(subscritor.isFechada())
-    			throw new AplicacaoException("O subscritor não está mais ativo.");
-    		
-    		if(descricaoTipoDeDocumento == null)
-    			tipoDocumento = (dao().consultar(ExTipoDocumento.TIPO_DOCUMENTO_INTERNO, ExTipoDocumento.class,
-        				false));
-    		else 
-    			tipoDocumento = dao().consultarExTipoDocumento(descricaoTipoDeDocumento);
-    		
-    		if(tipoDocumento == null)
-    			throw new AplicacaoException("Não foi possível encontrar o Tipo de Documento. Os Tipos de Documentos aceitos são: 1-Interno Produzido, 2-Interno Importado, 3-Externo");
-    		
-    		if(nomeForma == null)
-    			throw new AplicacaoException("O Tipo não foi informado.");
-    		
-    		if(nomeModelo == null)
-    			throw new AplicacaoException("O modelo não foi informado.");
-
-    		modelo = dao().consultarExModelo(nomeForma, nomeModelo);
-    		
-    		if(modelo == null)
-    			throw new AplicacaoException("Não foi possível encontrar um modelo com os dados informados.");
-    		else
-    			modelo = modelo.getModeloAtual();
-    		
-    		forma = modelo.getExFormaDocumento();
-    		
-    		if(!forma.podeSerDoTipo(tipoDocumento))
-    			throw new AplicacaoException("O documento do tipo " + forma.getDescricao() + " não pode ser " + tipoDocumento.getDescricao());
-    		
-       		if((classificacaoStr == null || classificacaoStr.isEmpty()) && !modelo.isClassificacaoAutomatica())
-       			throw new AplicacaoException("A Classificação não foi informada.");
-    		
-    		if(modelo.isClassificacaoAutomatica()) 
-    			classificacao = modelo.getExClassificacao();
-    		else
-    			classificacao =  dao().consultarExClassificacao(classificacaoStr);
-    		
-    		if(classificacao == null)
-    			throw new AplicacaoException("Não foi possível encontrar uma classificação com o código informado.");
-    		else
-    			classificacao = classificacao.getClassificacaoAtual();
-    		
-    		if(eletronico == null)
-    			eletronico = true;
-
-    		Long idSit = Ex
-    				.getInstance()
-    				.getConf()
-    				.buscaSituacao(modelo, tipoDocumento,cadastrante, cadastrante.getLotacao(),
-    						CpTipoConfiguracao.TIPO_CONFIG_ELETRONICO)
-    				.getIdSitConfiguracao();
-    		
-    		if (idSit == ExSituacaoConfiguracao.SITUACAO_OBRIGATORIO) {
-    			eletronico = true;
-    		} else if (idSit == ExSituacaoConfiguracao.SITUACAO_PROIBIDO) {
-    			eletronico = false;
-    		} 
-    		
-    		if(nomeNivelDeAcesso == null) {
-    			
-	    		Date dt = ExDao.getInstance().consultarDataEHoraDoServidor();
-	    		
-	    		ExConfiguracao config = new ExConfiguracao();
-	    		CpTipoConfiguracao exTpConfig = new CpTipoConfiguracao();
-	    		CpSituacaoConfiguracao exStConfig = new CpSituacaoConfiguracao();
-	    		config.setDpPessoa(cadastrante);
-	    		config.setLotacao(cadastrante.getLotacao());
-	    		config.setExTipoDocumento(tipoDocumento);
-	    		config.setExFormaDocumento(forma);
-	    		config.setExModelo(modelo);
-	    		config.setExClassificacao(classificacao);
-	    		exTpConfig
-	    				.setIdTpConfiguracao(CpTipoConfiguracao.TIPO_CONFIG_NIVELACESSO);
-	    		config.setCpTipoConfiguracao(exTpConfig);
-	    		exStConfig
-	    			.setIdSitConfiguracao(CpSituacaoConfiguracao.SITUACAO_DEFAULT);
-	    		config.setCpSituacaoConfiguracao(exStConfig);
-	    		
-	    		ExConfiguracao exConfig = ((ExConfiguracao) Ex
-	    				.getInstance()
-	    				.getConf()
-	    				.buscaConfiguracao(config,
-	    						new int[] { ExConfiguracaoBL.NIVEL_ACESSO }, dt));
-	    		
-	    		if(exConfig != null)
-	    			nivelDeAcesso = exConfig.getExNivelAcesso();
-    		} else {
-    			nivelDeAcesso = dao().consultarExNidelAcesso(nomeNivelDeAcesso);
-    		}
-    		
-			if(nivelDeAcesso == null)
-				nivelDeAcesso = dao().consultar(6L, ExNivelAcesso.class, false);	
-			
-			List<ExNivelAcesso> listaNiveis = ExDao.getInstance().listarOrdemNivel();
-			ArrayList<ExNivelAcesso> niveisFinal = new ArrayList<ExNivelAcesso>();
-			Date dt = ExDao.getInstance().consultarDataEHoraDoServidor();
-
-			ExConfiguracao config = new ExConfiguracao();
-			CpTipoConfiguracao exTpConfig = new CpTipoConfiguracao();
-			config.setDpPessoa(cadastrante);
-			config.setLotacao(cadastrante.getLotacao());
-			config.setExTipoDocumento(tipoDocumento);
-			config.setExFormaDocumento(forma);
-			config.setExModelo(modelo);
-			config.setExClassificacao(classificacao);
-			exTpConfig
-					.setIdTpConfiguracao(CpTipoConfiguracao.TIPO_CONFIG_NIVEL_ACESSO_MINIMO);
-			config.setCpTipoConfiguracao(exTpConfig);
-			int nivelMinimo = ((ExConfiguracao) Ex
-					.getInstance()
-					.getConf()
-					.buscaConfiguracao(config,
-							new int[] { ExConfiguracaoBL.NIVEL_ACESSO }, dt))
-					.getExNivelAcesso().getGrauNivelAcesso();
-			exTpConfig
-					.setIdTpConfiguracao(CpTipoConfiguracao.TIPO_CONFIG_NIVEL_ACESSO_MAXIMO);
-			config.setCpTipoConfiguracao(exTpConfig);
-			int nivelMaximo = ((ExConfiguracao) Ex
-					.getInstance()
-					.getConf()
-					.buscaConfiguracao(config,
-							new int[] { ExConfiguracaoBL.NIVEL_ACESSO }, dt))
-					.getExNivelAcesso().getGrauNivelAcesso();
-
-			for (ExNivelAcesso nivelAcesso : listaNiveis) {
-				if (nivelAcesso.getGrauNivelAcesso() >= nivelMinimo
-						&& nivelAcesso.getGrauNivelAcesso() <= nivelMaximo)
-					niveisFinal.add(nivelAcesso);
-			}
-			
-			if(niveisFinal != null && !niveisFinal.isEmpty() & !niveisFinal.contains(nivelDeAcesso))
-				nivelDeAcesso = niveisFinal.get(0);
-    		
-    		doc.setCadastrante(cadastrante);
-    		doc.setLotaCadastrante(cadastrante.getLotacao());
-    		doc.setTitular(cadastrante);
-    		doc.setLotaTitular(cadastrante.getLotacao());
-    		
-    		if(destinatarioStr != null) {
-    			try {
-        			destinatarioLotacao = dao().getLotacaoFromSigla(destinatarioStr);
-
-        			if(destinatarioLotacao != null)
-        				doc.setLotaDestinatario(destinatarioLotacao);
-				} catch (Exception e) {
+
+	public String criarDocumento(String cadastranteStr, String subscritorStr, String destinatarioStr,
+			String destinatarioCampoExtraStr, String descricaoTipoDeDocumento, String nomeForma, String nomeModelo,
+			String classificacaoStr, String descricaoStr, Boolean eletronico, String nomeNivelDeAcesso, String conteudo,
+			String siglaMobilPai, Boolean finalizar) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				DpPessoa cadastrante = null;
+				DpPessoa subscritor = null;
+				ExModelo modelo = null;
+				ExFormaDocumento forma = null;
+				ExTipoDocumento tipoDocumento = null;
+				ExClassificacao classificacao = null;
+				ExNivelAcesso nivelDeAcesso = null;
+				DpLotacao destinatarioLotacao = null;
+				DpPessoa destinatarioPessoa = null;
+				CpOrgao destinatarioOrgaoExterno = null;
+
+				ExDocumento doc = new ExDocumento();
+
+				if (cadastranteStr == null || cadastranteStr.isEmpty())
+					throw new AplicacaoException("A matrícula do cadastrante não foi informada.");
+
+				if (subscritorStr == null || subscritorStr.isEmpty())
+					throw new AplicacaoException("A matrícula do subscritor não foi informada.");
+
+				cadastrante = dao().getPessoaFromSigla(cadastranteStr);
+
+				if (cadastrante == null)
+					throw new AplicacaoException(
+							"Não foi possível encontrar um cadastrante com a matrícula informada.");
+
+				if (cadastrante.isFechada())
+					throw new AplicacaoException("O cadastrante não está mais ativo.");
+
+				subscritor = dao().getPessoaFromSigla(subscritorStr);
+
+				if (subscritor == null)
+					throw new AplicacaoException("Não foi possível encontrar um subscritor com a matrícula informada.");
+
+				if (subscritor.isFechada())
+					throw new AplicacaoException("O subscritor não está mais ativo.");
+
+				if (descricaoTipoDeDocumento == null)
+					tipoDocumento = (dao().consultar(ExTipoDocumento.TIPO_DOCUMENTO_INTERNO, ExTipoDocumento.class,
+							false));
+				else
+					tipoDocumento = dao().consultarExTipoDocumento(descricaoTipoDeDocumento);
+
+				if (tipoDocumento == null)
+					throw new AplicacaoException(
+							"Não foi possível encontrar o Tipo de Documento. Os Tipos de Documentos aceitos são: 1-Interno Produzido, 2-Interno Importado, 3-Externo");
+
+				if (nomeForma == null)
+					throw new AplicacaoException("O Tipo não foi informado.");
+
+				if (nomeModelo == null)
+					throw new AplicacaoException("O modelo não foi informado.");
+
+				modelo = dao().consultarExModelo(nomeForma, nomeModelo);
+
+				if (modelo == null)
+					throw new AplicacaoException("Não foi possível encontrar um modelo com os dados informados.");
+				else
+					modelo = modelo.getModeloAtual();
+
+				forma = modelo.getExFormaDocumento();
+
+				if (!forma.podeSerDoTipo(tipoDocumento))
+					throw new AplicacaoException("O documento do tipo " + forma.getDescricao() + " não pode ser "
+							+ tipoDocumento.getDescricao());
+
+				if ((classificacaoStr == null || classificacaoStr.isEmpty()) && !modelo.isClassificacaoAutomatica())
+					throw new AplicacaoException("A Classificação não foi informada.");
+
+				if (modelo.isClassificacaoAutomatica())
+					classificacao = modelo.getExClassificacao();
+				else
+					classificacao = dao().consultarExClassificacao(classificacaoStr);
+
+				if (classificacao == null)
+					throw new AplicacaoException(
+							"Não foi possível encontrar uma classificação com o código informado.");
+				else
+					classificacao = classificacao.getClassificacaoAtual();
+
+				if (eletronico == null)
+					eletronico = true;
+
+				Long idSit = Ex
+						.getInstance().getConf().buscaSituacao(modelo, tipoDocumento, cadastrante,
+								cadastrante.getLotacao(), CpTipoConfiguracao.TIPO_CONFIG_ELETRONICO)
+						.getIdSitConfiguracao();
+
+				if (idSit == ExSituacaoConfiguracao.SITUACAO_OBRIGATORIO) {
+					eletronico = true;
+				} else if (idSit == ExSituacaoConfiguracao.SITUACAO_PROIBIDO) {
+					eletronico = false;
+				}
+
+				if (nomeNivelDeAcesso == null) {
+
+					Date dt = ExDao.getInstance().consultarDataEHoraDoServidor();
+
+					ExConfiguracao config = new ExConfiguracao();
+					CpTipoConfiguracao exTpConfig = new CpTipoConfiguracao();
+					CpSituacaoConfiguracao exStConfig = new CpSituacaoConfiguracao();
+					config.setDpPessoa(cadastrante);
+					config.setLotacao(cadastrante.getLotacao());
+					config.setExTipoDocumento(tipoDocumento);
+					config.setExFormaDocumento(forma);
+					config.setExModelo(modelo);
+					config.setExClassificacao(classificacao);
+					exTpConfig.setIdTpConfiguracao(CpTipoConfiguracao.TIPO_CONFIG_NIVELACESSO);
+					config.setCpTipoConfiguracao(exTpConfig);
+					exStConfig.setIdSitConfiguracao(CpSituacaoConfiguracao.SITUACAO_DEFAULT);
+					config.setCpSituacaoConfiguracao(exStConfig);
+
+					ExConfiguracao exConfig = ((ExConfiguracao) Ex.getInstance().getConf().buscaConfiguracao(config,
+							new int[] { ExConfiguracaoBL.NIVEL_ACESSO }, dt));
+
+					if (exConfig != null)
+						nivelDeAcesso = exConfig.getExNivelAcesso();
+				} else {
+					nivelDeAcesso = dao().consultarExNidelAcesso(nomeNivelDeAcesso);
+				}
+
+				if (nivelDeAcesso == null)
+					nivelDeAcesso = dao().consultar(6L, ExNivelAcesso.class, false);
+
+				List<ExNivelAcesso> listaNiveis = ExDao.getInstance().listarOrdemNivel();
+				ArrayList<ExNivelAcesso> niveisFinal = new ArrayList<ExNivelAcesso>();
+				Date dt = ExDao.getInstance().consultarDataEHoraDoServidor();
+
+				ExConfiguracao config = new ExConfiguracao();
+				CpTipoConfiguracao exTpConfig = new CpTipoConfiguracao();
+				config.setDpPessoa(cadastrante);
+				config.setLotacao(cadastrante.getLotacao());
+				config.setExTipoDocumento(tipoDocumento);
+				config.setExFormaDocumento(forma);
+				config.setExModelo(modelo);
+				config.setExClassificacao(classificacao);
+				exTpConfig.setIdTpConfiguracao(CpTipoConfiguracao.TIPO_CONFIG_NIVEL_ACESSO_MINIMO);
+				config.setCpTipoConfiguracao(exTpConfig);
+				int nivelMinimo = ((ExConfiguracao) Ex.getInstance().getConf().buscaConfiguracao(config,
+						new int[] { ExConfiguracaoBL.NIVEL_ACESSO }, dt)).getExNivelAcesso().getGrauNivelAcesso();
+				exTpConfig.setIdTpConfiguracao(CpTipoConfiguracao.TIPO_CONFIG_NIVEL_ACESSO_MAXIMO);
+				config.setCpTipoConfiguracao(exTpConfig);
+				int nivelMaximo = ((ExConfiguracao) Ex.getInstance().getConf().buscaConfiguracao(config,
+						new int[] { ExConfiguracaoBL.NIVEL_ACESSO }, dt)).getExNivelAcesso().getGrauNivelAcesso();
+
+				for (ExNivelAcesso nivelAcesso : listaNiveis) {
+					if (nivelAcesso.getGrauNivelAcesso() >= nivelMinimo
+							&& nivelAcesso.getGrauNivelAcesso() <= nivelMaximo)
+						niveisFinal.add(nivelAcesso);
+				}
+
+				if (niveisFinal != null && !niveisFinal.isEmpty() & !niveisFinal.contains(nivelDeAcesso))
+					nivelDeAcesso = niveisFinal.get(0);
+
+				doc.setCadastrante(cadastrante);
+				doc.setLotaCadastrante(cadastrante.getLotacao());
+				doc.setTitular(cadastrante);
+				doc.setLotaTitular(cadastrante.getLotacao());
+
+				if (destinatarioStr != null) {
+					try {
+						destinatarioLotacao = dao().getLotacaoFromSigla(destinatarioStr);
+
+						if (destinatarioLotacao != null)
+							doc.setLotaDestinatario(destinatarioLotacao);
+					} catch (Exception e) {
+					}
+				}
+
+				if (destinatarioStr != null && destinatarioLotacao == null) {
+					try {
+						destinatarioPessoa = dao().getPessoaFromSigla(destinatarioStr);
+
+						if (destinatarioPessoa != null)
+							doc.setDestinatario(destinatarioPessoa);
+					} catch (Exception e) {
+					}
 				}
-    		}
-    		
-    		if(destinatarioStr != null && destinatarioLotacao == null) {
-    			try {
-        			destinatarioPessoa = dao().getPessoaFromSigla(destinatarioStr);
-        			
-        			if(destinatarioPessoa != null)
-        				doc.setDestinatario(destinatarioPessoa);
-				} catch (Exception e) {
+
+				if (destinatarioStr != null && destinatarioLotacao == null && destinatarioPessoa == null) {
+					try {
+						destinatarioOrgaoExterno = dao().getOrgaoFromSiglaExata(destinatarioStr);
+
+						if (destinatarioOrgaoExterno != null) {
+							doc.setOrgaoExternoDestinatario(destinatarioOrgaoExterno);
+							doc.setNmOrgaoExterno(destinatarioCampoExtraStr);
+						}
+					} catch (Exception e) {
+					}
 				}
-    		}
-    		
-    		if(destinatarioStr != null && destinatarioLotacao == null && destinatarioPessoa == null) {
-    			try {
-        			destinatarioOrgaoExterno = dao().getOrgaoFromSiglaExata(destinatarioStr);
-        			
-        			if(destinatarioOrgaoExterno != null) {
-        				doc.setOrgaoExternoDestinatario(destinatarioOrgaoExterno);
-        				doc.setNmOrgaoExterno(destinatarioCampoExtraStr);
-        			}
-				} catch (Exception e) {
+
+				if (destinatarioStr != null && destinatarioLotacao == null && destinatarioPessoa == null
+						&& destinatarioOrgaoExterno == null) {
+					doc.setNmDestinatario(destinatarioStr);
+				}
+
+				doc.setSubscritor(subscritor);
+				doc.setLotaSubscritor(subscritor.getLotacao());
+				doc.setOrgaoUsuario(subscritor.getOrgaoUsuario());
+				doc.setExTipoDocumento(tipoDocumento);
+				doc.setExFormaDocumento(forma);
+				doc.setExModelo(modelo);
+
+				if (!modelo.isDescricaoAutomatica())
+					doc.setDescrDocumento(descricaoStr);
+
+				doc.setExClassificacao(classificacao);
+				if (eletronico)
+					doc.setFgEletronico("S");
+				else
+					doc.setFgEletronico("N");
+
+				doc.setExNivelAcesso(nivelDeAcesso);
+
+				ExMobil mob = new ExMobil();
+				mob.setExTipoMobil(dao().consultar(ExTipoMobil.TIPO_MOBIL_GERAL, ExTipoMobil.class, false));
+				mob.setNumSequencia(1);
+				mob.setExMovimentacaoSet(new TreeSet<ExMovimentacao>());
+				mob.setExDocumento(doc);
+
+				if (siglaMobilPai != null && !siglaMobilPai.isEmpty()) {
+					final ExMobilDaoFiltro filter = new ExMobilDaoFiltro();
+					filter.setSigla(siglaMobilPai);
+					ExMobil mobPai = (ExMobil) dao().consultarPorSigla(filter);
+					if (mobPai != null) {
+						ExDocumento docPai = mobPai.getExDocumento();
+
+						if (docPai.getExMobilPai() != null)
+							throw new AplicacaoException("Não foi possível criar o documento pois o documento pai ("
+									+ docPai.getSigla() + ") já é documento filho.");
+
+						if (docPai.isPendenteDeAssinatura())
+							throw new AplicacaoException("Não foi possível criar o documento pois o documento pai ("
+									+ docPai.getSigla() + ") ainda não foi assinado.");
+
+						doc.setExMobilPai(mobPai);
+					}
+				}
+
+				doc.setExMobilSet(new TreeSet<ExMobil>());
+				doc.getExMobilSet().add(mob);
+
+				if (conteudo == null)
+					conteudo = "";
+				try (ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
+					baos.write(conteudo.getBytes());
+
+					doc.setConteudoTpDoc("application/zip");
+					doc.setConteudoBlobForm(baos.toByteArray());
 				}
-    		}
-    		
-    		if(destinatarioStr != null && destinatarioLotacao == null && destinatarioPessoa == null && destinatarioOrgaoExterno == null) {
-    			doc.setNmDestinatario(destinatarioStr);
-    		}
-    		
-    		doc.setSubscritor(subscritor);
-    		doc.setLotaSubscritor(subscritor.getLotacao());
-    		doc.setOrgaoUsuario(subscritor.getOrgaoUsuario());
-    		doc.setExTipoDocumento(tipoDocumento);
-    		doc.setExFormaDocumento(forma);
-    		doc.setExModelo(modelo);
-    		
-    		if(!modelo.isDescricaoAutomatica())
-    			doc.setDescrDocumento(descricaoStr);
-    		
-    		doc.setExClassificacao(classificacao);
-    		if(eletronico)
-    			doc.setFgEletronico("S");
-    		else
-    			doc.setFgEletronico("N");
-    			
-    		doc.setExNivelAcesso(nivelDeAcesso);
-    		
-    		ExMobil mob = new ExMobil();
-			mob.setExTipoMobil(dao().consultar(ExTipoMobil.TIPO_MOBIL_GERAL,
-					ExTipoMobil.class, false));
-			mob.setNumSequencia(1);
-			mob.setExMovimentacaoSet(new TreeSet<ExMovimentacao>());
-			mob.setExDocumento(doc);
-			
-    		if(siglaMobilPai != null && !siglaMobilPai.isEmpty()) {
-    			final ExMobilDaoFiltro filter = new ExMobilDaoFiltro();
-    			filter.setSigla(siglaMobilPai);
-    			ExMobil mobPai = (ExMobil) dao().consultarPorSigla(filter);
-    			if (mobPai != null) {
-    	    		ExDocumento docPai = mobPai.getExDocumento();
-    				
-    				if(docPai.getExMobilPai() != null)
-    					throw new AplicacaoException("Não foi possível criar o documento pois o documento pai (" + docPai.getSigla() + ") já é documento filho.");
-    				
-    				if(docPai.isPendenteDeAssinatura())
-    					throw new AplicacaoException("Não foi possível criar o documento pois o documento pai (" + docPai.getSigla() + ") ainda não foi assinado.");
-    				
-    				doc.setExMobilPai(mobPai);
-    			}
-    		}
-			
-			doc.setExMobilSet(new TreeSet<ExMobil>());
-			doc.getExMobilSet().add(mob);
-			
-			if (conteudo == null)
-				conteudo = "";
-			try (ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
-				baos.write(conteudo.getBytes());
-			
-				doc.setConteudoTpDoc("application/zip");
-				doc.setConteudoBlobForm(baos.toByteArray());
+
+				ServletContext servletContext = (ServletContext) context.getMessageContext()
+						.get(MessageContext.SERVLET_CONTEXT);
+
+				doc = Ex.getInstance().getBL().gravar(cadastrante, cadastrante, cadastrante.getLotacao(), doc);
+
+				if (finalizar)
+					Ex.getInstance().getBL().finalizar(cadastrante, cadastrante.getLotacao(), doc);
+
+				return doc.getSigla();
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
 			}
-			
-			ServletContext servletContext =
-				    (ServletContext) context.getMessageContext().get(MessageContext.SERVLET_CONTEXT);
-			
-    		doc = Ex.getInstance()
-			       .getBL().gravar(cadastrante, cadastrante, cadastrante.getLotacao(), doc);
-    		
-    		if(finalizar)
-    			Ex.getInstance().getBL().finalizar(cadastrante, cadastrante.getLotacao(), doc);
-
-    		return doc.getSigla();
-		} catch (Exception e) {
-			throw e;
-		}	
-    }
+		}
+	}
 
+	public String cadastrante(String codigoDocumentoVia) throws Exception {
+		try (SoapContext ctx = new SoapContext(false)) {
+			ExMobil mob = buscarMobil(codigoDocumentoVia);
+			return SiglaParser.makeSigla(mob.doc().getCadastrante(), mob.doc().getLotaCadastrante());
+		}
+	}
+
+	public String titular(String codigoDocumentoVia) throws Exception {
+		try (SoapContext ctx = new SoapContext(false)) {
+			ExMobil mob = buscarMobil(codigoDocumentoVia);
+			return SiglaParser.makeSigla(mob.doc().getTitular(), mob.doc().getLotaTitular());
+		}
+	}
+
+	public String subscritor(String codigoDocumentoVia) throws Exception {
+		try (SoapContext ctx = new SoapContext(false)) {
+			ExMobil mob = buscarMobil(codigoDocumentoVia);
+			return SiglaParser.makeSigla(mob.doc().getSubscritor(), mob.doc().getLotaSubscritor());
+		}
+	}
+
+	public String destinatario(String codigoDocumentoVia) throws Exception {
+		try (SoapContext ctx = new SoapContext(false)) {
+			ExMobil mob = buscarMobil(codigoDocumentoVia);
+			return SiglaParser.makeSigla(mob.doc().getDestinatario(), mob.doc().getLotaDestinatario());
+		}
+	}
+
+	public String gestor(String codigoDocumentoVia) throws Exception {
+		return obterPrimeiroResponsavelPorIdPapel(codigoDocumentoVia, ExPapel.PAPEL_GESTOR);
+	}
+
+	public String fiscalTecnico(String codigoDocumentoVia) throws Exception {
+		return obterPrimeiroResponsavelPorIdPapel(codigoDocumentoVia, ExPapel.PAPEL_FISCAL_TECNICO);
+	}
+
+	public String fiscalAdministrativo(String codigoDocumentoVia) throws Exception {
+		return obterPrimeiroResponsavelPorIdPapel(codigoDocumentoVia, ExPapel.PAPEL_FISCAL_ADMINISTRATIVO);
+	}
+
+	public String interessado(String codigoDocumentoVia) throws Exception {
+		return obterPrimeiroResponsavelPorIdPapel(codigoDocumentoVia, ExPapel.PAPEL_INTERESSADO);
+	}
+
+	public String autorizador(String codigoDocumentoVia) throws Exception {
+		return obterPrimeiroResponsavelPorIdPapel(codigoDocumentoVia, ExPapel.PAPEL_AUTORIZADOR);
+	}
+
+	public String revisor(String codigoDocumentoVia) throws Exception {
+		return obterPrimeiroResponsavelPorIdPapel(codigoDocumentoVia, ExPapel.PAPEL_REVISOR);
+	}
+
+	public String liquidante(String codigoDocumentoVia) throws Exception {
+		return obterPrimeiroResponsavelPorIdPapel(codigoDocumentoVia, ExPapel.PAPEL_LIQUIDANTE);
+	}
+
+	private String obterPrimeiroResponsavelPorIdPapel(String codigoDocumentoVia, long papel)
+			throws Exception, IllegalAccessException, InvocationTargetException, NoSuchMethodException, IOException {
+		try (SoapContext ctx = new SoapContext(false)) {
+			ExMobil mob = buscarMobil(codigoDocumentoVia);
+			List<DpResponsavel> l = mob.doc().getResponsaveisPorPapel(dao().consultar(papel, ExPapel.class, false));
+			if (l == null || l.size() == 0)
+				return null;
+			DpResponsavel r = l.get(0);
+			return r.getSiglaDePessoaEOuLotacao();
+		}
+	}
+
+	public Boolean isModeloIncluso(String codigoDocumento, Long idModelo) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				ExMobil mob = buscarMobil(codigoDocumento);
+				if (mob.isGeral())
+					mob = mob.getDoc().getPrimeiroMobil();
+				return mob.isModeloIncluso(idModelo);
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
+		}
+	}
 }
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/servlet/ExServlet.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/servlet/ExServlet.java
new file mode 100644
index 0000000000..86d2a4f29d
--- /dev/null
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/servlet/ExServlet.java
@@ -0,0 +1,15 @@
+package br.gov.jfrj.siga.ex.servlet;
+
+import javax.servlet.ServletConfig;
+import javax.servlet.ServletException;
+
+import com.crivano.swaggerservlet.SwaggerServlet;
+
+public class ExServlet extends SwaggerServlet {
+	private static final long serialVersionUID = 1756711359239182178L;
+
+	@Override
+	public void initialize(ServletConfig config) throws ServletException {
+		super.setActionPackage("br.gov.jfrj.siga.servlet");
+	}
+}
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/XjusRecordServlet.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/XjusRecordServlet.java
index e76c64430d..1518a724b7 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/XjusRecordServlet.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/XjusRecordServlet.java
@@ -17,9 +17,7 @@ public class XjusRecordServlet extends SwaggerServlet {
 	private static final long serialVersionUID = 1756711359239182178L;
 
 	@Override
-	public void init(ServletConfig config) throws ServletException {
-		super.init(config);
-
+	public void initialize(ServletConfig config) throws ServletException {
 		super.setAPI(IXjusRecordAPI.class);
 
 		super.setActionPackage("br.gov.jfrj.siga.ex.xjus");
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/doc/XjusDocRecordServlet.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/doc/XjusDocRecordServlet.java
index 2215651f1a..182603862c 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/doc/XjusDocRecordServlet.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/doc/XjusDocRecordServlet.java
@@ -17,9 +17,7 @@ public class XjusDocRecordServlet extends SwaggerServlet {
 	private static final long serialVersionUID = 1756711359239182178L;
 
 	@Override
-	public void init(ServletConfig config) throws ServletException {
-		super.init(config);
-
+	public void initialize(ServletConfig config) throws ServletException {
 		super.setAPI(IXjusRecordAPI.class);
 
 		super.setActionPackage("br.gov.jfrj.siga.ex.xjus.doc");
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/mov/XjusMovRecordServlet.java b/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/mov/XjusMovRecordServlet.java
index 03835110d6..50c9fd9619 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/mov/XjusMovRecordServlet.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/ex/xjus/mov/XjusMovRecordServlet.java
@@ -17,9 +17,7 @@ public class XjusMovRecordServlet extends SwaggerServlet {
 	private static final long serialVersionUID = 1756711359239182178L;
 
 	@Override
-	public void init(ServletConfig config) throws ServletException {
-		super.init(config);
-
+	public void initialize(ServletConfig config) throws ServletException {
 		super.setAPI(IXjusRecordAPI.class);
 
 		super.setActionPackage("br.gov.jfrj.siga.ex.xjus.mov");
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExAutenticacaoController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExAutenticacaoController.java
index e91ac9946c..f7ec7639d8 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExAutenticacaoController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExAutenticacaoController.java
@@ -1,6 +1,7 @@
 package br.gov.jfrj.siga.vraptor;
 
 import java.io.ByteArrayInputStream;
+import java.nio.charset.StandardCharsets;
 import java.util.Date;
 import java.util.HashMap;
 import java.util.Map;
@@ -179,17 +180,32 @@ public class ExAutenticacaoController extends ExController {
 
 		ExArquivo arq = Ex.getInstance().getBL().buscarPorNumeroAssinatura(n);
 
-		byte[] bytes;
-		String fileName;
-		String contentType;
+		byte[] bytes = null;
+		String fileName = null;
+		String contentType = null;
 		if (idMov != null && idMov != 0) {
 			ExMovimentacao mov = dao().consultar(idMov, ExMovimentacao.class,
 					false);
+			
+			switch ( mov.getExTipoMovimentacao().getId().intValue()) {
+			case (int) ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_COM_SENHA:
+			case (int) ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_MOVIMENTACAO_COM_SENHA:
+				fileName = arq.getReferencia() + "_" + mov.getIdMov() + ".jwt";
+				contentType = "application/jwt";
+				if (mov.getAuditHash() == null)
+					throw new AplicacaoException(
+							"Esta é uma assinatura digital como login e senha e não há nenhum artefato comprobatório disponível para download.");
+				bytes = mov.getAuditHash().getBytes(StandardCharsets.UTF_8);
+				break;
+				
+			case (int) ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_DIGITAL_DOCUMENTO:
+			case (int) ExTipoMovimentacao.TIPO_MOVIMENTACAO_ASSINATURA_DIGITAL_MOVIMENTACAO:
+				fileName = arq.getReferencia() + "_" + mov.getIdMov() + ".p7s";
+				contentType = mov.getConteudoTpMov();
+				bytes = mov.getConteudoBlobMov2();
+				break;
+			}
 
-			fileName = arq.getReferencia() + "_" + mov.getIdMov() + ".p7s";
-			contentType = mov.getConteudoTpMov();
-
-			bytes = mov.getConteudoBlobMov2();
 
 		} else {
 			fileName = arq.getReferenciaPDF();
@@ -200,6 +216,7 @@ public class ExAutenticacaoController extends ExController {
 			else
 				bytes = arq.getPdf();
 		}
+		
 		if (bytes == null) {
 			throw new AplicacaoException(
 					"Arquivo não encontrado para Download.");
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExClassificacaoController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExClassificacaoController.java
index 085ac4a9c6..e922af9c38 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExClassificacaoController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExClassificacaoController.java
@@ -41,6 +41,7 @@ import br.com.caelum.vraptor.Result;
 import br.com.caelum.vraptor.view.Results;
 import br.gov.jfrj.siga.base.AplicacaoException;
 import br.gov.jfrj.siga.base.Texto;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.ex.ExClassificacao;
 import br.gov.jfrj.siga.ex.ExTemporalidade;
 import br.gov.jfrj.siga.ex.ExTipoDestinacao;
@@ -154,15 +155,10 @@ public class ExClassificacaoController
 	}
 
 	@Get("app/expediente/classificacao/editar")
-	public ExClassificacao edita(ExClassificacao exClassificacao,
+	public ExClassificacao edita(
 			String codificacao, String acao) throws Exception {
 		assertAcesso(ACESSO_SIGA_DOC_FE_PC);
-		ExClassificacao exClass = null;
-		if (codificacao != null && exClassificacao == null) {
-			exClass = buscarExClassificacao(codificacao);
-		} else {
-			exClass = exClassificacao;
-		}
+		ExClassificacao exClass = buscarExClassificacao(codificacao);
 
 		if (exClass == null && !acao.equals("nova_classificacao")) {
 			throw new AplicacaoException(
@@ -170,6 +166,7 @@ public class ExClassificacaoController
 							+ codificacao);
 		}
 
+		result.include("exClassificacao", exClass);
 		result.include("listaExTipoDestinacao", getListaExTipoDestinacao());
 		result.include("listaExTemporalidade", getListaExTemporalidade());
 		result.include("idTpDestinacao", -1);
@@ -193,8 +190,8 @@ public class ExClassificacaoController
 			String codificacaoAntiga, String acao) throws Exception {
 		assertAcesso(ACESSO_SIGA_DOC_FE_PC);
 
-		if (exClassificacao.getCodificacao().length() == 0
-				|| exClassificacao.getDescrClassificacao().length() == 0) {
+		if (Utils.empty(exClassificacao.getCodificacao())
+				|| Utils.empty(exClassificacao.getDescrClassificacao())) {
 			throw new AplicacaoException(
 					"Preencha o código da classificação e a descrição!");
 		}
@@ -209,15 +206,7 @@ public class ExClassificacaoController
 			}
 		}
 
-		dao().iniciarTransacao();
 		try {
-
-			if (exClassificacao.getCodificacao().length() == 0
-					|| exClassificacao.getDescrClassificacao().length() == 0) {
-				throw new AplicacaoException(
-						"Preencha o código da classificação e a descrição!");
-			}
-
 			if (acao.equals("nova_classificacao")) {
 				Ex.getInstance()
 						.getBL()
@@ -257,16 +246,13 @@ public class ExClassificacaoController
 
 			}
 
-			dao().commitTransacao();
 			setMensagem("Classificação salva!");
 			result.redirectTo("editar?codificacao="
 					+ exClassificacao.getCodificacao()
 					+ "&acao=editar_classificacao");
 		} catch (Exception e) {
-			dao().rollbackTransacao();
-			throw new AplicacaoException(
-					"Não foi possível gravar classificação no banco de dados."
-							+ e.getMessage());
+			throw new Exception(
+					"Não foi possível gravar classificação no banco de dados.", e);
 		}
 	}
 
@@ -274,18 +260,15 @@ public class ExClassificacaoController
 	@Get("app/expediente/classificacao/excluir")
 	public void excluir(String codificacao) throws Exception {
 		assertAcesso(ACESSO_SIGA_DOC_FE_PC);
-		dao().iniciarTransacao();
 		try {
 			ExClassificacao exClass;
 			exClass = buscarExClassificacao(codificacao);
 			Ex.getInstance()
 					.getBL()
 					.excluirExClassificacao(exClass, getIdentidadeCadastrante());
-			dao().commitTransacao();
 			result.redirectTo(this).lista();
 		} catch (Exception e) {
-			dao().rollbackTransacao();
-			throw new AplicacaoException(
+			throw new Exception(
 					"Não foi possível excluir classificação do banco de dados."
 							+ e.getMessage());
 		}
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExConfiguracaoController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExConfiguracaoController.java
index 5bd0e0a8c2..7fc562d3f4 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExConfiguracaoController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExConfiguracaoController.java
@@ -422,7 +422,7 @@ public class ExConfiguracaoController extends ExController {
 	private Map<Integer, String> getListaTipoPublicador() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, SigaMessages.getMessage("usuario.matricula"));
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		return map;
 	}
 
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExController.java
index 9fe248b1bb..2c5319285f 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExController.java
@@ -74,7 +74,6 @@ public class ExController extends SigaController {
 		super(request, result, dao, so, em);
 		this.response = response;
 		this.context = context;
-		result.on(Exception.class).forwardTo("WEB-INF/page/erroGeral.jsp");
 	}
 
 	protected void verificaNivelAcesso(ExMobil mob) {
@@ -243,7 +242,7 @@ public class ExController extends SigaController {
 	protected Map<Integer, String> getListaTipoResp() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, SigaMessages.getMessage("usuario.matricula"));
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		return map;
 	}
 
@@ -260,7 +259,7 @@ public class ExController extends SigaController {
 		super.assertAcesso("DOC:Módulo de Documentos;" + pathServico);
 	}
 
-	protected  HttpServletResponse getResponse() {
+	public  HttpServletResponse getResponse() {
 		return response;
 	}
 
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoController.java
index bd10b40040..8543e7695e 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoController.java
@@ -69,6 +69,7 @@ import br.com.caelum.vraptor.observer.upload.UploadedFile;
 import br.com.caelum.vraptor.view.Results;
 import br.gov.jfrj.siga.base.AplicacaoException;
 import br.gov.jfrj.siga.base.Data;
+import br.gov.jfrj.siga.cp.CpModelo;
 import br.gov.jfrj.siga.cp.CpTipoConfiguracao;
 import br.gov.jfrj.siga.cp.model.DpPessoaSelecao;
 import br.gov.jfrj.siga.dp.CpOrgao;
@@ -94,7 +95,6 @@ import br.gov.jfrj.siga.ex.vo.ExDocumentoVO;
 import br.gov.jfrj.siga.hibernate.ExDao;
 import br.gov.jfrj.siga.model.ContextoPersistencia;
 import br.gov.jfrj.siga.model.Selecao;
-import br.gov.jfrj.siga.model.dao.ModeloDao;
 import br.gov.jfrj.siga.persistencia.ExMobilDaoFiltro;
 import br.gov.jfrj.siga.util.ListaHierarquica;
 import br.gov.jfrj.siga.util.ListaHierarquicaItem;
@@ -380,7 +380,7 @@ public class ExDocumentoController extends ExController {
 				exDocumentoDTO.getMobilPaiSel(),
 				exDocumentoDTO.isCriandoAnexo(), exDocumentoDTO.getAutuando(),
 				exDocumentoDTO.getIdMobilAutuado(),
-				exDocumentoDTO.getCriandoSubprocesso(), null);
+				exDocumentoDTO.getCriandoSubprocesso(), null, null);
 	}
 
 	@Transacional
@@ -443,6 +443,7 @@ public class ExDocumentoController extends ExController {
 						exDocumentoDTO.getAutuando(),
 						exDocumentoDTO.getIdMobilAutuado(),
 						exDocumentoDTO.getCriandoSubprocesso(),
+						null,
 						jsonHierarquiaDeModelos);
 		return exDocumentoDTO;
 	}
@@ -453,7 +454,7 @@ public class ExDocumentoController extends ExController {
 			final String sigla, String[] vars,
 			final ExMobilSelecao mobilPaiSel, final Boolean criandoAnexo,
 			final Boolean autuando, final Long idMobilAutuado,
-			final Boolean criandoSubprocesso, String jsonHierarquiaDeModelos)
+			final Boolean criandoSubprocesso, String modelo, String jsonHierarquiaDeModelos)
 			throws IOException, IllegalAccessException,
 			InvocationTargetException {
 		assertAcesso("");
@@ -461,6 +462,10 @@ public class ExDocumentoController extends ExController {
 		final boolean isDocNovo = (exDocumentoDTO == null || exDocumentoDTO
 				.getSigla() == null);
 		boolean postback = param("postback") != null;
+		
+		boolean isPaiEletronico = false;
+		boolean hasPai = false;
+		
 		if (isDocNovo) {
 			if (!postback)
 				exDocumentoDTO = new ExDocumentoDTO();
@@ -496,12 +501,30 @@ public class ExDocumentoController extends ExController {
 
 			if (exDocumentoDTO.getIdMod() == null) {
 				final List<ExModelo> modelos = getModelos(exDocumentoDTO);
-
+				
 				ExModelo modeloDefault = null;
-				for (ExModelo mod : exDocumentoDTO.getModelos()) {
-					if ("Memorando".equals(mod.getNmMod())) {
-						modeloDefault = mod;
-						break;
+				
+				if (modelo != null) {
+					if (modelo.matches("\\d+")) {
+						ExModelo mod = dao().consultar(Long.parseLong(modelo), ExModelo.class, false);
+						mod = mod.getModeloAtual();
+						modelo = mod.getNmMod();
+					}
+						
+					for (ExModelo mod : exDocumentoDTO.getModelos()) {
+						if (modelo.equals(mod.getNmMod())) {
+							modeloDefault = mod;
+							break;
+						}
+					}
+				}
+
+				if (modeloDefault == null) {
+					for (ExModelo mod : exDocumentoDTO.getModelos()) {
+						if ("Memorando".equals(mod.getNmMod())) {
+							modeloDefault = mod;
+							break;
+						}
 					}
 				}
 
@@ -536,13 +559,18 @@ public class ExDocumentoController extends ExController {
 					exDocumentoDTO.setNivelAcesso(nivelDefault
 							.getIdNivelAcesso());
 				} else {
-					exDocumentoDTO.setNivelAcesso(ExNivelAcesso.ID_PUBLICO);
+					if ( Boolean.valueOf(System.getProperty("siga.doc.acesso.limitado"))) {
+						exDocumentoDTO.setNivelAcesso(ExNivelAcesso.ID_LIMITADO_AO_ORGAO);
+					} else {
+						exDocumentoDTO.setNivelAcesso(ExNivelAcesso.ID_PUBLICO);
+					}
 				}
 			}
+
 		}
 
 		if (exDocumentoDTO.isCriandoAnexo() && exDocumentoDTO.getId() == null
-				&& isDocNovo && !postback) {
+				&& isDocNovo && !postback && modelo == null) {
 			ExModelo despacho = dao().consultarExModelo(null, "Despacho");
 			if (despacho == null)
 				throw new RuntimeException(
@@ -550,6 +578,7 @@ public class ExDocumentoController extends ExController {
 			exDocumentoDTO.setIdMod(despacho.getId());
 		}
 
+
 		if (exDocumentoDTO.getId() == null && exDocumentoDTO.getDoc() != null)
 			exDocumentoDTO.setId(exDocumentoDTO.getDoc().getIdDoc());
 
@@ -590,6 +619,11 @@ public class ExDocumentoController extends ExController {
 		}
 		carregarBeans(exDocumentoDTO, mobilPaiSel);
 
+		if (exDocumentoDTO.getMobilPaiSel().getId() != null) {
+			hasPai = true;
+			isPaiEletronico = exDocumentoDTO.getMobilPaiSel().buscarObjeto().doc().isEletronico();
+		}
+
 		final Long idSit = Ex
 				.getInstance()
 				.getConf()
@@ -719,7 +753,7 @@ public class ExDocumentoController extends ExController {
 				.getComp()
 				.podeEditarDescricao(getTitular(), getLotaTitular(),
 						exDocumentoDTO.getModelo());
-
+						
 		List<String> l = new ArrayList<String>();
 		for (String p : exDocumentoDTO.getParamsEntrevista().keySet()) {
 			result.include(p, exDocumentoDTO.getParamsEntrevista().get(p));
@@ -770,6 +804,8 @@ public class ExDocumentoController extends ExController {
 
 		result.include("possuiMaisQueUmModelo", cModelos > 1);
 		result.include("par", parFreeMarker);
+		result.include("hasPai", hasPai);
+		result.include("isPaiEletronico", isPaiEletronico);
 		result.include("cpOrgaoSel", exDocumentoDTO.getCpOrgaoSel());
 		result.include("mobilPaiSel", exDocumentoDTO.getMobilPaiSel());
 		result.include("subscritorSel", exDocumentoDTO.getSubscritorSel());
@@ -865,7 +901,7 @@ public class ExDocumentoController extends ExController {
 				exDocumentoDTO.getMobilPaiSel(),
 				exDocumentoDTO.isCriandoAnexo(), exDocumentoDTO.getAutuando(),
 				exDocumentoDTO.getIdMobilAutuado(),
-				exDocumentoDTO.getCriandoSubprocesso(), null);
+				exDocumentoDTO.getCriandoSubprocesso(), null, null);
 	}
 
 	@SuppressWarnings("static-access")
@@ -1353,6 +1389,7 @@ public class ExDocumentoController extends ExController {
 						exDocumentoDTO.getAutuando(),
 						exDocumentoDTO.getIdMobilAutuado(),
 						exDocumentoDTO.getCriandoSubprocesso(),
+						null,
 						jsonHierarquiaDeModelos);
 				return;
 			}
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoDTO.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoDTO.java
index d0daf60740..c8128584aa 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoDTO.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExDocumentoDTO.java
@@ -455,7 +455,7 @@ public class ExDocumentoDTO {
 	public Map<Integer, String> getListaTipoDest() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, "Usuário");
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		map.put(3, "Externo");
 		map.put(4, "Campo Livre");
 		return map;
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExEmailNotificacaoController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExEmailNotificacaoController.java
index ed1bb032d3..92df77a64e 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExEmailNotificacaoController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExEmailNotificacaoController.java
@@ -199,7 +199,7 @@ public class ExEmailNotificacaoController extends SigaController{
 	private Map<Integer, String> getListaTipoDest() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, "Usuário");
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		return map;
 	}
 	
@@ -207,7 +207,7 @@ public class ExEmailNotificacaoController extends SigaController{
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, "Default");
 		map.put(2, "Usuário");
-		map.put(3, "Órgão Integrado");		
+		map.put(3, "Lotação");		
 		map.put(4, "Email");
 		return map;
 	}
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExFormaDocumentoController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExFormaDocumentoController.java
index a1db366d38..c14af13ec6 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExFormaDocumentoController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExFormaDocumentoController.java
@@ -172,7 +172,7 @@ public class ExFormaDocumentoController extends ExController {
 		result.include("origemInternoCapturado", origemInternoCapturado);
 		result.include("origemExternoCapturado", origemExternoCapturado);
 		
-		result.redirectTo("/app/forma/editar?id=" + forma.getIdFormaDoc());
+		result.redirectTo(this).listarFormas(null);
 	}
 
 	private ExFormaDocumento recuperarForma(final Long id) {
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMobilController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMobilController.java
index 3e63a5e663..9612b51420 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMobilController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMobilController.java
@@ -643,7 +643,7 @@ public class ExMobilController extends
 	private Map<Integer, String> getListaTipoDest() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, SigaMessages.getMessage("usuario.matricula"));
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		map.put(3, "Externo");
 		map.put(4, "Campo Livre");
 		return map;
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExModeloController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExModeloController.java
index 98ecb85c8d..4024d1118d 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExModeloController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExModeloController.java
@@ -19,6 +19,7 @@ import org.kxml2.io.KXmlSerializer;
 
 import br.com.caelum.vraptor.Controller;
 import br.com.caelum.vraptor.Get;
+import br.com.caelum.vraptor.Path;
 import br.com.caelum.vraptor.Post;
 import br.com.caelum.vraptor.Result;
 import br.com.caelum.vraptor.observer.download.ByteArrayDownload;
@@ -37,6 +38,7 @@ import br.gov.jfrj.siga.ex.ExNivelAcesso;
 import br.gov.jfrj.siga.ex.bl.Ex;
 import br.gov.jfrj.siga.model.dao.DaoFiltroSelecionavel;
 import br.gov.jfrj.siga.model.dao.ModeloDao;
+import br.gov.jfrj.siga.persistencia.ExModeloDaoFiltro;
 
 @Controller
 public class ExModeloController extends ExSelecionavelController {
@@ -185,6 +187,14 @@ public class ExModeloController extends ExSelecionavelController {
 
 		result.redirectTo(ExModeloController.class).lista(null);
 	}
+	
+	
+	
+	@Get
+	@Path({"/app/modelo/buscar-json/{sigla}"})
+	public void busca(String sigla) throws Exception{
+		aBuscarJson(sigla);
+	}
 
 	@Get("app/modelo/exportar")
 	public Download exportar(HttpServletResponse response) throws Exception {
@@ -427,7 +437,9 @@ public class ExModeloController extends ExSelecionavelController {
 
 	@Override
 	protected DaoFiltroSelecionavel createDaoFiltro() {
-		return null;
+		ExModeloDaoFiltro flt = new ExModeloDaoFiltro();
+		flt.setSigla(getNome());
+		return flt;
 	}
 
 }
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMovimentacaoController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMovimentacaoController.java
index 8c206c5996..794d9ab89f 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMovimentacaoController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExMovimentacaoController.java
@@ -83,7 +83,6 @@ import br.gov.jfrj.siga.ex.util.DatasPublicacaoDJE;
 import br.gov.jfrj.siga.ex.util.PublicacaoDJEBL;
 import br.gov.jfrj.siga.ex.vo.ExMobilVO;
 import br.gov.jfrj.siga.hibernate.ExDao;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import br.gov.jfrj.siga.vraptor.builder.BuscaDocumentoBuilder;
 import br.gov.jfrj.siga.vraptor.builder.ExMovimentacaoBuilder;
 
@@ -2614,8 +2613,7 @@ public class ExMovimentacaoController extends ExController {
 	@Post("/app/expediente/mov/assinar_gravar")
 	public void aAssinarGravar(final String sigla, final Boolean copia,
 			final String atributoAssinavelDataHora, String assinaturaB64,
-			final String certificadoB64, final Boolean juntar, final Boolean tramitar) throws AplicacaoException,
-			ServletException {
+			final String certificadoB64, final Boolean juntar, final Boolean tramitar) throws Exception {
 		try {
 
 			final BuscaDocumentoBuilder builder = BuscaDocumentoBuilder
@@ -2666,7 +2664,6 @@ public class ExMovimentacaoController extends ExController {
 
 		} catch (final Exception e) {
 			httpError(e);
-			return;
 		}
 
 		httpOK();
@@ -2693,7 +2690,6 @@ public class ExMovimentacaoController extends ExController {
 							mov.getTitular(), copia, juntar, tramitar);
 		} catch (final Exception e) {
 			httpError(e);
-			return;
 		}
 
 		result.use(Results.page()).forwardTo("/WEB-INF/page/ok.jsp");
@@ -2730,7 +2726,6 @@ public class ExMovimentacaoController extends ExController {
 						tpMovAssinatura);
 		} catch (final Exception e) {
 			httpError(e);
-			return;
 		}
 
 		result.use(Results.page()).forwardTo("/WEB-INF/page/ok.jsp");
@@ -3288,7 +3283,9 @@ public class ExMovimentacaoController extends ExController {
 	}
 
 	@Transacional
-	@Post("/app/expediente/mov/desapensar_gravar")
+	@Get
+	@Post
+	@Path("/app/expediente/mov/desapensar_gravar")
 	public void aDesapensarGravar(Integer postback, String sigla,
 			String dtMovString, boolean substituicao,
 			DpPessoaSelecao titularSel, DpPessoaSelecao subscritorSel)
@@ -3807,7 +3804,7 @@ public class ExMovimentacaoController extends ExController {
 
 	protected Map<Integer, String> getListaTipoResp() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
-		map.put(1, "Órgão Integrado");
+		map.put(1, "Lotação");
 		map.put(2, SigaMessages.getMessage("usuario.matricula"));
 		map.put(3, "Externo");
 		return map;
@@ -3816,7 +3813,7 @@ public class ExMovimentacaoController extends ExController {
 	private Map<Integer, String> getListaTipoRespPerfil() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, SigaMessages.getMessage("usuario.matricula"));
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		return map;
 	}
 
@@ -4267,7 +4264,6 @@ public class ExMovimentacaoController extends ExController {
 							mov, dt, assinatura, certificado, tpMovAssinatura);
 		} catch (final Exception e) {
 			httpError(e);
-			return;
 		}
 
 		httpOK();
@@ -4277,9 +4273,15 @@ public class ExMovimentacaoController extends ExController {
 		result.use(Results.http()).body("OK").setStatusCode(200);
 	}
 
-	protected void httpError(final Exception e) {
+	protected void httpError(final Exception e) throws Exception {
 		result.use(Results.http()).body("ERRO - " + e.getMessage())
 				.setStatusCode(500);
+		try {
+			response.flushBuffer();
+		} catch (IOException e1) {
+			throw new RuntimeException(e1);
+		}
+		throw e;
 	}
 
 	@Get("/app/expediente/mov/assinado")
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExRelatorioController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExRelatorioController.java
index 4f3943c2dc..54f0523752 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExRelatorioController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExRelatorioController.java
@@ -47,6 +47,7 @@ import br.com.caelum.vraptor.Result;
 import br.com.caelum.vraptor.observer.download.Download;
 import br.com.caelum.vraptor.observer.download.InputStreamDownload;
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.cp.model.DpLotacaoSelecao;
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.dao.CpDao;
@@ -65,7 +66,6 @@ import br.gov.jfrj.siga.ex.relatorio.dinamico.relatorios.RelTipoDoc;
 import br.gov.jfrj.siga.ex.relatorio.dinamico.relatorios.RelatorioDocumentosSubordinados;
 import br.gov.jfrj.siga.ex.relatorio.dinamico.relatorios.RelatorioModelos;
 import br.gov.jfrj.siga.ex.util.MascaraUtil;
-import br.gov.jfrj.siga.model.dao.HibernateUtil;
 import net.sf.jasperreports.engine.JRException;
 import net.sf.jasperreports.engine.JasperCompileManager;
 import net.sf.jasperreports.engine.JasperExportManager;
@@ -257,6 +257,25 @@ public class ExRelatorioController extends ExController {
 
 		final Map<String, String> parametros = new HashMap<String, String>();
 		parametros.put("secaoUsuario", secaoUsuario);
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		parametros.put("orgaoUsuario", orgaoUsuario);
 		parametros.put("lotacaoTitular", lotacaoTitular);
 		parametros.put("idTit", idTit);
@@ -277,7 +296,25 @@ public class ExRelatorioController extends ExController {
 		parameters.put("secaoUsuario", param("secaoUsuario"));
 		parameters.put("dataInicio", dataInicio);
 		parameters.put("dataFim", dataFim);
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parameters.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parameters.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parameters.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parameters.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parameters.put("brasao","brasao.png");
+		} else {
+			parameters.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		if (lotacaoDestinatarioSel != null && lotacaoDestinatarioSel.getId() != null) {
 			final DpLotacao lota = dao().consultar(lotacaoDestinatarioSel.getId(), DpLotacao.class, false);
 
@@ -340,7 +377,25 @@ public class ExRelatorioController extends ExController {
 		parametros.put("idTit", getRequest().getParameter("idTit"));
 		parametros.put("link_siga", "http://" + getRequest().getServerName() + ":" + getRequest().getServerPort() + getRequest().getContextPath()
 				+ "/app/expediente/doc/exibir?sigla=");
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelatorioDocumentosSubordinados rel = new RelatorioDocumentosSubordinados(parametros);
 		rel.gerar();
 
@@ -364,7 +419,25 @@ public class ExRelatorioController extends ExController {
 		parametros.put("idTit", getRequest().getParameter("idTit"));
 		parametros.put("link_siga", "http://" + getRequest().getServerName() + ":" + getRequest().getServerPort() + getRequest().getContextPath()
 				+ "/app/expediente/doc/exibir?sigla=");
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelMovimentacaoDocSubordinados rel = new RelMovimentacaoDocSubordinados(parametros);
 		rel.gerar();
 
@@ -388,7 +461,25 @@ public class ExRelatorioController extends ExController {
 		parametros.put("idTit", getRequest().getParameter("idTit"));
 		parametros.put("link_siga", "http://" + getRequest().getServerName() + ":" + getRequest().getServerPort() + getRequest().getContextPath()
 				+ "/app/expediente/doc/exibir?sigla=");
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelDocSubordinadosCriados rel = new RelDocSubordinadosCriados(parametros);
 		rel.gerar();
 
@@ -424,7 +515,25 @@ public class ExRelatorioController extends ExController {
 		parametros.put("orgaoUsuario", getRequest().getParameter("orgaoUsuario"));
 		parametros.put("lotacaoTitular", getRequest().getParameter("lotacaoTitular"));
 		parametros.put("idTit", getRequest().getParameter("idTit"));
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelConsultaDocEntreDatas rel = new RelConsultaDocEntreDatas(parametros);
 		
 		try {
@@ -442,8 +551,8 @@ public class ExRelatorioController extends ExController {
 		assertAcesso(ACESSO_DATAS);
 
 		final SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy");
-		final Date dtIni = df.parse(getRequest().getParameter("dataInicial"));
-		final Date dtFim = df.parse(getRequest().getParameter("dataFinal"));
+		final Date dtIni = parseDate("dataInicial");
+		final Date dtFim = parseDate("dataFinal");
 		if (dtFim.getTime() - dtIni.getTime() > 31536000000L) {
 			throw new Exception("O relatório retornará muitos resultados. Favor reduzir o intervalo entre as datas.");
 		}
@@ -460,7 +569,25 @@ public class ExRelatorioController extends ExController {
 		parametros.put("orgaoUsuario", getRequest().getParameter("orgaoUsuario"));
 		parametros.put("lotacaoTitular", getRequest().getParameter("lotacaoTitular"));
 		parametros.put("idTit", getRequest().getParameter("idTit"));
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelMovimentacao rel = new RelMovimentacao(parametros);
 		rel.gerar();
 
@@ -473,8 +600,8 @@ public class ExRelatorioController extends ExController {
 		assertAcesso(ACESSO_MOVCAD);
 
 		final SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy");
-		final Date dtIni = df.parse(getRequest().getParameter("dataInicial"));
-		final Date dtFim = df.parse(getRequest().getParameter("dataFinal"));
+		final Date dtIni = parseDate("dataInicial");
+		final Date dtFim = parseDate("dataFinal");
 		if (dtFim.getTime() - dtIni.getTime() > 31536000000L) {
 			throw new Exception("O relatório retornará muitos resultados. Favor reduzir o intervalo entre as datas.");
 		}
@@ -491,7 +618,25 @@ public class ExRelatorioController extends ExController {
 		parametros.put("orgaoUsuario", getRequest().getParameter("orgaoUsuario"));
 		parametros.put("lotacaoTitular", getRequest().getParameter("lotacaoTitular"));
 		parametros.put("idTit", getRequest().getParameter("idTit"));
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelMovCad rel = new RelMovCad(parametros);
 		rel.gerar();
 
@@ -504,8 +649,8 @@ public class ExRelatorioController extends ExController {
 		assertAcesso(ACESSO_DATAS);
 
 		final SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy");
-		final Date dtIni = df.parse(getRequest().getParameter("dataInicial"));
-		final Date dtFim = df.parse(getRequest().getParameter("dataFinal"));
+		final Date dtIni = parseDate("dataInicial");
+		final Date dtFim = parseDate("dataFinal");
 		if (dtFim.getTime() - dtIni.getTime() > 31536000000L) {
 			throw new Exception("O relatório retornará muitos resultados. Favor reduzir o intervalo entre as datas.");
 		}
@@ -524,7 +669,25 @@ public class ExRelatorioController extends ExController {
 		}
 		parametros.put("lotacaoTitular", getRequest().getParameter("lotacaoTitular"));
 		parametros.put("idTit", getRequest().getParameter("idTit"));
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelOrgao rel = new RelOrgao(parametros);
 		rel.gerar();
 
@@ -537,8 +700,8 @@ public class ExRelatorioController extends ExController {
 		assertAcesso(ACESSO_DATAS);
 
 		final SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy");
-		final Date dtIni = df.parse(getRequest().getParameter("dataInicial"));
-		final Date dtFim = df.parse(getRequest().getParameter("dataFinal"));
+		final Date dtIni = parseDate("dataInicial");
+		final Date dtFim = parseDate("dataFinal");
 		if (dtFim.getTime() - dtIni.getTime() > 31536000000L) {
 			throw new Exception("O relatório retornará muitos resultados. Favor reduzir o intervalo entre as datas.");
 		}
@@ -554,7 +717,25 @@ public class ExRelatorioController extends ExController {
 
 		parametros.put("lotacaoTitular", getRequest().getParameter("lotacaoTitular"));
 		parametros.put("idTit", getRequest().getParameter("idTit"));
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelTipoDoc rel = new RelTipoDoc(parametros);
 		rel.gerar();
 
@@ -566,9 +747,16 @@ public class ExRelatorioController extends ExController {
 	public Download aRelMovProcesso() throws Exception {
 		assertAcesso(ACESSO_RELMVP);
 
-		final SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy");
-		final Date dtIni = df.parse(getRequest().getParameter("dataInicial"));
-		final Date dtFim = df.parse(getRequest().getParameter("dataFinal"));
+		if (Utils.empty(getRequest().getParameter("dataInicial"))) {
+			throw new AplicacaoException("Parâmetro dataInicial não informado!");
+		}
+		if (Utils.empty(getRequest().getParameter("dataFinal"))) {
+			throw new AplicacaoException("Parâmetro dataFinal não informado!");
+		}
+
+		
+		final Date dtIni = parseDate("dataInicial");
+		final Date dtFim = parseDate("dataFinal");
 		if (dtFim.getTime() - dtIni.getTime() > 31536000000L) {
 			throw new Exception("O relatório retornará muitos resultados. Favor reduzir o intervalo entre as datas.");
 		}
@@ -582,14 +770,32 @@ public class ExRelatorioController extends ExController {
 		parametros.put("dataFinal", getRequest().getParameter("dataFinal"));
 		parametros.put("link_siga", "http://" + getRequest().getServerName() + ":" + getRequest().getServerPort() + getRequest().getContextPath()
 				+ "/app/expediente/doc/exibir?sigla=");
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelMovProcesso rel = new RelMovProcesso(parametros);
 		rel.gerar();
 
 		final InputStream inputStream = new ByteArrayInputStream(rel.getRelatorioPDF());
 		return new InputStreamDownload(inputStream, APPLICATION_PDF, "emiteRelMovProcesso");
 	}
-
+	
 	@Get("app/expediente/rel/aRelClassificacao")
 	public Download aRelClassificacao() throws Exception {
 		assertAcesso(ACESSO_CLSD);
@@ -597,7 +803,25 @@ public class ExRelatorioController extends ExController {
 		final Map<String, String> parametros = new HashMap<String, String>();
 		parametros.put("codificacao", getRequest().getParameter("codificacao"));
 		parametros.put("secaoUsuario", getRequest().getParameter("secaoUsuario"));
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelClassificacao rel = new RelClassificacao(parametros);
 		rel.gerar();
 
@@ -623,7 +847,25 @@ public class ExRelatorioController extends ExController {
 		parametros.put("idLotacao", idLotacao);
 		parametros.put("idOrgaoUsu", idOrgaoUsu);
 		parametros.put("secaoUsuario", secaoUsuario);
-
+		//System.out.println(System.getProperty("siga.relat.titulo"));
+		if ( System.getProperty("siga.relat.titulo") == null ) {
+			parametros.put("titulo","PODER JUDICIÁRIO");
+		} else {
+			parametros.put("titulo", System.getProperty("siga.relat.titulo"));
+		}
+		//System.getProperty("siga.relat.subtitulo");
+		if ( System.getProperty("siga.relat.subtitulo") == null ) {
+			parametros.put("subtitulo","JUSTIÇA FEDERAL");
+		} else {
+			parametros.put("subtitulo", System.getProperty("siga.relat.subtitulo"));
+		}
+		//System.out.println("Titulo: " + parametros.get("titulo"));
+		if ( System.getProperty("siga.relat.brasao") == null ) {
+			parametros.put("brasao","brasao.png");
+		} else {
+			parametros.put("brasao", System.getProperty("siga.relat.brasao"));
+		}
+		//System.out.println("Brasao: " + parametros.get("brasao"));
 		final RelDocsClassificados rel = new RelDocsClassificados(parametros);
 		rel.gerar();
 
@@ -647,4 +889,15 @@ public class ExRelatorioController extends ExController {
 		return SigaExProperties.getExClassificacaoMascaraJavascript();
 	}
 
+	private Date parseDate(String parameter) throws AplicacaoException {
+		final SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy");
+		if (Utils.empty(getRequest().getParameter(parameter)))
+			throw new AplicacaoException("Campo " + parameter + " deve ser preenchido!");
+		try {
+			return df.parse(getRequest().getParameter(parameter));
+		} catch (Exception ex) {
+			throw new AplicacaoException("Campo  \" + parameter + \" inválido!", 0, ex);
+		}
+	}
+
 }
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExSelecionavelController.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExSelecionavelController.java
index 02368c6341..55aaa5f1df 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExSelecionavelController.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/ExSelecionavelController.java
@@ -105,7 +105,7 @@ public abstract class ExSelecionavelController<T extends Selecionavel, DaoFiltro
 	protected Map<Integer, String> getListaTipoResp() {
 		final Map<Integer, String> map = new TreeMap<Integer, String>();
 		map.put(1, getBundle().getString("usuario.matricula"));
-		map.put(2, "Órgão Integrado");
+		map.put(2, "Lotação");
 		return map;
 	}
 
diff --git a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/builder/ExMovimentacaoBuilder.java b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/builder/ExMovimentacaoBuilder.java
index 39ea03be5f..9a4fa3dcf3 100644
--- a/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/builder/ExMovimentacaoBuilder.java
+++ b/sigaex/src/main/java/br/gov/jfrj/siga/vraptor/builder/ExMovimentacaoBuilder.java
@@ -5,6 +5,7 @@ import java.text.SimpleDateFormat;
 import java.util.Date;
 
 import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.Data;
 import br.gov.jfrj.siga.cp.model.CpOrgaoSelecao;
 import br.gov.jfrj.siga.cp.model.DpLotacaoSelecao;
 import br.gov.jfrj.siga.cp.model.DpPessoaSelecao;
@@ -172,6 +173,8 @@ public final class ExMovimentacaoBuilder {
 			mov.setDtMov(df.parse(dtMovString));
 		} catch (final Exception e) {
 		}
+		if (mov.getDtMov() != null && !Data.dataDentroSeculo21(mov.getDtMov()))
+			throw new AplicacaoException("Data inválida, deve estar entre o ano 2000 e ano 2100");
 
 		try {
 			mov.setDtFimMov(df.parse(dtDevolucaoMovString));
diff --git a/sigaex/src/main/webapp/META-INF/jboss-deployment-structure.xml b/sigaex/src/main/webapp/META-INF/jboss-deployment-structure.xml
index 6fb4f3d9cd..1db1092d34 100644
--- a/sigaex/src/main/webapp/META-INF/jboss-deployment-structure.xml
+++ b/sigaex/src/main/webapp/META-INF/jboss-deployment-structure.xml
@@ -8,8 +8,6 @@
 		</exclusions>
 		
 		<dependencies>
-			<module name="sigadoc.fop"/>
-		
 			<module name="org.hibernate" export="true" />
 
 			<module name="org.apache.commons.lang" />
@@ -19,8 +17,6 @@
 			<module name="javax.wsdl4j.api" />
 			<module name="asm.asm" />
 
-			<module name="sigadoc.org.bouncycastle" export="true" />
-			<module name="sigadoc.ext" />
 
 			<module name="org.javassist" />
 			<module name="javax.api" />
diff --git a/sigaex/src/main/webapp/WEB-INF/page/erroGeral.jsp b/sigaex/src/main/webapp/WEB-INF/page/erroGeral.jsp
index 08157349db..9d411ed2f3 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/erroGeral.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/erroGeral.jsp
@@ -6,46 +6,35 @@
 <c:catch var="selectException">
 	<c:if test="${empty exceptionGeral or empty exceptionStackGeral}">
 		<%
- 			java.lang.Throwable t = (Throwable) pageContext.getRequest().getAttribute("exception");
-			if (t == null){
-				t = (Throwable) exception;
-			}
- 			if (t != null) {
- 				while (t.getCause() != null && t != t.getCause()) {
- 					if (t.getClass().getSimpleName().equals("AplicacaoException"))
-						break;
- 					t = t.getCause();
- 				}
- 				pageContext.getRequest().setAttribute("exceptionGeral", t);
- 				java.io.StringWriter sw = new java.io.StringWriter();
- 				java.io.PrintWriter pw = new java.io.PrintWriter(sw);
- 				t.printStackTrace(pw);
- 				String s = sw.toString();
- 				String[] lines = s.split(System.getProperty("line.separator"));
- 				for (int i=0; i<lines.length; i++) {
- 					if (lines[i].contains("br.com.caelum.vraptor.core.DefaultReflectionProvider.invoke")) {
- 						for (int j=i-1; j>0; j--) {
- 							if (lines[j].trim().startsWith("at br.") && !lines[j].contains("$Proxy$_$$_WeldClientProxy")) {
-				 				StringBuilder sb = new StringBuilder();
- 								for (int k=0; k<=j; k++) {
- 				 					sb.append(lines[k]);
- 				 					sb.append(System.getProperty("line.separator"));
- 								}
- 								s = sb.toString();
- 								break;
- 							}			
- 						}
- 						break;
- 					}
- 				}
- 				pageContext.getRequest().setAttribute("exceptionStackGeral", s);
- 			}
+			java.lang.Throwable t = (Throwable) pageContext.getRequest().getAttribute("exception");
+					if (t == null) {
+						t = (Throwable) exception;
+					}
+					if (t != null) {
+						while ((t.getClass().getSimpleName().equals("ServletException")
+								|| t.getClass().getSimpleName().equals("InterceptionException")
+								|| t.getClass().getSimpleName().equals("InvocationTargetException")
+								|| t.getClass().getSimpleName().equals("ProxyInvocationException"))
+								&& t.getCause() != null && t != t.getCause()) {
+							t = t.getCause();
+						}
+
+						pageContext.getRequest().setAttribute("exceptionApp",
+								t instanceof br.gov.jfrj.siga.base.AplicacaoException);
+						pageContext.getRequest().setAttribute("exceptionMsg", t.getMessage());
+						pageContext.getRequest().setAttribute("exceptionGeral", t);
+						pageContext.getRequest().setAttribute("exceptionStackGeral",
+								br.gov.jfrj.siga.base.log.RequestExceptionLogger.simplificarStackTrace(t));
+					}
 		%>
 	</c:if>
 </c:catch>
 <c:catch var="catchException">
-	<siga:pagina titulo="Erro Geral" desabilitarbusca="sim" desabilitarmenu="sim" desabilitarComplementoHEAD="sim">
-		<!--
+	<siga:pagina titulo="Erro Geral" desabilitarbusca="sim"
+		desabilitarmenu="sim" desabilitarComplementoHEAD="sim">
+		<div class="container content">
+
+			<!--
 Unless this text is here, if your page is less than 513 bytes, Internet Explorer will display it's "Friendly HTTP Error Message",
 and your custom error will never be displayed.  This text is just used as filler.
 This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
@@ -53,71 +42,51 @@ This is a useless buffer to fill the page to 513 bytes to avoid display of Frien
 This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
 -->
 
-		<div class="container-fluid">
-			<div class="card bg-light mb-3" >
-				<div class="card-header">
-					<h5>
-						N&atilde;o Foi Poss&iacute;vel Completar a Opera&ccedil;&atilde;o (${pageContext.request.serverName})
-					</h5>
-				</div>
+			<div class="gt-bd clearfix">
+				<div class="gt-content clearfix">
 
-				<div class="card-body">
-					<div class="row">
-						<div class="col">
-							<div class="form-group">
-								<c:catch>
-									<c:if test="${not empty exceptionGeral}">
-										<c:if test="${not empty exceptionGeral.message}">
-											<h3>${exceptionGeral.message}</h3>
-										</c:if>
-										<c:if test="${not empty exceptionGeral.cause}">
-											<h4>${exceptionGeral.cause.message}</h4>
-										</c:if>
-									</c:if>
-								</c:catch>
-								
-								<!-- Inclui mensagens de validação -->
-								<c:if test="${not empty errors}">
-									<c:forEach var="error" items="${errors}">
-	    								${error.category} - ${error.message}<br />
-									</c:forEach>
-								</c:if>
+					<c:choose>
+						<c:when test="${exceptionApp}">
+							<p class="mb-2 mt-5">Operação Inválida:</p>
+							<h2 class="mt-0">${exceptionMsg}</h2>
+						</c:when>
+						<c:otherwise>
+							<div id="caption">
+								${t.exceptionStackGeral }
+								<h2>Não Foi Possível Completar a Operação
+									(${pageContext.request.serverName})</h2>
 							</div>
-						</div>
-					</div>
-					<div class="row">
-						<div class="col">
-							<div class="form-group">
-								<div style="display: none; padding: 8pt;" align="left" id="stack">
-									<pre style="font-size: 8pt;">${exceptionStackGeral}</pre>
-								</div>
+							<div align="left" id="stack">
+								<pre style="font-size: 8pt;"><c:out value="${exceptionStackGeral}" /></pre>
 							</div>
-						</div>
-					</div>
-					<div class="row">
+						</c:otherwise>
+					</c:choose>
+
+					<div class="row mt-3">
 						<div class="col">
-							<div class="form-group">		
-								<input type="button" value="Voltar" class="btn btn-primary"  onclick="javascript:history.back();" />
-								<input type="button" id="show_stack" value="Mais detalhes" class="btn btn-primary" onclick="javascript: document.getElementById('stack').style.display=''; document.getElementById('show_stack').style.display='none';" />
+							<div class="form-group">
+							<c:if test="${newWindow != 1}">
+								<input type="button" value="Voltar"
+									onclick="javascript:history.back();" class="btn btn-secondary btn-sm" />
+							</c:if>
+							<c:if test="${newWindow eq 1}">
+								<input type="button" value="Fechar"
+									onclick="javascript:window.close();" class="btn btn-secondary btn-sm" />
+							</c:if>
 							</div>
 						</div>
 					</div>
+
 				</div>
 			</div>
+
 		</div>
+
 	</siga:pagina>
 </c:catch>
 
 <c:if test="${catchException!=null}">
-	Erro: ${catchException.message}
-	<br>
-	<br>
-	<br>
-
-	<pre>
-		Erro original:
-		${exceptionStack}
-	</pre>
+Erro: ${catchException.message}<br> <br> <br> <pre>
+Erro original:
+${exceptionStack}</pre>
 </c:if>
-
-
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exAutenticacao/autenticar.jsp b/sigaex/src/main/webapp/WEB-INF/page/exAutenticacao/autenticar.jsp
index 4f15f3ab7d..29c910e09e 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exAutenticacao/autenticar.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exAutenticacao/autenticar.jsp
@@ -26,7 +26,7 @@
 								<div class="col">
 									<div class="form-group">
 										<label>Número de referência</label> 
-										<input type="text" id="id_number" name="n" class="form-control" />
+										<input type="text" id="id_number" name="n" class="form-control" value="${param.n}" />
 									</div>
 								</div>
 							</div>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/edita.jsp b/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/edita.jsp
index 69f6be381e..3d096d57d0 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/edita.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/edita.jsp
@@ -182,7 +182,7 @@
 		</div>
 
 		<c:if test="${acao == 'editar_classificacao'}">
-			<c:if test="${exClassificacao.numVias > 0}">
+			<c:if test="${exClassificacao.numVias gt 0}">
 				<h5>Vias</h5>
 
 				<div id="divVias">
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/lista.jsp b/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/lista.jsp
index e303fc274c..c4aedacce7 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/lista.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exClassificacao/lista.jsp
@@ -34,7 +34,7 @@
 			</div>
 		</div>
 
-		<table class="table table-hover ">
+		<table class="table table-hover table-sm">
 			<thead class="thead-dark align-middle text-center">
 				<tr>
 					<th>Codificação</th>
@@ -52,7 +52,7 @@
 					<c:set var="numVias" value="${fn:length(cla.exViaSet)}" />
 					<c:remove var="viasDefault" />
 					<c:choose>
-						<c:when test="${numVias == ''}">
+						<c:when test="${numVias == 0}">
 							<c:set var="viasDefault" value="1" />
 						</c:when>
 						<c:otherwise>
@@ -70,37 +70,28 @@
 							<c:when test="${numVias > 0}">
 								<c:forEach items="${cla.exViaSet}" var="via" varStatus="loop">
 									<c:if test="${loop.index>0}">
+										<tr>
+									</c:if>
+									<td>${via.codVia}</td>
+									<td>${via.exTipoDestinacao.descrTipoDestinacao}</td>
+									<td>${via.temporalidadeCorrente.descTemporalidade}</td>
+									<td>${via.temporalidadeIntermediario.descTemporalidade}</td>
+									<td>${via.exDestinacaoFinal.descrTipoDestinacao}</td>
+									<c:if test="${loop.index<numVias0}">
 					</tr>
-					<tr>
-						</c:if>
-						<td>${via.codVia}</td>
-						<td>${via.exTipoDestinacao.descrTipoDestinacao}</td>
-						<td>${via.temporalidadeCorrente.descTemporalidade}</td>
-						<td>${via.temporalidadeIntermediario.descTemporalidade}</td>
-						<td>${via.exDestinacaoFinal.descrTipoDestinacao}</td>
-					</tr>
+					</c:if>
 				</c:forEach>
 				</c:when>
 				<c:otherwise>
-					<td />
-					<td />
-					<td />
-					<td />
-					<td />
-				</c:otherwise>
+					<td></td>
+					<td></td>
+					<td></td>
+					<td></td>
+					<td></td>
+					</c:otherwise>
 				</c:choose>
 				</tr>
 				</c:forEach>
-
-
-
-
-
-
-
-
-
-
 			</tbody>
 		</table>
 
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exConfiguracao/edita.jsp b/sigaex/src/main/webapp/WEB-INF/page/exConfiguracao/edita.jsp
index 204f6b51e7..d7bcd8f2f2 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exConfiguracao/edita.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exConfiguracao/edita.jsp
@@ -179,9 +179,9 @@
 								</div>
 							</div>
 							<div class="row">
-								<div class="col-sm-6">
+								<div class="col-sm-12">
 									<div class="form-group">
-										<label>Espécie</label>
+										<label>Tipo da Espécie</label>
 									
 										<c:choose>
 												<c:when test="${campoFixo && not empty config.exModelo}">
@@ -208,9 +208,8 @@
       		 precisa ser executado o request ajax referente Ã  FormaDocumento, da qual a lista 
 		     de modelos depende. Talvez seria bom tornar síncronos esses dois requests ajax    -->
 							<div class="row">
-								<div class="col-sm-6">
+								<div class="col-sm-12">
 									<div class="form-group">
-										<label>Modelo</label>
 										<c:choose>
 											<c:when test="${campoFixo && not empty config.exModelo}">
 												<input type="hidden" name="idMod"
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exDocumento/edita.jsp b/sigaex/src/main/webapp/WEB-INF/page/exDocumento/edita.jsp
index ad77daa40a..d4347bfcd9 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exDocumento/edita.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exDocumento/edita.jsp
@@ -32,7 +32,9 @@
 			<form id="frm" name="frm" theme="simple" method="post" enctype="multipart/form-data" class="mb-0">
 				<input type="hidden" id="idTamanhoMaximoDescricao" name="exDocumentoDTO.tamanhoMaximoDescricao" value="${exDocumentoDTO.tamanhoMaximoDescricao}" /> 
 				<input type="hidden" id="alterouModelo" name="exDocumentoDTO.alterouModelo" /> 
-				<input type="hidden" id="clickSelect" name="clickSelect" /> 
+				<input type="hidden" id="clickSelect" name="clickSelect" />
+				<input type="hidden" id="hasPai" name="hasPai" value="${hasPai}" />
+				<input type="hidden" id="isPaiEletronico" name="isPaiEletronico" value="${isPaiEletronico}" />
 				<input type="hidden" name="postback" value="1" /> 
 				<input type="hidden" id="sigla" name="exDocumentoDTO.sigla" value="${exDocumentoDTO.sigla}" /> 
 				<input type="hidden" name="exDocumentoDTO.nomePreenchimento" value="" /> 
@@ -191,7 +193,7 @@
 							<label for="exDocumentoDTO.numAntigoDoc">Nº antigo</label>
 							<input type="text" name="exDocumentoDTO.numAntigoDoc" size="16" maxLength="32" value="${exDocumentoDTO.numAntigoDoc}" class="form-control" />
 							<small class="form-text text-muted">(informar o número do documento no antigo sistema de controle de expedientes ou de
-											processos administrativos [SISAPA] ou [PROT]).</small>
+											processos administrativos).</small>
 						</div>
 					</div>
 				</div>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exDocumento/exibe.jsp b/sigaex/src/main/webapp/WEB-INF/page/exDocumento/exibe.jsp
index 3b717f04f9..554357cc41 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exDocumento/exibe.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exDocumento/exibe.jsp
@@ -1091,12 +1091,13 @@
 		var urlGc = "${url}";
 
         $.ajax({
-            url: url,
+            url: urlGc,
             type: "GET"
         }).fail(function(jqXHR, textStatus, errorThrown){
-			$("#gc").html(errorThrown);
+        	if (errorThrown !== "Not Fount")
+				$("#gc").html(errorThrown);
         }).done(function(data, textStatus, jqXHR ){
-			$("#gc").html(response);
+			$("#gc").html(data);
         });
 	</script>
 </c:if>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exEmailNotificacao/edita.jsp b/sigaex/src/main/webapp/WEB-INF/page/exEmailNotificacao/edita.jsp
index b8e6686029..bf98b1c408 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exEmailNotificacao/edita.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exEmailNotificacao/edita.jsp
@@ -114,7 +114,7 @@
 									<div class="col-sm-2">
 										<select name="tipoEmail" id="tipoEmail"
 											onchange="javascript:hideShowSel(this);" class="form-control">
-											<c:forEach items="${listaTipoEmail}" var="item">
+											<c:forEach items="#{listaTipoEmail}" var="item">
 												<option value="${item.key}"
 													${item.key == tipoEmail ? 'selected' : ''}>
 													${item.value}</option>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/editarForma.jsp b/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/editarForma.jsp
index 7222c49cdf..8385dfaabc 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/editarForma.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/editarForma.jsp
@@ -15,23 +15,23 @@
 				<h5>Dados da Espécie Documental</h5>
 			</div>
 			<div class="card-body">
-				<form name="frm" action="gravar" theme="simple" method="POST">
-
+				<form name="frm" action="gravar" theme="simple" method="post">
+					<input type="hidden" name="id" value="${id}"></input>
 					<div class="row">
-						<div class="col-sm-4">
+						<div class="col-6">
 							<div class="form-group">
 								<label for="descricao">Descrição</label> <input type="text"
 									value="${descricao}" name="descricao" class="form-control" />
 							</div>
 						</div>
-						<div class="col-sm-1">
+						<div class="col-2">
 							<div class="form-group">
 								<label for="sigla">Sigla</label> <input type="text"
 									value="${sigla}" name="sigla" id="gravar_sigla"
 									class="form-control" /> <span id="mensagem"></span>
 							</div>
 						</div>
-						<div class="col-sm-2">
+						<div class="col-4">
 							<div class="form-group">
 								<label for="idTipoFormaDoc">Tipo</label> <select
 									name="idTipoFormaDoc" value="${idTipoFormaDoc}"
@@ -45,7 +45,7 @@
 						</div>
 					</div>
 					<div class="row">
-						<div class="col-sm-6">
+						<div class="col-12">
 							<div class="form-group">
 								<label for="idTipoFormaDoc">Origem</label><br />
 								<div class="form-check form-check-inline">
@@ -70,10 +70,9 @@
 						</div>
 					</div>
 					<div class="row">
-						<div class="col-sm-3">
+						<div class="col-12">
 							<div class="form-group">
 								<button type="submit" class="btn btn-primary">Ok</button>
-								<button type="submit" name="submit" class="btn btn-primary">Aplicar</button>
 								<button type="button" onclick="javascript:history.back();"
 									class="btn btn-primary">Cancela</button>
 							</div>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/listarFormas.jsp b/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/listarFormas.jsp
index 6bea56f273..7c27e8261f 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/listarFormas.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exFormaDocumento/listarFormas.jsp
@@ -6,7 +6,7 @@
 <%@ taglib uri="http://localhost/customtag" prefix="tags"%>
 <%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
 
-<siga:pagina titulo="Lista de Esp�cies Documentais">
+<siga:pagina titulo="Lista de Esp�cies Documentais">
 	<!-- main content -->
 	<div class="container-fluid">
 		<div class="card bg-light mb-3">
@@ -22,7 +22,7 @@
 					</div>
 				</div>
 				<div class="row">
-					<form id="listar" name="listar" method="GET" class="form100">
+					<form id="listar" name="listar" method="get" class="form100">
 						<div class="col-sm-4">
 							<div class="form-group">
 								<div class="form-check form-check-inline">
@@ -40,7 +40,7 @@
 				</div>
 				<div class="row">
 					<div class="col-sm-2">
-						<form name="frm" action="editar" theme="simple" method="GET">
+						<form name="frm" action="editar" theme="simple" method="get">
 							<button type="submit" class="btn btn-primary">Novo</button>
 						</form>
 					</div>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exModelo/edita.jsp b/sigaex/src/main/webapp/WEB-INF/page/exModelo/edita.jsp
index db3534eef6..614b3fc463 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exModelo/edita.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exModelo/edita.jsp
@@ -48,27 +48,29 @@
 	<script type="text/javascript" src="/siga/javascript/jquery.blockUI.js"></script>
 
 	<div class="container-fluid">
-		<div class="card bg-light mb-3" >
+		<div class="card bg-light mb-3">
 
-			<div class="card-header"><h5>Edição de Modelo</h5></div>
+			<div class="card-header">
+				<h5>Edição de Modelo</h5>
+			</div>
 
 			<div class="card-body">
 
-				<form name="frm" id="frm" action="gravar" method="POST">
+				<form name="frm" id="frm" action="gravar" method="post">
 					<input type="hidden" name="postback" value="1" /> <input
 						type="hidden" name="id" value="${id}" id="modelo_gravar_id" />
 
 					<div class="row">
 						<div class="col-sm-6">
 							<div class="form-group">
-								<label>Nome</label>
-								<input type="text" name="nome"	value="${nome}" size="80" class="form-control"/>
+								<label>Nome</label> <input type="text" name="nome"
+									value="${nome}" size="80" class="form-control" />
 							</div>
 						</div>
 						<div class="col-sm-6">
 							<div class="form-group">
-								<label>Descrição</label>
-								<input type="text" name="descricao" value="${descricao}" size="80" class="form-control"/>
+								<label>Descrição</label> <input type="text" name="descricao"
+									value="${descricao}" size="80" class="form-control" />
 							</div>
 						</div>
 					</div>
@@ -77,25 +79,25 @@
 							<div class="form-group">
 								<label>Classificação</label>
 								<siga:selecao tema="simple" propriedade="classificacao"
-									modulo="sigaex" urlAcao="buscar" urlSelecionar="selecionar"/>
+									modulo="sigaex" urlAcao="buscar" urlSelecionar="selecionar" />
 							</div>
 						</div>
 					</div>
 					<div class="row">
 						<div class="col-sm-12">
 							<div class="form-group">
-								<label>Classificação para criação de vias</label>		
+								<label>Classificação para criação de vias</label>
 								<siga:selecao tema="simple" modulo="sigaex"
 									propriedade="classificacaoCriacaoVias" urlAcao="buscar"
-									urlSelecionar="selecionar"/>
+									urlSelecionar="selecionar" />
 							</div>
 						</div>
 					</div>
 					<div class="row">
 						<div class="col-sm-6">
 							<div class="form-group">
-								<label>Espécie</label>
-								<select name="forma" value="${forma}" class="custom-select">
+								<label>Espécie</label> <select name="forma" value="${forma}"
+									class="custom-select">
 									<c:forEach var="item" items="${listaForma}">
 										<option value="${item.idFormaDoc}"
 											${item.idFormaDoc == forma ? 'selected' : ''}>${item.descrFormaDoc}</option>
@@ -105,8 +107,8 @@
 						</div>
 						<div class="col-sm-6">
 							<div class="form-group">
-								<label>Nível de acesso</label>
-								<select name="nivel" value="${nivel}" class="custom-select">
+								<label>Nível de acesso</label> <select name="nivel"
+									value="${nivel}" class="custom-select">
 									<option value="0">[Indeterminado]</option>
 									<c:forEach var="item" items="${listaNivelAcesso}">
 										<option value="${item.idNivelAcesso}"
@@ -119,107 +121,107 @@
 					<div class="row">
 						<div class="col-sm-6">
 							<div class="form-group">
-								<label>Diretório</label>
-								<input type="text" name="diretorio" value="${diretorio}" size="80" class="form-control"/>
+								<label>Diretório</label> <input type="text" name="diretorio"
+									value="${diretorio}" size="80" class="form-control" />
 							</div>
 						</div>
 						<div class="col-sm-6">
 							<div class="form-group">
-								<label>Identificador para sincronismo</label>
-								<input readonly type="text" name="uuid" value="${uuid}" size="80" class="form-control"/>
+								<label>Identificador para sincronismo</label> <input readonly
+									type="text" name="uuid" value="${uuid}" size="80"
+									class="form-control" />
 							</div>
 						</div>
 					</div>
-					<div class="row">
-						<div class="col-sm-2">
-							<div class="form-group">
-								<label>Tipo do Modelo</label>
-								<siga:escolha id="tipoModelo" var="tipoModelo">
-							</div>
-						</div>
-					</div>
-					<div class="row">
-						<div class="col-sm-12">
-							<div class="form-group">
-								
-									<siga:opcao id="template/freemarker" texto="Freemarker">
-										<textarea id="conteudo" style="width: 100%;" cols="1" rows="1"
-											name="conteudo" class="form-control"><c:out value="${conteudo}"
-												default="" /></textarea>
-										<p align="right">Ctrl-I: Indentar, Crtl-S: Salvar</p>
-									</siga:opcao>
-									<siga:opcao id="template-file/jsp" texto="JSP">
-									&nbsp;&nbsp;&nbsp;&nbsp;Nome do arquivo:
+					<div class="form-group">
+						<label>Tipo do Modelo</label>
+						<siga:escolha id="tipoModelo" var="tipoModelo">
+							<siga:opcao id="template/freemarker" texto="Freemarker">
+								<textarea id="conteudo" style="width: 100%;" cols="1" rows="1"
+									name="conteudo" class="form-control"><c:out
+										value="${conteudo}" default="" /></textarea>
+								<p align="right">Ctrl-I: Indentar, Crtl-S: Salvar</p>
+							</siga:opcao>
+							<siga:opcao id="template-file/jsp" texto="JSP">
+									Nome do arquivo:
 									<input type="text" name="arquivo" size="80" value="${arquivo}" />
-									</siga:opcao>
-								</siga:escolha>
-							</div>
-						</div>
+							</siga:opcao>
+						</siga:escolha>
 					</div>
 					<div class="row">
 						<div class="col-sm-12">
 							<div class="form-group mb-0">
-								<input type="submit" value="Ok" class="btn btn-primary" />
-								<input type="submit" name="submit" value="Aplicar" class="btn btn-primary" />
-								<input type="button" value="Desativar" class="btn btn-primary" onclick="location.href='desativar?id=${id}'" />
-								<input type="button" value="Cancelar" onclick="javascript:history.back();" class="btn btn-primary" />
+								<input type="submit" value="Ok" class="btn btn-primary" /> <input
+									type="submit" name="submit" value="Aplicar"
+									class="btn btn-primary" /> <input type="button"
+									value="Desativar" class="btn btn-primary"
+									onclick="location.href='desativar?id=${id}'" /> <input
+									type="button" value="Cancelar"
+									onclick="javascript:history.back();" class="btn btn-primary" />
 							</div>
 						</div>
 					</div>
-				</form>
 			</div>
+			</form>
 		</div>
 		<c:if test="${not empty id}">
-			<div style="clear: both; margin-bottom: 20px;">
+			<div class="mt-3" style="clear: both; margin-bottom: 20px;">
 				<div id="tableCadastradasEletronico"></div>
 				<div>
-					<input type="button" value="Novo" class="btn btn-primary" onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=4&nmTipoRetorno=modelo&campoFixo=True'" />
+					<input type="button" value="Novo" class="btn btn-primary"
+						onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=4&nmTipoRetorno=modelo&campoFixo=True'" />
 				</div>
 			</div>
 
 			<div style="clear: both; margin-bottom: 20px;">
 				<div id="tableCadastradasCriar"></div>
 				<div>
-					<input type="button" value="Novo" class="btn btn-primary" onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=2&nmTipoRetorno=modelo&campoFixo=True'" />
+					<input type="button" value="Novo" class="btn btn-primary"
+						onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=2&nmTipoRetorno=modelo&campoFixo=True'" />
 				</div>
 			</div>
 
 			<div style="clear: both; margin-bottom: 20px;">
 				<div id="tableCadastradasAssinar"></div>
 				<div>
-					<input type="button" value="Novo" class="btn btn-primary" onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=1&idTpMov=11&nmTipoRetorno=modelo&campoFixo=True'" />
+					<input type="button" value="Novo" class="btn btn-primary"
+						onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=1&idTpMov=11&nmTipoRetorno=modelo&campoFixo=True'" />
 				</div>
 			</div>
 
 			<div style="clear: both; margin-bottom: 20px;">
 				<div id="tableCadastradasAssinarComSenha"></div>
 				<div>
-					<input type="button" value="Novo" class="btn btn-primary" onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=1&idTpMov=58&nmTipoRetorno=modelo&campoFixo=True'" />
+					<input type="button" value="Novo" class="btn btn-primary"
+						onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=1&idTpMov=58&nmTipoRetorno=modelo&campoFixo=True'" />
 				</div>
 			</div>
 
 			<div style="clear: both; margin-bottom: 20px;">
 				<div id="tableCadastradasAcessar"></div>
 				<div>
-					<input type="button" value="Novo" class="btn btn-primary" onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=6&nmTipoRetorno=modelo'" />
+					<input type="button" value="Novo" class="btn btn-primary"
+						onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=6&nmTipoRetorno=modelo'" />
 				</div>
 			</div>
 
 			<div style="clear: both; margin-bottom: 20px;">
 				<div id="tableCadastradasNivelAcessoMaximo"></div>
 				<div>
-					<input type="button" value="Novo" class="btn btn-primary" onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=18&nmTipoRetorno=modelo&campoFixo=True'" />
+					<input type="button" value="Novo" class="btn btn-primary"
+						onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=18&nmTipoRetorno=modelo&campoFixo=True'" />
 				</div>
 			</div>
 
 			<div style="clear: both; margin-bottom: 20px;">
 				<div id="tableCadastradasNivelAcessoMinimo"></div>
 				<div>
-					<input type="button" value="Novo" class="btn btn-primary" onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=19&nmTipoRetorno=modelo&campoFixo=True'" />
+					<input type="button" value="Novo" class="btn btn-primary"
+						onclick="location.href='/sigaex/app/expediente/configuracao/editar?id=&idMod=${id}&idTpConfiguracao=19&nmTipoRetorno=modelo&campoFixo=True'" />
 				</div>
 			</div>
+		</c:if>
 	</div>
-	</c:if>
 
 	<script> 
 		var editor = null;
@@ -348,5 +350,4 @@
 			            });
 			});
 	</script>
-
 </siga:pagina>
\ No newline at end of file
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAssinar.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAssinar.jsp
index 1cff0cf11e..b72551149d 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAssinar.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAssinar.jsp
@@ -86,6 +86,8 @@
 						autenticar="${autenticando}"
 						assinarComSenha="${assinando and f:podeAssinarComSenha(titular,lotaTitular,doc.mobilGeral)}"
 						autenticarComSenha="${autenticando and f:podeAutenticarComSenha(titular,lotaTitular,doc.mobilGeral)}"
+						assinarComSenhaChecado="${assinando and f:deveAssinarComSenha(titular,lotaTitular,doc.mobilGeral)}"
+						autenticarComSenhaChecado="${autenticando and f:deveAutenticarComSenha(titular,lotaTitular,doc.mobilGeral)}"
 						juntarAtivo="${juntarAtivo}" juntarFixo="${juntarFixo}"
 						tramitarAtivo="${tramitarAtivo}" tramitarFixo="${tramitarFixo}" />
 				</div>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAvaliar.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAvaliar.jsp
index 95e61ba628..ce7992c451 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAvaliar.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aAvaliar.jsp
@@ -53,7 +53,7 @@
 						</div>
 					</div>
 					<div class="row">
-						<div class="col-sm-6">
+						<div class="col-12">
 							<div class="form-group">
 							<c:choose>
 								<c:when test="${!substituicao}">
@@ -71,13 +71,13 @@
 						</div>
 					</div>
 					<div class="row">
-						<div class="col-sm-6">
+						<div class="col-12">
 							<div class="form-group">
 								<siga:selecao titulo="Nova Classificação" propriedade="classificacao" modulo="sigaex" urlAcao="buscar" urlSelecionar="selecionar"/>
 								<small class="form-text text-muted">(opcional)</small>
 							</div>
 						</div>
-						<div class="col-sm-6">
+						<div class="col-12">
 							<div class="form-group">
 								<label>Motivo da reclassificação</label>
 								<input class="form-control" type="text" name="descrMov" size="50" maxLength="128" />
@@ -85,7 +85,7 @@
 							</div>
 						</div>
 						<c:if test="${tipoResponsavel == 3}">
-							<div class="col-sm-6">
+							<div class="col-12">
 								<div class="form-group">
 									<label>Observação</label>
 									<input class="form-control" type="text" size="30" name="obsOrgao" />
@@ -95,7 +95,7 @@
 		
 					</div>
 					<div class="row">
-						<div class="col-sm">
+						<div class="col-12">
 							<input type="submit" value="Ok" class="btn btn-primary" />
 							<input type="button" value="Cancela" onclick="javascript:history.back();" class="btn btn-cancel ml-2" />
 						</div>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aCopiar.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aCopiar.jsp
index 5ea285d3cd..2ab531d029 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aCopiar.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aCopiar.jsp
@@ -65,7 +65,7 @@
 								</div>
 							</div>
 							<div class="row">
-								<div class="col-sm-6">
+								<div class="col-12">
 									<div class="form-group">
 										<c:choose>
 											<c:when test="${!substituicao}">
@@ -79,11 +79,12 @@
 											type="hidden" name="campos" value="titularSel.id" />
 										<siga:selecao propriedade="titular" tema="simple"
 											modulo="siga" />
+										</div>
 									</div>
 								</div>
 							</div>
 							<div class="row">
-								<div class="col-sm">
+								<div class="col-12">
 									<div class="form-group">
 										<label>Função do Responsável</label> <input
 											class="form-control" type="hidden" name="campos"
@@ -97,14 +98,14 @@
 						</c:when>
 					</c:choose>
 					<div class="row">
-						<div class="col col-lg-6">
+						<div class="col col-12">
 							<siga:selecao titulo="Documento" propriedade="documentoRef"
 								urlAcao="expediente/buscar"
 								urlSelecionar="expediente/selecionar" modulo="sigaex" />
 						</div>
 					</div>
 					<div class="row">
-						<div class="col-sm">
+						<div class="col-12">
 							<input type="submit" value="Ok" class="btn btn-primary" /> <input
 								type="button" value="Cancela"
 								onclick="javascript:history.back();" class="btn btn-cancel ml-2" />
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aExibir.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aExibir.jsp
index 43d699a3ac..0f9ac4405f 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aExibir.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aExibir.jsp
@@ -327,7 +327,9 @@ function visualizarImpressao() {
 					assinar="true"
 					autenticar="${mov.exTipoMovimentacao.idTpMov==2}"
 					assinarComSenha="${f:podeAssinarMovimentacaoComSenha(titular,lotaTitular,mov)}"
+					assinarComSenhaChecado="${f:deveAssinarMovimentacaoComSenha(titular,lotaTitular,mov)}"
 					autenticarComSenha="${f:podeAutenticarMovimentacaoComSenha(titular,lotaTitular,mov)}" 
+					autenticarComSenhaChecado="${f:deveAutenticarMovimentacaoComSenha(titular,lotaTitular,mov)}" 
 					idMovimentacao="${mov.idMov}" />
 				<p>
 					<b>Link para assinatura externa: </b>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aReclassificar.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aReclassificar.jsp
index 133ee91f0a..fcadfe85df 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aReclassificar.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aReclassificar.jsp
@@ -48,7 +48,7 @@ function sbmt() {
 					</div>
 				</div>
 				<div class="row" id="tr_titular" style="display: ${exDocumentoDTO.substituicao ? '' : 'none'};" >
-					<div class="col-sm-6" >
+					<div class="col-12" >
 					<input type="hidden" name="campos" value="titularSel.id" />
 						<div class="form-group">
 							<label>Titular</label>
@@ -58,12 +58,12 @@ function sbmt() {
 					</div>
 				</div>				
 				<div class="row">
-					<div class="col-sm-6" >
+					<div class="col-12" >
 						<div class="form-group">
 							<siga:selecao titulo="Nova Classificação" propriedade="classificacao" modulo="sigaex" urlAcao="buscar" urlSelecionar="selecionar"/>
 						</div>
 					</div>
-					<div class="col-sm-6">
+					<div class="col-12">
 						<div class="form-group">
 							<label>Motivo</label>
 							<input type="text" name="descrMov" maxLength="128" class="form-control"/>
@@ -72,7 +72,7 @@ function sbmt() {
 				</div>				
 				<c:if test="${tipoResponsavel == 3}">
 				<div class="row">
-					<div class="col-sm-6" >
+					<div class="col-12" >
 						<div class="form-group">
 							<label>Observação</label>
 							<input type="text" size="30" name="obsOrgao" class="form-control"/>
@@ -81,7 +81,7 @@ function sbmt() {
 				</div>				
 				</c:if>
 				<div class="row">
-					<div class="col-sm-2">
+					<div class="col-12">
 						<div class="form-group">
 							<button type="submit" class="btn btn-primary" >Ok</button>
 							<button type="button" onclick="javascript:history.back();" class="btn btn-primary" >Cancela</button>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aTransferir.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aTransferir.jsp
index c0921b35e0..d5dc842c5b 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aTransferir.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/aTransferir.jsp
@@ -119,7 +119,7 @@ $(function(){
 				</div>
 				</c:if>
 				<div class="row">
-					<div class="col-sm-2">
+					<div class="col col-3">
 						<div class="form-group">
 							<label>Destinatário</label> 
 							<select name="tipoResponsavel" onchange="javascript:sbmt();" class="form-control" >
@@ -131,7 +131,7 @@ $(function(){
 							</select> 
 						</div>
 					</div>
-					<div class="col-sm-6">
+					<div class="col col-9">
 						<div class="form-group">
 							<label>&nbsp;&nbsp;&nbsp;</label> 
 							<c:choose>
@@ -149,36 +149,39 @@ $(function(){
 					</div>
 				</div>				
 				<div class="row">
-					<div class="col-sm-2">
-						<div class="form-group">
+					<div class="col col-3">
+						<div class="form-group mb-0">
 							<label>Data da devolução</label> 
 							<input type="text" name="dtDevolucaoMovString"onblur="javascript:verifica_data(this,0);" value="${dtDevolucaoMovString}" class="form-control"/>					 
-							<small class="form-text text-muted">Atenção: somente preencher a data de devolução se a intenção for, realmente, que o documento seja devolvido até esta data.</small>
 						</div>
 					</div>
-					<div class="col-sm-3">
-						<div class="form-group">
-							<div class="form-check form-check-inline mt-4">
+				</div>				
+				<div class="row">
+					<div class="col col-12">
+							<small class="form-text text-muted">Atenção: somente preencher a data de devolução se a intenção for, realmente, que o documento seja devolvido até esta data.</small>
+					</div>				
+				</div>				
+				<div class="row">
+					<div class="col col-9">
+							<div class="form-check form-check-inline mt-3 mb-3">
 							  <input class="form-check-input" type="checkbox" name="protocolo" id="protocolo" value="mostrar" <c:if test="${protocolo}">checked</c:if>/>
 							  <label class="form-check-label" for="protocolo">Mostrar protocolo ao concluir o trâmite</label>
 							</div>
-						</div>
 					</div>
 					<c:if test="${tipoResponsavel == 3}">
-					<div class="col-sm-4">
+					<div class="col col-12">
 						<div class="form-group">
 							<label>Observação</label> 
-							<input type="text" name="dtDevolucaoMovString"onblur="javascript:verifica_data(this,0);" value="${dtDevolucaoMovString}" class="form-control"/>					 
-							<small class="form-text text-muted">Atenção: somente preencher a data de devolução se a intenção for, realmente, que o documento seja devolvido até esta data.</small>
+							<input type="text" size="30" name="obsOrgao" value="${obsOrgao}" class="form-control"/>
 						</div>
 					</div>
 					</c:if>
 				</div>
 				<div class="row">
-					<div class="col-sm-2">
+					<div class="col col-12">
 						<div class="form-group">
 							<a accesskey="o" id="button_ok" onclick="javascript:submeter();" class="btn btn-primary"><u>O</u>k</a>
-							<button type="button"  onclick="javascript:history.back();" class="btn btn-primary">Cancela</button>
+							<button type="button"  onclick="javascript:history.back();" class="btn btn-light ml-2">Cancela</button>
 						</div>
 					</div>
 				</div>				
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/apensar.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/apensar.jsp
index 086e89d9a1..d7129a749b 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/apensar.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/apensar.jsp
@@ -9,79 +9,104 @@
 
 <siga:pagina titulo="Apensar Documento">
 	<c:if test="${not mob.doc.eletronico}">
-		<script type="text/javascript">$("html").addClass("fisico");$("body").addClass("fisico");</script>
+		<script type="text/javascript">
+			$("html").addClass("fisico");
+			$("body").addClass("fisico");
+		</script>
 	</c:if>
-	
-	<div class="gt-bd clearfix">
-		<div class="gt-content clearfix">
-			<h2>Apensação de Documento - ${mob.siglaEDescricaoCompleta}</h2>
-			
-			<div class="gt-content-box gt-for-table">
-				<form action="apensar_gravar" enctype="multipart/form-data" class="form" method="POST">
-					<input type="hidden" name="postback" value="1" />
-					<input type="hidden" name="sigla" value="${sigla}"/>
-					
-					<table class="gt-form-table">
-						<tr class="header">
-							<td colspan="2">Dados da apensação</td>
-						</tr>
 
-						<!-- Checa se o documento é eletronico ou não. Caso seja, seu valor default para Data é o atual e o Responsável é quem fez o Login. -->
-						<c:choose>
-							<c:when test="${!doc.eletronico}">
-								<!-- Documento Eletronico -->
-								<tr>
-									<td>
-										Data:
-									</td>
-									<td>
-										<input name="dtMovString" value="${dtMovString}" onblur="javascript:verifica_data(this, true);" />
-									</td>
-								</tr>
-								<tr>
-									<td>Responsável:</td>
-									<td>
-										<siga:selecao tema="simple" propriedade="subscritor" modulo="siga"/>
-										&nbsp;&nbsp;
-										<input type="checkbox" name="substituicao" onclick="javascript:displayTitular(this);" />&nbsp;&nbsp;Substituto
-									</td>
-								</tr>
-							</c:when>
-						</c:choose>
-						
-						<!-- abre o TR  -->
-						<c:choose>
-							<c:when test="${!substituicao}">
-								<tr id="tr_titular" style="display: none">
-							</c:when>
-							<c:otherwise>
-								<tr id="tr_titular" style="">
-							</c:otherwise>
-						</c:choose>
-						<td>
-							Titular:
-						</td>
-						<input type="hidden" name="campos" value="titularSel.id" />
-						<td colspan="3">
-							<siga:selecao propriedade="titular" tema="simple" modulo="siga"/>
-						</td>
-						</tr>
-						<!-- fim do TR -->
-						<tr>
-							<td>Documento Mestre:</td>
-							<td>
-								<siga:selecao tema='simple' titulo="Documento Mestre:" propriedade="documentoRef" urlAcao="expediente/buscar" urlSelecionar="expediente/selecionar" modulo="sigaex" />
-							</td>
-						</tr>
-						<tr class="button">
-							<td colspan="2">
-								<input type="submit" value="Ok" class="gt-btn-small gt-btn-left" /> 
-								<input type="button" value="Cancela" onclick="javascript:history.back();" class="gt-btn-small gt-btn-left" />
-							</td>
-						</tr>
-					</table>
-				</form>
+	<div class="container-fluid">
+		<div class="card bg-light mb-3">
+			<div class="card-header">
+				<h5>Apensação de Documento - ${mob.siglaEDescricaoCompleta}</h5>
 			</div>
+			<div class="card-body">
+				<form action="apensar_gravar" enctype="multipart/form-data"
+					class="form" method="POST">
+					<input type="hidden" name="postback" value="1" /> <input
+						type="hidden" name="sigla" value="${sigla}" />
+
+
+					<!-- Checa se o documento é eletronico ou não. Caso seja, seu valor default para Data é o atual e o Responsável é quem fez o Login. -->
+					<c:choose>
+						<c:when test="${!doc.eletronico}">
+							<div class="row">
+								<div class="col-md-2 col-sm-3">
+									<div class="form-group">
+										<label for="dtMovString">Data</label> <input
+											class="form-control" type="text" name="dtMovString"
+											value="${dtMovString}"
+											onblur="javascript:verifica_data(this,0);" />
+									</div>
+								</div>
+								<div class="col-sm-6">
+									<div class="form-group">
+										<label>Responsável</label>
+										<siga:selecao tema="simple" propriedade="subscritor"
+											modulo="siga" />
+									</div>
+								</div>
+								<div class="col-sm-2 mt-4">
+									<div class="form-check form-check-inline">
+										<input class="form-check-input" type="checkbox" theme="simple"
+											name="substituicao" value="${substituicao}"
+											onclick="javascript:displayTitular(this);" /> <label
+											class="form-check-label">Substituto</label>
+									</div>
+								</div>
+							</div>
+							<div class="row">
+								<div class="col-sm-6">
+									<div class="form-group">
+										<c:choose>
+											<c:when test="${!substituicao}">
+												<div id="tr_titular" style="display: none">
+											</c:when>
+											<c:otherwise>
+												<div id="tr_titular" style="">
+											</c:otherwise>
+										</c:choose>
+										<label>Titular</label> <input class="form-control"
+											type="hidden" name="campos" value="titularSel.id" />
+										<siga:selecao propriedade="titular" tema="simple"
+											modulo="siga" />
+									</div>
+								</div>
+							</div>
+			</div>
+			<div class="row">
+				<div class="col-sm">
+					<div class="form-group">
+						<label>Função do Responsável</label> <input class="form-control"
+							type="hidden" name="campos" value="nmFuncaoSubscritor" /> <input
+							class="form-control" type="text" name="nmFuncaoSubscritor"
+							value="${nmFuncaoSubscritor}" size="50" maxLength="128"
+							theme="simple" /> <small class="form-text text-muted">(opcional)</small>
+					</div>
+				</div>
+			</div>
+			</c:when>
+			</c:choose>
+
+			<div class="row">
+				<div class="col-sm">
+					<div class="form-group">
+						<label>Documento Mestre</label>
+						<siga:selecao tema='simple' titulo="Documento Mestre:"
+							propriedade="documentoRef" urlAcao="expediente/buscar"
+							urlSelecionar="expediente/selecionar" modulo="sigaex" />
+					</div>
+				</div>
+			</div>
+
+			<tr class="button">
+				<td colspan="3"><input type="submit" value="Ok"
+					class="btn btn-primary" /> <input type="button" value="Cancela"
+					onclick="javascript:history.back();" class="btn btn-light ml-2" /></td>
+			</tr>
+			</table>
+			</form>
 		</div>
 	</div>
+	</div>
 </siga:pagina>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/juntar.jsp b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/juntar.jsp
index 6c525e425d..c04d49251f 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/juntar.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exMovimentacao/juntar.jsp
@@ -26,19 +26,19 @@
 				<c:choose>
 					<c:when test="${!doc.eletronico}">
 						<div class="row">
-							<div class="col-sm-2">
+							<div class="col-2">
 								<div class="form-group">
 									<label>Data</label> 
 									<input type="text" name="dtMovString" value="${dtMovString}" onblur="javascript:verifica_data(this, true);" class="form-control"/>
 								</div>
 							</div>
-							<div class="col-sm-6">
+							<div class="col-8">
 								<div class="form-group">
 									<label>Responsável</label> 
 									<siga:selecao tema="simple" propriedade="subscritor" modulo="siga"/>
 								</div>
 							</div>
-							<div class="col-sm-2">
+							<div class="col-2">
 								<div class="form-group">
 									<div class="form-check form-check-inline mt-4">
 										<input type="checkbox" theme="simple" name="substituicao" value="${substituicao}" onclick="javascript:displayTitular(this);" />
@@ -48,7 +48,7 @@
 							</div>
 						</div>
 						<div class="row" id="tr_titular" style="display: ${exDocumentoDTO.substituicao ? '' : 'none'};" >
-							<div class="col-sm-6" >
+							<div class="col-12" >
 							<input type="hidden" name="campos" value="titularSel.id" />
 								<div class="form-group">
 									<label>Titular</label>
@@ -60,13 +60,12 @@
 					</c:when>
 				</c:choose>
 				<div class="row">
-					<div class="col-sm-6" >
+					<div class="col-12" >
 						<div class="form-group">
 							<label>Documento</label>
 							<siga:escolha id="idDocumentoEscolha" var="idDocumentoEscolha">
 								<siga:opcao id='1' texto="Documento Interno" >
-									<p></p>
-									<siga:selecao tema='simple'  titulo="Documento Pai" propriedade="documentoRef" urlAcao="buscar" urlSelecionar="selecionar" modulo="sigaex"/>
+									<siga:selecao tema='simple' titulo="Documento Pai" propriedade="documentoRef" urlAcao="buscar" urlSelecionar="selecionar" modulo="sigaex"/>
 								</siga:opcao>
 								<siga:opcao id='2' texto="Documento Externo ao Siga-Doc" >
 									<input type="text" theme='simple' name="idDocumentoPaiExterno" value="${idDocumentoPaiExterno}" class="form-control mt-3"/>
@@ -76,7 +75,7 @@
 					</div>
 				</div>
 				<div class="row">
-					<div class="col-sm-2">
+					<div class="col-12">
 						<div class="form-group">
 							<button type="submit" class="btn btn-primary" >Ok</button>
 							<button type="button" onclick="javascript:history.back();" class="btn btn-primary" >Cancela</button>
diff --git a/sigaex/src/main/webapp/WEB-INF/page/exRelatorio/aRelRelatorios.jsp b/sigaex/src/main/webapp/WEB-INF/page/exRelatorio/aRelRelatorios.jsp
index 8392d6e8a6..4791602c52 100644
--- a/sigaex/src/main/webapp/WEB-INF/page/exRelatorio/aRelRelatorios.jsp
+++ b/sigaex/src/main/webapp/WEB-INF/page/exRelatorio/aRelRelatorios.jsp
@@ -15,6 +15,7 @@ function sbmt() {
 
 var newwindow = '';
 function visualizarRelatorio(rel) {
+	// Alterado para gerar o relatório na própria página, pois assim os erros podem ser tratados com o botão de "Voltar".
 	if (!newwindow.closed && newwindow.location) {
 	} else {
 		var popW = 600;
@@ -124,6 +125,7 @@ function visualizarRelatorio(rel) {
 		</div>
 		<div class="card-body">
 		<form name="frmRelatorios" action="${actionName}" theme="simple" method="get" enctype="multipart/form-data">
+			<input type="hidden" name="newWindow" value="1" />
 			<input type="hidden" name="postback" value="1" />
 			<input type="hidden" name="secaoUsuario" value="${lotaTitular.orgaoUsuario.descricaoMaiusculas}" />
 			<input type="hidden" name="tipoRelatorio" value="${tipoRelatorio}" />		
diff --git a/sigaex/src/main/webapp/WEB-INF/tags/assinatura_botoes.tag b/sigaex/src/main/webapp/WEB-INF/tags/assinatura_botoes.tag
index 304086e482..17474002c1 100644
--- a/sigaex/src/main/webapp/WEB-INF/tags/assinatura_botoes.tag
+++ b/sigaex/src/main/webapp/WEB-INF/tags/assinatura_botoes.tag
@@ -39,15 +39,7 @@
 	<c:if test="${assinarComSenha || autenticarComSenha}">
 		<div class="form-check form-check-inline mr-2">
 			<input class="form-check-input" type="checkbox" accesskey="c"
-				name="ad_password_0" id="ad_password_0" /> <label
-				class="form-check-label" for="ad_juntar_0"><u>C</u>om Senha</label>
-		</div>
-
-	</c:if>
-	<c:if test="${assinarComSenhaChecado || autenticarComSenhaChecado}">
-		<div class="form-check form-check-inline mr-2">
-			<input class="form-check-input" type="checkbox" accesskey="c"
-				name="ad_password_0" id="ad_password_0" checked /> <label
+				name="ad_password_0" id="ad_password_0" <c:if test="${assinarComSenhaChecado || autenticarComSenhaChecado}">checked</c:if> /> <label
 				class="form-check-label" for="ad_juntar_0"><u>C</u>om Senha</label>
 		</div>
 
diff --git a/sigaex/src/main/webapp/WEB-INF/tld/func.tld b/sigaex/src/main/webapp/WEB-INF/tld/func.tld
index af787bf0d3..80acb3a5be 100644
--- a/sigaex/src/main/webapp/WEB-INF/tld/func.tld
+++ b/sigaex/src/main/webapp/WEB-INF/tld/func.tld
@@ -377,15 +377,30 @@
   <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
   <function-signature>java.lang.Boolean podeAssinarComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMobil)</function-signature>
  </function>
+ <function>
+  <name>deveAssinarComSenha</name>
+  <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
+  <function-signature>java.lang.Boolean deveAssinarComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMobil)</function-signature>
+ </function>
  <function>
   <name>podeAssinarMovimentacaoComSenha</name>
   <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
   <function-signature>java.lang.Boolean podeAssinarMovimentacaoComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMovimentacao)</function-signature>
  </function>
+ <function>
+  <name>deveAssinarMovimentacaoComSenha</name>
+  <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
+  <function-signature>java.lang.Boolean deveAssinarMovimentacaoComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMovimentacao)</function-signature>
+ </function>
  <function>
   <name>podeAutenticarMovimentacaoComSenha</name>
   <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
   <function-signature>java.lang.Boolean podeAutenticarMovimentacaoComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMovimentacao)</function-signature>
+ </function>
+ <function>
+  <name>deveAutenticarMovimentacaoComSenha</name>
+  <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
+  <function-signature>java.lang.Boolean deveAutenticarMovimentacaoComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMovimentacao)</function-signature>
  </function>
   <function>
   <name>podeAssinarMovimentacaoDoMobilComSenha</name>
@@ -396,6 +411,11 @@
   <name>podeAutenticarComSenha</name>
   <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
   <function-signature>java.lang.Boolean podeAutenticarComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMobil)</function-signature>
+ </function>
+ <function>
+  <name>deveAutenticarComSenha</name>
+  <function-class>br.gov.jfrj.siga.ex.util.FuncoesEL</function-class>
+  <function-signature>java.lang.Boolean deveAutenticarComSenha(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.ex.ExMobil)</function-signature>
  </function>
   <function>
   <name>podeAutenticarDocumento</name>
diff --git a/sigaex/src/main/webapp/WEB-INF/web.xml b/sigaex/src/main/webapp/WEB-INF/web.xml
index 9e02661db5..61ca37924b 100644
--- a/sigaex/src/main/webapp/WEB-INF/web.xml
+++ b/sigaex/src/main/webapp/WEB-INF/web.xml
@@ -17,10 +17,9 @@
 		<param-value>br.gov.jfrj.siga.vraptor</param-value>
 	</context-param>
 	<context-param>
-    	<param-name>javax.servlet.jsp.jstl.fmt.localizationContext</param-name>
-    	<param-value>messages_TRF2</param-value>
-  	</context-param>
- 
+		<param-name>javax.servlet.jsp.jstl.fmt.localizationContext</param-name>
+		<param-value>messages_TRF2</param-value>
+	</context-param>
 
 	<jsp-config>
 		<jsp-property-group>
@@ -87,7 +86,6 @@
 
 	<filter-mapping>
 		<filter-name>ExFilter</filter-name>
-		<url-pattern>/servicos/*</url-pattern>
 		<url-pattern>/apis/*</url-pattern>
 	</filter-mapping>
 
@@ -114,6 +112,18 @@
 		<url-pattern>/recursos/*</url-pattern>
 	</filter-mapping>
 
+	<servlet>
+		<servlet-name>ExServlet</servlet-name>
+		<servlet-class>br.gov.jfrj.siga.ex.servlet.ExServlet</servlet-class>
+		<load-on-startup>1</load-on-startup>
+	</servlet>
+
+	<servlet-mapping>
+		<servlet-name>ExServlet</servlet-name>
+		<url-pattern>/api/v1/*</url-pattern>
+	</servlet-mapping>
+
+
 	<servlet>
 		<servlet-name>AudioCaptcha</servlet-name>
 		<servlet-class>nl.captcha.servlet.AudioCaptchaServlet</servlet-class>
@@ -234,13 +244,28 @@
 		<url-pattern>/apis/x-jus/v1/*</url-pattern>
 	</servlet-mapping>
 
-
-
 	<welcome-file-list>
 		<welcome-file>index.jsp</welcome-file>
 	</welcome-file-list>
 
+	<servlet>
+		<servlet-name>ErrorHandler</servlet-name>
+		<servlet-class>br.gov.jfrj.siga.jee.SigaErrorHandlerServlet</servlet-class>
+	</servlet>
+
+	<!-- servlet mappings -->
+	<servlet-mapping>
+		<servlet-name>ErrorHandler</servlet-name>
+		<url-pattern>/ErrorHandler</url-pattern>
+	</servlet-mapping>
+
+	<error-page>
+		<error-code>404</error-code>
+		<location>/ErrorHandler</location>
+	</error-page>
+
 	<error-page>
-		<location>/WEB-INF/page/erroGeral.jsp</location>
+		<exception-type>java.lang.Throwable</exception-type>
+		<location>/ErrorHandler</location>
 	</error-page>
 </web-app>
diff --git a/sigaex/src/main/webapp/imagens/brasao_sbc.jpg b/sigaex/src/main/webapp/imagens/brasao_sbc.jpg
new file mode 100644
index 0000000000..135a58b16a
Binary files /dev/null and b/sigaex/src/main/webapp/imagens/brasao_sbc.jpg differ
diff --git a/sigaex/src/main/webapp/javascript/exDocumentoEdita.js b/sigaex/src/main/webapp/javascript/exDocumentoEdita.js
index 00377f221e..3cb9308bb1 100644
--- a/sigaex/src/main/webapp/javascript/exDocumentoEdita.js
+++ b/sigaex/src/main/webapp/javascript/exDocumentoEdita.js
@@ -93,6 +93,8 @@ function validar(silencioso) {
 	var eletroHidden = document.getElementById('eletronicoHidden');
 	var eletro1 = document.getElementById('eletronicoCheck1');
 	var eletro2 = document.getElementById('eletronicoCheck2');
+	var hasPai = document.getElementById('hasPai');
+	var isPaiEletronico = document.getElementById('isPaiEletronico');
 	var subscritor = document.getElementById('formulario_exDocumentoDTO.subscritorSel_id');
 	var temCossignatarios = document.getElementById('temCossignatarios');
 	var descricaoAutomatica = document.getElementById('descricaoAutomatica');
@@ -112,6 +114,23 @@ function validar(silencioso) {
 		return false;
 	}
 
+    if ( eletroHidden == null ) {
+		if ( hasPai.value === 'true' ) {
+			if ( isPaiEletronico.value == 'true' && eletro2.checked) {
+				aviso(
+				"O documento deve ser digital, não pode ser de outro tipo.",
+				silencioso);
+				return false;
+			} 
+			if ( isPaiEletronico.value == 'false' && eletro1.checked) {
+				aviso(
+				"O documento deve ser físico, não pode ser de outro tipo.",
+				silencioso);
+				return false;
+			} 
+		}
+    }
+
 	var limite = document
 			.getElementsByName('exDocumentoDTO.tamanhoMaximoDescricao')[0].value;
 	if (document.getElementsByName('exDocumentoDTO.descrDocumento')[0].value.length >= limite) {
diff --git a/sigaex/src/main/webapp/paginas/menus/menu.jsp b/sigaex/src/main/webapp/paginas/menus/menu.jsp
index 14d1b2c47c..77c9e22257 100644
--- a/sigaex/src/main/webapp/paginas/menus/menu.jsp
+++ b/sigaex/src/main/webapp/paginas/menus/menu.jsp
@@ -97,7 +97,7 @@
 				<li><a class="dropdown-item" href="/sigaex/app/modelo/listar">Cadastro
 						de modelos</a></li>
 				<c:if
-					test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA:Sistema Integrado de Gestão Administrativa;DOC:Módulo de Documentos;FE:Ferramentas;DESP:Tipos de despacho')}">
+					test="${false and f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA:Sistema Integrado de Gestão Administrativa;DOC:Módulo de Documentos;FE:Ferramentas;DESP:Tipos de despacho')}">
 					<li><a class="dropdown-item"
 						href="/sigaex/app/despacho/tipodespacho/listar">Cadastro de
 							tipos de despacho</a></li>
@@ -168,7 +168,7 @@
 				</c:if>
 
 				<c:if
-					test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA:Sistema Integrado de Gestão Administrativa;DOC:Módulo de Documentos;REL:Gerar relatórios;RELMVP:Relatório de movimentações de processos')}">
+					test="${false and f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA:Sistema Integrado de Gestão Administrativa;DOC:Módulo de Documentos;REL:Gerar relatórios;RELMVP:Relatório de movimentações de processos')}">
 					<li><a class="dropdown-item"
 						href="/sigaex/app/expediente/rel/relRelatorios?nomeArquivoRel=relMovProcesso.jsp">
 							Relatório de Movimentações de Processos </a></li>
diff --git a/sigaex/src/main/webapp/public/javascript/assinatura-digital.js b/sigaex/src/main/webapp/public/javascript/assinatura-digital.js
index d95af10fdc..815adefa24 100644
--- a/sigaex/src/main/webapp/public/javascript/assinatura-digital.js
+++ b/sigaex/src/main/webapp/public/javascript/assinatura-digital.js
@@ -777,8 +777,11 @@ var process = {
 		
 	},
 	finalize : function() {
-		progressDialog.modal('dispose');
 		gAssinando = false;
+		try {
+			progressDialog.modal('dispose');
+		} catch (e) {
+		}
 	},
 	nextStep : function() {
 		if (typeof this.steps[this.index] == 'string')
diff --git a/sigagc/src/main/java/br/gov/jfrj/siga/gc/model/GcInformacao.java b/sigagc/src/main/java/br/gov/jfrj/siga/gc/model/GcInformacao.java
index 97930e2283..a84e9b6adf 100644
--- a/sigagc/src/main/java/br/gov/jfrj/siga/gc/model/GcInformacao.java
+++ b/sigagc/src/main/java/br/gov/jfrj/siga/gc/model/GcInformacao.java
@@ -37,6 +37,7 @@ import org.hibernate.annotations.SortType;
 
 import br.gov.jfrj.siga.base.AplicacaoException;
 import br.gov.jfrj.siga.base.SigaCalendar;
+import br.gov.jfrj.siga.base.util.Utils;
 import br.gov.jfrj.siga.cp.CpIdentidade;
 import br.gov.jfrj.siga.cp.CpPerfil;
 import br.gov.jfrj.siga.cp.bl.Cp;
@@ -203,17 +204,10 @@ public class GcInformacao extends Objeto {
 		return getSigla() + " - " + getMarcadoresEmHtml(pess, lota);
 	}
 
-	private String completarComZeros(int valor, int casas) {
-		String s = String.valueOf(valor);
-		while (s.length() < casas)
-			s = "0" + s;
-		return s;
-	}
-
 	public String getSigla() {
 		if (this.elaboracaoFim != null) {
 			return ou.getAcronimoOrgaoUsu() + "-GC-" + ano + "/"
-					+ completarComZeros(numero, 5);
+					+ Utils.completarComZeros(numero, 5);
 		}
 		return "TMPGC-" + id;
 	}
diff --git a/sigawf/.tern-project b/sigawf/.tern-project
deleted file mode 100644
index 2fef3d2df8..0000000000
--- a/sigawf/.tern-project
+++ /dev/null
@@ -1 +0,0 @@
-{"libs":["browser","ecma5"],"ide":{}}
\ No newline at end of file
diff --git a/sigawf/pom.xml b/sigawf/pom.xml
index 89a12e1733..4b5d08fbbb 100644
--- a/sigawf/pom.xml
+++ b/sigawf/pom.xml
@@ -1,5 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
 	<parent>
 		<artifactId>siga-doc</artifactId>
@@ -13,146 +14,10 @@
 
 	<artifactId>sigawf</artifactId>
 
-	<build>
-		<plugins>
-			<!-- vraptor static scan -->
-			<plugin>
-				<groupId>org.apache.maven.plugins</groupId>
-				<artifactId>maven-antrun-plugin</artifactId>
-				<version>1.7</version>
-				<dependencies>
-					<dependency>
-						<groupId>org.javassist</groupId>
-						<artifactId>javassist</artifactId>
-						<version>3.15.0-GA</version>
-					</dependency>
-				</dependencies>
-				<executions>
-					<execution>
-						<id>static-scanning</id>
-						<phase>package</phase>
-						<configuration>
-							<target>
-								<echo message="Starting static scanning process..." />
-								<path id="build.classpath">
-									<fileset
-										dir="${project.build.directory}/${project.build.finalName}/WEB-INF/lib"
-										includes="*.jar" />
-									<fileset dir="${project.build.directory}/../../lib/static_scan_vraptor/" includes="*.jar" />
-									
-								</path>
-								<java classpathref="build.classpath"
-									classname="br.com.caelum.vraptor.scan.VRaptorStaticScanning"
-									fork="true">
-									<arg
-										value="${project.build.directory}/${project.build.finalName}/WEB-INF/web.xml" />
-									<classpath refid="build.classpath" />
-									<classpath
-										path="${project.build.directory}/${project.build.finalName}/WEB-INF/classes" />
-								</java>
-								<war destfile="${project.build.directory}/${project.build.finalName}.war"
-									webxml="${project.build.directory}/${project.build.finalName}/WEB-INF/web.xml">
-									<fileset
-										dir="${project.build.directory}/${project.build.finalName}" />
-								</war>
-								<echo message="Static scanning process finished!" />
-							</target>
-						</configuration>
-						<goals>
-							<goal>run</goal>
-						</goals>
-					</execution>
-				</executions>
-			</plugin>
-			<!-- end vraptor static scan -->
-
-
-			<plugin>
-				<groupId>org.apache.maven.plugins</groupId>
-				<artifactId>maven-dependency-plugin</artifactId>
-				<version>2.8</version>
-				<executions>
-					<execution>
-						<id>copy-artifact</id>
-						<phase>package</phase>
-						<goals>
-							<goal>copy</goal>
-						</goals>
-						<configuration>
-							<artifactItems>
-								<artifactItem>
-									<groupId>${project.groupId}</groupId>
-									<artifactId>${project.artifactId}</artifactId>
-									<version>${project.version}</version>
-									<type>${project.packaging}</type>
-								</artifactItem>
-							</artifactItems>
-							<outputDirectory>../target</outputDirectory>
-							<stripVersion>true</stripVersion>
-						</configuration>
-					</execution>
-				</executions>
-			</plugin>
-		</plugins>
-	</build>
-
 	<dependencies>
-		<!-- JBPM -->
-		<dependency>
-			<groupId>org.jbpm.jbpm3</groupId>
-			<artifactId>jbpm-identity</artifactId>
-		</dependency>
-		<dependency>
-			<groupId>org.jbpm.jbpm3</groupId>
-			<artifactId>jbpm-jpdl</artifactId>
-		</dependency>
-
-		<dependency>
-			<groupId>org.jboss.spec.javax.servlet</groupId>
-			<artifactId>jboss-servlet-api_2.5_spec</artifactId>
-			<scope>provided</scope>
-		</dependency>
-		<dependency>
-			<groupId>org.jboss.spec.javax.servlet.jsp</groupId>
-			<artifactId>jboss-jsp-api_2.3_spec</artifactId>
-			<scope>provided</scope>
-		</dependency>
-
-		<dependency>
-			<groupId>commons-fileupload</groupId>
-			<artifactId>commons-fileupload</artifactId>
-		</dependency>
-
-		<dependency>
-			<groupId>javax.mail</groupId>
-			<artifactId>mail</artifactId>
-			<scope>provided</scope>
-		</dependency>
-
-		<dependency>
-			<groupId>net.sf.jasperreports</groupId>
-			<artifactId>jasperreports</artifactId>
-		</dependency>
-
-		<!-- Lucene -->
-		<dependency>
-			<groupId>org.apache.lucene</groupId>
-			<artifactId>lucene-analyzers</artifactId>
-		</dependency>
-
 		<dependency>
-			<groupId>org.beanshell</groupId>
-			<artifactId>bsh</artifactId>
-		</dependency>
-
-		<dependency>
-			<groupId>jsptags</groupId>
-			<artifactId>pager-taglib</artifactId>
-		</dependency>
-
-		<dependency>
-			<groupId>jaxen</groupId>
-			<artifactId>jaxen</artifactId>
+			<groupId>javax.ws.rs</groupId>
+			<artifactId>jsr311-api</artifactId>
 		</dependency>
 
 		<!-- SIGA -->
@@ -160,39 +25,22 @@
 		<dependency>
 			<groupId>siga</groupId>
 			<artifactId>siga-wf</artifactId>
-			<exclusions>
-				<exclusion>
-					<groupId>net.sf.jasperreports</groupId>
-					<artifactId>jasperreports</artifactId>
-				</exclusion>
-			</exclusions>
 		</dependency>
 
 		<dependency>
 			<groupId>siga</groupId>
-			<artifactId>siga-base</artifactId>
-		</dependency>
-		<dependency>
-			<groupId>siga</groupId>
-			<artifactId>siga-vraptor-module-old</artifactId>
-		</dependency>
-		<dependency>
-			<groupId>siga</groupId>
-			<artifactId>siga-rel</artifactId>
+			<artifactId>siga-ext</artifactId>
 		</dependency>
 
-
-		<!-- CDI -->
 		<dependency>
-			<groupId>org.jboss.spec.javax.ejb</groupId>
-			<artifactId>jboss-ejb-api_3.1_spec</artifactId>
-			<scope>provided</scope>
+			<groupId>siga</groupId>
+			<artifactId>siga-vraptor-module</artifactId>
 		</dependency>
 
 		<dependency>
 			<groupId>br.com.caelum.vraptor</groupId>
 			<artifactId>vraptor-jpa</artifactId>
-			<version>1.0.2</version>
+			<version>4.0.5</version>
 			<exclusions>
 				<exclusion>  <!-- declare the exclusion here -->
 					<groupId>org.eclipse.persistence</groupId>
@@ -201,5 +49,15 @@
 			</exclusions>
 		</dependency>
 
+		<dependency>
+			<groupId>javax.enterprise</groupId>
+			<artifactId>cdi-api</artifactId>
+			<scope>provided</scope>
+		</dependency>
+
+		<dependency>
+			<groupId>com.lowagie</groupId>
+			<artifactId>itext</artifactId>
+		</dependency>
 	</dependencies>
 </project>
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/com/caelum/vraptor/util/jpa/JPATransactionInterceptor.java b/sigawf/src/main/java/br/com/caelum/vraptor/util/jpa/JPATransactionInterceptor.java
deleted file mode 100644
index e89c802809..0000000000
--- a/sigawf/src/main/java/br/com/caelum/vraptor/util/jpa/JPATransactionInterceptor.java
+++ /dev/null
@@ -1,27 +0,0 @@
-package br.com.caelum.vraptor.util.jpa;
-
-import br.com.caelum.vraptor.Intercepts;
-import br.com.caelum.vraptor.core.InterceptorStack;
-import br.com.caelum.vraptor.interceptor.Interceptor;
-import br.com.caelum.vraptor.ioc.Component;
-import br.com.caelum.vraptor.resource.ResourceMethod;
-
-/**
- * Disables the JPATransactionInterceptor.
- * 
- * @author Renato Crivano
- */
-@Component
-@Intercepts
-public class JPATransactionInterceptor implements Interceptor {
-	public JPATransactionInterceptor() {
-	}
-
-	public void intercept(InterceptorStack stack, ResourceMethod method, Object instance) {
-		stack.next(method, instance);
-	}
-
-	public boolean accepts(ResourceMethod method) {
-		return false; // Will intercept no requests
-	}
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelEstatisticaProcedimento.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelEstatisticaProcedimento.java
index e70555cc6b..62c08158e0 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelEstatisticaProcedimento.java
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelEstatisticaProcedimento.java
@@ -26,21 +26,20 @@ import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 
-import net.sf.jasperreports.engine.JRException;
-import net.sf.jasperreports.view.JasperViewer;
-
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
 import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
 import br.gov.jfrj.siga.base.AplicacaoException;
 import br.gov.jfrj.siga.base.SigaCalendar;
-import br.gov.jfrj.siga.wf.SigaWfProperties;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
+import br.gov.jfrj.siga.wf.bl.Wf;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfMov;
+import br.gov.jfrj.siga.wf.model.WfMovTransicao;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import net.sf.jasperreports.engine.JRException;
+import net.sf.jasperreports.view.JasperViewer;
 
 /**
  * Classe que representa o relatório estatístico de procedimento.
@@ -53,27 +52,24 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 	private Double percentualMediaTruncada = 5.0;
 
 	/**
-	 * Construtor que define os parâmetros que são obrigatórios para a
-	 * construção do relatório.
+	 * Construtor que define os parâmetros que são obrigatórios para a construção do
+	 * relatório.
 	 * 
-	 * @param parametros -
-	 *            Mapa contendo os parâmetros necessários para a construção do
-	 *            relatório. As Keys do Map são: secaoUsuario - Informa a seção
-	 *            judiciária a ser impressa no cabeçalho do relatório;
-	 *            nomeProcedimento - Nome do procedimento ao qual se refere o
-	 *            relatório; dataInicial e dataFinal - datas que definem o
-	 *            período em que os procedimentos foram encerrados.
+	 * @param parametros - Mapa contendo os parâmetros necessários para a construção
+	 *                   do relatório. As Keys do Map são: secaoUsuario - Informa a
+	 *                   seção judiciária a ser impressa no cabeçalho do relatório;
+	 *                   nomeProcedimento - Nome do procedimento ao qual se refere o
+	 *                   relatório; dataInicial e dataFinal - datas que definem o
+	 *                   período em que os procedimentos foram encerrados.
 	 * @throws DJBuilderException
 	 */
 	public RelEstatisticaProcedimento(Map parametros) throws DJBuilderException {
 		super(parametros);
 		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
-					"Parâmetro secaoUsuario não informado!");
+			throw new DJBuilderException("Parâmetro secaoUsuario não informado!");
 		}
 		if (parametros.get("nomeProcedimento") == null) {
-			throw new DJBuilderException(
-					"Parâmetro nomeProcedimento não informado!");
+			throw new DJBuilderException("Parâmetro nomeProcedimento não informado!");
 		}
 		if (parametros.get("dataInicialDe") == null) {
 			throw new DJBuilderException("Parâmetro dataInicialDe não informado!");
@@ -90,21 +86,23 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 		if (parametros.get("percentualMediaTruncada") != null) {
 			Double minMediaTruncada = null;
 			Double maxMediaTruncada = null;
-			try{
-				percentualMediaTruncada = Double.valueOf(((String) parametros.get("percentualMediaTruncada")).replace(",", "."));
-				
-				minMediaTruncada = SigaWfProperties.getRelEstatGeraisMinMediaTrunc();
-				maxMediaTruncada = SigaWfProperties.getRelEstatGeraisMaxMediaTrunc();
-				
-			}catch (Exception e) {
+			try {
+				percentualMediaTruncada = Double
+						.valueOf(((String) parametros.get("percentualMediaTruncada")).replace(",", "."));
+
+				minMediaTruncada = Wf.getInstance().getProp().getRelEstatGeraisMinMediaTrunc();
+				maxMediaTruncada = Wf.getInstance().getProp().getRelEstatGeraisMaxMediaTrunc();
+
+			} catch (Exception e) {
 				throw new AplicacaoException("Não foi possível determinar a média truncada!");
 			}
 
-			if (percentualMediaTruncada < minMediaTruncada || percentualMediaTruncada > maxMediaTruncada){
-				throw new AplicacaoException("A média truncada deve ser entre " + minMediaTruncada + " e " + maxMediaTruncada);
+			if (percentualMediaTruncada < minMediaTruncada || percentualMediaTruncada > maxMediaTruncada) {
+				throw new AplicacaoException(
+						"A média truncada deve ser entre " + minMediaTruncada + " e " + maxMediaTruncada);
 			}
-			
-		}else{
+
+		} else {
 			throw new AplicacaoException("Informe o percentual da média truncada!");
 		}
 
@@ -114,37 +112,38 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 	 * Configura o layout do relatório.
 	 */
 	@Override
-	public AbstractRelatorioBaseBuilder configurarRelatorio()
-			throws DJBuilderException, JRException {
+	public AbstractRelatorioBaseBuilder configurarRelatorio() throws DJBuilderException, JRException {
 
-		this.setTitle(parametros.get("nomeProcedimento") + " [iniciado(s) de "
-				+ parametros.get("dataInicialDe") + " até " + parametros.get("dataInicialAte") + ", finalizado(s) de " 
-				+ parametros.get("dataFinalDe") + " até " + parametros.get("dataFinalAte") + "]");
+		this.setTitle(parametros.get("nomeProcedimento") + " [iniciado(s) de " + parametros.get("dataInicialDe")
+				+ " até " + parametros.get("dataInicialAte") + ", finalizado(s) de " + parametros.get("dataFinalDe")
+				+ " até " + parametros.get("dataFinalAte") + "]");
 		this.addColuna("Procedimento/Tarefa", 35, RelatorioRapido.CENTRO, false);
 		this.addColuna("Concluídos", 15, RelatorioRapido.CENTRO, false);
 		this.addColuna("Mín", 15, RelatorioRapido.CENTRO, false);
 		this.addColuna("Max", 15, RelatorioRapido.CENTRO, false);
 		this.addColuna("Méd", 15, RelatorioRapido.CENTRO, false);
-		this.addColuna("Méd Truncada " + percentualMediaTruncada.toString().replace(".", ",") + "%", 15, RelatorioRapido.CENTRO, false);
+		this.addColuna("Méd Truncada " + percentualMediaTruncada.toString().replace(".", ",") + "%", 15,
+				RelatorioRapido.CENTRO, false);
 
 		return this;
 	}
 
 	/**
-	 * Pesquisa os dados no banco de dados, realiza os cálculos estatísticos e
-	 * monta uma collection com os dados que serão apresentados no relatório.
+	 * Pesquisa os dados no banco de dados, realiza os cálculos estatísticos e monta
+	 * uma collection com os dados que serão apresentados no relatório.
 	 */
 	@Override
 	public Collection processarDados() {
 
-		//inicialização das variáveis
+		// inicialização das variáveis
 		String procedimento = (String) parametros.get("nomeProcedimento");
 
+		Long pdId = Long.parseLong((String) parametros.get("pdId"));
 		Date dataInicialDe = getDataDe("dataInicialDe");
 		Date dataInicialAte = getDataAte("dataInicialAte");
 		Date dataFinalDe = getDataDe("dataFinalDe");
 		Date dataFinalAte = getDataAte("dataFinalAte");
-		
+
 		GregorianCalendar calendario = new GregorianCalendar();
 		List<String> dados = new ArrayList<String>();
 
@@ -160,86 +159,79 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 
 		Map<Long, Long> mapaAmostraPI = new HashMap<Long, Long>();
 
-		
-		List<ProcessDefinition> listaPD = getProcessDefinitions(procedimento);
-
-		for (ProcessDefinition pd : listaPD) {
+		WfDefinicaoDeProcedimento pd = WfDefinicaoDeProcedimento.AR.findById(pdId);
+		List<WfProcedimento> listaPD = WfDao.getInstance().consultarProcedimentosParaEstatisticas(pd, dataInicialDe,
+				dataInicialAte, dataFinalDe, dataFinalAte);
 
-			List<ProcessInstance> instanciasProcesso = getProcessInstances(pd);
+		for (WfProcedimento pi : listaPD) {
+			Long duracaoPI = pi.getHisDtFim().getTime() - pi.getHisDtIni().getTime();
 
-			for (ProcessInstance pi : instanciasProcesso) {
-				Collection<TaskInstance> instanciasTarefas = pi
-						.getTaskMgmtInstance().getTaskInstances();
-
-				//se processo encerrado e dentro das datas informadas
-				if (pi.hasEnded() && iniciadoEntre(pi,dataInicialDe, dataInicialAte) && finalizadoEntre(pi,dataFinalDe,dataFinalAte)) {
-
-					Long duracaoPI = getDuracaoProcesso(pi);
+			// minPI
+			if (minPI == 0 || duracaoPI < minPI) {
+				minPI = duracaoPI;
+			}
 
-					// minPI
-					if (minPI==0 || duracaoPI < minPI) {
-						minPI = duracaoPI;
-					}
+			// maxPI
+			if (maxPI == 0 || duracaoPI > maxPI) {
+				maxPI = duracaoPI;
+			}
 
-					// maxPI
-					if (maxPI==0 || duracaoPI > maxPI) {
-						maxPI = duracaoPI;
+			// amostrasPI
+			mapaAmostraPI.put(pi.getId(), duracaoPI);
+
+			Date dtLast = null;
+			for (WfMov mov : pi.getMovimentacoes()) {
+				if (!(mov instanceof WfMovTransicao))
+					continue;
+				WfMovTransicao t = (WfMovTransicao) mov;
+				if (dtLast == null)
+					dtLast = t.getHisDtIni();
+				if (t.getDefinicaoDeTarefaDe() == null)
+					continue;
+
+				Long duracaoTarefa = t.getHisDtIni().getTime() - dtLast.getTime();
+				String nomeTarefa = t.getDefinicaoDeTarefaDe().getNome();
+
+				// min Tarefa
+				Long min = mapaMin.get(nomeTarefa);
+				if (min != null) {
+					if (duracaoTarefa < min) {
+						mapaMin.put(nomeTarefa, duracaoTarefa);
 					}
+				} else {
+					mapaMin.put(nomeTarefa, duracaoTarefa);
+				}
 
-					// amostrasPI
-					mapaAmostraPI.put(pi.getId(), duracaoPI);
-
-					for (TaskInstance ti : instanciasTarefas) {
-
-						Long duracaoTarefa = getDuracaoTarefa(ti);
-
-						// min Tarefa
-						Long min = mapaMin.get(ti.getName());
-						if (min != null) {
-							if (duracaoTarefa < min) {
-								mapaMin.put(ti.getName(), duracaoTarefa);
-							}
-						} else {
-							mapaMin.put(ti.getName(), duracaoTarefa);
-						}
-
-						// max Tarefa
-						Long max = mapaMax.get(ti.getName());
-						if (max != null) {
-							if (duracaoTarefa > max) {
-								mapaMax.put(ti.getName(), duracaoTarefa);
-							}
-						} else {
-							mapaMax.put(ti.getName(), duracaoTarefa);
-						}
-
-						// amostras Tarefas
-						ArrayList<Long> listaAmostral = mapaAmostra.get(ti
-								.getName());
-						if (listaAmostral != null) {
-							listaAmostral.add(duracaoTarefa);
-						} else {
-							listaAmostral = new ArrayList<Long>();
-							listaAmostral.add(duracaoTarefa);
-							mapaAmostra.put(ti.getName(), listaAmostral);
-						}
+				// max Tarefa
+				Long max = mapaMax.get(nomeTarefa);
+				if (max != null) {
+					if (duracaoTarefa > max) {
+						mapaMax.put(nomeTarefa, duracaoTarefa);
 					}
+				} else {
+					mapaMax.put(nomeTarefa, duracaoTarefa);
 				}
 
+				// amostras Tarefas
+				ArrayList<Long> listaAmostral = mapaAmostra.get(nomeTarefa);
+				if (listaAmostral != null) {
+					listaAmostral.add(duracaoTarefa);
+				} else {
+					listaAmostral = new ArrayList<Long>();
+					listaAmostral.add(duracaoTarefa);
+					mapaAmostra.put(nomeTarefa, listaAmostral);
+				}
 			}
-
-
 		}
 
-
 		// Estatísticas Processos
 		Estatistica e = new Estatistica();
-		ArrayList<Long> duracoesPI =new ArrayList<Long>(mapaAmostraPI.values()); 
+		ArrayList<Long> duracoesPI = new ArrayList<Long>(mapaAmostraPI.values());
 		e.setArray(duracoesPI);
-		
+
 		Double media = e.getMediaAritmetica();
 		mediaPI = media.longValue();
-		
+
 		Double medTrunc = e.getMediaAritmeticaTruncada(percentualMediaTruncada);
 		medTruncPI = medTrunc.longValue();
 
@@ -249,7 +241,7 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 			e.setArray(lista);
 			Double mediaTarefa = e.getMediaAritmetica();
 			mapaMedia.put(tarefa, mediaTarefa.longValue());
-			
+
 			Double medTruncTarefa = e.getMediaAritmeticaTruncada(percentualMediaTruncada);
 			mapaMedTrunc.put(tarefa, medTruncTarefa.longValue());
 
@@ -259,7 +251,7 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 		String[] tarefasOrdenadas = getTarefasOrdenadas(mapaMedia);
 
 		// insere dados do processo
-		dados.add("Procedimento: " +procedimento + " [TOTAL]");
+		dados.add("Procedimento: " + procedimento + " [TOTAL]");
 		dados.add(new Integer(mapaAmostraPI.size()).toString());
 		dados.add(SigaCalendar.formatDHM(minPI));
 		dados.add(SigaCalendar.formatDHM(maxPI));
@@ -270,15 +262,12 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 		// insere dados das tarefas
 		for (int i = 0; i < tarefasOrdenadas.length; i++) {
 			dados.add(tarefasOrdenadas[i]);
-			dados.add(new Integer(mapaAmostra.get(tarefasOrdenadas[i]).size())
-					.toString());
+			dados.add(new Integer(mapaAmostra.get(tarefasOrdenadas[i]).size()).toString());
 			dados.add(SigaCalendar.formatDHM(mapaMin.get(tarefasOrdenadas[i])));
 			dados.add(SigaCalendar.formatDHM(mapaMax.get(tarefasOrdenadas[i])));
-			dados.add(SigaCalendar
-					.formatDHM(mapaMedia.get(tarefasOrdenadas[i])));
+			dados.add(SigaCalendar.formatDHM(mapaMedia.get(tarefasOrdenadas[i])));
 
-			dados.add(SigaCalendar.formatDHM(mapaMedTrunc
-					.get(tarefasOrdenadas[i]).longValue()));
+			dados.add(SigaCalendar.formatDHM(mapaMedTrunc.get(tarefasOrdenadas[i]).longValue()));
 
 		}
 
@@ -286,27 +275,22 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 
 	}
 
-	private boolean iniciadoEntre(ProcessInstance pi, Date dataInicialDe,
-			Date dataInicialAte) {
-		return pi.getStart().after(dataInicialDe) && pi.getStart().before(dataInicialAte);
-	}
-
-	private boolean finalizadoEntre(ProcessInstance pi, Date dataFinalDe,
-			Date dataFinalAte) {
-		return pi.getEnd().after(dataFinalDe) && pi.getEnd().before(dataFinalAte);
-	}
-
-	private List getProcessInstances(ProcessDefinition pd) {
-		return WfContextBuilder
-				.getJbpmContext().getGraphSession().findProcessInstances(
-						pd.getId());
-	}
-
-	private List getProcessDefinitions(String procedimento) {
-		return WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findAllProcessDefinitionVersions(procedimento);
-	}
+//	private boolean iniciadoEntre(ProcessInstance pi, Date dataInicialDe, Date dataInicialAte) {
+//		return pi.getStart().after(dataInicialDe) && pi.getStart().before(dataInicialAte);
+//	}
+//
+//	private boolean finalizadoEntre(ProcessInstance pi, Date dataFinalDe, Date dataFinalAte) {
+//		return pi.getEnd().after(dataFinalDe) && pi.getEnd().before(dataFinalAte);
+//	}
+//
+//	private List getProcessInstances(ProcessDefinition pd) {
+//		return WfContextBuilder.getJbpmContext().getGraphSession().findProcessInstances(pd.getId());
+//	}
+//
+//	private List getProcessDefinitions(String procedimento) {
+//		return WfContextBuilder.getJbpmContext().getJbpmContext().getGraphSession()
+//				.findAllProcessDefinitionVersions(procedimento);
+//	}
 
 	/**
 	 * Retorna a lista de tarefas por ordem de média.
@@ -347,10 +331,12 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 		}
 		return resultado;
 	}
+
 	/**
 	 * Retorna um objeto Date com a data passada como parêmetro. ATENÇÃO: Este
-	 * método pode ser reescrito com um DateFormat em um refactoring posterior.
-	 * A data é definida como hh:mm:ss = 00:00:00
+	 * método pode ser reescrito com um DateFormat em um refactoring posterior. A
+	 * data é definida como hh:mm:ss = 00:00:00
+	 * 
 	 * @param data
 	 * @return
 	 */
@@ -358,17 +344,17 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 		String pDT = (String) parametros.get(data);
 		GregorianCalendar dt = new GregorianCalendar();
 
-		dt.set(new Integer(pDT.substring(6)),
-				new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT
-						.substring(0, 2)), 0, 0, 0);
+		dt.set(new Integer(pDT.substring(6)), new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT.substring(0, 2)), 0,
+				0, 0);
 		return dt.getTime();
 
 	}
-	
+
 	/**
 	 * Retorna um objeto Date com a data passada como parêmetro. ATENÇÃO: Este
-	 * método pode ser reescrito com um DateFormat em um refactoring posterior.
-	 * A data é definida como hh:mm:ss = 23:59:59
+	 * método pode ser reescrito com um DateFormat em um refactoring posterior. A
+	 * data é definida como hh:mm:ss = 23:59:59
+	 * 
 	 * @param data
 	 * @return
 	 */
@@ -376,55 +362,12 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 		String pDT = (String) parametros.get(data);
 		GregorianCalendar dt = new GregorianCalendar();
 
-		dt.set(new Integer(pDT.substring(6)),
-				new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT
-						.substring(0, 2)), 23, 59, 59);
+		dt.set(new Integer(pDT.substring(6)), new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT.substring(0, 2)),
+				23, 59, 59);
 		return dt.getTime();
 
 	}
 
-	/**
-	 * Retorna quanto tempo uma tarefa demou para ser concluída. O resultado é
-	 * em milissegundos.
-	 * 
-	 * @param ti
-	 * @return
-	 */
-	private long getDuracaoTarefa(TaskInstance ti) {
-
-		SigaCalendar inicio = new SigaCalendar();
-		SigaCalendar fim = new SigaCalendar();
-
-		inicio.setTime(ti.getCreate());
-		fim.setTime(ti.getEnd());
-
-		long tInicio = inicio.getTimeInMillis();
-		long tFim = fim.getTimeInMillis();
-
-		return tFim - tInicio;
-	}
-
-	/**
-	 * Retorna quanto tempo um processo demorou para ser concluído. O resultado
-	 * é em milissegundos.
-	 * 
-	 * @param pi
-	 * @return
-	 */
-	private long getDuracaoProcesso(ProcessInstance pi) {
-
-		SigaCalendar inicio = new SigaCalendar();
-		SigaCalendar fim = new SigaCalendar();
-
-		inicio.setTime(pi.getStart());
-		fim.setTime(pi.getEnd());
-
-		long tInicio = inicio.getTimeInMillis();
-		long tFim = fim.getTimeInMillis();
-
-		return tFim - tInicio;
-	}
-
 	/**
 	 * Utilizado para realizar testes no relatório. ATENÇÃO; Uma classe de teste
 	 * (JUnit) deve ser criada para substituir este método.
@@ -439,8 +382,7 @@ public class RelEstatisticaProcedimento extends RelatorioTemplate {
 		parametros.put("secaoUsuario", "SJRJ");
 
 		try {
-			RelEstatisticaProcedimento rep = new RelEstatisticaProcedimento(
-					parametros);
+			RelEstatisticaProcedimento rep = new RelEstatisticaProcedimento(parametros);
 			rep.gerar();
 			JasperViewer.viewReport(rep.getRelatorioJasperPrint());
 		} catch (JRException e) {
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDoc.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDoc.java
index 96ce82fece..b28334e8e1 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDoc.java
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDoc.java
@@ -30,12 +30,7 @@ import java.util.Map;
 import java.util.Set;
 import java.util.TreeSet;
 
-import net.sf.jasperreports.engine.JRException;
-
 import org.hibernate.SQLQuery;
-import org.hibernate.type.CalendarType;
-import org.hibernate.type.LongType;
-import org.hibernate.type.StringType;
 
 import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
@@ -43,6 +38,9 @@ import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
 import br.gov.jfrj.siga.base.SigaCalendar;
 import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import net.sf.jasperreports.engine.JRException;
 
 /**
  * Classe que representa o relatório de docs que demoraram
@@ -53,43 +51,37 @@ import br.gov.jfrj.siga.wf.dao.WfDao;
 public class RelTempoDoc extends RelatorioTemplate {
 
 	/**
-	 * Construtor que define os parâmetros que são obrigatórios para a
-	 * construção do relatório.
+	 * Construtor que define os parâmetros que são obrigatórios para a construção do
+	 * relatório.
 	 * 
-	 * @param parametros
-	 *            - Mapa contendo os parâmetros necessários para a construção do
-	 *            relatório. As Keys do Map são: secaoUsuario - Informa a seção
-	 *            judiciária a ser impressa no cabeçalho do relatório;
-	 *            nomeProcedimento - Nome do procedimento ao qual se refere o
-	 *            relatório; dataInicial e dataFinal - datas que definem o
-	 *            período em que os procedimentos foram encerrados.
+	 * @param parametros - Mapa contendo os parâmetros necessários para a construção
+	 *                   do relatório. As Keys do Map são: secaoUsuario - Informa a
+	 *                   seção judiciária a ser impressa no cabeçalho do relatório;
+	 *                   nomeProcedimento - Nome do procedimento ao qual se refere o
+	 *                   relatório; dataInicial e dataFinal - datas que definem o
+	 *                   período em que os procedimentos foram encerrados.
 	 * @throws DJBuilderException
 	 */
 	public RelTempoDoc(Map parametros) throws DJBuilderException {
 		super(parametros);
 		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
-					"Parâmetro secaoUsuario não informado!");
+			throw new DJBuilderException("Parâmetro secaoUsuario não informado!");
 		}
 		if (parametros.get("nomeProcedimento") == null) {
-			throw new DJBuilderException(
-					"Parâmetro nomeProcedimento não informado!");
+			throw new DJBuilderException("Parâmetro nomeProcedimento não informado!");
 		}
 
 		if (parametros.get("dataInicialDe") == null) {
-			throw new DJBuilderException(
-					"Parâmetro dataInicialDe não informado!");
+			throw new DJBuilderException("Parâmetro dataInicialDe não informado!");
 		}
 		if (parametros.get("dataInicialAte") == null) {
-			throw new DJBuilderException(
-					"Parâmetro dataInicialAte não informado!");
+			throw new DJBuilderException("Parâmetro dataInicialAte não informado!");
 		}
 		if (parametros.get("dataFinalDe") == null) {
 			throw new DJBuilderException("Parâmetro dataFinalDe não informado!");
 		}
 		if (parametros.get("dataFinalAte") == null) {
-			throw new DJBuilderException(
-					"Parâmetro dataFinalAte não informado!");
+			throw new DJBuilderException("Parâmetro dataFinalAte não informado!");
 		}
 	}
 
@@ -97,14 +89,11 @@ public class RelTempoDoc extends RelatorioTemplate {
 	 * Configura o layout do relatório.
 	 */
 	@Override
-	public AbstractRelatorioBaseBuilder configurarRelatorio()
-			throws DJBuilderException, JRException {
-
-		this.setTitle(parametros.get("nomeProcedimento") + " [iniciado(s) de "
-				+ parametros.get("dataInicialDe") + " até "
-				+ parametros.get("dataInicialAte") + ", finalizado(s) de "
-				+ parametros.get("dataFinalDe") + " até "
-				+ parametros.get("dataFinalAte") + "]");
+	public AbstractRelatorioBaseBuilder configurarRelatorio() throws DJBuilderException, JRException {
+
+		this.setTitle(parametros.get("nomeProcedimento") + " [iniciado(s) de " + parametros.get("dataInicialDe")
+				+ " até " + parametros.get("dataInicialAte") + ", finalizado(s) de " + parametros.get("dataFinalDe")
+				+ " até " + parametros.get("dataFinalAte") + "]");
 		this.addColuna("Documento", 25, RelatorioRapido.CENTRO, false);
 		this.addColuna("Início", 25, RelatorioRapido.CENTRO, false);
 		this.addColuna("Fim", 25, RelatorioRapido.CENTRO, false);
@@ -122,22 +111,21 @@ public class RelTempoDoc extends RelatorioTemplate {
 
 		// inicialização das variáveis
 		String procedimento = (String) parametros.get("nomeProcedimento");
+		Long pdId = Long.parseLong((String) parametros.get("pdId"));
 		Date dataInicialDe = getDataDe("dataInicialDe");
 		Date dataInicialAte = getDataAte("dataInicialAte");
 		Date dataFinalDe = getDataDe("dataFinalDe");
 		Date dataFinalAte = getDataAte("dataFinalAte");
 		Boolean incluirAbertos = parametros.get("incluirAbertos") == null ? false
-				: Boolean.valueOf(parametros.get("incluirAbertos").toString()
-						.equals("on"));
+				: Boolean.valueOf(parametros.get("incluirAbertos").toString().equals("on"));
 
-		Set<Doc> docs = consultarDocs(procedimento, dataInicialDe,
-				dataInicialAte, dataFinalDe, dataFinalAte, incluirAbertos);
+		WfDefinicaoDeProcedimento pd = WfDefinicaoDeProcedimento.AR.findById(pdId);
+		Set<Doc> docs = consultarDocs(pd, dataInicialDe, dataInicialAte, dataFinalDe, dataFinalAte, incluirAbertos);
 		List<String> dados = new ArrayList<String>();
 		for (Doc s : docs) {
 			dados.add(s.getNumeroDoc());
 			dados.add(DateFormat.getInstance().format(s.getInicio().getTime()));
-			dados.add(s.getFim() == null ? "Em Andamento" : DateFormat
-					.getInstance().format(s.getFim().getTime()));
+			dados.add(s.getFim() == null ? "Em Andamento" : DateFormat.getInstance().format(s.getFim().getTime()));
 			dados.add(s.getDuracao());
 		}
 		return dados;
@@ -145,20 +133,20 @@ public class RelTempoDoc extends RelatorioTemplate {
 	}
 
 	/**
-	 * Retorna os docs no período indicado, ordenadas pelo tempo de demora,
-	 * podendo estar ou não finalizados.
+	 * Retorna os docs no período indicado, ordenadas pelo tempo de demora, podendo
+	 * estar ou não finalizados.
 	 * 
 	 * Exemplo da query:
 	 * 
 	 * SELECT PI.START_,PI.END_,VI.STRINGVALUE_,PI.ID_ FROM
 	 * SIGAWF.JBPM_PROCESSINSTANCE PI, (SELECT DISTINCT PROCESSINSTANCE_,
-	 * STRINGVALUE_ FROM SIGAWF.JBPM_VARIABLEINSTANCE WHERE NAME_ LIKE 'doc_%'
-	 * AND STRINGVALUE_ LIKE '%-_' AND STRINGVALUE_ IS NOT NULL) VI, (SELECT *
-	 * FROM SIGAWF.JBPM_PROCESSDEFINITION WHERE NAME_ = 'Contratação: fase de
-	 * análise') PD WHERE PI.PROCESSDEFINITION_=PD.ID_ AND PI.END_ IS NOT NULL
-	 * AND PI.ID_ = VI.PROCESSINSTANCE_ AND (PI.START_ >= To_Date('01/03/2011')
-	 * and PI.START_ <= To_Date('31/03/2011')) AND (PI.END_ >=
-	 * To_Date('01/03/2011') and PI.END_ <= To_Date('31/05/2011')) ;
+	 * STRINGVALUE_ FROM SIGAWF.JBPM_VARIABLEINSTANCE WHERE NAME_ LIKE 'doc_%' AND
+	 * STRINGVALUE_ LIKE '%-_' AND STRINGVALUE_ IS NOT NULL) VI, (SELECT * FROM
+	 * SIGAWF.JBPM_PROCESSDEFINITION WHERE NAME_ = 'Contratação: fase de análise')
+	 * PD WHERE PI.PROCESSDEFINITION_=PD.ID_ AND PI.END_ IS NOT NULL AND PI.ID_ =
+	 * VI.PROCESSINSTANCE_ AND (PI.START_ >= To_Date('01/03/2011') and PI.START_ <=
+	 * To_Date('31/03/2011')) AND (PI.END_ >= To_Date('01/03/2011') and PI.END_ <=
+	 * To_Date('31/05/2011')) ;
 	 * 
 	 * 
 	 * @param dataInicial
@@ -168,81 +156,33 @@ public class RelTempoDoc extends RelatorioTemplate {
 	 * @param incluirAbertos
 	 * @return
 	 */
-	private Set<Doc> consultarDocs(String nomeProcedimento, Date dataInicialDe,
-			Date dataInicialAte, Date dataFinalDe, Date dataFinalAte,
-			Boolean incluirAbertos) {
-		SQLQuery query = null;
-		if (incluirAbertos) {
-			query = (SQLQuery) WfDao
-					.getInstance()
-					.getSessao()
-					.createSQLQuery(
-							getSQLConsultarDocumentosFinalizadosEAbertosNoPeriodo());
-		} else {
-			query = (SQLQuery) WfDao
-					.getInstance()
-					.getSessao()
-					.createSQLQuery(
-							getSQLConsultarDocumentosFinalizadosNoPeriodo());
-		}
-
-		query.addScalar("START_", new CalendarType());
-		query.addScalar("END_", new CalendarType());
-		query.addScalar("STRINGVALUE_", new StringType());
-		query.addScalar("ID_", new LongType());
+	private Set<Doc> consultarDocs(WfDefinicaoDeProcedimento pd, Date dataInicialDe, Date dataInicialAte,
+			Date dataFinalDe, Date dataFinalAte, Boolean incluirAbertos) {
 
 		dataInicialAte = inclusiveData(dataInicialAte);
 		dataFinalAte = inclusiveData(dataFinalAte);
 
-		query.setString("nomeProcedimento", nomeProcedimento);
-		query.setDate("dataInicialDe", dataInicialDe);
-		query.setDate("dataInicialAte", dataInicialAte);
-		query.setDate("dataFinalDe", dataFinalDe);
-		query.setDate("dataFinalAte", dataFinalAte);
-		List<Object[]> resultado = query.list();
+		List<WfProcedimento> l;
+		if (incluirAbertos)
+			l = WfDao.getInstance().consultarProcedimentosParaEstatisticasPorPrincipalInclusiveNaoFinalizados(pd,
+					dataInicialDe, dataInicialAte, dataFinalDe, dataFinalAte);
+		else
+			l = WfDao.getInstance().consultarProcedimentosParaEstatisticasPorPrincipal(pd, dataInicialDe,
+					dataInicialAte, dataFinalDe, dataFinalAte);
+
 		Set<Doc> docs = new TreeSet<Doc>(new DocComparator());
-		for (Object[] o : resultado) {
+		for (WfProcedimento p : l) {
 			Doc s = new Doc();
-			Calendar inicio = (Calendar) o[0];
-			Calendar fim = (Calendar) o[1];
-			s.setNumeroDoc(o[2].toString());
-			s.setInicio(inicio);
-			s.setFim(fim);
-			s.setProcessInstanceID((Long) (o[3]));
+			s.setNumeroDoc(p.getPrincipal());
+			s.setInicio(buildCalendar(p.getHisDtIni()));
+			s.setFim(buildCalendar(p.getHisDtFim()));
+			s.setProcessInstanceID(p.getId());
 			docs.add(s);
 		}
 
 		return docs;
 	}
 
-	private String getSQLConsultarDocumentosFinalizadosEAbertosNoPeriodo() {
-		return "SELECT "
-				+ "PI.START_,PI.END_,VI.STRINGVALUE_,PI.ID_ "
-				+ "FROM  "
-				+ "JBPM_PROCESSINSTANCE PI, "
-				+ "(SELECT DISTINCT PROCESSINSTANCE_, STRINGVALUE_ FROM JBPM_VARIABLEINSTANCE WHERE NAME_ LIKE 'doc_%' AND STRINGVALUE_ LIKE '%-_' AND STRINGVALUE_ IS NOT NULL) VI, "
-				+ "(SELECT ID_ FROM JBPM_PROCESSDEFINITION WHERE NAME_ = :nomeProcedimento) PD  "
-				+ "WHERE "
-				+ "PI.PROCESSDEFINITION_=PD.ID_ AND "
-				+ "PI.ID_ = VI.PROCESSINSTANCE_ AND   "
-				+ "(PI.START_ >= :dataInicialDe and PI.START_ <= :dataInicialAte) AND "
-				+ "(PI.END_ >= :dataFinalDe and PI.END_ <= :dataFinalAte OR PI.END_ IS NULL)";
-	}
-
-	private String getSQLConsultarDocumentosFinalizadosNoPeriodo() {
-		return "SELECT PI.START_,PI.END_,VI.STRINGVALUE_,PI.ID_ "
-				+ "FROM "
-				+ "JBPM_PROCESSINSTANCE PI, "
-				+ "(SELECT DISTINCT PROCESSINSTANCE_, STRINGVALUE_ FROM JBPM_VARIABLEINSTANCE WHERE NAME_ LIKE 'doc_%' AND STRINGVALUE_ LIKE '%-_' AND STRINGVALUE_ IS NOT NULL) VI, "
-				+ "(SELECT ID_ FROM JBPM_PROCESSDEFINITION WHERE NAME_ = :nomeProcedimento) PD "
-				+ "WHERE "
-				+ "PI.PROCESSDEFINITION_=PD.ID_ AND "
-				+ "PI.END_ IS NOT NULL AND  "
-				+ "PI.ID_ = VI.PROCESSINSTANCE_ AND "
-				+ "(PI.START_ >= :dataInicialDe and PI.START_ <= :dataInicialAte) AND "
-				+ "(PI.END_ >= :dataFinalDe and PI.END_ <= :dataFinalAte) ";
-	}
-
 	/**
 	 * Soma um dia à data para que esta possa estar incluída na pesquisa.
 	 * 
@@ -258,8 +198,8 @@ public class RelTempoDoc extends RelatorioTemplate {
 
 	/**
 	 * Retorna um objeto Date com a data passada como parêmetro. ATENÇÃO: Este
-	 * método pode ser reescrito com um DateFormat em um refactoring posterior.
-	 * A data é definida como hh:mm:ss = 00:00:00
+	 * método pode ser reescrito com um DateFormat em um refactoring posterior. A
+	 * data é definida como hh:mm:ss = 00:00:00
 	 * 
 	 * @param data
 	 * @return
@@ -268,17 +208,16 @@ public class RelTempoDoc extends RelatorioTemplate {
 		String pDT = (String) parametros.get(data);
 		GregorianCalendar dt = new GregorianCalendar();
 
-		dt.set(new Integer(pDT.substring(6)),
-				new Integer(pDT.substring(3, 5)) - 1,
-				new Integer(pDT.substring(0, 2)), 0, 0, 0);
+		dt.set(new Integer(pDT.substring(6)), new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT.substring(0, 2)), 0,
+				0, 0);
 		return dt.getTime();
 
 	}
 
 	/**
 	 * Retorna um objeto Date com a data passada como parêmetro. ATENÇÃO: Este
-	 * método pode ser reescrito com um DateFormat em um refactoring posterior.
-	 * A data é definida como hh:mm:ss = 23:59:59
+	 * método pode ser reescrito com um DateFormat em um refactoring posterior. A
+	 * data é definida como hh:mm:ss = 23:59:59
 	 * 
 	 * @param data
 	 * @return
@@ -287,13 +226,20 @@ public class RelTempoDoc extends RelatorioTemplate {
 		String pDT = (String) parametros.get(data);
 		GregorianCalendar dt = new GregorianCalendar();
 
-		dt.set(new Integer(pDT.substring(6)),
-				new Integer(pDT.substring(3, 5)) - 1,
-				new Integer(pDT.substring(0, 2)), 23, 59, 59);
+		dt.set(new Integer(pDT.substring(6)), new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT.substring(0, 2)),
+				23, 59, 59);
 		return dt.getTime();
 
 	}
 
+	private Calendar buildCalendar(Date data) {
+		if (data == null)
+			return null;
+		Calendar c = Calendar.getInstance();
+		c.setTime(data);
+		return c;
+	}
+
 	class Doc {
 		private String numeroDoc;
 		private Calendar inicio;
@@ -314,8 +260,7 @@ public class RelTempoDoc extends RelatorioTemplate {
 
 		public long getDuracaoEmMili() {
 			if (getFim() == null || getInicio() == null) {
-				return Calendar.getInstance().getTimeInMillis()
-						- getInicio().getTimeInMillis();
+				return Calendar.getInstance().getTimeInMillis() - getInicio().getTimeInMillis();
 			}
 			return getFim().getTimeInMillis() - getInicio().getTimeInMillis();
 		}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDocDetalhado.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDocDetalhado.java
index b6a3068cab..bcd924f5f6 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDocDetalhado.java
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/relatorio/RelTempoDocDetalhado.java
@@ -36,50 +36,44 @@ import org.hibernate.SQLQuery;
 import org.hibernate.type.CalendarType;
 import org.hibernate.type.StringType;
 
-
-
-
-
 import br.gov.jfrj.relatorio.dinamico.AbstractRelatorioBaseBuilder;
 import br.gov.jfrj.relatorio.dinamico.RelatorioRapido;
 import br.gov.jfrj.relatorio.dinamico.RelatorioTemplate;
 import ar.com.fdvs.dj.domain.builders.DJBuilderException;
 import br.gov.jfrj.siga.base.SigaCalendar;
 import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfMov;
+import br.gov.jfrj.siga.wf.model.WfMovTransicao;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
 
 public class RelTempoDocDetalhado extends RelatorioTemplate {
 
 	public RelTempoDocDetalhado(Map parametros) throws DJBuilderException {
 		super(parametros);
 		if (parametros.get("secaoUsuario") == null) {
-			throw new DJBuilderException(
-					"Parâmetro secaoUsuario não informado!");
+			throw new DJBuilderException("Parâmetro secaoUsuario não informado!");
 		}
 		if (parametros.get("nomeProcedimento") == null) {
-			throw new DJBuilderException(
-					"Parâmetro nomeProcedimento não informado!");
+			throw new DJBuilderException("Parâmetro nomeProcedimento não informado!");
 		}
 
 		if (parametros.get("dataInicialDe") == null) {
-			throw new DJBuilderException(
-					"Parâmetro dataInicialDe não informado!");
+			throw new DJBuilderException("Parâmetro dataInicialDe não informado!");
 		}
 		if (parametros.get("dataInicialAte") == null) {
-			throw new DJBuilderException(
-					"Parâmetro dataInicialAte não informado!");
+			throw new DJBuilderException("Parâmetro dataInicialAte não informado!");
 		}
 		if (parametros.get("dataFinalDe") == null) {
 			throw new DJBuilderException("Parâmetro dataFinalDe não informado!");
 		}
 		if (parametros.get("dataFinalAte") == null) {
-			throw new DJBuilderException(
-					"Parâmetro dataFinalAte não informado!");
+			throw new DJBuilderException("Parâmetro dataFinalAte não informado!");
 		}
 	}
 
 	@Override
-	public AbstractRelatorioBaseBuilder configurarRelatorio()
-			throws DJBuilderException, JRException {
+	public AbstractRelatorioBaseBuilder configurarRelatorio() throws DJBuilderException, JRException {
 
 		this.setTitle("Tarefas por DOC");
 		this.addColuna("Número do DOC", 20, RelatorioRapido.ESQUERDA, true);
@@ -95,73 +89,72 @@ public class RelTempoDocDetalhado extends RelatorioTemplate {
 	public Collection processarDados() {
 
 		String procedimento = (String) parametros.get("nomeProcedimento");
+		Long pdId = Long.parseLong((String) parametros.get("pdId"));
 		Date dataInicialDe = getDataDe("dataInicialDe");
 		Date dataInicialAte = getDataAte("dataInicialAte");
 		Date dataFinalDe = getDataDe("dataFinalDe");
 		Date dataFinalAte = getDataAte("dataFinalAte");
-		Boolean incluirAbertos = parametros.get("incluirAbertos")==null?false:Boolean.valueOf(parametros.get("incluirAbertos").toString().equals("on"));
-		String grupoIni = parametros.get("inicioGrupo")==null?"-1":(String) parametros.get("inicioGrupo");
-		String grupoFim = parametros.get("fimGrupo")==null?"-1":(String) parametros.get("fimGrupo");
-		
+		Boolean incluirAbertos = parametros.get("incluirAbertos") == null ? false
+				: Boolean.valueOf(parametros.get("incluirAbertos").toString().equals("on"));
+		String grupoIni = parametros.get("inicioGrupo") == null ? "-1" : (String) parametros.get("inicioGrupo");
+		String grupoFim = parametros.get("fimGrupo") == null ? "-1" : (String) parametros.get("fimGrupo");
+
 		EstatisticaGrupoRel estatisticaGrp = new EstatisticaGrupoRel();
-		Set<Tarefa> tarefas = consultarTarefas(procedimento, dataInicialDe,
-				dataInicialAte, dataFinalDe, dataFinalAte,incluirAbertos);
+		WfDefinicaoDeProcedimento pd = WfDefinicaoDeProcedimento.AR.findById(pdId);
+		Set<Tarefa> tarefas = consultarTarefas(pd, dataInicialDe, dataInicialAte, dataFinalDe, dataFinalAte,
+				incluirAbertos);
 		List<String> dados = new ArrayList<String>();
-		
+
 		String ultimoDoc = null;
 		Tarefa ultimaTarefa = null;
 		DetectorGrupoRel detectGrupo = null;
 		List<Tarefa> grupoAtual = new ArrayList<RelTempoDocDetalhado.Tarefa>();
 		int linhaInicioGrupo = -1;
 		for (Tarefa t : tarefas) {
-			
-			if (ultimoDoc != null && !t.getNumeroDocumento().equals(ultimoDoc)){
-				addLinhaSumarioGrupo(estatisticaGrp,ultimaTarefa,dados);
+
+			if (ultimoDoc != null && !t.getNumeroDocumento().equals(ultimoDoc)) {
+				addLinhaSumarioGrupo(estatisticaGrp, ultimaTarefa, dados);
 			}
-			
-			//processamento inicial de grupo
-			if (ultimoDoc == null || !t.getNumeroDocumento().equals(ultimoDoc)){
+
+			// processamento inicial de grupo
+			if (ultimoDoc == null || !t.getNumeroDocumento().equals(ultimoDoc)) {
 				detectGrupo = new DetectorGrupoRel(grupoIni, grupoFim);
 				grupoAtual.clear();
 			}
-			
-			
-			
-			if (detectGrupo.fazParteDoGrupo(t.getNome()) && detectGrupo.isInicio()){
+
+			if (detectGrupo.fazParteDoGrupo(t.getNome()) && detectGrupo.isInicio()) {
 				linhaInicioGrupo = dados.size();
 				detectGrupo.continuar();
 			}
-			
-			if(detectGrupo.fazParteDoGrupo(t.getNome())){
+
+			if (detectGrupo.fazParteDoGrupo(t.getNome())) {
 				grupoAtual.add(t);
 			}
-			
+
 			addLinha(dados, t);
-			
-			//processamento final de grupo
-			if (detectGrupo.fazParteDoGrupo(t.getNome()) && detectGrupo.isFim()){
-				addLinhaEmBranco(t,dados,linhaInicioGrupo);
-				addLinhaTotalGrupo(grupoAtual,dados);
-				addLinhaEmBranco(t,dados);
+
+			// processamento final de grupo
+			if (detectGrupo.fazParteDoGrupo(t.getNome()) && detectGrupo.isFim()) {
+				addLinhaEmBranco(t, dados, linhaInicioGrupo);
+				addLinhaTotalGrupo(grupoAtual, dados);
+				addLinhaEmBranco(t, dados);
 				estatisticaGrp.addGrupo(grupoAtual);
 				detectGrupo.reiniciarAvaliacao();
 				grupoAtual.clear();
 			}
-			
+
 			ultimoDoc = t.getNumeroDocumento();
 			ultimaTarefa = t;
 		}
-		
-		addLinhaFinal(estatisticaGrp,dados,ultimaTarefa);
+
+		addLinhaFinal(estatisticaGrp, dados, ultimaTarefa);
 
 		return dados;
 
 	}
 
+	private void addLinhaFinal(EstatisticaGrupoRel est, List<String> dados, Tarefa ultimaTarefa) {
 
-	private void addLinhaFinal(EstatisticaGrupoRel est,
-			List<String> dados, Tarefa ultimaTarefa) {
-	
 		dados.add("Informações Gerais");
 
 		dados.add("MEDIA GERAL [Grupos]");
@@ -171,38 +164,34 @@ public class RelTempoDocDetalhado extends RelatorioTemplate {
 
 	}
 
-	private void addLinhaSumarioGrupo(EstatisticaGrupoRel est , Tarefa t, List<String> dados) {
+	private void addLinhaSumarioGrupo(EstatisticaGrupoRel est, Tarefa t, List<String> dados) {
 		String mediaGrupo = est.getMediaGrupo(t.getNumeroDocumento());
-		if (!mediaGrupo.equals("0")){
+		if (!mediaGrupo.equals("0")) {
 			addLinhaEmBranco(t, dados);
-			
-			dados.add(t.getNumeroDocumento() + " ("
-					+ t.getDuracaoProcedimento() + ")");
+
+			dados.add(t.getNumeroDocumento() + " (" + t.getDuracaoProcedimento() + ")");
 
 			dados.add("MEDIA [Grupos]");
 			dados.add("");
 			dados.add("");
 			dados.add(est.getMediaGrupo(t.getNumeroDocumento()));
 			addLinhaEmBranco(t, dados);
-			
+
 		}
 	}
 
 	private void addLinha(List<String> dados, Tarefa t) {
-		dados.add(t.getNumeroDocumento() + " ("
-				+ t.getDuracaoProcedimento() + ")");
+		dados.add(t.getNumeroDocumento() + " (" + t.getDuracaoProcedimento() + ")");
 		dados.add(t.getNome());
-		dados.add(DateFormat.getInstance().format(
-				t.getDataInicio().getTime()));
-		dados.add(t.getDataFim()==null?"Em Andamento":DateFormat.getInstance().format(t.getDataFim().getTime()));
+		dados.add(DateFormat.getInstance().format(t.getDataInicio().getTime()));
+		dados.add(t.getDataFim() == null ? "Em Andamento" : DateFormat.getInstance().format(t.getDataFim().getTime()));
 		dados.add(t.getDuracao().toString());
 	}
 
 	private void addLinhaTotalGrupo(List<Tarefa> grupoAtual, List<String> dados) {
 		long duracao = calcularDuracao(grupoAtual);
-		
-		dados.add(grupoAtual.get(0).getNumeroDocumento() + " ("
-				+ grupoAtual.get(0).getDuracaoProcedimento() + ")");
+
+		dados.add(grupoAtual.get(0).getNumeroDocumento() + " (" + grupoAtual.get(0).getDuracaoProcedimento() + ")");
 		dados.add("TOTAL [Grupo]");
 		dados.add("");
 		dados.add("");
@@ -217,141 +206,82 @@ public class RelTempoDocDetalhado extends RelatorioTemplate {
 		return duracao;
 	}
 
-	private void addLinhaEmBranco(Tarefa t, List<String> dados,int posicao) {
-		if (posicao<=-1){
+	private void addLinhaEmBranco(Tarefa t, List<String> dados, int posicao) {
+		if (posicao <= -1) {
 			posicao = dados.size();
 		}
-		dados.add(posicao,"");
-		dados.add(posicao,"");
-		dados.add(posicao,"");
-		dados.add(posicao,"");
-		dados.add(posicao,t.getNumeroDocumento() + " ("
-				+ t.getDuracaoProcedimento() + ")");
+		dados.add(posicao, "");
+		dados.add(posicao, "");
+		dados.add(posicao, "");
+		dados.add(posicao, "");
+		dados.add(posicao, t.getNumeroDocumento() + " (" + t.getDuracaoProcedimento() + ")");
 
 	}
-	
-	private void addLinhaEmBranco(Tarefa t, List<String> dados){
+
+	private void addLinhaEmBranco(Tarefa t, List<String> dados) {
 		addLinhaEmBranco(t, dados, -1);
 	}
 
-	private Set<Tarefa> consultarTarefas(String nomeProcedimento,
-			Date dataInicialDe, Date dataInicialAte, Date dataFinalDe,
-			Date dataFinalAte,Boolean incluirAbertos) {
-		// ArrayList<Tarefa> tarefas = new ArrayList<Tarefa>();
-		// Tarefa t1 = new Tarefa();
-		// Tarefa t2 = new Tarefa();
-		//
-		// t1.setNome("t1");
-		// t1.setDataFim("01/01/2000");
-		// t1.setDataInicio("01/01/2000");
-		// t1.setDuracao("5 seg");
-		//
-		// t2.setNome("t2");
-		// t2.setDataFim("01/01/1999");
-		// t2.setDataInicio("01/01/1888");
-		// t2.setDuracao("5 seg");
-		//
-		// tarefas.add(t1);
-		// tarefas.add(t2);
-		// return tarefas;
-
-		// String sql =
-		// "SELECT PI.START_,PI.END_,VI.STRINGVALUE_,PI.ID_ FROM JBPM_PROCESSINSTANCE PI, (SELECT DISTINCT PROCESSINSTANCE_, STRINGVALUE_ FROM JBPM_VARIABLEINSTANCE WHERE NAME_ LIKE 'doc_%' AND STRINGVALUE_ LIKE '%-_' AND STRINGVALUE_ IS NOT NULL) VI, (SELECT ID_ FROM JBPM_PROCESSDEFINITION WHERE NAME_ = :nomeProcedimento) PD WHERE PI.PROCESSDEFINITION_=PD.ID_ AND PI.END_ IS NOT NULL AND PI.ID_ = VI.PROCESSINSTANCE_ AND  (PI.START_ >= :dataInicialDe and PI.START_ <= :dataInicialAte) AND (PI.END_ >= :dataFinalDe and PI.END_ <= :dataFinalAte)";
-
-		SQLQuery query = null;
-		if (incluirAbertos){
-			query = (SQLQuery) WfDao.getInstance().getSessao().createSQLQuery(getSQLConsultarDocumentosFinalizadosEAbertosNoPeriodo());
-		}else{
-			query = (SQLQuery) WfDao.getInstance().getSessao().createSQLQuery(getSQLConsultarDocumentosFinalizadosNoPeriodo());
-		}
+	private Set<Tarefa> consultarTarefas(WfDefinicaoDeProcedimento pd, Date dataInicialDe, Date dataInicialAte,
+			Date dataFinalDe, Date dataFinalAte, Boolean incluirAbertos) {
+
+		List<WfProcedimento> l;
+		if (incluirAbertos)
+			l = WfDao.getInstance().consultarProcedimentosParaEstatisticasPorPrincipalInclusiveNaoFinalizados(pd,
+					dataInicialDe, dataInicialAte, dataFinalDe, dataFinalAte);
+		else
+			l = WfDao.getInstance().consultarProcedimentosParaEstatisticasPorPrincipal(pd, dataInicialDe,
+					dataInicialAte, dataFinalDe, dataFinalAte);
 
-		query.addScalar("stringvalue_", new StringType());
-		query.addScalar("pd_name", new StringType());
-		query.addScalar("p_start", new CalendarType());
-		query.addScalar("p_end", new CalendarType());
-		query.addScalar("t_name", new StringType());
-		query.addScalar("t_create", new CalendarType());
-		query.addScalar("t_end", new CalendarType());
-
-		query.setString("nomeProcedimento", nomeProcedimento);
-		query.setDate("dataInicialDe", dataInicialDe);
-		query.setDate("dataInicialAte", dataInicialAte);
-		query.setDate("dataFinalDe", dataFinalDe);
-		query.setDate("dataFinalAte", dataFinalAte);
-
-		List<Object[]> resultado = query.list();
 		Set<Tarefa> tarefas = new TreeSet<Tarefa>(new TarefaComparator());
-		for (Object[] o : resultado) {
-			if (o[0]!=null){
-				Tarefa t = new Tarefa();
-				t.setDataInicioProcedimento((Calendar) o[2]);
-				t.setDataFimProcedimento((Calendar) o[3]);
-				t.setNumeroDocumento((String) o[0]);
-				t.setNome((String) o[4]);
-				t.setDataInicio((Calendar) o[5]);
-				t.setDataFim((Calendar) o[6]);
-	
-				tarefas.add(t);
+		for (WfProcedimento pi : l) {
+			Date dtLast = null;
+			for (WfMov mov : pi.getMovimentacoes()) {
+				if (!(mov instanceof WfMovTransicao))
+					continue;
+				WfMovTransicao t = (WfMovTransicao) mov;
+				if (dtLast == null)
+					dtLast = t.getHisDtIni();
+				if (t.getDefinicaoDeTarefaDe() == null)
+					continue;
+
+				Tarefa tsk = new Tarefa();
+				tsk.setDataInicioProcedimento(buildCalendar(pi.getHisDtIni()));
+				tsk.setDataFimProcedimento(buildCalendar(pi.getHisDtFim()));
+				tsk.setNumeroDocumento(pi.getPrincipal());
+				tsk.setNome(t.getDefinicaoDeTarefaDe().getNome());
+				tsk.setDataInicio(buildCalendar(t.getHisDtIni()));
+				tsk.setDataFim(buildCalendar(dtLast));
+				tarefas.add(tsk);
+
+				dtLast = t.getHisDtIni();
 			}
 		}
-		// Set<Doc> secs = new TreeSet<Doc>(new DocComparator());
-		// for (Object[] o : resultado) {
-		// Doc s = new Doc();
-		// Calendar inicio = (Calendar) o[0];
-		// Calendar fim = (Calendar) o[1];
-		// s.setNumeroDoc(o[2].toString());
-		// s.setInicio(inicio);
-		// s.setFim(fim);
-		// s.setProcessInstanceID((Long) (o[3]));
-		// secs.add(s);
-		// }
-		//
 		return tarefas;
-
-	}
-
-	private String getSQLConsultarDocumentosFinalizadosNoPeriodo() {
-		return "select pd.name_ pd_name,stringvalue_,p.start_ p_start,p.end_ p_end,t.name_ t_name,t.create_ t_create,t.end_ t_end "
-			+ "from (select id_, stringvalue_, processinstance_ from sigawf.jbpm_variableinstance "
-			+ "where (stringvalue_ like '%RJ-SEC%' or stringvalue_ like '%RJ-EOF%') and name_ like 'doc_document')v ,(select id_,start_,end_, processdefinition_ "
-			+ "from sigawf.jbpm_processinstance where end_ is not null )p, "
-			+ "(select name_,procinst_,create_, end_ from sigawf.jbpm_taskinstance)t, "
-			+ "(select name_ , id_ from sigawf.jbpm_processdefinition)pd "
-			+ "where p.id_=v.processinstance_ and p.id_=t.procinst_ and p.processdefinition_ = pd.id_ "
-			+ "and (p.start_ >= :dataInicialDe and p.start_ <= :dataInicialAte) and (p.end_ >= :dataFinalDe and p.end_ <= :dataFinalAte) "
-			+ "and pd.name_ = :nomeProcedimento "
-			+ "order by stringvalue_ ,create_";
 	}
 
-	private String getSQLConsultarDocumentosFinalizadosEAbertosNoPeriodo() {
-		return "select pd.name_ pd_name,stringvalue_,p.start_ p_start,p.end_ p_end,t.name_ t_name,t.create_ t_create,t.end_ t_end "
-		+ "from (select id_, stringvalue_, processinstance_ from sigawf.jbpm_variableinstance "
-		+ "where (stringvalue_ like '%RJ-SEC%' or stringvalue_ like '%RJ-EOF%') and name_ like 'doc_document')v ,(select id_,start_,end_, processdefinition_ "
-		+ "from sigawf.jbpm_processinstance) p, "
-		+ "(select name_,procinst_,create_, end_ from sigawf.jbpm_taskinstance)t, "
-		+ "(select name_ , id_ from sigawf.jbpm_processdefinition)pd "
-		+ "where p.id_=v.processinstance_ and p.id_=t.procinst_ and p.processdefinition_ = pd.id_ "
-		+ "and (p.start_ >= :dataInicialDe and p.start_ <= :dataInicialAte) and (p.end_ >= :dataFinalDe and p.end_ <= :dataFinalAte  OR p.END_ IS NULL) "
-		+ "and pd.name_ = :nomeProcedimento "
-		+ "order by stringvalue_ ,create_";
-
+	private Calendar buildCalendar(Date data) {
+		if (data == null)
+			return null;
+		Calendar c = Calendar.getInstance();
+		c.setTime(data);
+		return c;
 	}
 
 	private Date getDataDe(String data) {
 		String pDT = (String) parametros.get(data);
 		GregorianCalendar dt = new GregorianCalendar();
 
-		dt.set(new Integer(pDT.substring(6)),
-				new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT
-						.substring(0, 2)), 0, 0, 0);
+		dt.set(new Integer(pDT.substring(6)), new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT.substring(0, 2)), 0,
+				0, 0);
 		return dt.getTime();
 
 	}
 
 	/**
 	 * Retorna um objeto Date com a data passada como parêmetro. ATENÇÃO: Este
-	 * método pode ser reescrito com um DateFormat em um refactoring posterior.
-	 * A data é definida como hh:mm:ss = 23:59:59
+	 * método pode ser reescrito com um DateFormat em um refactoring posterior. A
+	 * data é definida como hh:mm:ss = 23:59:59
 	 * 
 	 * @param data
 	 * @return
@@ -360,9 +290,8 @@ public class RelTempoDocDetalhado extends RelatorioTemplate {
 		String pDT = (String) parametros.get(data);
 		GregorianCalendar dt = new GregorianCalendar();
 
-		dt.set(new Integer(pDT.substring(6)),
-				new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT
-						.substring(0, 2)), 23, 59, 59);
+		dt.set(new Integer(pDT.substring(6)), new Integer(pDT.substring(3, 5)) - 1, new Integer(pDT.substring(0, 2)),
+				23, 59, 59);
 		return dt.getTime();
 
 	}
@@ -426,26 +355,24 @@ public class RelTempoDocDetalhado extends RelatorioTemplate {
 		}
 
 		public long getDuracaoEmMili() {
-			if (getDataFim()==null || getDataInicio()==null){
+			if (getDataFim() == null || getDataInicio() == null) {
 				return Calendar.getInstance().getTimeInMillis() - getDataInicio().getTimeInMillis();
 			}
-			return getDataFim().getTimeInMillis()
-					- getDataInicio().getTimeInMillis();
+			return getDataFim().getTimeInMillis() - getDataInicio().getTimeInMillis();
 		}
 
 		public long getDuracaoProcedimentoEmMili() {
-			if (getDataFimProcedimento()==null || getDataInicioProcedimento()==null){
+			if (getDataFimProcedimento() == null || getDataInicioProcedimento() == null) {
 				return Calendar.getInstance().getTimeInMillis() - getDataInicioProcedimento().getTimeInMillis();
 			}
 
-			return getDataFimProcedimento().getTimeInMillis()
-					- getDataInicioProcedimento().getTimeInMillis();
+			return getDataFimProcedimento().getTimeInMillis() - getDataInicioProcedimento().getTimeInMillis();
 		}
 
 		public String getDuracaoProcedimento() {
 			return SigaCalendar.formatDHM(this.getDuracaoProcedimentoEmMili());
 		}
-		
+
 		@Override
 		public String toString() {
 			return getNumeroDocumento() + "," + getNome();
@@ -454,9 +381,8 @@ public class RelTempoDocDetalhado extends RelatorioTemplate {
 
 	/**
 	 * Compara duas tarefas. Se as tarefas se referem a documentos diferentes, a
-	 * ordem é do documento mais demorado para o mais rápido. Se as tarefas
-	 * forem referentes ao mesmo documento, a ordem é pela tarefa que foi criada
-	 * primeiro.
+	 * ordem é do documento mais demorado para o mais rápido. Se as tarefas forem
+	 * referentes ao mesmo documento, a ordem é pela tarefa que foi criada primeiro.
 	 * 
 	 * @author kpf
 	 * 
@@ -473,8 +399,7 @@ public class RelTempoDocDetalhado extends RelatorioTemplate {
 					return 1;
 				}
 			} else {
-				if (t1.getDuracaoProcedimentoEmMili() > t2
-						.getDuracaoProcedimentoEmMili()) {
+				if (t1.getDuracaoProcedimentoEmMili() > t2.getDuracaoProcedimentoEmMili()) {
 					return -1;
 				} else {
 					return 1;
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/service/impl/WfServiceImpl.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/service/impl/WfServiceImpl.java
index ee067d8c2a..775ba94604 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/service/impl/WfServiceImpl.java
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/service/impl/WfServiceImpl.java
@@ -18,30 +18,33 @@
  ******************************************************************************/
 package br.gov.jfrj.siga.wf.service.impl;
 
+import java.io.Closeable;
+import java.io.IOException;
 import java.util.ArrayList;
 import java.util.List;
 
 import javax.jws.WebService;
+import javax.persistence.EntityManager;
 
-import org.hibernate.Query;
-import org.jbpm.JbpmContext;
-import org.jbpm.context.def.VariableAccess;
-import org.jbpm.context.exe.VariableInstance;
-import org.jbpm.db.GraphSession;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.taskmgmt.exe.TaskInstance;
+import org.jboss.logging.Logger;
 
 import br.gov.jfrj.siga.Service;
+import br.gov.jfrj.siga.base.log.RequestLoggerFilter;
+import br.gov.jfrj.siga.cp.CpIdentidade;
+import br.gov.jfrj.siga.dp.DpPessoa;
 import br.gov.jfrj.siga.ex.service.ExService;
+import br.gov.jfrj.siga.model.ContextoPersistencia;
+import br.gov.jfrj.siga.model.dao.ModeloDao;
 import br.gov.jfrj.siga.parser.PessoaLotacaoParser;
 import br.gov.jfrj.siga.wf.bl.Wf;
 import br.gov.jfrj.siga.wf.bl.WfBL;
 import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.dao.WfStarter;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
 import br.gov.jfrj.siga.wf.service.WfService;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-import br.gov.jfrj.siga.wf.vraptor.WfUtil;
+import br.gov.jfrj.siga.wf.util.WfEngine;
+import br.gov.jfrj.siga.wf.util.WfHandler;
 
 /**
  * Classe que representa o webservice do workflow. O SIGA-DOC faz a chamada
@@ -51,194 +54,131 @@ import br.gov.jfrj.siga.wf.vraptor.WfUtil;
  * @author kpf
  * 
  */
-@WebService(serviceName ="WfService", endpointInterface = "br.gov.jfrj.siga.wf.service.WfService", targetNamespace = "http://impl.service.wf.siga.jfrj.gov.br/")
+@WebService(serviceName = "WfService", endpointInterface = "br.gov.jfrj.siga.wf.service.WfService", targetNamespace = "http://impl.service.wf.siga.jfrj.gov.br/")
 public class WfServiceImpl implements WfService {
+	private final static Logger log = Logger.getLogger(WfService.class);
+
+	private static class SoapContext implements Closeable {
+		EntityManager em;
+		boolean transacional;
+		long inicio = System.currentTimeMillis();
+
+		public SoapContext(boolean transacional) {
+			this.transacional = transacional;
+			em = WfStarter.emf.createEntityManager();
+			ContextoPersistencia.setEntityManager(em);
+
+			ModeloDao.freeInstance();
+			WfDao.getInstance();
+			try {
+				Wf.getInstance().getConf().limparCacheSeNecessario();
+			} catch (Exception e1) {
+				throw new RuntimeException("Não foi possível atualizar o cache de configurações", e1);
+			}
+			if (this.transacional)
+				em.getTransaction().begin();
+		}
 
-	private boolean hideStackTrace = false;
-
-	public boolean isHideStackTrace() {
-		return hideStackTrace;
-	}
+		public void rollback(Exception e) {
+			if (em.getTransaction().isActive())
+				em.getTransaction().rollback();
+			if (!RequestLoggerFilter.isAplicacaoException(e)) {
+				RequestLoggerFilter.logException(null, inicio, e);
+			}
+		}
 
-	public void setHideStackTrace(boolean hideStackTrace) {
-		this.hideStackTrace = hideStackTrace;
+		@Override
+		public void close() throws IOException {
+			try {
+				if (this.transacional)
+					em.getTransaction().commit();
+			} catch (Exception e) {
+				if (em.getTransaction().isActive())
+					em.getTransaction().rollback();
+				throw new RuntimeException(e);
+			} finally {
+				em.close();
+				ContextoPersistencia.setEntityManager(null);
+			}
+		}
 	}
 
 	/**
-	 * Atualiza o workflow de um documento. Este método pesquisa todas as
-	 * variáveis que começam com "doc_" em todas as instâncias de tarefas.
-	 * Quando encontra a variável, passa a sigla do documento para o execution
-	 * execution context e executa a ação da tarefa.
+	 * Atualiza o workflow de um documento. Este método pesquisa todas as variáveis
+	 * que começam com "doc_" em todas as instâncias de tarefas. Quando encontra a
+	 * variável, passa a sigla do documento para o execution execution context e
+	 * executa a ação da tarefa.
 	 */
-	public Boolean atualizarWorkflowsDeDocumento(String codigoDocumento)
-			throws Exception {
-		try {
-			Boolean b = false;
-			GraphSession graph = WfContextBuilder.getJbpmContext()
-					.getGraphSession();
-			JbpmContext ctx = WfContextBuilder.getJbpmContext()
-					.getJbpmContext();
-			// List<TaskInstance> tis = ctx.getTaskList();
-
-			Query q = WfDao
-					.getInstance()
-					.getSessao()
-					.createQuery(
-							"select ti from org.jbpm.taskmgmt.exe.TaskInstance as ti"
-									+ " where ti.isSuspended != true and ti.isOpen = true");
-			List<TaskInstance> tis = q.list();
-
-			for (TaskInstance ti : tis) {
-				if (ti.getTask().getTaskController() != null) {
-					List<VariableAccess> variableAccesses = (List<VariableAccess>) ti
-							.getTask().getTaskController()
-							.getVariableAccesses();
-					for (VariableAccess variable : variableAccesses) {
-						if (variable.getMappedName() != null
-								&& variable.getMappedName().startsWith("doc_")
-								&& variable.isReadable()
-								&& !variable.isWritable()) {
-							String mapping = variable.getMappedName();
-							String value = (String) ti.getContextInstance()
-									.getVariable(mapping);
-							if (value != null
-									&& value.startsWith(codigoDocumento)) {
-								ExecutionContext ec = new ExecutionContext(
-										ti.getToken());
-								ec.setTaskInstance(ti);
-								ec.setTask(ti.getTask());
-								ti.getTask().fireEvent("context-change", ec);
-
-								executarAcoes(codigoDocumento, ti);
-
-								b = true;
-							}
-						}
+	public Boolean atualizarWorkflowsDeDocumento(String siglaDoc) throws Exception {
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+				List<WfProcedimento> pis = WfDao.getInstance().consultarProcedimentosAtivosPorEvento(siglaDoc);
+				boolean f = false;
+				ExService exSvc = Service.getExService();
+				Boolean semEfeito = exSvc.isSemEfeito(siglaDoc);
+				if (semEfeito == null)
+					return false;
+				for (WfProcedimento pi : pis) {
+					if (semEfeito)
+						Wf.getInstance().getBL().encerrarProcessInstance(pi.getId(),
+								WfDao.getInstance().consultarDataEHoraDoServidor());
+					else {
+						new WfEngine(WfDao.getInstance(), new WfHandler(null, null, null)).resume(siglaDoc, null, null);
 					}
+					f = true;
 				}
+				return f;
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
 			}
-			return b;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
-		}
-	}
-
-	/**
-	 * Executa ações na tarefa baseando-se nos serviços externos associados à
-	 * tarefa.
-	 * 
-	 * @param codigoDocumento
-	 * @param ti
-	 * @throws Exception
-	 */
-	private void executarAcoes(String codigoDocumento, TaskInstance ti)
-			throws Exception {
-		ExService exSvc = Service.getExService();
-		WfBL bl = Wf.getInstance().getBL();
-		WfDao dao = WfDao.getInstance();
-
-		if (exSvc.isSemEfeito(codigoDocumento)) {
-			bl.encerrarProcessInstance(ti.getProcessInstance().getId(),
-					dao.consultarDataEHoraDoServidor());
 		}
 	}
 
 	/**
 	 * Inicia um novo procedimento.
 	 */
-	public Boolean criarInstanciaDeProcesso(String nomeProcesso,
-			String siglaCadastrante, String siglaTitular,
+	public Boolean criarInstanciaDeProcesso(String nomeProcedimento, String siglaCadastrante, String siglaTitular,
 			ArrayList<String> keys, ArrayList<String> values) throws Exception {
-
-		try {
-			if (nomeProcesso == null)
-				throw new RuntimeException();
-			GraphSession graph = WfContextBuilder.getJbpmContext()
-					.getGraphSession();
-			ProcessDefinition pd = graph
-					.findLatestProcessDefinition(nomeProcesso);
-			if (pd == null)
-				throw new RuntimeException(
-						"Não foi encontrado um ProcessDefinition com o nome '"
-								+ nomeProcesso + "'");
-			PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(
-					siglaCadastrante);
-			PessoaLotacaoParser titularParser = new PessoaLotacaoParser(
-					siglaTitular);
-
-			ProcessInstance pi = Wf
-					.getInstance()
-					.getBL()
-					.createProcessInstance(pd.getId(),
-							cadastranteParser.getPessoa(),
-							cadastranteParser.getLotacao(),
-							titularParser.getPessoa(),
-							titularParser.getLotacao(), keys, values, false);
-
-			WfUtil.transferirDocumentosVinculados(pi, siglaTitular);
-			return true;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
+		try (SoapContext ctx = new SoapContext(true)) {
+			try {
+
+				if (nomeProcedimento == null)
+					throw new RuntimeException("Nome do procedimento precisa ser informado.");
+				WfDefinicaoDeProcedimento pd = WfDao.getInstance()
+						.consultarWfDefinicaoDeProcedimentoPorNome(nomeProcedimento);
+				if (pd == null)
+					throw new RuntimeException(
+							"Não foi encontrado um procedimento com o nome '" + nomeProcedimento + "'");
+				PessoaLotacaoParser cadastranteParser = new PessoaLotacaoParser(siglaCadastrante);
+				PessoaLotacaoParser titularParser = new PessoaLotacaoParser(siglaTitular);
+
+				CpIdentidade identidade = null;
+				List<CpIdentidade> l = WfDao.getInstance().consultaIdentidades(cadastranteParser.getPessoa());
+				if (l.size() > 0)
+					identidade = l.get(0);
+				WfProcedimento pi = Wf.getInstance().getBL().createProcessInstance(pd.getId(),
+						titularParser.getPessoa(), titularParser.getLotacao(), identidade, null, null, keys, values,
+						false);
+
+				WfBL.transferirDocumentosVinculados(pi, siglaTitular);
+				return true;
+			} catch (Exception ex) {
+				ctx.rollback(ex);
+				throw ex;
+			}
 		}
 	}
 
+	private Object consultaIdentidades(DpPessoa pessoa) {
+		// TODO Auto-generated method stub
+		return null;
+	}
+
 	@Override
-	public Object variavelPorDocumento(String codigoDocumento,
-			String nomeDaVariavel) throws Exception {
-		try {
-			// TODO Auto-generated method stub
-			Boolean b = false;
-			GraphSession graph = WfContextBuilder.getJbpmContext()
-					.getGraphSession();
-			JbpmContext ctx = WfContextBuilder.getJbpmContext()
-					.getJbpmContext();
-			// List<TaskInstance> tis = ctx.getTaskList();
-
-			// Get latest processInstance that references a certain document
-			// Query qpi = WfDao
-			// .getInstance()
-			// .getSessao()
-			// .createQuery(
-			// "select max(vi.processInstance) from org.jbpm.context.exe.variableinstance.StringInstance as vi, vi.processInstance pi"
-			// +
-			// " where pi.end is null and vi.name like 'doc_%' and vi.value = :codigoDocumento");
-			Query qpi = WfDao
-					.getInstance()
-					.getSessao()
-					.createQuery(
-							"select max(vi.processInstance.id) from org.jbpm.context.exe.variableinstance.StringInstance as vi inner join vi.processInstance as pi"
-									+ " where pi.end is null and vi.name like 'doc_%' and vi.value = :codigoDocumento");
-			qpi.setParameter("codigoDocumento", codigoDocumento);
-
-			Long pid = (Long) qpi.uniqueResult();
-
-			if (pid == null)
-				return null;
-
-			Query qvi = WfDao
-					.getInstance()
-					.getSessao()
-					.createQuery(
-							"select vi from org.jbpm.context.exe.variableinstance.StringInstance as vi"
-									+ " where vi.processInstance.id = :pid and vi.name = :nomeDaVariavel");
-			qvi.setParameter("pid", pid);
-			qvi.setParameter("nomeDaVariavel", nomeDaVariavel);
-			List<VariableInstance> vis = qvi.list();
-
-			for (VariableInstance vi : vis) {
-				if (vi.getValue() != null)
-					return vi.getValue();
-			}
-			return null;
-		} catch (Exception e) {
-			if (!isHideStackTrace())
-				e.printStackTrace(System.out);
-			throw e;
-		}
+	public Object variavelPorDocumento(String codigoDocumento, String nomeDaVariavel) throws Exception {
+		// TODO Auto-generated method stub
+		return null;
 	}
 
 }
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/ProcessImageServlet.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/ProcessImageServlet.java
deleted file mode 100644
index 79bf8648e9..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/ProcessImageServlet.java
+++ /dev/null
@@ -1,65 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.servlet;
-
-import java.io.IOException;
-import java.io.OutputStream;
-
-import javax.servlet.ServletException;
-import javax.servlet.http.HttpServlet;
-import javax.servlet.http.HttpServletRequest;
-import javax.servlet.http.HttpServletResponse;
-
-import org.jbpm.JbpmContext;
-import org.jbpm.graph.def.ProcessDefinition;
-
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-
-/**
- * Servlet que desenha o gráfico do processo.
- * 
- * @author kpf
- * 
- */
-public class ProcessImageServlet extends HttpServlet {
-
-	private static final long serialVersionUID = 1L;
-
-	/**
-	 * Pega o desenho do process definition e coloca no output stream.
-	 */
-	public void doGet(HttpServletRequest request, HttpServletResponse response)
-			throws ServletException, IOException {
-		long processDefinitionId = Long.parseLong(request.getParameter("pdId"));
-		JbpmContext jbpmContext = WfContextBuilder.getJbpmContext()
-				.getJbpmContext();
-		ProcessDefinition processDefinition = jbpmContext.getGraphSession()
-				.loadProcessDefinition(processDefinitionId);
-		byte[] bytes = processDefinition.getFileDefinition().getBytes(
-				"processimage.jpg");
-		if (request.getParameter("tkId") != null) {
-			Long taskId = Long.parseLong(request.getParameter("tkId"));
-			
-		}
-		try (OutputStream out = response.getOutputStream()) {
-			out.write(bytes);
-			out.flush();
-		}
-	}
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/UploadServlet.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/UploadServlet.java
deleted file mode 100644
index e8cbbb0ffa..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/servlet/UploadServlet.java
+++ /dev/null
@@ -1,202 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-/*
- * JBoss, Home of Professional Open Source Copyright 2005, JBoss Inc., and individual contributors as indicated by the @authors tag. See the copyright.txt in the distribution for a full listing of
- * individual contributors.
- * 
- * This is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; either version 2.1 of the
- * License, or (at your option) any later version.
- * 
- * This software is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
- * Lesser General Public License for more details.
- * 
- * You should have received a copy of the GNU Lesser General Public License along with this software; if not, write to the Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
- * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
- */
-
-package br.gov.jfrj.siga.wf.servlet;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.Collection;
-import java.util.Iterator;
-import java.util.List;
-import java.util.zip.ZipInputStream;
-
-import javax.servlet.http.HttpServlet;
-import javax.servlet.http.HttpServletRequest;
-import javax.servlet.http.HttpServletResponse;
-
-import org.apache.commons.fileupload.FileItem;
-import org.apache.commons.fileupload.FileUpload;
-import org.apache.commons.fileupload.FileUploadException;
-import org.apache.commons.fileupload.disk.DiskFileItemFactory;
-import org.apache.commons.fileupload.servlet.ServletFileUpload;
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.jbpm.JbpmContext;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.instantiation.Delegation;
-import org.jbpm.taskmgmt.def.Swimlane;
-import org.jbpm.taskmgmt.def.Task;
-
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-
-/**
- * Servlet que recebe um arquivo de definição de processo (Process Definition) e
- * armazena-o no banco de dados. A definição de processo recebida passa a ser a
- * definição vigente.
- * 
- * @author kpf
- * 
- */
-public class UploadServlet extends HttpServlet {
-
-	private static final long serialVersionUID = 1L;
-
-	/**
-	 * Realiza o tratatemento do request. Verifica se o arquivo enviado é uma
-	 * definição de processo válida e realiza o seu deploy.
-	 */
-	public void service(HttpServletRequest request, HttpServletResponse response)
-			throws IOException {
-		response.setContentType("text/html");
-		System.out.println("Publicando ...");
-		response.getWriter().println(handleRequest(request));
-	}
-
-	/**
-	 * Escreve o input stream (para debug)
-	 * 
-	 * @param request
-	 * @throws IOException
-	 */
-	public void printInput(HttpServletRequest request) throws IOException {
-		InputStream inputStream = request.getInputStream();
-		StringBuffer buffer = new StringBuffer();
-		int read;
-		while ((read = inputStream.read()) != -1) {
-			buffer.append((char) read);
-		}
-		log.debug(buffer.toString());
-	}
-
-	/**
-	 * Verifica se o arquivo enviado é um process definition. Se for, realiza o
-	 * seu deploy.
-	 * 
-	 * @param request
-	 * @return
-	 */
-	private String handleRequest(HttpServletRequest request) {
-		if (!FileUpload.isMultipartContent(request)) {
-			log.debug("Not a multipart request");
-			return "Not a multipart request";
-		}
-		try {
-			// Nato: Modo novo, mas que esta voltando uma lista vazia pois o
-			// webwork está interceptando o request e lendo o arquivo
-			DiskFileItemFactory factory = new DiskFileItemFactory();
-			// Configure the factory here, if desired.
-			ServletFileUpload upload = new ServletFileUpload(factory);
-			// Configure the uploader here, if desired.
-			List list = upload.parseRequest(request);
-
-			// Nato: modo antigo
-			// DiskFileUpload fileUpload = new DiskFileUpload();
-			// List list = fileUpload.parseRequest(request);
-
-			// MultiPartRequestWrapper req = (MultiPartRequestWrapper)request;
-			// req.get
-
-			Iterator iterator = list.iterator();
-			if (!iterator.hasNext()) {
-				log.debug("No process file in the request");
-				return "No process file in the request";
-			}
-			FileItem fileItem = (FileItem) iterator.next();
-			if (fileItem.getContentType().indexOf(
-					"application/x-zip-compressed") == -1) {
-				log.debug("Not a process archive");
-				return "Not a process archive";
-			}
-			return doDeployment(fileItem);
-		} catch (FileUploadException e) {
-			e.printStackTrace();
-			return "FileUploadException";
-		} catch (Exception e) {
-			e.printStackTrace();
-			throw new Error(e);
-		}
-	}
-
-	/**
-	 * Coloca as informações do arquivo da definição do processo no banco de
-	 * dados.
-	 * 
-	 * @param fileItem
-	 * @return
-	 */
-	private String doDeployment(FileItem fileItem) {
-		try {
-			ZipInputStream zipInputStream = new ZipInputStream(fileItem
-					.getInputStream());
-			JbpmContext jbpmContext = WfContextBuilder.getJbpmContext()
-					.getJbpmContext();
-			ProcessDefinition processDefinition = ProcessDefinition
-					.parseParZipInputStream(zipInputStream);
-			jbpmContext.deployProcessDefinition(processDefinition);
-			zipInputStream.close();
-			long id = processDefinition.getId();
-
-			String sReturn = "Deployed archive " + processDefinition.getName()
-					+ " successfully";
-
-			// ProcessDefinition pi = jbpmContext.getGraphSession()
-			// .loadProcessDefinition(id);
-
-			Delegation d = new Delegation(
-					"br.gov.jfrj.siga.wf.util.WfAssignmentHandler");
-
-			for (Swimlane s : ((Collection<Swimlane>) processDefinition
-					.getTaskMgmtDefinition().getSwimlanes().values())) {
-				if (s.getTasks() != null)
-					for (Object t : s.getTasks()) {
-						System.out.println(((Task) t).toString());
-					}
-				if (s.getAssignmentDelegation() == null)
-					s.setAssignmentDelegation(d);
-			}
-
-			for (Task t : ((Collection<Task>) processDefinition
-					.getTaskMgmtDefinition().getTasks().values())) {
-				if (t.getSwimlane() == null
-						&& t.getAssignmentDelegation() == null)
-					t.setAssignmentDelegation(d);
-			}
-
-			return sReturn;
-		} catch (IOException e) {
-			return "IOException";
-		}
-	}
-
-	private static Log log = LogFactory.getLog(UploadServlet.class);
-
-}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/tag/ProcessImageTag.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/tag/ProcessImageTag.java
deleted file mode 100644
index fcc6e5f532..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/tag/ProcessImageTag.java
+++ /dev/null
@@ -1,342 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-/*
- * JBoss, Home of Professional Open Source Copyright 2005, JBoss Inc., and individual contributors as indicated by the @authors tag. See the copyright.txt in the distribution for a full listing of
- * individual contributors.
- * 
- * This is free software; you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation; either version 2.1 of the
- * License, or (at your option) any later version.
- * 
- * This software is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
- * Lesser General Public License for more details.
- * 
- * You should have received a copy of the GNU Lesser General Public License along with this software; if not, write to the Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
- * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
- */
-
-package br.gov.jfrj.siga.wf.tag;
-
-
-import java.io.IOException;
-import java.io.UnsupportedEncodingException;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.Iterator;
-import java.util.List;
-import java.util.Map;
-
-import javax.servlet.jsp.JspException;
-import javax.servlet.jsp.JspWriter;
-import javax.servlet.jsp.tagext.TagSupport;
-
-import org.dom4j.DocumentException;
-import org.dom4j.DocumentHelper;
-import org.dom4j.Element;
-import org.dom4j.XPath;
-import org.dom4j.xpath.DefaultXPath;
-import org.jbpm.JbpmContext;
-import org.jbpm.file.def.FileDefinition;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-
-/**
- * Classe que define a tag de exibição do gráfico do process definition através da tag wfImage.
- * @author kpf
- *
- */
-public class ProcessImageTag extends TagSupport
-{
-
-	private static final long serialVersionUID = 1L;
-	private long taskInstanceId = - 1;
-	private long tokenInstanceId = - 1;
-
-	private byte [] gpdBytes = null;
-	private byte [] imageBytes = null;
-	private Token currentToken = null;
-	private ProcessDefinition processDefinition = null;
-
-	static String currentTokenColor = "red";
-	static String childTokenColor = "blue";
-	static String tokenNameColor = "blue";
-	static String actorIDColor = "green";
-
-	/**
-	 * Libera os recursos quando a tag passar para release state.
-	 */
-	public void release ()
-	{
-		taskInstanceId = - 1;
-		gpdBytes = null;
-		imageBytes = null;
-		currentToken = null;
-	}
-
-	/**
-	 * Processa a tag.
-	 */
-	public int doEndTag () throws JspException
-	{
-		try
-		{
-			initialize ();
-			retrieveByteArrays ();
-			if ( gpdBytes != null && imageBytes != null )
-			{
-				writeTable ();
-			}
-		}
-		catch ( IOException e )
-		{
-			e.printStackTrace ();
-			throw new JspException ( "table couldn't be displayed" , e );
-		}
-		catch ( DocumentException e )
-		{
-			e.printStackTrace ();
-			throw new JspException ( "table couldn't be displayed" , e );
-		}
-		release ();
-		return EVAL_PAGE;
-	}
-
-	/**
-	 * Lê as informações referentes ao gráfico da definição do processo.
-	 */
-	private void retrieveByteArrays ()
-	{
-		try
-		{
-			FileDefinition fileDefinition = processDefinition.getFileDefinition ();
-			gpdBytes = fileDefinition.getBytes ( "gpd.xml" );
-			imageBytes = fileDefinition.getBytes ( "processimage.jpg" );
-		}
-		catch ( Exception e )
-		{
-			e.printStackTrace ();
-		}
-	}
-
-	/**
-	 * Desenha um quadro sobre a tarefa atual.
-	 * @throws IOException
-	 * @throws DocumentException
-	 */
-	private void writeTable () throws IOException , DocumentException
-	{
-
-		int borderWidth = 4;
-		Element rootDiagramElement = DocumentHelper.parseText ( new String ( gpdBytes ) ).getRootElement ();
-		int [] boxConstraint;
-		int [] imageDimension = extractImageDimension ( rootDiagramElement );
-		String imageLink = "loadPhoto?pdId=" + processDefinition.getId ();
-		JspWriter jspOut = pageContext.getOut ();
-
-		if ( tokenInstanceId > 0 )
-		{
-
-			List allTokens = new ArrayList ();
-			walkTokens ( currentToken , allTokens );
-
-			jspOut.println ( "<div style='position:relative; background-image:url(" + imageLink + "); width: " + imageDimension [ 0 ] + "px; height: " + imageDimension [ 1 ] + "px;'>" );
-
-			for ( int i = 0 ; i < allTokens.size () ; i++ )
-			{
-				Token token = ( Token ) allTokens.get ( i );
-
-				// check how many tokens are on teh same level (= having the
-				// same parent)
-				int offset = i;
-				if ( i > 0 )
-				{
-					while ( offset > 0 && ( ( Token ) allTokens.get ( offset - 1 ) ).getParent ().equals ( token.getParent () ) )
-					{
-						offset--;
-					}
-				}
-				boxConstraint = extractBoxConstraint ( rootDiagramElement , token );
-
-				// Adjust for borders
-				// boxConstraint[2]-=borderWidth*2;
-				// boxConstraint[3]-=borderWidth*2;
-
-				jspOut.println ( "<div style='position:absolute; left: " + boxConstraint [ 0 ] + "px; top: " + boxConstraint [ 1 ] + "px; " );
-
-				if ( i == ( allTokens.size () - 1 ) )
-				{
-					jspOut.println ( "border: " + currentTokenColor );
-				}
-				else
-				{
-					jspOut.println ( "border: " + childTokenColor );
-				}
-
-				jspOut.println ( " " + borderWidth + "px groove; " + "width: " + boxConstraint [ 2 ] + "px; height: " + boxConstraint [ 3 ] + "px;'>" );
-
-				if ( token.getName () != null )
-				{
-					jspOut.println ( "<span style='color:" + tokenNameColor + ";font-style:italic;position:absolute;left:" + ( boxConstraint [ 2 ] + 10 ) + "px;top:" + ( ( i - offset ) * 20 ) + ";'>&nbsp;" + token.getName () + "</span>" );
-				}
-
-				jspOut.println ( "<span style='color:" + actorIDColor + ";font-style:italic;position:absolute;left:" + ( boxConstraint [ 2 ] + 10 ) + "px;top:-30;'>&nbsp;" + WfContextBuilder.getJbpmContext().getJbpmContext().getTaskInstance(taskInstanceId).getActorId() + "</span>" );
-				jspOut.println ( "</div>" );
-			}
-			jspOut.println ( "</div>" );
-		}
-		else
-		{
-			boxConstraint = extractBoxConstraint ( rootDiagramElement );
-
-			jspOut.println ( "<table border=0 cellspacing=0 cellpadding=0 width=" + imageDimension [ 0 ] + " height=" + imageDimension [ 1 ] + ">" );
-			jspOut.println ( "  <tr>" );
-			jspOut.println ( "    <td width=" + imageDimension [ 0 ] + " height=" + imageDimension [ 1 ] + " style=\"background-image:url(" + imageLink + ")\" valign=top>" );
-			jspOut.println ( "      <table border=0 cellspacing=0 cellpadding=0>" );
-			jspOut.println ( "        <tr>" );
-			jspOut.println ( "          <td width=" + ( boxConstraint [ 0 ] - borderWidth ) + " height=" + ( boxConstraint [ 1 ] - borderWidth ) + " style=\"background-color:transparent;\"></td>" );
-			jspOut.println ( "        </tr>" );
-			jspOut.println ( "        <tr>" );
-			jspOut.println ( "          <td style=\"background-color:transparent;\"></td>" );
-			jspOut.println ( "          <td style=\"border-color:" + currentTokenColor + "; border-width:" + borderWidth + "px; border-style:groove; background-color:transparent;\" width=" + boxConstraint [ 2 ] + " height=" + ( boxConstraint [ 3 ] + ( 2 * borderWidth ) ) + ">&nbsp;</td>" );
-			jspOut.println ( "        </tr>" );
-			jspOut.println ( "      </table>" );
-			jspOut.println ( "    </td>" );
-			jspOut.println ( "  </tr>" );
-			jspOut.println ( "</table>" );
-		}
-	}
-
-	/**
-	 * Extrai os limites da caixa para que seja desenhada a marcação à sua volta.
-	 * @param root
-	 * @return
-	 */
-	private int [] extractBoxConstraint ( Element root )
-	{
-		int [] result = new int [ 4 ];
-		String nodeName = currentToken.getNode ().getName ();
-		XPath xPath = new DefaultXPath ( "//node[@name='" + nodeName + "']" );
-		Element node = ( Element ) xPath.selectSingleNode ( root );
-		result [ 0 ] = Integer.valueOf ( node.attribute ( "x" ).getValue () ).intValue ();
-		result [ 1 ] = Integer.valueOf ( node.attribute ( "y" ).getValue () ).intValue ();
-		result [ 2 ] = Integer.valueOf ( node.attribute ( "width" ).getValue () ).intValue ();
-		result [ 3 ] = Integer.valueOf ( node.attribute ( "height" ).getValue () ).intValue ();
-		return result;
-	}
-
-	/**
-	 * Extrai os limites da caixa para que seja desenhada a marcação à sua volta.
-	 * @param root
-	 * @param token
-	 * @return
-	 */
-	private int [] extractBoxConstraint ( Element root , Token token )
-	{
-		
-		int [] result = new int [ 4 ];
-		String nodeName = "";
-		try {
-			nodeName = new String(token.getNode ().getName ().getBytes("ISO-8859-1"));
-		} catch (UnsupportedEncodingException e) {
-			// TODO Auto-generated catch block
-			e.printStackTrace();
-		}
-		XPath xPath = new DefaultXPath ( "//node[@name='" + nodeName + "']" );
-		Element node = ( Element ) xPath.selectSingleNode ( root );
-		result [ 0 ] = Integer.valueOf ( node.attribute ( "x" ).getValue () ).intValue ();
-		result [ 1 ] = Integer.valueOf ( node.attribute ( "y" ).getValue () ).intValue ();
-		result [ 2 ] = Integer.valueOf ( node.attribute ( "width" ).getValue () ).intValue ();
-		result [ 3 ] = Integer.valueOf ( node.attribute ( "height" ).getValue () ).intValue ();
-		return result;
-	}
-
-	/**
-	 * Extrai as dimensões da imagem.
-	 * @param root
-	 * @return
-	 */
-	private int [] extractImageDimension ( Element root )
-	{
-		int [] result = new int [ 2 ];
-		result [ 0 ] = Integer.valueOf ( root.attribute ( "width" ).getValue () ).intValue ();
-		result [ 1 ] = Integer.valueOf ( root.attribute ( "height" ).getValue () ).intValue ();
-		return result;
-	}
-	
-	/**
-	 * Inicializa a tag
-	 */
-	private void initialize ()
-	{
-		JbpmContext jbpmContext = WfContextBuilder.getJbpmContext ().getJbpmContext ();
-		if ( this.taskInstanceId > 0 )
-		{
-			TaskInstance taskInstance = jbpmContext.getTaskMgmtSession ().loadTaskInstance ( taskInstanceId );
-			currentToken = taskInstance.getToken ();
-		}
-		else
-		{
-			if ( this.tokenInstanceId > 0 )
-				currentToken = jbpmContext.getGraphSession ().loadToken ( this.tokenInstanceId );
-		}
-		processDefinition = currentToken.getProcessInstance ().getProcessDefinition ();
-	}
-
-	/**
-	 * Pega todos os tokens.
-	 * @param parent
-	 * @param allTokens
-	 */
-	private void walkTokens ( Token parent , List allTokens )
-	{
-		Map children = parent.getChildren ();
-		if ( children != null && children.size () > 0 )
-		{
-			Collection childTokens = children.values ();
-			for ( Iterator iterator = childTokens.iterator () ; iterator.hasNext () ; )
-			{
-				Token child = ( Token ) iterator.next ();
-				walkTokens ( child , allTokens );
-			}
-		}
-
-		allTokens.add ( parent );
-	}
-
-	/**
-	 * Define a task.
-	 * @param id
-	 */
-	public void setTask ( long id )
-	{
-		this.taskInstanceId = id;
-	}
-
-	/**
-	 * Define o token.
-	 * @param id
-	 */
-	public void setToken ( long id )
-	{
-		this.tokenInstanceId = id;
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/FuncoesEL.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/FuncoesEL.java
index 028f6daeed..a18d055470 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/FuncoesEL.java
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/FuncoesEL.java
@@ -18,19 +18,14 @@
  ******************************************************************************/
 package br.gov.jfrj.siga.wf.util;
 
-import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Comparator;
 import java.util.List;
 
-import org.jbpm.graph.def.Transition;
-import org.jbpm.graph.exe.Comment;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
 import br.gov.jfrj.siga.dp.DpLotacao;
 import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.wf.bl.TaskInstanceComparator;
 import br.gov.jfrj.siga.wf.bl.Wf;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeDesvio;
 
 /**
  * Classe que contém diversas funcões úteis que podem ser utilizadas nos
@@ -41,7 +36,7 @@ import br.gov.jfrj.siga.wf.bl.Wf;
  */
 public class FuncoesEL {
 
-	static TaskInstanceComparator tic = new TaskInstanceComparator();
+	static WfTarefaComparator tic = new WfTarefaComparator();
 
 	/**
 	 * Retorna as transições disponíveis em ordem alfabética.
@@ -49,23 +44,23 @@ public class FuncoesEL {
 	 * @param taskInstance
 	 * @return
 	 */
-	public static List<Transition> ordenarTransicoes(TaskInstance taskInstance) {
+	public static List<WfDefinicaoDeDesvio> ordenarTransicoes(WfTarefa taskInstance) {
 
-		Transition[] lista = new Transition[taskInstance
-				.getAvailableTransitions().size()];
-		taskInstance.getAvailableTransitions().toArray(lista);
+		WfDefinicaoDeDesvio[] lista = new WfDefinicaoDeDesvio[taskInstance.getDefinicaoDeTarefa().getDefinicaoDeDesvio()
+				.size()];
+		taskInstance.getDefinicaoDeTarefa().getDefinicaoDeDesvio().toArray(lista);
 
-		Arrays.sort(lista, new Comparator<Transition>() {
+		Arrays.sort(lista, new Comparator<WfDefinicaoDeDesvio>() {
 
-			public int compare(Transition o1, Transition o2) {
-				if (o1.getName() == null) {
+			public int compare(WfDefinicaoDeDesvio o1, WfDefinicaoDeDesvio o2) {
+				if (o1.getNome() == null) {
 					return 1;
 				}
-				if (o2.getName() == null) {
+				if (o2.getNome() == null) {
 					return -1;
 				}
 
-				return o1.getName().compareToIgnoreCase(o2.getName());
+				return o1.getNome().compareToIgnoreCase(o2.getNome());
 			}
 
 		});
@@ -78,66 +73,62 @@ public class FuncoesEL {
 	 * 
 	 * @return
 	 */
-	public static List<TaskInstance> ordenarTarefas(TaskInstance taskInstance) {
-		TaskInstance[] lista = new TaskInstance[taskInstance
-				.getTaskMgmtInstance().getTaskInstances().size()];
-		taskInstance.getTaskMgmtInstance().getTaskInstances().toArray(lista);
-
-		Arrays.sort(lista, new Comparator<TaskInstance>() {
-
-			public int compare(TaskInstance o1, TaskInstance o2) {
-				if (o1.getCreate().getTime() < o2.getCreate().getTime()) {
-					return 1;
-				}
-				if (o1.getCreate().getTime() > o2.getCreate().getTime()) {
-					return -1;
-				}
-				return 0;
-			}
-
-		});
-
-		return Arrays.asList(lista);
-	}
+//	public static List<TaskInstance> ordenarTarefas(TaskInstance taskInstance) {
+//		TaskInstance[] lista = new TaskInstance[taskInstance.getTaskMgmtInstance().getTaskInstances().size()];
+//		taskInstance.getTaskMgmtInstance().getTaskInstances().toArray(lista);
+//
+//		Arrays.sort(lista, new Comparator<TaskInstance>() {
+//
+//			public int compare(TaskInstance o1, TaskInstance o2) {
+//				if (o1.getCreate().getTime() < o2.getCreate().getTime()) {
+//					return 1;
+//				}
+//				if (o1.getCreate().getTime() > o2.getCreate().getTime()) {
+//					return -1;
+//				}
+//				return 0;
+//			}
+//
+//		});
+//
+//		return Arrays.asList(lista);
+//	}
 
 	/**
 	 * Retorna a lista de tarefas em ordem decrescente de criação.
 	 * 
 	 * @return
 	 */
-	public static List<Comment> ordenarComentarios(TaskInstance taskInstance) {
-		if (taskInstance.getComments() == null)
-			return new ArrayList(0);
-		Comment[] lista = new Comment[taskInstance.getComments().size()];
-		taskInstance.getComments().toArray(lista);
-
-		Arrays.sort(lista, new Comparator<Comment>() {
-
-			public int compare(Comment o1, Comment o2) {
-				if (o1.getTime().getTime() < o2.getTime().getTime()) {
-					return 1;
-				}
-				if (o1.getTime().getTime() > o2.getTime().getTime()) {
-					return -1;
-				}
-				return 0;
-			}
-
-		});
-
-		return Arrays.asList(lista);
-	}
+//	public static List<Comment> ordenarComentarios(TaskInstance taskInstance) {
+//		if (taskInstance.getComments() == null)
+//			return new ArrayList(0);
+//		Comment[] lista = new Comment[taskInstance.getComments().size()];
+//		taskInstance.getComments().toArray(lista);
+//
+//		Arrays.sort(lista, new Comparator<Comment>() {
+//
+//			public int compare(Comment o1, Comment o2) {
+//				if (o1.getTime().getTime() < o2.getTime().getTime()) {
+//					return 1;
+//				}
+//				if (o1.getTime().getTime() > o2.getTime().getTime()) {
+//					return -1;
+//				}
+//				return 0;
+//			}
+//
+//		});
+//
+//		return Arrays.asList(lista);
+//	}
 
 	public static List<String> listarOpcoes(String nomeVariavel) {
-		String op = nomeVariavel.substring(nomeVariavel.indexOf("(") + 1,
-				nomeVariavel.length() - 1);
+		String op = nomeVariavel.substring(nomeVariavel.indexOf("(") + 1, nomeVariavel.length() - 1);
 		return Arrays.asList(op.split(";"));
 	}
 
-	public static Boolean podePegarTarefa(DpPessoa cadastrante,
-			DpPessoa titular, DpLotacao lotaCadastrante, DpLotacao lotaTitular,
-			TaskInstance ti) {
-		return Wf.getInstance().getBL().podePegarTarefa(cadastrante, titular,
-				lotaCadastrante, lotaTitular, ti);
+	public static Boolean podePegarTarefa(DpPessoa cadastrante, DpPessoa titular, DpLotacao lotaCadastrante,
+			DpLotacao lotaTitular, WfTarefa ti) {
+		return Wf.getInstance().getBL().podePegarTarefa(cadastrante, titular, lotaCadastrante, lotaTitular, ti);
 	}
 }
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/SigaWFStarter.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/SigaWFStarter.java
deleted file mode 100644
index 50f4190d42..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/SigaWFStarter.java
+++ /dev/null
@@ -1,57 +0,0 @@
-package br.gov.jfrj.siga.wf.util;
-
-import javax.annotation.PostConstruct;
-
-import org.hibernate.cfg.Configuration;
-import org.jbpm.JbpmConfiguration;
-
-import br.com.caelum.vraptor.ioc.ApplicationScoped;
-import br.com.caelum.vraptor.ioc.Component;
-import br.gov.jfrj.siga.base.auditoria.hibernate.auditor.SigaAuditor;
-import br.gov.jfrj.siga.base.auditoria.hibernate.auditor.SigaHibernateChamadaAuditor;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-/**
- * 
- * @author Rodrigo Ramalho hodrigohamalho@gmail.com
- *
- */
-@Component
-@ApplicationScoped
-public class SigaWFStarter {
-
-	private static final String JBPM_CFG_XML = "jbpm.cfg.xml";
-	private static final String DATASOURCE = "java:jboss/datasources/SigaWfDS";
-
-	@PostConstruct
-	public void init() {
-		try {
-			System.out.println("Inicializando o hibernate!");
-			initHibernate();
-			System.out.println("Hibernate iniciado!");
-			System.out.println("Inicializando o JBPM!");
-			initJBPM();
-			System.out.println("JBPM incializado!");
-		} catch (Exception e) {
-			e.printStackTrace();
-		}
-	}
-
-	private void initHibernate() throws Exception {
-		Wf.getInstance();
-		Configuration cfg = WfDao.criarHibernateCfg(DATASOURCE);
-		WfHibernateUtil.configurarHibernate(cfg);
-		SigaAuditor.configuraAuditoria(new SigaHibernateChamadaAuditor(cfg));
-	}
-
-	private void initJBPM() {
-		JbpmConfiguration configuration = JbpmConfiguration
-				.getInstance(JBPM_CFG_XML);
-		configuration.createJbpmContext().setSessionFactory(
-				WfHibernateUtil.getSessao().getSessionFactory());
-		configuration.startJobExecutor();
-		WfContextBuilder.setConfiguration(configuration);
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfActionHandler.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfActionHandler.java
deleted file mode 100644
index 6974b49c1b..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfActionHandler.java
+++ /dev/null
@@ -1,66 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.lang.reflect.Method;
-
-import org.jbpm.graph.def.ActionHandler;
-import org.jbpm.graph.exe.ExecutionContext;
-
-/**
- * Action personalizada que sempre passa o executionContext nas chamadas dos métodos. 
- * @author kpf
- *
- */
-public abstract class WfActionHandler implements ActionHandler {
-
-	private String method;
-
-	/**
-	 * Passa o executionContext nas chamadas dos métodos
-	 */
-	public void execute(ExecutionContext executionContext) throws Exception {
-		if (method == null)
-			throw new Exception("Não foi associado um Action.");
-		else {
-			Method m = this.getClass()
-					.getMethod(method, ExecutionContext.class);
-			if (m == null)
-				throw new Exception("Action não encontrado.");
-			m.invoke(this, executionContext);
-		}
-	}
-
-	/**
-	 * Retorna o método a ser invocado.
-	 * @return
-	 */
-	public String getMethod() {
-		return method;
-	}
-
-	/**
-	 * Informa o método a ser invocado.
-	 * @param method
-	 */
-	public void setMethod(String method) {
-		this.method = method;
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfDaoCreator.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfDaoCreator.java
new file mode 100644
index 0000000000..3181e7aef6
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfDaoCreator.java
@@ -0,0 +1,15 @@
+package br.gov.jfrj.siga.wf.util;
+
+import javax.enterprise.context.RequestScoped;
+import javax.enterprise.inject.Produces;
+
+import br.gov.jfrj.siga.wf.dao.WfDao;
+
+@RequestScoped
+public class WfDaoCreator {
+	@Produces
+	@RequestScoped
+	public WfDao getInstance() {
+		return WfDao.getInstance();
+	}
+}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfInterceptor.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfInterceptor.java
new file mode 100644
index 0000000000..a5fb19618f
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfInterceptor.java
@@ -0,0 +1,89 @@
+package br.gov.jfrj.siga.wf.util;
+
+import javax.enterprise.context.RequestScoped;
+import javax.inject.Inject;
+import javax.persistence.EntityManager;
+import javax.servlet.ServletContext;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import br.com.caelum.vraptor.AroundCall;
+import br.com.caelum.vraptor.InterceptionException;
+import br.com.caelum.vraptor.Intercepts;
+import br.com.caelum.vraptor.controller.ControllerMethod;
+import br.com.caelum.vraptor.interceptor.SimpleInterceptorStack;
+import br.com.caelum.vraptor.jpa.JPATransactionInterceptor;
+import br.com.caelum.vraptor.validator.Validator;
+import br.gov.jfrj.siga.model.ContextoPersistencia;
+import br.gov.jfrj.siga.model.dao.ModeloDao;
+import br.gov.jfrj.siga.wf.bl.Wf;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+
+@RequestScoped
+@Intercepts(before = JPATransactionInterceptor.class)
+public class WfInterceptor {
+
+	private final EntityManager manager;
+	private final Validator validator;
+	private final HttpServletRequest request;
+	private final HttpServletResponse response;
+	private final ServletContext context;
+
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	public WfInterceptor() {
+		super();
+		manager = null;
+		validator = null;
+		request = null;
+		response = null;
+		context = null;
+	}
+
+	@Inject
+	public WfInterceptor(EntityManager manager, Validator validator, ServletContext context, HttpServletRequest request,
+			HttpServletResponse response) {
+		this.manager = manager;
+		this.validator = validator;
+		this.request = request;
+		this.response = response;
+		this.context = context;
+	}
+
+	@AroundCall
+	public void intercept(SimpleInterceptorStack stack) {
+
+		// EntityManager em = ExStarter.emf.createEntityManager();
+
+		ContextoPersistencia.setEntityManager(this.manager);
+
+		// Inicialização padronizada
+		// CurrentRequest.set(new RequestInfo(this.context, this.request,
+		// this.response));
+
+		ModeloDao.freeInstance();
+		WfDao.getInstance();
+		try {
+			Wf.getInstance().getConf().limparCacheSeNecessario();
+		} catch (Exception e1) {
+			throw new RuntimeException("Não foi possível atualizar o cache de configurações", e1);
+		}
+
+		try {
+			stack.next();
+		} catch (Exception e) {
+			throw new InterceptionException(e);
+		} finally {
+			// Renato Crivano: precisei desabilitar a linha abaixo porque parece que o
+			// vRaptor4
+			// retorna do stack.next() antes de processar o JSP.
+			//
+			// ContextoPersistencia.setEntityManager(null);
+		}
+	}
+
+	public boolean accepts(ControllerMethod method) {
+		return true; // Will intercept all requests
+	}
+}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskVO.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskVO.java
deleted file mode 100644
index 15da275897..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTaskVO.java
+++ /dev/null
@@ -1,478 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.lang.reflect.InvocationTargetException;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.List;
-import java.util.Set;
-import java.util.TreeSet;
-import java.util.regex.Matcher;
-import java.util.regex.Pattern;
-
-import org.jbpm.context.def.VariableAccess;
-import org.jbpm.graph.def.Node;
-import org.jbpm.graph.def.Transition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.graph.node.EndState;
-import org.jbpm.graph.node.TaskNode;
-import org.jbpm.jpdl.el.impl.JbpmExpressionEvaluator;
-import org.jbpm.taskmgmt.def.Task;
-import org.jbpm.taskmgmt.exe.PooledActor;
-import org.jbpm.taskmgmt.exe.SwimlaneInstance;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.gov.jfrj.siga.Service;
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.base.Texto;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.ex.service.ExService;
-import br.gov.jfrj.siga.model.Objeto;
-import br.gov.jfrj.siga.parser.PessoaLotacaoParser;
-import br.gov.jfrj.siga.wf.WfConhecimento;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfAssignmentHandler;
-import br.gov.jfrj.siga.wf.util.WfWikiParser;
-
-/**
- * Classe que repesenta um View Object (Objeto Visão, ou seja, objeto que será
- * usado na exibição da interface do usuário) de uma tarefa.
- * 
- * @author kpf
- * 
- */
-public class WfTaskVO {
-	public static final String DISABLE_DOC_FORWARD = "disable_doc_forward";
-
-	protected TaskInstance taskInstance;
-
-	protected List<VariableAccess> variableList = new ArrayList<VariableAccess>();
-
-	protected Set<WfTransitionVO> transitions = new TreeSet<WfTransitionVO>();
-
-	private String descricao = null;
-
-	private boolean conhecimentoEditavel = false;
-
-	private String conhecimento = null;
-
-	private String msgAviso = "";
-
-	private List<String> tags;
-
-	private String ancora;
-
-	/**
-	 * Construtor privado, impedindo a instanciação sem informar a tarefa.
-	 */
-	private WfTaskVO() {
-	};
-
-	/**
-	 * Contrutor padrão (default)
-	 * 
-	 * @param taskInstance
-	 */
-	public WfTaskVO(TaskInstance taskInstance) {
-		this.taskInstance = taskInstance;
-	}
-
-	public WfTaskVO(TaskInstance taskInstance, DpPessoa titular,
-			DpLotacao lotaTitular) throws IllegalAccessException,
-			InvocationTargetException, Exception, AplicacaoException {
-		this(taskInstance, null, titular, lotaTitular);
-	}
-
-	public WfTaskVO(TaskInstance taskInstance, String siglaDoc,
-			DpPessoa titular, DpLotacao lotaTitular)
-			throws IllegalAccessException, InvocationTargetException,
-			Exception, AplicacaoException {
-		this.taskInstance = taskInstance;
-
-		WfConhecimento c = WfDao.getInstance().consultarConhecimento(
-				taskInstance.getProcessInstance().getProcessDefinition()
-						.getName(), taskInstance.getName());
-		if (c != null) {
-			this.setDescricao(WfWikiParser.renderXHTML(c.getDescricao()));
-			this.setConhecimento(c.getDescricao());
-		} else {
-			if (taskInstance.getDescription() != null) {
-				this.setDescricao(WfWikiParser.renderXHTML(taskInstance
-						.getDescription()));
-				this.setConhecimento(taskInstance.getDescription());
-			}
-		}
-
-		ExService service = Service.getExService();
-
-		String siglaTitular = titular.getSigla() + "@"
-				+ lotaTitular.getSiglaCompleta();
-
-		String respWF = taskInstance.getActorId();
-		if (respWF == null)
-			for (PooledActor lot : (Collection<PooledActor>) taskInstance
-					.getPooledActors()) {
-				respWF = "@" + lot.getActorId();
-				break;
-			}
-
-		// O ideal é que seja desconsiderada apenas a variavel cujo valor seja
-		// igual a siglaDoc, e não todas que começam com doc_
-		if (taskInstance.getTask().getTaskController() != null) {
-			List<VariableAccess> variableAccesses = (List<VariableAccess>) taskInstance
-					.getTask().getTaskController().getVariableAccesses();
-
-			for (VariableAccess va : variableAccesses) {
-				if (va.getAccess() !=null){
-					String access = va.getAccess().toString();
-					if (access.contains("value=")) {
-						Pattern pattern = Pattern.compile("value\\=(\\{[^}]+\\})");
-						Matcher matcher = pattern.matcher(access);
-						if (matcher.find()) {
-							String expression = matcher.group(1);
-							Object resultado = JbpmExpressionEvaluator.evaluate(
-									"#" + expression,
-									new ExecutionContext(taskInstance.getToken()));
-							taskInstance.getContextInstance().setVariableLocally(
-									va.getMappedName(), resultado,
-									taskInstance.getToken());
-						}
-					}
-	
-					WfVariableAccessVO wfva = new WfVariableAccessVO(va);
-					if (wfva.getMappedName().startsWith("doc_")) {
-						String documento = (String) taskInstance
-								.getContextInstance().getVariable(
-										wfva.getMappedName());
-						if (documento != null) {
-							if (siglaDoc == null || !documento.startsWith(siglaDoc)) {
-								this.variableList.add(wfva);
-							} else {
-								if (wfva != null)
-									this.variableList.add(wfva);
-								setMsgAviso("");
-								if (!access.contains(DISABLE_DOC_FORWARD)) {
-									// if (!service.isAtendente(value, siglaTitular)) {
-									String respEX = service.getAtendente(documento,
-											siglaTitular);
-									DpLotacao lotEX = new PessoaLotacaoParser(respEX)
-											.getLotacaoOuLotacaoPrincipalDaPessoa();
-									// if (lotEX != null &&
-									// !lotaTitular.equivale(lotEX))
-									// wfva.setRespEX(lotEX.getSigla());
-		
-									DpLotacao lotWF = new PessoaLotacaoParser(respWF)
-											.getLotacaoOuLotacaoPrincipalDaPessoa();
-									// if (lotWF != null &&
-									// !lotaTitular.equivale(lotWF))
-									// wfva.setRespWF(lotWF.getSigla());
-		
-									// if (wfva.isAviso())
-									// }
-		
-									boolean podeMovimentar = service.podeMovimentar(
-											documento, siglaTitular);
-									boolean estaComTarefa = titular
-											.equivale(new PessoaLotacaoParser(respWF)
-													.getPessoa());
-									respEX = service.getAtendente(documento,
-											siglaTitular);
-									lotEX = new PessoaLotacaoParser(respEX)
-											.getLotacaoOuLotacaoPrincipalDaPessoa();
-		
-									if (podeMovimentar && !estaComTarefa) {
-										if (lotWF == null || !lotWF.equivale(lotEX)) {
-											setMsgAviso("Esta tarefa só poderá prosseguir quando o documento "
-													+ documento
-													+ " for transferido para "
-													+ (lotWF == null ? "Nula" : lotWF.getSigla()) + ".");
-										}
-									}
-									if (!podeMovimentar && estaComTarefa) {
-										setMsgAviso("Esta tarefa só poderá prosseguir quando o documento "
-												+ documento
-												+ ", que está com "
-												+ lotEX.getSigla() + ", for devolvido.");
-									}
-									if (!podeMovimentar && !estaComTarefa) {
-										if (lotWF != null && !lotWF.equivale(lotEX)) {
-											setMsgAviso("Esta tarefa só poderá prosseguir quando o documento "
-													+ documento
-													+ ", que está com "
-													+ lotEX.getSigla()
-													+ ", for transferido para "
-													+ lotWF.getSigla() + ".");
-										}
-									}
-		
-								}
-							}
-						} else {
-							this.variableList.add(wfva);
-						}
-					} else {
-						this.variableList.add(wfva);
-					}
-			}
-			}
-		}
-		if (taskInstance.getAvailableTransitions() != null) {
-			WfAssignmentHandler ah = new WfAssignmentHandler();
-			Set<String> set = new TreeSet<String>();
-
-			for (Transition transition : (Collection<Transition>) taskInstance
-					.getAvailableTransitions()) {
-
-				set.clear();
-				Node nextNode = transition.getTo();
-				while (nextNode != null) {
-					nextNode = (Node) Objeto.getImplementation(nextNode);
-					if (nextNode instanceof TaskNode
-							|| nextNode instanceof EndState)
-						break;
-					if (nextNode.getLeavingTransitions() != null
-							&& nextNode.getLeavingTransitions().size() == 1) {
-						nextNode = ((Transition) nextNode
-								.getLeavingTransitions().get(0)).getTo();
-					} else {
-						nextNode = null;
-						break;
-					}
-				}
-				if (nextNode != null) {
-					if (nextNode instanceof EndState) {
-						set.add("FIM");
-					} else if (nextNode instanceof TaskNode) {
-						TaskNode taskNode = (TaskNode) nextNode;
-						if (taskNode.getTasks() != null) {
-							Set<Task> tasks = (Set<Task>) taskNode.getTasks();
-							for (Task t : tasks) {
-								ExecutionContext ctx = new ExecutionContext(
-										taskInstance.getToken());
-								ctx.setTaskInstance(taskInstance);
-								if (t.getSwimlane() != null) {
-									{
-										SwimlaneInstance si = taskInstance
-												.getTaskMgmtInstance()
-												.getSwimlaneInstance(
-														t.getSwimlane()
-																.getName());
-										if (si != null) {
-											if (si.getActorId() != null)
-												set.add(si.getActorId());
-											if (si.getPooledActors() != null) {
-												for (Object s : si
-														.getPooledActors())
-													set.add(((PooledActor) s)
-															.getActorId());
-											}
-										}
-									}
-									if (set.size() == 0) {
-										SwimlaneInstance si = new SwimlaneInstance(
-												t.getSwimlane());
-										si.setTaskMgmtInstance(taskInstance
-												.getTaskMgmtInstance());
-										try {
-											ah.assign(si, ctx);
-											if (si.getActorId() != null)
-												set.add(si.getActorId());
-											if (si.getPooledActors() != null) {
-												for (Object s : si
-														.getPooledActors())
-													set.add(((PooledActor) s)
-															.getActorId());
-											}
-										} catch (AplicacaoException e) {
-
-										}
-									}
-								} else {
-									TaskInstance ti = new TaskInstance();
-									ti.setTask(t);
-									ti.setTaskMgmtInstance(taskInstance
-											.getTaskMgmtInstance());
-									try {
-										ah.assign(ti, ctx);
-										if (ti.getActorId() != null)
-											set.add(ti.getActorId());
-										if (ti.getPooledActors() != null) {
-											for (Object s : ti
-													.getPooledActors())
-												set.add(((PooledActor) s)
-														.getActorId());
-										}
-									} catch (AplicacaoException e) {
-
-									}
-								}
-							}
-						}
-					}
-				}
-				// Será que já temos em "set" uma lista das pessoas responsáveis
-				// pelo próximo passo?
-				// nextNode deve pular para o próximo se não for um tasknode e
-				// se só tiver uma saida
-
-				//System.out.println(set);
-
-				this.transitions.add(new WfTransitionVO(transition, set));
-			}
-		}
-
-		tags = new ArrayList<String>();
-		if (taskInstance.getProcessInstance().getProcessDefinition().getName() != null)
-			tags.add("@"
-					+ Texto.slugify(taskInstance.getProcessInstance()
-							.getProcessDefinition().getName(), true, true));
-		if (taskInstance.getName() != null)
-			tags.add("@" + Texto.slugify(taskInstance.getName(), true, true));
-
-		if (taskInstance.getProcessInstance().getProcessDefinition().getName() != null
-				&& taskInstance.getName() != null)
-			ancora = "^wf:"
-					+ Texto.slugify(taskInstance.getProcessInstance()
-							.getProcessDefinition().getName()
-							+ "-" + taskInstance.getName(), true, true);
-	}
-
-	/**
-	 * Retorna o objeto TaskInstance.
-	 * 
-	 * @return
-	 */
-	public TaskInstance getTaskInstance() {
-		return taskInstance;
-	}
-
-	/**
-	 * Define o objeto TaskInstance.
-	 * 
-	 * @param taskInstance
-	 */
-	public void setTaskInstance(TaskInstance taskInstance) {
-		this.taskInstance = taskInstance;
-	}
-
-	/**
-	 * Retorna a lista de variáveis.
-	 * 
-	 * @return
-	 */
-	public List<VariableAccess> getVariableList() {
-		return variableList;
-	}
-
-	/**
-	 * Define a lista de variáveis.
-	 * 
-	 * @param variables
-	 */
-	public void setVariableList(List<VariableAccess> variables) {
-		this.variableList = variables;
-	}
-
-	/**
-	 * Retorna as transições.
-	 * 
-	 * @return
-	 */
-	public Set<WfTransitionVO> getTransitions() {
-		return transitions;
-	}
-
-	/**
-	 * Define as transições.
-	 * 
-	 * @param transitions
-	 */
-	public void setTransitions(Set<WfTransitionVO> transitions) {
-		this.transitions = transitions;
-	}
-
-	/**
-	 * Retorna a descrição da tarefa.
-	 * 
-	 * @return
-	 */
-	public String getDescricao() {
-		return descricao;
-	}
-
-	public void setDescricao(String descricao) {
-		this.descricao = descricao;
-	}
-
-	public boolean isConhecimentoEditavel() {
-		return this.conhecimentoEditavel;
-	}
-
-	public void setConhecimentoEditavel(boolean conhecimentoEditavel) {
-		this.conhecimentoEditavel = conhecimentoEditavel;
-	}
-
-	public String getConhecimento() {
-		return conhecimento;
-	}
-
-	public void setConhecimento(String conhecimento) {
-		this.conhecimento = conhecimento;
-	}
-
-	public void setMsgAviso(String msgAviso) {
-		this.msgAviso = msgAviso;
-	}
-
-	public String getMsgAviso() {
-		return msgAviso;
-	}
-
-	public List<String> getTags() {
-		return tags;
-	}
-
-	public void setTags(List<String> tags) {
-		this.tags = tags;
-	}
-
-	public String getAncora() {
-		return ancora;
-	}
-
-	public void setAncora(String ancora) {
-		this.ancora = ancora;
-	}
-	
-	public String getCadastrante() {
-		return (String) getTaskInstance().getVariable("wf_cadastrante");
-	}
-	public String getLotaCadastrante() {
-		return (String) getTaskInstance().getVariable("wf_lota_cadastrante");
-	}
-	public String getTitular() {
-		return (String) getTaskInstance().getVariable("wf_titular");
-	}
-	public String getLotaTitular() {
-		return (String) getTaskInstance().getVariable("wf_lota_titular");
-	}
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfThreadFilter.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfThreadFilter.java
deleted file mode 100644
index 94e2848f5c..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfThreadFilter.java
+++ /dev/null
@@ -1,42 +0,0 @@
-package br.gov.jfrj.siga.wf.util;
-
-import java.io.IOException;
-
-import javax.servlet.FilterChain;
-import javax.servlet.FilterConfig;
-import javax.servlet.ServletException;
-import javax.servlet.ServletRequest;
-import javax.servlet.ServletResponse;
-
-import br.gov.jfrj.siga.base.auditoria.filter.ThreadFilter;
-
-public class WfThreadFilter extends ThreadFilter {
-
-	public void doFiltro(final ServletRequest request,
-			final ServletResponse response, final FilterChain chain)
-			throws IOException, ServletException {
-		WfExecutionEnvironment ee = new WfExecutionEnvironment();
-		try {
-			ee.antes();
-			chain.doFilter(request, response);
-			ee.depois();
-		} catch (Exception e) {
-			ee.excecao();
-
-			throw new ServletException(e);
-		} finally {
-			ee.finalmente();
-		}
-	}
-
-	public void destroy() {
-	}
-
-	public void init(FilterConfig arg0) throws ServletException {
-	}
-
-	@Override
-	protected String getLoggerName() {
-		return "br.gov.jfrj.siga.wf";
-	}
-}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTipoResponsavel.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTipoResponsavel.java
deleted file mode 100644
index 5ee64d9f87..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTipoResponsavel.java
+++ /dev/null
@@ -1,95 +0,0 @@
-package br.gov.jfrj.siga.wf.util;
-
-/**
- * Classe que representa o tipo do responsável designado.
- * 
- * @author kpf
- * 
- */
-public class WfTipoResponsavel {
-	private int id;
-	/**
-	 * Texto amigável que representa o tipo de responsável.
-	 */
-	private String texto;
-
-	/**
-	 * Texto da expressão ou identificador do tipo de responsável.
-	 */
-	private String valor;
-
-	/**
-	 * Construtor da classe TipoResponsável.
-	 * 
-	 * @param id
-	 * @param texto
-	 * @param valor
-	 */
-	public WfTipoResponsavel(int id, String texto, String valor) {
-		this.setId(id);
-		this.setTexto(texto);
-		this.setValor(valor);
-	}
-
-	/**
-	 * Retorna o id do tipo de responsável.
-	 * 
-	 * @return
-	 */
-	public int getId() {
-		return id;
-	}
-
-	/**
-	 * Retorna o texto amigável do Tipo de responsável
-	 * 
-	 * @return
-	 */
-	public String getTexto() {
-		return texto;
-	}
-
-	/**
-	 * Retorna o valor do tipo de responsável, por exemplo, a expressão
-	 * associada ao tipo de responsável.
-	 * 
-	 * @return
-	 */
-	public String getValor() {
-		return valor;
-	}
-
-	/**
-	 * Define o id do tipo de responsável.
-	 * 
-	 * @param id
-	 */
-	public void setId(int id) {
-		this.id = id;
-	}
-
-	/**
-	 * Define o texto amigável do tipo de responsável.
-	 * 
-	 * @param texto
-	 */
-	public void setTexto(String texto) {
-		this.texto = texto;
-	}
-
-	/**
-	 * Define o valor (por exemplo, a expressão) do tipo de responsável.
-	 * 
-	 * @param valor
-	 */
-	public void setValor(String valor) {
-		this.valor = valor;
-	}
-
-	/**
-	 * Retorna o texto amigável do tipo de responsável.
-	 */
-	public String toString() {
-		return this.getId() + ")" + this.getTexto();
-	}
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTransitionVO.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTransitionVO.java
deleted file mode 100644
index 0f583c2dd2..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfTransitionVO.java
+++ /dev/null
@@ -1,118 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.lang.reflect.InvocationTargetException;
-import java.util.Arrays;
-import java.util.Comparator;
-import java.util.Set;
-
-import org.jbpm.graph.def.Transition;
-
-/**
- * Classe que repesenta um View Object (Objeto Visão, ou seja, objeto que será
- * usado na exibição da interface do usuário) de uma variável presente em uma
- * tarefa.
- * 
- * @author tah
- * 
- */
-public class WfTransitionVO implements Comparable {
-	private String name;
-	private String resp;
-	private boolean stop;
-	private boolean yes;
-	private boolean no;
-	private boolean next;
-
-	public WfTransitionVO(Transition t, Set<String> lResp)
-			throws IllegalAccessException, InvocationTargetException {
-		this.name = t.getName();
-		if (name != null) {
-			if (name.equalsIgnoreCase("sim"))
-				yes = true;
-			if (name.equalsIgnoreCase("não") || name.equalsIgnoreCase("nao"))
-				no = true;
-		}
-
-		this.resp = "";
-		for (String s : lResp) {
-			if (s.equals("FIM"))
-				stop = true;
-			if (this.resp.length() > 0)
-				this.resp += ", ";
-			this.resp += s;
-		}
-		if (this.resp.length() > 0)
-			this.resp = " &raquo; " + this.resp;
-	}
-
-	public String getIcon() {
-		if (stop)
-			return "stop";
-		if (yes)
-			return "accept";
-		if (no)
-			return "cancel";
-		return "bullet_go";
-	}
-
-	public String getName() {
-		return name;
-	}
-
-	public void setName(String name) {
-		this.name = name;
-	}
-
-	public String getResp() {
-		return resp;
-	}
-
-	public void setResp(String resp) {
-		this.resp = resp;
-	}
-
-	public int compareTo(Object o) {
-		WfTransitionVO other = (WfTransitionVO) o;
-		if (this.stop && !other.stop)
-			return 1;
-		if (!this.stop && other.stop)
-			return -1;
-		if (!this.yes && other.yes)
-			return 1;
-		if (this.yes && !other.yes)
-			return -1;
-		if (!this.no && other.no)
-			return 1;
-		if (this.no && !other.no)
-			return -1;
-
-		if (this.getName() == null) {
-			return 1;
-		}
-		if (other.getName() == null) {
-			return -1;
-		}
-		int i = this.getName().compareToIgnoreCase(other.getName());
-		if (i != 0)
-			return i;
-		return ((Integer) this.hashCode()).compareTo(other.hashCode());
-	}
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfUtil.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfUtil.java
new file mode 100644
index 0000000000..66665cb60f
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfUtil.java
@@ -0,0 +1,141 @@
+package br.gov.jfrj.siga.wf.util;
+
+import java.io.UnsupportedEncodingException;
+import java.lang.reflect.InvocationTargetException;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+import java.util.TreeMap;
+
+import javax.enterprise.context.RequestScoped;
+import javax.inject.Inject;
+
+import com.crivano.jflow.GraphViz;
+
+import br.gov.jfrj.siga.Service;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.ex.service.ExService;
+import br.gov.jfrj.siga.vraptor.SigaObjects;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDePrincipal;
+
+@RequestScoped
+public class WfUtil {
+	protected Map<String, String> mapDescricao = new TreeMap<String, String>();
+
+	private SigaObjects so;
+
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	protected WfUtil() {
+		this(null);
+	};
+
+	@Inject
+	public WfUtil(SigaObjects so) {
+		super();
+		this.so = so;
+	}
+
+	/**
+	 * Retorna a sigla do ator a quem estï¿½ atribuida a tarefa, ou a sigla da
+	 * lotaï¿½ï¿½o se a tarefa estiver no pool. Se a tarefa estiver com o titular,
+	 * retorna "(minha)"
+	 * 
+	 * 
+	 * @param ti
+	 * @return
+	 */
+	public String getAtendente(WfTarefa ti) {
+		if (ti.getInstanciaDeProcedimento().getEventoPessoa() != null) {
+			if (ti.getInstanciaDeProcedimento().getEventoPessoa().getPessoaAtual().equals(so.getTitular()))
+				return "(minha)";
+			else
+				return ti.getInstanciaDeProcedimento().getEventoPessoa().getPessoaAtual().getSiglaCompleta();
+		}
+		if (ti.getInstanciaDeProcedimento().getEventoLotacao() != null)
+			return ti.getInstanciaDeProcedimento().getEventoLotacao().getSiglaCompleta();
+		return "";
+	}
+
+	public String getDescricao(String sigla) {
+		if (mapDescricao.containsKey(sigla)) {
+			return mapDescricao.get(sigla);
+		}
+
+		DpLotacao lot = so.daoLot(so.getLotaTitular().getOrgaoUsuario().getSigla() + sigla);
+		if (lot != null) {
+			mapDescricao.put(sigla, lot.getDescricao());
+			return lot.getDescricao();
+		}
+
+		DpPessoa pes = so.daoPes(sigla);
+		if (pes != null) {
+			mapDescricao.put(sigla, pes.getDescricao());
+			return pes.getDescricao();
+		}
+
+		return "";
+	}
+
+	/**
+	 * Retorna a sigla do primeiro ator que faï¿½a parte do pool de atores na task
+	 * instance.
+	 * 
+	 * @param ti
+	 * @return
+	 */
+//	public String getPooledActors(WfInstanciaDeTarefa ti) {
+//		if (ti.getActorId() != null)
+//			return ti.getActorId();
+//		if (ti.getPooledActors().size() == 0)
+//			return "";
+//		String s = ((PooledActor) ti.getPooledActors().toArray()[0]).getActorId();
+//		if (s.startsWith(so.getLotaTitular().getOrgaoUsuario().getSigla()))
+//			s = s.substring(so.getLotaTitular().getOrgaoUsuario().getSigla().length());
+//		return s;
+//	}
+
+	// private String designacao(String actorId, Set pooledActors) {
+//		if (actorId == null && pooledActors == null)
+//			return null;
+//		if (pooledActors == null || pooledActors.size() == 0)
+//			return actorId;
+//		String pa = "";
+//		for (Object a : pooledActors) {
+//			if (pa.length() > 0)
+//				pa += "/";
+//			if (a instanceof PooledActor)
+//				pa += ((PooledActor) a).getActorId();
+//		}
+//
+//		if (actorId == null)
+//			return pa;
+//
+//		return actorId + " - " + pa;
+//	}
+
+	public String getDot(WfTarefa taskInstance) throws UnsupportedEncodingException, Exception {
+		WfProcedimento pi = taskInstance.getInstanciaDeProcedimento();
+		return GraphViz.getDot(pi, "Início", "Fim");
+	}
+
+//	private static boolean atorDeveReexecutarTarefa(DpPessoa ator, WfInstanciaDeTarefa ti) {
+//		if (ti.getPooledActors() != null && ti.getPooledActors().size() == 1) {
+//			DpLotacaoDaoFiltro lotflt = new DpLotacaoDaoFiltro();
+//			lotflt.setSiglaCompleta(((PooledActor) ti.getPooledActors().toArray()[0]).getActorId());
+//			DpLotacao lotacao = (DpLotacao) WfDao.getInstance().consultarPorSigla(lotflt);
+//			return !ator.isFechada() && ator.getLotacao().equivale(lotacao);
+//		} else {
+//			return false;
+//		}
+//	}
+
+	public String getSiglaTitular() {
+		return so.getTitular().getSigla() + "@" + so.getLotaTitular().getSiglaCompleta();
+	}
+
+}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfVariableAccessVO.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfVariableAccessVO.java
deleted file mode 100644
index c3796e5c55..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/util/WfVariableAccessVO.java
+++ /dev/null
@@ -1,64 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.util;
-
-import java.lang.reflect.InvocationTargetException;
-
-import org.jbpm.context.def.VariableAccess;
-
-/**
- * Classe que repesenta um View Object (Objeto Visão, ou seja, objeto que será
- * usado na exibição da interface do usuário) de uma variável presente em uma
- * tarefa.
- * 
- * @author tah
- * 
- */
-public class WfVariableAccessVO extends VariableAccess {
-	private String respEX;
-	private String respWF;
-
-	public WfVariableAccessVO(VariableAccess va) throws IllegalAccessException,
-			InvocationTargetException {
-		this.access = va.getAccess();
-		this.mappedName = va.getMappedName();
-		this.variableName = va.getVariableName();
-	}
-
-	public boolean isAviso() {
-		return respEX != null || respWF != null;
-	}
-
-	public String getRespEX() {
-		return respEX;
-	}
-
-	public void setRespEX(String respEX) {
-		this.respEX = respEX;
-	}
-
-	public String getRespWF() {
-		return respWF;
-	}
-
-	public void setRespWF(String respWF) {
-		this.respWF = respWF;
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/AdminController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/AdminController.java
deleted file mode 100644
index b366e5e640..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/AdminController.java
+++ /dev/null
@@ -1,145 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import java.io.ByteArrayOutputStream;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.util.Date;
-import java.util.List;
-import java.util.zip.ZipEntry;
-import java.util.zip.ZipOutputStream;
-
-import javax.servlet.http.HttpServletRequest;
-
-import org.jbpm.file.def.FileDefinition;
-import org.jbpm.graph.def.Node;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.exe.Token;
-
-import br.com.caelum.vraptor.Get;
-import br.com.caelum.vraptor.Path;
-import br.com.caelum.vraptor.Resource;
-import br.com.caelum.vraptor.Result;
-import br.com.caelum.vraptor.interceptor.download.ByteArrayDownload;
-import br.com.caelum.vraptor.interceptor.download.InputStreamDownload;
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.base.Data;
-import br.gov.jfrj.siga.vraptor.SigaObjects;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-
-@Resource
-public class AdminController extends WfController {
-
-	public AdminController(HttpServletRequest request, Result result,
-			WfDao dao, SigaObjects so, WfUtil util) {
-		super(request, result, dao, so, util);
-	}
-
-	public void administrar() {
-	}
-
-	@SuppressWarnings("unchecked")
-	public void moveToken(Long idToken, Long idNode) throws Exception {
-		assertAcesso(ACESSO_MOVER_TOKEN);
-		Token t = WfContextBuilder.getJbpmContext().getJbpmContext()
-				.getToken(idToken);
-		if (idNode == 0) {
-			t.signal();
-			redirectToHome();
-			return;
-		}
-		List<Node> nodes = t.getProcessInstance().getProcessDefinition()
-				.getNodes();
-		for (Node n : nodes) {
-			if (idNode.equals(n.getId())) {
-				t.setNode(n);
-				redirectToHome();
-				return;
-			}
-		}
-		throw new AplicacaoException("Nenhuma ação realizada");
-	}
-
-	public void endProcessInstance(Long idTI, Long idPI, Date dtFim) throws Exception {
-		assertAcesso(ACESSO_ENCERRAR_INSTANCIA_DE_PROCESSO);		
-		
-		if (dtFim == null) {
-			dtFim = new Date();
-		} else {
-			  if (!Data.dataDentroSeculo21(dtFim)){
-				  throw new AplicacaoException("Data fim inválida, deve estar entre o ano 2000 e ano 2100");
-		
-			  }
-		}
-	
-		if (idTI != null) {
-			Wf.getInstance().getBL()
-					.encerrarProcessInstanceDaTarefa(idTI, dtFim);
-			setMensagem("Processo encerrado com sucesso!");
-			redirectToHome();
-			return;
-		}
-
-		if (idPI != null) {
-			Wf.getInstance().getBL().encerrarProcessInstance(idPI, dtFim);
-			setMensagem("Processo encerrado com sucesso!");
-		}
-		redirectToHome();
-	}
-
-	public void deleteProcessInstance(Long idPI) throws AplicacaoException, Exception {
-		assertAcesso(ACESSO_EXCLUIR_INSTANCIA_DE_PROCESSO);
-		Wf.getInstance().getBL().excluirProcessInstance(idPI);
-		redirectToHome();
-	}
-	
-	@Get
-	@Path("/app/download/{pdId}")
-	public ByteArrayDownload downloadArquivoDeployed(Long pdId) throws IOException {
-		ByteArrayOutputStream baos = null;
-		ZipOutputStream zos = null;
-
-		try{
-			String _proc_img = "processimage.jpg";
-			String _proc_def = "processdefinition.xml";
-			String _gpd_xml = "gpd.xml";
-			
-			ProcessDefinition processDefinition = WfDao.getInstance().getProcessDefinition(pdId);
-			FileDefinition fileDefinition = processDefinition.getFileDefinition();
-			
-			baos = new ByteArrayOutputStream();
-			zos = new ZipOutputStream(baos);
-			
-			byte[] arquivo = fileDefinition.getBytes(_proc_img);
-			ZipEntry entry = new ZipEntry(_proc_img);
-			entry.setSize(arquivo.length);
-			zos.putNextEntry(entry);
-			zos.write(arquivo);
-			zos.closeEntry();
-			
-			arquivo = fileDefinition.getBytes(_proc_def);
-			entry = new ZipEntry(_proc_def);
-			entry.setSize(arquivo.length);
-			zos.putNextEntry(entry);
-			zos.write(arquivo);
-			zos.closeEntry();
-		
-			arquivo = fileDefinition.getBytes(_gpd_xml);
-			entry = new ZipEntry(_gpd_xml);
-			entry.setSize(arquivo.length);
-			zos.putNextEntry(entry);
-			zos.write(arquivo);
-			zos.closeEntry();
-
-			zos.close();
-			
-			return new ByteArrayDownload(baos.toByteArray(), "application/zip", "process-definition-" + processDefinition.getName() + "-" + pdId + ".zip");
-
-		}finally{
-			baos.close();
-			zos.close();
-		}
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/AppController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/AppController.java
deleted file mode 100644
index a077064edf..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/AppController.java
+++ /dev/null
@@ -1,620 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import java.util.ArrayList;
-import java.util.HashMap;
-import java.util.Iterator;
-import java.util.List;
-import java.util.Map;
-import java.util.SortedSet;
-import java.util.TreeMap;
-
-import javax.servlet.http.HttpServletRequest;
-
-import org.apache.commons.beanutils.PropertyUtils;
-import org.jbpm.context.def.VariableAccess;
-import org.jbpm.graph.def.Transition;
-import org.jbpm.graph.exe.Comment;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.logging.log.ProcessLog;
-import org.jbpm.taskmgmt.exe.PooledActor;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.com.caelum.vraptor.Path;
-import br.com.caelum.vraptor.Resource;
-import br.com.caelum.vraptor.Result;
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.base.SigaCalendar;
-import br.gov.jfrj.siga.cp.model.DpLotacaoSelecao;
-import br.gov.jfrj.siga.cp.model.DpPessoaSelecao;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.dao.DpLotacaoDaoFiltro;
-import br.gov.jfrj.siga.vraptor.SigaIdDescr;
-import br.gov.jfrj.siga.vraptor.SigaObjects;
-import br.gov.jfrj.siga.vraptor.StringQualquer;
-import br.gov.jfrj.siga.wf.WfConhecimento;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-import br.gov.jfrj.siga.wf.util.WfTaskVO;
-
-@Resource
-@SuppressWarnings("unchecked")
-public class AppController extends WfController {
-
-	private static final String WF_REDIRECT_TO = "wf_redirect_to";
-
-	public AppController(HttpServletRequest request, Result result, WfDao dao,
-			SigaObjects so, WfUtil util) {
-		super(request, result, dao, so, util);
-	}
-
-	public void resumo() throws Exception {
-		inbox();
-	}
-
-	/**
-	 * Coloca as tarefas que estão para o usuário no atributo "taskInstances".
-	 * Além disso, coloca os procedimentos que podem ser iniciados pelo usuário
-	 * do sistema no atributo "processDefinitions".Este método é executando ao
-	 * ser chamada a action "inbox.action".
-	 * 
-	 * @return
-	 * @throws Exception
-	 */
-	public void inbox() throws Exception {
-		SortedSet<TaskInstance> taskInstances = Wf.getInstance().getBL()
-				.getTaskList(getCadastrante(), getTitular(), getLotaTitular());
-		Map<TaskInstance, String> pooledActors = new HashMap<TaskInstance, String>();
-		Map<String, String> pooledActorsDescricao = new HashMap<String, String>();
-		for (TaskInstance ti : taskInstances) {
-			String sigla = util.getPooledActors(ti);
-			pooledActors.put(ti, sigla);
-			pooledActorsDescricao.put(sigla, util.getDescricao(sigla));
-		}
-
-		result.include("taskInstances", taskInstances);
-		result.include("pooledActors", pooledActors);
-		result.include("pooledActorsDescricao", pooledActorsDescricao);
-	}
-
-	/**
-	 * Cria uma instância de processo baseando-se na definição de processo
-	 * escolhida pelo usuário.
-	 * 
-	 * @return
-	 * @throws Exception
-	 */
-	@Path("/app/initializeProcess/{pdId}")
-	public void initializeProcess(Long pdId) throws Exception {
-		if (pdId == null)
-			throw new RuntimeException();
-		ProcessInstance pi = Wf
-				.getInstance()
-				.getBL()
-				.createProcessInstance(pdId, getCadastrante(),
-						getCadastrante().getLotacao(), getTitular(),
-						getLotaTitular(), null, null, true);
-		for (TaskInstance ti : ((List<TaskInstance>) WfContextBuilder
-				.getJbpmContext().getJbpmContext()
-				.getTaskList(getTitular().getSigla()))) {
-			if (ti.getProcessInstance().getId() == pi.getId()) {
-				Long tiId = ti.getId();
-				result.redirectTo(this).task(tiId);
-				return;
-			}
-		}
-		redirectToHome();
-	}
-
-	/**
-	 * Prove uma url de teste para a inbox do workflow.
-	 * 
-	 * @return
-	 * @throws Exception
-	 */
-	@Path("/public/app/testes/gadgetTest")
-	public void test(String matricula) throws Exception {
-		DpPessoa pes = so.daoPes(matricula);
-		so.setTitular(pes);
-		so.setLotaTitular(pes.getLotacao());
-		result.forwardTo(this).inbox();
-	}
-
-	/**
-	 * Action que inicializa todos os campos que serão necessários para
-	 * finalizar a tarefa especificada pelo Id do ProcessoInstance e o Id do
-	 * ProcessDefinition.
-	 * 
-	 * @return Action.SUCCESS
-	 */
-	@Path("/app/task/{tiId}")
-	public void task(Long tiId) throws Exception {
-		TaskInstance taskInstance = loadTaskInstance(tiId);
-		List<SigaIdDescr> prioridades = new ArrayList<SigaIdDescr>();
-		prioridades.add(new SigaIdDescr(1, "Muito Alta"));
-		prioridades.add(new SigaIdDescr(2, "Alta"));
-		prioridades.add(new SigaIdDescr(3, "Média"));
-		prioridades.add(new SigaIdDescr(4, "Baixa"));
-		prioridades.add(new SigaIdDescr(5, "Muito Baixa"));
-		result.include("prioridades", prioridades);
-		result.include("task", util.inicializarTaskVO(taskInstance));
-		result.include("dot", util.getDot(taskInstance));
-	}
-
-	/**
-	 * Action que finaliza uma tarefa com as variaveis atribuidas. Os valores
-	 * são atribuídos às variáveis da tarefa e depois a tarefa é transferida ao
-	 * próximo passo. Se a próxima tarefa for para o mesmo ator, esta é exibida
-	 * imediatamente.
-	 * 
-	 * @return
-	 * @throws CsisException
-	 */
-	public void executeTask(Long tiId, String[] fieldNames,
-			StringQualquer[] fieldValues, String transitionName, String sigla)
-			throws Exception {
-		String cadastrante = getTitular().getSigla() + "@"
-				+ getLotaTitular().getSiglaCompleta();
-
-		TaskInstance taskInstance = loadTaskInstance(tiId);
-
-		// Pegar automaticamente
-		if (taskInstance.getActorId() == null) {
-			taskInstance.setActorId(getTitular().getSiglaCompleta(), false);
-			carregarAtorEGrupo(taskInstance);
-		}
-
-		util.assertPodeTransferirDocumentosVinculados(taskInstance, cadastrante);
-
-		if (taskInstance.getTask().getTaskController() != null) {
-			List<VariableAccess> vList = taskInstance.getTask()
-					.getTaskController().getVariableAccesses();
-			if (fieldNames != null) {
-				for (int n = 0, c = 0; n < fieldNames.length; n++) {
-					// Associa cada variavel com seu valore especifico
-					for (VariableAccess variable : vList) {
-						if (variable.getMappedName().equals(fieldNames[n])
-								&& variable.isWritable()) {
-							Object value;
-							if (variable.getMappedName().startsWith("doc_")) {
-								value = param(variable.getMappedName()
-										+ "_expedienteSel.sigla");
-							} else if (variable.getMappedName().startsWith(
-									"pes_")) {
-								value = param(variable.getMappedName()
-										+ "_pessoaSel.sigla");
-							} else if (variable.getMappedName().startsWith(
-									"lot_")) {
-								value = param(variable.getMappedName()
-										+ "_lotacaoSel.sigla");
-							} else if (variable.getMappedName().startsWith(
-									"dt_")) {
-								value = SigaCalendar
-										.converteStringEmData(fieldValues[c]
-												.toString());
-								c++;
-							} else if (variable.getMappedName().startsWith(
-									"sel_")) {
-								value = fieldValues[c];
-								c++;
-							} else {
-								value = fieldValues[c];
-								c++;
-
-							}
-							
-							if (value instanceof StringQualquer)
-								value = ((StringQualquer) value).toString();
-							
-							// Verifica se as variáveis "required" foram
-							// preenchidas"
-							if (variable.isRequired()
-									&& (value == null || (value instanceof String && (((String) value)
-											.trim().length() == 0)))) {
-								throw new AplicacaoException("O campo "
-										+ variable.getVariableName()
-										+ " deve ser preenchido");
-							}
-
-							taskInstance
-									.getToken()
-									.getProcessInstance()
-									.getContextInstance()
-									.setVariable(variable.getMappedName(),
-											value);
-						}
-					}
-				}
-			}
-		}
-
-		// Bloco que transfere a tarefa
-		if (transitionName != null && transitionName.contains("» ")) {
-			transitionName = transitionName.substring(0,
-					transitionName.indexOf("» "));
-		}
-		/*
-		 * código inserido para corrigir o caracter &raquo; (») contido no botão
-		 * e enviado pelo submit. Este, no caso de autenticação por certificado,
-		 * vem em conjunto com o caracter Â. (
-		 */
-		if (transitionName != null && transitionName.contains("Â» ")) {
-			transitionName = transitionName.substring(0,
-					transitionName.indexOf("Â» "));
-		}
-		/*
-		 * fim do código inserido para corrigir o caracter &raquo;
-		 */
-		if (transitionName != null){
-			transitionName = transitionName.trim();
-			if (transitionName.length() == 0)
-				transitionName = null;
-		}
-		// Transition transition = taskInstance.getTask().getTaskNode()
-		// .getLeavingTransition(transitionName);
-		boolean prosseguiu = false;
-		for (Transition transition : (List<Transition>) (taskInstance
-				.getAvailableTransitions())) {
-			if ((transition.getName() == null && transitionName == null)
-					|| ((transition.getName() != null && transitionName != null) && (transition
-							.getName().equals(new String(transitionName
-							.getBytes("ISO-8859-1")))))
-					|| ((transition.getName() != null && transitionName != null) && (transition
-							.getName().equals(new String(transitionName
-							.getBytes("UTF-8")))))) {
-				taskInstance.end(transition);
-				prosseguiu = true;
-				break;
-			}
-		}
-		
-		//Se não prosseguiu pelos caminhos alternativos, prossiga pelo caminho padrão.
-		if (!prosseguiu){
-			taskInstance.end();
-		}
-
-		WfContextBuilder.getJbpmContext().getJbpmContext()
-				.save(taskInstance.getToken().getProcessInstance());
-
-		// Service.getExService ().transferir ( "RJ-MEM-2007/00595-A" ,
-		// "@RJSCO" , "RJ13635@RJSESAD" );
-
-		util.transferirDocumentosVinculados(taskInstance.getProcessInstance(),
-				cadastrante);
-
-		// Redireciona para a pagina escolhida quando o procedimento criar uma
-		// variavel pre-definida
-		//
-		String redirectTo = (String) taskInstance.getVariable(WF_REDIRECT_TO);
-		if (redirectTo != null) {
-			// taskInstance.deleteVariable(WF_REDIRECT_TO);
-			WfDao.getInstance().getSessao().flush();
-			taskInstance.getProcessInstance().getContextInstance()
-					.deleteVariable(WF_REDIRECT_TO);
-			WfDao.getInstance().getSessao().flush();
-			result.redirectTo(redirectTo);
-			return;
-		}
-
-		// Apresenta a pagina do documento quando a sigla for fornecida
-		//
-		if (sigla != null) {
-			result.redirectTo("/../sigaex/app/expediente/doc/exibir?sigla="
-					+ sigla);
-			return;
-		}
-
-		// Verificar se um novo task foi criado para o process instance em
-		// questão. Se esse
-		// task existir e for designado para o mesmo ator, então a próxima
-		// página a ser exibida será a página de apresentação do task, e não a
-		// página inicial.
-		{
-			long idpi = taskInstance.getProcessInstance().getId();
-			SortedSet<TaskInstance> tasks = Wf
-					.getInstance()
-					.getBL()
-					.getTaskList(getCadastrante(), getTitular(),
-							getLotaTitular());
-			for (TaskInstance ti : tasks) {
-				if (ti.getProcessInstance().getId() == idpi) {
-					result.redirectTo(this).task(ti.getId());
-					return;
-				}
-			}
-		}
-		redirectToHome();
-	}
-
-	public void pegar(Long tiId, String sigla) throws Exception {
-		TaskInstance taskInstance = loadTaskInstance(tiId);
-
-		// Pegar
-		if (taskInstance.getActorId() == null) {
-			taskInstance.setActorId(getTitular().getSiglaCompleta(), false);
-			carregarAtorEGrupo(taskInstance);
-		}
-
-		if (sigla != null) {
-			result.redirectTo("/../sigaex/app/expediente/doc/exibir?sigla="
-					+ sigla);
-			return;
-		}
-		result.redirectTo(this).task(tiId);
-	}
-
-	/**
-	 * Grava o conhecimento a respeito de como uma tarefa deve ser executada.
-	 * 
-	 * @return
-	 * @throws CsisException
-	 */
-	public void saveKnowledge(Long tiId, String conhecimento) throws Exception {
-		TaskInstance taskInstance = getTaskInstance(tiId);
-
-		WfConhecimento cAntigo = ((WfDao) dao).consultarConhecimento(
-				taskInstance.getProcessInstance().getProcessDefinition()
-						.getName(), taskInstance.getName());
-
-		WfConhecimento cNovo = new WfConhecimento();
-		if (cAntigo != null) {
-			PropertyUtils.copyProperties(cNovo, cAntigo);
-			cNovo.setId(null);
-		} else {
-			cNovo.setProcedimento(taskInstance.getProcessInstance()
-					.getProcessDefinition().getName());
-			cNovo.setTarefa(taskInstance.getName());
-		}
-		cNovo.setDescricao(conhecimento);
-
-		dao.gravarComHistorico(cNovo, cAntigo, null, getIdentidadeCadastrante());
-
-		result.redirectTo(this).task(tiId);
-	}
-
-	/**
-	 * Action que finaliza uma tarefa com as variaveis atribuidas.
-	 * 
-	 * @return
-	 * @throws CsisException
-	 */
-	public void assignTask(Long tiId, DpPessoaSelecao ator_pessoaSel,
-			DpLotacaoSelecao lotaAtor_lotacaoSel, Integer prioridade,
-			String justificativa) throws Exception {
-		TaskInstance taskInstance = getTaskInstance(tiId);
-		ProcessInstance pi = taskInstance.getProcessInstance();
-
-		String actorId = null;
-		String lotaActorId = null;
-
-		if (ator_pessoaSel.getId() != null)
-			actorId = daoPes(ator_pessoaSel.getId()).getSigla();
-		if (lotaAtor_lotacaoSel.getId() != null)
-			lotaActorId = daoLot(lotaAtor_lotacaoSel.getId())
-					.getSiglaCompleta();
-
-		if (actorId == null && lotaActorId == null)
-			throw new AplicacaoException(
-					"Não é permitido designar a tarefa quando tanto a pessoa quanto a lotação estão em branco.");
-
-		DpLotacao lotAtualAtor = null;
-		DpLotacao lotAtualPool = null;
-		if (taskInstance.getActorId() != null) {
-			DpPessoa pesAtual = new DpPessoa();
-			pesAtual.setSigla(taskInstance.getActorId());
-			lotAtualAtor = dao.consultarPorSigla(pesAtual).getLotacao();
-		}
-		if (taskInstance.getPooledActors().size() != 0) {
-			DpLotacaoDaoFiltro lotflt = new DpLotacaoDaoFiltro();
-			lotflt.setSiglaCompleta(((PooledActor) taskInstance
-					.getPooledActors().toArray()[0]).getActorId());
-			lotAtualPool = (DpLotacao) dao.consultarPorSigla(lotflt);
-		}
-
-		boolean fActorChanged = (actorId != null && taskInstance.getActorId() == null)
-				|| (actorId == null && taskInstance.getActorId() != null)
-				|| (actorId != null && taskInstance.getActorId() != null && !taskInstance
-						.getActorId().equals(actorId));
-
-		boolean fPooledActorsChanged = (lotaActorId != null && taskInstance
-				.getPooledActors().size() == 0)
-				|| (lotaActorId == null && taskInstance.getPooledActors()
-						.size() != 0)
-				|| (lotaActorId != null
-						&& taskInstance.getPooledActors().size() != 0 && !((PooledActor) taskInstance
-						.getPooledActors().toArray()[0]).getActorId().equals(
-						lotaActorId) || 
-						(taskInstance.getSwimlaneInstance() != null && taskInstance.getSwimlaneInstance().getPooledActors() != null && 
-						taskInstance.getSwimlaneInstance().getPooledActors().size() != 0 &&
-						!((PooledActor)taskInstance.getSwimlaneInstance().getPooledActors().toArray()[0]).getActorId().equals(lotaActorId))
-					);
-
-		if (fActorChanged || fPooledActorsChanged)
-			util.assertPodeTransferirDocumentosVinculados(taskInstance,
-					util.getSiglaTitular());
-
-		if (fActorChanged) {
-			if (actorId != null) {
-//				util.assertLotacaoAscendenteOuDescendente(
-//						lotAtualAtor != null ? lotAtualAtor : lotAtualPool,
-//						daoPes(ator_pessoaSel.getId()).getLotacao());
-			}
-			taskInstance.setActorId(actorId);
-		}
-
-		if (fPooledActorsChanged) {
-			if (lotaActorId == null){
-				Iterator<PooledActor> it= taskInstance.getPooledActors().iterator();
-				removerPooledActorsAnteriores(it);
-				
-				taskInstance.setPooledActors(new String[] {});
-			}else {
-				//util.assertLotacaoAscendenteOuDescendente(
-				//		lotAtualPool != null ? lotAtualPool : lotAtualAtor,
-				//		daoLot(lotaAtor_lotacaoSel.getId()));
-				taskInstance.setPooledActors(new String[] { lotaActorId });
-				if (taskInstance.getSwimlaneInstance() != null){
-					//PooledActor pa = (PooledActor) taskInstance.getSwimlaneInstance().getPooledActors().iterator().next();
-					//pa.setActorId(lotaActorId);
-					Iterator<PooledActor> it= taskInstance.getSwimlaneInstance().getPooledActors().iterator();
-					removerPooledActorsAnteriores(it);
-					taskInstance.getSwimlaneInstance().setPooledActors(new String[] {lotaActorId});
-				}else{
-				}
-			}
-		}
-		if (fActorChanged || fPooledActorsChanged)
-			util.transferirDocumentosVinculados(pi, util.getSiglaTitular());
-
-		taskInstance.setPriority(prioridade);
-
-		if (fActorChanged) {
-			Comment c = new Comment(
-					getCadastrante().getSigla(),
-					"Tarefa designada para "
-							+ (taskInstance.getActorId() != null ? "pessoa "
-									+ taskInstance.getActorId() + "."
-									: " nenhuma pessoa.")
-							+ (justificativa != null
-									&& justificativa.trim().length() > 0 ? " Justificativa: "
-									+ justificativa + "."
-									: ""));
-			taskInstance.addComment(c);
-		}
-
-		if (fPooledActorsChanged) {
-			Comment c = new Comment(
-					getCadastrante().getSigla(),
-					"Tarefa designada para "
-							+ (taskInstance.getPooledActors().size() != 0 ? "lotação "
-									+ ((PooledActor) taskInstance
-											.getPooledActors().toArray()[0])
-											.getActorId() + "."
-									: " nenhuma lotação.")
-							+ (justificativa != null
-									&& justificativa.trim().length() > 0 ? " Justificativa: "
-									+ justificativa + "."
-									: ""));
-			taskInstance.addComment(c);
-		}
-
-		result.redirectTo(this).task(taskInstance.getId());
-	}
-
-	private void removerPooledActorsAnteriores(Iterator<PooledActor> it) {
-		while (it.hasNext()) {	//remove o polledActor atual
-			PooledActor pooledActor = (PooledActor) it.next();
-			pooledActor.setActorId(null); 
-			pooledActor.setSwimlaneInstance(null);
-		}
-	}
-
-	/**
-	 * Insere um comentário à tarefa.
-	 * 
-	 * @return
-	 * @throws CsisException
-	 */
-	public void commentTask(Long tiId, String comentario) throws Exception {
-		TaskInstance taskInstance = getTaskInstance(tiId);
-		if (comentario != null && comentario.trim().length() > 0) {
-			Comment c = new Comment(getCadastrante().getSigla(), comentario);
-			taskInstance.addComment(c);
-		}
-		result.redirectTo(this).task(taskInstance.getId());
-	}
-
-	/**
-	 * Verifica se as tarefas que estão designadas para o usuário estão
-	 * associadas a documentos do SIGA-DOC (por intermédio da variável iniciada
-	 * com o prefixo "doc_". Se estiver, chama o método addTask(). Este método
-	 * executado quando a action "doc.action" for chamada.
-	 */
-	public void doc(String sigla) throws Exception {
-		Map<String, List<WfTaskVO>> mobilMap = new TreeMap<String, List<WfTaskVO>>();
-
-		SortedSet<TaskInstance> taskInstances = Wf.getInstance().getBL()
-				.getTaskList(sigla);
-		for (TaskInstance ti : taskInstances) {
-			if (ti.getTask().getTaskController() != null) {
-				List<VariableAccess> variableAccesses = (List<VariableAccess>) ti
-						.getTask().getTaskController().getVariableAccesses();
-
-				for (VariableAccess _variable : variableAccesses) {
-					String name = _variable.getMappedName();
-					if (name != null && name.startsWith("doc_")) {
-						String value = (String) ti.getContextInstance()
-								.getVariable(name);
-						if (value != null) {
-							if (value.startsWith(sigla)) {
-								util.addTask(mobilMap, ti, value, sigla);
-							}
-						}
-					}
-				}
-			}
-		}
-		result.include("mobilMap", mobilMap);
-	}
-
-	private TaskInstance getTaskInstance(Long tiId) throws Exception {
-		TaskInstance taskInstance = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getTaskInstance(tiId);
-		if (taskInstance == null)
-			throw new Exception("Atividade indisponível.");
-		return taskInstance;
-	}
-
-	/**
-	 * Carrega as informações relativas à tarefa, tais como, a instância da
-	 * tarefa, os logs, a prioridade e suas variáveis.
-	 * 
-	 * @throws Exception
-	 */
-	private TaskInstance loadTaskInstance(Long tiId) throws Exception {
-		TaskInstance taskInstance = getTaskInstance(tiId);
-
-		List<ProcessLog> logs = (List<ProcessLog>) WfContextBuilder
-				.getJbpmContext().getJbpmContext().getLoggingSession()
-				.findLogsByToken(taskInstance.getToken().getId());
-
-		int prioridade = taskInstance.getPriority();
-		carregarAtorEGrupo(taskInstance);
-
-		result.include("taskInstance", taskInstance);
-		result.include("logs", logs);
-		result.include("prioridade", prioridade);
-
-		return taskInstance;
-	}
-
-	/**
-	 * Carrega a pessoa e a lotação designados à terefa.
-	 * 
-	 * @param taskInstance
-	 * 
-	 * @throws AplicacaoException
-	 */
-	private void carregarAtorEGrupo(TaskInstance taskInstance)
-			throws AplicacaoException {
-		DpPessoaSelecao atorSel = new DpPessoaSelecao();
-		DpLotacaoSelecao lotaAtorSel = new DpLotacaoSelecao();
-
-		if (taskInstance.getActorId() != null) {
-			atorSel.setSigla(taskInstance.getActorId());
-			atorSel.buscarPorSigla();
-		}
-		if (taskInstance.getPooledActors().size() != 0) {
-			String actorId = (String) ((PooledActor) (taskInstance
-					.getPooledActors().toArray()[0])).getActorId();
-			if (actorId != null) {
-				lotaAtorSel.setSigla(actorId);
-				lotaAtorSel.buscarPorSigla();
-			}
-		}
-		result.include("atorSel", atorSel);
-		result.include("lotaAtorSel", lotaAtorSel);
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/ConfiguracaoController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/ConfiguracaoController.java
deleted file mode 100644
index 5f46d42bda..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/ConfiguracaoController.java
+++ /dev/null
@@ -1,391 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import java.util.ArrayList;
-import java.util.Date;
-import java.util.List;
-import java.util.TreeSet;
-
-import javax.servlet.http.HttpServletRequest;
-
-import org.hibernate.SessionFactory;
-import org.jbpm.graph.def.ProcessDefinition;
-
-import br.com.caelum.vraptor.Resource;
-import br.com.caelum.vraptor.Result;
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.cp.CpConfiguracao;
-import br.gov.jfrj.siga.cp.CpSituacaoConfiguracao;
-import br.gov.jfrj.siga.cp.CpTipoConfiguracao;
-import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.dao.CpDao;
-import br.gov.jfrj.siga.vraptor.SigaObjects;
-import br.gov.jfrj.siga.wf.Permissao;
-import br.gov.jfrj.siga.wf.WfConfiguracao;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-import br.gov.jfrj.siga.wf.util.WfTipoResponsavel;
-
-@Resource
-public class ConfiguracaoController extends WfController {
-
-	private static int TIPO_RESP_INDEFINIDO = 0;
-	private static int TIPO_RESP_MATRICULA = 1;
-	private static int TIPO_RESP_LOTACAO = 2;
-
-	private List<WfTipoResponsavel> listaTipoResponsavel = new ArrayList<WfTipoResponsavel>();
-
-	/**
-	 * Inicializa os tipos de responsáveis e suas respectivas expressões, quando
-	 * houver.
-	 */
-	public ConfiguracaoController(HttpServletRequest request, Result result,
-			WfDao dao, SigaObjects so, WfUtil util) {
-		super(request, result, dao, so, util);
-
-		WfTipoResponsavel tpIndefinido = new WfTipoResponsavel(
-				TIPO_RESP_INDEFINIDO, "[Indefinido]", "");
-		WfTipoResponsavel tpMatricula = new WfTipoResponsavel(
-				TIPO_RESP_MATRICULA, "Usuário", "matricula");
-		WfTipoResponsavel tpLotacao = new WfTipoResponsavel(TIPO_RESP_LOTACAO,
-				"Lotação", "lotacao");
-
-		listaTipoResponsavel.add(tpIndefinido);
-		listaTipoResponsavel.add(tpMatricula);
-		listaTipoResponsavel.add(tpLotacao);
-	}
-
-	/**
-	 * Grava a configuração da permissão. Primeiro, processa-se as alteraões nas
-	 * permissões existentes e depois processa-se as novas permissões. As
-	 * permissões indefinidas são excluídas da lista de permissões.
-	 * 
-	 * @return
-	 * @throws Exception
-	 */
-	public void gravar(String orgao, String procedimento) throws Exception {
-		ProcessDefinition pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findLatestProcessDefinition(procedimento);
-
-		CpOrgaoUsuario orgaoUsuario = daoOU(orgao);
-
-		Date horaDoDB = dao().consultarDataEHoraDoServidor();
-		if (pd != null) {
-
-			// processa permissões existentes
-			List<Permissao> listaPermissao = getPermissoes(orgaoUsuario,
-					procedimento);
-			for (Permissao perm : listaPermissao) {
-				WfConfiguracao cfg = prepararConfiguracao(orgaoUsuario,
-						procedimento);
-
-				processarPermissao(orgaoUsuario, procedimento, perm, cfg,
-						horaDoDB);
-
-			}
-
-			// processa nova permissão
-			WfConfiguracao cfg = prepararConfiguracao(orgaoUsuario,
-					procedimento);
-			Permissao novaPermissao = new Permissao();
-			novaPermissao.setId(this.getIdNovaPermissao());
-			novaPermissao.setProcedimento(procedimento);
-
-			processarPermissao(orgaoUsuario, procedimento, novaPermissao, cfg,
-					horaDoDB);
-
-			if (novaPermissao.getPessoa() != null
-					|| novaPermissao.getLotacao() != null) {
-				listaPermissao.add(novaPermissao);
-			}
-
-			// remove permissões inválidas
-			ArrayList<Permissao> listaAux = new ArrayList<Permissao>();
-			for (Permissao perm : listaPermissao) {
-				if (perm.getPessoa() != null || perm.getLotacao() != null) {
-					listaAux.add(perm);
-				}
-			}
-
-			listaPermissao = listaAux;
-
-			limparCache();
-		}
-
-		result.redirectTo(this).pesquisar(orgao, procedimento);
-	}
-
-	/**
-	 * Seleciona um procedimento que terá suas permissões configuradas.
-	 * 
-	 * @return
-	 * @throws Exception
-	 */
-	public void pesquisar(String orgao, String procedimento) throws Exception {
-		assertAcesso(ACESSO_CONFIGURAR_INICIADORES);
-
-		limparCache();
-		ProcessDefinition pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findLatestProcessDefinition(procedimento);
-		CpOrgaoUsuario orgaoUsuario = daoOU(orgao);
-
-		if (pd != null) {
-			List<Permissao> listaPermissao = new ArrayList<Permissao>();
-			listaPermissao.addAll(getPermissoes(orgaoUsuario, procedimento));
-			result.include("orgao", orgao);
-			result.include("procedimento", procedimento);
-			result.include("listaPermissao", listaPermissao);
-			result.include("listaOrgao", dao().listarOrgaosUsuarios());
-			result.include("listaTipoResponsavel", listaTipoResponsavel);
-			result.include("listaProcedimento", getListaProcedimento());
-		}
-	}
-
-	/**
-	 * Retorna a lista de configurações definidas para uma permissão.
-	 * 
-	 * @param perm
-	 *            -
-	 * @return Lista de permissões já gravadas no banco de dados.
-	 * @throws Exception
-	 */
-	private List<WfConfiguracao> getConfiguracaoExistente(
-			CpOrgaoUsuario orgaoUsuario, String procedimento, Permissao perm)
-			throws Exception {
-		WfConfiguracao fltConfigExistente = new WfConfiguracao();
-
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO,
-				CpTipoConfiguracao.class, false);
-
-		fltConfigExistente.setCpTipoConfiguracao(tipoConfig);
-		fltConfigExistente.setOrgaoUsuario(orgaoUsuario);
-		fltConfigExistente.setProcedimento(procedimento);
-		fltConfigExistente.setDpPessoa(perm.getPessoa());
-		fltConfigExistente.setLotacao(perm.getLotacao());
-
-		List<WfConfiguracao> cfgExistente = WfDao.getInstance().consultar(
-				fltConfigExistente);
-		List<WfConfiguracao> resultado = new ArrayList<WfConfiguracao>();
-		// Melhorar isso: o filtro por pessoa ou lotação não está funcionando
-		for (WfConfiguracao c : cfgExistente) {
-			if ((c.getDpPessoa() != null || c.getLotacao() != null)
-					&& c.getHisDtFim() == null
-					&& c.getIdConfiguracao().equals(perm.getId())) {
-				resultado.add(c);
-			}
-		}
-
-		return resultado;
-	}
-
-	/**
-	 * Retorna a lista de permissões definidas para uma definição de
-	 * procedimento.
-	 * 
-	 * @param pd
-	 *            - Definição de processo
-	 * @return - Lista de permissões
-	 * @throws Exception
-	 */
-	private List<Permissao> getPermissoes(CpOrgaoUsuario orgaoUsuario,
-			String procedimento) throws Exception {
-
-		List<Permissao> resultado = new ArrayList<Permissao>();
-
-		TreeSet<CpConfiguracao> cfg = Wf
-				.getInstance()
-				.getConf()
-				.getListaPorTipo(
-						CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO);
-		for (CpConfiguracao c : cfg) {
-
-			if (c instanceof WfConfiguracao) {
-				WfConfiguracao wfC = (WfConfiguracao) c;
-				if (wfC.getProcedimento() != null
-						&& wfC.getProcedimento().equals(procedimento)
-						&& wfC.getHisDtFim() == null) {
-
-					Permissao perm = new Permissao();
-					perm.setProcedimento(procedimento);
-					perm.setId(c.getIdConfiguracao());
-
-					perm.setPessoa(c.getDpPessoa());
-					perm.setLotacao(c.getLotacao());
-
-					if (perm.getPessoa() != null) {
-						perm.setTipoResponsavel(TIPO_RESP_MATRICULA);
-					}
-					if (perm.getLotacao() != null) {
-						perm.setTipoResponsavel(TIPO_RESP_LOTACAO);
-					}
-
-					resultado.add(perm);
-				}
-			}
-		}
-
-		return resultado;
-
-	}
-
-	/**
-	 * Método utilizado para gravar uma nova configuração. ATENÇÃO: ESTE MÉTODO
-	 * PROVAVELMENTE PODE SER ELIMINADO EM UM REFACTORING.
-	 * 
-	 * @param cfg
-	 * @throws Exception
-	 */
-	private void gravarNovaConfig(WfConfiguracao cfg) throws Exception {
-		WfDao.getInstance().gravarComHistorico(cfg, getIdentidadeCadastrante());
-	}
-
-	/**
-	 * Torna uma configuração existente inválida. A invalidação da configuração
-	 * normalmente ocorre ao se criar uma nova configuração. A configuração
-	 * antiga torna-se inválida mas continua sendo mantida no banco de dados
-	 * para fins de histórico.
-	 * 
-	 * @param cfgExistente
-	 *            - Configuração a ser invalidada
-	 * @param dataFim
-	 *            - Data que define o fim da validade da configuração, ou seja,
-	 *            data de invalidação.
-	 * @throws AplicacaoException
-	 */
-	private void invalidarConfiguracao(WfConfiguracao cfgExistente, Date dataFim)
-			throws AplicacaoException {
-		if (cfgExistente != null && cfgExistente.getHisDtFim() == null) {
-			cfgExistente.setHisDtFim(dataFim);
-			WfDao.getInstance().gravarComHistorico(cfgExistente,
-					getIdentidadeCadastrante());
-		}
-	}
-
-	/**
-	 * Limpa o cache do hibernate. Como as configurações são mantidas em cache
-	 * por motivo de performance, as alterações precisam ser atualizadas para
-	 * que possam valer imediatamente.
-	 * 
-	 * @throws Exception
-	 */
-	public void limparCache() throws Exception {
-
-		SessionFactory sfWfDao = WfDao.getInstance().getSessao()
-				.getSessionFactory();
-		SessionFactory sfCpDao = CpDao.getInstance().getSessao()
-				.getSessionFactory();
-
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO,
-				CpTipoConfiguracao.class, false);
-
-		Wf.getInstance().getConf().limparCacheSeNecessario();
-
-		sfWfDao.evict(CpConfiguracao.class);
-		sfWfDao.evict(WfConfiguracao.class);
-		sfCpDao.evict(DpLotacao.class);
-
-		sfWfDao.evictQueries(CpDao.CACHE_QUERY_CONFIGURACAO);
-
-		return;
-
-	}
-
-	/**
-	 * Inicia um objeto WfConfiguracao de modo que possa receber as
-	 * configurações definidas pelo usuário.
-	 * 
-	 * @return - Configuração pronta para receber as configurações.
-	 */
-	private WfConfiguracao prepararConfiguracao(CpOrgaoUsuario orgaoUsuario,
-			String procedimento) {
-		WfConfiguracao cfg = new WfConfiguracao();
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO,
-				CpTipoConfiguracao.class, false);
-		cfg.setCpTipoConfiguracao(tipoConfig);
-		cfg.setOrgaoUsuario(orgaoUsuario);
-		cfg.setProcedimento(procedimento);
-		return cfg;
-	}
-
-	/**
-	 * Processa as permissões definidas pelo usuário. São extraídos os dados do
-	 * request, definida a data de início da configuração, definidas as
-	 * permissões, definida a invalidação da configuração antiga e atualizada a
-	 * visão do usuário.
-	 * 
-	 * @param permissao
-	 *            - Permissão a ser processada
-	 * @param cfg
-	 *            - Configuração preparada para receber as novas configurações
-	 * @param horaDoBD
-	 *            - Hora do banco de dados. A data/hora de início de vigência
-	 *            deve ser a mesma da invalidação da configuração anterior.
-	 * @throws Exception
-	 */
-	private void processarPermissao(CpOrgaoUsuario orgaoUsuario,
-			String procedimento, Permissao permissao, WfConfiguracao cfg,
-			Date horaDoBD) throws Exception {
-		DpLotacao lotacao = null;
-		DpPessoa pessoa = null;
-
-		lotacao = extrairLotaAtor(permissao.getId());
-		pessoa = extrairAtor(permissao.getId());
-
-		if (pessoa != null || lotacao != null) {// se
-			// configuração
-			// definida
-			cfg.setDpPessoa(pessoa);
-			cfg.setLotacao(lotacao);
-
-			cfg.setHisDtIni(horaDoBD);
-
-			for (WfConfiguracao cfgExistente : getConfiguracaoExistente(
-					orgaoUsuario, procedimento, permissao)) {
-				invalidarConfiguracao(cfgExistente, horaDoBD);
-			}
-
-			permissao.setPessoa(pessoa);
-			permissao.setLotacao(lotacao);
-
-			CpSituacaoConfiguracao sit = new CpSituacaoConfiguracao();
-			sit.setIdSitConfiguracao(CpSituacaoConfiguracao.SITUACAO_PODE);
-			cfg.setCpSituacaoConfiguracao(sit);
-			gravarNovaConfig(cfg);
-			permissao.setId(cfg.getIdConfiguracao()); // deixa de usar a id
-			// temporária
-
-			// atualiza os dados da visão
-			if (pessoa != null) {
-				permissao.setPessoa(pessoa);
-				permissao.setTipoResponsavel(TIPO_RESP_MATRICULA);
-			}
-
-			if (lotacao != null) {
-				permissao.setLotacao(lotacao);
-				permissao.setTipoResponsavel(TIPO_RESP_LOTACAO);
-			}
-
-		} else {
-			for (WfConfiguracao cfgExistente : getConfiguracaoExistente(
-					orgaoUsuario, procedimento, permissao)) {
-				invalidarConfiguracao(cfgExistente, horaDoBD);
-			}
-
-			permissao.setPessoa(pessoa);
-			permissao.setLotacao(lotacao);
-		}
-
-	}
-
-	private Long getIdNovaPermissao() {
-		return Long.MAX_VALUE;
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/DesignacaoController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/DesignacaoController.java
deleted file mode 100644
index 024a62480e..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/DesignacaoController.java
+++ /dev/null
@@ -1,678 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2006 - 2011 SJRJ.
- * 
- *     This file is part of SIGA.
- * 
- *     SIGA is free software: you can redistribute it and/or modify
- *     it under the terms of the GNU General Public License as published by
- *     the Free Software Foundation, either version 3 of the License, or
- *     (at your option) any later version.
- * 
- *     SIGA is distributed in the hope that it will be useful,
- *     but WITHOUT ANY WARRANTY; without even the implied warranty of
- *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *     GNU General Public License for more details.
- * 
- *     You should have received a copy of the GNU General Public License
- *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
- ******************************************************************************/
-package br.gov.jfrj.siga.wf.vraptor;
-
-import java.util.ArrayList;
-import java.util.Date;
-import java.util.HashMap;
-import java.util.HashSet;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-import java.util.TreeMap;
-
-import javax.servlet.http.HttpServletRequest;
-
-import org.hibernate.SessionFactory;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.taskmgmt.def.Swimlane;
-import org.jbpm.taskmgmt.def.Task;
-
-import br.com.caelum.vraptor.Path;
-import br.com.caelum.vraptor.Resource;
-import br.com.caelum.vraptor.Result;
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.cp.CpConfiguracao;
-import br.gov.jfrj.siga.cp.CpTipoConfiguracao;
-import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.dao.CpDao;
-import br.gov.jfrj.siga.vraptor.SigaObjects;
-import br.gov.jfrj.siga.wf.Designacao;
-import br.gov.jfrj.siga.wf.WfConfiguracao;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-import br.gov.jfrj.siga.wf.util.WfTipoResponsavel;
-
-@Resource
-public class DesignacaoController extends WfController {
-
-	private static int TIPO_RESP_INDEFINIDO = 0;
-	private static int TIPO_RESP_MATRICULA = 1;
-	private static int TIPO_RESP_LOTACAO = 2;
-	private static int TIPO_RESP_LOTA_SUP = 3;
-	private static int TIPO_RESP_SUP_HIER = 4;
-	private static int TIPO_RESP_EXPRESSAO = 5;
-
-	private List<WfTipoResponsavel> listaTipoResponsavel = new ArrayList<WfTipoResponsavel>();
-	private Map<Integer, WfTipoResponsavel> mapaTipoResponsavel = new HashMap<Integer, WfTipoResponsavel>();
-
-	// private Set<String> raiaProcessada = new HashSet<String>();
-
-	/**
-	 * Inicializa os tipos de responsáveis e suas respectivas expressões, quando
-	 * houver.
-	 */
-	public DesignacaoController(HttpServletRequest request, Result result,
-			WfDao dao, SigaObjects so, WfUtil util) {
-		super(request, result, dao, so, util);
-
-		WfTipoResponsavel tpIndefinido = new WfTipoResponsavel(
-				TIPO_RESP_INDEFINIDO, "[Indefinido]", "");
-		WfTipoResponsavel tpMatricula = new WfTipoResponsavel(
-				TIPO_RESP_MATRICULA, "Usuário", "matricula");
-		WfTipoResponsavel tpLotacao = new WfTipoResponsavel(TIPO_RESP_LOTACAO,
-				"Lotação", "lotacao");
-		WfTipoResponsavel tpLotaSuperior = new WfTipoResponsavel(
-				TIPO_RESP_LOTA_SUP, "Lotação Superior",
-				"previous --> group() --> superior_group");
-		WfTipoResponsavel tpSupHier = new WfTipoResponsavel(TIPO_RESP_SUP_HIER,
-				"Superior Hierárquico", "previous --> chief");
-		WfTipoResponsavel tpExpressao = new WfTipoResponsavel(
-				TIPO_RESP_EXPRESSAO, "Expressão", "");
-
-		listaTipoResponsavel.add(tpIndefinido);
-		listaTipoResponsavel.add(tpMatricula);
-		listaTipoResponsavel.add(tpLotacao);
-		listaTipoResponsavel.add(tpLotaSuperior);
-		listaTipoResponsavel.add(tpSupHier);
-		listaTipoResponsavel.add(tpExpressao);
-
-		for (WfTipoResponsavel tr : listaTipoResponsavel) {
-			mapaTipoResponsavel.put(tr.getId(), tr);
-		}
-	}
-
-	/**
-	 * Grava a configuração da designação. Inicialmente processa-se as raias e
-	 * depois as tarefas, desativa-se as configurações antigas e retorna à
-	 * página pesquisarDesignação.jsp com os dados gravados.
-	 * 
-	 * @return
-	 * @throws Exception
-	 */
-	public void gravar(String orgao, String procedimento) throws Exception {
-		ProcessDefinition pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findLatestProcessDefinition(procedimento);
-
-		CpOrgaoUsuario orgaoUsuario = daoOU(orgao);
-
-		Date horaDoDB = dao().consultarDataEHoraDoServidor();
-		Set<Long> raiasGravadas = new HashSet<Long>();
-
-		List<Designacao> listaDesignacaoRaia = getDesignacaoSwimlanes(
-				orgaoUsuario, procedimento, pd);
-		for (Designacao d : listaDesignacaoRaia) {
-			d.setAtor(null);
-			d.setLotaAtor(null);
-			d.setExpressao(null);
-			d.setTipoResponsavel(null);
-		}
-		List<Designacao> listaDesignacaoTarefa = getDesignacaoTarefas(
-				orgaoUsuario, procedimento, pd);
-		for (Designacao d : listaDesignacaoTarefa) {
-			d.setAtor(null);
-			d.setLotaAtor(null);
-			d.setExpressao(null);
-			d.setTipoResponsavel(null);
-		}
-
-		if (pd != null) {
-			for (Object o : pd.getTaskMgmtDefinition().getTasks().values()) {
-				Task t = (Task) o;
-
-				WfConfiguracao cfg = prepararConfiguracao(orgaoUsuario,
-						procedimento);
-
-				if (t.getSwimlane() != null) { // se task está em uma raia
-					listaDesignacaoRaia = processarRaia(orgaoUsuario,
-							procedimento, t.getSwimlane(), cfg, horaDoDB,
-							raiasGravadas, listaDesignacaoRaia);
-				} else {
-					listaDesignacaoTarefa = processarTarefa(orgaoUsuario,
-							procedimento, t, cfg, horaDoDB,
-							listaDesignacaoTarefa);
-				}
-
-			}
-
-			limparCache();
-		}
-
-		result.redirectTo(this).pesquisar(orgao, procedimento);
-	}
-
-	/**
-	 * Lê as definições gravadas no banco e exibe na página.
-	 * 
-	 * @return
-	 * @throws Exception
-	 */
-	@Path("/app/designacao/pesquisar/{orgao}/{procedimento}")
-	public void pesquisar(String orgao, String procedimento) throws Exception {
-		assertAcesso(ACESSO_DESIGNAR_TAREFAS);
-
-		limparCache();
-		ProcessDefinition pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findLatestProcessDefinition(procedimento);
-		CpOrgaoUsuario orgaoUsuario = daoOU(orgao);
-
-		if (pd != null) {
-			List<Designacao> listaDesignacaoRaia = new ArrayList<Designacao>();
-			listaDesignacaoRaia.addAll(getDesignacaoSwimlanes(orgaoUsuario,
-					procedimento, pd));
-			List<Designacao> listaDesignacaoTarefa = new ArrayList<Designacao>();
-			listaDesignacaoTarefa.addAll(getDesignacaoTarefas(orgaoUsuario,
-					procedimento, pd));
-			result.include("orgao", orgao);
-			result.include("procedimento", procedimento);
-			result.include("listaDesignacaoRaia", listaDesignacaoRaia);
-			result.include("listaDesignacaoTarefa", listaDesignacaoTarefa);
-			result.include("listaOrgao", dao().listarOrgaosUsuarios());
-			result.include("listaTipoResponsavel", listaTipoResponsavel);
-			result.include("listaProcedimento", getListaProcedimento());
-			result.include("mapaDesignacaoRaia",
-					getMapaDesignacaoRaia(listaDesignacaoRaia));
-		}
-	}
-
-	private Map<String, List<Designacao>> getMapaDesignacaoRaia(
-			List<Designacao> listaDesignacaoRaia) {
-		Map<String, List<Designacao>> m = new TreeMap<String, List<Designacao>>();
-		for (Designacao d : listaDesignacaoRaia) {
-			if (!m.containsKey(d.getRaia())) {
-				m.put(d.getRaia(), new ArrayList<Designacao>());
-			}
-			m.get(d.getRaia()).add(d);
-		}
-		return m;
-	}
-
-	/**
-	 * Como na página pesquisarDesignação.jsp os componentes de seleção das
-	 * expressões são dinâmicas, é necessária a extração dos dados diretamente
-	 * dos parâmetros do request. O prefixo "tipoResponsavel_" é definido na
-	 * página pesquisarDesignacao.jsp
-	 * 
-	 * @param id
-	 *            da tarefa
-	 * @return Um objeto String com a expressão que equivale ao item
-	 *         selecionado.
-	 */
-	private String extrairExpressao(long id) {
-
-		String keyExpressao = "tipoResponsavel_" + id;
-		String expressaoId = "expressao_" + id;
-		Map<?, ?> parametros = this.getRequest().getParameterMap();
-		String expressao = null;
-
-		if (!this.getRequest().getParameterMap().containsKey(keyExpressao))
-			return null;
-
-		String responsavel = ((String[]) parametros.get(keyExpressao))[0];
-		if (responsavel == null || responsavel.equals(""))
-			return null;
-
-		int idResp = new Integer(responsavel).intValue();
-
-		if (idResp != TIPO_RESP_LOTA_SUP && idResp != TIPO_RESP_SUP_HIER
-				&& idResp != TIPO_RESP_EXPRESSAO)
-			return null;
-
-		for (WfTipoResponsavel tr : listaTipoResponsavel) {
-			if (tr.getId() == idResp) {
-				expressao = tr.getValor();
-				if (expressao == null || expressao.length() == 0) {
-					expressao = ((String[]) parametros.get(expressaoId))[0];
-				}
-			}
-		}
-		return expressao;
-	}
-
-	/**
-	 * Busca um configuração do tipo TIPO_CONFIG_DESIGNAR_TAREFA no banco de
-	 * dados, caso exista.
-	 * 
-	 * @param nome
-	 *            - Nome da raia ou tarefa.
-	 * @param isRaia
-	 *            - Determina se o parâmetro anterior é uma raia ou tarefa.
-	 * @return
-	 * @throws Exception
-	 */
-	private WfConfiguracao getConfiguracaoExistente(
-			CpOrgaoUsuario orgaoUsuario, String procedimento, String nome,
-			boolean isRaia) throws Exception {
-		WfConfiguracao fltConfigExistente = new WfConfiguracao();
-
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_DESIGNAR_TAREFA,
-				CpTipoConfiguracao.class, false);
-
-		fltConfigExistente.setCpTipoConfiguracao(tipoConfig);
-		fltConfigExistente.setOrgaoUsuario(orgaoUsuario);
-		fltConfigExistente.setProcedimento(procedimento);
-
-		if (isRaia) {
-			fltConfigExistente.setRaia(nome);
-		} else {
-			fltConfigExistente.setTarefa(nome);
-		}
-
-		CpConfiguracao cfgExistente = Wf.getInstance().getConf()
-				.buscaConfiguracao(fltConfigExistente, new int[] { 0 }, null);
-
-		return (WfConfiguracao) cfgExistente;
-	}
-
-	/**
-	 * Monta a lista de designações que se referem às raias.
-	 * 
-	 * @param pd
-	 *            - Objeto ProcessDefinition
-	 * @return - Lista de designações
-	 * @throws Exception
-	 */
-	private List<Designacao> getDesignacaoSwimlanes(
-			CpOrgaoUsuario orgaoUsuario, String procedimento,
-			ProcessDefinition pd) throws Exception {
-
-		WfConfiguracao cfgFiltro = new WfConfiguracao();
-
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_DESIGNAR_TAREFA,
-				CpTipoConfiguracao.class, false);
-
-		cfgFiltro.setCpTipoConfiguracao(tipoConfig);
-		cfgFiltro.setOrgaoUsuario(orgaoUsuario);
-		cfgFiltro.setProcedimento(procedimento);
-
-		List<Designacao> resultado = new ArrayList<Designacao>();
-
-		for (Object s : pd.getTaskMgmtDefinition().getSwimlanes().values()) {
-			Swimlane raia = (Swimlane) s;
-
-			for (Object t : raia.getTasks()) {
-				Task tarefa = (Task) t;
-				Designacao d = new Designacao();
-				d.setProcedimento(procedimento);
-				d.setId(tarefa.getId());
-				d.setNomeDoNo(tarefa.getTaskNode() == null ? "" : tarefa
-						.getTaskNode().getName());
-				d.setTarefa(tarefa.getName());
-				d.setRaia(raia.getName());
-				cfgFiltro.setRaia(raia.getName());
-
-				preencherDesignacao(cfgFiltro, d);
-
-				resultado.add(d);
-			}
-
-		}
-
-		return resultado;
-	}
-
-	/**
-	 * Monta a lista de designações que se referem às tarefas.
-	 * 
-	 * @param pd
-	 *            - Objeto ProcessDefinition
-	 * @return - Lista de designações
-	 * @throws Exception
-	 */
-	private List<Designacao> getDesignacaoTarefas(CpOrgaoUsuario orgaoUsuario,
-			String procedimento, ProcessDefinition pd) throws Exception {
-
-		WfConfiguracao cfgFiltro = new WfConfiguracao();
-
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_DESIGNAR_TAREFA,
-				CpTipoConfiguracao.class, false);
-
-		cfgFiltro.setCpTipoConfiguracao(tipoConfig);
-		cfgFiltro.setOrgaoUsuario(orgaoUsuario);
-		cfgFiltro.setProcedimento(procedimento);
-
-		List<Designacao> resultado = new ArrayList<Designacao>();
-		for (Object o : pd.getTaskMgmtDefinition().getTasks().values()) {
-			Task t = (Task) o;
-			if (t.getSwimlane() == null) {
-				Designacao d = new Designacao();
-				d.setProcedimento(procedimento);
-				d.setId(t.getId());
-				d.setNomeDoNo(t.getTaskNode() == null ? "" : t.getTaskNode()
-						.getName());
-				d.setTarefa(t.getName());
-				cfgFiltro.setTarefa(d.getTarefa());
-
-				preencherDesignacao(cfgFiltro, d);
-
-				resultado.add(d);
-			}
-		}
-
-		return resultado;
-
-	}
-
-	private void preencherDesignacao(WfConfiguracao cfgFiltro, Designacao d)
-			throws Exception {
-		WfConfiguracao cfg = (WfConfiguracao) Wf.getInstance()
-				.getConf()
-				.buscaConfiguracao(cfgFiltro, new int[] { 0 }, null);
-
-		if (cfg != null) {
-			if (cfg.getAtor() != null)
-				d.setAtor(daoPes(cfg.getAtor().getIdPessoa()));
-			if (cfg.getLotaAtor() != null)
-				d.setLotaAtor(daoLot(cfg.getLotaAtor().getIdLotacao()));
-
-			if (cfg.getExpressao() != null) {
-				d.setExpressao(cfg.getExpressao());
-				for (WfTipoResponsavel tr : listaTipoResponsavel) {
-					if (tr.getValor().equals(d.getExpressao())) {
-						d.setTipoResponsavel(tr.getId());
-					}
-				}
-				if (d.getTipoResponsavel() == null) {
-					d.setTipoResponsavel(TIPO_RESP_EXPRESSAO);
-					d.setExpressao(cfg.getExpressao());
-				}
-			}
-		}
-		if (d.getAtor() != null) {
-			d.setTipoResponsavel(TIPO_RESP_MATRICULA);
-		}
-		if (d.getLotaAtor() != null) {
-			d.setTipoResponsavel(TIPO_RESP_LOTACAO);
-		}
-	}
-
-	/**
-	 * Retorna a lista de tipos de responsáveis que podem ter designações
-	 * definidas. Este método é usado pela página pesquisarDesignação.jsp
-	 * 
-	 * @return Lista de designações
-	 */
-	private List<WfTipoResponsavel> getListaTipoResponsavel() {
-		return listaTipoResponsavel;
-	}
-
-	/**
-	 * Grava a nova configuração no banco de dados.
-	 * 
-	 * @param cfg
-	 *            - Configuração a ser gravada
-	 * @throws Exception
-	 */
-	private void gravarNovaConfig(WfConfiguracao cfg) throws Exception {
-		WfDao.getInstance().gravarComHistorico(cfg, getIdentidadeCadastrante());
-	}
-
-	/**
-	 * Desativa uma configuração existente.
-	 * 
-	 * @param cfgExistente
-	 *            - objecto da configuração existente
-	 * @param dataFim
-	 *            - data em que a configuração será desativada
-	 * @throws AplicacaoException
-	 */
-	private void invalidarConfiguracao(WfConfiguracao cfgExistente, Date dataFim)
-			throws AplicacaoException {
-		if (cfgExistente != null && cfgExistente.getHisDtFim() == null) {
-			cfgExistente.setHisDtFim(dataFim);
-			WfDao.getInstance().gravarComHistorico(cfgExistente,
-					getIdentidadeCadastrante());
-		}
-	}
-
-	/**
-	 * Limpa o cache do hibernate. Como as configurações são armazenadas em
-	 * cache por serem pouco modificadas, faz-se necessário limpar o cache
-	 * quando as configurações são alteradas ou incluídas, senão as
-	 * configurações somente serão válidas quando o session factory for
-	 * reinicializado.
-	 * 
-	 * @throws Exception
-	 */
-	private void limparCache() throws Exception {
-
-		SessionFactory sfWfDao = WfDao.getInstance().getSessao()
-				.getSessionFactory();
-		SessionFactory sfCpDao = CpDao.getInstance().getSessao()
-				.getSessionFactory();
-
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_DESIGNAR_TAREFA,
-				CpTipoConfiguracao.class, false);
-
-		Wf.getInstance().getConf().limparCacheSeNecessario();
-
-		sfWfDao.evict(CpConfiguracao.class);
-		sfWfDao.evict(WfConfiguracao.class);
-		sfCpDao.evict(DpLotacao.class);
-
-		sfWfDao.evictQueries(CpDao.CACHE_QUERY_CONFIGURACAO);
-
-		return;
-
-	}
-
-	/**
-	 * Prepara um objeto para receber uma nova configuração.
-	 * 
-	 * @return Objeto apto a receber uma configuração.
-	 */
-	private WfConfiguracao prepararConfiguracao(CpOrgaoUsuario orgaoUsuario,
-			String procedimento) {
-		WfConfiguracao cfg = new WfConfiguracao();
-		CpTipoConfiguracao tipoConfig = CpDao.getInstance().consultar(
-				CpTipoConfiguracao.TIPO_CONFIG_DESIGNAR_TAREFA,
-				CpTipoConfiguracao.class, false);
-		cfg.setCpTipoConfiguracao(tipoConfig);
-		cfg.setOrgaoUsuario(orgaoUsuario);
-		cfg.setProcedimento(procedimento);
-		return cfg;
-	}
-
-	/**
-	 * Processa as designações definidas para raia extraindo as informações do
-	 * request.
-	 * 
-	 * @param raia
-	 *            - Raia a ser processada
-	 * @param cfg
-	 *            - Configuração pré-processada que receberá as informações de
-	 *            designação.
-	 * @param horaDoBD
-	 *            - Hora que será utilizada em todas as operações do banco de
-	 *            dados fazendo com que todas as alterações tenham o mesmo
-	 *            horário.
-	 * @param raiasGravadas
-	 * @param listaDesignacaoRaia
-	 * @return
-	 * @throws Exception
-	 */
-	private List<Designacao> processarRaia(CpOrgaoUsuario orgaoUsuario,
-			String procedimento, Swimlane raia, WfConfiguracao cfg,
-			Date horaDoBD, Set<Long> raiasGravadas,
-			List<Designacao> listaDesignacaoRaia) throws Exception {
-
-		if (!raiasGravadas.contains(raia.getId())) { // se a swimlane não foi
-			// gravada ainda
-
-			for (Object o : raia.getTasks()) {
-				Task tarefaRaia = (Task) o;
-
-				DpLotacao lotaAtor = null;
-				DpPessoa ator = null;
-				String expressao = null;
-
-				lotaAtor = extrairLotaAtor(tarefaRaia.getId());
-				ator = extrairAtor(tarefaRaia.getId());
-				expressao = extrairExpressao(tarefaRaia.getId());
-
-				if (ator != null || lotaAtor != null || expressao != null) {// se
-					// configuração
-					// definida
-					cfg.setAtor(ator);
-					cfg.setLotaAtor(lotaAtor);
-					cfg.setExpressao(expressao);
-
-					cfg.setRaia(raia.getName());
-					cfg.setHisDtIni(horaDoBD);
-
-					WfConfiguracao cfgExistente = getConfiguracaoExistente(
-							orgaoUsuario, procedimento, raia.getName(), true);
-					invalidarConfiguracao(cfgExistente, horaDoBD);
-
-					gravarNovaConfig(cfg);
-
-					// atualiza os dados da visão
-					for (Designacao d : listaDesignacaoRaia) {
-						if (d.getRaia().equals(
-								tarefaRaia.getSwimlane().getName())) {
-							d.setAtor(null);
-							d.setLotaAtor(null);
-							d.setExpressao(null);
-							if (ator != null) {
-								d.setAtor(ator);
-								d.setTipoResponsavel(TIPO_RESP_MATRICULA);
-							}
-
-							if (lotaAtor != null) {
-								d.setLotaAtor(lotaAtor);
-								d.setTipoResponsavel(TIPO_RESP_LOTACAO);
-							}
-
-							if (expressao != null) {
-								d.setExpressao(expressao);
-								for (WfTipoResponsavel tr : listaTipoResponsavel) {
-									if (tr.getValor().equals(expressao)) {
-										d.setTipoResponsavel(tr.getId());
-									}
-								}
-							}
-						}
-					}
-					break;
-
-				} else { // configuracao indefinida
-					WfConfiguracao cfgExistente = getConfiguracaoExistente(
-							orgaoUsuario, procedimento, raia.getName(), true);
-					invalidarConfiguracao(cfgExistente, horaDoBD);
-				}
-
-			}
-
-			raiasGravadas.add(raia.getId());
-
-		}
-
-		return listaDesignacaoRaia;
-	}
-
-	/**
-	 * Processa as designações definidas para a tarefa extraindo as informações
-	 * do request.
-	 * 
-	 * @param t
-	 *            - Tarefa a ser processada
-	 * @param cfg
-	 *            - Configuração pré-processada que receberá as informações de
-	 *            designação.
-	 * @param horaDoBD
-	 *            - Hora que será utilizada em todas as operações do banco de
-	 *            dados fazendo com que todas as alterações tenham o mesmo
-	 *            horário.
-	 * @param listaDesignacaoTarefa
-	 * @return
-	 * @throws Exception
-	 */
-	private List<Designacao> processarTarefa(CpOrgaoUsuario orgaoUsuario,
-			String procedimento, Task t, WfConfiguracao cfg, Date horaDoBD,
-			List<Designacao> listaDesignacaoTarefa) throws Exception {
-		DpLotacao lotaAtor = null;
-		DpPessoa ator = null;
-		String expressao = null;
-
-		lotaAtor = extrairLotaAtor(t.getId());
-		ator = extrairAtor(t.getId());
-		expressao = extrairExpressao(t.getId());
-
-		if (ator != null || lotaAtor != null || expressao != null) {// se
-			// configuração
-			// definida
-			cfg.setAtor(ator);
-			cfg.setLotaAtor(lotaAtor);
-			cfg.setExpressao(expressao);
-
-			cfg.setTarefa(t.getName());
-			cfg.setHisDtIni(horaDoBD);
-
-			WfConfiguracao cfgExistente = getConfiguracaoExistente(
-					orgaoUsuario, procedimento, t.getName(), false);
-			invalidarConfiguracao(cfgExistente, horaDoBD);
-
-			gravarNovaConfig(cfg);
-			// atualiza os dados da visão
-			for (Designacao d : listaDesignacaoTarefa) {
-				if (d.getTarefa().equals(t.getName())) {
-					d.setAtor(null);
-					d.setLotaAtor(null);
-					d.setExpressao(null);
-					if (ator != null) {
-						d.setAtor(ator);
-						d.setTipoResponsavel(TIPO_RESP_MATRICULA);
-					}
-
-					if (lotaAtor != null) {
-						d.setLotaAtor(lotaAtor);
-						d.setTipoResponsavel(TIPO_RESP_LOTACAO);
-					}
-
-					if (expressao != null) {
-						d.setExpressao(expressao);
-						for (WfTipoResponsavel tr : listaTipoResponsavel) {
-							if (tr.getValor().equals(expressao)) {
-								d.setTipoResponsavel(tr.getId());
-							}
-						}
-					}
-
-				}
-			}
-
-		} else { // configuracao indefinida
-			WfConfiguracao cfgExistente = getConfiguracaoExistente(
-					orgaoUsuario, procedimento, t.getName(), false);
-			invalidarConfiguracao(cfgExistente, horaDoBD);
-		}
-		return listaDesignacaoTarefa;
-
-	}
-
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/EdicaoController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/EdicaoController.java
deleted file mode 100644
index a236e8b00f..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/EdicaoController.java
+++ /dev/null
@@ -1,115 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import java.io.ByteArrayInputStream;
-import java.io.ByteArrayOutputStream;
-import java.io.IOException;
-import java.util.Collection;
-import java.util.zip.ZipEntry;
-import java.util.zip.ZipInputStream;
-import java.util.zip.ZipOutputStream;
-
-import javax.servlet.http.HttpServletRequest;
-
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.instantiation.Delegation;
-import org.jbpm.taskmgmt.def.Swimlane;
-import org.jbpm.taskmgmt.def.Task;
-
-import br.com.caelum.vraptor.Get;
-import br.com.caelum.vraptor.Path;
-import br.com.caelum.vraptor.Post;
-import br.com.caelum.vraptor.Resource;
-import br.com.caelum.vraptor.Result;
-import br.com.caelum.vraptor.view.Results;
-import br.gov.jfrj.siga.vraptor.SigaObjects;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
-
-@Resource
-public class EdicaoController extends WfController {
-
-	public EdicaoController(HttpServletRequest request, Result result,
-			WfDao dao, SigaObjects so, WfUtil util) {
-		super(request, result, dao, so, util);
-	}
-
-	@Get
-	@Path("/app/edicao/form/{procedimento}")
-	public void form(String procedimento) {
-		result.include("procedimento", procedimento);
-	}
-
-	@Get
-	@Path("/app/edicao/processdefinition/{procedimento}")
-	public void ler(String procedimento) throws Exception {
-		ProcessDefinition pd = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findLatestProcessDefinition(procedimento);
-		byte ab[] = pd.getFileDefinition().getBytes("processdefinition.xml");
-		String sXML = new String(ab, "UTF-8");
-		result.use(Results.http()).body(sXML);
-	}
-
-	@Post
-	@Path("/app/edicao/processdefinition/{procedimento}")
-	public void gravar(String procedimento, String xml) throws Exception {
-		String res = "OK";
-		doDeployment(xml);
-		result.use(Results.http()).body(res);
-	}
-
-	@Post
-	@Path("/app/edicao/xml_gravar")
-	public void xmlGravar(String xml) throws Exception {
-		String res = doDeployment(xml);
-		result.use(Results.http()).body(res);
-	}
-
-	@SuppressWarnings("unchecked")
-	private String doDeployment(String xml) throws IOException {
-		final StringBuilder sb = new StringBuilder();
-		sb.append("Test String");
-
-		try (ByteArrayOutputStream ba = new ByteArrayOutputStream();
-				ZipOutputStream out = new ZipOutputStream(ba)) {
-			ZipEntry e = new ZipEntry("processdefinition.xml");
-			out.putNextEntry(e);
-
-			byte[] data = xml.getBytes();
-			out.write(data, 0, data.length);
-			out.closeEntry();
-
-			ProcessDefinition processDefinition = ProcessDefinition
-					.parseParZipInputStream(new ZipInputStream(
-							new ByteArrayInputStream(ba.toByteArray())));
-			WfContextBuilder.getJbpmContext().getJbpmContext()
-					.deployProcessDefinition(processDefinition);
-			long id = processDefinition.getId();
-
-			String sReturn = "Deployed archive " + processDefinition.getName()
-					+ " successfully";
-
-			Delegation d = new Delegation(
-					"br.gov.jfrj.siga.wf.util.WfAssignmentHandler");
-
-			for (Swimlane s : ((Collection<Swimlane>) processDefinition
-					.getTaskMgmtDefinition().getSwimlanes().values())) {
-				if (s.getTasks() != null)
-					for (Object t : s.getTasks()) {
-						System.out.println(((Task) t).toString());
-					}
-				if (s.getAssignmentDelegation() == null)
-					s.setAssignmentDelegation(d);
-			}
-
-			for (Task t : ((Collection<Task>) processDefinition
-					.getTaskMgmtDefinition().getTasks().values())) {
-				if (t.getSwimlane() == null
-						&& t.getAssignmentDelegation() == null)
-					t.setAssignmentDelegation(d);
-			}
-
-			return sReturn;
-		}
-	}
-}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfAdminController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfAdminController.java
new file mode 100644
index 0000000000..fceceebf17
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfAdminController.java
@@ -0,0 +1,78 @@
+package br.gov.jfrj.siga.wf.vraptor;
+
+import java.util.Date;
+
+import javax.servlet.http.HttpServletRequest;
+
+import br.com.caelum.vraptor.Controller;
+import br.com.caelum.vraptor.Result;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.vraptor.SigaObjects;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.util.WfUtil;
+
+@Controller
+public class WfAdminController extends WfController {
+
+	public WfAdminController(HttpServletRequest request, Result result, WfDao dao, SigaObjects so, WfUtil util) {
+		super(request, result, dao, so, util);
+	}
+
+	public void administrar() {
+	}
+
+	@SuppressWarnings("unchecked")
+	public void moveToken(Long idToken, Long idNode) throws Exception {
+//		assertAcesso(ACESSO_MOVER_TOKEN);
+//		Token t = WfContextBuilder.getJbpmContext().getJbpmContext()
+//				.getToken(idToken);
+//		if (idNode == 0) {
+//			t.signal();
+//			redirectToHome();
+//			return;
+//		}
+//		List<Node> nodes = t.getProcessInstance().getProcessDefinition()
+//				.getNodes();
+//		for (Node n : nodes) {
+//			if (idNode.equals(n.getId())) {
+//				t.setNode(n);
+//				redirectToHome();
+//				return;
+//			}
+//		}
+//		throw new AplicacaoException("Nenhuma ação realizada");
+	}
+
+	public void endProcessInstance(Long idTI, Long idPI, Date dtFim) throws Exception {
+//		assertAcesso(ACESSO_ENCERRAR_INSTANCIA_DE_PROCESSO);		
+//		
+//		if (dtFim == null) {
+//			dtFim = new Date();
+//		} else {
+//			  if (!Data.dataDentroSeculo21(dtFim)){
+//				  throw new AplicacaoException("Data fim inválida, deve estar entre o ano 2000 e ano 2100");
+//		
+//			  }
+//		}
+//	
+//		if (idTI != null) {
+//			Wf.getInstance().getBL()
+//					.encerrarProcessInstanceDaTarefa(idTI, dtFim);
+//			setMensagem("Processo encerrado com sucesso!");
+//			redirectToHome();
+//			return;
+//		}
+//
+//		if (idPI != null) {
+//			Wf.getInstance().getBL().encerrarProcessInstance(idPI, dtFim);
+//			setMensagem("Processo encerrado com sucesso!");
+//		}
+//		redirectToHome();
+	}
+
+	public void deleteProcessInstance(Long idPI) throws AplicacaoException, Exception {
+//		assertAcesso(ACESSO_EXCLUIR_INSTANCIA_DE_PROCESSO);
+//		Wf.getInstance().getBL().excluirProcessInstance(idPI);
+//		redirectToHome();
+	}
+}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfAppController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfAppController.java
new file mode 100644
index 0000000000..37bad01fa6
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfAppController.java
@@ -0,0 +1,457 @@
+package br.gov.jfrj.siga.wf.vraptor;
+
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.SortedSet;
+import java.util.TreeMap;
+import java.util.TreeSet;
+
+import javax.inject.Inject;
+import javax.servlet.http.HttpServletRequest;
+
+import com.crivano.jflow.model.enm.ProcessInstanceStatus;
+import com.crivano.jflow.model.enm.VariableEditingKind;
+
+import br.com.caelum.vraptor.Controller;
+import br.com.caelum.vraptor.Get;
+import br.com.caelum.vraptor.Path;
+import br.com.caelum.vraptor.Post;
+import br.com.caelum.vraptor.Result;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.base.SigaCalendar;
+import br.gov.jfrj.siga.cp.model.DpLotacaoSelecao;
+import br.gov.jfrj.siga.cp.model.DpPessoaSelecao;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.model.SelecaoGenerica;
+import br.gov.jfrj.siga.vraptor.SigaIdDescr;
+import br.gov.jfrj.siga.vraptor.SigaObjects;
+import br.gov.jfrj.siga.vraptor.StringQualquer;
+import br.gov.jfrj.siga.vraptor.Transacional;
+import br.gov.jfrj.siga.wf.bl.Wf;
+import br.gov.jfrj.siga.wf.bl.WfBL;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeVariavel;
+import br.gov.jfrj.siga.wf.model.WfMov;
+import br.gov.jfrj.siga.wf.model.WfMovAnotacao;
+import br.gov.jfrj.siga.wf.model.WfProcedimento;
+import br.gov.jfrj.siga.wf.model.enm.WfPrioridade;
+import br.gov.jfrj.siga.wf.model.enm.WfTipoDePrincipal;
+import br.gov.jfrj.siga.wf.util.WfTarefa;
+import br.gov.jfrj.siga.wf.util.WfUtil;
+
+@Controller
+@SuppressWarnings("unchecked")
+public class WfAppController extends WfController {
+	private static final String VERIFICADOR_ACESSO = "INI:Iniciar";
+
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	public WfAppController() {
+		super();
+	}
+
+	@Inject
+	public WfAppController(HttpServletRequest request, Result result, WfDao dao, SigaObjects so, WfUtil util) {
+		super(request, result, dao, so, util);
+	}
+
+	@Get
+	@Path("/app/ativos")
+	public void ativos() throws Exception {
+		inbox();
+	}
+
+	public WfDao dao() {
+		return (WfDao) dao;
+	}
+
+	/**
+	 * Coloca as tarefas que estão para o usuário no atributo "taskInstances". Além
+	 * disso, coloca os procedimentos que podem ser iniciados pelo usuário do
+	 * sistema no atributo "processDefinitions".Este método é executando ao ser
+	 * chamada a action "inbox.action".
+	 * 
+	 * @return
+	 * @throws Exception
+	 */
+	@Get
+	@Path("/app/inbox")
+	public void inbox() throws Exception {
+		SortedSet<WfTarefa> tis = new TreeSet<>();
+		List<WfProcedimento> pis = dao().consultarProcedimentosPorPessoaOuLotacao(getTitular(), getLotaTitular());
+		for (WfProcedimento pi : pis) {
+			tis.add(new WfTarefa(pi));
+		}
+		result.include("tarefas", tis);
+	}
+
+	/**
+	 * Cria uma instância de processo baseando-se na definição de processo escolhida
+	 * pelo usuário.
+	 * 
+	 * @return
+	 * @throws Exception
+	 */
+	@Get
+	@Path("/app/listar-para-iniciar")
+	public void listarParaIniciar() throws Exception {
+		assertAcesso(VERIFICADOR_ACESSO);
+		List<WfDefinicaoDeProcedimento> modelos = dao().listarAtivos(WfDefinicaoDeProcedimento.class, "nome");
+		result.include("itens", modelos);
+	}
+
+	/**
+	 * Cria uma instância de processo baseando-se na definição de processo escolhida
+	 * pelo usuário.
+	 * 
+	 * @return
+	 * @throws Exception
+	 */
+	@Get
+	@Path("/app/iniciar/{pdId}")
+	public void iniciar(Long pdId) throws Exception {
+		if (pdId == null)
+			throw new RuntimeException();
+		WfDefinicaoDeProcedimento pd = dao().consultar(pdId, WfDefinicaoDeProcedimento.class, false);
+		result.include("pd", pd);
+	}
+
+	/**
+	 * Cria uma instância de processo baseando-se na definição de processo escolhida
+	 * pelo usuário.
+	 * 
+	 * @return
+	 * @throws Exception
+	 */
+	@Transacional
+	@Post
+	@Path("/app/iniciar/{pdId}")
+	public void iniciar(Long pdId, WfTipoDePrincipal tipoDePrincipal, String principal, SelecaoGenerica documentoRefSel)
+			throws Exception {
+		if (documentoRefSel != null && documentoRefSel.getSigla() != null) {
+			principal = documentoRefSel.getSigla();
+		}
+		if (pdId == null)
+			throw new RuntimeException();
+		WfProcedimento pi = Wf.getInstance().getBL().createProcessInstance(pdId, getTitular(), getLotaTitular(),
+				getIdentidadeCadastrante(), tipoDePrincipal, principal, null, null, true);
+		result.redirectTo(this).procedimento(pi.getId());
+	}
+
+	/**
+	 * Prove uma url de teste para a inbox do workflow.
+	 * 
+	 * @return
+	 * @throws Exception
+	 */
+	@Path("/public/app/testes/gadgetTest")
+	public void test(String matricula) throws Exception {
+		DpPessoa pes = so.daoPes(matricula);
+		so.setTitular(pes);
+		so.setLotaTitular(pes.getLotacao());
+		result.forwardTo(this).inbox();
+	}
+
+	/**
+	 * Action que inicializa todos os campos que serão necessários para finalizar a
+	 * tarefa especificada pelo Id do ProcessoInstance e o Id do ProcessDefinition.
+	 * 
+	 * @return Action.SUCCESS
+	 */
+	@Path("/app/procedimento/{piId}")
+	public void procedimento(Long piId) throws Exception {
+		WfProcedimento pi = loadTaskInstance(piId);
+		List<SigaIdDescr> prioridades = new ArrayList<SigaIdDescr>();
+
+		prioridades.add(new SigaIdDescr(WfPrioridade.MUITO_ALTA, "Muito Alta"));
+		prioridades.add(new SigaIdDescr(WfPrioridade.ALTA, "Alta"));
+		prioridades.add(new SigaIdDescr(WfPrioridade.MEDIA, "Média"));
+		prioridades.add(new SigaIdDescr(WfPrioridade.BAIXA, "Baixa"));
+		prioridades.add(new SigaIdDescr(WfPrioridade.MUITO_BAIXA, "Muito Baixa"));
+		result.include("prioridades", prioridades);
+		result.include("dot", util.getDot(new WfTarefa(pi)));
+		result.include("movs", pi.getMovimentacoes());
+		result.include("piId", pi.getId());
+		result.include("pi", pi);
+	}
+
+	/**
+	 * Verifica se as tarefas que estão designadas para o usuário estão associadas a
+	 * documentos do SIGA-DOC (por intermédio da variável iniciada com o prefixo
+	 * "doc_". Se estiver, chama o método addTask(). Este método executado quando a
+	 * action "doc.action" for chamada.
+	 */
+	@Get
+	@Path("/app/doc")
+	public void doc(String sigla) throws Exception {
+		Map<String, List<WfProcedimento>> mobilMap = new TreeMap<String, List<WfProcedimento>>();
+
+		List<WfProcedimento> taskInstances = Wf.getInstance().getBL().getTaskList(sigla);
+		for (WfProcedimento pi : taskInstances) {
+			if (pi.getStatus() != ProcessInstanceStatus.PAUSED)
+				continue;
+			String principal = pi.getPrincipal();
+			if (principal == null)
+				continue;
+
+			if (!mobilMap.containsKey(principal)) {
+				mobilMap.put(principal, new ArrayList<WfProcedimento>());
+			}
+			List<WfProcedimento> tasks = mobilMap.get(principal);
+			tasks.add(pi);
+		}
+		result.include("mobilMap", mobilMap);
+	}
+
+	/**
+	 * 
+	 * 
+	 * /** Action que finaliza uma tarefa com as variaveis atribuidas. Os valores
+	 * são atribuídos às variáveis da tarefa e depois a tarefa é transferida ao
+	 * próximo passo. Se a próxima tarefa for para o mesmo ator, esta é exibida
+	 * imediatamente.
+	 * 
+	 * @return
+	 * @throws CsisException
+	 */
+	@Transacional
+	@Post
+	@Path("/app/procedimento/{piId}/continuar")
+	public void continuar(Long piId, String[] campoIdentificador, StringQualquer[] campoValor, Integer indiceDoDesvio,
+			String sigla) throws Exception {
+		String cadastrante = getTitular().getSigla() + "@" + getLotaTitular().getSiglaCompleta();
+
+		WfProcedimento pi = loadTaskInstance(piId);
+
+		WfDefinicaoDeTarefa td = pi.getCurrentTaskDefinition();
+
+		// TODO Pegar automaticamente
+
+		// WfBL.assertPodeTransferirDocumentosVinculados(new WfTarefa(pi), cadastrante);
+
+		Map<String, Object> param = new HashMap<>();
+
+		if (td.getVariable() != null) {
+			for (int n = 0, c = 0; n < campoIdentificador.length; n++) {
+				// Associa cada variavel com seu valore especifico
+				for (WfDefinicaoDeVariavel variable : td.getVariable()) {
+					if (campoIdentificador[n] == null)
+						continue;
+					if (variable.getIdentifier().equals(campoIdentificador[n])
+							&& variable.getEditingKind() == VariableEditingKind.READ_WRITE) {
+						Object value;
+						if (variable.getIdentifier().startsWith("doc_")) {
+							value = param(variable.getIdentifier() + "_expedienteSel.sigla");
+						} else if (variable.getIdentifier().startsWith("pes_")) {
+							value = param(variable.getIdentifier() + "_pessoaSel.sigla");
+						} else if (variable.getIdentifier().startsWith("lot_")) {
+							value = param(variable.getIdentifier() + "_lotacaoSel.sigla");
+						} else if (variable.getIdentifier().startsWith("dt_")) {
+							value = SigaCalendar.converteStringEmData(campoValor[c].toString());
+							c++;
+						} else if (variable.getIdentifier().startsWith("sel_")) {
+							value = campoValor[c];
+							c++;
+						} else {
+							value = campoValor[c];
+							c++;
+						}
+
+						if (value instanceof StringQualquer)
+							value = ((StringQualquer) value).toString();
+
+						// TODO: Verifica se as variáveis "required" foram preenchidas
+						if (variable.isRequired() && (value == null
+								|| (value instanceof String && (((String) value).trim().length() == 0)))) {
+							throw new AplicacaoException("O campo " + variable.getTitle() + " deve ser preenchido");
+						}
+
+						param.put(campoIdentificador[n], value);
+					}
+				}
+			}
+		}
+
+		Integer desvio = null;
+		if (indiceDoDesvio != null && td.getDetour() != null && td.getDetour().size() > indiceDoDesvio) {
+			desvio = indiceDoDesvio;
+		}
+
+		Wf.getInstance().getBL().prosseguir(pi.getEvent(), desvio, param, getTitular(), getLotaTitular(),
+				getIdentidadeCadastrante());
+
+		// Redireciona para a pagina escolhida quando o procedimento criar uma
+		// variavel pre-definida
+		//
+//		String redirectTo = (String) taskInstance.getVariable(WF_REDIRECT_TO);
+//		if (redirectTo != null) {
+//			// taskInstance.deleteVariable(WF_REDIRECT_TO);
+//			WfDao.getInstance().getSessao().flush();
+//			taskInstance.getProcessInstance().getContextInstance().deleteVariable(WF_REDIRECT_TO);
+//			WfDao.getInstance().getSessao().flush();
+//			result.redirectTo(redirectTo);
+//			return;
+//		}
+
+		// Apresenta a pagina do documento quando a sigla for fornecida
+		//
+		if (sigla != null) {
+			result.redirectTo("/../sigaex/app/expediente/doc/exibir?sigla=" + sigla);
+			return;
+		}
+
+		// Verificar se um novo task foi criado para o process instance em
+		// questão. Se esse
+		// task existir e for designado para o mesmo ator, então a próxima
+		// página a ser exibida será a página de apresentação do task, e não a
+		// página inicial.
+		if (pi.getStatus() == ProcessInstanceStatus.PAUSED && pi.getEventoLotacao() != null
+				&& pi.getEventoLotacao().equivale(getLotaTitular())) {
+			result.redirectTo(this).procedimento(pi.getId());
+			return;
+		}
+
+		result.redirectTo(this).procedimento(pi.getId());
+	}
+
+	@Transacional
+	@Post
+	@Path("/app/procedimento/{sigla}/pegar")
+	public void pegar(String sigla, String siglaPrincipal) throws Exception {
+		WfProcedimento pi = dao().consultarPorSigla(sigla, WfProcedimento.class);
+
+		Wf.getInstance().getBL().pegar(pi, getTitular(), getLotaTitular(), getIdentidadeCadastrante());
+
+		if (siglaPrincipal != null) {
+			result.redirectTo("/../sigaex/app/expediente/doc/exibir?sigla=" + siglaPrincipal);
+			return;
+		}
+		result.redirectTo(this).procedimento(pi.getId());
+	}
+
+	// TODO Pensar se queremos ter o conceito de conhecimento dentro do WF mesmo ou
+	// se é melhor usar sempre o GC
+	/**
+	 * Grava o conhecimento a respeito de como uma tarefa deve ser executada.
+	 * 
+	 * @return
+	 * @throws CsisException
+	 */
+//	public void saveKnowledge(Long tdId, String conhecimento) throws Exception {
+//		TaskInstance taskInstance = getTaskInstance(tiId);
+//
+//		WfConhecimento cAntigo = ((WfDao) dao).consultarConhecimento(
+//				taskInstance.getProcessInstance().getProcessDefinition().getName(), taskInstance.getName());
+//
+//		WfConhecimento cNovo = new WfConhecimento();
+//		if (cAntigo != null) {
+//			PropertyUtils.copyProperties(cNovo, cAntigo);
+//			cNovo.setId(null);
+//		} else {
+//			cNovo.setProcedimento(taskInstance.getProcessInstance().getProcessDefinition().getName());
+//			cNovo.setTarefa(taskInstance.getName());
+//		}
+//		cNovo.setDescricao(conhecimento);
+//
+//		dao.gravarComHistorico(cNovo, cAntigo, null, getIdentidadeCadastrante());
+//
+//		result.redirectTo(this).task(tiId);
+//	}
+
+	/**
+	 * Action que finaliza uma tarefa com as variaveis atribuidas.
+	 * 
+	 * @return
+	 * @throws CsisException
+	 */
+	@Transacional
+	public void assignTask(Long piId, DpPessoaSelecao ator_pessoaSel, DpLotacaoSelecao lotaAtor_lotacaoSel,
+			WfPrioridade prioridade, String justificativa) throws Exception {
+		WfProcedimento pi = dao().consultar(piId, WfProcedimento.class, false);
+
+		DpPessoa actor = ator_pessoaSel.getObjeto();
+		DpLotacao lotaActor = lotaAtor_lotacaoSel.getObjeto();
+
+		if (actor == null && lotaActor == null)
+			throw new AplicacaoException(
+					"Não é permitido designar a tarefa quando tanto a pessoa quanto a lotação estão em branco.");
+		if (pi.getStatus() != ProcessInstanceStatus.PAUSED)
+			throw new AplicacaoException("Não é permitido designar a tarefa quando o procedimento não está pausado.");
+
+		boolean alterado = false;
+		if ((pi.getEventoPessoa() == null && actor != null)
+				|| (pi.getEventoPessoa() != null && (actor == null || !pi.getEventoPessoa().equivale(actor)))) {
+			pi.setEventoPessoa(actor);
+			alterado = true;
+		}
+
+		if ((pi.getEventoLotacao() == null && lotaActor != null) || (pi.getEventoLotacao() != null
+				&& (lotaActor == null || !pi.getEventoLotacao().equivale(lotaActor)))) {
+			pi.setEventoLotacao(lotaActor);
+			alterado = true;
+		}
+
+		if (alterado) {
+			WfBL.assertPodeTransferirDocumentosVinculados(new WfTarefa(pi), util.getSiglaTitular());
+			WfBL.transferirDocumentosVinculados(pi, util.getSiglaTitular());
+		}
+
+		pi.setPrioridade(prioridade);
+
+		// TODO Acrescentar uma movimentação de atribuição aqui!
+
+		result.redirectTo(this).procedimento(pi.getId());
+	}
+
+	/**
+	 * Insere um comentário à tarefa.
+	 * 
+	 * @return
+	 * @throws CsisException
+	 */
+	@Transacional
+	@Post
+	@Path("/app/anotar")
+	public void anotar(Long id, String descrMov) throws Exception {
+		WfProcedimento pi = dao().consultar(id, WfProcedimento.class, false);
+		Wf.getInstance().getBL().anotar(pi, descrMov, getTitular(), getLotaTitular(), getIdentidadeCadastrante());
+		result.redirectTo(this).procedimento(id);
+	}
+
+	/**
+	 * Insere um comentário à tarefa.
+	 * 
+	 * @return
+	 * @throws CsisException
+	 */
+	@Transacional
+	@Post
+	@Path("/app/procedimento/{id}/anotacao/{idMov}/excluir")
+	public void anotacaoExcluir(Long id, Long idMov) throws Exception {
+		WfProcedimento pi = dao().consultar(id, WfProcedimento.class, false);
+		for (WfMov mov : pi.getMovimentacoes()) {
+			if (mov.getId().equals(idMov) && mov instanceof WfMovAnotacao) {
+				Wf.getInstance().getBL().excluirAnotacao(pi, (WfMovAnotacao) mov);
+				result.redirectTo(this).procedimento(id);
+			}
+		}
+		throw new Exception("Movimentação não encontrada.");
+	}
+
+	/**
+	 * Carrega as informações relativas à tarefa, tais como, a instância da tarefa,
+	 * os logs, a prioridade e suas variáveis.
+	 * 
+	 * @throws Exception
+	 */
+	private WfProcedimento loadTaskInstance(Long piId) throws Exception {
+		WfProcedimento pi = dao().consultar(piId, WfProcedimento.class, false);
+		return pi;
+	}
+}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfConfiguracaoController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfConfiguracaoController.java
new file mode 100644
index 0000000000..a6556be7ee
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfConfiguracaoController.java
@@ -0,0 +1,348 @@
+package br.gov.jfrj.siga.wf.vraptor;
+
+import java.util.Date;
+
+import javax.inject.Inject;
+import javax.servlet.http.HttpServletRequest;
+
+import br.com.caelum.vraptor.Controller;
+import br.com.caelum.vraptor.Result;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.cp.CpTipoConfiguracao;
+import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
+import br.gov.jfrj.siga.dp.dao.CpDao;
+import br.gov.jfrj.siga.vraptor.SigaObjects;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfConfiguracao;
+import br.gov.jfrj.siga.wf.util.WfUtil;
+
+@Controller
+public class WfConfiguracaoController extends WfController {
+
+	private static int TIPO_RESP_INDEFINIDO = 0;
+	private static int TIPO_RESP_MATRICULA = 1;
+	private static int TIPO_RESP_LOTACAO = 2;
+
+//	private List<WfTipoResponsavel> listaTipoResponsavel = new ArrayList<WfTipoResponsavel>();
+
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	public WfConfiguracaoController() {
+		super();
+	}
+
+	/**
+	 * Inicializa os tipos de responsáveis e suas respectivas expressões, quando
+	 * houver.
+	 */
+	@Inject
+	public WfConfiguracaoController(HttpServletRequest request, Result result, WfDao dao, SigaObjects so, WfUtil util) {
+		super(request, result, dao, so, util);
+
+//		WfTipoResponsavel tpIndefinido = new WfTipoResponsavel(TIPO_RESP_INDEFINIDO, "[Indefinido]", "");
+//		WfTipoResponsavel tpMatricula = new WfTipoResponsavel(TIPO_RESP_MATRICULA, "Usuário", "matricula");
+//		WfTipoResponsavel tpLotacao = new WfTipoResponsavel(TIPO_RESP_LOTACAO, "Lotação", "lotacao");
+//
+//		listaTipoResponsavel.add(tpIndefinido);
+//		listaTipoResponsavel.add(tpMatricula);
+//		listaTipoResponsavel.add(tpLotacao);
+	}
+
+	/**
+	 * Grava a configuração da permissão. Primeiro, processa-se as alteraões nas
+	 * permissões existentes e depois processa-se as novas permissões. As permissões
+	 * indefinidas são excluídas da lista de permissões.
+	 * 
+	 * @return
+	 * @throws Exception
+	 */
+	public void gravar(String orgao, String procedimento) throws Exception {
+//		ProcessDefinition pd = WfContextBuilder.getJbpmContext().getJbpmContext().getGraphSession()
+//				.findLatestProcessDefinition(procedimento);
+//
+//		CpOrgaoUsuario orgaoUsuario = daoOU(orgao);
+//
+//		Date horaDoDB = dao().consultarDataEHoraDoServidor();
+//		if (pd != null) {
+//
+//			// processa permissões existentes
+//			List<Permissao> listaPermissao = getPermissoes(orgaoUsuario, procedimento);
+//			for (Permissao perm : listaPermissao) {
+//				WfConfiguracao cfg = prepararConfiguracao(orgaoUsuario, procedimento);
+//
+//				processarPermissao(orgaoUsuario, procedimento, perm, cfg, horaDoDB);
+//
+//			}
+//
+//			// processa nova permissão
+//			WfConfiguracao cfg = prepararConfiguracao(orgaoUsuario, procedimento);
+//			Permissao novaPermissao = new Permissao();
+//			novaPermissao.setId(this.getIdNovaPermissao());
+//			novaPermissao.setProcedimento(procedimento);
+//
+//			processarPermissao(orgaoUsuario, procedimento, novaPermissao, cfg, horaDoDB);
+//
+//			if (novaPermissao.getPessoa() != null || novaPermissao.getLotacao() != null) {
+//				listaPermissao.add(novaPermissao);
+//			}
+//
+//			// remove permissões inválidas
+//			ArrayList<Permissao> listaAux = new ArrayList<Permissao>();
+//			for (Permissao perm : listaPermissao) {
+//				if (perm.getPessoa() != null || perm.getLotacao() != null) {
+//					listaAux.add(perm);
+//				}
+//			}
+//
+//			listaPermissao = listaAux;
+//
+//			limparCache();
+//		}
+//
+//		result.redirectTo(this).pesquisar(orgao, procedimento);
+	}
+
+	/**
+	 * Seleciona um procedimento que terá suas permissões configuradas.
+	 * 
+	 * @return
+	 * @throws Exception
+	 */
+	public void pesquisar(String orgao, String procedimento) throws Exception {
+//		assertAcesso(ACESSO_CONFIGURAR_INICIADORES);
+//
+//		limparCache();
+//		ProcessDefinition pd = WfContextBuilder.getJbpmContext().getJbpmContext().getGraphSession()
+//				.findLatestProcessDefinition(procedimento);
+//		CpOrgaoUsuario orgaoUsuario = daoOU(orgao);
+//
+//		if (pd != null) {
+//			List<Permissao> listaPermissao = new ArrayList<Permissao>();
+//			listaPermissao.addAll(getPermissoes(orgaoUsuario, procedimento));
+//			result.include("orgao", orgao);
+//			result.include("procedimento", procedimento);
+//			result.include("listaPermissao", listaPermissao);
+//			result.include("listaOrgao", dao().listarOrgaosUsuarios());
+//			result.include("listaTipoResponsavel", listaTipoResponsavel);
+//			result.include("listaProcedimento", getListaProcedimento());
+//		}
+	}
+
+	/**
+	 * Retorna a lista de configurações definidas para uma permissão.
+	 * 
+	 * @param perm -
+	 * @return Lista de permissões já gravadas no banco de dados.
+	 * @throws Exception
+	 */
+//	private List<WfConfiguracao> getConfiguracaoExistente(CpOrgaoUsuario orgaoUsuario, String procedimento,
+//			Permissao perm) throws Exception {
+//		WfConfiguracao fltConfigExistente = new WfConfiguracao();
+//
+//		CpTipoConfiguracao tipoConfig = CpDao.getInstance()
+//				.consultar(CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO, CpTipoConfiguracao.class, false);
+//
+//		fltConfigExistente.setCpTipoConfiguracao(tipoConfig);
+//		fltConfigExistente.setOrgaoUsuario(orgaoUsuario);
+//		fltConfigExistente.setProcedimento(procedimento);
+//		fltConfigExistente.setDpPessoa(perm.getPessoa());
+//		fltConfigExistente.setLotacao(perm.getLotacao());
+//
+//		List<WfConfiguracao> cfgExistente = WfDao.getInstance().consultar(fltConfigExistente);
+//		List<WfConfiguracao> resultado = new ArrayList<WfConfiguracao>();
+//		// Melhorar isso: o filtro por pessoa ou lotação não está funcionando
+//		for (WfConfiguracao c : cfgExistente) {
+//			if ((c.getDpPessoa() != null || c.getLotacao() != null) && c.getHisDtFim() == null
+//					&& c.getIdConfiguracao().equals(perm.getIdentifier())) {
+//				resultado.add(c);
+//			}
+//		}
+//
+//		return resultado;
+//	}
+
+	/**
+	 * Retorna a lista de permissões definidas para uma definição de procedimento.
+	 * 
+	 * @param pd - Definição de processo
+	 * @return - Lista de permissões
+	 * @throws Exception
+	 */
+//	private List<Permissao> getPermissoes(CpOrgaoUsuario orgaoUsuario, String procedimento) throws Exception {
+//
+//		List<Permissao> resultado = new ArrayList<Permissao>();
+//
+//		TreeSet<CpConfiguracao> cfg = Wf.getInstance().getConf()
+//				.getListaPorTipo(CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO);
+//		for (CpConfiguracao c : cfg) {
+//
+//			if (c instanceof WfConfiguracao) {
+//				WfConfiguracao wfC = (WfConfiguracao) c;
+//				if (wfC.getProcedimento() != null && wfC.getProcedimento().equals(procedimento)
+//						&& wfC.getHisDtFim() == null) {
+//
+//					Permissao perm = new Permissao();
+//					perm.setProcedimento(procedimento);
+//					perm.setId(c.getIdConfiguracao());
+//
+//					perm.setPessoa(c.getDpPessoa());
+//					perm.setLotacao(c.getLotacao());
+//
+//					if (perm.getPessoa() != null) {
+//						perm.setTipoResponsavel(TIPO_RESP_MATRICULA);
+//					}
+//					if (perm.getLotacao() != null) {
+//						perm.setTipoResponsavel(TIPO_RESP_LOTACAO);
+//					}
+//
+//					resultado.add(perm);
+//				}
+//			}
+//		}
+//
+//		return resultado;
+//
+//	}
+
+	/**
+	 * Método utilizado para gravar uma nova configuração. ATENÇÃO: ESTE MÉTODO
+	 * PROVAVELMENTE PODE SER ELIMINADO EM UM REFACTORING.
+	 * 
+	 * @param cfg
+	 * @throws Exception
+	 */
+	private void gravarNovaConfig(WfConfiguracao cfg) throws Exception {
+		WfDao.getInstance().gravarComHistorico(cfg, getIdentidadeCadastrante());
+	}
+
+	/**
+	 * Torna uma configuração existente inválida. A invalidação da configuração
+	 * normalmente ocorre ao se criar uma nova configuração. A configuração antiga
+	 * torna-se inválida mas continua sendo mantida no banco de dados para fins de
+	 * histórico.
+	 * 
+	 * @param cfgExistente - Configuração a ser invalidada
+	 * @param dataFim      - Data que define o fim da validade da configuração, ou
+	 *                     seja, data de invalidação.
+	 * @throws AplicacaoException
+	 */
+	private void invalidarConfiguracao(WfConfiguracao cfgExistente, Date dataFim) throws AplicacaoException {
+		if (cfgExistente != null && cfgExistente.getHisDtFim() == null) {
+			cfgExistente.setHisDtFim(dataFim);
+			WfDao.getInstance().gravarComHistorico(cfgExistente, getIdentidadeCadastrante());
+		}
+	}
+
+	/**
+	 * Limpa o cache do hibernate. Como as configurações são mantidas em cache por
+	 * motivo de performance, as alterações precisam ser atualizadas para que possam
+	 * valer imediatamente.
+	 * 
+	 * @throws Exception
+	 */
+//	public void limparCache() throws Exception {
+//
+//		SessionFactory sfWfDao = WfDao.getInstance().getSessao().getSessionFactory();
+//		SessionFactory sfCpDao = CpDao.getInstance().getSessao().getSessionFactory();
+//
+//		CpTipoConfiguracao tipoConfig = CpDao.getInstance()
+//				.consultar(CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO, CpTipoConfiguracao.class, false);
+//
+//		Wf.getInstance().getConf().limparCacheSeNecessario();
+//
+//		sfWfDao.evict(CpConfiguracao.class);
+//		sfWfDao.evict(WfConfiguracao.class);
+//		sfCpDao.evict(DpLotacao.class);
+//
+//		sfWfDao.evictQueries(CpDao.CACHE_QUERY_CONFIGURACAO);
+//
+//		return;
+//
+//	}
+
+	/**
+	 * Inicia um objeto WfConfiguracao de modo que possa receber as configurações
+	 * definidas pelo usuário.
+	 * 
+	 * @return - Configuração pronta para receber as configurações.
+	 */
+	private WfConfiguracao prepararConfiguracao(CpOrgaoUsuario orgaoUsuario, String procedimento) {
+		WfConfiguracao cfg = new WfConfiguracao();
+		CpTipoConfiguracao tipoConfig = CpDao.getInstance()
+				.consultar(CpTipoConfiguracao.TIPO_CONFIG_INSTANCIAR_PROCEDIMENTO, CpTipoConfiguracao.class, false);
+		cfg.setCpTipoConfiguracao(tipoConfig);
+		cfg.setOrgaoUsuario(orgaoUsuario);
+		cfg.setProcedimento(procedimento);
+		return cfg;
+	}
+
+	/**
+	 * Processa as permissões definidas pelo usuário. São extraídos os dados do
+	 * request, definida a data de início da configuração, definidas as permissões,
+	 * definida a invalidação da configuração antiga e atualizada a visão do
+	 * usuário.
+	 * 
+	 * @param permissao - Permissão a ser processada
+	 * @param cfg       - Configuração preparada para receber as novas configurações
+	 * @param horaDoBD  - Hora do banco de dados. A data/hora de início de vigência
+	 *                  deve ser a mesma da invalidação da configuração anterior.
+	 * @throws Exception
+	 */
+//	private void processarPermissao(CpOrgaoUsuario orgaoUsuario, String procedimento, Permissao permissao,
+//			WfConfiguracao cfg, Date horaDoBD) throws Exception {
+//		DpLotacao lotacao = null;
+//		DpPessoa pessoa = null;
+//
+//		lotacao = extrairLotaAtor(permissao.getIdentifier());
+//		pessoa = extrairAtor(permissao.getIdentifier());
+//
+//		if (pessoa != null || lotacao != null) {// se
+//			// configuração
+//			// definida
+//			cfg.setDpPessoa(pessoa);
+//			cfg.setLotacao(lotacao);
+//
+//			cfg.setHisDtIni(horaDoBD);
+//
+//			for (WfConfiguracao cfgExistente : getConfiguracaoExistente(orgaoUsuario, procedimento, permissao)) {
+//				invalidarConfiguracao(cfgExistente, horaDoBD);
+//			}
+//
+//			permissao.setPessoa(pessoa);
+//			permissao.setLotacao(lotacao);
+//
+//			CpSituacaoConfiguracao sit = new CpSituacaoConfiguracao();
+//			sit.setIdSitConfiguracao(CpSituacaoConfiguracao.SITUACAO_PODE);
+//			cfg.setCpSituacaoConfiguracao(sit);
+//			gravarNovaConfig(cfg);
+//			permissao.setId(cfg.getIdConfiguracao()); // deixa de usar a id
+//			// temporária
+//
+//			// atualiza os dados da visão
+//			if (pessoa != null) {
+//				permissao.setPessoa(pessoa);
+//				permissao.setTipoResponsavel(TIPO_RESP_MATRICULA);
+//			}
+//
+//			if (lotacao != null) {
+//				permissao.setLotacao(lotacao);
+//				permissao.setTipoResponsavel(TIPO_RESP_LOTACAO);
+//			}
+//
+//		} else {
+//			for (WfConfiguracao cfgExistente : getConfiguracaoExistente(orgaoUsuario, procedimento, permissao)) {
+//				invalidarConfiguracao(cfgExistente, horaDoBD);
+//			}
+//
+//			permissao.setPessoa(pessoa);
+//			permissao.setLotacao(lotacao);
+//		}
+//
+//	}
+
+	private Long getIdNovaPermissao() {
+		return Long.MAX_VALUE;
+	}
+
+}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfController.java
index 22bd24519b..b7a317f6ec 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfController.java
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfController.java
@@ -1,15 +1,10 @@
 package br.gov.jfrj.siga.wf.vraptor;
 
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.List;
 import java.util.Map;
 
+import javax.inject.Inject;
 import javax.servlet.http.HttpServletRequest;
 
-import org.jbpm.db.GraphSession;
-import org.jbpm.graph.def.ProcessDefinition;
-
 import br.com.caelum.vraptor.Result;
 import br.gov.jfrj.siga.base.AplicacaoException;
 import br.gov.jfrj.siga.dp.DpLotacao;
@@ -18,7 +13,7 @@ import br.gov.jfrj.siga.dp.dao.CpDao;
 import br.gov.jfrj.siga.vraptor.SigaController;
 import br.gov.jfrj.siga.vraptor.SigaObjects;
 import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfContextBuilder;
+import br.gov.jfrj.siga.wf.util.WfUtil;
 
 public class WfController extends SigaController {
 
@@ -28,30 +23,21 @@ public class WfController extends SigaController {
 	protected static final String ACESSO_MOVER_TOKEN = "MOVER_TOKEN:Mover token";
 	protected static final String ACESSO_CONFIGURAR_INICIADORES = "CONFIGURAR:Configurar iniciadores";
 	protected static final String ACESSO_DESIGNAR_TAREFAS = "DESIGNAR:Designar tarefas";
-	protected static final String ACESSO_ANALISAR_METRICAS = "MEDIR:Analisar métricas";
-	
-	protected WfUtil util;
+	protected static final String ACESSO_RELATORIOS = "REL:Relatórios";
 
-	public WfController(HttpServletRequest request, Result result, WfDao dao,
-			SigaObjects so, WfUtil util) {
-		super(request, result, (CpDao) dao, so, null);
-		this.util = util;
+	protected WfUtil util;
 
-		result.include("processDefinitions", getProcessDefinitions());
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	public WfController() {
+		super();
 	}
 
-	private List<ProcessDefinition> getProcessDefinitions() {
-		GraphSession graph = WfContextBuilder.getJbpmContext()
-				.getGraphSession();
-		// processDefinitions = graph.findLatestProcessDefinitions();
-		List<ProcessDefinition> processDefinitions = new ArrayList<ProcessDefinition>();
-		for (ProcessDefinition pd : (Collection<ProcessDefinition>) graph
-				.findLatestProcessDefinitions()) {
-			// if (Wf.getInstance().getComp().podeInstanciarProcedimento(
-			// getTitular(), getLotaTitular(), pd.getName()))
-			processDefinitions.add(pd);
-		}
-		return processDefinitions;
+	@Inject
+	public WfController(HttpServletRequest request, Result result, WfDao dao, SigaObjects so, WfUtil util) {
+		super(request, result, (CpDao) dao, so, null);
+		this.util = util;
 	}
 
 	public void assertAcesso(String pathServico) throws AplicacaoException {
@@ -63,14 +49,13 @@ public class WfController extends SigaController {
 	}
 
 	/**
-	 * Como na página pesquisarDesignação.jsp os componentes de seleção dos
-	 * atores são dinâmicos, é necessária a extração dos dados diretamente dos
-	 * parâmetros do request. O prefixo "matricula_" é difinido na página
-	 * pesquisaDesignacao.jsp e os sufixos "_pessoaSel.id" e "_pessoaSel.sigla"
-	 * são definidos na TAG selecao.tag
+	 * Como na página pesquisarDesignação.jsp os componentes de seleção dos atores
+	 * são dinâmicos, é necessária a extração dos dados diretamente dos parâmetros
+	 * do request. O prefixo "matricula_" é difinido na página
+	 * pesquisaDesignacao.jsp e os sufixos "_pessoaSel.id" e "_pessoaSel.sigla" são
+	 * definidos na TAG selecao.tag
 	 * 
-	 * @param id
-	 *            da tarefa
+	 * @param id da tarefa
 	 * @return Um objeto DpPessoa do ator selecionado na página.
 	 */
 	protected DpPessoa extrairAtor(long id) {
@@ -80,8 +65,7 @@ public class WfController extends SigaController {
 		String responsavelSigla = null;
 		DpPessoa ator = null;
 		Map<?, ?> parametros = this.getRequest().getParameterMap();
-		if (parametros.containsKey(keyMatriculaId)
-				&& parametros.containsKey(keyMatriculaSigla)) {
+		if (parametros.containsKey(keyMatriculaId) && parametros.containsKey(keyMatriculaSigla)) {
 			responsavelId = ((String[]) parametros.get(keyMatriculaId))[0];
 			responsavelSigla = ((String[]) parametros.get(keyMatriculaSigla))[0];
 			if (!responsavelId.equals("") && !responsavelSigla.equals("")) {
@@ -93,14 +77,13 @@ public class WfController extends SigaController {
 	}
 
 	/**
-	 * Como na página pesquisarDesignação.jsp os componentes de seleção das
-	 * lotações são dinâmicas, é necessária a extração dos dados diretamente dos
-	 * parâmetros do request. O prefixo "lotacao_" é difinido na página
-	 * pesquisaDesignacao.jsp e os sufixos "_lotacaoSel.id" e
-	 * "_lotacaoSel.sigla" são definidos na TAG selecao.tag
+	 * Como na página pesquisarDesignação.jsp os componentes de seleção das lotações
+	 * são dinâmicas, é necessária a extração dos dados diretamente dos parâmetros
+	 * do request. O prefixo "lotacao_" é difinido na página pesquisaDesignacao.jsp
+	 * e os sufixos "_lotacaoSel.id" e "_lotacaoSel.sigla" são definidos na TAG
+	 * selecao.tag
 	 * 
-	 * @param id
-	 *            da tarefa
+	 * @param id da tarefa
 	 * @return Um objeto DpPessoa do ator selecionado na página
 	 */
 	protected DpLotacao extrairLotaAtor(long id) {
@@ -111,8 +94,7 @@ public class WfController extends SigaController {
 		Map<?, ?> parametros = this.getRequest().getParameterMap();
 		DpLotacao lotaAtor = null;
 
-		if (parametros.containsKey(keyLotacaoId)
-				&& parametros.containsKey(keyLotacaoSigla)) {
+		if (parametros.containsKey(keyLotacaoId) && parametros.containsKey(keyLotacaoSigla)) {
 			responsavelId = ((String[]) parametros.get(keyLotacaoId))[0];
 			responsavelSigla = ((String[]) parametros.get(keyLotacaoSigla))[0];
 			if (!responsavelId.equals("") && !responsavelSigla.equals("")) {
@@ -121,31 +103,4 @@ public class WfController extends SigaController {
 		}
 		return lotaAtor;
 	}
-	
-	/**
-	 * Retorna a lista de procedimentos que podem ter designações definidas.
-	 * Este método é usado pela página pesquisarDesignação.jsp
-	 * 
-	 * @return Lista de definições de processo
-	 */
-	protected List<ProcessDefinition> getListaProcedimento() {
-		@SuppressWarnings("unchecked")
-		List<ProcessDefinition> lista = WfContextBuilder.getJbpmContext()
-				.getJbpmContext().getGraphSession()
-				.findLatestProcessDefinitions();
-		// Markenson: O código abaixo foi inserido para evitar a carga de
-		// definicões de processos defeituosos
-		// Esse problema foi detectado quando o Orlando fez o deploy de um
-		// processo sem definir o nome
-		// O tratamento de deploys deve fazer essa verificação
-		List<ProcessDefinition> resultado = new ArrayList<ProcessDefinition>();
-		for (ProcessDefinition p : lista) {
-			if (p.getName() != null) {
-				resultado.add(p);
-			}
-		}
-
-		return resultado;
-	}
-
 }
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfDaoCreator.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfDaoCreator.java
deleted file mode 100644
index 04342f8d38..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfDaoCreator.java
+++ /dev/null
@@ -1,53 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import javax.annotation.PostConstruct;
-import javax.annotation.PreDestroy;
-
-import br.com.caelum.vraptor.ioc.Component;
-import br.com.caelum.vraptor.ioc.ComponentFactory;
-import br.com.caelum.vraptor.ioc.RequestScoped;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-
-@Component
-@RequestScoped
-public class WfDaoCreator implements ComponentFactory<WfDao> {
-	// private final SessionFactory factory;
-	// private Session session;
-	// private WfDao dao;
-
-	// public WfDaoCreator(SessionFactory factory) {
-	// this.factory = factory;
-	// }
-
-	@PostConstruct
-	public void create() {
-		// HibernateUtil.getSessao();
-		// ModeloDao.freeInstance();
-		// //WfDao.getInstance();
-		// //Wf.getInstance().getConf().limparCacheSeNecessario();
-		//
-		// //this.session = factory.openSession();
-		// dao = (WfDao) WfDao.getInstance(this.session);
-		//
-		// // Novo
-		// WfContextBuilder.getConfiguration();
-		// WfContextBuilder.createJbpmContext();
-		// WfContextBuilder.getJbpmContext().getJbpmContext()
-		// .setSession(WfDao.getInstance().getSessao());
-		// WfDao.iniciarTransacao();
-	}
-
-	public WfDao getInstance() {
-		return WfDao.getInstance();
-		// return this.dao;
-	}
-
-	@PreDestroy
-	public void destroy() {
-		// WfDao.commitTransacao();
-		// if (this.session != null)
-		// this.session.close();
-		// ModeloDao.freeInstance();
-	}
-
-}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfDiagramaController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfDiagramaController.java
new file mode 100644
index 0000000000..e5ea4e9960
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfDiagramaController.java
@@ -0,0 +1,385 @@
+package br.gov.jfrj.siga.wf.vraptor;
+
+import java.io.PrintWriter;
+import java.io.StringWriter;
+import java.io.UnsupportedEncodingException;
+import java.lang.reflect.Type;
+import java.text.ParseException;
+import java.text.SimpleDateFormat;
+import java.util.Date;
+import java.util.List;
+import java.util.SortedSet;
+import java.util.TreeSet;
+
+import javax.inject.Inject;
+import javax.persistence.EntityManager;
+import javax.servlet.ServletContext;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
+import org.apache.axis.encoding.Base64;
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+
+import com.google.gson.ExclusionStrategy;
+import com.google.gson.FieldAttributes;
+import com.google.gson.Gson;
+import com.google.gson.GsonBuilder;
+import com.google.gson.JsonDeserializationContext;
+import com.google.gson.JsonDeserializer;
+import com.google.gson.JsonElement;
+import com.google.gson.JsonObject;
+import com.google.gson.JsonParseException;
+import com.google.gson.JsonPrimitive;
+import com.google.gson.JsonSerializationContext;
+import com.google.gson.JsonSerializer;
+
+import br.com.caelum.vraptor.Controller;
+import br.com.caelum.vraptor.Get;
+import br.com.caelum.vraptor.Path;
+import br.com.caelum.vraptor.Post;
+import br.com.caelum.vraptor.Result;
+import br.com.caelum.vraptor.view.Results;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavel;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.model.dao.DaoFiltroSelecionavel;
+import br.gov.jfrj.siga.model.dao.ModeloDao;
+import br.gov.jfrj.siga.sinc.lib.Item;
+import br.gov.jfrj.siga.sinc.lib.Sincronizador;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.vraptor.SigaObjects;
+import br.gov.jfrj.siga.vraptor.SigaSelecionavelControllerSupport;
+import br.gov.jfrj.siga.vraptor.Transacional;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeDesvio;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeTarefa;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeVariavel;
+import br.gov.jfrj.siga.wf.util.NaoSerializar;
+
+@Controller
+@Path("app/diagrama")
+public class WfDiagramaController
+		extends SigaSelecionavelControllerSupport<WfDefinicaoDeProcedimento, DaoFiltroSelecionavel> {
+
+	private static final String VERIFICADOR_ACESSO = "WF;FE;DEFP:Gerenciar Diagramas";
+	private static final String UTF8 = "utf-8";
+
+	public static String ISO_FORMAT = "yyyy-MM-dd'T'HH:mm:ss.SSSXXX";
+	public static final SimpleDateFormat isoFormatter = new SimpleDateFormat(ISO_FORMAT);
+
+	public static final Gson gson = new GsonBuilder().setExclusionStrategies(new ExclusionStrategy() {
+
+		@Override
+		public boolean shouldSkipClass(Class<?> clazz) {
+			return false;
+		}
+
+		@Override
+		public boolean shouldSkipField(FieldAttributes f) {
+			System.out.println(f.getName());
+			if (f.getName().startsWith("hisIdc"))
+				return true;
+			return f.getAnnotation(NaoSerializar.class) != null;
+		}
+
+	}).registerTypeHierarchyAdapter(byte[].class, new ByteArrayToBase64TypeAdapter())
+			.registerTypeHierarchyAdapter(Date.class, new DateToStringTypeAdapter())
+			.registerTypeHierarchyAdapter(WfDefinicaoDeResponsavel.class, new WfDefinicaoDeResponsavelTypeAdapter())
+			.registerTypeHierarchyAdapter(DpLotacao.class, new DpLotacaoTypeAdapter())
+			.registerTypeHierarchyAdapter(DpPessoa.class, new DpPessoaTypeAdapter()).setPrettyPrinting().create();
+
+	private static class DpLotacaoTypeAdapter implements JsonSerializer<DpLotacao> {
+		public JsonElement serialize(DpLotacao src, Type typeOfSrc, JsonSerializationContext context) {
+			JsonObject o = new JsonObject();
+			JsonObject oo = new JsonObject();
+			o.add("originalObject", oo);
+			oo.addProperty("key", Long.toString(src.getId()));
+			oo.addProperty("firstLine", src.getSigla());
+			oo.addProperty("secondLine", src.getDescricao());
+			return oo;
+		}
+	}
+
+	private static class DpPessoaTypeAdapter implements JsonSerializer<DpPessoa> {
+		public JsonElement serialize(DpPessoa src, Type typeOfSrc, JsonSerializationContext context) {
+			JsonObject o = new JsonObject();
+			JsonObject oo = new JsonObject();
+			o.add("originalObject", oo);
+			oo.addProperty("key", Long.toString(src.getId()));
+			oo.addProperty("firstLine", src.getSigla());
+			oo.addProperty("secondLine", src.getDescricao());
+			return oo;
+		}
+	}
+
+	private static class WfDefinicaoDeResponsavelTypeAdapter implements JsonSerializer<WfDefinicaoDeResponsavel> {
+		public JsonElement serialize(WfDefinicaoDeResponsavel src, Type typeOfSrc, JsonSerializationContext context) {
+			return new JsonPrimitive(src.getIdInicial());
+		}
+	}
+
+	private static class ByteArrayToBase64TypeAdapter implements JsonSerializer<byte[]>, JsonDeserializer<byte[]> {
+		public byte[] deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context)
+				throws JsonParseException {
+			return Base64.decode(json.getAsString());
+		}
+
+		public JsonElement serialize(byte[] src, Type typeOfSrc, JsonSerializationContext context) {
+			return new JsonPrimitive(Base64.encode(src));
+		}
+	}
+
+	private static class DateToStringTypeAdapter implements JsonSerializer<Date>, JsonDeserializer<Date> {
+		public Date deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context)
+				throws JsonParseException {
+			return parse(json.getAsString());
+		}
+
+		public JsonElement serialize(Date src, Type typeOfSrc, JsonSerializationContext context) {
+			return new JsonPrimitive(format(src));
+		}
+	}
+
+	public static String format(Date date) {
+		return isoFormatter.format(date);
+	}
+
+	public static Date parse(String date) {
+		try {
+			return isoFormatter.parse(date);
+		} catch (ParseException e) {
+			return null;
+		}
+	}
+
+	private HttpServletResponse response;
+	private ServletContext context;
+
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	public WfDiagramaController() {
+		super();
+	}
+
+	@Inject
+	public WfDiagramaController(HttpServletRequest request, Result result, WfDao dao, SigaObjects so, EntityManager em,
+			HttpServletResponse response, ServletContext context) {
+		super(request, result, dao, so, em);
+		this.response = response;
+		this.context = context;
+	}
+
+	@Get("listar")
+	public void lista() throws Exception {
+		try {
+			assertAcesso(VERIFICADOR_ACESSO);
+			List<WfDefinicaoDeProcedimento> modelos = dao().listarAtivos(WfDefinicaoDeProcedimento.class, "nome");
+			result.include("itens", modelos);
+		} catch (AplicacaoException e) {
+			throw new AplicacaoException(e.getMessage(), 0, e);
+		} catch (Exception ex) {
+			throw new AplicacaoException(ex.getMessage(), 0, ex);
+		}
+	}
+
+	@Get("editar")
+	public void edita(final Long id) throws UnsupportedEncodingException {
+		assertAcesso(VERIFICADOR_ACESSO);
+		if (id != null)
+			result.include("pd", WfDefinicaoDeProcedimento.AR.findById(id));
+	}
+
+	@Get("{id}/carregar")
+	public void carregar(final Long id) throws Exception {
+		assertAcesso(VERIFICADOR_ACESSO);
+		try {
+			WfDefinicaoDeProcedimento pd = buscar(id);
+			jsonSuccess(pd);
+		} catch (Exception e) {
+			jsonError(e);
+		}
+	}
+
+	@Transacional
+	@Post("gravar")
+	public void editarGravar(Long id, WfDefinicaoDeProcedimento pd) throws Exception {
+		assertAcesso(VERIFICADOR_ACESSO);
+
+		if (pd.getOrgaoUsuario() == null)
+			pd.setOrgaoUsuario(getTitular().getOrgaoUsuario());
+
+		SortedSet<Sincronizavel> setDepois = new TreeSet<>();
+		SortedSet<Sincronizavel> setAntes = new TreeSet<>();
+
+		setDepois.add(pd);
+
+		// Prepara a definição para ser sincronizada
+		if (pd.getDefinicaoDeTarefa() != null) {
+			for (WfDefinicaoDeTarefa td : pd.getDefinicaoDeTarefa()) {
+				td.setDefinicaoDeProcedimento(pd);
+				setDepois.add(td);
+				if (td.getSeguinteIde() != null) {
+					for (WfDefinicaoDeTarefa td2 : pd.getDefinicaoDeTarefa()) {
+						if (td.getSeguinteIde().equals(td2.getIdExterna())) {
+							td.setSeguinte(td2);
+							break;
+						}
+					}
+				}
+				if (td.getPessoaId() != null)
+					td.setPessoa(dao().consultar(td.getPessoaId(), DpPessoa.class, false));
+				if (td.getLotacaoId() != null)
+					td.setLotacao(dao().consultar(td.getLotacaoId(), DpLotacao.class, false));
+				if (td.getDefinicaoDeResponsavelId() != null)
+					td.setDefinicaoDeResponsavel(
+							dao().consultar(td.getDefinicaoDeResponsavelId(), WfDefinicaoDeResponsavel.class, false));
+
+				if (td.getDefinicaoDeVariavel() != null) {
+					for (WfDefinicaoDeVariavel vd : td.getDefinicaoDeVariavel()) {
+						vd.setDefinicaoDeTarefa(td);
+						setDepois.add(vd);
+					}
+				}
+				if (td.getDefinicaoDeDesvio() != null) {
+					for (WfDefinicaoDeDesvio dd : td.getDefinicaoDeDesvio()) {
+						dd.setDefinicaoDeTarefa(td);
+						setDepois.add(dd);
+						if (dd.getSeguinteIde() != null) {
+							for (WfDefinicaoDeTarefa td2 : pd.getDefinicaoDeTarefa()) {
+								if (dd.getSeguinteIde().equals(td2.getIdExterna())) {
+									dd.setSeguinte(td2);
+									break;
+								}
+							}
+						}
+					}
+				}
+			}
+		}
+
+		if (id != null) {
+			WfDefinicaoDeProcedimento opd = dao().consultar(id, WfDefinicaoDeProcedimento.class, false);
+			opd = dao().consultarAtivoPorIdInicial(WfDefinicaoDeProcedimento.class, opd.getHisIdIni());
+			setAntes.add(opd);
+			pd.setAno(opd.getAno());
+			pd.setNumero(opd.getNumero());
+			pd.setHisIdIni(opd.getHisIdIni());
+			pd.setOrgaoUsuario(opd.getOrgaoUsuario());
+			if (opd.getDefinicaoDeTarefa() != null) {
+				for (WfDefinicaoDeTarefa otd : opd.getDefinicaoDeTarefa()) {
+					setAntes.add(otd);
+					if (otd.getDefinicaoDeVariavel() != null)
+						for (WfDefinicaoDeVariavel ovd : otd.getDefinicaoDeVariavel())
+							setAntes.add(ovd);
+					if (otd.getDefinicaoDeVariavel() != null)
+						for (WfDefinicaoDeDesvio odd : otd.getDefinicaoDeDesvio())
+							setAntes.add(odd);
+				}
+			}
+		}
+
+		// Utilizaremos o sincronizador para perceber apenas as diferenças entre a
+		// definição que está guardada no banco de dados e a nova versão submetida..
+		Sincronizador sinc = new Sincronizador();
+		sinc.setSetNovo(setDepois);
+		sinc.setSetAntigo(setAntes);
+		List<Item> list = sinc.getEncaixe();
+		sinc.ordenarOperacoes();
+
+		for (Item i : list) {
+			Date dt = new Date();
+			switch (i.getOperacao()) {
+			case alterar:
+				dao().gravarComHistorico((HistoricoAuditavel) i.getNovo(), (HistoricoAuditavel) i.getAntigo(), dt,
+						getIdentidadeCadastrante());
+				break;
+			case incluir:
+				dao().gravarComHistorico((HistoricoAuditavel) i.getNovo(), getIdentidadeCadastrante());
+				break;
+			case excluir:
+				((HistoricoAuditavel) i.getAntigo()).setHisDtFim(dt);
+				dao().gravarComHistorico((HistoricoAuditavel) i.getAntigo(), getIdentidadeCadastrante());
+				break;
+			}
+		}
+
+		if ("Aplicar".equals(param("submit"))) {
+			result.redirectTo("editar?id=" + pd.getId());
+			return;
+		}
+		result.use(Results.json()).from("OK");
+	}
+
+	@Transacional
+	@Get("desativar")
+	public void desativar(final Long id) throws Exception {
+		ModeloDao.iniciarTransacao();
+		assertAcesso(VERIFICADOR_ACESSO);
+		if (id == null) {
+			throw new AplicacaoException("ID não informada");
+		}
+		final WfDefinicaoDeProcedimento pd = dao().consultar(id, WfDefinicaoDeProcedimento.class, false);
+		dao().excluirComHistorico(pd, dao().consultarDataEHoraDoServidor(), getIdentidadeCadastrante());
+		ModeloDao.commitTransacao();
+
+		result.redirectTo(WfDiagramaController.class).lista();
+	}
+
+	private WfDefinicaoDeProcedimento buscar(final Long id) {
+		if (id != null) {
+			return dao().consultar(id, WfDefinicaoDeProcedimento.class, false);
+		}
+		return new WfDefinicaoDeProcedimento();
+	}
+
+	private WfDefinicaoDeProcedimento buscarAntiga(final Long idInicial) {
+		if (idInicial != null) {
+			return dao().consultarAtivoPorIdInicial(WfDefinicaoDeProcedimento.class, idInicial);
+		}
+		return null;
+	}
+
+	@Override
+	protected DaoFiltroSelecionavel createDaoFiltro() {
+		return null;
+	}
+
+	protected void jsonSuccess(final Object resp) {
+		String s = gson.toJson(resp);
+		result.use(Results.http()).addHeader("Content-Type", "application/json").body(s).setStatusCode(200);
+	}
+
+	protected void jsonError(final Exception e) throws Exception {
+		StringWriter sw = new StringWriter();
+		PrintWriter pw = new PrintWriter(sw);
+		e.printStackTrace(pw);
+		String errstack = sw.toString(); // stack trace as a string
+
+		JSONObject json = new JSONObject();
+		try {
+			json.put("errormsg", e.getMessage());
+
+			// Error Details
+			JSONArray arr = new JSONArray();
+			JSONObject detail = new JSONObject();
+			detail.put("context", context);
+			detail.put("service", "sigadocsigner");
+			detail.put("stacktrace", errstack);
+			json.put("errordetails", arr);
+		} catch (JSONException e1) {
+			throw new RuntimeException(e1);
+		}
+
+		String s = json.toString();
+		result.use(Results.http()).addHeader("Content-Type", "application/json").body(s).setStatusCode(500);
+		response.flushBuffer();
+		throw e;
+	}
+
+}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfInterceptor.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfInterceptor.java
deleted file mode 100644
index a7958a9ba3..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfInterceptor.java
+++ /dev/null
@@ -1,56 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import javax.servlet.http.HttpServletRequest;
-
-import br.com.caelum.vraptor.InterceptionException;
-import br.com.caelum.vraptor.Intercepts;
-import br.com.caelum.vraptor.core.InterceptorStack;
-import br.com.caelum.vraptor.interceptor.InstantiateInterceptor;
-import br.com.caelum.vraptor.interceptor.Interceptor;
-import br.com.caelum.vraptor.ioc.RequestScoped;
-import br.com.caelum.vraptor.resource.ResourceMethod;
-import br.gov.jfrj.siga.model.ContextoPersistencia;
-import br.gov.jfrj.siga.wf.util.WfExecutionEnvironment;
-
-@Intercepts(before = InstantiateInterceptor.class)
-@RequestScoped
-public class WfInterceptor implements Interceptor {
-
-	private HttpServletRequest request;
-
-	public WfInterceptor(HttpServletRequest request) {
-		this.request = request;
-	}
-
-	/**
-	 * Pega a sessão do JBPM e coloca-a no Hibernate.
-	 */
-	@Override
-	public void intercept(InterceptorStack stack, ResourceMethod method,
-			Object resourceInstance) throws InterceptionException {
-		WfExecutionEnvironment ee = new WfExecutionEnvironment();
-
-		try {
-			ee.antes();
-			stack.next(method, resourceInstance);
-			ee.depois();
-
-		} catch (final Exception ex) {
-			ee.excecao();
-			if (ex instanceof RuntimeException)
-				throw (RuntimeException) ex;
-			else
-				throw new InterceptionException(ex);
-		} finally {
-			ContextoPersistencia.removeUserPrincipal();
-			ee.finalmente();
-			Thread.interrupted();
-		}
-	}
-
-	@Override
-	public boolean accepts(ResourceMethod method) {
-		return true;
-	}
-
-}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/MetricaController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfRelatorioController.java
similarity index 50%
rename from sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/MetricaController.java
rename to sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfRelatorioController.java
index 3df74e5ee5..cfddfe1fea 100644
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/MetricaController.java
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfRelatorioController.java
@@ -4,75 +4,84 @@ import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
-import java.util.Set;
 
+import javax.inject.Inject;
 import javax.servlet.http.HttpServletRequest;
 
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.taskmgmt.def.Task;
-
-import br.com.caelum.vraptor.Resource;
+import br.com.caelum.vraptor.Controller;
+import br.com.caelum.vraptor.Get;
+import br.com.caelum.vraptor.Path;
 import br.com.caelum.vraptor.Result;
-import br.com.caelum.vraptor.interceptor.download.ByteArrayDownload;
-import br.com.caelum.vraptor.interceptor.download.Download;
+import br.com.caelum.vraptor.observer.download.ByteArrayDownload;
+import br.com.caelum.vraptor.observer.download.Download;
 import br.gov.jfrj.siga.vraptor.SigaIdDescr;
 import br.gov.jfrj.siga.vraptor.SigaObjects;
-import br.gov.jfrj.siga.wf.SigaWfProperties;
+import br.gov.jfrj.siga.wf.bl.Wf;
 import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeProcedimento;
 import br.gov.jfrj.siga.wf.relatorio.RelEstatisticaProcedimento;
 import br.gov.jfrj.siga.wf.relatorio.RelTempoDoc;
 import br.gov.jfrj.siga.wf.relatorio.RelTempoDocDetalhado;
+import br.gov.jfrj.siga.wf.util.WfUtil;
 
-@Resource
-public class MetricaController extends WfController {
+@Controller
+public class WfRelatorioController extends WfController {
 	private static final Long REL_ESTATISTICAS_GERAIS = 1L;
 	private static final Long REL_TEMPO_DE_DOCUMENTOS = 2L;
 	private static final Long REL_TEMPO_DE_DOCUMENTOS_DETALHADO = 3L;
-
-	public MetricaController(HttpServletRequest request, Result result,
-			WfDao dao, SigaObjects so, WfUtil util) {
-		super(request, result, dao, so, util);
-	}
+	private static final String VERIFICADOR_ACESSO = "REL:Relatórios";
 
 	/**
-	 * Este método é executado quando a action "medir.action" é chamada.
-	 * 
-	 * @return
-	 * @throws Exception
+	 * @deprecated CDI eyes only
 	 */
-	public void medir(Long orgao, String procedimento, Long pdId)
-			throws Exception {
-		assertAcesso(ACESSO_ANALISAR_METRICAS);
-
-		ProcessDefinition pd = WfDao.getInstance().getProcessDefinition(pdId);
+	public WfRelatorioController() {
+		super();
+	}
 
-		Set<Task> tarefas = WfDao.getInstance().getTodasAsTarefas(pd.getName());
+	@Inject
+	public WfRelatorioController(HttpServletRequest request, Result result, WfDao dao, SigaObjects so, WfUtil util) {
+		super(request, result, dao, so, util);
+	}
 
-		result.include("orgao", getLotaTitular().getOrgaoUsuario()
-				.getNmOrgaoUsu());
+	@Get
+	@Path("/app/rel/listar-para-gerar-relatorios")
+	public void listarParaGerarRelatorios() throws Exception {
+		assertAcesso(VERIFICADOR_ACESSO);
+		List<WfDefinicaoDeProcedimento> modelos = dao().listarAtivos(WfDefinicaoDeProcedimento.class, "nome");
+		result.include("itens", modelos);
+	}
 
-		result.include("procedimento", procedimento);
-		result.include("pdId", pdId);
-		result.include("lstGruposIni", tarefas);
-		result.include("lstGruposFim", tarefas);
-		result.include("minMediaTruncada", SigaWfProperties.getRelEstatGeraisMinMediaTrunc().toString()
-				.replace(".", ","));
-		result.include("maxMediaTruncada", SigaWfProperties.getRelEstatGeraisMaxMediaTrunc().toString()
-				.replace(".", ","));
+	@Get
+	@Path("/app/rel/medir/{sigla}")
+	public void medir(String sigla) throws Exception {
+		assertAcesso(ACESSO_RELATORIOS);
+		WfDefinicaoDeProcedimento pd = dao().consultarPorSigla(sigla, WfDefinicaoDeProcedimento.class);
+
+		result.include("orgao", getLotaTitular().getOrgaoUsuario().getNmOrgaoUsu());
+		result.include("procedimento", pd);
+		result.include("pdId", pd.getId());
+		result.include("lstGruposIni", pd.getDefinicaoDeTarefa());
+		result.include("lstGruposFim", pd.getDefinicaoDeTarefa());
+		result.include("minMediaTruncada",
+				Wf.getInstance().getProp().getRelEstatGeraisMinMediaTrunc().toString().replace(".", ","));
+		result.include("maxMediaTruncada",
+				Wf.getInstance().getProp().getRelEstatGeraisMaxMediaTrunc().toString().replace(".", ","));
 		result.include("listaTipoRelatorio", getListaTipoRelatorio());
 	}
 
 	private List<SigaIdDescr> getListaTipoRelatorio() {
 		ArrayList<SigaIdDescr> lista = new ArrayList<SigaIdDescr>();
-		
+
 		lista.add(new SigaIdDescr(1, "Estatísticas gerais"));
 		lista.add(new SigaIdDescr(2, "Tempo de documentos"));
 		lista.add(new SigaIdDescr(3, "Tempo de documentos detalhado"));
 		return lista;
 	}
 
-	public Download relatorio(Long pdId, Long grpIni, Long grpFim,
-			String incluirAbertos) throws Exception {
+	@Get
+	@Path("/app/rel/relatorio")
+	public Download relatorio(Long pdId, Integer grpIni, Integer grpFim, String incluirAbertos) throws Exception {
+		WfDefinicaoDeProcedimento pd = WfDefinicaoDeProcedimento.AR.findById(pdId);
 		Map<String, Object> parametrosRelatorio = new HashMap<String, Object>();
 
 		for (Object o : getRequest().getParameterMap().keySet()) {
@@ -80,17 +89,13 @@ public class MetricaController extends WfController {
 			String v = (String) getRequest().getParameter(k);
 			parametrosRelatorio.put(k, v);
 		}
-
-		parametrosRelatorio.put("secaoUsuario", getLotaTitular()
-				.getOrgaoUsuario().getNmOrgaoUsu());
-		parametrosRelatorio.put("nomeProcedimento", WfDao.getInstance()
-				.getProcessDefinition(pdId).getName());
-		parametrosRelatorio.put("incluirAbertos",
-				incluirAbertos == null ? false : incluirAbertos);
+		parametrosRelatorio.put("secaoUsuario", getLotaTitular().getOrgaoUsuario().getNmOrgaoUsu());
+		parametrosRelatorio.put("nomeProcedimento", pd.getNome());
+		parametrosRelatorio.put("incluirAbertos", incluirAbertos == null ? false : incluirAbertos);
 		parametrosRelatorio.put("inicioGrupo",
-				(grpIni == null || grpIni < 0) ? null : getNomeGrupo(grpIni));
+				(grpIni == null || grpIni < 0) ? null : pd.getDefinicaoDeTarefa().get(grpIni).getNome());
 		parametrosRelatorio.put("fimGrupo",
-				(grpFim == null || grpFim < 0) ? null : getNomeGrupo(grpFim));
+				(grpFim == null || grpFim < 0) ? null : pd.getDefinicaoDeTarefa().get(grpFim).getNome());
 
 		byte[] buff = null;
 		if (getRelatorioEscolhido().equals(REL_ESTATISTICAS_GERAIS)) {
@@ -103,20 +108,7 @@ public class MetricaController extends WfController {
 			buff = gerarRelTempoDocDetalhado(parametrosRelatorio);
 		}
 
-		return new ByteArrayDownload(buff, "application/pdf", "relatorio.pdf",
-				false);
-	}
-
-	/**
-	 * Método utilizado para
-	 * 
-	 * @param idGrupo
-	 * @return
-	 */
-	private String getNomeGrupo(Long idGrupo) {
-		Task t = WfDao.getInstance().consultar(idGrupo, Task.class, false);
-		return t.getName();
-
+		return new ByteArrayDownload(buff, "application/pdf", "relatorio.pdf", false);
 	}
 
 	private Long getRelatorioEscolhido() {
@@ -124,19 +116,16 @@ public class MetricaController extends WfController {
 	}
 
 	/**
-	 * Cria um relatório estatístico de um determinado procedimento. Este método
-	 * é executado quando a action "emiteRelEstatisticaProcedimento.action" é
-	 * chamada.
+	 * Cria um relatório estatístico de um determinado procedimento. Este método é
+	 * executado quando a action "emiteRelEstatisticaProcedimento.action" é chamada.
 	 * 
 	 * @return
 	 * @throws Exception
 	 * @throws Exception
 	 */
-	private byte[] gerarRelTempoDocDetalhado(
-			Map<String, Object> parametrosRelatorio) throws Exception {
+	private byte[] gerarRelTempoDocDetalhado(Map<String, Object> parametrosRelatorio) throws Exception {
 		try {
-			RelTempoDocDetalhado rel = new RelTempoDocDetalhado(
-					parametrosRelatorio);
+			RelTempoDocDetalhado rel = new RelTempoDocDetalhado(parametrosRelatorio);
 			rel.gerar();
 
 			return rel.getRelatorioPDF();
@@ -147,19 +136,16 @@ public class MetricaController extends WfController {
 	}
 
 	/**
-	 * Cria um relatório estatístico de um determinado procedimento. Este método
-	 * é executado quando a action "emiteRelEstatisticaProcedimento.action" é
-	 * chamada.
+	 * Cria um relatório estatístico de um determinado procedimento. Este método é
+	 * executado quando a action "emiteRelEstatisticaProcedimento.action" é chamada.
 	 * 
 	 * @return
 	 * @throws Exception
 	 */
-	private byte[] gerarRelEstGeral(Map<String, Object> parametrosRelatorio)
-			throws Exception {
+	private byte[] gerarRelEstGeral(Map<String, Object> parametrosRelatorio) throws Exception {
 		try {
 
-			RelEstatisticaProcedimento rel = new RelEstatisticaProcedimento(
-					parametrosRelatorio);
+			RelEstatisticaProcedimento rel = new RelEstatisticaProcedimento(parametrosRelatorio);
 			rel.gerar();
 
 			return rel.getRelatorioPDF();
@@ -170,15 +156,13 @@ public class MetricaController extends WfController {
 	}
 
 	/**
-	 * Cria um relatório estatístico de um determinado procedimento. Este método
-	 * é executado quando a action "emiteRelEstatisticaProcedimento.action" é
-	 * chamada.
+	 * Cria um relatório estatístico de um determinado procedimento. Este método é
+	 * executado quando a action "emiteRelEstatisticaProcedimento.action" é chamada.
 	 * 
 	 * @return
 	 * @throws Exception
 	 */
-	private byte[] gerarRelTempoDoc(Map<String, Object> parametrosRelatorio)
-			throws Exception {
+	private byte[] gerarRelTempoDoc(Map<String, Object> parametrosRelatorio) throws Exception {
 		try {
 			RelTempoDoc rel = new RelTempoDoc(parametrosRelatorio);
 			rel.gerar();
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfResponsavelController.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfResponsavelController.java
new file mode 100644
index 0000000000..ba0f1c30a5
--- /dev/null
+++ b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfResponsavelController.java
@@ -0,0 +1,269 @@
+/*******************************************************************************
+ * Copyright (c) 2006 - 2011 SJRJ.
+ * 
+ *     This file is part of SIGA.
+ * 
+ *     SIGA is free software: you can redistribute it and/or modify
+ *     it under the terms of the GNU General Public License as published by
+ *     the Free Software Foundation, either version 3 of the License, or
+ *     (at your option) any later version.
+ * 
+ *     SIGA is distributed in the hope that it will be useful,
+ *     but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *     GNU General Public License for more details.
+ * 
+ *     You should have received a copy of the GNU General Public License
+ *     along with SIGA.  If not, see <http://www.gnu.org/licenses/>.
+ ******************************************************************************/
+package br.gov.jfrj.siga.wf.vraptor;
+
+import java.io.UnsupportedEncodingException;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.SortedSet;
+import java.util.TreeSet;
+
+import javax.inject.Inject;
+import javax.servlet.http.HttpServletRequest;
+
+import org.jboss.logging.Logger;
+
+import br.com.caelum.vraptor.Controller;
+import br.com.caelum.vraptor.Get;
+import br.com.caelum.vraptor.Path;
+import br.com.caelum.vraptor.Post;
+import br.com.caelum.vraptor.Result;
+import br.com.caelum.vraptor.view.Results;
+import br.gov.jfrj.siga.base.AplicacaoException;
+import br.gov.jfrj.siga.cp.model.HistoricoAuditavel;
+import br.gov.jfrj.siga.dp.CpOrgaoUsuario;
+import br.gov.jfrj.siga.dp.DpLotacao;
+import br.gov.jfrj.siga.dp.DpPessoa;
+import br.gov.jfrj.siga.sinc.lib.Sincronizador;
+import br.gov.jfrj.siga.sinc.lib.Sincronizavel;
+import br.gov.jfrj.siga.vraptor.SigaObjects;
+import br.gov.jfrj.siga.vraptor.Transacional;
+import br.gov.jfrj.siga.wf.dao.WfDao;
+import br.gov.jfrj.siga.wf.model.WfDefinicaoDeResponsavel;
+import br.gov.jfrj.siga.wf.model.WfResponsavel;
+import br.gov.jfrj.siga.wf.util.WfUtil;
+
+@Controller
+@Path("app/responsavel")
+public class WfResponsavelController extends WfController {
+	private static final String VERIFICADOR_ACESSO = "FE;DEFR:Gerenciar Responsáveis";
+	private static final Logger LOGGER = Logger.getLogger(WfResponsavelController.class);
+
+	public static class Item {
+		private Long orgaoId;
+		private String orgaoSigla;
+		private DpLotacao lotacao;
+		private DpPessoa pessoa;
+
+		public Long getOrgaoId() {
+			return orgaoId;
+		}
+
+		public void setOrgaoId(Long orgaoId) {
+			this.orgaoId = orgaoId;
+		}
+
+		public String getOrgaoSigla() {
+			return orgaoSigla;
+		}
+
+		public void setOrgaoSigla(String orgaoSigla) {
+			this.orgaoSigla = orgaoSigla;
+		}
+
+		public DpLotacao getLotacao() {
+			return lotacao;
+		}
+
+		public void setLotacao(DpLotacao lotacao) {
+			this.lotacao = lotacao;
+		}
+
+		public DpPessoa getPessoa() {
+			return pessoa;
+		}
+
+		public void setPessoa(DpPessoa pessoa) {
+			this.pessoa = pessoa;
+		}
+	}
+
+	/**
+	 * @deprecated CDI eyes only
+	 */
+	public WfResponsavelController() {
+		super();
+	}
+
+	/**
+	 * Inicializa os tipos de responsáveis e suas respectivas expressões, quando
+	 * houver.
+	 */
+	@Inject
+	public WfResponsavelController(HttpServletRequest request, Result result, WfDao dao, SigaObjects so, WfUtil util) {
+		super(request, result, dao, so, util);
+	}
+
+	@Get("listar")
+	public void lista() throws Exception {
+		try {
+			assertAcesso(VERIFICADOR_ACESSO);
+			List<WfDefinicaoDeResponsavel> modelos = dao().listarAtivos(WfDefinicaoDeResponsavel.class, "nome");
+			result.include("itens", modelos);
+		} catch (AplicacaoException e) {
+			throw new AplicacaoException(e.getMessage(), 0, e);
+		} catch (Exception ex) {
+			LOGGER.error(ex.getMessage(), ex);
+			throw new AplicacaoException(ex.getMessage(), 0, ex);
+		}
+	}
+
+	@Get("carregar")
+	public void carregar() throws Exception {
+		try {
+			assertAcesso(VERIFICADOR_ACESSO);
+			List<WfDefinicaoDeResponsavel> list = dao().listarAtivos(WfDefinicaoDeResponsavel.class, "nome");
+			result.use(Results.json()).from(list, "list").serialize();
+		} catch (AplicacaoException e) {
+			throw new AplicacaoException(e.getMessage(), 0, e);
+		} catch (Exception ex) {
+			LOGGER.error(ex.getMessage(), ex);
+			throw new AplicacaoException(ex.getMessage(), 0, ex);
+		}
+	}
+
+	@Get("editar/{id}")
+	public void edita(final Long id) throws UnsupportedEncodingException {
+		assertAcesso(VERIFICADOR_ACESSO);
+
+		WfDefinicaoDeResponsavel dr = new WfDefinicaoDeResponsavel();
+		List<Item> l = new ArrayList<>();
+
+		if (id == null) {
+			result.include("dr", dr);
+			result.include("itens", l);
+			return;
+		}
+
+		dr = dao().consultar(id, WfDefinicaoDeResponsavel.class, false);
+		result.include("dr", dr);
+
+		Map<Long, WfResponsavel> map = mapaDeResponsaveis(dr);
+
+		for (CpOrgaoUsuario o : dao().consultaCpOrgaoUsuario()) {
+			Item i = new Item();
+			i.orgaoId = o.getId();
+			i.orgaoSigla = o.getSigla();
+			if (map.containsKey(o.getId())) {
+				WfResponsavel r = map.get(o.getId());
+				i.pessoa = r.getPessoa();
+				i.lotacao = r.getLotacao();
+			}
+			l.add(i);
+		}
+		result.include("dr", dr);
+		result.include("itens", l);
+	}
+
+	@Get("novo")
+	public void novo() throws UnsupportedEncodingException {
+		result.forwardTo(this).edita(null);
+	}
+
+	private Map<Long, WfResponsavel> mapaDeResponsaveis(WfDefinicaoDeResponsavel dr) {
+		Map<Long, WfResponsavel> map = new HashMap<>();
+		List<WfResponsavel> resps = dao().consultarResponsaveisPorDefinicaoDeResponsavel(dr);
+		if (resps != null)
+			for (WfResponsavel r : resps)
+				map.put(r.getOrgaoUsuario().getId(), r);
+		return map;
+	}
+
+	@Transacional
+	@Post("gravar")
+	public void gravar(final Long id, final String nome, final String descr, List<Item> itens)
+			throws Exception {
+		assertAcesso(VERIFICADOR_ACESSO);
+		Date dt = dao().consultarDataEHoraDoServidor();
+
+		if (id == null) {
+			WfDefinicaoDeResponsavel dr = new WfDefinicaoDeResponsavel();
+			dr.setNome(nome);
+			dr.setDescr(descr);
+			dr.setHisDtIni(dt);
+			dao().gravarComHistorico(dr, getIdentidadeCadastrante());
+			result.redirectTo(this).edita(dr.getId());
+			return;
+		}
+		WfDefinicaoDeResponsavel dr = dao().consultar(id, WfDefinicaoDeResponsavel.class, false);
+		dr = dao().consultarAtivoPorIdInicial(WfDefinicaoDeResponsavel.class, dr.getHisIdIni());
+
+		WfDefinicaoDeResponsavel drNovo = new WfDefinicaoDeResponsavel();
+		drNovo.setNome(nome);
+		drNovo.setDescr(descr);
+		drNovo.setHisIdIni(dr.getHisIdIni());
+		dr = (WfDefinicaoDeResponsavel) dao().gravarComHistorico(drNovo, dr, dt, getIdentidadeCadastrante());
+
+		// Utilizaremos o sincronizador para perceber apenas as diferenças entre a
+		// definição que está guardada no banco de dados e a nova versão submetida..
+		Sincronizador sinc = new Sincronizador();
+		SortedSet<Sincronizavel> setDepois = new TreeSet<>();
+		SortedSet<Sincronizavel> setAntes = new TreeSet<>();
+
+		List<WfResponsavel> resps = dao().consultarResponsaveisPorDefinicaoDeResponsavel(dr);
+		if (resps != null)
+			setAntes.addAll(resps);
+		if (itens != null) {
+			for (Item i : itens) {
+				if (i.pessoa != null && i.pessoa.getId() == null)
+					i.pessoa = null;
+				else
+					i.pessoa = dao().carregarPorId(i.pessoa);
+				if (i.lotacao != null && i.lotacao.getId() == null)
+					i.lotacao = null;
+				else
+					i.lotacao = dao().carregarPorId(i.lotacao);
+				if (i.pessoa == null && i.lotacao == null)
+					continue;
+				WfResponsavel r = new WfResponsavel(i.pessoa, i.lotacao);
+				r.setOrgaoUsuario(dao().consultar(i.orgaoId, CpOrgaoUsuario.class, false));
+				r.setDefinicaoDeResponsavel(dao().consultar(dr.getIdInicial(), dr.getClass(), false));
+				r.setIdExterna(r.criarIdExterna());
+				setDepois.add(r);
+			}
+		}
+
+		sinc.setSetNovo(setDepois);
+		sinc.setSetAntigo(setAntes);
+		List<br.gov.jfrj.siga.sinc.lib.Item> list = sinc.getEncaixe();
+
+		for (br.gov.jfrj.siga.sinc.lib.Item i : list) {
+			switch (i.getOperacao()) {
+			case alterar:
+				i.getNovo().setIdInicial(i.getAntigo().getIdInicial());
+				dao().gravarComHistorico((HistoricoAuditavel) i.getNovo(), (HistoricoAuditavel) i.getAntigo(), dt,
+						getIdentidadeCadastrante());
+				break;
+			case incluir:
+				i.getNovo().setDataInicio(dt);
+				dao().gravarComHistorico((HistoricoAuditavel) i.getNovo(), getIdentidadeCadastrante());
+				break;
+			case excluir:
+				((HistoricoAuditavel) i.getAntigo()).setHisDtFim(dt);
+				dao().gravarComHistorico((HistoricoAuditavel) i.getAntigo(), getIdentidadeCadastrante());
+				break;
+			}
+		}
+
+		result.redirectTo(this).lista();
+	}
+}
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfSessionCreator.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfSessionCreator.java
deleted file mode 100644
index 7f4b8eabe2..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfSessionCreator.java
+++ /dev/null
@@ -1,38 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import javax.annotation.PostConstruct;
-import javax.annotation.PreDestroy;
-
-import org.hibernate.Session;
-import org.hibernate.SessionFactory;
-
-import br.com.caelum.vraptor.ioc.Component;
-import br.com.caelum.vraptor.ioc.ComponentFactory;
-import br.com.caelum.vraptor.ioc.RequestScoped;
-
-//@Component
-//@RequestScoped
-public class WfSessionCreator implements ComponentFactory<Session> {
-
-	private final SessionFactory factory;
-	private Session session;
-
-	public WfSessionCreator(SessionFactory factory) {
-		this.factory = factory;
-	}
-
-	@PostConstruct
-	public void create() {
-		//this.session = factory.openSession();
-	}
-
-	public Session getInstance() {
-		return session;
-	}
-
-	@PreDestroy
-	public void destroy() {
-		//this.session.close();
-	}
-
-}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfSessionFactoryCreator.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfSessionFactoryCreator.java
deleted file mode 100644
index bd23ccd7da..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfSessionFactoryCreator.java
+++ /dev/null
@@ -1,95 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import javax.annotation.PostConstruct;
-import javax.annotation.PreDestroy;
-
-import org.hibernate.SessionFactory;
-import org.hibernate.cfg.Configuration;
-
-import br.com.caelum.vraptor.ioc.ComponentFactory;
-import br.gov.jfrj.siga.base.SigaBaseProperties;
-import br.gov.jfrj.siga.wf.bl.Wf;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfHibernateUtil;
-
-//@Component
-//@ApplicationScoped
-public class WfSessionFactoryCreator implements
-		ComponentFactory<SessionFactory> {
-
-	private SessionFactory sessionFactory = null;
-	private Configuration conf = null;
-
-	public void configurarHibernate(Configuration cfg,
-			String hibernateConnectionUrl, Class<?>... classesAnotadas) {
-		try {
-
-			for (Class<?> clazz : classesAnotadas) {
-				cfg.addAnnotatedClass(clazz);
-			}
-
-			// bruno.lacerda@avantiprima.com.br
-			// configurarHibernateParaDebug(cfg);
-
-			// cfg.configure();
-			this.conf = cfg;
-			this.sessionFactory = this.conf.buildSessionFactory();
-
-		} catch (final Throwable ex) {
-			throw new ExceptionInInitializerError(ex);
-		}
-	}
-
-	private static void configurarHibernateParaDebug(Configuration cfg) {
-		boolean isDebugHibernateHabilitado = SigaBaseProperties
-				.getBooleanValue("configura.hibernate.para.debug");
-		if (isDebugHibernateHabilitado) {
-			// ModeloDao.configurarHibernateParaDebug(cfg);
-		}
-	}
-
-	private void registerTransactionClasses(Configuration cfg) {
-		// bruno.lacerda@avantiprima.com.br
-		this.registerTransactionClass("hibernate.transaction.factory_class",
-				cfg);
-		this.registerTransactionClass(
-				"hibernate.transaction.manager_lookup_class", cfg);
-	}
-
-	private void registerTransactionClass(String propertyName, Configuration cfg) {
-		String transactionFactoryClassName = System.getProperty(propertyName);
-		if (transactionFactoryClassName != null
-				&& transactionFactoryClassName.trim().length() > 0) {
-			cfg.setProperty(propertyName, transactionFactoryClassName);
-		}
-	}
-
-	public WfSessionFactoryCreator() {
-		super();
-	}
-
-	@PostConstruct
-	public void create() throws ExceptionInInitializerError {
-		try {
-			Wf.getInstance();
-			Configuration cfg = WfDao
-					.criarHibernateCfg("java:/jboss/datasources/SigaWfDS");
-
-			registerTransactionClasses(cfg);
-
-			WfHibernateUtil.configurarHibernate(cfg);
-		} catch (final Throwable ex) {
-			throw new ExceptionInInitializerError(ex);
-		}
-	}
-
-	public SessionFactory getInstance() {
-		return sessionFactory;
-	}
-
-	@PreDestroy
-	public void destroy() {
-		this.sessionFactory.close();
-	}
-
-}
\ No newline at end of file
diff --git a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfUtil.java b/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfUtil.java
deleted file mode 100644
index 0596e099a0..0000000000
--- a/sigawf/src/main/java/br/gov/jfrj/siga/wf/vraptor/WfUtil.java
+++ /dev/null
@@ -1,385 +0,0 @@
-package br.gov.jfrj.siga.wf.vraptor;
-
-import java.io.UnsupportedEncodingException;
-import java.lang.reflect.InvocationTargetException;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-import java.util.TreeMap;
-
-import org.jbpm.context.def.VariableAccess;
-import org.jbpm.graph.def.ProcessDefinition;
-import org.jbpm.graph.exe.ExecutionContext;
-import org.jbpm.graph.exe.ProcessInstance;
-import org.jbpm.graph.exe.Token;
-import org.jbpm.graph.node.TaskNode;
-import org.jbpm.taskmgmt.def.Task;
-import org.jbpm.taskmgmt.exe.PooledActor;
-import org.jbpm.taskmgmt.exe.SwimlaneInstance;
-import org.jbpm.taskmgmt.exe.TaskInstance;
-
-import br.com.caelum.vraptor.ioc.Component;
-import br.gov.jfrj.siga.Service;
-import br.gov.jfrj.siga.base.AplicacaoException;
-import br.gov.jfrj.siga.dp.DpLotacao;
-import br.gov.jfrj.siga.dp.DpPessoa;
-import br.gov.jfrj.siga.dp.dao.DpLotacaoDaoFiltro;
-import br.gov.jfrj.siga.dp.dao.DpPessoaDaoFiltro;
-import br.gov.jfrj.siga.ex.service.ExService;
-import br.gov.jfrj.siga.vraptor.SigaObjects;
-import br.gov.jfrj.siga.wf.dao.WfDao;
-import br.gov.jfrj.siga.wf.util.WfAssignmentHandler;
-import br.gov.jfrj.siga.wf.util.WfGraphFactory;
-import br.gov.jfrj.siga.wf.util.WfTaskVO;
-
-@Component
-public class WfUtil {
-	protected Map<String, String> mapDescricao = new TreeMap<String, String>();
-
-	private SigaObjects so;
-
-	public WfUtil(SigaObjects so) {
-		super();
-		this.so = so;
-	}
-
-	/**
-	 * Retorna a sigla do ator a quem estï¿½ atribuida a tarefa, ou a sigla da
-	 * lotaï¿½ï¿½o se a tarefa estiver no pool. Se a tarefa estiver com o titular,
-	 * retorna "(minha)"
-	 * 
-	 * 
-	 * @param ti
-	 * @return
-	 */
-	private String getAtendente(TaskInstance ti) {
-		if (ti.getActorId() != null) {
-			if (ti.getActorId().equals(so.getTitular().getSigla()))
-				return "(minha)";
-			else
-				return ti.getActorId();
-		}
-		if (ti.getPooledActors().size() == 0)
-			return "";
-		String s = ((PooledActor) ti.getPooledActors().toArray()[0])
-				.getActorId();
-		if (s.startsWith(so.getLotaTitular().getOrgaoUsuario().getSigla()))
-			s = s.substring(so.getLotaTitular().getOrgaoUsuario().getSigla()
-					.length());
-		return s;
-	}
-
-	public String getDescricao(String sigla) {
-		if (mapDescricao.containsKey(sigla)) {
-			return mapDescricao.get(sigla);
-		}
-
-		DpLotacao lot = so.daoLot(so.getLotaTitular().getOrgaoUsuario()
-				.getSigla()
-				+ sigla);
-		if (lot != null) {
-			mapDescricao.put(sigla, lot.getDescricao());
-			return lot.getDescricao();
-		}
-
-		DpPessoa pes = so.daoPes(sigla);
-		if (pes != null) {
-			mapDescricao.put(sigla, pes.getDescricao());
-			return pes.getDescricao();
-		}
-		
-		return "";
-	}
-
-	/**
-	 * Retorna a sigla do primeiro ator que faï¿½a parte do pool de atores na task
-	 * instance.
-	 * 
-	 * @param ti
-	 * @return
-	 */
-	public String getPooledActors(TaskInstance ti) {
-		if (ti.getActorId() != null)
-			return ti.getActorId();
-		if (ti.getPooledActors().size() == 0)
-			return "";
-		String s = ((PooledActor) ti.getPooledActors().toArray()[0])
-				.getActorId();
-		if (s.startsWith(so.getLotaTitular().getOrgaoUsuario().getSigla()))
-			s = s.substring(so.getLotaTitular().getOrgaoUsuario().getSigla()
-					.length());
-		return s;
-	}
-
-	/**
-	 * Inicializa a variï¿½vel "task" para que seus atributos possam ser
-	 * visualizados pelas actions.
-	 * 
-	 * @throws IllegalAccessException
-	 * @throws InvocationTargetException
-	 * @throws Exception
-	 * @throws AplicacaoException
-	 */
-	public WfTaskVO inicializarTaskVO(TaskInstance taskInstance)
-			throws IllegalAccessException, InvocationTargetException,
-			Exception, AplicacaoException {
-		WfTaskVO task = new WfTaskVO(taskInstance, so.getTitular(),
-				so.getLotaTitular());
-		task.setConhecimentoEditavel(so.getTitular().getSigla()
-				.equals(taskInstance.getActorId()));
-		return task;
-	}
-
-	private String designacao(String actorId, Set pooledActors) {
-		if (actorId == null && pooledActors == null)
-			return null;
-		if (pooledActors == null || pooledActors.size() == 0)
-			return actorId;
-		String pa = "";
-		for (Object a : pooledActors) {
-			if (pa.length() > 0)
-				pa += "/";
-			if (a instanceof PooledActor)
-				pa += ((PooledActor) a).getActorId();
-		}
-
-		if (actorId == null)
-			return pa;
-
-		return actorId + " - " + pa;
-	}
-
-	public String getDot(TaskInstance taskInstance)
-			throws UnsupportedEncodingException, Exception {
-		ProcessInstance pi = taskInstance.getProcessInstance();
-		ProcessDefinition pd = pi.getProcessDefinition();
-		byte ab[] = pd.getFileDefinition().getBytes("processdefinition.xml");
-		String sXML = new String(ab, "UTF-8");
-
-		WfGraphFactory graph = new WfGraphFactory();
-
-		// Build a delegation map
-		Map<String, String> map = new HashMap<String, String>();
-		// for (TaskInstance ti : ((Collection<TaskInstance>) pi
-		// .getTaskMgmtInstance().getTaskInstances())) {
-		// if (ti.getSwimlaneInstance() != null)
-		// map.put(ti.getTask().getParent().getName(),
-		// designacao(ti.getSwimlaneInstance().getActorId(), ti
-		// .getSwimlaneInstance().getPooledActors()));
-		// else if (ti.getTask().getSwimlane() == null) {
-		// map.put(ti.getTask().getParent().getName(),
-		// designacao(ti.getActorId(), ti.getPooledActors()));
-		// }
-		// }
-
-		WfAssignmentHandler ah = new WfAssignmentHandler();
-		ExecutionContext ctx = new ExecutionContext(taskInstance.getToken());
-		for (Task t : ((Collection<Task>) pd.getTaskMgmtDefinition().getTasks()
-				.values())) {
-			String designacao = null;
-			TaskNode taskNode = t.getTaskNode();
-			if (t.getSwimlane() != null) {
-				{
-					SwimlaneInstance si;
-					si = taskInstance.getTaskMgmtInstance()
-							.getSwimlaneInstance(t.getSwimlane().getName());
-					if (si != null)
-						designacao = designacao(si.getActorId(),
-								si.getPooledActors());
-					if (designacao != null) {
-						if (taskNode != null)
-							map.put(taskNode.getName(), designacao);
-					} else {
-						si = new SwimlaneInstance(t.getSwimlane());
-						si.setTaskMgmtInstance(taskInstance
-								.getTaskMgmtInstance());
-						try {
-							ctx.setTaskInstance(taskInstance);
-							ah.assign(si, ctx);
-							designacao = designacao(si.getActorId(),
-									si.getPooledActors());
-							if (taskNode != null)
-								map.put(taskNode.getName(), designacao);
-						} catch (AplicacaoException e) {
-
-						}
-					}
-				}
-			} else {
-				TaskInstance ti = new TaskInstance();
-				ti.setTask(t);
-				ti.setTaskMgmtInstance(taskInstance.getTaskMgmtInstance());
-				try {
-					ctx.setTaskInstance(ti);
-					ah.assign(ti, ctx);
-					designacao = designacao(ti.getActorId(),
-							ti.getPooledActors());
-					map.put(taskNode.getName(), designacao);
-				} catch (AplicacaoException e) {
-
-				}
-			}
-		}
-
-		String dot;
-
-		dot = graph.gerarDOT(sXML,
-				taskInstance.getTask().getParent().getName(), map);
-
-		dot = dot.replace("\n", " ");
-		dot = dot.replace("\r", " ");
-
-		return dot;
-	}
-
-	public static void transferirDocumentosVinculados(ProcessInstance pi,
-			String siglaTitular) throws Exception {
-		ExService service = Service.getExService();
-		
-		ArrayList<Token> tokens = new ArrayList<Token>();
-		pi.getRootToken().collectChildrenRecursively(tokens);
-		tokens.add(pi.getRootToken());
-		
-		ArrayList<TaskInstance> tis = new ArrayList<TaskInstance>();
-		for (Token t : tokens) {
-			tis.addAll((Collection<TaskInstance>) (pi
-				.getTaskMgmtInstance().getSignallingTasks(new ExecutionContext(t))));
-		}
-
-		for (TaskInstance ti : tis) {
-			if (ti.getTask().getTaskController() != null) {
-				List<VariableAccess> variableAccesses = (List<VariableAccess>) ti
-						.getTask().getTaskController().getVariableAccesses();
-				for (VariableAccess variable : variableAccesses) {
-					if (variable.getMappedName().startsWith("doc_")
-							&& variable.isReadable() && !variable.isWritable() && !variable.getAccess().toString().contains(WfTaskVO.DISABLE_DOC_FORWARD)) {
-						String value = (String) ti.getToken()
-								.getProcessInstance().getContextInstance()
-								.getVariable(variable.getMappedName());
-						if (value != null && value.trim().length() == 0)
-							value = null;
-						String destino = ti.getActorId();
-						
-						if (destino != null){
-							DpPessoaDaoFiltro flt = new DpPessoaDaoFiltro();
-							flt.setSigla(destino);
-							DpPessoa ator = (DpPessoa) WfDao.getInstance()
-									.consultarPorSigla(flt);
-							if (!atorDeveReexecutarTarefa(ator,ti)){
-								destino = null;
-							}
-						}
-						
-						if (destino == null && ti.getPooledActors() != null){
-							for (PooledActor lot : (Collection<PooledActor>) ti
-									.getPooledActors()) {
-								destino = "@" + lot.getActorId();
-								break;
-							}
-						}
-						if (value != null && destino != null)
-							service.transferir(value, destino, siglaTitular, true);
-					}
-				}
-			}
-		}
-	}
-	
-	private static boolean atorDeveReexecutarTarefa(DpPessoa ator, TaskInstance ti) {
-		if (ti.getPooledActors()!=null && ti.getPooledActors().size() == 1) {
-			DpLotacaoDaoFiltro lotflt = new DpLotacaoDaoFiltro();
-			lotflt.setSiglaCompleta(((PooledActor) ti.getPooledActors().toArray()[0]).getActorId());
-			DpLotacao lotacao = (DpLotacao) WfDao.getInstance().consultarPorSigla(lotflt);
-			return !ator.isFechada() && ator.getLotacao().equivale(lotacao);
-		} else {
-			return false;
-		}
-	}
-
-	public void assertPodeTransferirDocumentosVinculados(TaskInstance ti,
-			String siglaTitular) throws Exception {
-		ExService service = Service.getExService();
-
-		if (ti.getTask().getTaskController() != null) {
-			List<VariableAccess> variableAccesses = (List<VariableAccess>) ti
-					.getTask().getTaskController().getVariableAccesses();
-			for (VariableAccess variable : variableAccesses) {
-				if (variable.getMappedName().startsWith("doc_")
-						&& variable.isReadable()
-						&& !variable.isWritable()
-						&& !variable.getAccess().toString()
-								.contains(WfTaskVO.DISABLE_DOC_FORWARD)) {
-					String value = (String) ti.getToken().getProcessInstance()
-							.getContextInstance()
-							.getVariable(variable.getMappedName());
-					if (value != null && value.trim().length() != 0)
-						if (!service.podeTransferir(value, siglaTitular, false)) {
-							throw new AplicacaoException(
-									"A tarefa nï¿½o pode prosseguir porque o documento '"
-											+ value
-											+ "' nï¿½o pode ser transferido. Por favor, verifique se o documento estï¿½ em sua lotaï¿½ï¿½o e se estï¿½ 'Aguardando andamento'.");
-						}
-				}
-			}
-		}
-	}
-
-	public boolean assertLotacaoAscendenteOuDescendente(DpLotacao lotAtual,
-			DpLotacao lotFutura) throws AplicacaoException {
-		if (lotAtual.getIdInicial().equals(lotFutura.getIdInicial()))
-			return true;
-
-		// Linha ascendente
-		DpLotacao lot = lotAtual;
-		while (lot.getLotacaoPai() != null) {
-			lot = lot.getLotacaoPai();
-			if (lot.getIdInicial().equals(lotFutura.getIdInicial()))
-				return true;
-		}
-
-		// Descendente direta
-		lot = lotFutura;
-		while (lot.getLotacaoPai() != null) {
-			lot = lot.getLotacaoPai();
-			if (lot.getIdInicial().equals(lotAtual.getIdInicial()))
-				return true;
-		}
-
-		throw new AplicacaoException(
-				"A designaï¿½ï¿½o de '"
-						+ lotAtual.getSigla()
-						+ "' para '"
-						+ lotFutura.getSigla()
-						+ "' nï¿½o ï¿½ permitida pois sï¿½ sï¿½o aceitas lotaï¿½ï¿½es ascendentes seguindo a linha do organograma ou descendentes diretas.");
-	}
-
-	public String getSiglaTitular() {
-		return so.getTitular().getSigla() + "@"
-				+ so.getLotaTitular().getSiglaCompleta();
-	}
-
-	/**
-	 * Monta o objeto WfTaskVO (view object, que serï¿½ usado na interface do
-	 * usuï¿½rio).
-	 * 
-	 * @param taskInstance
-	 * @param variableAccesses
-	 * @param siglaDoc
-	 * @throws Exception
-	 */
-	public void addTask(Map<String, List<WfTaskVO>> mobilMap,
-			TaskInstance taskInstance, String siglaDoc, String sigla)
-			throws Exception {
-		WfTaskVO task = new WfTaskVO(taskInstance, sigla, so.getTitular(),
-				so.getLotaTitular());
-		if (!mobilMap.containsKey(siglaDoc)) {
-			mobilMap.put(siglaDoc, new ArrayList<WfTaskVO>());
-		}
-		List<WfTaskVO> tasks = mobilMap.get(siglaDoc);
-		tasks.add(task);
-	}
-
-}
diff --git a/sigawf/src/main/webapp/META-INF/jboss-deployment-structure.xml b/sigawf/src/main/webapp/META-INF/jboss-deployment-structure.xml
index 1de0a6a2b3..ee0aa53220 100644
--- a/sigawf/src/main/webapp/META-INF/jboss-deployment-structure.xml
+++ b/sigawf/src/main/webapp/META-INF/jboss-deployment-structure.xml
@@ -3,7 +3,7 @@
 	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
 	<deployment>
 
-		<module-alias name="sigawf" />
+		<module-alias name="deployment.sigawf" />
 
 		<dependencies>
 			<module name="org.picketlink" />
@@ -14,8 +14,6 @@
             <module name="org.apache.commons.logging" />
             <module name="org.apache.xalan" />
             <module name="asm.asm" />
-
-			<module name="sigadoc.org.bouncycastle" export="true"/>
 		</dependencies>
 	</deployment>
 </jboss-deployment-structure>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/jboss-web.xml b/sigawf/src/main/webapp/WEB-INF/jboss-web.xml
deleted file mode 100644
index a9f9aa6912..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/jboss-web.xml
+++ /dev/null
@@ -1,17 +0,0 @@
-<jboss-web>
-	<security-domain>sp</security-domain>
-	<context-root>sigawf</context-root>
-	<valve>
-		<class-name>org.picketlink.identity.federation.bindings.tomcat.sp.ServiceProviderAuthenticator
-		</class-name>
-		<param>
-			<param-name>characterEncoding</param-name>
-			<param-value>UTF-8</param-value>
-		</param>
-		<param>
-			<param-name>disableProxyCaching</param-name>
-			<param-value>false</param-value>
-		</param>
-	</valve>
-</jboss-web>
-
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/doc.jsp b/sigawf/src/main/webapp/WEB-INF/page/app/doc.jsp
deleted file mode 100644
index 2043017ffe..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/page/app/doc.jsp
+++ /dev/null
@@ -1,30 +0,0 @@
-<%@ include file="/WEB-INF/page/include.jsp"%>
-
-<c:if test="${mobilMap.size() == 0}"><!-- Siga-Wf consultado com sucesso, mas nenhum fluxo do associado a este documento. --></c:if>
-<c:forEach var="item" items="${mobilMap}">
-	<!--ajax:${item.key}-->
-	<c:forEach var="t" items="${item.value}">
-	    <c:set var="doc_ref" value="${item.key}" scope="request" />
-		<c:set var="task" value="${t}" scope="request" />
-		<c:set var="variableList" value="${task.variableList}" scope="request" />
-		<c:set var="taskInstance" value="${task.taskInstance}" scope="request" />
-		<c:set var="tiId" value="${task.taskInstance.id}" scope="request" />
-		<c:set var="name" value="${task.taskInstance.task.name}"
-			scope="request" />
-		<c:set var="descricao" value="${task.descricao}" scope="request" />
-		<c:set var="conhecimentoEditavel" value="${task.conhecimentoEditavel}"
-			scope="request" />
-		<c:set var="ajax" value="sim" scope="request" />
-
-		<form method="POST" action="${linkTo[AppController].executeTask}"
-			style="margin: 0px; padding: 0px; border: 0px;" id="form${tiId}">
-			<input name="result" type="hidden" value="doc" /> <input
-				name="sigla" type="hidden" value="${item.key}" /> <input
-				id="transitionName${tiId}" name="transitionName" type="hidden" value="" />
-
-			<%@ include file="tarefa.jsp"%>
-		</form>
-	</c:forEach>
-	<!--/ajax:${item.key}-->
-</c:forEach>
-
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/editar.jsp b/sigawf/src/main/webapp/WEB-INF/page/app/editar.jsp
deleted file mode 100644
index 4c922620af..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/page/app/editar.jsp
+++ /dev/null
@@ -1,107 +0,0 @@
-<%@ include file="/WEB-INF/page/include.jsp"%><!--  -->
-
-<siga:pagina titulo="Edição de Definição de Procedimento">
-	<div class="gt-bd clearfix">
-		<div class="gt-content clearfix">
-			<h2>Edição de Definição de Procedimento: ${nome}</h2>
-			
-			<h4>Tarefas <span class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/add.png" alt="Adicionar"></a></span></h4>
-			<div class="gt-content-box gt-form">
-				<div class="gt-form-row gt-width-100">
-					<div class="gt-left-col" style="width: 10%;">
-						<label>Tipo</label>
-						<input type="text" name="nome" value="" class="gt-form-text"/>
-					</div>
-					<div class="gt-left-col" style="width:70%; padding-left: 2%;">
-						<label>Nome</label>
-						<input type="text" name="nome" value="" class="gt-form-text"/>
-					</div>
-					<div class="gt-left-col" style="width:16%; padding-left: 2%;">
-						<label>Raia</label>
-						<select name="nome" class="gt-form-text"></select>
-					</div>
-				</div>
-				<div class="gt-form-row gt-width-100">
-					<label>Variáveis <span class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/add.png" alt="Adicionar"></a></span></label>
-					<table class="gt-table gt-form" style="table-layout: fixed;">
-						<tr class="header">
-							<td>Nome</td>
-							<td>Título</td>
-							<td style="width:6em;">Acesso</td>
-							<td style="width:3em; text-align: center;">Ações</td>
-						</tr>
-						<tr>
-							<td><input type="text" name="raia_nome" value="" class="gt-form-text gt-width-100"/>${dTarefa.raia}</td>
-							<td><input type="text" name="raia_nome" value="" class="gt-form-text gt-width-100"/>${dTarefa.raia}</td>
-							<td><select name="raia_nome" class="gt-form-text gt-width-100"/>${dTarefa.raia}</td>
-							<td style="width:3em; text-align: center; vertical-align: middle;"><p class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/cancel.png" alt="Remover"></a></p></td>
-						</tr>
-						<tr>
-							<td colspan="4"></td>
-						</tr>
-					</table>
-				</div>
-				<div class="gt-form-row gt-width-100">
-					<label>Transições <span class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/add.png" alt="Adicionar"></a></span></label>
-					<table class="gt-table gt-form" style="table-layout: fixed;">
-						<tr class="header">
-							<td>Nome</td>
-							<td>Título</td>
-							<td>Condição</td>
-							<td style="width:3em; text-align: center;">Ações</td>
-						</tr>
-						<tr>
-							<td><select name="raia_nome"class="gt-form-text gt-width-100"/>${dTarefa.raia}</td>
-							<td><input type="text" name="raia_nome" value="" class="gt-form-text gt-width-100"/>${dTarefa.raia}</td>
-							<td><input type="text" name="raia_nome" value="" class="gt-form-text gt-width-100"/>${dTarefa.raia}</td>
-							<td style="width:3em; text-align: center; vertical-align: middle;"><p class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/cancel.png" alt="Remover"></a></p></td>
-						</tr>
-						<tr>
-							<td colspan="4"></td>
-						</tr>
-					</table>
-				</div>
-				<p class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/cancel.png"> Remover</a></p>
-			</div>
-			
-<%--
-	<mail-node name="Indeferimento" actors="#{UO}">
-		<subject>Indeferimento SEC</subject>
-		<text>
-A solicitação eletrônica de contratação número #{doc_a} foi indeferida pelo seguinte motivo: #{motivo_indef}.
-		</text>
-		<transition to="Fim 2"></transition>
-	</mail-node>
-
-	<transition to="Retifica SEC" name="Retificar SEC">
-			<script>
-				<expression>
-					tiposituacao=3;				
-	   </expression>
-				<variable name='situacao' access='read,write' mapped-name='tiposituacao' />
-			</script>
-		</transition>
-		
-		<transition to="Cientifica SCM" name="Autorizar">
-			<condition expression="#{sel_autoriza == 'Não'}"></condition>
-		</transition>
-					
- --%>			
-			<h4>Raias <span class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/add.png" alt="Adicionar"></a></span></h4>
-			<div class="gt-content-box gt-for-table">
-				<table class="gt-table gt-form" style="table-layout: fixed;">
-					<tr class="header">
-						<td>Nome</td>
-						<td style="width:3em; text-align: center;">Ações</td>
-					</tr>
-					<tr>
-						<td><input type="text" name="raia_nome" value="Nome da primeira raia" class="gt-form-text gt-width-100"/>${dTarefa.raia}</td>
-						<td style="width:3em; text-align: center; vertical-align: middle;"><p class="gt-table-action-list"><a href=""><img src="/siga/css/famfamfam/icons/cancel.png" alt="Remover"></a></p></td>
-					</tr>
-				</table>
-			</div>
-		</div>
-	</div>
-</siga:pagina>
-
-
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/inbox.jsp b/sigawf/src/main/webapp/WEB-INF/page/app/inbox.jsp
deleted file mode 100644
index 556864aed9..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/page/app/inbox.jsp
+++ /dev/null
@@ -1,45 +0,0 @@
-<%@ include file="/WEB-INF/page/include.jsp"%><!--  -->
-
-<!-- Tabela com a lista de Tarefas -->
-<div id="sigawf"></div>
-<div class="gt-content-box gt-for-table">
-	<table border="0" class="gt-table">
-		<thead>
-			<tr>
-				<th>Tarefa</th>
-				<th style="text-align: center">Atendente</th>
-				<th style="text-align: center">Prioridade</th>
-				<th style="text-align: right">Início</th>
-			</tr>
-		</thead>
-		<tbody>
-			<c:forEach var="taskInstance" items="${taskInstances}">
-				<tr class="count">
-					<td>
-						<a href="${linkTo[AppController].task[taskInstance.id]}">${taskInstance.task.name}</a></td>
-
-					<!-- <td>${taskInstance.task.processDefinition.name}</td> -->
-					<td align="center"><c:set var="atendente">${pooledActors[taskInstance]}</c:set>
-						<c:set var="atendenteNome">${pooledActorsDescricao[atendente]}</c:set>
-						<c:if
-							test="${atendente != titular.sigla and atendente != lotaTitular.sigla}">
-							<span style="color: silver">
-						</c:if> <siga:selecionado sigla="${atendente}"
-							descricao="${atendenteNome}" /> <c:if
-							test="${atendente != titular.sigla and atendente != lotaTitular.sigla}">
-							</span>
-						</c:if></td>
-					<td align="center"><c:choose>
-							<c:when test="${taskInstance.priority == 1}">Muito Alta</c:when>
-							<c:when test="${taskInstance.priority == 2}">Alta</c:when>
-							<c:when test="${taskInstance.priority == 3}">Média</c:when>
-							<c:when test="${taskInstance.priority == 4}">Baixa</c:when>
-							<c:when test="${taskInstance.priority == 51}">Muito Baixa</c:when>
-						</c:choose></td>
-					<td align="right">${fn:replace(f:esperaSimples(taskInstance.create),
-						" ", "&nbsp;")}</td>
-				</tr>
-			</c:forEach>
-		</tbody>
-	</table>
-</div>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/resumo.jsp b/sigawf/src/main/webapp/WEB-INF/page/app/resumo.jsp
deleted file mode 100644
index 0eabc9d574..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/page/app/resumo.jsp
+++ /dev/null
@@ -1,10 +0,0 @@
-<%@ include file="/WEB-INF/page/include.jsp"%>
-
-<siga:pagina titulo="Tarefa">
-	<div class="gt-bd clearfix" id="page">
-		<div class="gt-content clearfix">
-			<h3>Quadro de tarefas</h3>
-			<%@ include file="/WEB-INF/page/app/inbox.jsp"%>
-		</div>
-	</div>
-</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/task.jsp b/sigawf/src/main/webapp/WEB-INF/page/app/task.jsp
deleted file mode 100644
index 4d9dd10f0b..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/page/app/task.jsp
+++ /dev/null
@@ -1,521 +0,0 @@
-<%@ include file="/WEB-INF/page/include.jsp"%>
-<siga:pagina titulo="Tarefa">
-	<div class="gt-bd gt-cols clearfix" id="page">
-		<div class="gt-content clearfix">
-
-			<c:if
-				test="${not f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
-				<div id="desc_editar" style="display: none;">
-					<h3>Descrição da Tarefa</h3>
-					<div class="gt-form gt-content-box">
-						<form method="POST"
-							action="${linkTo[AppController].saveKnowledge}">
-							<input name="tiId" type="hidden" value="${tiId}" />
-							<div class="gt-form-row gt-width-100">
-								<label>Descrição</label>
-								<textarea cols="80" rows="15" name="conhecimento"
-									class="gt-form-textarea">${task.conhecimento}</textarea>
-							</div>
-							<div class="gt-form-row gt-width-100">
-								<input name="salvar_conhecimento" type="submit" value="Salvar"
-									class="gt-btn-medium gt-btn-left" /> <a
-									href="javascript: window.location.reload()"
-									class="gt-btn-medium gt-btn-left">Cancelar</a>
-							</div>
-						</form>
-					</div>
-				</div>
-			</c:if>
-
-			<!-- Adicionando a lista de Tarefas -->
-			<form method="POST" action="${linkTo[AppController].executeTask}">
-				<h3>Execução da Tarefa</h3>
-				<div class="gt-form gt-content-box">
-					<div style="margin: 10px;">
-						<c:if
-							test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
-							<span id="gc-ancora"></span>
-						</c:if>
-
-
-						<c:if
-							test="${not f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
-							<span id="desc_ver"> <c:choose>
-									<c:when test="${not empty task.descricao}">
-										<c:if test="${task.conhecimentoEditavel}">
-											<a
-												style="float: right; margin-left: 15px; margin-bottom: 15px;"
-												title="Editar a descrição"
-												href="javascript: document.getElementById('desc_ver').style.display='none'; document.getElementById('desc_editar').style.display=''; document.getElementById('desc_but_editar').style.display='none'; document.getElementById('desc_but_gravar').style.display='';"><img
-												src="/siga/css/famfamfam/icons/pencil.png"> </a>
-										</c:if>${task.descricao}</c:when>
-									<c:otherwise>Ainda não existe uma descrição de como esta tarefa deve ser executada. Por favor, clique <a
-											href="javascript: document.getElementById('desc_ver').style.display='none'; document.getElementById('desc_editar').style.display=''; document.getElementById('desc_but_editar').style.display='none'; document.getElementById('desc_but_gravar').style.display='';">aqui</a> para contribuir.</c:otherwise>
-								</c:choose>
-							</span>
-						</c:if>
-					</div>
-					<div class="gt-form-row gt-width-100">
-						<table class="gt-form-table">
-							<input type="hidden" value="${task.taskInstance.id}" name="tiId" />
-
-							<c:set var="fieldIndex" value="0" />
-							<c:forEach var="variable" items="${task.variableList}">
-								<c:if test="${not variable.aviso}">
-									<tr>
-										<c:choose>
-											<c:when test="${fn:startsWith(variable.mappedName,'sel_')}">
-												<td width="">${fn:substring(variable.variableName,0,fn:indexOf(variable.variableName,'('))}</td>
-											</c:when>
-											<c:otherwise>
-												<td width="">${variable.variableName}</td>
-											</c:otherwise>
-										</c:choose>
-
-										<td width=""><c:set var="editable"
-												value="${variable.writable and (variable.readable or empty taskInstance.token.processInstance.contextInstance.variables[variable.mappedName])}" />
-											<c:if test="${editable}">
-												<input name="fieldNames[${fieldIndex}]" type="hidden"
-													value="${variable.mappedName}" />
-											</c:if> <c:choose>
-												<c:when test="${fn:startsWith(variable.mappedName,'doc_')}">
-													<c:choose>
-														<c:when test="${editable}">
-															<siga:selecao propriedade="${variable.mappedName}"
-																modulo="sigaex" tipo="expediente" tema="simple"
-																ocultardescricao="sim"
-																siglaInicial="${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}" />
-														</c:when>
-														<c:otherwise>
-															<a
-																href="/sigaex/app/expediente/doc/exibir?sigla=${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}">${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}</a>
-														</c:otherwise>
-													</c:choose>
-												</c:when>
-												<c:when test="${fn:startsWith(variable.mappedName,'pes_')}">
-													<c:choose>
-														<c:when test="${editable}">
-															<siga:selecao propriedade="${variable.mappedName}"
-																modulo="siga" tipo="pessoa" tema="simple"
-																ocultardescricao="sim"
-																siglaInicial="${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}" />
-														</c:when>
-														<c:otherwise>
-									${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}
-								</c:otherwise>
-													</c:choose>
-												</c:when>
-												<c:when test="${fn:startsWith(variable.mappedName,'lot_')}">
-													<c:choose>
-														<c:when test="${editable}">
-															<siga:selecao propriedade="${variable.mappedName}"
-																modulo="siga" tipo="lotacao" tema="simple"
-																ocultardescricao="sim"
-																siglaInicial="${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}" />
-														</c:when>
-														<c:otherwise>
-									${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}
-								</c:otherwise>
-													</c:choose>
-												</c:when>
-												<c:when test="${fn:startsWith(variable.mappedName,'dt_')}">
-													<c:choose>
-														<c:when test="${editable}">
-															<input name="fieldValues[${fieldIndex}]" type="text"
-																value="<fmt:formatDate pattern="dd/MM/yyyy"	value="${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}" />"
-																onblur="javascript:verifica_data(this, true);" />
-														</c:when>
-														<c:otherwise>
-															<fmt:formatDate pattern="dd/MM/yyyy"
-																value="${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}" />
-														</c:otherwise>
-													</c:choose>
-												</c:when>
-												<c:when test="${fn:startsWith(variable.mappedName,'sel_')}">
-													<c:choose>
-														<c:when test="${editable}">
-															<select name="fieldValues[${fieldIndex}]">
-																<c:forEach var="opcao"
-																	items="${wf:listarOpcoes(variable.variableName)}">
-																	<option value="${opcao}">${opcao}</option>
-																</c:forEach>
-															</select>
-														</c:when>
-														<c:otherwise>
-										${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}
-									</c:otherwise>
-													</c:choose>
-												</c:when>
-												<c:otherwise>
-													<c:choose>
-														<c:when test="${editable}">
-															<input name="fieldValues[${fieldIndex}]" type="text"
-																value="${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}" />
-														</c:when>
-														<c:otherwise>
-									${taskInstance.token.processInstance.contextInstance.variables[variable.mappedName]}
-									</c:otherwise>
-													</c:choose>
-												</c:otherwise>
-											</c:choose></td>
-									</tr>
-								</c:if>
-								<c:if test="${editable}">
-									<c:set var="fieldIndex" value="${fieldIndex + 1}" />
-								</c:if>
-							</c:forEach>
-						</table>
-					</div>
-					<c:if
-						test="${(titular.sigla eq taskInstance.actorId) or (wf:podePegarTarefa(cadastrante, titular,lotaCadastrante,lotaTitular,taskInstance) == true)}">
-						<div class="gt-form-row gt-width-100">
-							<c:forEach var="transition" items="${task.transitions}">
-								<button type="submit" name="transitionName"
-									value="${transition.name}${transition.resp}"
-									class="gt-btn-large gt-btn-left" style="white-space: nowrap" >${empty transition.name ? 'Prosseguir' : transition.name}${transition.resp}</button>
-							</c:forEach>
-						</div>
-					</c:if>
-					<c:forEach var="variable" items="${task.variableList}">
-						<c:if test="${fn:startsWith(variable.mappedName,'doc_')}">
-							<!-- 							<c:if test="${variable.aviso}">  -->
-							<!-- 							</c:if>	-->
-							<span style="color: red; font-weight: bold;">
-								${task.msgAviso}</span>
-						</c:if>
-					</c:forEach>
-				</div>
-			</form>
-			<c:if
-				test="${(titular.sigla eq taskInstance.actorId) or (wf:podePegarTarefa(cadastrante, titular,lotaCadastrante,lotaTitular,taskInstance))}">
-				<h3 class="gt-form-head">Designaçao da Tarefa</h3>
-				<div class="gt-form gt-content-box">
-					<form method="POST" action="${linkTo[AppController].assignTask}">
-						<input name="tiId" type="hidden" value="${taskInstance.id}" />
-						<div class="gt-form-row gt-width-100">
-							<label>Pessoa</label>
-							<siga:selecao modulo="siga" tipo="pessoa" tema="simple"
-								propriedade="ator" siglaInicial="${atorSel.sigla}"
-								idInicial="${atorSel.id}"
-								descricaoInicial="${atorSel.descricao}" />
-
-						</div>
-						<div class="gt-form-row gt-width-100">
-
-							<label>Lotação</label>
-							<siga:selecao modulo="siga" tipo="lotacao" tema="simple"
-								propriedade="lotaAtor" siglaInicial="${lotaAtorSel.sigla}"
-								idInicial="${lotaAtorSel.id}"
-								descricaoInicial="${lotaAtorSel.descricao}" />
-						</div>
-						<div class="gt-form-row gt-width-33" style="float: left">
-							<label>Prioridade</label>
-							<siga:select name="prioridade" list="prioridades" listKey="id"
-								listValue="descr" theme="simple" />
-						</div>
-						<div class="gt-form-row gt-width-66" style="float: right">
-							<label>Justificativa (opcional)</label> <input type="text"
-								name="justificativa" style="width: 100%" />
-						</div>
-						<div class="gt-form-row gt-width-100" style="clear: both">
-							<input name="designar" type="submit" value="Designar"
-								class="gt-btn-medium gt-btn-left" />
-							<c:if test="${empty taskInstance.actorId}">
-								<input type="button" value="Pegar tarefa para mim"
-									onclick="javascript:window.location.href='${linkTo[AppController].pegar}?tiId=${taskInstance.id}'"
-									class="gt-btn-large gt-btn-left">
-							</c:if>
-						</div>
-					</form>
-				</div>
-			</c:if>
-
-			<h3>Comentários</h3>
-			<div class="gt-content-box">
-				<table class="gt-table">
-					<thead>
-						<th>Data/Hora</th>
-						<th>Atendente</th>
-						<th>Descrição</th>
-					</thead>
-					<c:forEach var="ti" items="${wf:ordenarTarefas(taskInstance)}">
-						<c:forEach var="c" items="${wf:ordenarComentarios(ti)}">
-							<tr>
-								<td>${f:espera(c.time)}</td>
-								<td>${c.actorId}</td>
-								<td>${c.message}</td>
-							</tr>
-						</c:forEach>
-						<tr>
-							<td>${f:espera(ti.create)}</td>
-							<td>${ti.actorId}</td>
-							<td><b>${ti.name}</b></td>
-						</tr>
-					</c:forEach>
-				</table>
-			</div>
-
-			<c:if
-				test="${(titular.sigla eq taskInstance.actorId) or (wf:podePegarTarefa(cadastrante, titular,lotaCadastrante,lotaTitular,taskInstance))}">
-				<div class="gt-form gt-content-box">
-					<form method="POST" action="${linkTo[AppController].commentTask}">
-						<input name="tiId" type="hidden" value="${taskInstance.id}" /> <label>Comentário</label>
-						<div class="gt-form-row gt-width-100">
-							<input type="text" size="80" name="comentario"
-								class="gt-form-text" />
-						</div>
-						<div class="gt-form-row gt-width-100">
-							<input name="butc" type="submit" value="Adicionar"
-								class="gt-btn-medium gt-btn-left" />
-						</div>
-					</form>
-				</div>
-			</c:if>
-		</div>
-
-		<div class="gt-sidebar">
-			<!-- Sidebar Content -->
-			<div class="gt-sidebar-content">
-				<h3>Dados da Tarefa</h3>
-				<p>
-					<b>Procedimento:</b> ${taskInstance.task.processDefinition.name}
-				</p>
-				<p>
-					<b>Tarefa:</b> ${taskInstance.task.name}
-				</p>
-				<p>
-					<b>Prioridade:</b>
-					<c:choose>
-						<c:when test="${taskInstance.priority == 1}">Muito Alta</c:when>
-						<c:when test="${taskInstance.priority == 2}">Alta</c:when>
-						<c:when test="${taskInstance.priority == 3}">Média</c:when>
-						<c:when test="${taskInstance.priority == 4}">Baixa</c:when>
-						<c:when test="${taskInstance.priority == 51}">Muito Baixa</c:when>
-					</c:choose>
-				</p>
-				<p>
-					<b>Cadastrante:</b> ${task.cadastrante} (${task.lotaCadastrante})
-				</p>
-				<p>
-					<b>Titular:</b> ${task.titular} (${task.lotaTitular})
-				</p>
-				<p>
-					<b>Início:</b> ${f:espera(taskInstance.create)}
-				</p>
-			</div>
-			<!-- /Sidebar Content -->
-			<%--
-			<!-- Sidebar Navigation -->
-			<div class="gt-sidebar-nav gt-sidebar-nav-brown">
-				<h3>Quick Links</h3>
-				<ul>
-					<li><a href="http://www.gooeytemplates.com" target="_blank">GooeyTemplates.com</a>
-					</li>
-				</ul>
-			</div>
-			<!-- /Sidebar Navigation -->
-
-			<!-- Sidebar Navigation -->
-			<div class="gt-sidebar-nav gt-sidebar-nav-green">
-				<h3>Contact Us</h3>
-				<ul>
-					<li><a href="mailto:help@gooeytemplates.com">Email Gooey
-							Templates</a></li>
-				</ul>
-			</div>
-			<!-- /Sidebar Navigation -->
-
-			<!-- Sidebar Box -->
-			<div class="gt-sidebar-box gt-sidebar-box-green">
-				<!-- search -->
-				<div class="gt-search">
-					<div class="gt-search-inner">
-						<input type="text" class="gt-search-text" value="Find an Article"
-							onfocus="javascript:if(this.value=='Find an Article')this.value='';"
-							onblur="javascript:if(this.value=='')this.value='Find an Article';" />
-					</div>
-				</div>
-				<!-- /search -->
-			</div>
-			<!-- /Sidebar Box -->
---%>
-
-			<!-- Sidebar List -->
-			<div class="gt-sidebar-list">
-				<h3>Mapa do Procedimento</h3>
-				<div style="display: none" id="input">digraph G {
-					graph[size="3,3", rankdir="LR"]; ${dot} }</div>
-				<a onclick="javascript: showBig();" title="Zoom" href="#">
-					<div class="gt-sidebar-list-content" id="output"></div>
-				</a>
-			</div>
-
-			<!-- /Sidebar List -->
-
-			<div class="gt-sidebar-content" id="gc"></div>
-
-		</div>
-		<!-- / sidebar -->
-	</div>
-
-	<div class="gt-bd clearfix" style="display: none" id="map">
-		<div class="gt-content clearfix">
-			<div id="desc_editar">
-				<h3>Mapa do Procedimento</h3>
-				<div class="gt-form gt-content-box" style="padding-bottom: 15px;">
-					<img style="width: 100%" src="loadPhoto?tId=${taskInstance.id}" />
-				</div>
-			</div>
-		</div>
-		<a href="task.action?tiId=${taskInstance.id}"
-			class="gt-btn-large gt-btn-left">Voltar</a>
-
-	</div>
-
-	<div class="gt-bd clearfix" style="display: none" id="svg">
-		<div class="gt-content clearfix">
-			<div id="desc_editar">
-				<h3>Mapa do Procedimento</h3>
-				<div style="display: none" id="input2">digraph G {
-					graph[size="100,100", rankdir="LR"]; ${dot} }</div>
-
-				<div class="gt-form gt-content-box" style="padding-bottom: 15px;"
-					id="output2"></div>
-			</div>
-		</div>
-		<a href="javascript: hideBig();" class="gt-btn-large gt-btn-left">Voltar</a>
-
-	</div>
-
-	<c:if
-		test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
-
-		<c:url var="url" value="/../sigagc/app/knowledgeInplace">
-			<c:param name="tags">${task.ancora}</c:param>
-			<c:param name="msgvazio">Ainda não existe uma descrição de como esta tarefa deve ser executada. Por favor, clique <a
-					href="$1">aqui</a> para contribuir.</c:param>
-			<c:param name="titulo">${taskInstance.task.processDefinition.name} - ${taskInstance.task.name}</c:param>
-			<c:param name="ts">${currentTimeMillis}</c:param>
-		</c:url>
-		<script type="text/javascript">
-			SetInnerHTMLFromAjaxResponse("${url}", document
-					.getElementById('gc-ancora'));
-		</script>
-
-		<c:url var="url" value="/../sigagc/app/knowledgeSidebar">
-			<c:param name="tags">@workflow</c:param>
-			<c:forEach var="tag" items="${task.tags}">
-				<c:param name="tags">${tag}</c:param>
-			</c:forEach>
-			<c:param name="ts">${currentTimeMillis}</c:param>
-		</c:url>
-		<script type="text/javascript">
-			SetInnerHTMLFromAjaxResponse("${url}", document
-					.getElementById('gc'));
-		</script>
-	</c:if>
-
-	<script>
-		if (${not empty f:resource('graphviz.url')}) {
-		} else if (window.Worker) {
-			window.VizWorker = new Worker("/siga/javascript/viz.js");
-			window.VizWorker.onmessage = function(oEvent) {
-				document.getElementById(oEvent.data.id).innerHTML = oEvent.data.svg;
-				$(document).ready(function() {
-					updateContainer();
-				});
-			};
-		} else {
-			document
-					.write("<script src='/siga/javascript/viz.js' language='JavaScript1.1' type='text/javascript'>"
-							+ "<"+"/script>");
-		}
-	</script>
-	<script>
-		function buildSvg(id, input, cont) {
-			if (${not empty f:resource('graphviz.url')}) {
-			    input = input.replace(/fontsize=\d+/gm, "");
-			    $.ajax({
-				    url: "/siga/public/app/graphviz/svg",
-				    data: input,
-				    type: 'POST',
-				    processData: false,
-				    contentType: 'text/vnd.graphviz',
-				    contents: window.String,
-				    success: function(data) {
-					    data = data.replace(/width="\d+pt" height="\d+pt"/gm, "");
-					    $(data).width("100%");
-				        $("#" + id).html(data);
-				    }
-				});
-			} else if (window.VizWorker) {
-				document.getElementById(id).innerHTML = "Aguarde...";
-				window.VizWorker.postMessage({
-					id : id,
-					graph : input
-				});
-			} else {
-				var result = Viz(input, "svg", "dot");
-				document.getElementById(id).innerHTML = result;
-				cont();
-			}
-		}
-
-		function bigmap() {
-			var input = 'digraph G { graph[size="100,100"]; ${dot} }';
-			buildSvg('output2', input, updateContainer);
-		}
-
-		function smallmap() {
-			var input = 'digraph G { graph[size="3,3"]; ${dot} }';
-			buildSvg('output', input, updateContainer);
-		}
-
-		function showBig() {
-			document.getElementById('page').style.display = 'none';
-			document.getElementById('svg').style.display = 'block';
-			bigmap();
-		}
-
-		function hideBig() {
-			document.getElementById('page').style.display = 'block';
-			document.getElementById('svg').style.display = 'none';
-			updateContainer();
-		}
-
-		smallmap();
-
-		$(document).ready(function() {
-			updateContainer();
-			$(window).resize(function() {
-				updateContainer();
-			});
-		});
-		function updateContainer() {
-			var smallwidth = $('#output').width();
-			var smallsvg = $('#output :first-child').first();
-			var smallviewbox = smallsvg.attr('viewBox');
-
-			if (typeof smallviewbox != 'undefined') {
-				var a = smallviewbox.split(' ');
-
-				// set attrs and 'resume' force 
-				smallsvg.attr('width', smallwidth);
-				smallsvg.attr('height', smallwidth * a[3] / a[2]);
-			}
-
-			var bigwidth = $('#output2').width();
-			var bigsvg = $('#output2 :first-child').first();
-			var bigviewbox = bigsvg.attr('viewBox');
-
-			if (typeof bigviewbox != 'undefined') {
-				var a = bigviewbox.split(' ');
-
-				// set attrs and 'resume' force 
-				bigsvg.attr('width', bigwidth);
-				bigsvg.attr('height', bigwidth * a[3] / a[2]);
-			}
-		}
-	</script>
-
-</siga:pagina>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/page/erroGeral.jsp b/sigawf/src/main/webapp/WEB-INF/page/erroGeral.jsp
index 744709ca55..9d411ed2f3 100644
--- a/sigawf/src/main/webapp/WEB-INF/page/erroGeral.jsp
+++ b/sigawf/src/main/webapp/WEB-INF/page/erroGeral.jsp
@@ -7,37 +7,34 @@
 	<c:if test="${empty exceptionGeral or empty exceptionStackGeral}">
 		<%
 			java.lang.Throwable t = (Throwable) pageContext.getRequest().getAttribute("exception");
-			if (t == null){
-				t = (Throwable) exception;
-			}
-			if (t != null) {
-				if (!t.getClass().getSimpleName()
-						.equals("AplicacaoException")
-						&& t.getCause() != null) {
-					if (t.getCause().getClass().getSimpleName()
-							.equals("AplicacaoException")) {
-						t = t.getCause();
-					} else if (t.getCause().getCause() != null
-							&& t.getCause().getCause().getClass()
-									.getSimpleName()
-									.equals("AplicacaoException")) {
-						t = t.getCause().getCause();
+					if (t == null) {
+						t = (Throwable) exception;
+					}
+					if (t != null) {
+						while ((t.getClass().getSimpleName().equals("ServletException")
+								|| t.getClass().getSimpleName().equals("InterceptionException")
+								|| t.getClass().getSimpleName().equals("InvocationTargetException")
+								|| t.getClass().getSimpleName().equals("ProxyInvocationException"))
+								&& t.getCause() != null && t != t.getCause()) {
+							t = t.getCause();
+						}
+
+						pageContext.getRequest().setAttribute("exceptionApp",
+								t instanceof br.gov.jfrj.siga.base.AplicacaoException);
+						pageContext.getRequest().setAttribute("exceptionMsg", t.getMessage());
+						pageContext.getRequest().setAttribute("exceptionGeral", t);
+						pageContext.getRequest().setAttribute("exceptionStackGeral",
+								br.gov.jfrj.siga.base.log.RequestExceptionLogger.simplificarStackTrace(t));
 					}
-				}
-				// Get the ErrorData
-				pageContext.getRequest().setAttribute("exceptionGeral", t);
-				java.io.StringWriter sw = new java.io.StringWriter();
-				java.io.PrintWriter pw = new java.io.PrintWriter(sw);
-				t.printStackTrace(pw);
-				pageContext.getRequest().setAttribute("exceptionStackGeral",
-						sw.toString());
-			}
 		%>
 	</c:if>
 </c:catch>
 <c:catch var="catchException">
-	<siga:pagina titulo="Erro Geral" desabilitarbusca="sim" desabilitarmenu="sim" desabilitarComplementoHEAD="sim">
-		<!--
+	<siga:pagina titulo="Erro Geral" desabilitarbusca="sim"
+		desabilitarmenu="sim" desabilitarComplementoHEAD="sim">
+		<div class="container content">
+
+			<!--
 Unless this text is here, if your page is less than 513 bytes, Internet Explorer will display it's "Friendly HTTP Error Message",
 and your custom error will never be displayed.  This text is just used as filler.
 This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
@@ -45,69 +42,51 @@ This is a useless buffer to fill the page to 513 bytes to avoid display of Frien
 This is a useless buffer to fill the page to 513 bytes to avoid display of Friendly Error Pages in Internet Explorer
 -->
 
-		<div class="gt-bd clearfix">
-			<div class="gt-content clearfix">
+			<div class="gt-bd clearfix">
+				<div class="gt-content clearfix">
 
-				<div id="caption" class="gt-error-page-hd">
-					<h2>Não Foi Possível Completar a Operação (${pageContext.request.serverName})</h2>
-				</div>
+					<c:choose>
+						<c:when test="${exceptionApp}">
+							<p class="mb-2 mt-5">Operação Inválida:</p>
+							<h2 class="mt-0">${exceptionMsg}</h2>
+						</c:when>
+						<c:otherwise>
+							<div id="caption">
+								${t.exceptionStackGeral }
+								<h2>Não Foi Possível Completar a Operação
+									(${pageContext.request.serverName})</h2>
+							</div>
+							<div align="left" id="stack">
+								<pre style="font-size: 8pt;"><c:out value="${exceptionStackGeral}" /></pre>
+							</div>
+						</c:otherwise>
+					</c:choose>
 
-				<div class="gt-content-box">
-					<table width="100%">
-						<tr>
-							<td align="center" valign="middle">
-								<table class="form" width="50%">
-									<c:catch>
-										<c:if test="${not empty exceptionGeral}">
-											<c:if test="${not empty exceptionGeral.message}">
-												<tr>
-													<td style="text-align: center; padding-top: 10px;"><h3>${exceptionGeral.message}</h3>
-													</td>
-												</tr>
-											</c:if>
-											<c:if test="${not empty exceptionGeral.cause}">
+					<div class="row mt-3">
+						<div class="col">
+							<div class="form-group">
+							<c:if test="${newWindow != 1}">
+								<input type="button" value="Voltar"
+									onclick="javascript:history.back();" class="btn btn-secondary btn-sm" />
+							</c:if>
+							<c:if test="${newWindow eq 1}">
+								<input type="button" value="Fechar"
+									onclick="javascript:window.close();" class="btn btn-secondary btn-sm" />
+							</c:if>
+							</div>
+						</div>
+					</div>
 
-												<tr>
-													<td
-														style="text-align: center;"><h4>${exceptionGeral.cause.message}</h4></td>
-												</tr>
-											</c:if>
-										</c:if>
-									</c:catch>
-								</table>
-							</td>
-						</tr>
-						<tr>
-							<td style="text-align: center; padding:0;">
-								<div style="display: none; padding: 8pt;" align="left" id="stack">
-									<pre style="font-size: 8pt;">${exceptionStackGeral}</pre>
-								</div>
-							</td>
-						</tr>
-					</table>
-				</div>
-				<div style="padding-top:10px;float: right;">
-					<table>
-						<tr>
-							<td><input type="button" value="Voltar" class="gt-btn-medium gt-btn-left"  onclick="javascript:history.back();" /></td>
-							<td><input type="button" id="show_stack" value="Mais detalhes" class="gt-btn-large gt-btn-right" onclick="javascript: document.getElementById('caption').setAttribute('class',''); document.getElementById('stack').style.display=''; document.getElementById('show_stack').style.display='none';" /></td>
-						</tr>
-					</table>
 				</div>
 			</div>
+
 		</div>
 
 	</siga:pagina>
 </c:catch>
 
 <c:if test="${catchException!=null}">
-Erro: ${catchException.message}<br>
-	<br>
-	<br>
-
-	<pre>
+Erro: ${catchException.message}<br> <br> <br> <pre>
 Erro original:
 ${exceptionStack}</pre>
 </c:if>
-
-
diff --git a/sigawf/src/main/webapp/WEB-INF/page/metrica/medir.jsp b/sigawf/src/main/webapp/WEB-INF/page/metrica/medir.jsp
deleted file mode 100644
index d34fe37e10..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/page/metrica/medir.jsp
+++ /dev/null
@@ -1,114 +0,0 @@
-<%@ include file="/WEB-INF/page/include.jsp"%>
-
-<script type="text/javascript" language="Javascript1.1">
-	function sbmt() {
-		frmRelatorio.action = '${linkTo[MetricaController].relatorio}';
-		frmRelatorio.submit();
-	}
-</script>
-
-<script type="text/javascript">
-	function exibirOpcoesExtras() {
-		if ($("#selecaoRelatorio").val() == '2'
-				|| $("#selecaoRelatorio").val() == '3') {
-			$("#opcoesExtras").show();
-		} else {
-			$("#opcoesExtras").hide();
-		}
-		if ($("#selecaoRelatorio").val() == '1') {
-			$("#opcaoPercentualMediaTruncada").show();
-		} else {
-			$("#opcaoPercentualMediaTruncada").hide();
-		}
-		if ($("#selecaoRelatorio").val() == '3') {
-			$("#opcaoGrupos").show();
-		} else {
-			$("#opcaoGrupos").hide();
-		}
-
-	}
-</script>
-
-<siga:pagina titulo="Estatística de procedimento">
-	<div class="gt-bd clearfix">
-		<div class="gt-content clearfix">
-			<h2>${titulo_pagina}</h2>
-			<div class="gt-content-box gt-for-table">
-				<form name="frmRelatorio" method="get" class="form">
-					<input type="hidden" name="pdId" value="${pdId}" />
-					<input type="hidden" name="orgao" value="${orgao}" />
-					<input type="hidden" name="procedimento" value="${procedimento}" />
-					<table class="gt-form-table">
-						<tr>
-							<td>Órgão</td>
-							<td>${orgao}</td>
-						</tr>
-						<tr>
-							<td>Procedimento</td>
-							<td>${procedimento}</td>
-						</tr>
-						<tr>
-							<siga:select
-								list="listaTipoRelatorio"
-								listKey="id" listValue="descr" 
-								label="Relatório" name="selecaoRelatorio"
-								id="selecaoRelatorio"
-								onchange="javascript:exibirOpcoesExtras()" />
-						</tr>
-						<tr>
-							<td width="25%">Procedimento iniciado de:</td>
-							<td><input type="text" name="dataInicialDe"
-								onblur="javascript:verifica_data(this, true);comparaData(dataInicialDe,dataInicialAte);
-				comparaData(dataInicialAte,dataFinalDe)"
-								size="12" maxlength="10" /> até <input type="text"
-								name="dataInicialAte"
-								onblur="javascript:verifica_data(this, true);comparaData(dataInicialDe,dataInicialAte);
-				comparaData(dataInicialAte,dataFinalDe)"
-								size="12" maxlength="10" /></td>
-						</tr>
-						<tr>
-							<td>Procedimento finalizado de:</td>
-							<td><input type="text" name="dataFinalDe"
-								onblur="javascript:verifica_data(this,true);comparaData(dataInicialDe,dataInicialAte);
-				comparaData(dataInicialAte,dataFinalDe);"
-								size="12" maxlength="10" /> até <input type="text"
-								name="dataFinalAte"
-								onblur="javascript:verifica_data(this,true);comparaData(dataInicialDe,dataInicialAte);
-				comparaData(dataInicialAte,dataFinalDe);"
-								size="12" maxlength="10" /></td>
-						</tr>
-						<tr id="opcoesExtras" style="display: none">
-							<td><input type="checkbox" id="incluirAbertos"
-								name="incluirAbertos" style="float: left"
-								class="gt-form-checkbox"></input> <label>&nbsp;Incluir
-									Procedimentos Abertos</label></td>
-						</tr>
-						<tr id="opcaoPercentualMediaTruncada">
-							<td><label>Percentual&nbsp;da&nbsp;Média&nbsp;Truncada
-									(entre ${minMediaTruncada}% e ${maxMediaTruncada}%):</label></td>
-							<td><input type="text" id="percentualMediaTruncada"
-								name="percentualMediaTruncada" style="float: left"
-								class="gt-form-text" value="${minMediaTruncada}"></input></td>
-						</tr>
-						<tr id="opcaoGrupos" style="display: none">
-							<td>Agrupar tarefas (opcional)</td>
-							<td><label>Tarefa inicial:</label> <siga:select id="grpIni"
-									name="grpIni" list="lstGruposIni" listValue="name" listKey="id"
-									headerKey="-1" headerValue="[Escolha uma tarefa]"
-									theme="simple"/> <label>Tarefa final:</label> <siga:select
-									id="grpFim" name="grpFim" list="lstGruposFim" listValue="name"
-									listKey="id" headerKey="-1" headerValue="[Escolha uma tarefa]"
-									theme="simple"/></td>
-						</tr>
-
-						<tr>
-							<td colspan="2"><input type="button"
-								onclick="javascript:sbmt()" value="Gerar relatório"
-								class="gt-btn-medium gt-btn-left" /></td>
-						</tr>
-					</table>
-				</form>
-			</div>
-		</div>
-	</div>
-</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/anotar.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/anotar.jsp
new file mode 100644
index 0000000000..6e35e225f8
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/anotar.jsp
@@ -0,0 +1,61 @@
+<!-- Anotar Modal -->
+<div class="modal fade" id="anotarModal" tabindex="-1" role="dialog"
+	aria-labelledby="anotarModalLabel" aria-hidden="true">
+	<div class="modal-dialog" role="document">
+		<div class="modal-content">
+			<div class="modal-header">
+				<h5 class="modal-title" id="anotarModalLabel">Acrescentar uma
+					Anotação</h5>
+				<button type="button" class="close" data-dismiss="modal"
+					aria-label="Close">
+					<span aria-hidden="true">&times;</span>
+				</button>
+			</div>
+			<div class="modal-body">
+				<form id="anotarForm" name="anotar" method="POST"
+					action="${linkTo[WfAppController].anotar}?id=${task.id}">
+					<div class="form-group">
+						<div class="form-group">
+							<label for="descrMov">Nota</label>
+							<textarea class="form-control" name="descrMov" value="" cols="60"
+								rows="5" onkeydown="corrige();tamanho();" maxlength="255"
+								onblur="tamanho();" onclick="tamanho();"></textarea>
+							<small class="form-text text-muted float-right" id="Qtd">Restam&nbsp;255&nbsp;Caracteres</small>
+						</div>
+					</div>
+				</form>
+			</div>
+			<div class="modal-footer">
+				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
+				<button type="button" class="btn btn-primary"
+					onclick="javascript: document.getElementById('anotarForm').submit();">Gravar</button>
+			</div>
+		</div>
+	</div>
+</div>
+<script>
+	function tamanho() {
+		var i = tamanho2();
+		if (i < 0) {
+			i = 0
+		}
+		;
+		document.getElementById("Qtd").innerText = 'Restam ' + i
+				+ ' Caracteres';
+	}
+
+	function tamanho2() {
+		nota = new String();
+		nota = this.anotar.descrMov.value;
+		var i = 255 - nota.length;
+		return i;
+	}
+	function corrige() {
+		if (tamanho2() < 0) {
+			alert('Descrição com mais de 255 caracteres');
+			nota = new String();
+			nota = document.getElementById("descrMov").value;
+			document.getElementById("descrMov").value = nota.substring(0, 255);
+		}
+	}
+</script>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/ativos.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/ativos.jsp
new file mode 100644
index 0000000000..b501ae694b
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/ativos.jsp
@@ -0,0 +1,42 @@
+<%@ include file="/WEB-INF/page/include.jsp"%>
+
+<siga:pagina titulo="Tarefa">
+	<div class="container-fluid content">
+		<h3>Procedimentos Ativos</h3>
+		<table class="table table-sm table-striped">
+			<thead class="thead-dark">
+				<tr>
+					<th>Diagrama</th>
+					<th>Tarefa</th>
+					<th style="text-align: center">Atendente</th>
+					<th style="text-align: center">Prioridade</th>
+					<th style="text-align: right">Início</th>
+				</tr>
+			</thead>
+			<tbody>
+				<c:forEach var="taskInstance" items="${taskInstances}">
+					<tr class="count">
+						<td>${taskInstance.instanciaDeProcedimento.definicaoDeProcedimento.nome}</td>
+						<td><a
+							href="${linkTo[WfAppController].procedimento(taskInstance.instanciaDeProcedimento.id)}">${taskInstance.definicaoDeTarefa.nome}</a></td>
+
+						<!-- <td>${taskInstance.instanciaDeProcedimento.definicaoDeProcedimento.nome}</td> -->
+						<td align="center"><c:set var="atendente">${taskInstance.instanciaDeProcedimento.atendente}</c:set>
+							<c:set var="atendenteNome">${pooledActorsDescricao[atendente]}</c:set>
+							<c:if
+								test="${atendente != titular.sigla and atendente != lotaTitular.sigla}">
+								<span style="color: silver">
+							</c:if> <siga:selecionado sigla="${atendente}"
+								descricao="${atendenteNome}" /> <c:if
+								test="${atendente != titular.sigla and atendente != lotaTitular.sigla}">
+								</span>
+							</c:if></td>
+						<td align="center">${taskInstance.instanciaDeProcedimento.prioridade}</td>
+						<td align="right">${fn:replace(f:esperaSimples(taskInstance.instanciaDeProcedimento.dtEvento),
+						" ", "&nbsp;")}</td>
+					</tr>
+				</c:forEach>
+			</tbody>
+		</table>
+	</div>
+</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/tarefa.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/del-tarefa.jsp
similarity index 99%
rename from sigawf/src/main/webapp/WEB-INF/page/app/tarefa.jsp
rename to sigawf/src/main/webapp/WEB-INF/page/wfApp/del-tarefa.jsp
index ac9b1b88a7..1b34546568 100644
--- a/sigawf/src/main/webapp/WEB-INF/page/app/tarefa.jsp
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/del-tarefa.jsp
@@ -9,7 +9,7 @@
 						style="font-weight: normal;">${taskInstance.task.processDefinition.name}</span><span
 						style="text-align: right;">&nbsp(${f:espera(taskInstance.create)})</span><br />
 						Tarefa: <a
-						href="${linkTo[AppController].task[task.taskInstance.id]}"><span
+						href="${linkTo[WfAppController].task[task.taskInstance.id]}"><span
 							style="font-weight: normal;">${task.taskInstance.task.name}</span>
 					</a> <c:if test="${not empty taskInstance.actorId}">
 						sendo atendida por <span style="font-weight: normal;">${taskInstance.actorId}</span>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/doc.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/doc.jsp
new file mode 100644
index 0000000000..312f357af8
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/doc.jsp
@@ -0,0 +1,30 @@
+<%@ include file="/WEB-INF/page/include.jsp"%>
+
+
+<c:if test="${mobilMap.size() == 0}">
+	<!-- Siga-Wf consultado com sucesso, mas nenhum fluxo do associado a este documento. -->
+</c:if>
+<c:forEach var="item" items="${mobilMap}">
+	<!--ajax:${item.key}-->
+	<c:forEach var="pi" items="${item.value}">
+		<c:set var="ajax" value="sim" scope="request" />
+
+		<div class="card mb-3 border-info">
+			<div class="card-header bg-info text-white">
+				<a href="${linkTo[WfAppController].procedimento(pi.id)}"
+					style="color: white; text-decoration: underline;">${pi.sigla}</a> -
+				${pi.definicaoDeProcedimento.nome} -
+				${pi.definicaoDeTarefaCorrente.nome}
+			</div>
+			<div class="card-body">
+				<form method="POST"
+					action="${linkTo[WfAppController].continuar(pi.id)}?sigla=${param.sigla}"
+					style="margin: 0px; padding: 0px; border: 0px;" id="form${pi.id}">
+					<%@ include file="inc-form.jsp"%>
+				</form>
+			</div>
+		</div>
+
+	</c:forEach>
+	<!--/ajax:${item.key}-->
+</c:forEach>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/editar.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/editar.jsp
new file mode 100644
index 0000000000..09e1f7d399
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/editar.jsp
@@ -0,0 +1,145 @@
+<%@ include file="/WEB-INF/page/include.jsp"%><!--  -->
+
+
+
+
+
+<siga:pagina titulo="Edição de Definição de Procedimento">
+	<div class="gt-bd clearfix">
+		<div class="gt-content clearfix">
+			<h2>Edição de Definição de Procedimento: ${nome}</h2>
+
+			<h4>
+				Tarefas <span class="gt-table-action-list"><a href=""><img
+						src="/siga/css/famfamfam/icons/add.png" alt="Adicionar"></a></span>
+			</h4>
+			<div class="gt-content-box gt-form">
+				<div class="gt-form-row gt-width-100">
+					<div class="gt-left-col" style="width: 10%;">
+						<label>Tipo</label> <input type="text" name="nome" value=""
+							class="gt-form-text" />
+					</div>
+					<div class="gt-left-col" style="width: 70%; padding-left: 2%;">
+						<label>Nome</label> <input type="text" name="nome" value=""
+							class="gt-form-text" />
+					</div>
+					<div class="gt-left-col" style="width: 16%; padding-left: 2%;">
+						<label>Raia</label> <select name="nome" class="gt-form-text"></select>
+					</div>
+				</div>
+				<div class="gt-form-row gt-width-100">
+					<label>Variáveis <span class="gt-table-action-list"><a
+							href=""><img src="/siga/css/famfamfam/icons/add.png"
+								alt="Adicionar"></a></span></label>
+					<table class="gt-table gt-form" style="table-layout: fixed;">
+						<tr class="header">
+							<td>Nome</td>
+							<td>Título</td>
+							<td style="width: 6em;">Acesso</td>
+							<td style="width: 3em; text-align: center;">Ações</td>
+						</tr>
+						<tr>
+							<td><input type="text" name="raia_nome" value=""
+								class="gt-form-text gt-width-100" />${dTarefa.raia}</td>
+							<td><input type="text" name="raia_nome" value=""
+								class="gt-form-text gt-width-100" />${dTarefa.raia}</td>
+							<td><select name="raia_nome"
+								class="gt-form-text gt-width-100" />${dTarefa.raia}</td>
+							<td
+								style="width: 3em; text-align: center; vertical-align: middle;"><p
+									class="gt-table-action-list">
+									<a href=""><img src="/siga/css/famfamfam/icons/cancel.png"
+										alt="Remover"></a>
+								</p></td>
+						</tr>
+						<tr>
+							<td colspan="4"></td>
+						</tr>
+					</table>
+				</div>
+				<div class="gt-form-row gt-width-100">
+					<label>Transições <span class="gt-table-action-list"><a
+							href=""><img src="/siga/css/famfamfam/icons/add.png"
+								alt="Adicionar"></a></span></label>
+					<table class="gt-table gt-form" style="table-layout: fixed;">
+						<tr class="header">
+							<td>Nome</td>
+							<td>Título</td>
+							<td>Condição</td>
+							<td style="width: 3em; text-align: center;">Ações</td>
+						</tr>
+						<tr>
+							<td><select name="raia_nome"
+								class="gt-form-text gt-width-100" />${dTarefa.raia}</td>
+							<td><input type="text" name="raia_nome" value=""
+								class="gt-form-text gt-width-100" />${dTarefa.raia}</td>
+							<td><input type="text" name="raia_nome" value=""
+								class="gt-form-text gt-width-100" />${dTarefa.raia}</td>
+							<td
+								style="width: 3em; text-align: center; vertical-align: middle;"><p
+									class="gt-table-action-list">
+									<a href=""><img src="/siga/css/famfamfam/icons/cancel.png"
+										alt="Remover"></a>
+								</p></td>
+						</tr>
+						<tr>
+							<td colspan="4"></td>
+						</tr>
+					</table>
+				</div>
+				<p class="gt-table-action-list">
+					<a href=""><img src="/siga/css/famfamfam/icons/cancel.png">
+						Remover</a>
+				</p>
+			</div>
+
+			<%--
+	<mail-node name="Indeferimento" actors="#{UO}">
+		<subject>Indeferimento SEC</subject>
+		<text>
+A solicitação eletrônica de contratação número #{doc_a} foi indeferida pelo seguinte motivo: #{motivo_indef}.
+		</text>
+		<transition to="Fim 2"></transition>
+	</mail-node>
+
+	<transition to="Retifica SEC" name="Retificar SEC">
+			<script>
+				<expression>
+					tiposituacao=3;				
+	   </expression>
+				<variable name='situacao' access='read,write' mapped-name='tiposituacao' />
+			</script>
+		</transition>
+		
+		<transition to="Cientifica SCM" name="Autorizar">
+			<condition expression="#{sel_autoriza == 'Não'}"></condition>
+		</transition>
+					
+ --%>
+			<h4>
+				Raias <span class="gt-table-action-list"><a href=""><img
+						src="/siga/css/famfamfam/icons/add.png" alt="Adicionar"></a></span>
+			</h4>
+			<div class="gt-content-box gt-for-table">
+				<table class="gt-table gt-form" style="table-layout: fixed;">
+					<tr class="header">
+						<td>Nome</td>
+						<td style="width: 3em; text-align: center;">Ações</td>
+					</tr>
+					<tr>
+						<td><input type="text" name="raia_nome"
+							value="Nome da primeira raia" class="gt-form-text gt-width-100" />${dTarefa.raia}</td>
+						<td
+							style="width: 3em; text-align: center; vertical-align: middle;"><p
+								class="gt-table-action-list">
+								<a href=""><img src="/siga/css/famfamfam/icons/cancel.png"
+									alt="Remover"></a>
+							</p></td>
+					</tr>
+				</table>
+			</div>
+		</div>
+	</div>
+</siga:pagina>
+
+
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/inbox.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/inbox.jsp
new file mode 100644
index 0000000000..6fac3c8ceb
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/inbox.jsp
@@ -0,0 +1,44 @@
+<%@ include file="/WEB-INF/page/include.jsp"%><!--  -->
+
+<!-- Tabela com a lista de Tarefas -->
+<div id="sigawf"></div>
+<c:if test="${empty tarefas}">
+	Nenhuma tarefa ativa
+</c:if>
+<c:if test="${not empty tarefas}">
+	<div class="gt-content-box gt-for-table">
+		<table border="0" class="gt-table">
+			<thead>
+				<tr>
+					<th>Tarefa</th>
+					<th style="text-align: center">Atendente</th>
+					<th style="text-align: center">Prioridade</th>
+					<th style="text-align: right">Início</th>
+				</tr>
+			</thead>
+			<tbody>
+				<c:forEach var="taskInstance" items="${tarefas}">
+					<tr class="count">
+						<td><a
+							href="${linkTo[WfAppController].procedimento(taskInstance.instanciaDeProcedimento.id)}">${taskInstance.definicaoDeTarefa.nome}</a></td>
+
+						<!-- <td>${taskInstance.instanciaDeProcedimento.definicaoDeProcedimento.nome}</td> -->
+						<td align="center"><c:set var="atendente">${taskInstance.instanciaDeProcedimento.atendente}</c:set>
+							<c:set var="atendenteNome">${pooledActorsDescricao[atendente]}</c:set>
+							<c:if
+								test="${atendente != titular.sigla and atendente != lotaTitular.sigla}">
+								<span style="color: silver">
+							</c:if> <siga:selecionado sigla="${atendente}"
+								descricao="${atendenteNome}" /> <c:if
+								test="${atendente != titular.sigla and atendente != lotaTitular.sigla}">
+								</span>
+							</c:if></td>
+						<td align="center">${taskInstance.instanciaDeProcedimento.prioridade}</td>
+						<td align="right">${fn:replace(f:esperaSimples(taskInstance.instanciaDeProcedimento.eventoData),
+						" ", "&nbsp;")}</td>
+					</tr>
+				</c:forEach>
+			</tbody>
+		</table>
+	</div>
+</c:if>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/inc-form.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/inc-form.jsp
new file mode 100644
index 0000000000..90fb4b9421
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/inc-form.jsp
@@ -0,0 +1,155 @@
+<%@ include file="/WEB-INF/page/include.jsp"%>
+
+<div>
+	<div>
+		<c:if
+			test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
+			<span id="gc-ancora"></span>
+		</c:if>
+
+
+		<c:if
+			test="${false and not f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
+			<span id="desc_ver"> <c:choose>
+					<c:when test="${not empty task.descricao}">
+						<c:if test="${task.conhecimentoEditavel}">
+							<a style="float: right; margin-left: 15px; margin-bottom: 15px;"
+								title="Editar a descrição"
+								href="javascript: document.getElementById('desc_ver').style.display='none'; document.getElementById('desc_editar').style.display=''; document.getElementById('desc_but_editar').style.display='none'; document.getElementById('desc_but_gravar').style.display='';"><img
+								src="/siga/css/famfamfam/icons/pencil.png"> </a>
+						</c:if>${task.descricao}</c:when>
+					<c:otherwise>Ainda não existe uma descrição de como esta tarefa deve ser executada. Por favor, clique <a
+							href="javascript: document.getElementById('desc_ver').style.display='none'; document.getElementById('desc_editar').style.display=''; document.getElementById('desc_but_editar').style.display='none'; document.getElementById('desc_but_gravar').style.display='';">aqui</a> para contribuir.</c:otherwise>
+				</c:choose>
+			</span>
+		</c:if>
+	</div>
+	<c:if
+		test="${pi.isDesabilitarFormulario(titular, lotaTitular) eq false}">
+		<div class="gt-form-row gt-width-100">
+			<input type="hidden" value="${pi.id}" name="tiId" />
+
+			<c:set var="fieldIndex" value="0" />
+			<c:forEach var="variavel"
+				items="${pi.definicaoDeTarefaCorrente.definicaoDeVariavel}">
+				<c:set var="valor" value="${pi.obterValorDeVariavel(variavel)}" />
+				<div class="form-group">
+					<c:choose>
+						<c:when test="${fn:startsWith(variavel.identificador,'sel_')}">
+							<label>${fn:substring(variavel.nome,0,fn:indexOf(variavel.nome,'('))}</label>
+						</c:when>
+						<c:otherwise>
+							<label>${variavel.nome}</label>
+						</c:otherwise>
+					</c:choose>
+
+					<c:set var="editable" value="${variavel.acesso eq 'READ_WRITE'}" />
+					<c:if test="${editable}">
+						<input name="campoIdentificador[${fieldIndex}]" type="hidden"
+							value="${variavel.identificador}" />
+					</c:if>
+					<c:choose>
+						<c:when test="${fn:startsWith(variavel.identificador,'doc_')}">
+							<c:choose>
+								<c:when test="${editable}">
+									<siga:selecao propriedade="${variavel.identificador}"
+										modulo="sigaex" tipo="expediente" tema="simple"
+										ocultardescricao="sim" siglaInicial="${valor}" />
+								</c:when>
+								<c:otherwise>
+									<a href="/sigaex/app/expediente/doc/exibir?sigla=${valor}">${valor}</a>
+								</c:otherwise>
+							</c:choose>
+						</c:when>
+						<c:when test="${fn:startsWith(variavel.identificador,'pes_')}">
+							<c:choose>
+								<c:when test="${editable}">
+									<siga:selecao propriedade="${variavel.identificador}"
+										modulo="siga" tipo="pessoa" tema="simple"
+										ocultardescricao="sim" siglaInicial="${valor}" />
+								</c:when>
+								<c:otherwise>
+									${valor}
+								</c:otherwise>
+							</c:choose>
+						</c:when>
+						<c:when test="${fn:startsWith(variavel.identificador,'lot_')}">
+							<c:choose>
+								<c:when test="${editable}">
+									<siga:selecao propriedade="${variavel.identificador}"
+										modulo="siga" tipo="lotacao" tema="simple"
+										ocultardescricao="sim" siglaInicial="${valor}" />
+								</c:when>
+								<c:otherwise>
+									${valor}
+								</c:otherwise>
+							</c:choose>
+						</c:when>
+						<c:when test="${fn:startsWith(variavel.identificador,'dt_')}">
+							<c:choose>
+								<c:when test="${editable}">
+									<input name="campoValor[${fieldIndex}]" type="text"
+										value="<fmt:formatDate pattern="dd/MM/yyyy"	value="${valor}" />"
+										onblur="javascript:verifica_data(this, true);"
+										class="form-control" />
+								</c:when>
+								<c:otherwise>
+									<fmt:formatDate pattern="dd/MM/yyyy" value="${valor}" />
+								</c:otherwise>
+							</c:choose>
+						</c:when>
+						<c:when test="${fn:startsWith(variavel.identificador,'sel_')}">
+							<c:choose>
+								<c:when test="${editable}">
+									<select name="campoValor[${fieldIndex}]" class="form-control">
+										<c:forEach var="opcao"
+											items="${wf:listarOpcoes(variavel.nome)}">
+											<option value="${opcao}">${opcao}</option>
+										</c:forEach>
+									</select>
+								</c:when>
+								<c:otherwise>
+										${valor}
+									</c:otherwise>
+							</c:choose>
+						</c:when>
+						<c:otherwise>
+							<c:choose>
+								<c:when test="${editable}">
+									<input name="campoValor[${fieldIndex}]" type="text"
+										value="${valor}" class="form-control" />
+								</c:when>
+								<c:otherwise>
+									<div class="form-control" readonly>${valor}&nbsp;</div>
+								</c:otherwise>
+							</c:choose>
+						</c:otherwise>
+					</c:choose>
+				</div>
+				<c:if test="${editable}">
+					<c:set var="fieldIndex" value="${fieldIndex + 1}" />
+				</c:if>
+			</c:forEach>
+		</div>
+		<%--<c:if test="${task.podePegarTarefa}"> --%>
+		<div class="gt-form-row gt-width-100">
+			<c:forEach var="desvio"
+				items="${pi.definicaoDeTarefaCorrente.definicaoDeDesvio}"
+				varStatus="loop">
+				<c:set var="resp" value="${desvio.obterProximoResponsavel(pi)}" />
+				<c:if test="${not empty resp}">
+					<c:set var="resp" value=" &raquo; ${resp}" />
+				</c:if>
+				<button type="submit" name="indiceDoDesvio" value="${loop.index}"
+					class="btn btn-info mr-3">${empty desvio.nome ? 'Prosseguir' : desvio.nome}${resp}</button>
+			</c:forEach>
+		</div>
+		<c:if test="${empty pi.definicaoDeTarefaCorrente.definicaoDeDesvio}">
+			<button type="submit" name="indiceDoDesvio" value=""
+				class="btn btn-info mr-3">Prosseguir${resp}</button>
+		</c:if>
+		<%--</c:if> --%>
+	</c:if>
+	<span style="color: red; font-weight: bold;">
+		${pi.getMsgAviso(titular, lotaTitular)}</span>
+</div>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/iniciar.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/iniciar.jsp
new file mode 100644
index 0000000000..29800b9636
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/iniciar.jsp
@@ -0,0 +1,33 @@
+<%@ include file="/WEB-INF/page/include.jsp"%>
+
+<siga:pagina titulo="Iniciar Procedimento">
+	<div class="container-fluid content">
+		<h2>Iniciar Procedimento ${pd.sigla} - ${pd.nome}</h2>
+		<form method="POST" action="${linkTo[WfAppController].iniciar(pd.id)}">
+			<fieldset title="Dados Básicos">
+				<div class="row">
+					<div class="col-12">
+						<div class="form-group">
+							<label>Documento</label>
+							<siga:escolha id="tipoDePrincipal" var="tipoDePrincipal">
+								<siga:opcao id='DOC' texto="Documento">
+									<siga:selecao tema='simple' titulo="Documento Principal"
+										propriedade="documentoRef" urlAcao="expediente/buscar"
+										urlSelecionar="expediente/selecionar" modulo="sigaex" />
+								</siga:opcao>
+							</siga:escolha>
+						</div>
+					</div>
+				</div>
+			</fieldset>
+			<div class="row">
+				<div class="col-sm-12">
+					<div class="form-group mb-0">
+						<button class="btn btn-primary" type="submit">Ok</button>
+						<button onclick="javascript:history.back();" class="btn btn-light ml-3">Cancelar</button>
+					</div>
+				</div>
+			</div>
+		</form>
+	</div>
+</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/listarParaIniciar.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/listarParaIniciar.jsp
new file mode 100644
index 0000000000..bf0257103d
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/listarParaIniciar.jsp
@@ -0,0 +1,31 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
+	buffer="32kb"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
+<%@ taglib uri="http://localhost/customtag" prefix="tags"%>
+<%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+
+<siga:pagina titulo="Lista de Diagramas">
+	<div class="container-fluid content mb-3">
+		<h3>Inicialização de Procedimento</h3>
+		<table class="table table-sm table-striped">
+			<thead class="thead-dark">
+				<tr class="header">
+					<th>Sigla</th>
+					<th>Nome</th>
+					<th>Descrição</th>
+				</tr>
+			</thead>
+			<tbody class="table-bordered">
+				<c:forEach var="item" items="${itens}">
+					<tr>
+						<td><a href="${linkTo[WfAppController].iniciar(item.id)}">${item.sigla}</a></td>
+						<td>${item.nome}</td>
+						<td>${item.descr}</td>
+					</tr>
+				</c:forEach>
+			</tbody>
+		</table>
+	</div>
+</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfApp/procedimento.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/procedimento.jsp
new file mode 100644
index 0000000000..8f396b6d50
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfApp/procedimento.jsp
@@ -0,0 +1,365 @@
+<%@ include file="/WEB-INF/page/include.jsp"%>
+<siga:pagina titulo="${pi.sigla}">
+
+
+	<div class="container-fluid content" id="page">
+
+		<div class="row mt-2">
+			<div class="col col-sm-12 col-md-8">
+				<c:if
+					test="${false and not f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
+					<div id="desc_editar" style="display: none;">
+						<h3>Descrição da Tarefa</h3>
+						<div class="gt-form gt-content-box">
+							<form method="POST"
+								action="${linkTo[WfAppController].saveKnowledge}">
+								<input name="tiId" type="hidden" value="${tiId}" />
+								<div class="gt-form-row gt-width-100">
+									<label>Descrição</label>
+									<textarea cols="80" rows="15" name="conhecimento"
+										class="gt-form-textarea">${task.conhecimento}</textarea>
+								</div>
+								<div class="gt-form-row gt-width-100">
+									<input name="salvar_conhecimento" type="submit" value="Salvar"
+										class="gt-btn-medium gt-btn-left" /> <a
+										href="javascript: window.location.reload()"
+										class="gt-btn-medium gt-btn-left">Cancelar</a>
+								</div>
+							</form>
+						</div>
+					</div>
+				</c:if>
+
+				<h2 class="mt-3">Procedimento ${pi.sigla}</h2>
+
+				<!-- lista de Ações -->
+				<siga:links>
+					<c:forEach var="acao" items="${pi.getAcoes(titular, lotaTitular)}">
+						<siga:link icon="${acao.icone}" title="${acao.nomeNbsp}"
+							pre="${acao.pre}" pos="${acao.pos}"
+							url="${pageContext.request.contextPath}${acao.url}"
+							popup="${acao.popup}" confirm="${acao.msgConfirmacao}"
+							classe="${acao.classe}" estilo="line-height: 160% !important"
+							atalho="${true}" modal="${acao.modal}"
+							explicacao="${acao.explicacao}" post="${acao.post}"
+							test="${acao.pode}" />
+					</c:forEach>
+				</siga:links>
+
+				<c:if test="${pi.formulario}">
+					<div class="card bg-info mb-3 mt-3">
+						<div class="card-header text-white">
+							<c:if
+								test="${pi.tipoDePrincipal eq 'DOC' and not empty pi.principal}">
+								<a
+									href="/sigaex/app/expediente/doc/exibir?sigla=${pi.principal}" style="color: white; text-decoration: underline;">${pi.principal}</a> -
+							</c:if>
+
+							${pi.definicaoDeProcedimento.nome} -
+							${pi.definicaoDeTarefaCorrente.nome}
+						</div>
+						<div class="card-body bg-light text-black">
+
+							<form method="POST"
+								action="${linkTo[WfAppController].continuar(piId, null, null, null)}">
+								<%@ include file="inc-form.jsp"%>
+							</form>
+						</div>
+					</div>
+				</c:if>
+
+				<!-- Movimentações -->
+				<c:if test="${not empty movs}">
+					<div class="gt-content-box gt-for-table"
+						style="margin-bottom: 25px; margin-top: 10px;">
+						<script type="text/javascript">
+							var css = "<style>TABLE.mov TR.despacho { background-color: rgb(240, 255, 240);}";
+							css += "TABLE.mov TR.juntada,TR.desentranhamento { background-color: rgb(229, 240, 255);}";
+							css += "TABLE.mov TR.anotacao { background-color: rgb(255, 255, 255);}";
+							css += "TABLE.mov TR.anexacao { background-color: rgb(255, 255, 215);}";
+							css += "TABLE.mov TR.encerramento_volume { background-color: rgb(255, 218, 218);}</style>";
+							$(css).appendTo("head");
+						</script>
+						<table class="table table-sm table-responsive-sm table-striped">
+							<thead>
+								<tr>
+									<th align="center">Tempo</th>
+									<th>Lotação</th>
+									<th>Evento</th>
+									<th>Descrição</th>
+									<th></th>
+								</tr>
+							</thead>
+							<c:forEach var="mov" items="${movs}">
+								<tr class="${mov.classeVO}">
+									<td class="align-top" title="${mov.dtIniVO}">${mov.tempoRelativoVO}</td>
+									<td class="align-top"
+										title="${mov.hisIdcIni.dpPessoa.descricao} - ${mov.hisIdcIni.dpPessoa.lotacao.descricao}">${mov.lotaTitular.sigla}</td>
+									<td class="align-top">${mov.evento}</td>
+									<td class="align-top" style="word-break: break-all;"><span
+										class="align-top">${mov.descricaoEvento}</span></td>
+
+									<td class="align-top" style="word-break: break-all;"><span
+										class="align-top"> <siga:links buttons="${false}"
+												inline="${true}" separator="${false}">
+												<c:forEach var="acao" items="${mov.acoes}">
+													<siga:link title="${acao.nomeNbsp}" pre="${acao.pre}"
+														pos="${acao.pos}"
+														url="${pageContext.request.contextPath}${acao.url}"
+														test="${true}" popup="${acao.popup}"
+														confirm="${acao.msgConfirmacao}" classe="${acao.classe}"
+														explicacao="${acao.explicacao}" post="${acao.post}" />
+												</c:forEach>
+											</siga:links>
+									</span></td>
+
+								</tr>
+							</c:forEach>
+						</table>
+					</div>
+				</c:if>
+			</div>
+
+			<div class="col col-sm-12 col-md-4">
+				<c:if test="${not empty dot}">
+					<div class="card-sidebar card bg-light mb-3">
+						<div class="card-header">Diagrama</div>
+						<a href="javascript:void(0)" href="javascript:void(0)"
+							style="text-decoration: none">
+							<div id="output" class="bg-light"
+								style="border: 0px; padding: 0px; text-align: center;"></div>
+						</a>
+					</div>
+					<!-- Fim mapa tramitação -->
+				</c:if>
+
+				<div class="card-sidebar card bg-light mb-3">
+					<div class="card-header">Dados do Procedimento</div>
+					<div class="card-body">
+						<c:if test="${not empty pi.principal}">
+							<p>
+								<b>Principal:</b>
+								<c:if test="${pi.tipoDePrincipal eq 'DOC'}">
+									<a
+										href="/sigaex/app/expediente/doc/exibir?sigla=${pi.principal}">${pi.principal}</a>
+								</c:if>
+								<c:if test="${pi.tipoDePrincipal != 'DOC'}">
+								${pi.principal}
+								</c:if>
+							</p>
+							<p>
+								<b>Tipo do principal:</b> ${pi.tipoDePrincipal.descr}
+							</p>
+						</c:if>
+						<p>
+							<b>Procedimento:</b> ${pi.definicaoDeProcedimento.nome}
+						</p>
+						<p>
+							<b>Prioridade:</b> ${pi.prioridade.descr}
+						</p>
+						<p>
+							<b>Cadastrante:</b> ${pi.hisIdcIni.dpPessoa.sigla}
+							(${pi.hisIdcIni.dpPessoa.lotacao.sigla})
+						</p>
+						<p>
+							<b>Titular:</b> ${pi.titular} (${pi.lotaTitular})
+						</p>
+						<c:if test="${not empty pi.eventoData}">
+							<p>
+								<b>Tarefa:</b> ${pi.definicaoDeTarefaCorrente.nome}
+							</p>
+							<p>
+								<b>Início da tarefa:</b> ${f:espera(pi.eventoData)}
+							</p>
+						</c:if>
+						<p>
+							<b>Início do procedimento:</b> ${f:espera(pi.hisDtIni)}
+						</p>
+						<p>
+							<b>Término do procedimento:</b> ${f:espera(pi.hisDtFim)}
+						</p>
+					</div>
+				</div>
+
+				<c:if test="${not empty pi.eventoData}">
+					<div class="card-sidebar card bg-light mb-3">
+						<div class="card-header">Dados da Tarefa</div>
+						<div class="card-body">
+							<p>
+								<b>Tarefa:</b> ${pi.definicaoDeTarefaCorrente.nome}
+							</p>
+							<p>
+								<b>Início da tarefa:</b> ${f:espera(pi.eventoData)}
+							</p>
+						</div>
+					</div>
+				</c:if>
+
+				<div class="gt-bd clearfix" style="display: none" id="svg">
+					<div class="gt-content clearfix">
+						<div id="desc_editar">
+							<h3>Mapa do Procedimento</h3>
+							<div style="display: none" id="input2">digraph G {
+								graph[size="100,100", rankdir="LR"]; ${dot} }</div>
+
+							<div class="gt-form gt-content-box" style="padding-bottom: 15px;"
+								id="output2"></div>
+						</div>
+					</div>
+					<a href="javascript: hideBig();" class="gt-btn-large gt-btn-left">Voltar</a>
+
+				</div>
+
+				<c:if
+					test="${false and f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;GC')}">
+
+					<c:url var="url" value="/../sigagc/app/knowledgeInplace">
+						<c:param name="tags">${task.ancora}</c:param>
+						<c:param name="msgvazio">Ainda não existe uma descrição de como esta tarefa deve ser executada. Por favor, clique <a
+								href="$1">aqui</a> para contribuir.</c:param>
+						<c:param name="titulo">${task.nomeDoProcedimento} - ${task.nomeDaTarefa}</c:param>
+						<c:param name="ts">${currentTimeMillis}</c:param>
+					</c:url>
+					<script type="text/javascript">
+			SetInnerHTMLFromAjaxResponse("${url}", document
+					.getElementById('gc-ancora'));
+		</script>
+
+					<c:url var="url" value="/../sigagc/app/knowledgeSidebar">
+						<c:param name="tags">@workflow</c:param>
+						<c:forEach var="tag" items="${task.tags}">
+							<c:param name="tags">${tag}</c:param>
+						</c:forEach>
+						<c:param name="ts">${currentTimeMillis}</c:param>
+					</c:url>
+					<script type="text/javascript">
+			SetInnerHTMLFromAjaxResponse("${url}", document
+					.getElementById('gc'));
+		</script>
+				</c:if>
+
+				<%@ include file="anotar.jsp"%>
+
+				<script>
+		if (${not empty f:resource('graphviz.url')}) {
+		} else if (window.Worker) {
+			window.VizWorker = new Worker("/siga/javascript/viz.js");
+			window.VizWorker.onmessage = function(oEvent) {
+				document.getElementById(oEvent.data.id).innerHTML = oEvent.data.svg;
+				$(document).ready(function() {
+					updateContainer();
+				});
+			};
+		} else {
+			document
+					.write("<script src='/siga/javascript/viz.js' language='JavaScript1.1' type='text/javascript'>"
+							+ "<"+"/script>");
+		}
+	</script>
+				<script>
+		function buildSvg(id, input, cont) {
+			if (${not empty f:resource('graphviz.url')}) {
+			    input = input.replace(/fontsize=\d+/gm, "");
+			    $.ajax({
+				    url: "/siga/public/app/graphviz/svg",
+				    data: input,
+				    type: 'POST',
+				    processData: false,
+				    contentType: 'text/vnd.graphviz',
+				    contents: window.String,
+				    success: function(data) {
+					    data = data.replace(/width="\d+pt" height="\d+pt"/gm, "");
+					    data = data.replace(/fill="white"/gm, 'fill="none"');
+					    data = data.replace(/stroke="white"/gm, 'stroke="none"');
+					    $(data).width("100%");
+				        $("#" + id).html(data);
+				        updateContainer();
+				    }
+				});
+			} else if (window.VizWorker) {
+				document.getElementById(id).innerHTML = "Aguarde...";
+				window.VizWorker.postMessage({
+					id : id,
+					graph : input
+				});
+			} else {
+				var result = Viz(input, "svg", "dot");
+				document.getElementById(id).innerHTML = result;
+				cont();
+			}
+		}
+
+		function bigmap() {
+			var input = 'digraph G { graph[size="100,100"]; ${dot} }';
+			buildSvg('output2', input, updateContainer);
+		}
+
+		function smallmap() {
+			var input = 'digraph G { graph[size="3,3"]; ${dot} }';
+			buildSvg('output', input, updateContainer);
+		}
+
+		function showBig() {
+			document.getElementById('page').style.display = 'none';
+			document.getElementById('svg').style.display = 'block';
+			bigmap();
+		}
+
+		function hideBig() {
+			document.getElementById('page').style.display = 'block';
+			document.getElementById('svg').style.display = 'none';
+			updateContainer();
+		}
+
+		smallmap();
+
+		$(document).ready(function() {
+			updateContainer();
+			$(window).resize(function() {
+				updateContainer();
+			});
+		});
+		function updateContainer() {
+			var smallwidth = $('#output').width();
+			var smallheight = $('#output').height();
+			var smallsvg = $('#output :first-child').first();
+			var smallviewbox = smallsvg.attr('viewBox');
+			
+			if (smallheight > smallwidth * 4/4)
+				smallheight = smallwidth * 4/4;
+
+			if (smallsvg && smallsvg[0] && smallsvg[0].viewBox && smallsvg[0].viewBox.baseVal){
+
+				console.log('updated')
+
+				var baseVal = smallsvg[0].viewBox.baseVal;
+				var width = smallwidth;
+				var height = smallwidth * baseVal.height / baseVal.width;
+				if (height > smallheight) {
+					width = width * smallheight / height;
+					height = smallheight;
+				}
+				smallsvg.attr('width', width);
+				smallsvg.attr('height', height);
+			} else if (typeof smallviewbox != 'undefined') {
+				var a = smallviewbox.split(' ');
+				
+				// set attrs and 'resume' force 
+				smallsvg.attr('width', smallwidth);
+				smallsvg.attr('height', smallwidth * a[3] / a[2]);
+			} 
+
+			var bigwidth = $('#output2').width();
+			var bigsvg = $('#output2 :first-child').first();
+			var bigviewbox = bigsvg.attr('viewBox');
+
+			if (typeof bigviewbox != 'undefined') {
+				var a = bigviewbox.split(' ');
+
+				// set attrs and 'resume' force 
+				bigsvg.attr('width', bigwidth);
+				bigsvg.attr('height', bigwidth * a[3] / a[2]);
+			}
+		}
+	</script>
+</siga:pagina>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/transactions.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/transactions.jsp
similarity index 100%
rename from sigawf/src/main/webapp/WEB-INF/page/app/transactions.jsp
rename to sigawf/src/main/webapp/WEB-INF/page/wfApp/transactions.jsp
diff --git a/sigawf/src/main/webapp/WEB-INF/page/app/variables.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfApp/variables.jsp
similarity index 100%
rename from sigawf/src/main/webapp/WEB-INF/page/app/variables.jsp
rename to sigawf/src/main/webapp/WEB-INF/page/wfApp/variables.jsp
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfDiagrama/edita.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfDiagrama/edita.jsp
new file mode 100644
index 0000000000..b71dc6d918
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfDiagrama/edita.jsp
@@ -0,0 +1,460 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<%@ page language="java" contentType="text/html; charset=UTF-8"
+	buffer="64kb"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
+
+<%@ taglib uri="http://localhost/customtag" prefix="tags"%>
+<%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+
+<siga:pagina titulo="Diagrama" incluirJs="/sigawf/js/diagrama.js">
+
+	<link rel="stylesheet"
+		href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
+		integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
+		crossorigin="anonymous"></link>
+
+	<!-- CSS Customization -->
+	<link rel="stylesheet" href="/sigawf/css/diagrama.css"></link>
+	<link rel="stylesheet"
+		href="/sigawf/js/angucomplete-alt/angucomplete-alt.css"></link>
+
+	<!-- JS Global Compulsory -->
+	<!-- Optional JavaScript -->
+	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
+	<script
+		src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"
+		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
+		crossorigin="anonymous"></script>
+	<script
+		src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
+		integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
+		crossorigin="anonymous"></script>
+	<script
+		src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
+		integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
+		crossorigin="anonymous"></script>
+
+	<script
+		src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
+
+	<script src="/sigawf/js/angucomplete-alt/angucomplete-alt.js"></script>
+
+	<div class="container-fluid content" ng-app="app" ng-controller="ctrl">
+		<h2>Diagrama ${pd.sigla}</h2>
+
+		<input type="hidden" name="postback" value="1" />
+		<fieldset title="Dados Básicos">
+			<div class="row">
+				<div class="col-sm-4">
+					<div class="form-group">
+						<label>Nome</label> <input type="text" name="pd.nome"
+							ng-model="data.workflow.nome" size="80" class="form-control" />
+					</div>
+				</div>
+				<div class="col-sm-8">
+					<div class="form-group">
+						<label>Descrição</label> <input type="text" name="descricao"
+							ng-model="data.workflow.descricao" size="80" class="form-control" />
+					</div>
+				</div>
+			</div>
+		</fieldset>
+
+		<fieldset title="Tarefas">
+			<div class="row">
+				<div class="col col-12 col-md-8">
+					<header class="form-group juia">
+					<div class="row align-items-center">
+						<div class="col col-auto">Tarefas</div>
+						<div class="col col-auto ml-auto">
+							<button
+								ng-click="data.workflow.tarefa = (data.workflow.tarefa || []);data.workflow.tarefa.push({}); $event.stopPropagation();"
+								style="margin-left: 1em;" class="juia btn btn-sm btn-secondary">
+								<i class="fa fa-plus"></i>&nbsp;Tarefa
+							</button>
+						</div>
+					</div>
+					</header>
+					<div ng-repeat="tarefaItem in data.workflow.tarefa" class="row">
+						<div class="col col-auto">
+							<section> <label class="label" for="ddm">&nbsp;
+								<div id="ddm" role="group" class="form-controlx btn-group"
+									style="padding: 0 !important; display: block;">
+									<div role="group" class="btn-group dropright">
+										<button data-toggle="dropdown" aria-expanded="false"
+											aria-haspopup="true" id="dropBtn"
+											class="btn btn-secondary dropdown-toggle">{{$index+1}}</button>
+										<div aria-labelledby="dropBtn" class="dropdown-menu pt-0 pb-0">
+											<button ng-click="data.workflow.tarefa.splice($index, 1);"
+												class="btn btn-link" ng-disabled>
+												<i class="fa fa-fa fa-trash"></i>
+											</button>
+											<button
+												ng-click="data.workflow.tarefa[$index] = data.workflow.tarefa.splice($index - 1, 1, data.workflow.tarefa[$index])[0]"
+												class="btn btn-link" ng-disabled="$index === 0">
+												<i class="fa fa-fa fa-arrow-up"></i>
+											</button>
+											<button
+												ng-click="data.workflow.tarefa[$index] = data.workflow.tarefa.splice($index + 1, 1, data.workflow.tarefa[$index])[0]"
+												class="btn btn-link"
+												ng-disabled="$index === data.workflow.tarefa.length - 1">
+												<i class="fa fa-fa fa-arrow-down"></i>
+											</button>
+										</div>
+									</div>
+								</div>
+							</label> </section>
+						</div>
+						<div class="col">
+							<div class="row">
+								<section class="col col-12 col-md-2 col-lg-2 form-group">
+								<label for="tipo" title="" class="label">Tipo<i
+									title="Preenchimento obrigatório"
+									class="label-clue fa fa-asterisk"></i><select
+									ng-model="tarefaItem.tipo" ng-required="true"
+									class="form-control"><option value="FORMULARIO">Formulário</option>
+										<option value="DECISAO">Decisão</option>
+										<option value="EMAIL">E-mail</option>
+										<option value="EXECUTAR">Executar</option>
+										<option value="AGUARDAR_ASSINATURA_PRINCIPAL">Principal:
+											Aguardar Assinatura</option>
+										<option value="TRAMITAR_PRINCIPAL">Principal:
+											Tramitar</option>
+										<option value="ARQUIVAR_PRINCIPAL">Principal:
+											Arquivar</option>
+										<option value="INCLUIR_DOCUMENTO">Principal: Incluir
+											Documento</option>
+								</select></label> <i></i> </section>
+								<section class="col col-12 col-md-2 col-lg-2 form-group">
+								<label for="titulo" title="" class="label">Título<i
+									title="Preenchimento obrigatório"
+									class="label-clue fa fa-asterisk"></i><input
+									ng-model="tarefaItem.titulo" name="titulo" ng-required="true"
+									id="titulo" type="text" class="form-control"></label> </section>
+								<section
+									ng-show="tarefaItem.tipo != 'FORMULARIO' && tarefaItem.tipo != 'DECISAO'"
+									class="col col-12 col-md-2 col-lg-2 form-group"> <label
+									for="depois" title="" class="label">Depois<select
+									ng-selected="desvioItem.tarefa" ng-model="tarefaItem.depois"
+									ng-init=""
+									ng-options="item.id as item.nome disable when item.id === tarefaItem.id for item in tarefas"
+									class="form-control"><option value="">[Próxima]</option></select></label>
+								<i></i> </section>
+								<section
+									ng-show="tarefaItem.tipo == 'FORMULARIO' || tarefaItem.tipo == 'INCLUIR_DOCUMENTO' || tarefaItem.tipo == 'EMAIL' || tarefaItem.tipo == 'TRAMITAR_PRINCIPAL'"
+									class="col col-12 col-md-2 col-lg-2 form-group"> <label
+									for="tipoResponsavel" title="" class="label">Tipo Resp.<i
+									title="Preenchimento obrigatório"
+									class="label-clue fa fa-asterisk"></i><select
+									ng-model="tarefaItem.tipoResponsavel" ng-required="true"
+									class="form-control">
+										<option value="RESPONSAVEL">Tabelado</option>
+										<option value="LOTACAO">Lotação</option>
+										<option value="PESSOA">Pessoa</option>
+										<option value="PRINCIPAL_CADASTRANTE">Principal:
+											Cadastrante</option>
+										<option value="PRINCIPAL_LOTA_CADASTRANTE">Principal:
+											Lotação do Cadastrante</option>
+										<option value="PRINCIPAL_TITULAR">Principal: Titular</option>
+										<option value="PRINCIPAL_LOTA_TITULAR">Principal:
+											Lotação do Titular</option>
+										<option value="PRINCIPAL_SUBSCRITOR">Principal:
+											Subscritor</option>
+										<option value="PRINCIPAL_LOTA_SUBSCRITOR">Principal:
+											Lotação do Subscritor</option>
+										<option value="PRINCIPAL_DESTINATARIO">Principal:
+											Destinatário</option>
+										<option value="PRINCIPAL_LOTA_DESTINATARIO">Principal:
+											Lotação do Destinatário</option>
+										<option value="PRINCIPAL_GESTOR">Principal: Gestor</option>
+										<option value="PRINCIPAL_LOTA_GESTOR">Principal:
+											Lotação do Gestor</option>
+										<option value="PRINCIPAL_FISCAL_TECNICO">Principal:
+											Fiscal Técnico</option>
+										<option value="PRINCIPAL_LOTA_FISCAL_TECNICO">Principal:
+											Lotação do Fiscal Técnico</option>
+										<option value="PRINCIPAL_FISCAL_ADMINISTRATIVO">Principal:
+											Fiscal Administrativo</option>
+										<option value="PRINCIPAL_LOTA_FISCAL_ADMINISTRATIVO">Principal:
+											Lotação do Fiscal Administrativo</option>
+										<option value="PRINCIPAL_INTERESSADO">Principal:
+											Interessado</option>
+										<option value="PRINCIPAL_LOTA_INTERESSADO">Principal:
+											Lotação do Interessado</option>
+										<option value="PRINCIPAL_AUTORIZADOR">Principal:
+											Interessado</option>
+										<option value="PRINCIPAL_LOTA_AUTORIZADOR">Principal:
+											Lotação do Autorizador</option>
+										<option value="PRINCIPAL_REVISOR">Principal:
+											Interessado</option>
+										<option value="PRINCIPAL_LOTA_REVISOR">Principal:
+											Lotação do Revisor</option>
+										<option value="PRINCIPAL_LIQUIDANTE">Principal:
+											Interessado</option>
+										<option value="PRINCIPAL_LOTA_LIQUIDANTE">Principal:
+											Lotação do Liquidante</option>
+								</select>
+								</label> <i></i> </section>
+								<section
+									ng-show="(tarefaItem.tipo == 'FORMULARIO' || tarefaItem.tipo == 'INCLUIR_DOCUMENTO' || tarefaItem.tipo == 'EMAIL' || tarefaItem.tipo == 'TRAMITAR_PRINCIPAL') && tarefaItem.tipoResponsavel == 'LOTACAO'"
+									class="col col-12 col-md-3 col-lg-3 form-group"> <label
+									for="refUnidadeResponsavel" title="" class="label">Lotação
+									Resp. Resp.
+									<div minlength="1" selected-object="selectedObject"
+										focus-first="true" text-searching="Pesquisando Unidades..."
+										initial-value="tarefaItem.refUnidadeResponsavel.originalObject"
+										title-field="firstLine" description-field="secondLine"
+										input-class="form-control form-control-small"
+										remote-url-data-field="list" pause="200"
+										text-no-results="Não encontrei nenhuma Unidade."
+										match-class="highlight"
+										selected-object-data="{context:tarefaItem, variable: 'refUnidadeResponsavel', full:false}"
+										remote-url="/siga/app/lotacao/buscar-json/" angucomplete-alt
+										name="refUnidadeResponsavel" placeholder="Pesquisar Unidade"
+										id="refUnidadeResponsavel" class="angucomplete-ctrl p-0"
+										template-url="/sigawf/js/angucomplete-alt/custom-template.html"></div>
+								</label> </section>
+								<section
+									ng-show="(tarefaItem.tipo == 'FORMULARIO' || tarefaItem.tipo == 'INCLUIR_DOCUMENTO' || tarefaItem.tipo == 'EMAIL' || tarefaItem.tipo == 'TRAMITAR_PRINCIPAL') && tarefaItem.tipoResponsavel == 'PESSOA'"
+									class="col col-12 col-md-3 col-lg-3 form-group"> <label
+									for="refPessoaResponsavel" title="" class="label">Pessoa
+									Resp.
+									<div minlength="1" selected-object="selectedObject"
+										focus-first="true" text-searching="Pesquisando Pessoas..."
+										initial-value="tarefaItem.refPessoaResponsavel.originalObject"
+										title-field="firstLine" description-field="secondLine"
+										input-class="form-control form-control-small"
+										remote-url-data-field="list" pause="200"
+										text-no-results="Não encontrei nenhuma Pessoa."
+										match-class="highlight"
+										selected-object-data="{context:tarefaItem, variable: 'refPessoaResponsavel', full:false}"
+										remote-url="/siga/app/pessoa/buscar-json/" angucomplete-alt
+										name="refPessoaResponsavel" placeholder="Pesquisar Pessoa"
+										id="refPessoaResponsavel" class="angucomplete-ctrl p-0"
+										template-url="/sigawf/js/angucomplete-alt/custom-template.html"></div>
+								</label> </section>
+								<section
+									ng-show="(tarefaItem.tipo == 'FORMULARIO' || tarefaItem.tipo == 'INCLUIR_DOCUMENTO' || tarefaItem.tipo == 'EMAIL' || tarefaItem.tipo == 'TRAMITAR_PRINCIPAL') && tarefaItem.tipoResponsavel == 'RESPONSAVEL'"
+									class="col col-12 col-md-3 col-lg-3 form-group"> <label
+									for="refResponsavel" title="" class="label">Responsável
+									<select ng-model="tarefaItem.refResponsavel"
+									ng-options="item.hisIdIni as item.nome for item in responsaveis"
+									class="form-control"></select>
+								</label> </section>
+								<section ng-show="tarefaItem.tipo == 'INCLUIR_DOCUMENTO'"
+									class="col col-12 col-md-3 col-lg-3 form-group"> <label
+									for="ref" title="" class="label">Modelo
+									<div minlength="1" selected-object="selectedObject"
+										focus-first="true"
+										text-searching="Pesquisando Modelo Documental..."
+										initial-value="tarefaItem.ref.originalObject"
+										title-field="firstLine" description-field="secondLine"
+										input-class="form-control form-control-small"
+										remote-url-data-field="list" pause="200"
+										text-no-results="Não encontrei nenhuma Tipologia Documental."
+										match-class="highlight"
+										selected-object-data="{context:tarefaItem, variable: 'ref', full:false}"
+										remote-url="/sigaex/app/modelo/buscar-json/" angucomplete-alt
+										name="ref" placeholder="Pesquisar Tipologia Documental"
+										id="ref" class="form-control angucomplete-ctrl"
+										template-url="/sigawf/js/angucomplete-alt/custom-template.html"></div>
+								</label> </section>
+								<fieldset ng-show="tarefaItem.tipo == 'FORMULARIO'"
+									title="Variáveis" class="col col-12">
+									<header class="form-group juia">
+									<div class="row align-items-center">
+										<div class="col col-auto">Variáveis</div>
+										<div class="col col-auto ml-auto">
+											<button
+												ng-click="tarefaItem.variavel = (tarefaItem.variavel || []);tarefaItem.variavel.push({});"
+												style="margin-left: 1em;"
+												class="juia btn btn-sm btn-secondary">
+												<i class="fa fa-plus"></i>&nbsp;Variável
+											</button>
+										</div>
+									</div>
+									</header>
+									<div ng-repeat="variavelItem in tarefaItem.variavel"
+										class="row">
+										<div class="col col-auto">
+											<section> <label title="" class="label">&nbsp;</label>
+											<label class="input float-right"><div role="group"
+													class="btn-group">
+													<div role="group" class="btn-group dropright">
+														<button data-toggle="dropdown" aria-expanded="false"
+															aria-haspopup="true" id="dropBtn"
+															class="btn btn-secondary dropdown-toggle">{{$index+1}}</button>
+														<div aria-labelledby="dropBtn"
+															class="dropdown-menu pt-0 pb-0">
+															<button ng-click="tarefaItem.variavel.splice($index, 1);"
+																class="btn btn-link" ng-disabled>
+																<i class="fa fa-fa fa-trash"></i>
+															</button>
+															<button
+																ng-click="tarefaItem.variavel[$index] = tarefaItem.variavel.splice($index - 1, 1, tarefaItem.variavel[$index])[0]"
+																class="btn btn-link" ng-disabled="$index === 0">
+																<i class="fa fa-fa fa-arrow-up"></i>
+															</button>
+															<button
+																ng-click="tarefaItem.variavel[$index] = tarefaItem.variavel.splice($index + 1, 1, tarefaItem.variavel[$index])[0]"
+																class="btn btn-link"
+																ng-disabled="$index === tarefaItem.variavel.length - 1">
+																<i class="fa fa-fa fa-arrow-down"></i>
+															</button>
+														</div>
+													</div>
+												</div></label> </section>
+										</div>
+										<div class="col">
+											<div class="row">
+												<section class="col col-12 col-md-3 form-group"> <label
+													for="titulo" title="" class="label">Título<i
+													title="Preenchimento obrigatório"
+													class="label-clue fa fa-asterisk"></i><input
+													ng-model="variavelItem.titulo" name="titulo"
+													ng-required="true" id="titulo" type="text"
+													class="form-control"></label> </section>
+												<section class="col col-12 col-md-3 form-group"> <label
+													for="identificador" title="" class="label">Identificador<i
+													title="Preenchimento obrigatório"
+													class="label-clue fa fa-asterisk"></i><input
+													ng-model="variavelItem.identificador" name="identificador"
+													ng-required="true" id="identificador" type="text"
+													class="form-control"></label> </section>
+												<section class="col col-12 col-md-3 form-group"> <label
+													for="tipo" title="" class="label">Tipo<i
+													title="Preenchimento obrigatório"
+													class="label-clue fa fa-asterisk"></i><select
+													ng-model="variavelItem.tipo" ng-required="true"
+													class="form-control"><option value="STRING">String</option>
+														<option value="DATE">Data</option>
+														<option value="BOOLEAN">Booleana</option></select></label> <i></i> </section>
+												<section class="col col-12 col-md-3 form-group"> <label
+													for="tipoDeEdicao" title="" class="label">Edição<i
+													title="Preenchimento obrigatório"
+													class="label-clue fa fa-asterisk"></i><select
+													ng-model="variavelItem.tipoDeEdicao" ng-required="true"
+													class="form-control"><option value="READ_WRITE">Leitura
+															e Escrita</option>
+														<option value="READ_ONLY">Apenas Leitura</option></select></label> <i></i>
+												</section>
+											</div>
+										</div>
+									</div>
+								</fieldset>
+								<fieldset
+									ng-show="tarefaItem.tipo == 'FORMULARIO' || tarefaItem.tipo == 'DECISAO'"
+									title="Desvios" class="col col-12">
+									<header class="form-group juia">
+									<div class="row align-items-center">
+										<div class="col col-auto">Desvios</div>
+										<div class="col col-auto ml-auto">
+											<button
+												ng-click="tarefaItem.desvio = (tarefaItem.desvio || []);tarefaItem.desvio.push({});"
+												style="margin-left: 1em;"
+												class="juia btn btn-sm btn-secondary">
+												<i class="fa fa-plus"></i>&nbsp;Desvio
+											</button>
+										</div>
+									</div>
+									</header>
+									<div ng-repeat="desvioItem in tarefaItem.desvio" class="row">
+										<div class="col col-auto">
+											<section> <label title="" class="label">&nbsp;</label>
+											<label class="input float-right"><div role="group"
+													class="btn-group">
+													<div role="group" class="btn-group dropright">
+														<button data-toggle="dropdown" aria-expanded="false"
+															aria-haspopup="true" id="dropBtn"
+															class="btn btn-secondary dropdown-toggle">{{$index+1}}</button>
+														<div aria-labelledby="dropBtn"
+															class="dropdown-menu pt-0 pb-0">
+															<button ng-click="tarefaItem.desvio.splice($index, 1);"
+																class="btn btn-link" ng-disabled>
+																<i class="fa fa-fa fa-trash"></i>
+															</button>
+															<button
+																ng-click="tarefaItem.desvio[$index] = tarefaItem.desvio.splice($index - 1, 1, tarefaItem.desvio[$index])[0]"
+																class="btn btn-link" ng-disabled="$index === 0">
+																<i class="fa fa-fa fa-arrow-up"></i>
+															</button>
+															<button
+																ng-click="tarefaItem.desvio[$index] = tarefaItem.desvio.splice($index + 1, 1, tarefaItem.desvio[$index])[0]"
+																class="btn btn-link"
+																ng-disabled="$index === tarefaItem.desvio.length - 1">
+																<i class="fa fa-fa fa-arrow-down"></i>
+															</button>
+														</div>
+													</div>
+												</div></label> </section>
+										</div>
+										<div class="col">
+											<div class="row">
+												<section class="col col-12 col-md-4 form-group"> <label
+													for="titulo" title="" class="label">Título<i
+													title="Preenchimento obrigatório"
+													class="label-clue fa fa-asterisk"></i><input
+													ng-model="desvioItem.titulo" name="titulo"
+													ng-required="true" id="titulo" type="text"
+													class="form-control"></label> </section>
+												<section class="col col-12 col-md-4 form-group"> <label
+													for="tarefa" title="" class="label">Tarefa<select
+													ng-selected="desvioItem.tarefa"
+													ng-model="desvioItem.tarefa" ng-init=""
+													ng-options="item.id as item.nome disable when item.id === tarefaItem.id for item in tarefas"
+													class="form-control"><option value="">[Nenhum]</option></select></label>
+												<i></i> </section>
+												<section class="col col-12 col-md-4 form-group"> <label
+													for="condicao" title="" class="label">Condição<input
+													ng-model="desvioItem.condicao" name="condicao"
+													id="condicao" type="text" class="form-control"></label> </section>
+											</div>
+										</div>
+									</div>
+								</fieldset>
+								<section ng-show="tarefaItem.tipo == 'EMAIL'"
+									class="col col-12 col-md-3 col-lg-3 form-group"> <label
+									for="assunto" title="" class="label">Assunto<i
+									title="Preenchimento obrigatório"
+									class="label-clue fa fa-asterisk"></i><input
+									ng-model="tarefaItem.assunto" name="assunto" ng-required="true"
+									id="assunto" type="text" class="form-control"></label> </section>
+								<section ng-show="tarefaItem.tipo == 'EMAIL'"
+									class="col col-12 form-group"> <label for="texto"
+									title="" class="label">Texto<i
+									title="Preenchimento obrigatório"
+									class="label-clue fa fa-asterisk"></i> <textarea
+										ng-model="tarefaItem.texto" name="texto" ng-required="true"
+										id="texto" class="form-control"></textarea></label> </section>
+							</div>
+						</div>
+					</div>
+				</div>
+				<div
+					ng-show="data.workflow.tarefa &amp;&amp; data.workflow.tarefa.length > 0"
+					class="col col-12 col-md-4">
+					<header class="juia form-group">
+					<div class="row align-items-center"></div>
+					<div class="col col-auto">Workflow</div>
+					</header>
+					<div class="graph-container-tall border border-light rounded">
+						<div id="graph-workflow" class="graph-svg"></div>
+					</div>
+				</div>
+			</div>
+		</fieldset>
+
+		<div class="row">
+			<div class="col-sm-12">
+				<div class="form-group mb-0">
+					<button class="btn btn-primary" ng-click="gravar()">Ok</button>
+					<button value="Desativar" class="btn btn-primary"
+						ng-click="desativar()">Desativar</button>
+					<button onclick="javascript:history.back();"
+						class="btn btn-primary">Cancelar</button>
+				</div>
+			</div>
+		</div>
+	</div>
+
+</siga:pagina>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfDiagrama/lista.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfDiagrama/lista.jsp
new file mode 100644
index 0000000000..761ed1bd9f
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfDiagrama/lista.jsp
@@ -0,0 +1,39 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
+	buffer="32kb"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
+<%@ taglib uri="http://localhost/customtag" prefix="tags"%>
+<%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+
+<siga:pagina titulo="Lista de Diagramas">
+	<div class="container-fluid content mb-3">
+		<h3>Lista de Diagramas</h3>
+		<table class="table table-sm table-striped">
+			<thead class="thead-dark">
+				<tr class="header">
+					<th>Sigla</th>
+					<th>Nome</th>
+					<th>Descrição</th>
+				</tr>
+			</thead>
+			<tbody class="table-bordered">
+				<c:forEach var="item" items="${itens}">
+					<tr>
+						<td><c:url var="url" value="editar">
+								<c:param name="id" value="${item.id}" />
+							</c:url> <a href="${url}">${item.sigla}</a></td>
+						<td>${item.nome}</td>
+						<td>${item.descr}</td>
+					</tr>
+				</c:forEach>
+			</tbody>
+		</table>
+		<form>
+			<div class="gt-table-buttons">
+				<a href="editar" class="btn btn-primary" style="cursor: pointer;"
+					accesskey="n"><u>N</u>ovo Diagrama</a>
+			</div>
+		</form>
+	</div>
+</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfRelatorio/listarParaGerarRelatorios.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfRelatorio/listarParaGerarRelatorios.jsp
new file mode 100644
index 0000000000..4793e6ea19
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfRelatorio/listarParaGerarRelatorios.jsp
@@ -0,0 +1,31 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
+	buffer="32kb"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
+<%@ taglib uri="http://localhost/customtag" prefix="tags"%>
+<%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+
+<siga:pagina titulo="Lista de Diagramas">
+	<div class="container-fluid content mb-3">
+		<h3>Relatório de Procedimento</h3>
+		<table class="table table-sm table-striped">
+			<thead class="thead-dark">
+				<tr class="header">
+					<th>Sigla</th>
+					<th>Nome</th>
+					<th>Descrição</th>
+				</tr>
+			</thead>
+			<tbody class="table-bordered">
+				<c:forEach var="item" items="${itens}">
+					<tr>
+						<td><a href="${linkTo[WfRelatorioController].medir(item.sigla)}">${item.sigla}</a></td>
+						<td>${item.nome}</td>
+						<td>${item.descr}</td>
+					</tr>
+				</c:forEach>
+			</tbody>
+		</table>
+	</div>
+</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfRelatorio/medir.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfRelatorio/medir.jsp
new file mode 100644
index 0000000000..87ea85608c
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfRelatorio/medir.jsp
@@ -0,0 +1,109 @@
+<%@ include file="/WEB-INF/page/include.jsp"%>
+
+<script type="text/javascript">
+	function exibirOpcoesExtras() {
+		if ($("#selecaoRelatorio").val() == '2'
+				|| $("#selecaoRelatorio").val() == '3') {
+			$("#opcoesExtras").show();
+		} else {
+			$("#opcoesExtras").hide();
+		}
+		if ($("#selecaoRelatorio").val() == '1') {
+			$("#opcaoPercentualMediaTruncada").show();
+		} else {
+			$("#opcaoPercentualMediaTruncada").hide();
+		}
+		if ($("#selecaoRelatorio").val() == '3') {
+			$("#opcaoGrupos").show();
+		} else {
+			$("#opcaoGrupos").hide();
+		}
+
+	}
+</script>
+
+<siga:pagina titulo="Estatística de procedimento">
+	<div class="container-fluid content">
+		<div class="card bg-light mb-3">
+			<div class="card-header">
+				<h5>${titulo_pagina}</h5>
+			</div>
+			<div class="card-body">
+				<div class="gt-content-box gt-for-table">
+					<form name="frmRelatorio" method="get" class="form" action="${linkTo[WfRelatorioController].relatorio}">
+						<input type="hidden" name="pdId" value="${pdId}" /> <input
+							type="hidden" name="orgao" value="${orgao}" /> <input
+							type="hidden" name="procedimento" value="${procedimento.nome}" />
+						<table class="gt-form-table">
+							<tr>
+								<td>Órgão</td>
+								<td>${orgao}</td>
+							</tr>
+							<tr>
+								<td>Procedimento</td>
+								<td>${procedimento.nome}</td>
+							</tr>
+							<tr>
+								<siga:select list="listaTipoRelatorio" listKey="id"
+									listValue="descr" label="Relatório" name="selecaoRelatorio"
+									id="selecaoRelatorio"
+									onchange="javascript:exibirOpcoesExtras()" />
+							</tr>
+							<tr>
+								<td width="25%">Procedimento iniciado de:</td>
+								<td><input type="text" name="dataInicialDe"
+									onblur="javascript:verifica_data(this, true);comparaData(dataInicialDe,dataInicialAte);
+				comparaData(dataInicialAte,dataFinalDe)"
+									size="12" maxlength="10" /> até <input type="text"
+									name="dataInicialAte"
+									onblur="javascript:verifica_data(this, true);comparaData(dataInicialDe,dataInicialAte);
+				comparaData(dataInicialAte,dataFinalDe)"
+									size="12" maxlength="10" /></td>
+							</tr>
+							<tr>
+								<td>Procedimento finalizado de:</td>
+								<td><input type="text" name="dataFinalDe"
+									onblur="javascript:verifica_data(this,true);comparaData(dataInicialDe,dataInicialAte);
+				comparaData(dataInicialAte,dataFinalDe);"
+									size="12" maxlength="10" /> até <input type="text"
+									name="dataFinalAte"
+									onblur="javascript:verifica_data(this,true);comparaData(dataInicialDe,dataInicialAte);
+				comparaData(dataInicialAte,dataFinalDe);"
+									size="12" maxlength="10" /></td>
+							</tr>
+							<tr id="opcoesExtras" style="display: none">
+								<td><input type="checkbox" id="incluirAbertos"
+									name="incluirAbertos" style="float: left"
+									class="gt-form-checkbox"></input> <label>&nbsp;Incluir
+										Procedimentos Abertos</label></td>
+							</tr>
+							<tr id="opcaoPercentualMediaTruncada">
+								<td><label>Percentual&nbsp;da&nbsp;Média&nbsp;Truncada
+										(entre ${minMediaTruncada}% e ${maxMediaTruncada}%):</label></td>
+								<td><input type="text" id="percentualMediaTruncada"
+									name="percentualMediaTruncada" style="float: left"
+									class="gt-form-text" value="${minMediaTruncada}"></input></td>
+							</tr>
+							<tr id="opcaoGrupos" style="display: none">
+								<td>Agrupar tarefas (opcional)</td>
+								<td><label>Tarefa inicial:</label> <siga:select id="grpIni"
+										name="grpIni" list="lstGruposIni" listValue="nome"
+										listKey="id" headerKey="-1" headerValue="[Escolha uma tarefa]"
+										theme="simple" /> <label>Tarefa final:</label> <siga:select
+										id="grpFim" name="grpFim" list="lstGruposFim" listValue="nome"
+										listKey="id" headerKey="-1" headerValue="[Escolha uma tarefa]"
+										theme="simple" /></td>
+							</tr>
+						</table>
+						<div class="row mt-2">
+							<div class="col-sm-8">
+								<button type="button" onclick="javascript:frmRelatorio.submit()"
+									class="btn btn-primary">Gerar</button>
+							</div>
+						</div>
+					</form>
+				</div>
+			</div>
+		</div>
+	</div>
+</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/edita.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/edita.jsp
new file mode 100644
index 0000000000..6f1e17f2cf
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/edita.jsp
@@ -0,0 +1,70 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<%@ page language="java" contentType="text/html; charset=UTF-8"
+	buffer="64kb"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
+
+<%@ taglib uri="http://localhost/customtag" prefix="tags"%>
+<%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+
+<siga:pagina titulo="Responsável">
+	<div class="container-fluid content" ng-app="app" ng-controller="ctrl">
+		<h5>Edição de Responsável</h5>
+
+		<form name="frm" method="post" action="/sigawf/app/responsavel/gravar"
+			class="form">
+			<input type="hidden" name="id" value="${dr.id}" />
+			<fieldset title="Dados Básicos">
+				<div class="row">
+					<div class="col-sm-4">
+						<div class="form-group">
+							<label>Nome</label> <input type="text" name="nome"
+								value="${dr.nome}" size="80" class="form-control" />
+						</div>
+					</div>
+					<div class="col-sm-8">
+						<div class="form-group">
+							<label>Descrição</label> <input type="text" name="descr"
+								value="${dr.descr}" size="80" class="form-control" />
+						</div>
+					</div>
+				</div>
+			</fieldset>
+
+			<c:if test="${not empty dr}">
+				<fieldset title="Designações">
+					<table class="table table-sm table-striped">
+						<tr class="header">
+							<td>Órgão Usuário</td>
+							<td>Responsável</td>
+						</tr>
+
+						<c:forEach var="r" items="${itens}" varStatus="loop">
+							<tr>
+								<td>${r.orgaoSigla}</td>
+								<td><input type="hidden"
+									name="itens[${loop.index}].orgaoId" value="${r.orgaoId}" />
+								<siga:pessoaLotaSelecao2
+										propriedadeLotacao="itens[${loop.index}].lotacao"
+										propriedadePessoa="itens[${loop.index}].pessoa" /></td>
+							</tr>
+						</c:forEach>
+					</table>
+				</fieldset>
+			</c:if>
+
+			<div class="row">
+				<div class="col-sm-12">
+					<div class="form-group mb-0">
+						<button class="btn btn-primary"
+							onclick="javascript:gravarResponsabilidade()">Ok</button>
+						<button value="Desativar" class="btn btn-primary"
+							ng-click="desativar()">Desativar</button>
+						<button onclick="javascript:history.back();"
+							class="btn btn-primary">Cancelar</button>
+					</div>
+				</div>
+			</div>
+		</form>
+	</div>
+
+</siga:pagina>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/lista.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/lista.jsp
new file mode 100644
index 0000000000..2a8eddba16
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/lista.jsp
@@ -0,0 +1,36 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
+	buffer="32kb"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
+<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
+<%@ taglib uri="http://localhost/customtag" prefix="tags"%>
+<%@ taglib uri="http://localhost/jeetags" prefix="siga"%>
+
+<siga:pagina titulo="Lista de Diagramas">
+	<div class="container-fluid content mb-3">
+		<h3>Lista de Responsáveis</h3>
+		<table class="table table-sm table-striped">
+			<thead class="thead-dark">
+				<tr class="header">
+					<th>Nome</th>
+					<th>Descrição</th>
+				</tr>
+			</thead>
+			<tbody class="table-bordered">
+				<c:forEach var="item" items="${itens}">
+					<tr>
+						<td><a
+							href="${linkTo[WfResponsavelController].edita(item.id)}">${item.nome}</a></td>
+						<td>${item.descr}</td>
+					</tr>
+				</c:forEach>
+			</tbody>
+		</table>
+		<form>
+			<div class="gt-table-buttons">
+				<a href="novo" class="btn btn-primary" style="cursor: pointer;"
+					accesskey="n"><u>N</u>ovo Responsável</a>
+			</div>
+		</form>
+	</div>
+</siga:pagina>
diff --git a/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/pesquisar.jsp b/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/pesquisar.jsp
new file mode 100644
index 0000000000..6070221cab
--- /dev/null
+++ b/sigawf/src/main/webapp/WEB-INF/page/wfResponsavel/pesquisar.jsp
@@ -0,0 +1,222 @@
+<%@ include file="/WEB-INF/page/include.jsp"%>
+
+<script type="text/javascript">
+	function solicitarInformacao(tarefa) {
+
+		var objSelecionado = document.getElementById('tipoResponsavel_'
+				+ tarefa);
+
+		document.getElementById('formulario_lotacao_' + tarefa
+				+ '_lotacaoSel_id').value = "";
+		document.getElementById('formulario_matricula_' + tarefa
+				+ '_pessoaSel_id').value = "";
+
+		document.getElementById('formulario_lotacao_' + tarefa
+				+ '_lotacaoSel_sigla').value = "";
+		document.getElementById('formulario_matricula_' + tarefa
+				+ '_pessoaSel_sigla').value = "";
+
+		document.getElementById('formulario_lotacao_' + tarefa
+				+ '_lotacaoSel_descricao').value = "";
+		document.getElementById('formulario_matricula_' + tarefa
+				+ '_pessoaSel_descricao').value = "";
+
+		document.getElementById('lotacao_' + tarefa
+				+ '_lotacaoSelSpan').value = "";
+		document.getElementById('matricula_' + tarefa
+				+ '_pessoaSelSpan').value = "";
+
+		switch (objSelecionado.selectedIndex) {
+
+		//Não Definido
+		case 0:
+			break;
+		//Usuário
+		case 1:
+			var tipo = "matricula";
+			break;
+		//Lotação	
+		case 2:
+			var tipo = "lotacao";
+			break;
+		//Lotação superior	
+		case 3:
+			break;
+		//Superior hierárquico	
+		case 4:
+			break;
+		//Expressão	
+		case 5:
+			var tipo = "expressao";
+			break;
+		}
+
+		var div = tipo + '_' + tarefa;
+		document.getElementById('lotacao_' + tarefa).style.display = "none";
+		document.getElementById('matricula_' + tarefa).style.display = "none";
+		document.getElementById('expressao_' + tarefa).style.display = "none";
+
+		if (document.getElementById(div) != null) {
+			document.getElementById(div).style.display = "inline"
+		}
+	}
+
+	function gravarResponsabilidade() {
+		var frm = document.getElementById("formulario");
+		frm.action = '${linkTo[DesignacaoController].gravar}';
+		frm.submit();
+	}
+
+	function pesquisarProcedimento() {
+		var frm = document.getElementById("formulario");
+		var e1 = document.getElementById("orgao");
+		var orgao = e1.options[e1.selectedIndex].value;
+		var e2 = document.getElementById("procedimento");
+		var procedimento = e2.options[e2.selectedIndex].value;
+		window.location.href = '${linkTo[DesignacaoController].pesquisar}'.replace(/\/\/$/, '/' + orgao + '/' + procedimento);
+	}
+</script>
+
+<siga:pagina titulo="Definição de Responsabilidades">
+	<div class="gt-bd clearfix">
+		<div class="gt-content clearfix">
+			<h2>Definição de Responsabilidades</h2>
+			<h4>Seleção de Órgão e Procedimento</h4>
+			<div class="gt-content-box gt-for-table">
+				<form id="formulario" action="" method="POST" class="form">
+
+					<table class="gt-form-table">
+						<siga:select label="Órgão" id="orgao" name="orgao" list="listaOrgao"
+							listValue="acronimoOrgaoUsu" listKey="acronimoOrgaoUsu"
+							multiple="false"/>
+						<siga:select label="Procedimento" id="procedimento" name="procedimento"
+							list="listaProcedimento" listValue="name" listKey="name"
+							multiple="false" />
+						<tr>
+							<td colspan="2"><input type="button" value="Pesquisar"
+								onclick="javascript:pesquisarProcedimento()"
+								class="gt-btn-medium gt-btn-left" /></td>
+						</tr>
+					</table>
+			</div>
+
+			<br />
+			<h4>Responsabilidades</h4>
+			<div class="gt-content-box gt-for-table">
+				<table class="gt-form-table" style="table-layout: fixed;">
+					<tr class="header">
+						<td width="10%">Raia</td>
+						<td width="30%">Tarefa (Nome do nó)</td>
+						<td width="60%">Responsável</td>
+					</tr>
+
+					<!-- raias -->
+
+					<c:forEach var="r" items="${mapaDesignacaoRaia}">
+
+						<c:if test="${not empty r.value[0].id}">
+							<c:set var="idRaia" value="${r.value[0].id}" />
+						</c:if>
+						<c:if test="${not empty r.value[0].tipoResponsavel}">
+							<c:set var="tipoResponsavel"
+								value="${r.value[0].tipoResponsavel}" />
+						</c:if>
+
+						<tr>
+							<td>${r.key}</td>
+
+							<td><c:forEach var="d" items="${r.value}">
+									<span style="cursor: help;" title="${d.nomeDoNo}">${d.tarefa}</span>
+									<br />
+								</c:forEach></td>
+
+							<td>
+								<siga:select id="tipoResponsavel_${idRaia}"
+									name="tipoResponsavel_${idRaia}" list="listaTipoResponsavel"
+									theme="simple" listValue="texto" listKey="id"
+									value="${tipoResponsavel}"
+									onchange="javascript:solicitarInformacao('${idRaia}');" />
+								<div
+									style="display: ${(tipoResponsavel == 1) ? 'inline' : 'none'};"
+									id="matricula_${idRaia}">
+									<siga:selecao modulo="siga" tipo="pessoa" tema="simple"
+										propriedade="matricula_${idRaia}"
+										siglaInicial="${r.value[0].ator.sigla}"
+										idInicial="${r.value[0].ator.id}"
+										descricaoInicial="${r.value[0].ator.descricao}" />
+								</div>
+								<div
+									style="display: ${(tipoResponsavel == 2) ? 'inline' : 'none'};"
+									id="lotacao_${idRaia}">
+									<siga:selecao modulo="siga" tipo="lotacao" tema="simple"
+										propriedade="lotacao_${idRaia}"
+										siglaInicial="${r.value[0].lotaAtor.sigla}"
+										idInicial="${r.value[0].lotaAtor.id}"
+										descricaoInicial="${r.value[0].lotaAtor.descricao}" />
+								</div>
+								<div
+									style="display: ${(tipoResponsavel == 5) ? 'inline' : 'none'};"
+									id="expressao_${idRaia}">
+									<input type="text" width="200" name="expressao_${idRaia}"
+										value="${r.value[0].expressao}" />
+								</div>
+							</td>
+						</tr>
+
+						<c:set var="tipoResponsavel" value="" />
+						<c:set var="idRaia" value="" />
+					</c:forEach>
+
+					<!-- tarefas -->
+					<c:forEach var="dTarefa" items="${listaDesignacaoTarefa}">
+						<tr>
+							<td>${dTarefa.raia}</td>
+							<td><span style="cursor: help;" title="${dTarefa.nomeDoNo}">${dTarefa.tarefa}</span>
+							</td>
+
+							<td>
+							<siga:select id="tipoResponsavel_${dTarefa.id}"
+									name="tipoResponsavel_${dTarefa.id}"
+									list="listaTipoResponsavel" theme="simple" listValue="texto"
+									listKey="id" value="${dTarefa.tipoResponsavel}"
+									onchange="javascript:solicitarInformacao('${dTarefa.id}');" />
+								<div
+									style="display: ${(dTarefa.tipoResponsavel == 1) ? 'inline' : 'none'};"
+									id="matricula_${dTarefa.id}">
+									<siga:selecao modulo="siga" tipo="pessoa" tema="simple"
+										propriedade="matricula_${dTarefa.id}"
+										siglaInicial="${dTarefa.ator.sigla}"
+										idInicial="${dTarefa.ator.id}"
+										descricaoInicial="${dTarefa.ator.descricao}" />
+								</div>
+								<div
+									style="display: ${(dTarefa.tipoResponsavel == 2) ? 'inline' : 'none'};"
+									id="lotacao_${dTarefa.id}">
+									<siga:selecao modulo="siga" tipo="lotacao" tema="simple"
+										propriedade="lotacao_${dTarefa.id}"
+										siglaInicial="${dTarefa.lotaAtor.sigla}"
+										idInicial="${dTarefa.lotaAtor.id}"
+										descricaoInicial="${dTarefa.lotaAtor.descricao}" />
+								</div>
+								<div
+									style="display: ${(dTarefa.tipoResponsavel == 5) ? 'inline' : 'none'};"
+									id="expressao_${dTarefa.id}">
+									<input type="text" name="expressao_${dTarefa.id}"
+										value="${dTarefa.expressao}" />
+								</div>
+								</td>
+						</tr>
+					</c:forEach>
+					<tr>
+						<td align="right" width="90%"><input type="button"
+							value="Gravar" onclick="javascript:gravarResponsabilidade()"
+							class="gt-btn-medium gt-btn-left" /></td>
+					</tr>
+				</table>
+				<form>
+			</div>
+		</div>
+	</div>
+</siga:pagina>
+
+
diff --git a/sigawf/src/main/webapp/WEB-INF/picketlink.xml b/sigawf/src/main/webapp/WEB-INF/picketlink.xml
deleted file mode 100644
index bcc2fbb224..0000000000
--- a/sigawf/src/main/webapp/WEB-INF/picketlink.xml
+++ /dev/null
@@ -1,16 +0,0 @@
-<PicketLink xmlns="urn:picketlink:identity-federation:config:2.1">
-	<PicketLinkSP xmlns="urn:picketlink:identity-federation:config:2.1" ServerEnvironment="tomcat" BindingType="POST">
-		<IdentityURL>${idp.url::/sigaidp/}</IdentityURL>
-		<ServiceURL>${sigawf.url::/sigawf/}</ServiceURL>
-	</PicketLinkSP>
-	
-	<Handlers xmlns="urn:picketlink:identity-federation:handler:config:2.1">
-		<Handler class="org.picketlink.identity.federation.web.handlers.saml2.SAML2LogOutHandler" />
-		<Handler class="org.picketlink.identity.federation.web.handlers.saml2.SAML2AuthenticationHandler" >
-		    <Option Key="CLOCK_SKEW_MILIS" Value="120000"/>
-		</Handler>
-		<Handler class="org.picketlink.identity.federation.web.handlers.saml2.RolesGenerationHandler" />
-		<Handler class="org.picketlink.identity.federation.web.handlers.saml2.SAML2AttributeHandler"/>
-	</Handlers>
-	
-</PicketLink>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/tags/func.tld b/sigawf/src/main/webapp/WEB-INF/tags/func.tld
index 983845c1d2..6ca7a4f928 100644
--- a/sigawf/src/main/webapp/WEB-INF/tags/func.tld
+++ b/sigawf/src/main/webapp/WEB-INF/tags/func.tld
@@ -1,5 +1,6 @@
 <?xml version="1.0"?>
-<taglib xmlns="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+<taglib xmlns="http://java.sun.com/xml/ns/j2ee"
+	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 	xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd"
 	version="2.0">
 
@@ -13,17 +14,20 @@
 	<function>
 		<name>ordenarTransicoes</name>
 		<function-class>br.gov.jfrj.siga.wf.util.FuncoesEL</function-class>
-		<function-signature>java.util.List ordenarTransicoes(org.jbpm.taskmgmt.exe.TaskInstance)</function-signature>
+		<function-signature>java.util.List
+			ordenarTransicoes(org.jbpm.taskmgmt.exe.TaskInstance)</function-signature>
 	</function>
 	<function>
 		<name>ordenarTarefas</name>
 		<function-class>br.gov.jfrj.siga.wf.util.FuncoesEL</function-class>
-		<function-signature>java.util.List ordenarTarefas(org.jbpm.taskmgmt.exe.TaskInstance)</function-signature>
+		<function-signature>java.util.List
+			ordenarTarefas(org.jbpm.taskmgmt.exe.TaskInstance)</function-signature>
 	</function>
 	<function>
 		<name>ordenarComentarios</name>
 		<function-class>br.gov.jfrj.siga.wf.util.FuncoesEL</function-class>
-		<function-signature>java.util.List ordenarComentarios(org.jbpm.taskmgmt.exe.TaskInstance)</function-signature>
+		<function-signature>java.util.List
+			ordenarComentarios(org.jbpm.taskmgmt.exe.TaskInstance)</function-signature>
 	</function>
 	<function>
 		<name>listarOpcoes</name>
@@ -33,6 +37,9 @@
 	<function>
 		<name>podePegarTarefa</name>
 		<function-class>br.gov.jfrj.siga.wf.util.FuncoesEL</function-class>
-		<function-signature>java.util.Boolean podePegarTarefa(br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.dp.DpLotacao, org.jbpm.taskmgmt.exe.TaskInstance)</function-signature>
+		<function-signature>java.util.Boolean
+			podePegarTarefa(br.gov.jfrj.siga.dp.DpPessoa,
+			br.gov.jfrj.siga.dp.DpPessoa, br.gov.jfrj.siga.dp.DpLotacao,
+			br.gov.jfrj.siga.dp.DpLotacao, br.gov.jfrj.siga.wf.util.WfTarefa)</function-signature>
 	</function>
 </taglib>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/WEB-INF/web.xml b/sigawf/src/main/webapp/WEB-INF/web.xml
index a4b972d463..bb7d86fa3f 100644
--- a/sigawf/src/main/webapp/WEB-INF/web.xml
+++ b/sigawf/src/main/webapp/WEB-INF/web.xml
@@ -3,19 +3,11 @@
 	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd">
 	<display-name>sigawf</display-name>
-	
+
 	<!-- habilita replicacao dos dados da sessao do usuario no cluster -->
 	<!--distributable/ -->
 
 	<jsp-config>
-		<taglib>
-			<taglib-uri>http://localhost/customtag</taglib-uri>
-			<taglib-location>/WEB-INF/tags/tags.tld</taglib-location>
-		</taglib>
-		<taglib>
-			<taglib-uri>http://localhost/functiontag</taglib-uri>
-			<taglib-location>/WEB-INF/tags/func.tld</taglib-location>
-		</taglib>
 		<jsp-property-group>
 			<description>Property group for common configuration for all the JSP's</description>
 			<url-pattern>*.jsp</url-pattern>
@@ -42,7 +34,7 @@
 		<dispatcher>FORWARD</dispatcher>
 		<dispatcher>REQUEST</dispatcher>
 	</filter-mapping>
-	
+
 	<filter>
 		<filter-name>RequestLoggerFilter</filter-name>
 		<filter-class>br.gov.jfrj.siga.base.log.RequestLoggerFilter</filter-class>
@@ -52,16 +44,6 @@
 		<url-pattern>*</url-pattern>
 	</filter-mapping>
 
-	<filter>
-		<filter-name>WfFilter</filter-name>
-		<filter-class>br.gov.jfrj.siga.wf.util.WfThreadFilter</filter-class>
-	</filter>
-	<filter-mapping>
-		<filter-name>WfFilter</filter-name>
-		<url-pattern>/servicos/*</url-pattern>
-		<url-pattern>/upload</url-pattern>
-	</filter-mapping>
-	
 	<filter>
 		<filter-name>vraptor</filter-name>
 		<filter-class>br.com.caelum.vraptor.VRaptor</filter-class>
@@ -111,16 +93,6 @@
 		<url-pattern>/servicos/*</url-pattern>
 	</servlet-mapping>
 
-	<servlet>
-		<servlet-name>UploadServlet</servlet-name>
-		<servlet-class>br.gov.jfrj.siga.wf.servlet.UploadServlet</servlet-class>
-	</servlet>
-
-	<servlet-mapping>
-		<servlet-name>UploadServlet</servlet-name>
-		<url-pattern>/upload</url-pattern>
-	</servlet-mapping>
-
 	<!-- Inicio de WebServer -->
 	<context-param>
 		<param-name>br.com.caelum.vraptor.provider</param-name>
@@ -144,7 +116,24 @@
 		<url-pattern>/servicos/WfService</url-pattern>
 	</servlet-mapping>
 
+	<servlet>
+		<servlet-name>ErrorHandler</servlet-name>
+		<servlet-class>br.gov.jfrj.siga.jee.SigaErrorHandlerServlet</servlet-class>
+	</servlet>
+
+	<!-- servlet mappings -->
+	<servlet-mapping>
+		<servlet-name>ErrorHandler</servlet-name>
+		<url-pattern>/ErrorHandler</url-pattern>
+	</servlet-mapping>
+
+	<error-page>
+		<error-code>404</error-code>
+		<location>/ErrorHandler</location>
+	</error-page>
+
 	<error-page>
-		<location>/WEB-INF/page/erroGeral.jsp</location>
+		<exception-type>java.lang.Throwable</exception-type>
+		<location>/ErrorHandler</location>
 	</error-page>
 </web-app>
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/css/diagrama.css b/sigawf/src/main/webapp/css/diagrama.css
new file mode 100644
index 0000000000..f9b947c2cc
--- /dev/null
+++ b/sigawf/src/main/webapp/css/diagrama.css
@@ -0,0 +1,121 @@
+.xrp-label-container {
+	margin-top: 4px;
+	margin-bottom: 0px;
+}
+
+.xrp-label {
+	font-size: 13px;
+	margin-bottom: 4px;
+	line-height: 1.1;
+	padding-left: 7px;
+	padding-right: 7px;
+	/* border-radius: 5px */
+}
+
+.label-clue {
+	margin-left: 0.25em;
+	color: #aaa;
+	font-size: 60%;
+	/*	float: right;
+	margin-top: 4px; */
+}
+
+.validation-error {
+	border-color: #e74c3c !important;
+}
+
+.graph-container {
+	position: relative;
+	width: 100%;
+	padding-top: 56.25%; /* 16:9 Aspect Ratio */
+}
+
+.graph-container-tall {
+	position: relative;
+	width: 100%;
+	padding-top: 120%;
+}
+
+.graph-svg {
+	position: absolute;
+	top: 0;
+	left: 0;
+	bottom: 0;
+	right: 0;
+	text-align: center;
+	background-color: white;
+}
+
+.xrp-actions {
+	margin-bottom: 0;
+}
+
+.form-check-input {
+	margin-right: 0.5em !important;
+}
+
+.form-check-label {
+	display: inline;
+}
+
+/* JUIA */
+header.juia {
+	padding: 0.75rem 1rem;
+	margin-bottom: 1rem;
+	list-style: none;
+	background-color: #e2e3e5 !important;
+	color: #383d41;
+	opacity: 1;
+	border-radius: 0.25rem;
+}
+
+/* JUIA */
+header.juia-strong {
+	padding: 0.75rem 1rem;
+	margin-bottom: 1rem;
+	list-style: none;
+	background-color: var(- -dark) !important;
+	color: #fff;
+	opacity: 1;
+	border-radius: 0.25rem;
+}
+
+.juia-title {
+	padding: 0.75rem 1rem;
+	margin-left: -15px;
+	margin-right: -15px;
+	margin-bottom: 1rem;
+	list-style: none;
+	background-color: var(- -primary) !important;
+	opacity: 1;
+	color: #fff;
+	border-radius: 0;
+}
+
+.juia-title-old {
+	padding: 0.75rem 1rem;
+	margin-left: -15px;
+	margin-right: -15px;
+	margin-top: -15px;
+	margin-bottom: 1rem;
+	list-style: none;
+	background-color: #e9ecef !important;
+	border-radius: 0.25rem;
+}
+
+.juia-form .label {
+	display: block;
+	margin-bottom: 0px;
+	line-height: 19px;
+	font-weight: 400;
+}
+
+big.juia {
+	font-size: 150%;
+}
+
+#footer:after {
+	clear: both;
+	content: "";
+	display: table;
+}
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.css b/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.css
new file mode 100644
index 0000000000..b937135506
--- /dev/null
+++ b/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.css
@@ -0,0 +1,67 @@
+.angucomplete-holder {
+    position: relative;
+}
+
+.angucomplete-dropdown {
+    border-color: #ececec;
+    border-width: 1px;
+    border-style: solid;
+    border-radius: 2px;
+    width: 100%;
+    padding: 6px;
+    cursor: pointer;
+    z-index: 9999;
+    position: absolute;
+    top: 40px;
+    left: 0px;
+    
+    margin-top: -6px;
+    background-color: #ffffff;
+}
+
+.angucomplete-searching {
+    color: #acacac;
+    font-size: 14px;
+}
+
+.angucomplete-description {
+    font-size: 14px;
+}
+
+.angucomplete-row {
+    padding: 5px;
+    color: #000000;
+    margin-bottom: 4px;
+    clear: both;
+}
+
+.angucomplete-selected-row {
+    background-color: lightblue;
+    color: #ffffff;
+}
+
+.angucomplete-image-holder {
+    padding-top: 2px;
+    float: left;
+    margin-right: 10px;
+    margin-left: 5px;
+}
+
+.angucomplete-image {
+    height: 34px;
+    width: 34px;
+    border-radius: 50%;
+    border-color: #ececec;
+    border-style: solid;
+    border-width: 1px;
+}
+
+.angucomplete-image-default {
+    /* Add your own default image here
+     background-image: url('/assets/default.png');
+    */
+    background-position: center;
+    background-size: contain;
+    height: 34px;
+    width: 34px;
+}
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.js b/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.js
new file mode 100644
index 0000000000..c408825376
--- /dev/null
+++ b/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.js
@@ -0,0 +1,844 @@
+/*
+ * angucomplete-alt
+ * Autocomplete directive for AngularJS
+ * This is a fork of Daryl Rowland's angucomplete with some extra features.
+ * By Hidenari Nozaki
+ */
+
+/*! Copyright (c) 2014 Hidenari Nozaki and contributors | Licensed under the MIT license */
+
+(function (root, factory) {
+  'use strict';
+  if (typeof module !== 'undefined' && module.exports) {
+    // CommonJS
+    module.exports = factory(require('angular'));
+  } else if (typeof define === 'function' && define.amd) {
+    // AMD
+    define(['angular'], factory);
+  } else {
+    // Global Variables
+    factory(root.angular);
+  }
+}(window, function (angular) {
+  'use strict';
+
+  angular.module('angucomplete-alt', []).directive('angucompleteAlt', ['$q', '$parse', '$http', '$sce', '$timeout', '$templateCache', '$interpolate', function ($q, $parse, $http, $sce, $timeout, $templateCache, $interpolate) {
+    // keyboard events
+    var KEY_DW  = 40;
+    var KEY_RT  = 39;
+    var KEY_UP  = 38;
+    var KEY_LF  = 37;
+    var KEY_ES  = 27;
+    var KEY_EN  = 13;
+    var KEY_TAB =  9;
+
+    var MIN_LENGTH = 3;
+    var MAX_LENGTH = 524288;  // the default max length per the html maxlength
+								// attribute
+    var PAUSE = 500;
+    var BLUR_TIMEOUT = 200;
+
+    // string constants
+    var REQUIRED_CLASS = 'autocomplete-required';
+    var TEXT_SEARCHING = 'Searching...';
+    var TEXT_NORESULTS = 'No results found';
+    var TEMPLATE_URL = '/angucomplete-alt/index.html';
+
+    // Set the default template for this directive
+    $templateCache.put(TEMPLATE_URL,
+        '<div class="angucomplete-holder" ng-class="{\'angucomplete-dropdown-visible\': showDropdown}">' +
+        '  <input id="{{id}}_value" name="{{inputName}}" tabindex="{{fieldTabindex}}" ng-class="{\'angucomplete-input-not-empty\': notEmpty}" ng-model="searchStr" ng-disabled="disableInput" type="{{inputType}}" placeholder="{{placeholder}}" maxlength="{{maxlength}}" ng-focus="onFocusHandler()" class="{{inputClass}}" ng-focus="resetHideResults()" ng-blur="hideResults($event)" autocapitalize="off" autocorrect="off" autocomplete="off" ng-change="inputChangeHandler(searchStr)"/>' +
+        '  <div id="{{id}}_dropdown" class="angucomplete-dropdown" ng-show="showDropdown">' +
+        '    <div class="angucomplete-searching" ng-show="searching" ng-bind="textSearching"></div>' +
+        '    <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"></div>' +
+        '    <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}">' +
+        '      <div ng-if="imageField" class="angucomplete-image-holder">' +
+        '        <img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="angucomplete-image"/>' +
+        '        <div ng-if="!result.image && result.image != \'\'" class="angucomplete-image-default"></div>' +
+        '      </div>' +
+        '      <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>' +
+        '      <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div>' +
+        '      <div ng-if="matchClass && result.description && result.description != \'\'" class="angucomplete-description" ng-bind-html="result.description"></div>' +
+        '      <div ng-if="!matchClass && result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}</div>' +
+        '    </div>' +
+        '  </div>' +
+        '</div>'
+    );
+
+    function link(scope, elem, attrs, ctrl) {
+      var inputField = elem.find('input');
+      var minlength = MIN_LENGTH;
+      var searchTimer = null;
+      var hideTimer;
+      var requiredClassName = REQUIRED_CLASS;
+      var responseFormatter;
+      var validState = null;
+      var httpCanceller = null;
+      var httpCallInProgress = false;
+      var dd = elem[0].querySelector('.angucomplete-dropdown');
+      var isScrollOn = false;
+      var mousedownOn = null;
+      var unbindInitialValue;
+      var displaySearching;
+      var displayNoResults;
+
+      elem.on('mousedown', function(event) {
+        if (event.target.id) {
+          mousedownOn = event.target.id;
+          if (mousedownOn === scope.id + '_dropdown') {
+            document.body.addEventListener('click', clickoutHandlerForDropdown);
+          }
+        }
+        else {
+          mousedownOn = event.target.className;
+        }
+      });
+
+      scope.currentIndex = scope.focusFirst ? 0 : null;
+      scope.searching = false;
+      unbindInitialValue = scope.$watch('initialValue', function(newval) {
+        if (newval) {
+          // remove scope listener
+          unbindInitialValue();
+          // change input
+          handleInputChange(newval, true);
+        }
+      });
+
+      scope.$watch('fieldRequired', function(newval, oldval) {
+        if (newval !== oldval) {
+          if (!newval) {
+            ctrl[scope.inputName].$setValidity(requiredClassName, true);
+          }
+          else if (!validState || scope.currentIndex === -1) {
+            handleRequired(false);
+          }
+          else {
+            handleRequired(true);
+          }
+        }
+      });
+
+      scope.$on('angucomplete-alt:clearInput', function (event, elementId) {
+        if (!elementId || elementId === scope.id) {
+          scope.searchStr = null;
+          callOrAssign();
+          handleRequired(false);
+          clearResults();
+        }
+      });
+
+      scope.$on('angucomplete-alt:changeInput', function (event, elementId, newval) {
+        if (!!elementId && elementId === scope.id) {
+          handleInputChange(newval);
+        }
+      });
+
+      function handleInputChange(newval, initial) {
+        if (newval) {
+          if (typeof newval === 'object') {
+            scope.searchStr = extractTitle(newval);
+            callOrAssign({originalObject: newval});
+          } else if (typeof newval === 'string' && newval.length > 0) {
+            scope.searchStr = newval;
+          } else {
+            if (console && console.error) {
+              console.error('Tried to set ' + (!!initial ? 'initial' : '') + ' value of angucomplete to', newval, 'which is an invalid value');
+            }
+          }
+
+          handleRequired(true);
+        }
+      }
+
+      // #194 dropdown list not consistent in collapsing (bug).
+      function clickoutHandlerForDropdown(event) {
+        mousedownOn = null;
+        scope.hideResults(event);
+        document.body.removeEventListener('click', clickoutHandlerForDropdown);
+      }
+
+      // for IE8 quirkiness about event.which
+      function ie8EventNormalizer(event) {
+        return event.which ? event.which : event.keyCode;
+      }
+
+      function callOrAssign(value) {
+        if (typeof scope.selectedObject === 'function') {
+          scope.selectedObject(value, scope.selectedObjectData);
+        }
+        else {
+          scope.selectedObject = value;
+        }
+
+        if (value) {
+          handleRequired(true);
+        }
+        else {
+          handleRequired(false);
+        }
+      }
+
+      function callFunctionOrIdentity(fn) {
+        return function(data) {
+          return scope[fn] ? scope[fn](data) : data;
+        };
+      }
+
+      function setInputString(str) {
+        callOrAssign({originalObject: str});
+
+        if (scope.clearSelected) {
+          scope.searchStr = null;
+        }
+        clearResults();
+      }
+
+      function extractTitle(data) {
+        // split title fields and run extractValue for each and join with ' '
+        return scope.titleField.split(',')
+          .map(function(field) {
+            return extractValue(data, field);
+          })
+          .join(' ');
+      }
+
+      function extractValue(obj, key) {
+        var keys, result;
+        if (key) {
+          keys= key.split('.');
+          result = obj;
+          for (var i = 0; i < keys.length; i++) {
+            result = result[keys[i]];
+          }
+        }
+        else {
+          result = obj;
+        }
+        return result;
+      }
+
+      function findMatchString(target, str) {
+        var result, matches, re;
+        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions
+        // Escape user input to be treated as a literal string within a regular
+		// expression
+        re = new RegExp(str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'i');
+        if (!target) { return; }
+        if (!target.match || !target.replace) { target = target.toString(); }
+        matches = target.match(re);
+        if (matches) {
+          result = target.replace(re,
+              '<span class="'+ scope.matchClass +'">'+ matches[0] +'</span>');
+        }
+        else {
+          result = target;
+        }
+        return $sce.trustAsHtml(result);
+      }
+
+      function handleRequired(valid) {
+        scope.notEmpty = valid;
+        validState = scope.searchStr;
+        if (scope.fieldRequired && ctrl && scope.inputName) {
+          ctrl[scope.inputName].$setValidity(requiredClassName, valid);
+        }
+      }
+
+      function keyupHandler(event) {
+        var which = ie8EventNormalizer(event);
+        if (which === KEY_LF || which === KEY_RT) {
+          // do nothing
+          return;
+        }
+
+        if (which === KEY_UP || which === KEY_EN) {
+          event.preventDefault();
+        }
+        else if (which === KEY_DW) {
+          event.preventDefault();
+          if (!scope.showDropdown && scope.searchStr && scope.searchStr.length >= minlength) {
+            initResults();
+            scope.searching = true;
+            searchTimerComplete(scope.searchStr);
+          }
+        }
+        else if (which === KEY_ES) {
+          clearResults();
+          scope.$apply(function() {
+            inputField.val(scope.searchStr);
+          });
+        }
+        else {
+          if (minlength === 0 && !scope.searchStr) {
+            return;
+          }
+
+          if (!scope.searchStr || scope.searchStr === '') {
+            scope.showDropdown = false;
+          } else if (scope.searchStr.length >= minlength) {
+            initResults();
+
+            if (searchTimer) {
+              $timeout.cancel(searchTimer);
+            }
+
+            scope.searching = true;
+
+            searchTimer = $timeout(function() {
+              searchTimerComplete(scope.searchStr);
+            }, scope.pause);
+          }
+
+          if (validState && validState !== scope.searchStr && !scope.clearSelected) {
+            scope.$apply(function() {
+              callOrAssign();
+            });
+          }
+        }
+      }
+
+      function handleOverrideSuggestions(event) {
+        if (scope.overrideSuggestions &&
+            !(scope.selectedObject && scope.selectedObject.originalObject === scope.searchStr)) {
+          if (event) {
+            event.preventDefault();
+          }
+
+          // cancel search timer
+          $timeout.cancel(searchTimer);
+          // cancel http request
+          cancelHttpRequest();
+
+          setInputString(scope.searchStr);
+        }
+      }
+
+      function dropdownRowOffsetHeight(row) {
+        var css = getComputedStyle(row);
+        return row.offsetHeight +
+          parseInt(css.marginTop, 10) + parseInt(css.marginBottom, 10);
+      }
+
+      function dropdownHeight() {
+        return dd.getBoundingClientRect().top +
+          parseInt(getComputedStyle(dd).maxHeight, 10);
+      }
+
+      function dropdownRow() {
+        return elem[0].querySelectorAll('.angucomplete-row')[scope.currentIndex];
+      }
+
+      function dropdownRowTop() {
+        return dropdownRow().getBoundingClientRect().top -
+          (dd.getBoundingClientRect().top +
+           parseInt(getComputedStyle(dd).paddingTop, 10));
+      }
+
+      function dropdownScrollTopTo(offset) {
+        dd.scrollTop = dd.scrollTop + offset;
+      }
+
+      function updateInputField(){
+        var current = scope.results[scope.currentIndex];
+        if (scope.matchClass) {
+          inputField.val(extractTitle(current.originalObject));
+        }
+        else {
+          inputField.val(current.title);
+        }
+      }
+
+      function keydownHandler(event) {
+        var which = ie8EventNormalizer(event);
+        var row = null;
+        var rowTop = null;
+
+        if (which === KEY_EN && scope.results) {
+          if (scope.currentIndex >= 0 && scope.currentIndex < scope.results.length) {
+            event.preventDefault();
+            scope.selectResult(scope.results[scope.currentIndex]);
+          } else {
+            handleOverrideSuggestions(event);
+            clearResults();
+          }
+          scope.$apply();
+        } else if (which === KEY_DW && scope.results) {
+          event.preventDefault();
+          if ((scope.currentIndex + 1) < scope.results.length && scope.showDropdown) {
+            scope.$apply(function() {
+              scope.currentIndex ++;
+              updateInputField();
+            });
+
+            if (isScrollOn) {
+              row = dropdownRow();
+              if (dropdownHeight() < row.getBoundingClientRect().bottom) {
+                dropdownScrollTopTo(dropdownRowOffsetHeight(row));
+              }
+            }
+          }
+        } else if (which === KEY_UP && scope.results) {
+          event.preventDefault();
+          if (scope.currentIndex >= 1) {
+            scope.$apply(function() {
+              scope.currentIndex --;
+              updateInputField();
+            });
+
+            if (isScrollOn) {
+              rowTop = dropdownRowTop();
+              if (rowTop < 0) {
+                dropdownScrollTopTo(rowTop - 1);
+              }
+            }
+          }
+          else if (scope.currentIndex === 0) {
+            scope.$apply(function() {
+              scope.currentIndex = -1;
+              inputField.val(scope.searchStr);
+            });
+          }
+        } else if (which === KEY_TAB) {
+          if (scope.results && scope.results.length > 0 && scope.showDropdown) {
+            if (scope.currentIndex === -1 && scope.overrideSuggestions) {
+              // intentionally not sending event so that it does not
+              // prevent default tab behavior
+              handleOverrideSuggestions();
+            }
+            else {
+              if (scope.currentIndex === -1) {
+                scope.currentIndex = 0;
+              }
+              scope.selectResult(scope.results[scope.currentIndex]);
+              scope.$digest();
+            }
+          }
+          else {
+            // no results
+            // intentionally not sending event so that it does not
+            // prevent default tab behavior
+            if (scope.searchStr && scope.searchStr.length > 0) {
+              handleOverrideSuggestions();
+            }
+          }
+        } else if (which === KEY_ES) {
+          // This is very specific to IE10/11 #272
+          // without this, IE clears the input text
+          event.preventDefault();
+        }
+      }
+
+      function httpSuccessCallbackGen(str) {
+        return function(responseData, status, headers, config) {
+          // normalize return obejct from promise
+          if (!status && !headers && !config && responseData.data) {
+            responseData = responseData.data;
+          }
+          scope.searching = false;
+          processResults(
+            extractValue(responseFormatter(responseData), scope.remoteUrlDataField),
+            str);
+        };
+      }
+
+      function httpErrorCallback(errorRes, status, headers, config) {
+        scope.searching = httpCallInProgress;
+
+        // normalize return obejct from promise
+        if (!status && !headers && !config) {
+          status = errorRes.status;
+        }
+
+        // cancelled/aborted
+        if (status === 0 || status === -1) { return; }
+        if (scope.remoteUrlErrorCallback) {
+          scope.remoteUrlErrorCallback(errorRes, status, headers, config);
+        }
+        else {
+          if (console && console.error) {
+            console.error('http error');
+          }
+        }
+      }
+
+      function cancelHttpRequest() {
+        if (httpCanceller) {
+          httpCanceller.resolve();
+        }
+      }
+
+      function getRemoteResults(str) {
+        var params = {},
+            url = scope.remoteUrl + encodeURIComponent(str);
+        if (scope.remoteUrlRequestFormatter) {
+          params = {params: scope.remoteUrlRequestFormatter(str)};
+          url = scope.remoteUrl;
+        }
+        if (!!scope.remoteUrlRequestWithCredentials) {
+          params.withCredentials = true;
+        }
+        cancelHttpRequest();
+        httpCanceller = $q.defer();
+        params.timeout = httpCanceller.promise;
+        httpCallInProgress = true;
+        $http.get(url, params)
+          .then(httpSuccessCallbackGen(str))
+          .catch(httpErrorCallback)
+          .finally(function(){httpCallInProgress=false;});
+      }
+
+      function getRemoteResultsWithCustomHandler(str) {
+        cancelHttpRequest();
+
+        httpCanceller = $q.defer();
+
+        scope.remoteApiHandler(str, httpCanceller.promise)
+          .then(httpSuccessCallbackGen(str))
+          .catch(httpErrorCallback);
+
+        /*
+		 * IE8 compatible scope.remoteApiHandler(str, httpCanceller.promise)
+		 * ['then'](httpSuccessCallbackGen(str)) ['catch'](httpErrorCallback);
+		 */
+      }
+
+      function clearResults() {
+        scope.showDropdown = false;
+        scope.results = [];
+        if (dd) {
+          dd.scrollTop = 0;
+        }
+      }
+
+      function initResults() {
+        scope.showDropdown = displaySearching;
+        scope.currentIndex = scope.focusFirst ? 0 : -1;
+        scope.results = [];
+      }
+
+      function getLocalResults(str) {
+        var i, match, s, value,
+            searchFields = scope.searchFields.split(','),
+            matches = [];
+        if (typeof scope.parseInput() !== 'undefined') {
+          str = scope.parseInput()(str);
+        }
+        for (i = 0; i < scope.localData.length; i++) {
+          match = false;
+
+          for (s = 0; s < searchFields.length; s++) {
+            value = extractValue(scope.localData[i], searchFields[s]) || '';
+            match = match || (value.toString().toLowerCase().indexOf(str.toString().toLowerCase()) >= 0);
+          }
+
+          if (match) {
+            matches[matches.length] = scope.localData[i];
+          }
+        }
+        return matches;
+      }
+
+      function checkExactMatch(result, obj, str){
+        if (!str) { return false; }
+        for(var key in obj){
+          if(obj[key].toLowerCase() === str.toLowerCase()){
+            scope.selectResult(result);
+            return true;
+          }
+        }
+        return false;
+      }
+
+      function searchTimerComplete(str) {
+        // Begin the search
+        if (!str || str.length < minlength) {
+          return;
+        }
+        if (scope.localData) {
+          scope.$apply(function() {
+            var matches;
+            if (typeof scope.localSearch() !== 'undefined') {
+              matches = scope.localSearch()(str, scope.localData);
+            } else {
+              matches = getLocalResults(str);
+            }
+            scope.searching = false;
+            processResults(matches, str);
+          });
+        }
+        else if (scope.remoteApiHandler) {
+          getRemoteResultsWithCustomHandler(str);
+        } else {
+          getRemoteResults(str);
+        }
+      }
+
+      function processResults(responseData, str) {
+        var i, description, image, text, formattedText, formattedDesc;
+
+        if (responseData && responseData.length > 0) {
+          scope.results = [];
+
+          for (i = 0; i < responseData.length; i++) {
+            if (scope.titleField && scope.titleField !== '') {
+              text = formattedText = extractTitle(responseData[i]);
+            }
+
+            description = '';
+            if (scope.descriptionField) {
+              description = formattedDesc = extractValue(responseData[i], scope.descriptionField);
+            }
+
+            image = '';
+            if (scope.imageField) {
+              image = extractValue(responseData[i], scope.imageField);
+            }
+
+            if (scope.matchClass) {
+              formattedText = findMatchString(text, str);
+              formattedDesc = findMatchString(description, str);
+            }
+
+            scope.results[scope.results.length] = {
+              title: formattedText,
+              description: formattedDesc,
+              image: image,
+              originalObject: responseData[i]
+            };
+          }
+
+        } else {
+          scope.results = [];
+        }
+
+        if (scope.autoMatch && scope.results.length === 1 &&
+            checkExactMatch(scope.results[0],
+              {title: text, desc: description || ''}, scope.searchStr)) {
+          scope.showDropdown = false;
+        } else if (scope.results.length === 0 && !displayNoResults) {
+          scope.showDropdown = false;
+        } else {
+          scope.showDropdown = true;
+        }
+      }
+
+      function showAll() {
+        if (scope.localData) {
+          scope.searching = false;
+          processResults(scope.localData, '');
+        }
+        else if (scope.remoteApiHandler) {
+          scope.searching = true;
+          getRemoteResultsWithCustomHandler('');
+        }
+        else {
+          scope.searching = true;
+          getRemoteResults('');
+        }
+      }
+
+      scope.onFocusHandler = function() {
+        if (scope.focusIn) {
+          scope.focusIn();
+        }
+        if (minlength === 0 && (!scope.searchStr || scope.searchStr.length === 0)) {
+          scope.currentIndex = scope.focusFirst ? 0 : scope.currentIndex;
+          scope.showDropdown = true;
+          showAll();
+        }
+      };
+
+      scope.hideResults = function() {
+        if (mousedownOn &&
+            (mousedownOn === scope.id + '_dropdown' ||
+             mousedownOn.indexOf('angucomplete') >= 0)) {
+          mousedownOn = null;
+        }
+        else {
+          hideTimer = $timeout(function() {
+            clearResults();
+            scope.$apply(function() {
+              if (scope.searchStr && scope.searchStr.length > 0) {
+                inputField.val(scope.searchStr);
+              }
+            });
+          }, BLUR_TIMEOUT);
+          cancelHttpRequest();
+
+          if (scope.focusOut) {
+            scope.focusOut();
+          }
+
+          if (scope.overrideSuggestions) {
+            if (scope.searchStr && scope.searchStr.length > 0 && scope.currentIndex === -1) {
+              handleOverrideSuggestions();
+            }
+          }
+        }
+      };
+
+      scope.resetHideResults = function() {
+        if (hideTimer) {
+          $timeout.cancel(hideTimer);
+        }
+      };
+
+      scope.hoverRow = function(index) {
+        scope.currentIndex = index;
+      };
+
+      scope.selectResult = function(result) {
+        // Restore original values
+        if (scope.matchClass) {
+          result.title = extractTitle(result.originalObject);
+          result.description = extractValue(result.originalObject, scope.descriptionField);
+        }
+
+        if (scope.clearSelected) {
+          scope.searchStr = null;
+        }
+        else {
+          scope.searchStr = result.title;
+        }
+        callOrAssign(result);
+        clearResults();
+      };
+
+      scope.inputChangeHandler = function(str) {
+        if (str.length < minlength) {
+          cancelHttpRequest();
+          clearResults();
+        }
+        else if (str.length === 0 && minlength === 0) {
+          showAll();
+        }
+
+        if (scope.inputChanged) {
+          str = scope.inputChanged(str);
+        }
+        return str;
+      };
+
+      // check required
+      if (scope.fieldRequiredClass && scope.fieldRequiredClass !== '') {
+        requiredClassName = scope.fieldRequiredClass;
+      }
+
+      // check min length
+      if (scope.minlength && scope.minlength !== '') {
+        minlength = parseInt(scope.minlength, 10);
+      }
+
+      // check pause time
+      if (!scope.pause) {
+        scope.pause = PAUSE;
+      }
+
+      // check clearSelected
+      if (!scope.clearSelected) {
+        scope.clearSelected = false;
+      }
+
+      // check override suggestions
+      if (!scope.overrideSuggestions) {
+        scope.overrideSuggestions = false;
+      }
+
+      // check required field
+      if (scope.fieldRequired && ctrl) {
+        // check initial value, if given, set validitity to true
+        if (scope.initialValue) {
+          handleRequired(true);
+        }
+        else {
+          handleRequired(false);
+        }
+      }
+
+      scope.inputType = attrs.type ? attrs.type : 'text';
+
+      // set strings for "Searching..." and "No results"
+      scope.textSearching = attrs.textSearching ? attrs.textSearching : TEXT_SEARCHING;
+      scope.textNoResults = attrs.textNoResults ? attrs.textNoResults : TEXT_NORESULTS;
+      displaySearching = scope.textSearching === 'false' ? false : true;
+      displayNoResults = scope.textNoResults === 'false' ? false : true;
+
+      // set max length (default to maxlength deault from html
+      scope.maxlength = attrs.maxlength ? attrs.maxlength : MAX_LENGTH;
+
+      // register events
+      inputField.on('keydown', keydownHandler);
+      inputField.on('keyup compositionend', keyupHandler);
+
+      // set response formatter
+      responseFormatter = callFunctionOrIdentity('remoteUrlResponseFormatter');
+
+      // set isScrollOn
+      $timeout(function() {
+        var css = getComputedStyle(dd);
+        isScrollOn = css.maxHeight && css.overflowY === 'auto';
+      });
+    }
+
+    return {
+      restrict: 'EA',
+      require: '^?form',
+      scope: {
+        selectedObject: '=',
+        selectedObjectData: '=',
+        disableInput: '=',
+        initialValue: '=',
+        localData: '=',
+        localSearch: '&',
+        remoteUrlRequestFormatter: '=',
+        remoteUrlRequestWithCredentials: '@',
+        remoteUrlResponseFormatter: '=',
+        remoteUrlErrorCallback: '=',
+        remoteApiHandler: '=',
+        id: '@',
+        type: '@',
+        placeholder: '@',
+        textSearching: '@',
+        textNoResults: '@',
+        remoteUrl: '@',
+        remoteUrlDataField: '@',
+        titleField: '@',
+        descriptionField: '@',
+        imageField: '@',
+        inputClass: '@',
+        pause: '@',
+        searchFields: '@',
+        minlength: '@',
+        matchClass: '@',
+        clearSelected: '@',
+        overrideSuggestions: '@',
+        fieldRequired: '=',
+        fieldRequiredClass: '@',
+        inputChanged: '=',
+        autoMatch: '@',
+        focusOut: '&',
+        focusIn: '&',
+        fieldTabindex: '@',
+        inputName: '@',
+        focusFirst: '@',
+        parseInput: '&'
+      },
+      templateUrl: function(element, attrs) {
+        return attrs.templateUrl || TEMPLATE_URL;
+      },
+      compile: function(tElement) {
+        var startSym = $interpolate.startSymbol();
+        var endSym = $interpolate.endSymbol();
+        if (!(startSym === '{{' && endSym === '}}')) {
+          var interpolatedHtml = tElement.html()
+            .replace(/\{\{/g, startSym)
+            .replace(/\}\}/g, endSym);
+          tElement.html(interpolatedHtml);
+        }
+        return link;
+      }
+    };
+  }]);
+
+}));
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.min.js b/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.min.js
new file mode 100644
index 0000000000..34b6e0cf14
--- /dev/null
+++ b/sigawf/src/main/webapp/js/angucomplete-alt/angucomplete-alt.min.js
@@ -0,0 +1,2 @@
+/*! Copyright (c) 2014 Hidenari Nozaki and contributors | Licensed under the MIT license */
+!function(a,b){"use strict";"undefined"!=typeof module&&module.exports?module.exports=b(require("angular")):"function"==typeof define&&define.amd?define(["angular"],b):b(a.angular)}(window,function(a){"use strict";a.module("angucomplete-alt",[]).directive("angucompleteAlt",["$q","$parse","$http","$sce","$timeout","$templateCache","$interpolate",function(a,b,c,d,e,f,g){function h(b,f,g,h){function w(a,c){a&&("object"==typeof a?(b.searchStr=C(a),z({originalObject:a})):"string"==typeof a&&a.length>0?b.searchStr=a:console&&console.error&&console.error("Tried to set "+(c?"initial":"")+" value of angucomplete to",a,"which is an invalid value"),F(!0))}function x(a){na=null,b.hideResults(a),document.body.removeEventListener("click",x)}function y(a){return a.which?a.which:a.keyCode}function z(a){"function"==typeof b.selectedObject?b.selectedObject(a,b.selectedObjectData):b.selectedObject=a,F(a?!0:!1)}function A(a){return function(c){return b[a]?b[a](c):c}}function B(a){z({originalObject:a}),b.clearSelected&&(b.searchStr=null),U()}function C(a){return b.titleField.split(",").map(function(b){return D(a,b)}).join(" ")}function D(a,b){var c,d;if(b){c=b.split("."),d=a;for(var e=0;e<c.length;e++)d=d[c[e]]}else d=a;return d}function E(a,c){var e,f,g;return g=new RegExp(c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),a?(a.match&&a.replace||(a=a.toString()),f=a.match(g),e=f?a.replace(g,'<span class="'+b.matchClass+'">'+f[0]+"</span>"):a,d.trustAsHtml(e)):void 0}function F(a){b.notEmpty=a,ia=b.searchStr,b.fieldRequired&&h&&b.inputName&&h[b.inputName].$setValidity(ha,a)}function G(a){var c=y(a);if(c!==l&&c!==j)if(c===k||c===n)a.preventDefault();else if(c===i)a.preventDefault(),!b.showDropdown&&b.searchStr&&b.searchStr.length>=fa&&(V(),b.searching=!0,Y(b.searchStr));else if(c===m)U(),b.$apply(function(){ea.val(b.searchStr)});else{if(0===fa&&!b.searchStr)return;b.searchStr&&""!==b.searchStr?b.searchStr.length>=fa&&(V(),ga&&e.cancel(ga),b.searching=!0,ga=e(function(){Y(b.searchStr)},b.pause)):b.showDropdown=!1,ia&&ia!==b.searchStr&&!b.clearSelected&&b.$apply(function(){z()})}}function H(a){!b.overrideSuggestions||b.selectedObject&&b.selectedObject.originalObject===b.searchStr||(a&&a.preventDefault(),e.cancel(ga),R(),B(b.searchStr))}function I(a){var b=getComputedStyle(a);return a.offsetHeight+parseInt(b.marginTop,10)+parseInt(b.marginBottom,10)}function J(){return la.getBoundingClientRect().top+parseInt(getComputedStyle(la).maxHeight,10)}function K(){return f[0].querySelectorAll(".angucomplete-row")[b.currentIndex]}function L(){return K().getBoundingClientRect().top-(la.getBoundingClientRect().top+parseInt(getComputedStyle(la).paddingTop,10))}function M(a){la.scrollTop=la.scrollTop+a}function N(){var a=b.results[b.currentIndex];b.matchClass?ea.val(C(a.originalObject)):ea.val(a.title)}function O(a){var c=y(a),d=null,e=null;c===n&&b.results?(b.currentIndex>=0&&b.currentIndex<b.results.length?(a.preventDefault(),b.selectResult(b.results[b.currentIndex])):(H(a),U()),b.$apply()):c===i&&b.results?(a.preventDefault(),b.currentIndex+1<b.results.length&&b.showDropdown&&(b.$apply(function(){b.currentIndex++,N()}),ma&&(d=K(),J()<d.getBoundingClientRect().bottom&&M(I(d))))):c===k&&b.results?(a.preventDefault(),b.currentIndex>=1?(b.$apply(function(){b.currentIndex--,N()}),ma&&(e=L(),0>e&&M(e-1))):0===b.currentIndex&&b.$apply(function(){b.currentIndex=-1,ea.val(b.searchStr)})):c===o?b.results&&b.results.length>0&&b.showDropdown?-1===b.currentIndex&&b.overrideSuggestions?H():(-1===b.currentIndex&&(b.currentIndex=0),b.selectResult(b.results[b.currentIndex]),b.$digest()):b.searchStr&&b.searchStr.length>0&&H():c===m&&a.preventDefault()}function P(a){return function(c,d,e,f){d||e||f||!c.data||(c=c.data),b.searching=!1,Z(D(aa(c),b.remoteUrlDataField),a)}}function Q(a,c,d,e){b.searching=ka,c||d||e||(c=a.status),0!==c&&-1!==c&&(b.remoteUrlErrorCallback?b.remoteUrlErrorCallback(a,c,d,e):console&&console.error&&console.error("http error"))}function R(){ja&&ja.resolve()}function S(d){var e={},f=b.remoteUrl+encodeURIComponent(d);b.remoteUrlRequestFormatter&&(e={params:b.remoteUrlRequestFormatter(d)},f=b.remoteUrl),b.remoteUrlRequestWithCredentials&&(e.withCredentials=!0),R(),ja=a.defer(),e.timeout=ja.promise,ka=!0,c.get(f,e).success(P(d)).error(Q)["finally"](function(){ka=!1})}function T(c){R(),ja=a.defer(),b.remoteApiHandler(c,ja.promise).then(P(c))["catch"](Q)}function U(){b.showDropdown=!1,b.results=[],la&&(la.scrollTop=0)}function V(){b.showDropdown=ca,b.currentIndex=b.focusFirst?0:-1,b.results=[]}function W(a){var c,d,e,f,g=b.searchFields.split(","),h=[];for("undefined"!=typeof b.parseInput()&&(a=b.parseInput()(a)),c=0;c<b.localData.length;c++){for(d=!1,e=0;e<g.length;e++)f=D(b.localData[c],g[e])||"",d=d||f.toString().toLowerCase().indexOf(a.toString().toLowerCase())>=0;d&&(h[h.length]=b.localData[c])}return h}function X(a,c,d){if(!d)return!1;for(var e in c)if(c[e].toLowerCase()===d.toLowerCase())return b.selectResult(a),!0;return!1}function Y(a){!a||a.length<fa||(b.localData?b.$apply(function(){var c;c="undefined"!=typeof b.localSearch()?b.localSearch()(a,b.localData):W(a),b.searching=!1,Z(c,a)}):b.remoteApiHandler?T(a):S(a))}function Z(a,c){var d,e,f,g,h,i;if(a&&a.length>0)for(b.results=[],d=0;d<a.length;d++)b.titleField&&""!==b.titleField&&(g=h=C(a[d])),e="",b.descriptionField&&(e=i=D(a[d],b.descriptionField)),f="",b.imageField&&(f=D(a[d],b.imageField)),b.matchClass&&(h=E(g,c),i=E(e,c)),b.results[b.results.length]={title:h,description:i,image:f,originalObject:a[d]};else b.results=[];b.autoMatch&&1===b.results.length&&X(b.results[0],{title:g,desc:e||""},b.searchStr)?b.showDropdown=!1:0!==b.results.length||da?b.showDropdown=!0:b.showDropdown=!1}function $(){b.localData?(b.searching=!1,Z(b.localData,"")):b.remoteApiHandler?(b.searching=!0,T("")):(b.searching=!0,S(""))}var _,aa,ba,ca,da,ea=f.find("input"),fa=p,ga=null,ha=t,ia=null,ja=null,ka=!1,la=f[0].querySelector(".angucomplete-dropdown"),ma=!1,na=null;f.on("mousedown",function(a){a.target.id?(na=a.target.id,na===b.id+"_dropdown"&&document.body.addEventListener("click",x)):na=a.target.className}),b.currentIndex=b.focusFirst?0:null,b.searching=!1,ba=b.$watch("initialValue",function(a){a&&(ba(),w(a,!0))}),b.$watch("fieldRequired",function(a,c){a!==c&&(a?F(ia&&-1!==b.currentIndex?!0:!1):h[b.inputName].$setValidity(ha,!0))}),b.$on("angucomplete-alt:clearInput",function(a,c){c&&c!==b.id||(b.searchStr=null,z(),F(!1),U())}),b.$on("angucomplete-alt:changeInput",function(a,c,d){c&&c===b.id&&w(d)}),b.onFocusHandler=function(){b.focusIn&&b.focusIn(),0!==fa||b.searchStr&&0!==b.searchStr.length||(b.currentIndex=b.focusFirst?0:b.currentIndex,b.showDropdown=!0,$())},b.hideResults=function(){na&&(na===b.id+"_dropdown"||na.indexOf("angucomplete")>=0)?na=null:(_=e(function(){U(),b.$apply(function(){b.searchStr&&b.searchStr.length>0&&ea.val(b.searchStr)})},s),R(),b.focusOut&&b.focusOut(),b.overrideSuggestions&&b.searchStr&&b.searchStr.length>0&&-1===b.currentIndex&&H())},b.resetHideResults=function(){_&&e.cancel(_)},b.hoverRow=function(a){b.currentIndex=a},b.selectResult=function(a){b.matchClass&&(a.title=C(a.originalObject),a.description=D(a.originalObject,b.descriptionField)),b.clearSelected?b.searchStr=null:b.searchStr=a.title,z(a),U()},b.inputChangeHandler=function(a){return a.length<fa?(R(),U()):0===a.length&&0===fa&&$(),b.inputChanged&&(a=b.inputChanged(a)),a},b.fieldRequiredClass&&""!==b.fieldRequiredClass&&(ha=b.fieldRequiredClass),b.minlength&&""!==b.minlength&&(fa=parseInt(b.minlength,10)),b.pause||(b.pause=r),b.clearSelected||(b.clearSelected=!1),b.overrideSuggestions||(b.overrideSuggestions=!1),b.fieldRequired&&h&&F(b.initialValue?!0:!1),b.inputType=g.type?g.type:"text",b.textSearching=g.textSearching?g.textSearching:u,b.textNoResults=g.textNoResults?g.textNoResults:v,ca="false"!==b.textSearching,da="false"!==b.textNoResults,b.maxlength=g.maxlength?g.maxlength:q,ea.on("keydown",O),ea.on("keyup compositionend",G),aa=A("remoteUrlResponseFormatter"),e(function(){var a=getComputedStyle(la);ma=a.maxHeight&&"auto"===a.overflowY})}var i=40,j=39,k=38,l=37,m=27,n=13,o=9,p=3,q=524288,r=500,s=200,t="autocomplete-required",u="Searching...",v="No results found",w="/angucomplete-alt/index.html";return f.put(w,'<div class="angucomplete-holder" ng-class="{\'angucomplete-dropdown-visible\': showDropdown}">  <input id="{{id}}_value" name="{{inputName}}" tabindex="{{fieldTabindex}}" ng-class="{\'angucomplete-input-not-empty\': notEmpty}" ng-model="searchStr" ng-disabled="disableInput" type="{{inputType}}" placeholder="{{placeholder}}" maxlength="{{maxlength}}" ng-focus="onFocusHandler()" class="{{inputClass}}" ng-focus="resetHideResults()" ng-blur="hideResults($event)" autocapitalize="off" autocorrect="off" autocomplete="off" ng-change="inputChangeHandler(searchStr)"/>  <div id="{{id}}_dropdown" class="angucomplete-dropdown" ng-show="showDropdown">    <div class="angucomplete-searching" ng-show="searching" ng-bind="textSearching"></div>    <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"></div>    <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}">      <div ng-if="imageField" class="angucomplete-image-holder">        <img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="angucomplete-image"/>        <div ng-if="!result.image && result.image != \'\'" class="angucomplete-image-default"></div>      </div>      <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>      <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div>      <div ng-if="matchClass && result.description && result.description != \'\'" class="angucomplete-description" ng-bind-html="result.description"></div>      <div ng-if="!matchClass && result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}</div>    </div>  </div></div>'),{restrict:"EA",require:"^?form",scope:{selectedObject:"=",selectedObjectData:"=",disableInput:"=",initialValue:"=",localData:"=",localSearch:"&",remoteUrlRequestFormatter:"=",remoteUrlRequestWithCredentials:"@",remoteUrlResponseFormatter:"=",remoteUrlErrorCallback:"=",remoteApiHandler:"=",id:"@",type:"@",placeholder:"@",textSearching:"@",textNoResults:"@",remoteUrl:"@",remoteUrlDataField:"@",titleField:"@",descriptionField:"@",imageField:"@",inputClass:"@",pause:"@",searchFields:"@",minlength:"@",matchClass:"@",clearSelected:"@",overrideSuggestions:"@",fieldRequired:"=",fieldRequiredClass:"@",inputChanged:"=",autoMatch:"@",focusOut:"&",focusIn:"&",fieldTabindex:"@",inputName:"@",focusFirst:"@",parseInput:"&"},templateUrl:function(a,b){return b.templateUrl||w},compile:function(a){var b=g.startSymbol(),c=g.endSymbol();if("{{"!==b||"}}"!==c){var d=a.html().replace(/\{\{/g,b).replace(/\}\}/g,c);a.html(d)}return h}}}])});
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/js/angucomplete-alt/custom-template.html b/sigawf/src/main/webapp/js/angucomplete-alt/custom-template.html
new file mode 100644
index 0000000000..f1ffd630b6
--- /dev/null
+++ b/sigawf/src/main/webapp/js/angucomplete-alt/custom-template.html
@@ -0,0 +1,31 @@
+          <div class="angucomplete-holder dropdown" ng-class="{'angucomplete-dropdown-visible': showDropdown}">
+            <input ng-model="searchStr"
+              ng-disabled="disableInput"
+              type="text"
+              placeholder="{{placeholder}}"
+              ng-focus="onFocusHandler()"
+              class="{{inputClass}}"
+              ng-focus="resetHideResults()"
+              ng-blur="hideResults($event)"
+              autocapitalize="off"
+              autocorrect="off"
+              autocomplete="off"
+              ng-change="inputChangeHandler(searchStr)" id="dropdownSearch" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"/>
+            <div ng-class="{'angucomplete-dropdown': true, 'dropdown-menu': true, 'show': showDropdown}" ng-show="showDropdown" aria-labelledby="dropdownSearch" id="dropdownSearchList">
+              <div class="angucomplete-searching" ng-show="searching" ng-bind="textSearching"></div>
+              <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"></div>
+              <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{'angucomplete-selected-row': $index == currentIndex}">
+                <div ng-if="imageField" class="angucomplete-image-holder">
+                  <img ng-if="result.image && result.image != ''" ng-src="{{result.image}}" class="angucomplete-image"/>
+                  <div ng-if="!result.image && result.image != ''" class="angucomplete-image-default"></div>
+                </div>
+                <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>
+                <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div>
+                <div ng-if="matchClass && result.description && result.description != ''" class="angucomplete-description" ng-bind-html="result.description"></div>
+                <div ng-if="!matchClass && result.description && result.description != ''" class="angucomplete-description">{{result.description}}</div>
+              </div>
+              <div class="angucomplete-row" ng-click="selectResult({title: searchStr, originalObject: { name: searchStr, custom: true }})" ng-mouseenter="hoverRow(results.length)" ng-class="{'angucomplete-selected-row': results.length == currentIndex}">
+                <div style="display: none" class="angucomplete-title">Criar novo(a) para '{{ searchStr }}'</div>
+              </div>
+            </div>
+          </div>
diff --git a/sigawf/src/main/webapp/js/diagrama.js b/sigawf/src/main/webapp/js/diagrama.js
new file mode 100644
index 0000000000..166096ba75
--- /dev/null
+++ b/sigawf/src/main/webapp/js/diagrama.js
@@ -0,0 +1,456 @@
+var app = angular.module('app', [ 'angucomplete-alt' ]);
+
+// Create an AngularJS service called debounce
+app.factory('debounce', [ '$timeout', '$q', function($timeout, $q) {
+	// The service is actually this function, which we call with the func
+	// that should be debounced and how long to wait in between calls
+	return function debounce(func, wait, immediate) {
+		var timeout;
+		// Create a deferred object that will be resolved when we need to
+		// actually call the func
+		var deferred = $q.defer();
+		return function() {
+			var context = this, args = arguments;
+			var later = function() {
+				timeout = null;
+				if (!immediate) {
+					deferred.resolve(func.apply(context, args));
+					deferred = $q.defer();
+				}
+			};
+			var callNow = immediate && !timeout;
+			if (timeout) {
+				$timeout.cancel(timeout);
+			}
+			timeout = $timeout(later, wait);
+			if (callNow) {
+				deferred.resolve(func.apply(context, args));
+				deferred = $q.defer();
+			}
+			return deferred.promise;
+		};
+	};
+} ]);
+
+app
+		.controller(
+				'ctrl',
+				function($scope, $http, debounce) {
+					$scope.data = {};
+
+					$scope.encode = function(d) {
+						var pd = {
+							hisIde : undefined,
+							nome : d.nome,
+							descr : d.descricao,
+							definicaoDeTarefa : []
+						};
+						if (d.tarefa) {
+							for (var i = 0; i < d.tarefa.length; i++) {
+								var t = d.tarefa[i];
+								var td = {};
+								td.hisIde = t.id;
+								td.nome = t.titulo;
+								td.assunto = t.assunto;
+								td.conteudo = t.conteudo;
+								td.tipoDeTarefa = t.tipo;
+								td.tipoDeResponsavel = t.tipoResponsavel;
+								// td.definicaoDeResponsavel =
+								// t.definicaoDeResponsavel;
+								td.seguinteIde = t.depois === "fim" ? undefined
+										: t.depois;
+								td.ultimo = t.depois === "fim";
+								td.ordem = i;
+								td.definicaoDeVariavel = [];
+								td.definicaoDeDesvio = [];
+
+								if (t.tipoResponsavel == 'LOTACAO'
+										&& t.refUnidadeResponsavel
+										&& t.refUnidadeResponsavel.originalObject
+										&& t.refUnidadeResponsavel.originalObject.key)
+									td.lotacaoId = t.refUnidadeResponsavel.originalObject.key;
+
+								if (t.tipoResponsavel == 'PESSOA'
+										&& t.refPessoaResponsavel
+										&& t.refPessoaResponsavel.originalObject
+										&& t.refPessoaResponsavel.originalObject.key)
+									td.pessoaId = t.refPessoaResponsavel.originalObject.key;
+
+								if (t.tipoResponsavel == 'RESPONSAVEL')
+									td.definicaoDeResponsavelId = t.refResponsavel;
+
+								if (t.tipo == 'INCLUIR_DOCUMENTO' && t.ref
+										&& t.ref.originalObject
+										&& t.ref.originalObject.key) {
+									td.refId = t.ref.originalObject.key;
+									td.refSigla = t.ref.originalObject.firstLine;
+								}
+
+								pd.definicaoDeTarefa.push(td);
+
+								if (d.tarefa[i].variavel) {
+									for (var j = 0; j < d.tarefa[i].variavel.length; j++) {
+										var variavel = d.tarefa[i].variavel[j];
+										var dv = {};
+										dv.nome = variavel.titulo;
+										dv.identificador = variavel.identificador;
+										dv.tipo = variavel.tipo;
+										dv.acesso = variavel.tipoDeEdicao;
+										dv.ordem = j;
+										td.definicaoDeVariavel.push(dv);
+									}
+								}
+
+								if (d.tarefa[i].desvio) {
+									for (var j = 0; j < d.tarefa[i].desvio.length; j++) {
+										var desvio = d.tarefa[i].desvio[j];
+										var dd = {};
+										dd.nome = desvio.titulo;
+										dd.seguinteIde = desvio.tarefa === "fim" ? undefined
+												: desvio.tarefa;
+										dd.ultimo = desvio.tarefa === "fim";
+										dd.condicao = desvio.condicao;
+										dd.ordem = j;
+										td.definicaoDeDesvio.push(dd);
+									}
+								}
+							}
+						}
+						return pd;
+					}
+
+					$scope.gravar = function() {
+						var fd = formdata({
+							id : $scope.id,
+							pd : $scope.encode($scope.data.workflow)
+						});
+						$http(
+								{
+									url : '/sigawf/app/diagrama/gravar',
+									method : "POST",
+									data : fd,
+									headers : {
+										'Content-Type' : 'application/x-www-form-urlencoded; charset=UTF-8'
+									}
+								}).then(function(response) {
+							window.location = '/sigawf/app/diagrama/listar'
+						}, function(response) {
+						});
+
+					}
+
+					$scope.decode = function(d) {
+						var pd = {
+							hisIde : undefined,
+							nome : d.nome,
+							descricao : d.descr,
+							tarefa : []
+						};
+						if (d.definicaoDeTarefa) {
+							for (var i = 0; i < d.definicaoDeTarefa.length; i++) {
+								var t = d.definicaoDeTarefa[i];
+								var td = {};
+								td.id = t.hisIde;
+								td.titulo = t.nome;
+								td.assunto = t.assunto;
+								td.conteudo = t.conteudo;
+								td.tipo = t.tipoDeTarefa;
+								td.tipoResponsavel = t.tipoDeResponsavel;
+								// td.definicaoDeResponsavel =
+								// t.definicaoDeResponsavel;
+								//td.depois = t.seguinteIde;
+								//td.ultimo = t.ultimo;
+								td.depois = t.ultimo ? "fim" : t.seguinteIde;
+								td.ordem = i;
+								td.variavel = [];
+								td.desvio = [];
+
+								if (t.lotacao)
+									td.refUnidadeResponsavel = {
+										originalObject : t.lotacao
+									}
+								if (t.pessoa)
+									td.refPessoaResponsavel = {
+										originalObject : t.pessoa
+									}
+
+								if (t.definicaoDeResponsavel)
+									td.refResponsavel = t.definicaoDeResponsavel;
+
+								if (t.refId) {
+									td.ref = {
+										originalObject : {
+											key : t.refId,
+											firstLine : t.refSigla
+										}
+									}
+								}
+
+								console.log("TESTE!@#", td);
+
+								pd.tarefa.push(td);
+
+								if (d.definicaoDeTarefa[i].definicaoDeVariavel) {
+									for (var j = 0; j < d.definicaoDeTarefa[i].definicaoDeVariavel.length; j++) {
+										var variavel = d.definicaoDeTarefa[i].definicaoDeVariavel[j];
+										var dv = {};
+										dv.titulo = variavel.nome;
+										dv.identificador = variavel.identificador;
+										dv.tipo = variavel.tipo;
+										dv.tipoDeEdicao = variavel.acesso;
+										dv.ordem = j;
+										td.variavel.push(dv);
+									}
+								}
+
+								if (d.definicaoDeTarefa[i].definicaoDeDesvio) {
+									for (var j = 0; j < d.definicaoDeTarefa[i].definicaoDeDesvio.length; j++) {
+										var desvio = d.definicaoDeTarefa[i].definicaoDeDesvio[j];
+										var dd = {};
+										dd.titulo = desvio.nome;
+										dd.tarefa = desvio.ultimo ? "fim"
+												: desvio.seguinteIde;
+										dd.condicao = desvio.condicao;
+										dd.ordem = j;
+										td.desvio.push(dd);
+									}
+								}
+							}
+						}
+						return pd;
+					}
+
+					$scope.carregar = function(id) {
+						$http({
+							url : '/sigawf/app/diagrama/' + id + '/carregar',
+							method : "GET"
+						}).then(
+								function(response) {
+									$scope.data.workflow = $scope
+											.decode(response.data);
+								}, function(response) {
+								});
+
+					}
+
+					$scope.carregarResponsaveis = function(cont) {
+						$http({
+							url : '/sigawf/app/responsavel/carregar',
+							method : "GET"
+						}).then(function(response) {
+							$scope.responsaveis = response.data.list;
+							if (cont)
+								cont();
+						}, function(response) {
+						});
+					}
+
+					$scope.selectedObject = function(p1, p2) {
+						p2.context[p2.variable] = p1;
+						if (p2.full)
+							$scope
+									.loadRef(p2.variable,
+											p2.context[p2.variable]);
+					}
+
+					$scope.insert = function() {
+						$scope.data.item = ($scope.data.item || []);
+						$scope.data.item.push({});
+					}
+
+					$scope
+							.$watch(
+									'data',
+									function() {
+										if (!$scope.data
+												|| !$scope.data.workflow
+												|| !$scope.data.workflow.tarefa) {
+											if ($scope.data
+													&& $scope.data.workflow)
+												$scope.data.workflow.dot = undefined;
+											document
+													.getElementById('graph-workflow').innerHTML = "";
+											$scope.tarefas = undefined;
+											return;
+										}
+										var tarefas = [];
+
+										for (var i = 0; i < $scope.data.workflow.tarefa.length; i++) {
+											var t = $scope.data.workflow.tarefa[i];
+											if (!t.id)
+												t.id = uuidv4();
+											t.nome = i
+													+ 1
+													+ ") "
+													+ (t.titulo ? t.titulo
+															: t.tipo);
+											tarefas.push({
+												id : t.id,
+												nome : t.nome
+											})
+										}
+										tarefas.push({
+											id : "fim",
+											nome : "[Fim]"
+										})
+
+										$scope.tarefas = tarefas;
+										console.log('graphDrawDebounced')
+										$scope.graphDrawDebounced();
+									}, true);
+
+					$scope.graphDraw = function() {
+						console.log('graphDraw')
+						$scope.dot = $scope.getDot($scope.data.workflow);
+						$http(
+								{
+									url : 'https://hml.xrp.com.br/app/graphviz?graph='
+											+ $scope.dot,
+									method : "GET"
+								})
+								.then(
+										function(response) {
+											document
+													.getElementById('graph-workflow').innerHTML = response.data;
+										}, function(response) {
+											$scope.showError(response);
+										});
+					}
+
+					$scope.graphDrawDebounced = debounce($scope.graphDraw,
+							1000, false);
+
+					function graphElement(shape, n, nextn) {
+						var s = '"' + n.id + '"[shape="' + shape
+								+ '"][label=<<font>' + n.titulo + '</font>>];';
+						if (n.tipo !== "FIM") {
+							if (n.desvio && n.desvio.length > 0) {
+								for ( var x in n.desvio) {
+									var tr = n.desvio[x];
+									if (tr.tarefa)
+										s += '"' + n.id + '"->"' + tr.tarefa
+												+ '"';
+									else if (nextn)
+										s += '"' + n.id + '"->"' + nextn.id
+												+ '"';
+									else
+										s += '"' + n.id + '"->"fim"';
+									if (tr.titulo && tr.titulo !== '')
+										s += ' [label="' + tr.titulo + '"]';
+									s += ';';
+								}
+							} else if (n.depois) {
+								s += '"' + n.id + '"->"' + n.depois + '";';
+							} else if (nextn) {
+								s += '"' + n.id + '"->"' + nextn.id + '";';
+							} else {
+								s += '"' + n.id + '"->"fim";';
+							}
+						}
+						return s;
+					}
+
+					$scope.getDot = function(wf) {
+						var tipos = {
+							INCLUIR_DOCUMENTO : 'note',
+							FORMULARIO : 'rectangle',
+							DECISAO : 'diamond',
+							EMAIL : 'folder',
+						};
+						var s = 'digraph G { graph[size="3,3"];';
+						if (wf.tarefa.length > 0) {
+							s += graphElement("oval", {
+								id : "ini",
+								titulo : "Início",
+								desvio : [ {
+									tarefa : wf.tarefa[0].id
+								} ]
+							});
+							s += graphElement("oval", {
+								id : "fim",
+								titulo : "Fim",
+								tipo : "FIM"
+							});
+							for (var i = 0; i < wf.tarefa.length; i++) {
+								var n = wf.tarefa[i];
+								s += graphElement(
+										tipos[n.tipo],
+										n,
+										i < wf.tarefa.length - 1 ? wf.tarefa[i + 1]
+												: undefined);
+							}
+						}
+						s += '}';
+						return s;
+					}
+
+					$scope.getParameterByName = function(name, url) {
+						if (!url)
+							url = window.location.href;
+						name = name.replace(/[\[\]]/g, '\\$&');
+						var regex = new RegExp('[?&]' + name
+								+ '(=([^&#]*)|&|#|$)'), results = regex
+								.exec(url);
+						if (!results)
+							return;
+						if (!results[2])
+							return;
+						return decodeURIComponent(results[2]
+								.replace(/\+/g, ' '));
+					}
+
+					$scope.carregarResponsaveis(function() {
+						$scope.id = $scope.getParameterByName('id');
+						if ($scope.id) {
+							$scope.carregar($scope.id);
+						}
+					})
+				});
+
+var uuidv4 = function() {
+	return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
+		var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
+		return v.toString(16);
+	});
+};
+
+var formdata = function(obj) {
+	var s = "";
+	var f = function(prefix, jsonObj) {
+		if (typeof jsonObj == "object" && jsonObj !== null) {
+			$.each(jsonObj, function(k, v) {
+				if (k == "$$hashKey" || v === null || v === undefined)
+					return;
+				if (typeof v == "object" && v !== null) {
+					var nextprefix = prefix;
+					if (typeof k == "number") {
+						if (prefix.endsWith(".")) {
+							nextprefix = nextprefix.substring(0,
+									nextprefix.length - 1);
+						}
+						nextprefix += "[" + k + "].";
+					} else
+						nextprefix += k + ".";
+					f(nextprefix, v);
+				} else if (typeof k == "number") {
+					if (prefix.endsWith(".")) {
+						nextprefix = prefix.substring(0, prefix.length - 1);
+					}
+					if (s != "")
+						s = s + "&";
+					s += nextprefix + "[" + k + "]=" + v;
+				} else {
+					if (s != "")
+						s = s + "&";
+					s = s + prefix + k + "=" + encodeURIComponent(v);
+				}
+			});
+		}
+	}
+
+	f("", obj);
+
+	// alert(s);
+
+	return s;
+}
\ No newline at end of file
diff --git a/sigawf/src/main/webapp/js/wf-design.js b/sigawf/src/main/webapp/js/wf-design.js
deleted file mode 100644
index 093a15b69c..0000000000
--- a/sigawf/src/main/webapp/js/wf-design.js
+++ /dev/null
@@ -1,520 +0,0 @@
-var app = angular.module("wfDesignApp", []);
-
-app.controller("wfDesignCtrl", function($scope, $http, $sce) {
-	$scope.exibirXml = false;
-
-	$scope.event_type = [ {
-		label : "Ao entrar",
-		name : "node-enter"
-	}, {
-		label : "Ao sair",
-		name : "node-leave"
-	}, {
-		label : "Ao criar tarefa",
-		name : "task-create"
-	}, {
-		label : "Ao trocar o contexto",
-		name : "context-change"
-	} ];
-
-	$scope.editar = function(obj) {
-		$scope.editando = obj;
-	}
-
-	$scope.addRaia = function() {
-		var obj = {
-			name : ""
-		};
-		$scope.editar(obj);
-		$scope.pd.swimlane.push(obj);
-	}
-
-	$scope.delRaia = function(st) {
-		$scope.pd.swimlane.splice(st, 1);
-	};
-
-	$scope.addTarefa = function() {
-		var obj = {
-			"name" : "",
-			"task" : {
-				"controller" : {
-					"variable" : []
-				},
-				"name" : "",
-				"swimlane" : null
-			},
-			"transition" : []
-		};
-		$scope.editar(obj);
-		$scope.pd.task_node.push(obj);
-	}
-
-	$scope.delTarefa = function(st) {
-		$scope.pd.task_node.splice(st, 1);
-	};
-
-	$scope.addNode = function() {
-		var obj = {
-			"name" : "",
-			"event" : [],
-			"transition" : []
-		};
-		$scope.editar(obj);
-		$scope.pd.node.push(obj);
-	}
-
-	$scope.delNode = function(st) {
-		$scope.pd.node.splice(st, 1);
-		fixTransitions($scope.pd);
-	};
-
-	$scope.addEndState = function() {
-		var obj = {
-			"name" : "",
-			"event" : []
-		};
-		$scope.editar(obj);
-		$scope.pd.end_state.push(obj);
-	}
-
-	$scope.delEndState = function(st) {
-		$scope.pd.end_state.splice(st, 1);
-		fixTransitions($scope.pd);
-	};
-
-	$scope.addVariavel = function(tarefa) {
-		tarefa.task.controller.variable.push({
-			name : ""
-		});
-	}
-
-	$scope.delVariavel = function(tarefa, st) {
-		tarefa.task.controller.variable.splice(st, 1);
-	};
-
-	$scope.addEvento = function(tarefa) {
-		if (typeof tarefa.event === "undefined")
-			tarefa.event = [];
-		tarefa.event.push({
-			name : ""
-		});
-	}
-
-	$scope.delEvento = function(tarefa, st) {
-		tarefa.event.splice(st, 1);
-	};
-
-	$scope.addTransicao = function(tarefa) {
-		tarefa.transition.push({
-			name : ""
-		});
-	}
-
-	$scope.delTransicao = function(tarefa, st) {
-		tarefa.transition.splice(st, 1);
-	};
-
-	$scope.addTransicaoEmail = function(transicao) {
-		if (transicao.mail == null)
-			transicao.mail = [];
-		transicao.mail.push({});
-	}
-
-	$scope.delTransicaoEmail = function(transicao, st) {
-		transicao.mail.splice(st, 1);
-	};
-
-	$scope.carregar = function(name) {
-		$http.get('../processdefinition/' + name).success(function(xml) {
-			// $scope.pd = $.xml2json(xml);
-			$scope.json = JSON.parse(xml2json(parseXml(xml), " "));
-			$scope.pd = $scope.json['process-definition'];
-			$scope.jsonToShow = $scope.json;
-			trimStrings($scope.pd);
-
-			$scope.xmlOriginal = json2xml($scope.json, " ");
-
-			posLoad($scope.pd);
-		}).error(function(data, status, headers, config) {
-			$scope.pd = defaultprocessdefinition;
-		});
-	}
-
-	$scope.salvar = function(name) {
-		preSave();
-
-		$http.post('../processdefinition/' + name, $.param({
-			procedimento : name,
-			xml : $scope.xml
-		}), {
-			headers : {
-				'Content-Type' : 'application/x-www-form-urlencoded'
-			}
-		}).success(function(res) {
-			window.alert(res);
-		}).error(function(data, status, headers, config) {
-			window.alert(res);
-		});
-	}
-
-	$scope.editarXml = function(name) {
-		try {
-			preSave();
-		} catch (e) {
-			alert(e);
-		}
-		$scope.exibirXml = true;
-	}
-	
-	//
-	// Manter coerencia
-	//
-	function fixTransitions(obj) {
-		var ns = $scope.nodes();
-		for ( var x in obj) {
-			if (typeof obj[x] == 'object' && x == "_to") {
-				var replaced = false;
-				for ( var s in ns) {
-					if (ns[s]._name == obj[x]._name) {
-						obj[x] = ns[s];
-						replaced = true;
-						break;
-					}
-				}
-				if (!replaced) {
-					obj[x] = ns[0];
-				}
-			} else if (typeof obj[x] == 'object') {
-				fixTransitions(obj[x]);
-			}
-		}
-	}
-	
-	function cloneObject(obj) {
-	    if (obj === null || typeof obj !== 'object') {
-	        return obj;
-	    }
-	 
-	    var temp = obj.constructor(); // give temp the original obj's constructor
-	    for (var key in obj) {
-	        temp[key] = cloneObject(obj[key]);
-	    }
-	 
-	    return temp;
-	}
-
-	//
-	// Pre-save
-	//
-	function preSave() {
-		//var obj = jQuery.extend(true, {}, $scope.json);
-		var obj = cloneObject($scope.json);
-		trimStrings(obj);
-		restoreSwimlanes(obj);
-		restoreEventTypes(obj);
-		restoreTransitions(obj);
-		removeHashKeys(obj);
-		restorePropertyNames(obj);
-		// $scope.jsonToShow = obj;
-		$scope.xml = json2xml(obj, " ");
-	}
-
-	function restorePropertyNames(obj) {
-		for ( var x in obj) {
-			if (typeof obj[x] == 'object') {
-				restorePropertyNames(obj[x]);
-			}
-			var newx = x.replace(/__text/, "#text").replace(/^_/, "@").replace(
-					/_/, "-");
-			replacePropertyName(obj, x, newx);
-		}
-	}
-
-	function restoreSwimlanes(obj) {
-		for ( var x in obj) {
-			if (typeof obj[x] == 'object' && x == "_swimlane") {
-				obj[x] = obj[x]._name;
-			}
-			if (typeof obj[x] == 'object') {
-				restoreSwimlanes(obj[x]);
-			}
-		}
-	}
-
-	function restoreTransitions(obj) {
-		var ns = $scope.nodes();
-		for ( var x in obj) {
-			if (typeof obj[x] == 'object' && x == "_to") {
-				obj[x] = obj[x]._name;
-			} else if (typeof obj[x] == 'object') {
-				restoreTransitions(obj[x]);
-			}
-		}
-	}
-
-	function restoreEventTypes(obj) {
-		var ns = $scope.event_type;
-		for ( var x in obj) {
-			if (typeof obj[x] == 'object' && x == "_type") {
-				obj[x] = obj[x].name;
-			} else if (typeof obj[x] == 'object') {
-				restoreEventTypes(obj[x]);
-			}
-		}
-	}
-
-	function removeHashKeys(obj) {
-		var ns = $scope.event_type;
-		for ( var x in obj) {
-			if (x == "$$hashKey") {
-				delete obj[x];
-			} else if (typeof obj[x] == 'object') {
-				removeHashKeys(obj[x]);
-			}
-		}
-	}
-
-	//
-	// Pos-Load
-	//
-	function posLoad(obj) {
-		trimStrings(obj);
-		replacePropertyNames(obj);
-		assureArrays(obj);
-		replaceSwimlanes(obj);
-		replaceEventTypes(obj);
-		replaceTransitions(obj);
-	}
-
-	function replacePropertyName(obj, name, newname) {
-		if (name == newname)
-			return;
-		obj[newname] = obj[name];
-		delete obj[name];
-	}
-
-	function replacePropertyNames(obj) {
-		for ( var x in obj) {
-			if (typeof obj[x] == 'object') {
-				replacePropertyNames(obj[x]);
-			}
-			var newx = x.replace(/^@/, "_").replace(/-/, "_").replace(/#text/,
-					"__text");
-			replacePropertyName(obj, x, newx);
-		}
-	}
-
-	function trimStrings(obj) {
-		for ( var x in obj) {
-			if (typeof obj[x] == 'string') {
-				obj[x] = obj[x].replace(/^\s+|\s+$/g, "");
-			}
-			if (typeof obj[x] == 'object') {
-				trimStrings(obj[x]);
-			}
-		}
-	}
-
-	function assureArrays(obj) {
-		for ( var x in obj) {
-			if (!(obj[x] instanceof Array)
-					&& $.inArray(x, [ 'swimlane', 'transition', 'variable',
-							'mail', 'node', 'decision', 'mail_node',
-							'end_state', 'start_state', 'event' ]) != -1
-					&& typeof obj[x] == 'object')
-				obj[x] = [ obj[x] ];
-			if (typeof obj[x] == 'object') {
-				assureArrays(obj[x]);
-			}
-		}
-	}
-
-	function replaceSwimlanes(obj) {
-		for ( var x in obj) {
-			if (typeof obj[x] == 'string' && x == "_swimlane") {
-				for ( var s in $scope.pd.swimlane) {
-					if ($scope.pd.swimlane[s]._name == obj[x]) {
-						obj[x] = $scope.pd.swimlane[s];
-						break;
-					}
-				}
-			}
-			if (typeof obj[x] == 'object') {
-				replaceSwimlanes(obj[x]);
-			}
-		}
-	}
-
-	function replaceTransitions(obj) {
-		var ns = $scope.nodes();
-		for ( var x in obj) {
-			if (typeof obj[x] == 'string' && x == "_to") {
-				var replaced = false;
-				for ( var s in ns) {
-					if (ns[s]._name == obj[x]) {
-						obj[x] = ns[s];
-						replaced = true;
-						break;
-					}
-				}
-				if (!replaced)
-					alert("Destino de transição não encontrado: " + obj[x]);
-			} else if (typeof obj[x] == 'object') {
-				replaceTransitions(obj[x]);
-			}
-		}
-	}
-
-	function replaceEventTypes(obj) {
-		var ns = $scope.event_type;
-		for ( var x in obj) {
-			if (typeof obj[x] == 'string' && x == "_type") {
-				var replaced = false;
-				for ( var s in ns) {
-					if (ns[s].name == obj[x]) {
-						obj[x] = ns[s];
-						replaced = true;
-						break;
-					}
-				}
-				if (!replaced)
-					alert("Tipo de evento não encontrado: " + obj[x]);
-			} else if (typeof obj[x] == 'object') {
-				replaceEventTypes(obj[x]);
-			}
-		}
-	}
-
-	//
-	// Validate
-	//
-	function validate(pd) {
-
-	}
-
-	//
-	// Pre-persist
-	//
-	function prePersist(pd) {
-		copyTaskNodeNamesToTaks(pd);
-	}
-
-	function copyTaskNodeNamesToTaks(obj) {
-		for ( var s in obj.task_node) {
-			obj.task_node[s].task.name = obj.task_node[s].name;
-		}
-	}
-
-	$scope.nodes = function() {
-		var ns = [];
-		for ( var s in $scope.pd.task_node) {
-			ns.push($scope.pd.task_node[s]);
-		}
-		for ( var s in $scope.pd.node) {
-			ns.push($scope.pd.node[s]);
-		}
-		for ( var s in $scope.pd.mail_node) {
-			ns.push($scope.pd.mail_node[s]);
-		}
-		for ( var s in $scope.pd.decision) {
-			ns.push($scope.pd.decision[s]);
-		}
-		for ( var s in $scope.pd.fork) {
-			ns.push($scope.pd.fork[s]);
-		}
-		for ( var s in $scope.pd.join) {
-			ns.push($scope.pd.join[s]);
-		}
-		for ( var s in $scope.pd.end_state) {
-			ns.push($scope.pd.end_state[s]);
-		}
-		return ns;
-	}
-
-	function graphElement(name, shape, n) {
-		var s = '"' + name + '"[shape="' + shape + '"][label=<<font>' + name
-				+ '</font>>];';
-		for ( var x in n.transition) {
-			var tr = n.transition[x];
-			if (typeof tr._to !== "undefined")
-				s += '"' + n._name + '"->"' + tr._to._name + '";';
-		}
-		return s;
-	}
-
-	$scope.getSmallGraphSource = function() {
-		if ($scope.pd == null)
-			return "";
-		var s = 'digraph G { graph[size="3,3"];';
-		s += graphElement($scope.pd.start_state._name, "oval",
-				$scope.pd.start_state);
-		for ( var x in $scope.pd.task_node) {
-			var n = $scope.pd.task_node[x];
-			s += graphElement(n._name, "rectangle", n);
-		}
-		for ( var x in $scope.pd.fork) {
-			var n = $scope.pd.fork[x];
-			s += graphElement(n._name, "trapezium", n);
-		}
-		for ( var x in $scope.pd.join) {
-			var n = $scope.pd.join[x];
-			s += graphElement(n._name, "invtrapezium", n);
-		}
-		for ( var x in $scope.pd.node) {
-			var n = $scope.pd.node[x];
-			s += graphElement(n._name, "octagon", n);
-		}
-		for ( var x in $scope.pd.decision) {
-			var n = $scope.pd.decision[x];
-			s += graphElement(n._name, "diamond", n);
-		}
-		for ( var x in $scope.pd.mail_node) {
-			var n = $scope.pd.mail_node[x];
-			s += graphElement(n._name, "note", n);
-		}
-		for ( var x in $scope.pd.end_state) {
-			var n = $scope.pd.end_state[x];
-			s += graphElement(n._name, "oval", n);
-		}
-
-		s += '}';
-		return s;
-	}
-
-	$scope.getSmallGraph = function() {
-		var input = $scope.getSmallGraphSource();
-		var format = "svg";
-		var engine = "dot";
-
-		var result = Viz(input, format, engine);
-
-		if (format == "svg") {
-			return $sce.trustAsHtml(result);
-		} else {
-			return "";
-		}
-	}
-
-	$scope.atualizarSmallGraph = function() {
-		$scope.smallgraph = $scope.getSmallGraph();
-	}
-
-	$scope.atualizarDiff = function() {
-		var args = {
-			source : "asdf",
-			diff : "asdd",
-			lang : "text"
-		}, output = prettydiff(args);
-		var result = output;
-		// result = output[0].substring(output[0].indexOf('<div
-		// class=\'diff\'>'));
-		// result = result.substring(0,result.indexOf("</p></div>")) +
-		// "</p></div>";
-		$scope.diff = $sce.trustAsHtml(result);
-	}
-
-	$scope.getPD = function() {
-		return $sce.trustAsHtml(angular.toJson($scope.pd, true));
-	}
-
-});
diff --git a/sigawf/src/main/webapp/paginas/menus/menu.jsp b/sigawf/src/main/webapp/paginas/menus/menu.jsp
index 87a4b611f3..9b78195092 100644
--- a/sigawf/src/main/webapp/paginas/menus/menu.jsp
+++ b/sigawf/src/main/webapp/paginas/menus/menu.jsp
@@ -1,85 +1,42 @@
 
 <%@ include file="/WEB-INF/page/include.jsp"%>
 
-	<li class="nav-item dropdown">
-		<a href="javascript:void(0);" class="nav-link dropdown-toggle" data-toggle="dropdown">Procedimentos</a>
-		<ul class="dropdown-menu">
-			<li>
-				<a class="dropdown-item" href="${linkTo[AppController].resumo}" >Ativos</a>
-			</li>
-
-			<c:if test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;OPERAR:Executar comandos da tela inicial')}">
-				<li class="dropdown-submenu">
-					<a href="javascript:void(0);" class="dropdown-item dropdown-toggle">Iniciar</a>
-					<ul class="dropdown-menu">
-						<c:forEach var="pd" items="${processDefinitions}">
-							<li>
-								<a class="dropdown-item" href="${linkTo[AppController].initializeProcess[pd.id]}" >${pd.name}</a>
-							</li>
-						</c:forEach>
-					</ul>
-				</li>
-			</c:if>
-		</ul> 
-		<c:if test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;FE:Ferramentas')}">
-			<li class="nav-item dropdown">
-				<a href="javascript:void(0);" class="nav-link dropdown-toggle" data-toggle="dropdown">Ferramentas</a>
-				<ul class="dropdown-menu navmenu-large">
-					<c:if	test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;CONFIGURAR:Configurar iniciadores')}">
-						<li class="dropdown-submenu">
-							<a href="#" class="dropdown-item dropdown-toggle">Configurar</a>
-							<ul class="dropdown-menu">
-								<c:forEach var="pd" items="${processDefinitions}">
-									<li>
-										<a class="dropdown-item" href="${linkTo[ConfiguracaoController].pesquisar[lotaTitular.orgaoUsuario.acronimoOrgaoUsu][pd.name]}">${pd.name}</a>
-									</li>
-								</c:forEach>
-							</ul>
-						</li>
-					</c:if>
-
-					<c:if test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;DESIGNAR:Designar tarefas')}">
-						<li class="dropdown-submenu">
-							<a href="#" class="dropdown-item dropdown-toggle">Designar Tarefas</a>
-							<ul class="dropdown-menu">
-								<c:forEach var="pd" items="${processDefinitions}">
-									<li>
-										<a class="dropdown-item" href="${linkTo[DesignacaoController].pesquisar[lotaTitular.orgaoUsuario.acronimoOrgaoUsu][pd.name]}" >${pd.name}</a>
-									</li>
-								</c:forEach>
-							</ul></li>
-					</c:if>
-				
-					<c:if test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;EDITAR:Editar procedimento')}">
-						<li class="dropdown-submenu">
-							<a href="#" class="dropdown-item dropdown-toggle">Editar Procedimento</a>
-							<ul class="dropdown-menu navmenu-large">
-								<c:forEach var="pd" items="${processDefinitions}">
-									<li>
-										<a class="dropdown-item" href="${linkTo[EdicaoController].form[pd.name]}">${pd.name}</a>
-									</li>
-								</c:forEach>
-							</ul>
-						</li>
-					</c:if>
-				</ul>
-			</li>
+<li class="nav-item dropdown"><a href="javascript:void(0);"
+	class="nav-link dropdown-toggle" data-toggle="dropdown">Procedimentos</a>
+	<ul class="dropdown-menu">
+		<c:if
+			test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;INI:Iniciar')}">
+			<li><a class="dropdown-item"
+				href="${linkTo[WfAppController].listarParaIniciar}">Iniciar</a></li>
 		</c:if>
-	</li>
-	<c:if test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;MEDIR: Analisar métricas')}">
-		<li class="nav-item dropdown">
-			<a href="javascript:void(0);" class="nav-link dropdown-toggle" data-toggle="dropdown">Relatórios </a>
+		<li><a class="dropdown-item"
+			href="${linkTo[WfAppController].ativos}">Ativos</a></li>
+	</ul> <c:if
+		test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;FE:Ferramentas')}">
+		<li class="nav-item dropdown"><a href="javascript:void(0);"
+			class="nav-link dropdown-toggle" data-toggle="dropdown">Ferramentas</a>
 			<ul class="dropdown-menu navmenu-large">
-				<li class="dropdown-submenu">
-					<a href="#" class="dropdown-item dropdown-toggle">Apresentar Métricas</a>
-					<ul class="dropdown-menu">
-						<c:forEach var="pd" items="${processDefinitions}">
-							<li>
-								<a class="dropdown-item" href="${linkTo[MetricaController].medir}?orgao=${lotaTitular.orgaoUsuario.id}&procedimento=${pd.name}&pdId=${pd.id}">${pd.name}</a>
-							</li>
-						</c:forEach>
-					</ul>
-				</li>
-			</ul>
-		</li>
-	</c:if>
\ No newline at end of file
+				<c:if
+					test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;FE;DEFP:Cadastrar Diagramas')}">
+					<li><a class="dropdown-item"
+						href="${linkTo[WfDiagramaController].lista()}">Cadastro de
+							Diagramas</a></li>
+				</c:if>
+				<c:if
+					test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;FE;DEFR:Cadastrar Responsáveis')}">
+					<li><a class="dropdown-item"
+						href="${linkTo[WfResponsavelController].lista()}">Cadastro de
+							Responsáveis</a></li>
+				</c:if>
+			</ul></li>
+	</c:if></li>
+<c:if
+	test="${f:podeUtilizarServicoPorConfiguracao(titular,lotaTitular,'SIGA;WF;REL:Relatórios')}">
+	<li class="nav-item dropdown"><a href="javascript:void(0);"
+		class="nav-link dropdown-toggle" data-toggle="dropdown">Relatórios
+	</a>
+		<ul class="dropdown-menu navmenu-large">
+			<li><a class="dropdown-item"
+				href="${linkTo[WfRelatorioController].listarParaGerarRelatorios()}">Medições</a></li>
+		</ul></li>
+</c:if>
\ No newline at end of file
